import{A as E}from"./Avatar-BvJYmT9C.js";import{N as w}from"./NavBar-BSxUZM35.js";import{I as R}from"./Icon-XsD-7neM.js";import{E as U}from"./Empty-Dhm7Ynwu.js";import{f as k,i as M,h as d,p as b,q as P,c as g,m as p,a as l,k as m,g as D,u,e as s,t as h,l as x,d as C,C as $,y as K,B as L,o as r,_ as Y}from"./index-DyncoFNp.js";import{B as S}from"./Button-BqxwzfdT.js";import{I as q}from"./Input-BrAf66hy.js";import{s as v}from"./toast-DSCwmRst.js";const z={class:"add-friend-wrapper"},O={class:"search-input-wrapper"},W={class:"search-icon"},j={key:1,class:"user-wrapper"},G={class:"user-info"},H={class:"user-nick"},J={class:"user-id"},Q=k({__name:"index",setup(A){const I=$(),{proxy:n}=M(),e=n==null?void 0:n.$UIKitStore,_=n==null?void 0:n.$NIM,c=d("beginSearch"),o=d(),f=d("stranger"),y=d(""),F=b(()=>{var a,t;e==null||e.uiStore.friends,(a=o.value)!=null&&a.accountId&&(f.value=e==null?void 0:e.uiStore.getRelation((t=o.value)==null?void 0:t.accountId).relation)}),B=async a=>{try{const t=await(e==null?void 0:e.userStore.getUserActive(a));t?(o.value=t,f.value=e==null?void 0:e.uiStore.getRelation(t.accountId).relation,c.value="searchResult"):c.value="searchEmpty"}catch{c.value="searchEmpty",v({message:s("searchFailText"),type:"info"})}},N=async()=>{var t;const a=(t=o.value)==null?void 0:t.accountId;if(a)try{await(e==null?void 0:e.friendStore.addFriendActive(a,{addMode:K.V2NIMFriendAddMode.V2NIM_FRIEND_MODE_TYPE_APPLY,postscript:""})),await(e==null?void 0:e.relationStore.removeUserFromBlockListActive(a)),v({message:s("applyFriendSuccessText"),type:"info"})}catch{v({message:s("applyFriendFailText"),type:"info"})}},T=async()=>{var t;const a=(t=o.value)==null?void 0:t.accountId;if(a)try{const i=_==null?void 0:_.V2NIMConversationIdUtil.p2pConversationId(a);await(e==null?void 0:e.uiStore.selectConversation(i)),I.push(L.chat)}catch{v({message:s("gotoChatFailText"),type:"info"})}},V=a=>{a===""&&(c.value="beginSearch")};return P(()=>{F()}),(a,t)=>(r(),g("div",z,[p(w,{title:u(s)("addFriendText")},null,8,["title"]),l("div",O,[l("div",W,[p(R,{size:20,color:"#A6ADB6",type:"icon-sousuo"})]),p(q,{class:"search-input",type:"text",modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=i=>y.value=i),onInput:V,onConfirm:B,"placeholder-class":"placeholder","confirm-type":"search",placeholder:u(s)("enterAccount"),inputStyle:{backgroundColor:"#f2f4f5"}},null,8,["modelValue","placeholder"])]),c.value=="searchEmpty"?(r(),m(U,{key:0,text:u(s)("noExistUser")},null,8,["text"])):c.value==="searchResult"?(r(),g("div",j,[p(E,{class:"user-avatar",account:o.value&&o.value.accountId||""},null,8,["account"]),l("div",G,[l("div",H,h(o.value&&o.value.name||o.value&&o.value.accountId),1),l("div",J,h(o.value&&o.value.accountId),1)]),f.value!=="stranger"?(r(),m(S,{key:0,class:"go-chat-button",onClick:T},{default:x(()=>[C(h(u(s)("chatButtonText")),1)]),_:1})):(r(),m(S,{key:1,class:"go-chat-button",onClick:N},{default:x(()=>[C(h(u(s)("addText")),1)]),_:1}))])):D("",!0)]))}}),X=Y(Q,[["__scopeId","data-v-2d8608d9"]]),re=k({__name:"AddFriendPage",setup(A){return(I,n)=>(r(),m(X))}});export{re as default};

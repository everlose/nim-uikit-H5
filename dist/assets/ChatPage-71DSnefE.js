import{t as je}from"./reporter-Cs0pKN63.js";import{_ as B,c as d,o as n,a as c,r as J,w as Te,v as fe,b as pe,n as F,d as Se,t as E,y as m,e as u,f as j,g as V,u as i,h as A,i as oe,j as H,k as z,l as L,m as I,p as Z,q as ne,s as de,F as ee,x as te,z as ue,A as Ke,B as me,C as Pe,D as He,E as Ae}from"./index-DyncoFNp.js";import{N as We}from"./NetworkAlert-BzZ3Rn47.js";import{N as Xe}from"./nav-bar-CoOUPfVF.js";import{I as b}from"./Icon-XsD-7neM.js";import{A as X,c as qe,a as Je,r as Qe}from"./Avatar-BvJYmT9C.js";import{e as P}from"./eventBus-E5P-NQ8u.js";import{A as Re}from"./Appellation-5sErKFFL.js";import{M as Ze,s as Ce}from"./modal-DQBuBeBM.js";import{I as xe}from"./Input-BrAf66hy.js";import{t as ge,s as re}from"./toast-DSCwmRst.js";import{E as Ge,e as Ue,a as he}from"./emoji-Bh8i_--D.js";import{g as es,p as ss}from"./index.esm-CPwIBr9T.js";import"./package-DKjbUiep.js";const ts={name:"Tooltip",props:{visible:Boolean,align:Boolean,color:{type:String,default:"#303133"},content:{type:String,default:""},show:{type:Boolean,default:!1}},data(){return{isShow:this.visible,title:"Hello",arrowLeft:0,query:null,style:{},arrowStyle:{},placement:"top",touchTimer:null,touchStartTime:0,touchStartPosition:null}},onLoad(){},watch:{isShow:{handler(T){this.$emit("update:visible",T)},immediate:!0},visible:{handler(T){T&&this.$nextTick(()=>{this.getPosition()}),this.isShow=T},immediate:!0}},mounted(){window.addEventListener("click",()=>{this.isShow=!1}),this.getPosition()},methods:{close(){this.isShow=!1},fixedWrap(){this.isShow=!1},async handleClick(){if(this.isShow)return this.isShow=!1;await this.getPosition(),this.isShow=!0},getPosition(){return new Promise(T=>{const t=this.$el.querySelector(".chat_tooltip_content"),e=this.$el.querySelector(".chat_tooltip__popper");if(t&&e){const o=t.getBoundingClientRect(),s=e.getBoundingClientRect(),{top:a,width:p,height:l,left:r}=o,_=window.innerWidth;let g={},f={};switch(a<=300?this.placement="bottom":this.placement="top",this.placement){case"top":if(this.align){let y=-100;p<90&&(y=-200),r+y<0&&(y=-r+10),r+y+s.width>_&&(y=_-r-s.width-10),g.left=`${y}px`}else{let y=50;r+y+s.width>_&&(y=_-r-s.width-10),g.left=`${y}px`}g.bottom=`${l+8}px`;break;case"bottom":if(this.align){let y=-100;p<100&&(y=-200),r+y<0&&(y=-r+10),r+y+s.width>_&&(y=_-r-s.width-10),g.left=`${y}px`}else{let y=50;r+y+s.width>_&&(y=_-r-s.width-10),g.left=`${y}px`}g.top=`${l+8}px`;break}this.style=g,this.arrowStyle=f,T()}})},handleTouchStart(T){this.touchStartTime=Date.now(),this.touchStartPosition={x:T.touches[0].clientX,y:T.touches[0].clientY},this.touchTimer=setTimeout(()=>{const t=T.touches[0].clientX,e=T.touches[0].clientY;Math.sqrt(Math.pow(t-this.touchStartPosition.x,2)+Math.pow(e-this.touchStartPosition.y,2))<10&&this.handleClick()},500)},handleTouchEnd(){clearTimeout(this.touchTimer)},handleTouchMove(){clearTimeout(this.touchTimer)}},beforeUnmount(){clearTimeout(this.touchTimer)}};function os(T,t,e,o,s,a){return n(),d("div",{class:"chat-tooltip",style:F({"--theme-bg-color":e.color})},[c("div",{class:"chat_tooltip_content",onTouchstart:t[1]||(t[1]=(...p)=>a.handleTouchStart&&a.handleTouchStart(...p)),onTouchend:t[2]||(t[2]=(...p)=>a.handleTouchEnd&&a.handleTouchEnd(...p)),onTouchmove:t[3]||(t[3]=(...p)=>a.handleTouchMove&&a.handleTouchMove(...p))},[J(T.$slots,"default",{},void 0),Te(c("div",{class:"chat_tooltip__mask",onTouchstart:t[0]||(t[0]=pe((...p)=>a.close&&a.close(...p),["stop"]))},null,544),[[fe,s.isShow]]),c("div",{class:"chat_tooltip__popper",onClick:pe(()=>{},["stop"]),style:F([s.style,{visibility:s.isShow?"visible":"hidden",color:e.color==="white"?"":"#fff",boxShadow:e.color==="white"?"0 3px 6px -4px #0000001f, 0 6px 16px #00000014, 0 9px 28px 8px #0000000d":""}])},[J(T.$slots,"content",{},()=>[Se(E(e.content),1)])],4)],32)],4)}const Ie=B(ts,[["render",os],["__scopeId","data-v-7013cdfc"]]),R={ON_LOAD_MORE:"onLoadMore",ON_REEDIT_MSG:"onReEditMsg",REPLY_MSG:"replyMsg",ON_SCROLL_BOTTOM:"onScrollBottom",GET_HISTORY_MSG:"getHistoryMsg",CLOSE_PANEL:"closePanel",AUDIO_URL_CHANGE:"audioUrlChange"},be=15,ns="message-item-",Oe="yxAllowAt",Le={[m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE]:u("imgMsgText"),[m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO]:u("audioMsgText"),[m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO]:u("videoMsgText"),[m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE]:u("fileMsgText")},as={1:u("callDurationText"),2:u("callCancelText"),3:u("callRejectedText"),4:u("callTimeoutText"),5:u("callBusyText")},is=2*60*1e3,ls={key:0,class:"bottom-popup"},cs={class:"popup-content"},rs={key:0,class:"popup-header"},ds={class:"popup-body"},us=j({__name:"BottomPopup",props:{modelValue:{type:Boolean},showHeader:{type:Boolean,default:!0},showCancel:{type:Boolean,default:!0},showConfirm:{type:Boolean,default:!0}},emits:["update:modelValue","confirm","cancel"],setup(T,{emit:t}){const e=t,o=()=>{e("confirm"),e("update:modelValue",!1)},s=()=>{e("cancel"),e("update:modelValue",!1)};return(a,p)=>a.modelValue?(n(),d("div",ls,[c("div",{class:"popup-mask",onClick:s}),c("div",cs,[a.showHeader?(n(),d("div",rs,[a.showCancel?(n(),d("div",{key:0,class:"cancel-btn",onClick:s},E(i(u)("cancelText")),1)):V("",!0),a.showConfirm?(n(),d("div",{key:1,class:"confirm-btn",onClick:o},E(i(u)("okText")),1)):V("",!0)])):V("",!0),c("div",ds,[J(a.$slots,"default",{},void 0)])])])):V("",!0)}}),ms=B(us,[["__scopeId","data-v-a696c457"]]),gs={key:0,class:"avatar-wrapper"},ps={class:"name"},_s={key:1,class:"avatar-wrapper"},vs={class:"name"},Ms={class:"description"},Ts=j({__name:"message-forward-modal",props:{forwardModalVisible:{type:Boolean},forwardTo:{},forwardMsg:{},forwardConversationType:{},forwardToTeamInfo:{}},emits:["confirm","cancel"],setup(T,{emit:t}){const e=T,o=t,s=A(""),{proxy:a}=oe(),p=f=>{s.value=f},l=()=>{o("cancel")},r=()=>{o("confirm",s.value)},_=H(()=>a==null?void 0:a.$UIKitStore.uiStore.getAppellation({account:e.forwardTo})),g=H(()=>{var f;return a==null?void 0:a.$UIKitStore.uiStore.getAppellation({account:(f=e.forwardMsg)==null?void 0:f.senderId})});return(f,y)=>(n(),z(Ze,{title:i(u)("sendToText"),visible:f.forwardModalVisible,confirmText:i(u)("sendText"),cancelText:i(u)("cancelText"),onCancel:l,onConfirm:r},{default:L(()=>[e.forwardConversationType===i(m).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?(n(),d("div",gs,[I(X,{account:e.forwardToTeamInfo&&e.forwardToTeamInfo.teamId||"",avatar:e.forwardToTeamInfo&&e.forwardToTeamInfo.avatar,size:"36"},null,8,["account","avatar"]),c("div",ps,E(e.forwardToTeamInfo&&e.forwardToTeamInfo.name||""),1)])):(n(),d("div",_s,[I(X,{account:f.forwardTo,size:"36"},null,8,["account"]),c("div",vs,[c("span",null,E(_.value),1)])])),c("div",Ms,E("["+i(u)("forwardText")+"]")+" "+E(g.value)+" "+E(i(u)("sessionRecordText")),1),I(xe,{class:"forward-input",onInput:p,placeholder:i(u)("forwardComment"),inputStyle:{height:"22px"}},null,8,["placeholder"])]),_:1},8,["title","visible","confirmText","cancelText"]))}}),fs=B(Ts,[["__scopeId","data-v-a3736fd3"]]),Is={class:"forward-container"},ys={class:"tab-container"},hs={class:"list-container"},Ss={key:0,class:"friend-list"},Es=["onClick"],Ns={class:"item-info"},Cs={key:1,class:"team-list"},As=["onClick"],Vs={class:"item-info"},ws={class:"team-name"},ks=j({__name:"message-forward",props:{modelValue:{type:Boolean},msgIdClient:{}},emits:["update:modelValue","forward","cancel","confirm","close"],setup(T,{emit:t}){const e=T,o=t,{proxy:s}=oe(),a=s==null?void 0:s.$UIKitStore,p=s==null?void 0:s.$NIM,l=H({get:()=>e.modelValue,set:Y=>o("update:modelValue",Y)}),r=A(m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P),_=a==null?void 0:a.uiStore.selectedConversation;let g="";const f=A(""),y=A(),O=A(),k=A(!1),C=Y=>{if(k.value=!1,!y.value){ge.info(u("getForwardMessageFailed"));return}const D=p.V2NIMConversationIdUtil[r.value===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P?"p2pConversationId":"teamConversationId"](f.value);a==null||a.msgStore.forwardMsgActive(y.value,D,Y).then(()=>{ge.info(u("forwardSuccessText"))}).catch(()=>{ge.info(u("forwardFailedText"))}).finally(()=>{o("close")})},M=()=>{k.value=!1},h=A("friend"),v=A(""),w=A([]),K=A([]),se=Z(()=>{const Y=a==null?void 0:a.uiStore.friends.filter(D=>!(a!=null&&a.relationStore.blacklist.includes(D.accountId))).map(D=>({accountId:D.accountId,appellation:a==null?void 0:a.uiStore.getAppellation({account:D.accountId})}));Y!=null&&Y.length&&(w.value=Y)}),Q=Z(()=>{a!=null&&a.uiStore.teamList&&(K.value=a==null?void 0:a.uiStore.teamList)});ne(()=>{se(),Q()});const ae=Y=>{h.value=Y,v.value=""},le=(Y,D)=>{var S;v.value=Y,r.value=D,Y&&g&&(f.value=Y,y.value=(S=a==null?void 0:a.msgStore.getMsg(_,[g]))==null?void 0:S[0],k.value=!0,D===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&(O.value=a==null?void 0:a.teamStore.teams.get(Y)))},_e=()=>{v.value&&(o("forward",v.value,h.value),l.value=!1)},ve=()=>{l.value=!1};return de(()=>{g=e==null?void 0:e.msgIdClient}),(Y,D)=>(n(),d(ee,null,[I(ms,{modelValue:l.value,"onUpdate:modelValue":D[2]||(D[2]=S=>l.value=S),onConfirm:_e,onCancel:ve,showConfirm:!1,showCancel:!0,title:i(u)("forwardText")},{default:L(()=>[c("div",Is,[c("div",ys,[c("div",{class:te(["tab-item",{active:h.value==="friend"}]),onClick:D[0]||(D[0]=S=>ae("friend"))},E(i(u)("sendToFriend")),3),c("div",{class:te(["tab-item",{active:h.value==="team"}]),onClick:D[1]||(D[1]=S=>ae("team"))},E(i(u)("sendToTeam")),3)]),c("div",hs,[h.value==="friend"?(n(),d("div",Ss,[(n(!0),d(ee,null,ue(w.value,S=>(n(),d("div",{key:S.accountId,class:te(["list-item",{selected:v.value===S.accountId}]),onClick:()=>le(S.accountId,i(m).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P)},[I(X,{account:S.accountId,size:"40"},null,8,["account"]),c("div",Ns,[I(Re,{account:S.accountId},null,8,["account"])])],10,Es))),128))])):(n(),d("div",Cs,[(n(!0),d(ee,null,ue(K.value,S=>(n(),d("div",{key:S.teamId,class:te(["list-item",{selected:v.value===S.teamId}]),onClick:()=>le(S.teamId,i(m).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM)},[I(X,{account:S.teamId,avatar:S.avatar,size:"40"},null,8,["account","avatar"]),c("div",Vs,[c("div",ws,E(S.name),1)])],10,As))),128))]))])])]),_:1},8,["modelValue","title"]),I(fs,{"forward-modal-visible":k.value,"forward-to":f.value,"forward-msg":y.value,"forward-conversation-type":r.value,"forward-to-team-info":O.value,onConfirm:C,onCancel:M},null,8,["forward-modal-visible","forward-to","forward-msg","forward-conversation-type","forward-to-team-info"])],64))}}),$s=B(ks,[["__scopeId","data-v-076879a6"]]),bs={key:0,class:"msg-action-groups"},Os={class:"msg-action-btn-text"},Ps={class:"msg-action-btn-text"},Rs={class:"msg-action-btn-text"},xs={class:"msg-action-btn-text"},Gs={key:1,class:"msg-action-groups-unknown"},Us={class:"msg-action-btn-text"},Ls={key:0,class:"msg-bg msg-bg-in"},Ys={key:1,class:"msg-status-wrapper"},Ds={class:"msg-action-groups"},Fs={class:"msg-action-btn-text"},zs={class:"msg-action-btn-text"},Bs={key:0,class:"msg-bg msg-bg-out"},js={key:2,class:"msg-failed-wrapper"},Ks={class:"msg-failed"},Hs={class:"msg-action-btn-text"},Ws={class:"msg-action-btn-text"},Xs={key:0,class:"msg-bg msg-bg-out"},qs={key:0,class:"in-blacklist"},Js={key:1,class:"friend-delete"},Qs={key:0,class:"msg-action-groups"},Zs={class:"msg-action-btn-text"},et={class:"msg-action-btn-text"},st={class:"msg-action-btn-text"},tt={class:"msg-action-btn-text"},ot={class:"msg-action-btn-text"},nt={key:1,class:"msg-action-groups-unknown"},at={class:"msg-action-btn-text"},it={key:0,class:"msg-bg msg-bg-out"},lt={key:4,class:"msg-bg msg-bg-out"},ct={key:5},rt=j({__name:"message-bubble",props:{msg:{},tooltipVisible:{type:Boolean},bgVisible:{type:Boolean},placement:{}},setup(T){const t=A(null),e=T,{proxy:o}=oe(),s=o==null?void 0:o.$UIKitStore;o==null||o.$NIM.V2NIMConversationIdUtil.parseConversationType(e.msg.conversationId),de(()=>{p.value=!(e.msg.messageType==m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT||e.msg.messageType==m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE||e.msg.messageType==m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE||e.msg.messageType==m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO||e.msg.messageType==m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO||e.msg.messageType==m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL)});const a=A(!0),p=A(!1),l=()=>{var v;(v=t==null?void 0:t.value)==null||v.close()},r=async()=>{l();let v=setTimeout(()=>{try{qe(e.msg.text),re({message:u("copySuccessText"),type:"info",duration:2e3})}catch{re({message:u("copyFailText"),type:"info",duration:2e3})}finally{clearTimeout(v)}},200)},_=()=>{P.emit(R.ON_SCROLL_BOTTOM)},g=async()=>{const v=e.msg;o==null||o.$UIKitStore.msgStore.removeMsg(v.conversationId,[v.messageClientId]);try{switch(v.messageType){case m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE:case m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO:s==null||s.msgStore.sendMessageActive({msg:v,conversationId:v.conversationId,progress:()=>!0,sendBefore:()=>{_()}});break;case m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT:s==null||s.msgStore.sendMessageActive({msg:v,conversationId:v.conversationId,sendBefore:()=>{_()}});break;default:s==null||s.msgStore.sendMessageActive({msg:v,conversationId:v.conversationId,sendBefore:()=>{_()}});break}_()}catch(w){console.log(w)}},f=A(!1),y=()=>{f.value=!0},O=async()=>{const v=e.msg;o==null||o.$UIKitStore.msgStore.replyMsgActive(v),l(),P.emit(R.REPLY_MSG,e.msg)},k=()=>{if(Date.now()-e.msg.createTime>is){re({message:u("msgRecallTimeErrorText"),type:"info"}),l();return}Ce({title:u("recallText"),content:u("recall3"),confirmText:u("recallText"),onConfirm:()=>{o==null||o.$UIKitStore.msgStore.reCallMsgActive(e.msg).catch(()=>{re({message:u("recallMsgFailText"),type:"info"})}),l()},onCancel:()=>{l()}})},C=()=>{const v=e.msg;Ce({title:u("deleteText"),content:u("delete"),confirmText:u("deleteText"),onConfirm:()=>{o==null||o.$UIKitStore.msgStore.deleteMsgActive([v]).then(()=>{re({message:u("deleteMsgSuccessText"),type:"info",duration:2e3})}).catch(()=>{re({message:u("deleteMsgFailText"),type:"info",duration:2e3})}),l()},onCancel:()=>{l()}})},M=()=>{Ke.push({path:me.friendCard,query:{accountId:e.msg.receiverId}})},h=Z(()=>{const v=o==null?void 0:o.$UIKitStore.uiStore.friends.filter(w=>!(o!=null&&o.$UIKitStore.relationStore.blacklist.includes(w.accountId))).map(w=>w.accountId).some(w=>w.account===e.msg.receiverId);a.value=v});return ne(()=>{h()}),(v,w)=>(n(),d(ee,null,[e.msg.isSelf?e.msg.sendingState===i(m).V2NIMMessageSendingState.V2NIM_MESSAGE_SENDING_STATE_SENDING?(n(),d("div",Ys,[I(b,{size:21,color:"#337EFF",class:"msg-status-icon icon-loading",type:"icon-a-Frame8"}),I(Ie,{placement:v.placement,ref_key:"tooltipRef",ref:t,color:"white",align:e.msg.isSelf},{content:L(()=>[c("div",Ds,[e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(n(),d("div",{key:0,class:"msg-action-btn",onClick:r},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-fuzhi1"}),c("text",Fs,E(i(u)("copyText")),1)])):V("",!0),c("div",{class:"msg-action-btn",onClick:C},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),c("text",zs,E(i(u)("deleteText")),1)])])]),default:L(()=>[v.bgVisible?(n(),d("div",Bs,[J(v.$slots,"default",{},void 0,!0)])):J(v.$slots,"default",{key:1},void 0,!0)]),_:3},8,["placement","align"])])):e.msg.sendingState===i(m).V2NIMMessageSendingState.V2NIM_MESSAGE_SENDING_STATE_FAILED||e.msg.messageStatus.errorCode===102426||e.msg.messageStatus.errorCode===104404?(n(),d("div",js,[c("div",Ks,[c("div",{class:"msg-status-wrapper",onClick:g},w[2]||(w[2]=[c("div",{class:"icon-fail"},"!",-1)])),I(Ie,{placement:v.placement,ref_key:"tooltipRef",ref:t,color:"white",align:e.msg.isSelf},{content:L(()=>[c("div",{class:"msg-action-groups",style:F({width:e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?"112px":"56px"})},[e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(n(),d("div",{key:0,class:"msg-action-btn",onClick:r},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-fuzhi1"}),c("text",Hs,E(i(u)("copyText")),1)])):V("",!0),c("div",{class:"msg-action-btn",onClick:C},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),c("text",Ws,E(i(u)("deleteText")),1)])],4)]),default:L(()=>[v.bgVisible?(n(),d("div",Xs,[J(v.$slots,"default",{},void 0,!0)])):J(v.$slots,"default",{key:1},void 0,!0)]),_:3},8,["placement","align"])]),e.msg.messageStatus.errorCode===102426?(n(),d("div",qs,E(i(u)("sendFailWithInBlackText")),1)):e.msg.messageStatus.errorCode===104404?(n(),d("div",Js,[Se(E(i(u)("sendFailWithDeleteText"))+" ",1),c("span",{onClick:M,class:"friend-verification"},E(i(u)("friendVerificationText")),1)])):V("",!0)])):v.tooltipVisible?(n(),z(Ie,{key:3,placement:v.placement,ref_key:"tooltipRef",ref:t,color:"white",align:e.msg.isSelf},{content:L(()=>[p.value?(n(),d("div",nt,[c("div",{class:"msg-action-btn",onClick:C},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),c("text",at,E(i(u)("deleteText")),1)])])):(n(),d("div",Qs,[e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(n(),d("div",{key:0,class:"msg-action-btn",onClick:r},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-fuzhi1"}),c("text",Zs,E(i(u)("copyText")),1)])):V("",!0),e.msg.messageType!==i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(n(),d("div",{key:1,class:"msg-action-btn",onClick:O},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-huifu"}),c("text",et,E(i(u)("replyText")),1)])):V("",!0),e.msg.messageType!==i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO&&e.msg.messageType!==i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(n(),d("div",{key:2,class:"msg-action-btn",onClick:y},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-zhuanfa"}),c("text",st,E(i(u)("forwardText")),1)])):V("",!0),c("div",{class:"msg-action-btn",onClick:C},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),c("text",tt,E(i(u)("deleteText")),1)]),c("div",{class:"msg-action-btn",onClick:k},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-chehui"}),c("text",ot,E(i(u)("recallText")),1)])]))]),default:L(()=>[v.bgVisible?(n(),d("div",it,[J(v.$slots,"default",{},void 0,!0)])):J(v.$slots,"default",{key:1},void 0,!0)]),_:3},8,["placement","align"])):v.bgVisible?(n(),d("div",lt,[J(v.$slots,"default",{},void 0)])):(n(),d("div",ct,[J(v.$slots,"default",{},void 0)])):(n(),z(Ie,{key:0,placement:v.placement,ref_key:"tooltipRef",ref:t,color:"white"},{content:L(()=>[p.value?(n(),d("div",Gs,[c("div",{class:"msg-action-btn",onClick:C},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),c("text",Us,E(i(u)("deleteText")),1)])])):(n(),d("div",bs,[e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(n(),d("div",{key:0,class:"msg-action-btn",onClick:r},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-fuzhi1"}),c("text",Os,E(i(u)("copyText")),1)])):V("",!0),e.msg.messageType!==i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(n(),d("div",{key:1,class:"msg-action-btn",onClick:O},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-huifu"}),c("text",Ps,E(i(u)("replyText")),1)])):V("",!0),e.msg.messageType!==i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO&&e.msg.messageType!==i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(n(),d("div",{key:2,class:"msg-action-btn",onClick:y},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-zhuanfa"}),c("text",Rs,E(i(u)("forwardText")),1)])):V("",!0),c("div",{class:"msg-action-btn",onClick:C},[I(b,{size:18,color:"#656A72",class:"msg-action-btn-icon",type:"icon-shanchu"}),c("text",xs,E(i(u)("deleteText")),1)])]))]),default:L(()=>[v.bgVisible?(n(),d("div",Ls,[J(v.$slots,"default",{},void 0,!0)])):J(v.$slots,"default",{key:1},void 0,!0)]),_:3},8,["placement"])),I($s,{modelValue:f.value,"onUpdate:modelValue":w[0]||(w[0]=K=>f.value=K),msgIdClient:v.msg.messageClientId,onClose:w[1]||(w[1]=K=>f.value=!1)},null,8,["modelValue","msgIdClient"])],64))}}),ie=B(rt,[["__scopeId","data-v-5c34baa2"]]),dt={class:"wrapper"},ut=j({__name:"MessageOneLine",props:{text:{}},setup(T){const t=T,e=s=>{if(!s)return[];const a=Ue,p=[];let l;for(;(l=a.exec(s))!==null;){p.push({type:"emoji",value:l[0],index:l.index});const r=" ".repeat(l[0].length);s=s.replace(l[0],r)}return s=s.replace(a," "),s&&s.split(" ").filter(r=>r.trim()).map(r=>{const _=s==null?void 0:s.indexOf(r);p.push({type:"text",value:r,index:_});const g=" ".repeat(r.length);s=s==null?void 0:s.replace(r,g)}),p.map((r,_)=>({...r,key:_+r.type})).sort((r,_)=>(r==null?void 0:r.index)-(_==null?void 0:_.index))},o=H(()=>e(t.text));return(s,a)=>(n(),d("div",dt,[(n(!0),d(ee,null,ue(o.value,p=>(n(),d(ee,{key:p.key},[p.type==="text"?(n(),d(ee,{key:0},[Se(E(p.value),1)],64)):p.type==="emoji"?(n(),z(b,{key:1,type:i(Ge)[p.value],size:14,iconStyle:{margin:"3px",verticalAlign:"bottom",display:"inline-block"}},null,8,["type"])):V("",!0)],64))),128))]))}}),Ye=B(ut,[["__scopeId","data-v-92444cb6"]]);var mt=function(T){return T instanceof RegExp},gt=function(t){var e=/[\\^$.*+?()[\]{}|]/g,o=RegExp(e.source);return t&&o.test(t)?t.replace(e,"\\$&"):t},De=function(T){return typeof T=="string"},pt=function(T){var t=[];return T.forEach(function(e){Array.isArray(e)?t=t.concat(e):t.push(e)}),t};function _t(T,t,e){var o=0,s=0;if(T==="")return T;if(!T||!De(T))throw new TypeError("First argument to react-string-replace#replaceString must be a string");var a=t;mt(a)||(a=new RegExp("("+gt(a)+")","gi"));for(var p=T.split(a),l=1,r=p.length;l<r;l+=2){if(p[l]===void 0||p[l-1]===void 0){console.warn("reactStringReplace: Encountered undefined value during string replacement. Your RegExp may not be working the way you expect.");continue}s=p[l].length,o+=p[l-1].length,p[l]=e(p[l],l,o),o+=s}return p}function Ne(T,t,e){return Array.isArray(T)||(T=[T]),pt(T.map(function(o){return De(o)?_t(o,t,e):o}))}function vt(T,t){var r;if(!T)return[];const e=/(https?:\/\/\S+)/gi,o=t?JSON.parse(t).yxAitMsg:null,s=Ne(T,Ue,_=>({type:"emoji",value:_}));let p=Ne(s,e,_=>({type:"link",value:_}));return o&&((r=Object.keys(o))==null||r.forEach(_=>{const g=o[_];p=Ne(p,g.text,f=>({type:"Ait",value:f}))})),p.map(_=>typeof _=="string"?{type:"text",value:_}:_).map((_,g)=>({..._,key:g+_.type}))}const Mt={key:0,class:"msg-text"},Tt={key:1,class:"msg-text",style:{color:"#1861df"}},ft=["href"],It=j({__name:"message-text",props:{msg:{},fontSize:{}},setup(T){var o,s;const t=T,e=vt(((o=t.msg)==null?void 0:o.text)||"",(s=t.msg)==null?void 0:s.serverExtension);return(a,p)=>(n(),d("div",{class:"msg-text",style:F({fontSize:(a.fontSize||16)+"px"})},[(n(!0),d(ee,null,ue(i(e),(l,r)=>(n(),d(ee,{key:l.key},[l.type==="text"?(n(),d("span",Mt,E(l.value),1)):l.type==="Ait"?(n(),d("text",Tt,E(" "+l.value+" "),1)):l.type==="emoji"?(n(),z(b,{key:2,type:i(Ge)[l.value],size:a.fontSize||22,style:{margin:"0 2px 2px 2px",verticalAlign:"bottom"}},null,8,["type","size"])):l.type==="link"?(n(),d("a",{key:3,href:l.value,target:"_blank",rel:"noopener noreferrer",style:F({color:"#1861df",fontSize:(a.fontSize||16)+"px"})},E(l.value),13,ft)):V("",!0)],64))),128))],4))}}),Fe=B(It,[["__scopeId","data-v-2301aaf3"]]),yt={class:"audio-dur"},ht={class:"audio-icon-wrapper"},St=["src"],Et=j({__name:"message-audio",props:{msg:{},mode:{},broadcastNewAudioSrc:{}},setup(T){const t=T,e=A(null),o=A("icon-yuyin3"),s=A(!1),a=A(!1),p=H(()=>{var M,h;return((h=(M=t.msg)==null?void 0:M.attachment)==null?void 0:h.url)||""}),l=M=>Math.round(M/1e3)||1,r=H(()=>{var v;const M=l((v=t.msg.attachment)==null?void 0:v.duration),h=180;return 50+8*(M-1)>h?h:50+8*(M-1)}),_=H(()=>{var M;return l((M=t.msg.attachment)==null?void 0:M.duration)}),g=()=>{e.value&&(a.value?(e.value.pause(),e.value.currentTime=0,a.value=!1):(P.emit(R.AUDIO_PLAY_CHANGE,t.msg.messageClientId),e.value.play().catch(M=>{console.warn("播放音频失败:",M)})))};function f(){a.value=!0,C()}function y(){s.value=!1,a.value=!1}function O(){s.value=!1,a.value=!1}function k(){s.value=!1,console.warn("音频播放出错")}const C=()=>{try{s.value=!0;let M=["icon-yuyin1","icon-yuyin2","icon-yuyin3"];const h=()=>{const v=M.shift();v&&(o.value=v,!M.length&&s.value&&(M=["icon-yuyin1","icon-yuyin2","icon-yuyin3"]),M.length&&setTimeout(h,300))};h()}catch(M){console.log("动画播放出错:",M)}};return ne(()=>{P.off(R.AUDIO_PLAY_CHANGE),e.value&&(e.value.pause(),e.value.currentTime=0)}),de(()=>{P.on(R.AUDIO_PLAY_CHANGE,M=>{M!==t.msg.messageClientId&&a.value&&e.value&&(e.value.pause(),e.value.currentTime=0,a.value=!1,s.value=!1)})}),(M,h)=>(n(),d("div",{class:te(!M.msg.isSelf||M.mode==="audio-in"?"audio-in":"audio-out"),style:F({width:r.value+"px"}),onClick:g},[c("div",yt,E(_.value)+"s",1),c("div",ht,[(n(),z(b,{size:24,key:o.value,type:o.value},null,8,["type"]))]),c("audio",{src:p.value,ref_key:"audioRef",ref:e,onPlay:f,onPause:y,onEnded:O,onError:k},null,40,St)],6))}}),ze=B(Et,[["__scopeId","data-v-22ff7d31"]]),Nt={class:"preview-image-wrapper"},Ct=["src"],At=j({__name:"PreviewImage",props:{visible:{type:Boolean,default:!1},imageUrl:{type:String,required:!0},onClose:{type:Function,default:void 0}},emits:["update:visible"],setup(T,{emit:t}){const e=T,o=()=>{e.onClose&&e.onClose()};return(s,a)=>T.visible?(n(),d("div",{key:0,class:"preview-image-container",onClick:o},[c("div",Nt,[c("img",{src:T.imageUrl,class:"preview-image",onClick:a[0]||(a[0]=pe(()=>{},["stop"]))},null,8,Ct),c("div",{class:"close-button",onClick:o},"×")])])):V("",!0)}}),Be=B(At,[["__scopeId","data-v-88b7bd01"]]),Vt={key:0,class:"reply-msg-wrapper"},wt={key:0},kt={class:"reply-msg-name-wrapper"},$t={class:"reply-msg-name-content"},bt={key:0,class:"reply-msg-content"},Ot={key:1,class:"other-msg-wrapper"},Pt=["download"],Rt={key:2,class:"other-msg-wrapper other-msg-wrapper-text"},xt={key:0,class:"reply-message-content"},Gt=j({__name:"message-reply",props:{replyMsg:{}},setup(T){var k;const t=T,{proxy:e}=oe(),o=A(!1),s=A(""),a=A(!1),{name:p="",url:l=""}=((k=t.replyMsg)==null?void 0:k.attachment)||{},r=l+(l.includes("?")?"&":"?")+`download=${p}`,_=H(()=>{var C;return((C=t.replyMsg)==null?void 0:C.messageClientId)!=="noFind"}),g=H(()=>{var C,M,h;return t.replyMsg.errorCode==102426?"https://yx-web-nosdn.netease.im/common/c1f278b963b18667ecba4ee9a6e68047/img-fail.png":((M=(C=t.replyMsg)==null?void 0:C.attachment)==null?void 0:M.url)||((h=t.replyMsg.attachment)==null?void 0:h.file)});de(()=>{var C,M;s.value=e==null?void 0:e.$UIKitStore.uiStore.getAppellation({account:(C=t.replyMsg)==null?void 0:C.senderId,teamId:(M=t.replyMsg)==null?void 0:M.receiverId})});const f=Z(()=>{var C,M;s.value=e==null?void 0:e.$UIKitStore.uiStore.getAppellation({account:(C=t.replyMsg)==null?void 0:C.senderId,teamId:(M=t.replyMsg)==null?void 0:M.receiverId})}),y=()=>{var C,M,h,v,w,K;if(((C=t.replyMsg)==null?void 0:C.messageType)===m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE)o.value=!0,a.value=!0;else if(((M=t.replyMsg)==null?void 0:M.messageType)===m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT)o.value=!0;else if(((h=t.replyMsg)==null?void 0:h.messageType)===m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO){const se=(w=(v=t.replyMsg)==null?void 0:v.attachment)==null?void 0:w.url;se&&window.open(se,"_blank")}else((K=t.replyMsg)==null?void 0:K.messageType)===m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO&&(o.value=!0)},O=C=>{C.stopPropagation(),o.value=!1};return ne(()=>{f()}),(C,M)=>{var h,v,w;return n(),d("div",null,[(h=t.replyMsg)!=null&&h.messageClientId?(n(),d("div",Vt,[_.value?(n(),d("div",{key:1,class:"reply-msg",onClick:y},[c("div",kt,[M[1]||(M[1]=c("div",{class:"reply-msg-name-line"},"|",-1)),c("div",$t,E(s.value),1),M[2]||(M[2]=c("div",{class:"reply-msg-name-to"},":",-1))]),t.replyMsg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(n(),d("div",bt,[I(Ye,{text:t.replyMsg.text},null,8,["text"])])):t.replyMsg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE?(n(),d("div",Ot,[c("a",{class:"other-msg-wrapper-text",target:"_blank",rel:"noopener noreferrer",href:r,download:i(p),showUnderLine:!1},E(i(u)("fileMsgTitleText")),9,Pt)])):(n(),d("div",Rt,E("["+i(Le)[t.replyMsg.messageType]+"]"),1))])):(n(),d("div",wt,[c("span",null,E(i(u)("replyNotFindText")),1)]))])):V("",!0),o.value?(n(),d("div",{key:1,class:"reply-full-screen",onClick:y},[c("div",{class:"reply-message-close",onClick:O},[I(b,{color:"#929299",iconStyle:{fontWeight:"200"},size:18,type:"icon-guanbi"})]),t.replyMsg.messageType==i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(n(),d("div",xt,[I(Fe,{msg:C.replyMsg,fontSize:22},null,8,["msg"])])):((v=t.replyMsg)==null?void 0:v.messageType)==i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO?(n(),d("div",{key:1,class:"msg-common",style:F({flexDirection:t.replyMsg.isSelf?"row-reverse":"row",backgroundColor:t.replyMsg.isSelf?"#d6e5f6":"#e8eaed",borderRadius:t.replyMsg.isSelf?"8px 0px 8px 8px":"0 8px 8px"}),onClick:pe(()=>{},["stop"])},[I(ze,{msg:C.replyMsg},null,8,["msg"])],4)):((w=t.replyMsg)==null?void 0:w.messageType)==i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE?(n(),d("div",{key:2,class:"msg-common",onClick:M[0]||(M[0]=K=>{K.stopPropagation(),o.value=!1})},[I(Be,{visible:a.value,"image-url":g.value,onClose:()=>{a.value=!1}},null,8,["visible","image-url","onClose"])])):V("",!0)])):V("",!0)])}}}),Ut=B(Gt,[["__scopeId","data-v-e9bbd37d"]]),Lt=["download"],Yt={class:"msg-file-content"},Dt={class:"msg-file-title"},Ft={class:"msg-file-title-prefix"},zt={class:"msg-file-title-suffix"},Bt={class:"msg-file-size"},jt=j({__name:"message-file",props:{msg:{}},setup(T){const t=T,e={pdf:"icon-PPT",word:"icon-Word",excel:"icon-Excel",ppt:"icon-PPT",zip:"icon-RAR1",txt:"icon-qita",img:"icon-tupian2",audio:"icon-yinle",video:"icon-shipin"},{name:o="",url:s="",ext:a="",size:p=0}=t.msg.attachment||{},l=e[es(a)]||"icon-weizhiwenjian",r=o.lastIndexOf(".")>-1?o.lastIndexOf("."):o.length,_=o.slice(0,Math.max(r-5,0)),g=o.slice(Math.max(r-5,0)),f=s+(s.includes("?")?"&":"?")+`download=${o}`;return(y,O)=>(n(),d("a",{class:"msg-file-wrapper",target:"_blank",rel:"noopener noreferrer",href:f,download:i(o),showUnderLine:!1},[c("div",{class:te(y.msg.isSelf?"msg-file msg-file-out":"msg-file msg-file-in")},[I(b,{type:i(l),size:32},null,8,["type"]),c("div",Yt,[c("div",Dt,[c("div",Ft,E(i(_)),1),c("div",zt,E(i(g)),1)]),c("div",Bt,E(i(ss)(i(p))),1)])],2)],8,Lt))}}),Kt=B(jt,[["__scopeId","data-v-55c7f9ec"]]),Ht={key:0,class:"msg-noti"},Wt=j({__name:"message-notification",props:{msg:{}},setup(T){const t=T,{proxy:e}=oe(),o=t.msg.conversationType===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?t.msg.receiverId:"",s=A(""),a=Z(()=>{const p=()=>{const l=t.msg.attachment;switch(l==null?void 0:l.type){case m.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO:{const r=(l==null?void 0:l.updatedTeamInfo)||{},_=[];if(r.avatar!==void 0&&_.push(u("updateTeamAvatar")),r.name!==void 0&&_.push(`${u("updateTeamName")}“${r.name}”`),r.intro!==void 0&&_.push(u("updateTeamIntro")),r.inviteMode!==void 0&&_.push(`${u("updateTeamInviteMode")}“${r.inviteMode===m.V2NIMTeamInviteMode.V2NIM_TEAM_INVITE_MODE_ALL?u("teamAll"):u("teamOwnerAndManagerText")}”`),r.updateInfoMode!==void 0&&_.push(`${u("updateTeamUpdateTeamMode")}“${r.updateInfoMode===m.V2NIMTeamUpdateInfoMode.V2NIM_TEAM_UPDATE_INFO_MODE_ALL?u("teamAll"):u("teamOwnerAndManagerText")}”`),r.chatBannedMode!==void 0&&_.push(`${u("updateTeamMute")}${r.chatBannedMode===m.V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN?u("closeText"):u("openText")}`),r.serverExtension){let g={};try{g=JSON.parse(r.serverExtension)}catch{}g[Oe]!==void 0&&_.push(`${u("updateAllowAt")}“${g[Oe]==="manager"?u("teamOwnerAndManagerText"):u("teamAll")}”`)}return _.length?`${e==null?void 0:e.$UIKitStore.uiStore.getAppellation({account:t.msg.senderId,teamId:o})} ${_.join("、")}`:""}case m.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS:case m.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT:return`${e==null?void 0:e.$UIKitStore.uiStore.getAppellation({account:t.msg.senderId,teamId:o})} ${u("joinTeamText")}`;case m.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE:{const r=(l==null?void 0:l.targetIds)||[];return r.map(async g=>{await(e==null?void 0:e.$UIKitStore.userStore.getUserActive(g))}),`${r.map(g=>e==null?void 0:e.$UIKitStore.uiStore.getAppellation({account:g,teamId:o})).filter(g=>!!g).join("、")} ${u("joinTeamText")}`}case m.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK:{const r=(l==null?void 0:l.targetIds)||[];return r.map(async g=>{await(e==null?void 0:e.$UIKitStore.userStore.getUserActive(g))}),`${r.map(g=>e==null?void 0:e.$UIKitStore.uiStore.getAppellation({account:g,teamId:o})).filter(g=>!!g).join("、")} ${u("beRemoveTeamText")}`}case m.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER:{const r=(l==null?void 0:l.targetIds)||[];return r.map(async g=>{await(e==null?void 0:e.$UIKitStore.userStore.getUserActive(g))}),`${r.map(g=>e==null?void 0:e.$UIKitStore.uiStore.getAppellation({account:g,teamId:o})).filter(g=>!!g).join("、")} ${u("beAddTeamManagersText")}`}case m.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER:{const r=(l==null?void 0:l.targetIds)||[];return r.map(async g=>{await(e==null?void 0:e.$UIKitStore.userStore.getUserActive(g))}),`${r.map(g=>e==null?void 0:e.$UIKitStore.uiStore.getAppellation({account:g,teamId:o})).filter(g=>!!g).join("、")} ${u("beRemoveTeamManagersText")}`}case m.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE:return`${e==null?void 0:e.$UIKitStore.uiStore.getAppellation({account:t.msg.senderId,teamId:o})} ${u("leaveTeamText")}`;case m.V2NIMMessageNotificationType.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER:return`${e==null?void 0:e.$UIKitStore.uiStore.getAppellation({account:((l==null?void 0:l.targetIds)||[])[0],teamId:o})} ${u("newGroupOwnerText")}`;default:return""}};s.value=p()});return ne(()=>{a()}),(p,l)=>s.value?(n(),d("div",Ht,E(s.value),1)):V("",!0)}}),Xt=B(Wt,[["__scopeId","data-v-688c0712"]]),qt={class:"g2-message-wrapper"},Jt={class:"g2-message-status"},Qt={key:0,class:"g2-message-duration"},Zt=j({__name:"message-g2",props:{msg:{}},setup(T){var a,p,l,r;const t=T,e=Je((p=(a=t.msg.attachment)==null?void 0:a.durations[0])==null?void 0:p.duration),o=as[(l=t.msg.attachment)==null?void 0:l.status],s=((r=t.msg.attachment)==null?void 0:r.type)==1?"icon-yuyin8":"icon-shipin8";return(_,g)=>(n(),d("div",qt,[I(b,{type:i(s),size:28},null,8,["type"]),c("div",Jt,E(i(o)),1),i(e)?(n(),d("div",Qt,E(i(e)),1)):V("",!0)]))}}),eo=B(Zt,[["__scopeId","data-v-cf2600de"]]),so={key:0,class:"msg-read-wrapper"},to={key:0},oo={key:0,class:"icon-read-wrapper"},no={key:1,class:"sector"},ao={key:1},io={key:0,class:"icon-read-wrapper"},lo=j({__name:"message-read",props:{msg:{}},setup(T){var C;const t=T,e=Pe(),{proxy:o}=oe(),s=o==null?void 0:o.$UIKitStore,a=o==null?void 0:o.$NIM,p=s==null?void 0:s.localOptions.teamMsgReceiptVisible,l=s==null?void 0:s.localOptions.p2pMsgReceiptVisible,r=a.V2NIMConversationIdUtil.parseConversationType(t.msg.conversationId),_=A(0),g=(C=s==null?void 0:s.sdkOptions)==null?void 0:C.enableV2CloudConversation,f=()=>{var M,h,v;if(r===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P){const w=g?(M=s==null?void 0:s.conversationStore)==null?void 0:M.conversations.get(t.msg.conversationId):(h=s==null?void 0:s.localConversationStore)==null?void 0:h.conversations.get(t.msg.conversationId);_.value=((v=t==null?void 0:t.msg)==null?void 0:v.createTime)<=((w==null?void 0:w.msgReceiptTime)||0)?360:0}},y=Z(()=>{f()}),O=()=>{var M,h,v,w;if((s==null?void 0:s.connectStore.connectStatus)!==m.V2NIMConnectStatus.V2NIM_CONNECT_STATUS_CONNECTED){re({message:u("offlineText"),type:"info"});return}(M=t==null?void 0:t.msg)!=null&&M.messageClientId&&((h=t==null?void 0:t.msg)!=null&&h.conversationId)&&e.push({path:me.messageReadInfo,query:{messageClientId:(v=t==null?void 0:t.msg)==null?void 0:v.messageClientId,conversationId:(w=t==null?void 0:t.msg)==null?void 0:w.conversationId}})},k=H(()=>{var M,h,v;return r===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?((((M=t==null?void 0:t.msg)==null?void 0:M.yxRead)||0)/((((h=t==null?void 0:t.msg)==null?void 0:h.yxUnread)||0)+(((v=t==null?void 0:t.msg)==null?void 0:v.yxRead)||0))||0)*360:0});return de(()=>{f()}),ne(()=>{y()}),(M,h)=>t.msg.sendingState==i(m).V2NIMMessageSendingState.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED?(n(),d("div",so,[i(r)===i(m).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P&&i(l)?(n(),d("div",to,[_.value==360?(n(),d("div",oo,[I(b,{type:"icon-read",size:18})])):(n(),d("div",no,[c("span",{class:"cover-1",style:F(`transform: rotate(${_.value}deg)`)},null,4),c("span",{class:te(_.value>=180?"cover-2 cover-3":"cover-2")},null,2)]))])):V("",!0),i(r)===i(m).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&i(p)?(n(),d("div",ao,[k.value==360?(n(),d("div",io,[I(b,{type:"icon-read",size:18})])):(n(),d("div",{key:1,class:"sector",onClick:O},[c("span",{class:"cover-1",style:F(`transform: rotate(${k.value}deg)`)},null,4),c("span",{class:te(k.value>=180?"cover-2 cover-3":"cover-2")},null,2)]))])):V("",!0)])):V("",!0)}}),Me=B(lo,[["__scopeId","data-v-c2d704bd"]]),co=["id"],ro={key:0,class:"msg-time"},uo={class:"recall-text"},mo={class:"recall-text"},go={class:"msg-content"},po={key:0,class:"msg-name"},_o={class:"msg-recall2"},vo={class:"msg-content"},Mo={key:0,class:"msg-name"},To={class:"msg-content"},fo={key:0,class:"msg-name"},Io={key:0,class:"msg-image"},yo=["src"],ho={class:"msg-content"},So={key:0,class:"msg-name"},Eo=["src"],No={class:"msg-content"},Co={key:0,class:"msg-name"},Ao={class:"msg-content"},Vo={key:0,class:"msg-name"},wo={class:"msg-content"},ko={key:0,class:"msg-name"},$o={class:"msg-content"},bo={key:0,class:"msg-name"},Oo=j({__name:"message-item",props:{msg:{},index:{},replyMsgsMap:{},broadcastNewAudioSrc:{}},setup(T){var C;const t=A(!1),e=T,o=H(()=>e.replyMsgsMap&&e.replyMsgsMap[e.msg.messageClientId]),{proxy:s}=oe(),a=A("");(C=s==null?void 0:s.$UIKitStore.userStore)==null||C.myUserInfo.accountId;const p=s==null?void 0:s.$NIM.V2NIMConversationIdUtil.parseConversationType(e.msg.conversationId),l=s==null?void 0:s.$NIM.V2NIMConversationIdUtil.parseConversationTargetId(e.msg.conversationId),r=H(()=>{var h;const M=(h=e.msg.attachment)==null?void 0:h.url;return M?`${M}${M.includes("?")?"&":"?"}vframe=1`:""}),_=H(()=>{var M,h,v;return e.msg.messageStatus.errorCode==102426?"https://yx-web-nosdn.netease.im/common/c1f278b963b18667ecba4ee9a6e68047/img-fail.png":((h=(M=e.msg)==null?void 0:M.attachment)==null?void 0:h.url)||((v=e.msg.attachment)==null?void 0:v.file)}),g=M=>{M&&(t.value=!0)},f=M=>{var v;const h=(v=M.attachment)==null?void 0:v.url;h&&window.open(h,"_blank","noopener,noreferrer")},y=M=>{P.emit(R.ON_REEDIT_MSG,M)},O=Z(()=>{a.value=s==null?void 0:s.$UIKitStore.uiStore.getAppellation({account:e.msg.senderId,teamId:p===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?l:""})}),k=H(()=>p===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?l:"");return ne(()=>{O()}),(M,h)=>{var v,w,K,se,Q;return n(),d("div",{class:te(`msg-item-wrapper ${e.msg.pinState&&!(e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&e.msg.timeValue!==void 0)&&!e.msg.recallType?"msg-pin":""}`),id:i(ns)+e.msg.messageClientId,key:e.msg.createTime},[e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&e.msg.timeValue!==void 0?(n(),d("div",ro,E(e.msg.timeValue),1)):e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&e.msg.recallType==="reCallMsg"&&e.msg.canEdit?(n(),d("div",{key:1,class:"msg-common",style:F({flexDirection:e.msg.isSelf?"row-reverse":"row"})},[I(X,{account:e.msg.senderId,teamId:k.value,"goto-user-card":!0},null,8,["account","teamId"]),I(ie,{msg:e.msg,"bg-visible":!0},{default:L(()=>[c("span",uo,E(i(u)("recall2")),1),c("text",{class:"msg-recall-btn",onClick:h[0]||(h[0]=()=>{y(e.msg)})},E(i(u)("reeditText")),1)]),_:1},8,["msg"])],4)):e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&e.msg.recallType==="reCallMsg"&&!e.msg.canEdit?(n(),d("div",{key:2,class:"msg-common",style:F({flexDirection:e.msg.isSelf?"row-reverse":"row"})},[I(X,{account:e.msg.senderId,teamId:k.value,"goto-user-card":!0},null,8,["account","teamId"]),I(ie,{msg:e.msg,"bg-visible":!0},{default:L(()=>[c("div",mo,E(i(u)("you")+i(u)("recall")),1)]),_:1},8,["msg"])],4)):e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&e.msg.recallType==="beReCallMsg"?(n(),d("div",{key:3,class:"msg-common",style:F({flexDirection:e.msg.isSelf?"row-reverse":"row"})},[I(X,{account:e.msg.senderId,teamId:k.value,"goto-user-card":!0},null,8,["account","teamId"]),c("div",go,[e.msg.isSelf?V("",!0):(n(),d("div",po,E(a.value),1)),c("div",{class:te(e.msg.isSelf?"self-msg-recall":"msg-recall")},[c("text",_o,E(e.msg.isSelf?`${i(u)("you")+i(u)("recall")}`:i(u)("recall2")),1)],2)])],4)):e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(n(),d("div",{key:4,class:"msg-common",style:F({flexDirection:e.msg.isSelf?"row-reverse":"row"})},[I(X,{account:e.msg.senderId,teamId:k.value,"goto-user-card":!0},null,8,["account","teamId"]),c("div",vo,[e.msg.isSelf?V("",!0):(n(),d("div",Mo,E(a.value),1)),I(ie,{msg:e.msg,"tooltip-visible":!0,"bg-visible":!0},{default:L(()=>[o.value?(n(),z(Ut,{key:0,replyMsg:o.value},null,8,["replyMsg"])):V("",!0),I(Fe,{msg:e.msg},null,8,["msg"])]),_:1},8,["msg"])]),(v=e.msg)!=null&&v.isSelf?(n(),z(Me,{key:0,msg:e.msg},null,8,["msg"])):V("",!0)],4)):e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_IMAGE?(n(),d("div",{key:5,class:"msg-common",style:F({flexDirection:e.msg.isSelf?"row-reverse":"row"})},[I(X,{account:e.msg.senderId,teamId:k.value,"goto-user-card":!0},null,8,["account","teamId"]),c("div",To,[e.msg.isSelf?V("",!0):(n(),d("div",fo,E(a.value),1)),I(ie,{msg:e.msg,"tooltip-visible":!0,"bg-visible":!0},{default:L(()=>[c("div",{onClick:h[1]||(h[1]=()=>{g(e.msg.attachment.url)})},[e.msg.sendingState==i(m).V2NIMMessageSendingState.V2NIM_MESSAGE_SENDING_STATE_SENDING?(n(),d("div",Io,h[3]||(h[3]=[c("div",{class:"loading-spinner"},null,-1)]))):(n(),d("img",{key:1,class:"msg-image","lazy-load":!0,mode:"aspectFill",src:_.value},null,8,yo))])]),_:1},8,["msg"]),I(Be,{visible:t.value,"image-url":_.value,onClose:()=>{t.value=!1}},null,8,["visible","image-url","onClose"])]),(w=e.msg)!=null&&w.isSelf?(n(),z(Me,{key:0,msg:e.msg},null,8,["msg"])):V("",!0)],4)):e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_VIDEO?(n(),d("div",{key:6,class:"msg-common",style:F({flexDirection:e.msg.isSelf?"row-reverse":"row"})},[I(X,{account:e.msg.senderId,teamId:k.value,"goto-user-card":!0},null,8,["account","teamId"]),c("div",ho,[e.msg.isSelf?V("",!0):(n(),d("div",So,E(a.value),1)),I(ie,{msg:e.msg,"tooltip-visible":!0,"bg-visible":!0,style:{cursor:"pointer"}},{default:L(()=>[c("div",{class:"video-msg-wrapper",onClick:h[2]||(h[2]=()=>f(e.msg))},[h[4]||(h[4]=c("div",{class:"video-play-button"},[c("div",{class:"video-play-icon"})],-1)),c("img",{class:"msg-image","lazy-load":!0,mode:"aspectFill",src:r.value},null,8,Eo)])]),_:1},8,["msg"])]),(K=e.msg)!=null&&K.isSelf?(n(),z(Me,{key:0,msg:e.msg},null,8,["msg"])):V("",!0)],4)):e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_CALL?(n(),d("div",{key:7,class:"msg-common",style:F({flexDirection:e.msg.isSelf?"row-reverse":"row"})},[I(X,{account:e.msg.senderId,teamId:k.value,"goto-user-card":!0},null,8,["account","teamId"]),c("div",No,[e.msg.isSelf?V("",!0):(n(),d("div",Co,E(a.value),1)),I(ie,{msg:e.msg,"tooltip-visible":!0,"bg-visible":!0},{default:L(()=>[I(eo,{msg:e.msg},null,8,["msg"])]),_:1},8,["msg"])])],4)):e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_FILE?(n(),d("div",{key:8,class:"msg-common",style:F({flexDirection:e.msg.isSelf?"row-reverse":"row"})},[I(X,{account:e.msg.senderId,teamId:k.value,"goto-user-card":!0},null,8,["account","teamId"]),c("div",Ao,[e.msg.isSelf?V("",!0):(n(),d("div",Vo,E(a.value),1)),I(ie,{msg:e.msg,"tooltip-visible":!0,"bg-visible":!1},{default:L(()=>[I(Kt,{msg:e.msg},null,8,["msg"])]),_:1},8,["msg"])]),(se=e.msg)!=null&&se.isSelf?(n(),z(Me,{key:0,msg:e.msg},null,8,["msg"])):V("",!0)],4)):e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_AUDIO?(n(),d("div",{key:9,class:"msg-common",style:F({flexDirection:e.msg.isSelf?"row-reverse":"row"})},[I(X,{account:e.msg.senderId,teamId:k.value,"goto-user-card":!0},null,8,["account","teamId"]),c("div",wo,[e.msg.isSelf?V("",!0):(n(),d("div",ko,E(a.value),1)),I(ie,{msg:e.msg,"tooltip-visible":!0,"bg-visible":!0,style:{cursor:"pointer"}},{default:L(()=>[I(ze,{msg:e.msg,broadcastNewAudioSrc:M.broadcastNewAudioSrc},null,8,["msg","broadcastNewAudioSrc"])]),_:1},8,["msg"])]),(Q=e.msg)!=null&&Q.isSelf?(n(),z(Me,{key:0,msg:e.msg},null,8,["msg"])):V("",!0)],4)):e.msg.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_NOTIFICATION?(n(),z(Xt,{key:10,msg:e.msg},null,8,["msg"])):(n(),d("div",{key:11,class:"msg-common",style:F({flexDirection:e.msg.isSelf?"row-reverse":"row"})},[I(X,{account:e.msg.senderId,teamId:k.value,"goto-user-card":!0},null,8,["account","teamId"]),c("div",$o,[e.msg.isSelf?V("",!0):(n(),d("div",bo,E(a.value),1)),I(ie,{msg:e.msg,"tooltip-visible":!0,"bg-visible":!0},{default:L(()=>[Se(" ["+E(i(u)("unknowMsgText"))+"] ",1)]),_:1},8,["msg"])])],4))],10,co)}}}),Po=B(Oo,[["__scopeId","data-v-59c7a423"]]);function Ro(T){const p=new Date().getTime()-T;let l="";if(p<0)return u("nowText");const r=Math.floor(p/6e4),_=Math.floor(p/36e5),g=Math.floor(p/864e5),f=Math.floor(p/6048e5);if(f>=1&&f<=4)l=` ${f}${u("weekText")}`;else if(g>=1&&g<=6)l=` ${g}${u("dayText")}`;else if(_>=1&&_<=23)l=` ${_}${u("hourText")}`;else if(r>=1&&r<=59)l=` ${r}${u("minuteText")}`;else if(p>=0&&p<=6e4)l=u("nowText");else{const y=new Date;y.setTime(T);const O=y.getFullYear(),k=y.getMonth()+1<10?`0${y.getMonth()+1}`:y.getMonth()+1,C=y.getDate()<10?`0${y.getDate()}`:y.getDate();l=`${O}-${k}-${C}`}return l}const xo=["scroll-top"],Go=j({__name:"message-list",props:{msgs:{},conversationType:{},to:{},loadingMore:{type:Boolean},noMore:{type:Boolean},replyMsgsMap:{}},setup(T){const t=T,{proxy:e}=oe(),o=A(null);He(()=>{let g;Z(()=>{g=e==null?void 0:e.$UIKitStore.teamStore.teams.get(t.to)}),t.conversationType===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&(e==null||e.$UIKitStore.teamMemberStore.getTeamMemberActive({teamId:t.to,queryOption:{limit:Math.max((g==null?void 0:g.memberLimit)||0,200),roleQueryType:0}})),P.on(R.AUDIO_URL_CHANGE,f=>{p.value=f}),P.on(R.ON_LOAD_MORE,()=>{const f=a.value.filter(y=>!(y.messageType===m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&["beReCallMsg","reCallMsg"].includes(y.recallType||"")))[0];f&&P.emit(R.GET_HISTORY_MSG,f)})}),de(()=>{P.on(R.ON_SCROLL_BOTTOM,l);let g=setTimeout(()=>{l(),clearTimeout(g)},100)}),ne(()=>{P.off(R.ON_SCROLL_BOTTOM,l),P.off(R.ON_LOAD_MORE),P.off(R.AUDIO_URL_CHANGE)});const s=A(0),a=H(()=>{const g=[];return t.msgs.forEach((f,y)=>{y>0&&f.createTime-t.msgs[y-1].createTime>5*60*1e3&&g.push({...f,messageClientId:"time-"+f.createTime,messageType:m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM,sendingState:m.V2NIMMessageSendingState.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED,timeValue:Ro(f.createTime),renderKey:`${f.createTime+1}`}),g.push({...f,renderKey:`${f.createTime}`})}),g}),p=A(""),l=()=>{Ae(()=>{o.value&&(o.value.scrollTop=o.value.scrollHeight)})},r=()=>{const g=a.value.filter(f=>!(f.messageType===m.V2NIMMessageType.V2NIM_MESSAGE_TYPE_CUSTOM&&["beReCallMsg","reCallMsg"].includes(f.recallType||"")))[0];P.emit(R.GET_HISTORY_MSG,g)},_=()=>{const g=document.activeElement;g&&g.tagName==="INPUT"&&g.blur(),P.emit(R.CLOSE_PANEL)};return(g,f)=>(n(),d("div",{class:"msg-list-wrapper",onTouchstart:_},[c("div",{id:"message-scroll-list","scroll-y":"true","scroll-top":s.value,class:"message-scroll-list",ref_key:"messageListRef",ref:o},[Te(c("div",{onClick:r,class:"view-more-text"},E(i(u)("viewMoreText")),513),[[fe,!g.noMore]]),Te(c("div",{class:"msg-tip"},E(i(u)("noMoreText")),513),[[fe,g.noMore]]),(n(!0),d(ee,null,ue(a.value,(y,O)=>(n(),d("div",{key:y.messageClientId},[(n(),z(Po,{msg:y,index:O,key:y.messageClientId,"reply-msgs-map":g.replyMsgsMap,broadcastNewAudioSrc:p.value},null,8,["msg","index","reply-msgs-map","broadcastNewAudioSrc"]))]))),128))],8,xo)],32))}}),Uo=B(Go,[["__scopeId","data-v-4a5ce2f0"]]),Lo=(T,t)=>{const e=T.length,o=Math.ceil(e/t);let s=0,a=0;const p=[];for(;s<=e&&a<o;)p[a]=T.slice(s,s+t),s+=t,a++;return p},Yo={class:"msg-face-wrapper"},Do={class:"msg-face"},Fo={class:"msg-face-row"},zo=["onClick"],Bo={class:"msg-face-control"},ye=7,jo=j({__name:"face",emits:["emojiClick","emojiSend","emojiDelete"],setup(T,{emit:t}){const e=Object.keys(he),o=Lo(e,ye),s=t,a=r=>{s("emojiClick",r)},p=()=>{s("emojiDelete")},l=()=>{s("emojiSend")};return(r,_)=>(n(),d("div",Yo,[c("div",Do,[(n(!0),d(ee,null,ue(i(o),(g,f)=>(n(),d("div",Fo,[(n(!0),d(ee,null,ue(g,y=>(n(),d("div",{onClick:()=>{a({key:y,type:i(he)[y]})},key:y,class:"msg-face-item"},[I(b,{size:27,type:i(he)[y]},null,8,["type"])],8,zo))),128)),f+1===Math.ceil(i(e).length/ye)?(n(),z(b,{key:0,class:"msg-face-delete",size:27,type:"icon-tuigejian"})):V("",!0),f+1===Math.ceil(i(e).length/ye)?(n(),z(b,{key:1,class:"msg-face-delete",size:27,type:"icon-tuigejian"})):V("",!0),f+1===Math.ceil(i(e).length/ye)?(n(),z(b,{key:2,class:"msg-face-delete",size:27,type:"icon-tuigejian"})):V("",!0)]))),256))]),_[0]||(_[0]=c("div",{class:"emoji-block"},null,-1)),c("div",Bo,[c("div",{onClick:p,class:"msg-delete-btn"},[I(b,{type:"icon-tuigejian",size:25,color:"#000"})]),c("div",{onClick:l,class:"msg-send-btn"},E(i(u)("sendText")),1)])]))}}),Ko=B(jo,[["__scopeId","data-v-897cbe13"]]),Ho={class:"input-root"},Wo={key:0,class:"reply-message-wrapper"},Xo={class:"reply-title"},qo={key:0,class:"reply-to"},Jo={key:1,class:"reply-noFind"},Qo={key:2,class:"reply-message"},Zo={key:1},en={class:"msg-input-wrapper"},sn={class:"input-inner"},tn={key:0,class:"input-text"},on={key:1,class:"input-placeholder"},nn={class:"send-more-panel-item-wrapper"},an={class:"send-more-panel-item"},ln={class:"icon-text"},cn=j({__name:"message-input",props:{conversationType:{},to:{},replyMsgsMap:{}},setup(T){const{proxy:t}=oe(),e=t==null?void 0:t.$UIKitStore,o=T,s=o.conversationType===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P?t==null?void 0:t.$NIM.V2NIMConversationIdUtil.p2pConversationId(o.to):t==null?void 0:t.$NIM.V2NIMConversationIdUtil.teamConversationId(o.to),a=A(""),p=A(!1),l=A(!1);H(()=>!p.value);const r=A(!1),_=A(!1),g=A(!1),f=A(),y=A(),O=A([]),k=A(m.V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN),C=A(!1),M=A(!1),h=A(!1),v=()=>{if(k.value===m.V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN){h.value=!1;return}if(C.value||M.value){h.value=!1;return}h.value=!0},w=()=>{g.value=!0},K=()=>{r.value=!1,l.value=!1,p.value=!1;const N=setTimeout(()=>{Ae(()=>{try{const $=document.getElementById("msg-input");$==null||$.focus()}catch($){console.log("error",$)}clearTimeout(N)})},100)},se=()=>{g.value=!1},Q=()=>{P.emit(R.ON_SCROLL_BOTTOM)},ae=()=>{if(a.value.trim()==="")return;let N=Qe(a.value);const $=t==null?void 0:t.$NIM.V2NIMMessageCreator.createTextMessage(N);e==null||e.msgStore.sendMessageActive({msg:$,conversationId:s,sendBefore:()=>{Q()}}).catch(()=>{ge.info(u("sendMsgFailedText"))}).finally(()=>{P.emit(R.ON_SCROLL_BOTTOM)}),a.value="",_.value=!1},le=()=>{var N;e==null||e.msgStore.removeReplyMsgActive((N=f==null?void 0:f.value)==null?void 0:N.conversationId),_.value=!1},_e=()=>{h.value||(l.value=!0,r.value=!0,p.value=!1,P.emit(R.ON_SCROLL_BOTTOM))},ve=N=>{a.value+=N.key},Y=()=>{let N="";Object.keys(he).reduce((U,W)=>{const ce=a.value.endsWith(W);return ce&&(N=W),U||ce},!1)&&N?a.value=a.value.replace(N,""):a.value=a.value.slice(0,-1)},D=()=>{h.value||(l.value=!1,p.value=!p.value,r.value=!0,P.emit(R.ON_SCROLL_BOTTOM))},S=A(null),G=()=>{var N;h.value||(N=S.value)==null||N.click()},x=async N=>{var W;const U=(W=N.target.files)==null?void 0:W[0];if(U){if(!U.type.startsWith("image/")){ge.info(u("selectImageText"));return}try{const ce=t==null?void 0:t.$NIM.V2NIMMessageCreator.createImageMessage(U);await(e==null?void 0:e.msgStore.sendMessageActive({msg:ce,conversationId:s,progress:()=>!0,sendBefore:()=>{Q()}})),Q()}catch{Q(),ge.info(u("sendImageFailedText"))}finally{S.value&&(S.value.value="")}}};let q=()=>{};return de(()=>{q=Z(()=>{if(o.conversationType===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM){const N=e==null?void 0:e.teamStore.teams.get(o.to);O.value=e==null?void 0:e.teamMemberStore.getTeamMember(o.to);const $=e==null?void 0:e.userStore.myUserInfo;C.value=(N==null?void 0:N.ownerAccountId)==($==null?void 0:$.accountId),M.value=O.value.filter(U=>U.memberRole===m.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER).some(U=>U.accountId===($?$.accountId:"")),y.value=N,N&&(k.value=N.chatBannedMode),v()}}),P.on(R.ON_REEDIT_MSG,N=>{var W;const $=N,U=(W=o.replyMsgsMap)==null?void 0:W[$.messageClientId];f.value=void 0,_.value=!1,e==null||e.msgStore.removeReplyMsgActive($.conversationId),U!=null&&U.messageClientId&&(U&&(e==null||e.msgStore.replyMsgActive(U)),f.value=U,_.value=!0),a.value=($==null?void 0:$.oldText)||"",g.value=!0}),P.on(R.REPLY_MSG,N=>{_.value=!0,g.value=!0,f.value=N}),P.on(R.CLOSE_PANEL,()=>{l.value=!1,p.value=!1})}),ne(()=>{le(),q()}),(N,$)=>{var U;return n(),d("div",Ho,[_.value?(n(),d("div",Wo,[c("div",{class:"reply-message-close",onClick:le},[I(b,{color:"#929299",iconStyle:{fontWeight:"200"},size:13,type:"icon-guanbi"})]),$[1]||($[1]=c("div",{class:"reply-line"},"｜",-1)),c("div",Xo,E(i(u)("replyText")),1),f.value?(n(),d("div",qo,[I(Re,{account:f.value.senderId,"team-id":o.conversationType===i(m).V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM?N.to:"",color:"#929299",fontSize:13},null,8,["account","team-id"])])):V("",!0),$[2]||($[2]=c("div",{class:"reply-to-colon"},":",-1)),f.value&&f.value.messageClientId==="noFind"?(n(),d("div",Jo,E(i(u)("replyNotFindText")),1)):(n(),d("div",Qo,[f.value&&f.value.messageType===i(m).V2NIMMessageType.V2NIM_MESSAGE_TYPE_TEXT?(n(),z(Ye,{key:0,text:f.value.text},null,8,["text"])):(n(),d("div",Zo,E((U=f.value)!=null&&U.messageType?`[${i(Le)[f.value.messageType]||"Unsupported Type"}]`:"[Unknown]"),1))]))])):V("",!0),c("div",en,[c("div",{class:"input-emoji-icon",onClick:_e},[I(b,{size:24,type:"icon-biaoqing"})]),c("div",sn,[Te(c("div",{onClick:K,class:"fake-input"},[a.value?(n(),d("div",tn,E(a.value),1)):(n(),d("div",on,E(h.value?i(u)("teamMutePlaceholder"):i(u)("chatInputPlaceHolder")),1))],512),[[fe,r.value]]),Te(I(xe,{id:"msg-input",class:"msg-input-input",placeholder:h.value?i(u)("teamMutePlaceholder"):i(u)("chatInputPlaceHolder"),modelValue:a.value,"onUpdate:modelValue":$[0]||($[0]=W=>a.value=W),disabled:h.value,"confirm-hold":!0,"cursor-spacing":"20","adjust-position":"true","confirm-type":"send",inputStyle:{padding:"0 10px"},onConfirm:ae,onBlur:se,onFocus:w},null,8,["placeholder","modelValue","disabled"]),[[fe,!r.value]])]),c("div",{onClick:D,class:"input-send-more"},[I(b,{type:"send-more",size:24})])]),l.value?(n(),d("div",{key:1,class:"msg-emoji-panel",onClick:pe(()=>{},["stop"])},[I(Ko,{onEmojiClick:ve,onEmojiDelete:Y,onEmojiSend:ae})])):V("",!0),p.value?(n(),d("div",{key:2,class:"send-more-panel",onClick:pe(()=>{},["stop"])},[c("div",nn,[c("div",an,[c("input",{type:"file",ref_key:"imageInput",ref:S,accept:"image/*",class:"file-input-overlay",onChange:x},null,544),I(b,{onClick:G,size:26,type:"icon-tupian"})]),c("div",ln,E(i(u)("albumText")),1)])])):V("",!0)])}}}),rn=B(cn,[["__scopeId","data-v-9a3ca045"]]),dn={class:"msg-page-wrapper-h5"},un={class:"msg-alert"},mn=j({__name:"index",setup(T){const t=A(""),e=Pe(),{proxy:o}=oe(),s=o==null?void 0:o.$UIKitStore,a=o==null?void 0:o.$NIM,p=s==null?void 0:s.uiStore.selectedConversation,l=o==null?void 0:o.$NIM.V2NIMConversationIdUtil.parseConversationType(p),r=o==null?void 0:o.$NIM.V2NIMConversationIdUtil.parseConversationTargetId(p);je("ChatUIKit",a.options.appkey);const _=()=>{e.push(me.conversation)},g=s==null?void 0:s.localOptions.teamMsgReceiptVisible,f=s==null?void 0:s.localOptions.p2pMsgReceiptVisible;let y=!1;const O=A(!1),k=A(!1),C=A([]),M=A(),h=S=>{S.teamId===r&&Ce({content:u("onDismissTeamText"),title:u("tipText"),onCancel:()=>{_()},onConfirm:()=>{_()}})},v=()=>{l===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P?e.push({path:me.p2pSetting,query:{accountId:r}}):l===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&e.push({path:me.teamSetting,query:{teamId:r}})},w=S=>{re({message:u("onRemoveTeamText"),type:"info",duration:1e3}),_()},K=S=>{var x;const G=e.currentRoute.value.path;S.length&&!((x=S[0])!=null&&x.isSelf)&&S[0].conversationId==p&&G===me.chat&&se(S),P.emit(R.ON_SCROLL_BOTTOM)},se=S=>{S[0].conversationType===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P&&f?s==null||s.msgStore.sendMsgReceiptActive(S[0]):S[0].conversationType===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&g&&(s==null||s.msgStore.sendTeamMsgReceiptActive(S))},Q=S=>{if(l===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P&&f){const G=o==null?void 0:o.$NIM.V2NIMLoginService.getLoginUser(),x=S.filter(q=>!["beReCallMsg","reCallMsg"].includes(q.recallType||"")).filter(q=>q.senderId!==G);x.length>0&&(s==null||s.msgStore.sendMsgReceiptActive(x==null?void 0:x[0]))}else if(l===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM&&g){const G=o==null?void 0:o.$NIM.V2NIMLoginService.getLoginUser(),x=S.filter(N=>!["beReCallMsg","reCallMsg"].includes(N.recallType||"")).filter(N=>N.senderId===G);s==null||s.msgStore.getTeamMsgReadsActive(x,p);const q=S.filter(N=>!["beReCallMsg","reCallMsg"].includes(N.recallType||"")).filter(N=>N.senderId!==G);q.length>0&&q.length<50&&(s==null||s.msgStore.sendTeamMsgReceiptActive(q))}},ae=async(S,G)=>{try{if(k.value)return[];if(O.value)return[];if(O.value=!0,p){const x=await(s==null?void 0:s.msgStore.getHistoryMsgActive({conversationId:p,endTime:S,lastMsgId:G,limit:be}));if(O.value=!1,x!=null&&x.length)return x.length<be&&(k.value=!0),Q(x),x;k.value=!0}}catch(x){throw O.value=!1,x}},le=S=>{S?ae(S.createTime,S.messageServerId):ae(Date.now())},_e=Z(()=>{if(l===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P)t.value=s==null?void 0:s.uiStore.getAppellation({account:r});else if(l===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM){const S=s==null?void 0:s.teamStore.teams.get(r),G=`(${(S==null?void 0:S.memberCount)||0})`;t.value=((S==null?void 0:S.name)||"")+G}}),ve=Z(()=>{(s==null?void 0:s.connectStore.connectStatus)===m.V2NIMConnectStatus.V2NIM_CONNECT_STATUS_CONNECTED&&(s==null?void 0:s.connectStore.loginStatus)==m.V2NIMLoginStatus.V2NIM_LOGIN_STATUS_LOGINED&&ae(Date.now()).then(()=>{y||Ae(()=>{P.emit(R.ON_SCROLL_BOTTOM),y=!0})})}),Y=Z(()=>{const S=(s==null?void 0:s.msgStore.getMsg(p))||[];if(C.value=S||[],S.length!==0){const G={},x=[],q={};C.value.forEach(N=>{if(N.serverExtension)try{const{yxReplyMsg:$}=JSON.parse(N.serverExtension);if($){const U=C.value.find(W=>W.messageClientId===$.idClient);if(U)G[N.messageClientId]=U;else{G[N.messageClientId]={messageClientId:"noFind"};const{scene:W,from:ce,to:Ve,idServer:Ee,messageClientId:we,time:ke,receiverId:$e}=$;W&&ce&&Ve&&Ee&&we&&ke&&$e&&(x.push({scene:W,from:ce,to:Ve,idServer:Ee,messageClientId:we,time:ke,receiverId:$e}),q[Ee]=N.messageClientId)}}}catch{}}),x.length>0?o==null||o.$NIM.V2NIMMessageService.getMessageListByRefers(x.map(N=>({senderId:N.from,receiverId:N.receiverId,messageClientId:N.messageClientId,messageServerId:N.idServer,createTime:N.time,conversationType:N.scene,conversationId:N.to}))).then(N=>{(N==null?void 0:N.length)>0&&N.forEach($=>{$.messageServerId&&(G[q[$.messageServerId]]=$)}),M.value={...G}}).catch(()=>{M.value={...G}}):M.value={...G}}S.length<6}),D=()=>{if(l===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P)t.value=s==null?void 0:s.uiStore.getAppellation({account:r});else if(l===m.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM){const S=s==null?void 0:s.teamStore.teams.get(r),G=`(${(S==null?void 0:S.memberCount)||0})`;t.value=((S==null?void 0:S.name)||"")+G}};return de(()=>{if(D(),C.value.length){const S=[...C.value].reverse();Q(S)}o==null||o.$NIM.V2NIMMessageService.on("onReceiveMessages",K),o==null||o.$NIM.V2NIMTeamService.on("onTeamDismissed",h),o==null||o.$NIM.V2NIMTeamService.on("onTeamLeft",w),P.on(R.GET_HISTORY_MSG,le)}),ne(()=>{o==null||o.$NIM.V2NIMTeamService.off("onTeamDismissed",h),o==null||o.$NIM.V2NIMTeamService.off("onTeamLeft",w),o==null||o.$NIM.V2NIMMessageService.off("onReceiveMessages",K),P.off(R.GET_HISTORY_MSG,le),ve(),Y(),_e()}),(S,G)=>(n(),d("div",dn,[I(Xe,{title:t.value,showLeft:!0},{left:L(()=>[c("div",{onClick:_},[I(b,{type:"icon-zuojiantou",size:24})])]),right:L(()=>[c("div",{onClick:v},[I(b,{type:"icon-More",size:24})])]),_:1},8,["title"]),c("div",un,[I(We)]),I(Uo,{conversationType:i(l),to:i(r),msgs:C.value,"loading-more":O.value,"no-more":k.value,"reply-msgs-map":M.value},null,8,["conversationType","to","msgs","loading-more","no-more","reply-msgs-map"]),I(rn,{"reply-msgs-map":M.value,"conversation-type":i(l),to:i(r)},null,8,["reply-msgs-map","conversation-type","to"])]))}}),gn=B(mn,[["__scopeId","data-v-e80a2de9"]]),Vn=j({__name:"ChatPage",setup(T){return(t,e)=>(n(),z(gn))}});export{Vn as default};

import{f as E,i as F,C as M,j as C,c as o,o as r,a as m,m as p,t as g,y as x,B as P,e as _,_ as R,h as A,p as U,s as b,q as L,g as V,u as y,F as O,z,k as D}from"./index-DyncoFNp.js";import{N as Y}from"./NavBar-BSxUZM35.js";import{I as B}from"./Icon-XsD-7neM.js";import{s as j}from"./toast-DSCwmRst.js";import{A as q}from"./Avatar-BvJYmT9C.js";import{A as W}from"./Appellation-5sErKFFL.js";import{E as G}from"./Empty-Dhm7Ynwu.js";import{I as H}from"./Input-BrAf66hy.js";const J={class:"result-item-avatar"},Q={key:0,class:"result-item-title"},X={class:"result-item-account"},Z={key:1,class:"result-item-title"},ee=E({__name:"search-result-item",props:{item:{}},setup(k){var n;const s=k,{proxy:a}=F(),l=a==null?void 0:a.$UIKitStore,c=M(),d=C(()=>{if(s.item.teamId)return s.item.avatar}),f=C(()=>s.item.teamId?s.item.teamId:s.item.accountId),h=C(()=>!!s.item.teamId),S=C(()=>s.item.teamId?s.item.name:"");let I=!1;const T=(n=l==null?void 0:l.sdkOptions)==null?void 0:n.enableV2CloudConversation,N=async()=>{var u,e;if(!I)try{I=!0;let t,v,i=s.item;if(i.accountId)t=x.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_P2P,v=i.accountId;else if(i.teamId)t=x.V2NIMConversationType.V2NIM_CONVERSATION_TYPE_TEAM,v=i.teamId;else throw Error("unknow scene");T?await((u=l.conversationStore)==null?void 0:u.insertConversationActive(t,v)):await((e=l==null?void 0:l.localConversationStore)==null?void 0:e.insertConversationActive(t,v)),c.push(P.chat)}catch{j({message:_("selectSessionFailText"),type:"info"})}finally{I=!1}};return(u,e)=>(r(),o("div",{class:"search-result-list-item",onClick:N},[m("div",J,[p(q,{account:f.value,avatar:d.value},null,8,["account","avatar"])]),h.value?(r(),o("div",Z,g(S.value),1)):(r(),o("div",Q,[p(W,{account:f.value},null,8,["account"]),m("div",X,g(f.value),1)]))]))}}),te=R(ee,[["__scopeId","data-v-a86b1181"]]),se={class:"search-page-wrapper"},ae={class:"search-wrapper"},ne={class:"search-input-wrapper"},re={class:"search-icon-wrapper"},oe={key:0,class:"search-result-wrapper"},ce={class:"search-result-list"},ie={key:0,class:"result-title"},le={key:1,class:"result-title"},ue={key:2},de={key:1},pe=E({__name:"index",setup(k){const s=A(!1),a=A(""),l=A([]),{proxy:c}=F(),d=c==null?void 0:c.$UIKitStore,f=U(()=>{const n=(d==null?void 0:d.uiStore.friends.filter(e=>!(c!=null&&c.$UIKitStore.relationStore.blacklist.includes(e.accountId))).map(e=>{const t=(c==null?void 0:c.$UIKitStore.userStore.users.get(e.accountId))||{accountId:"",name:"",createTime:Date.now()};return{...e,...t}}))||[],u=(d==null?void 0:d.uiStore.teamList)||[];l.value=[{id:"friends",list:n},{id:"groups",list:u}].filter(e=>!!e.list.length)}),h=C(()=>{const n=[];return a.value&&l.value.map(e=>{var t,v;return e.id==="friends"?{...e,list:(t=e.list)==null?void 0:t.filter(i=>{var w,$,K;return((w=i.alias)==null?void 0:w.includes(a.value))||(($=i.name)==null?void 0:$.includes(a.value))||((K=i.accountId)==null?void 0:K.includes(a.value))})}:e.id==="groups"?{...e,list:(v=e.list)==null?void 0:v.filter(i=>(i.name||i.teamId).includes(a.value))}:{...e}}).filter(e=>{var t;return!!((t=e.list)!=null&&t.length)}).forEach(e=>{e.id==="friends"?(n.push({title:"friends",renderKey:"friends"}),e.list.forEach(t=>{n.push({...t,renderKey:t.accountId})})):e.id==="groups"&&(n.push({title:"groups",renderKey:"groups"}),e.list.forEach(t=>{n.push({...t,renderKey:t.teamId})}))}),n}),S=()=>{s.value=!1},I=()=>{s.value=!0},T=n=>{a.value=n},N=()=>{s.value=!0,a.value=""};return b(()=>{s.value=!0}),L(()=>{f()}),(n,u)=>(r(),o("div",se,[p(Y,{title:y(_)("searchTitleText")},null,8,["title"]),m("div",ae,[m("div",ne,[m("div",re,[p(B,{iconClassName:"search-icon",size:16,color:"#A6ADB6",type:"icon-sousuo"})]),p(H,{class:"input",modelValue:a.value,inputStyle:{backgroundColor:"#F5F7FA"},focus:s.value,onInput:T,onFocus:I,onBlur:S,placeholder:y(_)("searchText")},null,8,["modelValue","focus","placeholder"]),a.value?(r(),o("div",{key:0,class:"clear-icon",onClick:u[0]||(u[0]=e=>N())},[p(B,{type:"icon-shandiao",size:16})])):V("",!0)])]),h.value.length>0?(r(),o("div",oe,[m("div",ce,[(r(!0),o(O,null,z(h.value,e=>(r(),o("div",{key:e.renderKey},[e.title=="friends"?(r(),o("div",ie,g(y(_)("friendText")),1)):e.title=="groups"?(r(),o("div",le,g(y(_)("teamText")),1)):(r(),o("div",ue,[p(te,{item:e},null,8,["item"])]))]))),128))])])):V("",!0),h.value.length==0&&a.value?(r(),o("div",de,[p(G,{text:y(_)("searchResultNullText")},null,8,["text"])])):V("",!0)]))}}),ve=R(pe,[["__scopeId","data-v-2631ee4d"]]),ke=E({__name:"ConversationSearchPage",setup(k){return(s,a)=>(r(),D(ve))}});export{ke as default};

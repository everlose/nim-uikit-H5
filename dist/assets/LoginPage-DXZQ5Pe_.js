import{f as y,h,j as F,c as g,a as n,g as R,x as M,r as T,m as C,t as v,o as m,_ as k,N as x,F as V,z as j,u as b,l as I,C as U,O as D,i as A,B as q,s as J,q as K,w as N,v as $,k as W}from"./index-DyncoFNp.js";import{I as z}from"./Input-BrAf66hy.js";import{s as _}from"./toast-DSCwmRst.js";import{e as S}from"./eventBus-E5P-NQ8u.js";const l={loginTips:"未注册的手机号验证码通过后将自动注册",mobilePlaceholder:"请输入手机号",smsCodePlaceholder:"请输入验证码",loginBtnTitle:"登录",loginTitle:"验证码登录",smsCodeBtnTitle:"获取验证码",smsCodeBtnTitleCount:"秒后重新获取",mobileErrorMsg:"请输入正确的手机号",smsErrorMsg:"请输入正确验证码",mobileOrSmsCodeErrorMsg:"手机号或验证码错误",smsCodeFailMsg:"验证码获取失败",loginFailMsg:"登录失败",smsCodeNetworkErrorMsg:"获取失败，当前网络不可用，请检查你的网络设置",loginNetworkErrorMsg:"登陆失败，当前网络不可用，请检查你的网络设置"},P="https://yiyong-user-center.netease.im",L={appKey:"3e215d27b6a6a9e27dad7ef36dd5b65c",parentScope:2,scope:7},O={getLoginSmsCode:"/userCenter/v1/auth/sendLoginSmsCode",loginRegisterByCode:"/userCenter/v1/auth/loginRegisterByCode"},H=a=>{const s=P+O.getLoginSmsCode;return fetch(s,{method:"POST",headers:{"Content-Type":"application/json",...L},body:JSON.stringify(a)}).then(async u=>{const e=await u.json();if(e.code!==200)throw e;return e.data})},G=a=>{const s=P+O.loginRegisterByCode;return fetch(s,{method:"POST",headers:{"Content-Type":"application/json",...L},body:JSON.stringify(a)}).then(async u=>{const e=await u.json();if(e.code!==200)throw e;return e.data})},Q={key:0,class:"error-tips"},X=y({__name:"form-input",props:{className:{type:String,default:""},type:{type:String,default:"text"},value:{type:String,default:""},placeholder:{type:String,default:""},allowClear:{type:Boolean,default:!1},rule:{type:Object,default:null}},emits:["updateModelValue"],setup(a,{emit:s}){const u=s,e=a,p=h(!1),r=h(!1),f=F(()=>[e.className,"form-input-item",{focus:p.value,error:r.value}]),i=d=>{e.type==="tel"&&(d=d.replace(/\D/g,"")),u("updateModelValue",d)},w=()=>{p.value=!1,e.rule&&e.rule.trigger==="blur"&&(r.value=!e.rule.reg.test(e.value||""))};return(d,B)=>(m(),g("div",null,[n("div",{class:M(f.value)},[T(d.$slots,"addonBefore",{},void 0),C(z,{class:"input",type:a.type,modelValue:a.value,onInput:i,onBlur:w,placeholder:a.placeholder},null,8,["type","modelValue","placeholder"]),T(d.$slots,"addonAfter",{},void 0)],2),r.value&&a.rule?(m(),g("div",Q,v(a.rule.message),1)):R("",!0)]))}}),E=k(X,[["__scopeId","data-v-f8eac008"]]),Y={class:"login-form-container"},Z={class:"login-tabs"},ee=["onClick"],te={class:"login-tips"},se={class:"login-form"},oe=y({__name:"login-form",setup(a){const s=A(),u=U(),e={reg:/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/,message:l.mobileErrorMsg,trigger:"blur"},p={reg:/^\d+$/,message:l.smsErrorMsg,trigger:"blur"},r=h(60),f=x({active:0,list:[{key:0,title:l.loginTitle}]}),i=x({mobile:"",smsCode:""}),w=F(()=>r.value>0&&r.value<60?r.value+l.smsCodeBtnTitleCount:l.smsCodeBtnTitle);async function d(){if(!e.reg.test(i.mobile)){_({message:l.mobileErrorMsg,type:"info"});return}try{await H({mobile:i.mobile})}catch(t){let o=t.errMsg||t.msg||t.message||l.smsCodeFailMsg;o.startsWith("request:fail")&&(o=l.smsCodeNetworkErrorMsg),_({message:o,type:"info"});return}if(r.value>0&&r.value<60)return;r.value--;const c=setInterval(()=>{r.value>0?r.value--:(clearInterval(c),r.value=60)},1e3)}async function B(){if(!e.reg.test(i.mobile)||!p.reg.test(i.smsCode)){_({message:l.mobileOrSmsCodeErrorMsg,type:"info"});return}try{const c=await G(i);localStorage.setItem("__yx_im_options__h5",JSON.stringify({account:c.imAccid,token:c.imToken}));const{nim:t,store:o}=D();s&&(s.appContext.app.config.globalProperties.$NIM=t,s.appContext.app.config.globalProperties.$UIKitStore=o),t.V2NIMLoginService.login(c.imAccid,c.imToken).then(()=>{u.push(q.conversation)})}catch(c){let t=c.errMsg||c.msg||c.message||l.smsCodeFailMsg;t.startsWith("request:fail")&&(t=l.loginNetworkErrorMsg),_({message:t,type:"info"})}}return(c,t)=>(m(),g("div",null,[t[5]||(t[5]=n("div",{class:"navigation-bar"},null,-1)),n("div",Y,[n("div",Z,[(m(!0),g(V,null,j(f.list,o=>(m(),g("span",{key:o.key,class:M(["login-tab",{active:f.active===o.key}]),onClick:ce=>f.active=o.key},[n("span",null,v(o.title),1)],10,ee))),128))]),n("div",te,v(b(l).loginTips),1),n("div",se,[C(E,{className:"login-form-input",type:"tel",value:i.mobile,onUpdateModelValue:t[0]||(t[0]=o=>i.mobile=o),placeholder:b(l).mobilePlaceholder,"allow-clear":!0,rule:e},{addonBefore:I(()=>t[4]||(t[4]=[n("span",{class:"phone-addon-before"},"+86",-1)])),_:1},8,["value","placeholder"]),C(E,{className:"login-form-input",type:"tel",value:i.smsCode,onUpdateModelValue:t[2]||(t[2]=o=>i.smsCode=o),placeholder:b(l).smsCodePlaceholder,rule:p},{addonAfter:I(()=>[n("span",{class:M(["sms-addon-after",{disabled:r.value>0&&r.value<60}]),onClick:t[1]||(t[1]=o=>d())},v(w.value),3)]),_:1},8,["value","placeholder"])])]),n("button",{class:"login-btn",onClick:t[3]||(t[3]=o=>B())},v(b(l).loginBtnTitle),1)]))}}),ne=k(oe,[["__scopeId","data-v-7640e57a"]]),re=y({__name:"welcome",setup(a){const s=()=>{S.emit("login")};return(u,e)=>(m(),g("div",null,[e[0]||(e[0]=n("img",{src:"https://yx-web-nosdn.netease.im/common/da126b0fcc419b142224ced81456e179/yx-welcome.png",class:"welcome-img"},null,-1)),n("button",{class:"login-btn",onClick:s},"注册/登录"),e[1]||(e[1]=n("div",{class:"bottom-box"},[n("img",{src:"https://yx-web-nosdn.netease.im/common/9303d9be2ea5f90c48397326ae5dfd45/welcome-bottom.png",class:"welcome-img-bottom"})],-1))]))}}),le=k(re,[["__scopeId","data-v-e856d521"]]),ae={class:"page-wrapper"},ie=y({__name:"index",setup(a){const s=h(0);return J(()=>{S.on("login",()=>{s.value=1})}),K(()=>{S.off("login")}),(u,e)=>(m(),g("div",ae,[N(n("div",null,[C(le)],512),[[$,s.value===0]]),N(n("div",null,[C(ne)],512),[[$,s.value===1]])]))}}),pe=y({__name:"LoginPage",setup(a){return(s,u)=>(m(),W(ie))}});export{pe as default};

import{N as Q}from"./NavBar-BSxUZM35.js";import{A as D}from"./Avatar-BvJYmT9C.js";import{I as f}from"./Icon-XsD-7neM.js";import{f as R,i as X,h as N,j as A,y as m,s as Z,C as ee,p as F,q as te,c as v,m as d,g as k,u as l,e,a as t,t as u,F as ae,z as se,B as I,o as r,k as q,_ as oe}from"./index-DyncoFNp.js";import{S}from"./Switch-BugMB2Zb.js";import{t as _}from"./toast-DSCwmRst.js";import{m as w}from"./modal-DQBuBeBM.js";const ne={class:"team-set-container-wrapper"},ie={key:0,class:"team-set-container"},ce={class:"team-set-card"},me={class:"team-set-item"},le={class:"team-info-title team-title"},re={class:"team-set-item"},de={class:"team-members-item"},ue={class:"team-members-info"},_e={class:"team-info-title"},Me={class:"team-info-subtitle"},ve={class:"member-list"},Te={key:0,class:"member-add"},he={class:"team-set-card"},Ie={class:"team-set-item team-set-item-flex"},fe={class:"team-set-item team-set-item-flex"},Ne={key:0,class:"team-set-card"},Ee={class:"team-set-item team-set-item-flex"},pe=R({__name:"index",setup(G){var O;const M=ee(),{proxy:T}=X(),o=T==null?void 0:T.$UIKitStore,V=T==null?void 0:T.$NIM;let c="";const E=N([]),y=N(),n=N(),p=N(),x=(O=o==null?void 0:o.sdkOptions)==null?void 0:O.enableV2CloudConversation,C=A(()=>{const s=o.userStore.myUserInfo;return(n.value?n.value.ownerAccountId:"")===(s?s.accountId:"")}),g=A(()=>{const s=o.userStore.myUserInfo;return E.value.filter(a=>a.memberRole===m.V2NIMTeamMemberRole.V2NIM_TEAM_MEMBER_ROLE_MANAGER).some(a=>a.accountId===(s?s.accountId:""))}),L=A(()=>{var s;return((s=n.value)==null?void 0:s.inviteMode)===m.V2NIMTeamInviteMode.V2NIM_TEAM_INVITE_MODE_ALL?!0:C.value||g.value}),j=()=>{M.push({path:I.teamInfoEdit,query:{teamId:c}})},P=()=>{M.push({path:I.teamNick,query:{teamId:c}})},z=()=>{M.push({path:I.teamAdd,query:{teamId:c}})},H=()=>{M.push({path:I.teamMember,query:{teamId:c}})},$=()=>{w.confirm({title:e("dismissTeamText"),content:e("dismissTeamConfirmText"),onConfirm:()=>{o.teamStore.dismissTeamActive(c).then(()=>{_.info(e("dismissTeamSuccessText")),M.push({path:I.conversation})}).catch(()=>{_.info(e("dismissTeamFailedText"))})}})},K=()=>{w.confirm({title:e("leaveTeamTitle"),content:e("leaveTeamConfirmText"),onConfirm:()=>{o.teamStore.leaveTeamActive(c).then(()=>{_.info(e("leaveTeamSuccessText")),M.push({path:I.conversation})}).catch(()=>{_.info(e("leaveTeamFailedText"))})}})};let b=()=>{},B=()=>{};Z(()=>{c=M.currentRoute.value.query.teamId||"";const s=V.V2NIMConversationIdUtil.teamConversationId(c);o.teamStore.getTeamMessageMuteModeActive(c,1).then(a=>{p.value=a}),b=F(()=>{c&&(n.value=o.teamStore.teams.get(c),E.value=o.teamMemberStore.getTeamMember(c))}),B=F(()=>{var a,i;y.value=x?(a=o.conversationStore)==null?void 0:a.conversations.get(s):(i=o.localConversationStore)==null?void 0:i.conversations.get(s)})});const W=async s=>{var h,U;const a=s,i=V.V2NIMConversationIdUtil.teamConversationId(c);try{x?await((h=o.conversationStore)==null?void 0:h.stickTopConversationActive(i,a)):await((U=o.localConversationStore)==null?void 0:U.stickTopConversationActive(i,a))}catch{_.info(a?e("addStickTopFailText"):e("deleteStickTopFailText"))}},Y=s=>{const a=s;o.teamStore.setTeamMessageMuteModeActive(c,m.V2NIMTeamType.V2NIM_TEAM_TYPE_ADVANCED,a?m.V2NIMTeamMessageMuteMode.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF:m.V2NIMTeamMessageMuteMode.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON).then(()=>{p.value=a?m.V2NIMTeamMessageMuteMode.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF:m.V2NIMTeamMessageMuteMode.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON}).catch(i=>{switch(i==null?void 0:i.code){case 109432:_.info(e("noPermission"));break;default:_.info(a?e("sessionMuteFailText"):e("sessionUnMuteFailText"));break}})},J=async s=>{const a=s;try{await o.teamStore.setTeamChatBannedActive({teamId:c,chatBannedMode:a?m.V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL:m.V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN})}catch(i){switch(i==null?void 0:i.code){case 109432:_.info(e("noPermission"));break;default:_.info(a?e("muteAllTeamFailedText"):e("sessionUnMuteFailText"));break}}};return te(()=>{b(),B()}),(s,a)=>{var i;return r(),v("div",ne,[d(Q,{title:l(e)("setText")},null,8,["title"]),n.value?(r(),v("div",ie,[t("div",ce,[t("div",me,[t("div",{class:"team-info-item",onClick:j},[d(D,{account:n.value&&n.value.teamId,avatar:n.value&&n.value.avatar},null,8,["account","avatar"]),t("div",le,u(n.value&&n.value.name),1),d(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})])]),t("div",re,[t("div",de,[t("div",{class:"team-members-info-item",onClick:H},[t("div",ue,[t("div",_e,u(l(e)("teamMemberText")),1),t("div",Me,u(n.value&&n.value.memberCount),1)]),d(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})]),t("div",ve,[L.value?(r(),v("div",Te,[t("div",{onClick:z,style:{display:"flex"}},[d(f,{type:"icon-tianjiaanniu"})])])):k("",!0),(r(!0),v(ae,null,se(E.value,h=>(r(),v("div",{class:"member-item",key:h.accountId},[(r(),q(D,{account:h.accountId,size:"32",key:h.accountId,"font-size":"10"},null,8,["account"]))]))),128))])])])]),t("div",he,[t("div",Ie,[t("div",null,u(l(e)("stickTopText")),1),d(S,{checked:!!((i=y.value)!=null&&i.stickTop),onChange:W},null,8,["checked"])]),t("div",fe,[t("div",null,u(l(e)("sessionMuteText")),1),d(S,{checked:n.value&&p.value!==l(m).V2NIMTeamMessageMuteMode.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON,onChange:Y},null,8,["checked"])]),t("div",{class:"team-set-item team-set-item-flex",onClick:P},[t("div",null,u(l(e)("nickInTeam")),1),d(f,{iconClassName:"more-icon",color:"#999",type:"icon-jiantou"})])]),C.value||g.value?(r(),v("div",Ne,[t("div",Ee,[t("div",null,u(l(e)("teamBannedText")),1),d(S,{checked:n.value&&n.value.chatBannedMode!==l(m).V2NIMTeamChatBannedMode.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN,onChange:J},null,8,["checked"])])])):k("",!0),C.value?(r(),v("div",{key:1,class:"team-set-button",onClick:$},u(l(e)("dismissTeamText")),1)):(r(),v("div",{key:2,class:"team-set-button",onClick:K},u(l(e)("leaveTeamTitle")),1))])):k("",!0)])}}}),Ce=oe(pe,[["__scopeId","data-v-33392307"]]),Be=R({__name:"TeamSetPage",setup(G){return(M,T)=>(r(),q(Ce))}});export{Be as default};

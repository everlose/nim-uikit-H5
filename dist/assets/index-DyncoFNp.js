const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ChatPage-71DSnefE.js","./reporter-Cs0pKN63.js","./index.esm-CPwIBr9T.js","./package-DKjbUiep.js","./NetworkAlert-BzZ3Rn47.js","./NetworkAlert-BvNU6n2r.css","./nav-bar-CoOUPfVF.js","./Icon-XsD-7neM.js","./Icon-xVHqdenW.css","./nav-bar-COZGw70Y.css","./Avatar-BvJYmT9C.js","./Avatar-CCi1p5-a.css","./eventBus-E5P-NQ8u.js","./Appellation-5sErKFFL.js","./Appellation-4wAPIa_M.css","./modal-DQBuBeBM.js","./modal-D4iuHNlW.css","./Input-BrAf66hy.js","./Input-DUVMr3N1.css","./toast-DSCwmRst.js","./toast-BmES-W3h.css","./emoji-Bh8i_--D.js","./ChatPage-9LZBOlYf.css","./MessageReadInfoPage-DMbIeLXv.js","./Empty-Dhm7Ynwu.js","./Empty-DwfK98yl.css","./MessageReadInfoPage-Bj-qpz9Y.css","./P2pSettingPage-DJJhAvHS.js","./NavBar-BSxUZM35.js","./NavBar-DSTHFuo7.css","./Switch-BugMB2Zb.js","./Switch-DLeCyqbm.css","./P2pSettingPage-CezLOTZw.css","./ConversationPage-Bz2EBWDN.js","./ConversationPage-Dck8kZWM.css","./ConversationSearchPage-Bdj_H1MT.js","./ConversationSearchPage-CO7sPb4c.css","./ContactsPage-DjBaYd2K.js","./ContactsPage-Cg4IYlnO.css","./BlackListPage-BwPUmMM-.js","./BlackListPage-BlJZnMtg.css","./ValidListPage-BPmhIx2R.js","./ValidListPage-BO7ki2fx.css","./TeamListPage-fwlcmu65.js","./TeamListPage-Clc3krai.css","./MyPage-D7YBWj-h.js","./UserCard-BOjpmzBo.js","./UserCard-CntMEVKT.css","./MyPage-CoV9ARZG.css","./SettingPage-BZ1qaAR_.js","./SettingPage-71q-4dqP.css","./MyDetailPage-D08Nf92z.js","./loading-BhoYo60D.js","./loading-DMXX1Crj.css","./MyDetailPage-Dh2HyteE.css","./MyDetailEditPage-0M5180b5.js","./MyDetailEditPage-_LQS8zGd.css","./AboutNeteasePage-uo1GfJ8A.js","./AboutNeteasePage-CCsuTuVX.css","./FriendCardPage-DA0F-sVd.js","./FriendCardPage-DSt4vM_a.css","./AddFriendPage-DaQTFvOS.js","./Button-BqxwzfdT.js","./Button-DxvHccdm.css","./AddFriendPage-BPYmNTQe.css","./FriendInfoEditPage-DsOApGcf.js","./FriendInfoEditPage-BRTt0TKJ.css","./TeamCreatePage-BN4DjG37.js","./PersonSelect-BBr07mAW.js","./PersonSelect-CoBa5qel.css","./TeamCreatePage-qGyR5qRf.css","./TeamSetPage-Bx3_Ka-P.js","./TeamSetPage-95ObW-pC.css","./TeamMemberPage-CJ8r7aXR.js","./TeamMemberPage-DX8Gs1ko.css","./TeamInfoEditPage-C4xIe4I5.js","./TeamInfoEditPage-tISQWpmC.css","./TeamAvatarEditPage-DZ0KY7Lh.js","./TeamAvatarEditPage-DA9p7fCB.css","./TeamIntroduceEditPage-CL6Tyj1r.js","./TeamIntroduceEditPage-CoW1D28Y.css","./TeamAddPage-C3DsU9Zj.js","./TeamAddPage-Df-CzpS2.css","./TeamNickPage-Cgeo16II.js","./TeamNickPage-BZTivUJu.css","./LoginPage-DXZQ5Pe_.js","./LoginPage-9UUcJvIw.css"])))=>i.map(i=>d[i]);
(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))d(f);new MutationObserver(f=>{for(const m of f)if(m.type==="childList")for(const y of m.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&d(y)}).observe(document,{childList:!0,subtree:!0});function c(f){const m={};return f.integrity&&(m.integrity=f.integrity),f.referrerPolicy&&(m.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?m.credentials="include":f.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function d(f){if(f.ep)return;f.ep=!0;const m=c(f);fetch(f.href,m)}})();const iF="modulepreload",sF=function(s,n){return new URL(s,n).href},qC={},Or=function(n,c,d){let f=Promise.resolve();if(c&&c.length>0){const y=document.getElementsByTagName("link"),M=document.querySelector("meta[property=csp-nonce]"),S=(M==null?void 0:M.nonce)||(M==null?void 0:M.getAttribute("nonce"));f=Promise.allSettled(c.map(E=>{if(E=sF(E,d),E in qC)return;qC[E]=!0;const b=E.endsWith(".css"),R=b?'[rel="stylesheet"]':"";if(!!d)for(let q=y.length-1;q>=0;q--){const D=y[q];if(D.href===E&&(!b||D.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${E}"]${R}`))return;const L=document.createElement("link");if(L.rel=b?"stylesheet":iF,b||(L.as="script"),L.crossOrigin="",L.href=E,S&&L.setAttribute("nonce",S),document.head.appendChild(L),b)return new Promise((q,D)=>{L.addEventListener("load",q),L.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${E}`)))})}))}function m(y){const M=new Event("vite:preloadError",{cancelable:!0});if(M.payload=y,window.dispatchEvent(M),!M.defaultPrevented)throw y}return f.then(y=>{for(const M of y||[])M.status==="rejected"&&m(M.reason);return n().catch(m)})};/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function eM(s){const n=Object.create(null);for(const c of s.split(","))n[c]=1;return c=>c in n}const Rr={},jc=[],as=()=>{},oF=()=>!1,Zp=s=>s.charCodeAt(0)===111&&s.charCodeAt(1)===110&&(s.charCodeAt(2)>122||s.charCodeAt(2)<97),tM=s=>s.startsWith("onUpdate:"),dn=Object.assign,rM=(s,n)=>{const c=s.indexOf(n);c>-1&&s.splice(c,1)},aF=Object.prototype.hasOwnProperty,Mr=(s,n)=>aF.call(s,n),Bt=Array.isArray,Hc=s=>eh(s)==="[object Map]",gA=s=>eh(s)==="[object Set]",Ht=s=>typeof s=="function",Jr=s=>typeof s=="string",Qs=s=>typeof s=="symbol",Vr=s=>s!==null&&typeof s=="object",vA=s=>(Vr(s)||Ht(s))&&Ht(s.then)&&Ht(s.catch),yA=Object.prototype.toString,eh=s=>yA.call(s),cF=s=>eh(s).slice(8,-1),_A=s=>eh(s)==="[object Object]",nM=s=>Jr(s)&&s!=="NaN"&&s[0]!=="-"&&""+parseInt(s,10)===s,yu=eM(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),th=s=>{const n=Object.create(null);return c=>n[c]||(n[c]=s(c))},lF=/-(\w)/g,bi=th(s=>s.replace(lF,(n,c)=>c?c.toUpperCase():"")),uF=/\B([A-Z])/g,Fa=th(s=>s.replace(uF,"-$1").toLowerCase()),rh=th(s=>s.charAt(0).toUpperCase()+s.slice(1)),pv=th(s=>s?`on${rh(s)}`:""),qo=(s,n)=>!Object.is(s,n),hv=(s,...n)=>{for(let c=0;c<s.length;c++)s[c](...n)},MA=(s,n,c,d=!1)=>{Object.defineProperty(s,n,{configurable:!0,enumerable:!1,writable:d,value:c})},dF=s=>{const n=parseFloat(s);return isNaN(n)?s:n},pF=s=>{const n=Jr(s)?Number(s):NaN;return isNaN(n)?s:n};let GC;const nh=()=>GC||(GC=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function iM(s){if(Bt(s)){const n={};for(let c=0;c<s.length;c++){const d=s[c],f=Jr(d)?gF(d):iM(d);if(f)for(const m in f)n[m]=f[m]}return n}else if(Jr(s)||Vr(s))return s}const hF=/;(?![^(]*\))/g,fF=/:([^]+)/,mF=/\/\*[^]*?\*\//g;function gF(s){const n={};return s.replace(mF,"").split(hF).forEach(c=>{if(c){const d=c.split(fF);d.length>1&&(n[d[0].trim()]=d[1].trim())}}),n}function sM(s){let n="";if(Jr(s))n=s;else if(Bt(s))for(let c=0;c<s.length;c++){const d=sM(s[c]);d&&(n+=d+" ")}else if(Vr(s))for(const c in s)s[c]&&(n+=c+" ");return n.trim()}const vF="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",yF=eM(vF);function TA(s){return!!s||s===""}const IA=s=>!!(s&&s.__v_isRef===!0),Sp=s=>Jr(s)?s:s==null?"":Bt(s)||Vr(s)&&(s.toString===yA||!Ht(s.toString))?IA(s)?Sp(s.value):JSON.stringify(s,SA,2):String(s),SA=(s,n)=>IA(n)?SA(s,n.value):Hc(n)?{[`Map(${n.size})`]:[...n.entries()].reduce((c,[d,f],m)=>(c[fv(d,m)+" =>"]=f,c),{})}:gA(n)?{[`Set(${n.size})`]:[...n.values()].map(c=>fv(c))}:Qs(n)?fv(n):Vr(n)&&!Bt(n)&&!_A(n)?String(n):n,fv=(s,n="")=>{var c;return Qs(s)?`Symbol(${(c=s.description)!=null?c:n})`:s};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ni;class _F{constructor(n=!1){this.detached=n,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=ni,!n&&ni&&(this.index=(ni.scopes||(ni.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let n,c;if(this.scopes)for(n=0,c=this.scopes.length;n<c;n++)this.scopes[n].pause();for(n=0,c=this.effects.length;n<c;n++)this.effects[n].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let n,c;if(this.scopes)for(n=0,c=this.scopes.length;n<c;n++)this.scopes[n].resume();for(n=0,c=this.effects.length;n<c;n++)this.effects[n].resume()}}run(n){if(this._active){const c=ni;try{return ni=this,n()}finally{ni=c}}}on(){ni=this}off(){ni=this.parent}stop(n){if(this._active){this._active=!1;let c,d;for(c=0,d=this.effects.length;c<d;c++)this.effects[c].stop();for(this.effects.length=0,c=0,d=this.cleanups.length;c<d;c++)this.cleanups[c]();if(this.cleanups.length=0,this.scopes){for(c=0,d=this.scopes.length;c<d;c++)this.scopes[c].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!n){const f=this.parent.scopes.pop();f&&f!==this&&(this.parent.scopes[this.index]=f,f.index=this.index)}this.parent=void 0}}}function MF(){return ni}let xr;const mv=new WeakSet;class EA{constructor(n){this.fn=n,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,ni&&ni.active&&ni.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,mv.has(this)&&(mv.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||bA(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,jC(this),AA(this);const n=xr,c=Ui;xr=this,Ui=!0;try{return this.fn()}finally{RA(this),xr=n,Ui=c,this.flags&=-3}}stop(){if(this.flags&1){for(let n=this.deps;n;n=n.nextDep)cM(n);this.deps=this.depsTail=void 0,jC(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?mv.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Iy(this)&&this.run()}get dirty(){return Iy(this)}}let CA=0,_u,Mu;function bA(s,n=!1){if(s.flags|=8,n){s.next=Mu,Mu=s;return}s.next=_u,_u=s}function oM(){CA++}function aM(){if(--CA>0)return;if(Mu){let n=Mu;for(Mu=void 0;n;){const c=n.next;n.next=void 0,n.flags&=-9,n=c}}let s;for(;_u;){let n=_u;for(_u=void 0;n;){const c=n.next;if(n.next=void 0,n.flags&=-9,n.flags&1)try{n.trigger()}catch(d){s||(s=d)}n=c}}if(s)throw s}function AA(s){for(let n=s.deps;n;n=n.nextDep)n.version=-1,n.prevActiveLink=n.dep.activeLink,n.dep.activeLink=n}function RA(s){let n,c=s.depsTail,d=c;for(;d;){const f=d.prevDep;d.version===-1?(d===c&&(c=f),cM(d),TF(d)):n=d,d.dep.activeLink=d.prevActiveLink,d.prevActiveLink=void 0,d=f}s.deps=n,s.depsTail=c}function Iy(s){for(let n=s.deps;n;n=n.nextDep)if(n.dep.version!==n.version||n.dep.computed&&(NA(n.dep.computed)||n.dep.version!==n.version))return!0;return!!s._dirty}function NA(s){if(s.flags&4&&!(s.flags&16)||(s.flags&=-17,s.globalVersion===Nu))return;s.globalVersion=Nu;const n=s.dep;if(s.flags|=2,n.version>0&&!s.isSSR&&s.deps&&!Iy(s)){s.flags&=-3;return}const c=xr,d=Ui;xr=s,Ui=!0;try{AA(s);const f=s.fn(s._value);(n.version===0||qo(f,s._value))&&(s._value=f,n.version++)}catch(f){throw n.version++,f}finally{xr=c,Ui=d,RA(s),s.flags&=-3}}function cM(s,n=!1){const{dep:c,prevSub:d,nextSub:f}=s;if(d&&(d.nextSub=f,s.prevSub=void 0),f&&(f.prevSub=d,s.nextSub=void 0),c.subs===s&&(c.subs=d,!d&&c.computed)){c.computed.flags&=-5;for(let m=c.computed.deps;m;m=m.nextDep)cM(m,!0)}!n&&!--c.sc&&c.map&&c.map.delete(c.key)}function TF(s){const{prevDep:n,nextDep:c}=s;n&&(n.nextDep=c,s.prevDep=void 0),c&&(c.prevDep=n,s.nextDep=void 0)}let Ui=!0;const kA=[];function $o(){kA.push(Ui),Ui=!1}function Ko(){const s=kA.pop();Ui=s===void 0?!0:s}function jC(s){const{cleanup:n}=s;if(s.cleanup=void 0,n){const c=xr;xr=void 0;try{n()}finally{xr=c}}}let Nu=0;class IF{constructor(n,c){this.sub=n,this.dep=c,this.version=c.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class lM{constructor(n){this.computed=n,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(n){if(!xr||!Ui||xr===this.computed)return;let c=this.activeLink;if(c===void 0||c.sub!==xr)c=this.activeLink=new IF(xr,this),xr.deps?(c.prevDep=xr.depsTail,xr.depsTail.nextDep=c,xr.depsTail=c):xr.deps=xr.depsTail=c,OA(c);else if(c.version===-1&&(c.version=this.version,c.nextDep)){const d=c.nextDep;d.prevDep=c.prevDep,c.prevDep&&(c.prevDep.nextDep=d),c.prevDep=xr.depsTail,c.nextDep=void 0,xr.depsTail.nextDep=c,xr.depsTail=c,xr.deps===c&&(xr.deps=d)}return c}trigger(n){this.version++,Nu++,this.notify(n)}notify(n){oM();try{for(let c=this.subs;c;c=c.prevSub)c.sub.notify()&&c.sub.dep.notify()}finally{aM()}}}function OA(s){if(s.dep.sc++,s.sub.flags&4){const n=s.dep.computed;if(n&&!s.dep.subs){n.flags|=20;for(let d=n.deps;d;d=d.nextDep)OA(d)}const c=s.dep.subs;c!==s&&(s.prevSub=c,c&&(c.nextSub=s)),s.dep.subs=s}}const Sy=new WeakMap,wa=Symbol(""),Ey=Symbol(""),ku=Symbol("");function bn(s,n,c){if(Ui&&xr){let d=Sy.get(s);d||Sy.set(s,d=new Map);let f=d.get(c);f||(d.set(c,f=new lM),f.map=d,f.key=c),f.track()}}function Gs(s,n,c,d,f,m){const y=Sy.get(s);if(!y){Nu++;return}const M=S=>{S&&S.trigger()};if(oM(),n==="clear")y.forEach(M);else{const S=Bt(s),E=S&&nM(c);if(S&&c==="length"){const b=Number(d);y.forEach((R,x)=>{(x==="length"||x===ku||!Qs(x)&&x>=b)&&M(R)})}else switch((c!==void 0||y.has(void 0))&&M(y.get(c)),E&&M(y.get(ku)),n){case"add":S?E&&M(y.get("length")):(M(y.get(wa)),Hc(s)&&M(y.get(Ey)));break;case"delete":S||(M(y.get(wa)),Hc(s)&&M(y.get(Ey)));break;case"set":Hc(s)&&M(y.get(wa));break}}aM()}function Ac(s){const n=mr(s);return n===s?n:(bn(n,"iterate",ku),Ci(s)?n:n.map(An))}function ih(s){return bn(s=mr(s),"iterate",ku),s}const SF={__proto__:null,[Symbol.iterator](){return gv(this,Symbol.iterator,An)},concat(...s){return Ac(this).concat(...s.map(n=>Bt(n)?Ac(n):n))},entries(){return gv(this,"entries",s=>(s[1]=An(s[1]),s))},every(s,n){return Ds(this,"every",s,n,void 0,arguments)},filter(s,n){return Ds(this,"filter",s,n,c=>c.map(An),arguments)},find(s,n){return Ds(this,"find",s,n,An,arguments)},findIndex(s,n){return Ds(this,"findIndex",s,n,void 0,arguments)},findLast(s,n){return Ds(this,"findLast",s,n,An,arguments)},findLastIndex(s,n){return Ds(this,"findLastIndex",s,n,void 0,arguments)},forEach(s,n){return Ds(this,"forEach",s,n,void 0,arguments)},includes(...s){return vv(this,"includes",s)},indexOf(...s){return vv(this,"indexOf",s)},join(s){return Ac(this).join(s)},lastIndexOf(...s){return vv(this,"lastIndexOf",s)},map(s,n){return Ds(this,"map",s,n,void 0,arguments)},pop(){return ou(this,"pop")},push(...s){return ou(this,"push",s)},reduce(s,...n){return HC(this,"reduce",s,n)},reduceRight(s,...n){return HC(this,"reduceRight",s,n)},shift(){return ou(this,"shift")},some(s,n){return Ds(this,"some",s,n,void 0,arguments)},splice(...s){return ou(this,"splice",s)},toReversed(){return Ac(this).toReversed()},toSorted(s){return Ac(this).toSorted(s)},toSpliced(...s){return Ac(this).toSpliced(...s)},unshift(...s){return ou(this,"unshift",s)},values(){return gv(this,"values",An)}};function gv(s,n,c){const d=ih(s),f=d[n]();return d!==s&&!Ci(s)&&(f._next=f.next,f.next=()=>{const m=f._next();return m.value&&(m.value=c(m.value)),m}),f}const EF=Array.prototype;function Ds(s,n,c,d,f,m){const y=ih(s),M=y!==s&&!Ci(s),S=y[n];if(S!==EF[n]){const R=S.apply(s,m);return M?An(R):R}let E=c;y!==s&&(M?E=function(R,x){return c.call(this,An(R),x,s)}:c.length>2&&(E=function(R,x){return c.call(this,R,x,s)}));const b=S.call(y,E,d);return M&&f?f(b):b}function HC(s,n,c,d){const f=ih(s);let m=c;return f!==s&&(Ci(s)?c.length>3&&(m=function(y,M,S){return c.call(this,y,M,S,s)}):m=function(y,M,S){return c.call(this,y,An(M),S,s)}),f[n](m,...d)}function vv(s,n,c){const d=mr(s);bn(d,"iterate",ku);const f=d[n](...c);return(f===-1||f===!1)&&pM(c[0])?(c[0]=mr(c[0]),d[n](...c)):f}function ou(s,n,c=[]){$o(),oM();const d=mr(s)[n].apply(s,c);return aM(),Ko(),d}const CF=eM("__proto__,__v_isRef,__isVue"),wA=new Set(Object.getOwnPropertyNames(Symbol).filter(s=>s!=="arguments"&&s!=="caller").map(s=>Symbol[s]).filter(Qs));function bF(s){Qs(s)||(s=String(s));const n=mr(this);return bn(n,"has",s),n.hasOwnProperty(s)}class xA{constructor(n=!1,c=!1){this._isReadonly=n,this._isShallow=c}get(n,c,d){if(c==="__v_skip")return n.__v_skip;const f=this._isReadonly,m=this._isShallow;if(c==="__v_isReactive")return!f;if(c==="__v_isReadonly")return f;if(c==="__v_isShallow")return m;if(c==="__v_raw")return d===(f?m?VF:DA:m?VA:LA).get(n)||Object.getPrototypeOf(n)===Object.getPrototypeOf(d)?n:void 0;const y=Bt(n);if(!f){let S;if(y&&(S=SF[c]))return S;if(c==="hasOwnProperty")return bF}const M=Reflect.get(n,c,Nn(n)?n:d);return(Qs(c)?wA.has(c):CF(c))||(f||bn(n,"get",c),m)?M:Nn(M)?y&&nM(c)?M:M.value:Vr(M)?f?FA(M):sh(M):M}}class PA extends xA{constructor(n=!1){super(!1,n)}set(n,c,d,f){let m=n[c];if(!this._isShallow){const S=La(m);if(!Ci(d)&&!La(d)&&(m=mr(m),d=mr(d)),!Bt(n)&&Nn(m)&&!Nn(d))return S?!1:(m.value=d,!0)}const y=Bt(n)&&nM(c)?Number(c)<n.length:Mr(n,c),M=Reflect.set(n,c,d,Nn(n)?n:f);return n===mr(f)&&(y?qo(d,m)&&Gs(n,"set",c,d):Gs(n,"add",c,d)),M}deleteProperty(n,c){const d=Mr(n,c);n[c];const f=Reflect.deleteProperty(n,c);return f&&d&&Gs(n,"delete",c,void 0),f}has(n,c){const d=Reflect.has(n,c);return(!Qs(c)||!wA.has(c))&&bn(n,"has",c),d}ownKeys(n){return bn(n,"iterate",Bt(n)?"length":wa),Reflect.ownKeys(n)}}class AF extends xA{constructor(n=!1){super(!0,n)}set(n,c){return!0}deleteProperty(n,c){return!0}}const RF=new PA,NF=new AF,kF=new PA(!0);const Cy=s=>s,up=s=>Reflect.getPrototypeOf(s);function OF(s,n,c){return function(...d){const f=this.__v_raw,m=mr(f),y=Hc(m),M=s==="entries"||s===Symbol.iterator&&y,S=s==="keys"&&y,E=f[s](...d),b=c?Cy:n?by:An;return!n&&bn(m,"iterate",S?Ey:wa),{next(){const{value:R,done:x}=E.next();return x?{value:R,done:x}:{value:M?[b(R[0]),b(R[1])]:b(R),done:x}},[Symbol.iterator](){return this}}}}function dp(s){return function(...n){return s==="delete"?!1:s==="clear"?void 0:this}}function wF(s,n){const c={get(f){const m=this.__v_raw,y=mr(m),M=mr(f);s||(qo(f,M)&&bn(y,"get",f),bn(y,"get",M));const{has:S}=up(y),E=n?Cy:s?by:An;if(S.call(y,f))return E(m.get(f));if(S.call(y,M))return E(m.get(M));m!==y&&m.get(f)},get size(){const f=this.__v_raw;return!s&&bn(mr(f),"iterate",wa),Reflect.get(f,"size",f)},has(f){const m=this.__v_raw,y=mr(m),M=mr(f);return s||(qo(f,M)&&bn(y,"has",f),bn(y,"has",M)),f===M?m.has(f):m.has(f)||m.has(M)},forEach(f,m){const y=this,M=y.__v_raw,S=mr(M),E=n?Cy:s?by:An;return!s&&bn(S,"iterate",wa),M.forEach((b,R)=>f.call(m,E(b),E(R),y))}};return dn(c,s?{add:dp("add"),set:dp("set"),delete:dp("delete"),clear:dp("clear")}:{add(f){!n&&!Ci(f)&&!La(f)&&(f=mr(f));const m=mr(this);return up(m).has.call(m,f)||(m.add(f),Gs(m,"add",f,f)),this},set(f,m){!n&&!Ci(m)&&!La(m)&&(m=mr(m));const y=mr(this),{has:M,get:S}=up(y);let E=M.call(y,f);E||(f=mr(f),E=M.call(y,f));const b=S.call(y,f);return y.set(f,m),E?qo(m,b)&&Gs(y,"set",f,m):Gs(y,"add",f,m),this},delete(f){const m=mr(this),{has:y,get:M}=up(m);let S=y.call(m,f);S||(f=mr(f),S=y.call(m,f)),M&&M.call(m,f);const E=m.delete(f);return S&&Gs(m,"delete",f,void 0),E},clear(){const f=mr(this),m=f.size!==0,y=f.clear();return m&&Gs(f,"clear",void 0,void 0),y}}),["keys","values","entries",Symbol.iterator].forEach(f=>{c[f]=OF(f,s,n)}),c}function uM(s,n){const c=wF(s,n);return(d,f,m)=>f==="__v_isReactive"?!s:f==="__v_isReadonly"?s:f==="__v_raw"?d:Reflect.get(Mr(c,f)&&f in d?c:d,f,m)}const xF={get:uM(!1,!1)},PF={get:uM(!1,!0)},LF={get:uM(!0,!1)};const LA=new WeakMap,VA=new WeakMap,DA=new WeakMap,VF=new WeakMap;function DF(s){switch(s){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function UF(s){return s.__v_skip||!Object.isExtensible(s)?0:DF(cF(s))}function sh(s){return La(s)?s:dM(s,!1,RF,xF,LA)}function UA(s){return dM(s,!1,kF,PF,VA)}function FA(s){return dM(s,!0,NF,LF,DA)}function dM(s,n,c,d,f){if(!Vr(s)||s.__v_raw&&!(n&&s.__v_isReactive))return s;const m=f.get(s);if(m)return m;const y=UF(s);if(y===0)return s;const M=new Proxy(s,y===2?d:c);return f.set(s,M),M}function $c(s){return La(s)?$c(s.__v_raw):!!(s&&s.__v_isReactive)}function La(s){return!!(s&&s.__v_isReadonly)}function Ci(s){return!!(s&&s.__v_isShallow)}function pM(s){return s?!!s.__v_raw:!1}function mr(s){const n=s&&s.__v_raw;return n?mr(n):s}function FF(s){return!Mr(s,"__v_skip")&&Object.isExtensible(s)&&MA(s,"__v_skip",!0),s}const An=s=>Vr(s)?sh(s):s,by=s=>Vr(s)?FA(s):s;function Nn(s){return s?s.__v_isRef===!0:!1}function Ay(s){return BA(s,!1)}function BF(s){return BA(s,!0)}function BA(s,n){return Nn(s)?s:new qF(s,n)}class qF{constructor(n,c){this.dep=new lM,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=c?n:mr(n),this._value=c?n:An(n),this.__v_isShallow=c}get value(){return this.dep.track(),this._value}set value(n){const c=this._rawValue,d=this.__v_isShallow||Ci(n)||La(n);n=d?n:mr(n),qo(n,c)&&(this._rawValue=n,this._value=d?n:An(n),this.dep.trigger())}}function qn(s){return Nn(s)?s.value:s}const GF={get:(s,n,c)=>n==="__v_raw"?s:qn(Reflect.get(s,n,c)),set:(s,n,c,d)=>{const f=s[n];return Nn(f)&&!Nn(c)?(f.value=c,!0):Reflect.set(s,n,c,d)}};function qA(s){return $c(s)?s:new Proxy(s,GF)}class jF{constructor(n,c,d){this.fn=n,this.setter=c,this._value=void 0,this.dep=new lM(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Nu-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!c,this.isSSR=d}notify(){if(this.flags|=16,!(this.flags&8)&&xr!==this)return bA(this,!0),!0}get value(){const n=this.dep.track();return NA(this),n&&(n.version=this.dep.version),this._value}set value(n){this.setter&&this.setter(n)}}function HF(s,n,c=!1){let d,f;return Ht(s)?d=s:(d=s.get,f=s.set),new jF(d,f,c)}const pp={},Dp=new WeakMap;let Na;function $F(s,n=!1,c=Na){if(c){let d=Dp.get(c);d||Dp.set(c,d=[]),d.push(s)}}function KF(s,n,c=Rr){const{immediate:d,deep:f,once:m,scheduler:y,augmentJob:M,call:S}=c,E=$=>f?$:Ci($)||f===!1||f===0?js($,1):js($);let b,R,x,L,q=!1,D=!1;if(Nn(s)?(R=()=>s.value,q=Ci(s)):$c(s)?(R=()=>E(s),q=!0):Bt(s)?(D=!0,q=s.some($=>$c($)||Ci($)),R=()=>s.map($=>{if(Nn($))return $.value;if($c($))return E($);if(Ht($))return S?S($,2):$()})):Ht(s)?n?R=S?()=>S(s,2):s:R=()=>{if(x){$o();try{x()}finally{Ko()}}const $=Na;Na=b;try{return S?S(s,3,[L]):s(L)}finally{Na=$}}:R=as,n&&f){const $=R,Z=f===!0?1/0:f;R=()=>js($(),Z)}const G=MF(),J=()=>{b.stop(),G&&G.active&&rM(G.effects,b)};if(m&&n){const $=n;n=(...Z)=>{$(...Z),J()}}let ne=D?new Array(s.length).fill(pp):pp;const z=$=>{if(!(!(b.flags&1)||!b.dirty&&!$))if(n){const Z=b.run();if(f||q||(D?Z.some((le,fe)=>qo(le,ne[fe])):qo(Z,ne))){x&&x();const le=Na;Na=b;try{const fe=[Z,ne===pp?void 0:D&&ne[0]===pp?[]:ne,L];S?S(n,3,fe):n(...fe),ne=Z}finally{Na=le}}}else b.run()};return M&&M(z),b=new EA(R),b.scheduler=y?()=>y(z,!1):z,L=$=>$F($,!1,b),x=b.onStop=()=>{const $=Dp.get(b);if($){if(S)S($,4);else for(const Z of $)Z();Dp.delete(b)}},n?d?z(!0):ne=b.run():y?y(z.bind(null,!0),!0):b.run(),J.pause=b.pause.bind(b),J.resume=b.resume.bind(b),J.stop=J,J}function js(s,n=1/0,c){if(n<=0||!Vr(s)||s.__v_skip||(c=c||new Set,c.has(s)))return s;if(c.add(s),n--,Nn(s))js(s.value,n,c);else if(Bt(s))for(let d=0;d<s.length;d++)js(s[d],n,c);else if(gA(s)||Hc(s))s.forEach(d=>{js(d,n,c)});else if(_A(s)){for(const d in s)js(s[d],n,c);for(const d of Object.getOwnPropertySymbols(s))Object.prototype.propertyIsEnumerable.call(s,d)&&js(s[d],n,c)}return s}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Hu(s,n,c,d){try{return d?s(...d):s()}catch(f){oh(f,n,c)}}function Gi(s,n,c,d){if(Ht(s)){const f=Hu(s,n,c,d);return f&&vA(f)&&f.catch(m=>{oh(m,n,c)}),f}if(Bt(s)){const f=[];for(let m=0;m<s.length;m++)f.push(Gi(s[m],n,c,d));return f}}function oh(s,n,c,d=!0){const f=n?n.vnode:null,{errorHandler:m,throwUnhandledErrorInProduction:y}=n&&n.appContext.config||Rr;if(n){let M=n.parent;const S=n.proxy,E=`https://vuejs.org/error-reference/#runtime-${c}`;for(;M;){const b=M.ec;if(b){for(let R=0;R<b.length;R++)if(b[R](s,S,E)===!1)return}M=M.parent}if(m){$o(),Hu(m,null,10,[s,S,E]),Ko();return}}YF(s,c,f,d,y)}function YF(s,n,c,d=!0,f=!1){if(f)throw s;console.error(s)}const Gn=[];let is=-1;const Kc=[];let Lo=null,wc=0;const GA=Promise.resolve();let Up=null;function jA(s){const n=Up||GA;return s?n.then(this?s.bind(this):s):n}function WF(s){let n=is+1,c=Gn.length;for(;n<c;){const d=n+c>>>1,f=Gn[d],m=Ou(f);m<s||m===s&&f.flags&2?n=d+1:c=d}return n}function hM(s){if(!(s.flags&1)){const n=Ou(s),c=Gn[Gn.length-1];!c||!(s.flags&2)&&n>=Ou(c)?Gn.push(s):Gn.splice(WF(n),0,s),s.flags|=1,HA()}}function HA(){Up||(Up=GA.then(KA))}function JF(s){Bt(s)?Kc.push(...s):Lo&&s.id===-1?Lo.splice(wc+1,0,s):s.flags&1||(Kc.push(s),s.flags|=1),HA()}function $C(s,n,c=is+1){for(;c<Gn.length;c++){const d=Gn[c];if(d&&d.flags&2){if(s&&d.id!==s.uid)continue;Gn.splice(c,1),c--,d.flags&4&&(d.flags&=-2),d(),d.flags&4||(d.flags&=-2)}}}function $A(s){if(Kc.length){const n=[...new Set(Kc)].sort((c,d)=>Ou(c)-Ou(d));if(Kc.length=0,Lo){Lo.push(...n);return}for(Lo=n,wc=0;wc<Lo.length;wc++){const c=Lo[wc];c.flags&4&&(c.flags&=-2),c.flags&8||c(),c.flags&=-2}Lo=null,wc=0}}const Ou=s=>s.id==null?s.flags&2?-1:1/0:s.id;function KA(s){try{for(is=0;is<Gn.length;is++){const n=Gn[is];n&&!(n.flags&8)&&(n.flags&4&&(n.flags&=-2),Hu(n,n.i,n.i?15:14),n.flags&4||(n.flags&=-2))}}finally{for(;is<Gn.length;is++){const n=Gn[is];n&&(n.flags&=-2)}is=-1,Gn.length=0,$A(),Up=null,(Gn.length||Kc.length)&&KA()}}let un=null,YA=null;function Fp(s){const n=un;return un=s,YA=s&&s.type.__scopeId||null,n}function Ep(s,n=un,c){if(!n||s._n)return s;const d=(...f)=>{d._d&&rb(-1);const m=Fp(n);let y;try{y=s(...f)}finally{Fp(m),d._d&&rb(1)}return y};return d._n=!0,d._c=!0,d._d=!0,d}function _7(s,n){if(un===null)return s;const c=dh(un),d=s.dirs||(s.dirs=[]);for(let f=0;f<n.length;f++){let[m,y,M,S=Rr]=n[f];m&&(Ht(m)&&(m={mounted:m,updated:m}),m.deep&&js(y),d.push({dir:m,instance:c,value:y,oldValue:void 0,arg:M,modifiers:S}))}return s}function Ea(s,n,c,d){const f=s.dirs,m=n&&n.dirs;for(let y=0;y<f.length;y++){const M=f[y];m&&(M.oldValue=m[y].value);let S=M.dir[d];S&&($o(),Gi(S,c,8,[s.el,M,s,n]),Ko())}}const QF=Symbol("_vte"),WA=s=>s.__isTeleport,Vo=Symbol("_leaveCb"),hp=Symbol("_enterCb");function zF(){const s={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return mM(()=>{s.isMounted=!0}),r1(()=>{s.isUnmounting=!0}),s}const _i=[Function,Array],JA={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:_i,onEnter:_i,onAfterEnter:_i,onEnterCancelled:_i,onBeforeLeave:_i,onLeave:_i,onAfterLeave:_i,onLeaveCancelled:_i,onBeforeAppear:_i,onAppear:_i,onAfterAppear:_i,onAppearCancelled:_i},QA=s=>{const n=s.subTree;return n.component?QA(n.component):n},XF={name:"BaseTransition",props:JA,setup(s,{slots:n}){const c=yM(),d=zF();return()=>{const f=n.default&&ZA(n.default(),!0);if(!f||!f.length)return;const m=zA(f),y=mr(s),{mode:M}=y;if(d.isLeaving)return yv(m);const S=KC(m);if(!S)return yv(m);let E=Ry(S,y,d,c,R=>E=R);S.type!==Hn&&wu(S,E);let b=c.subTree&&KC(c.subTree);if(b&&b.type!==Hn&&!ka(S,b)&&QA(c).type!==Hn){let R=Ry(b,y,d,c);if(wu(b,R),M==="out-in"&&S.type!==Hn)return d.isLeaving=!0,R.afterLeave=()=>{d.isLeaving=!1,c.job.flags&8||c.update(),delete R.afterLeave,b=void 0},yv(m);M==="in-out"&&S.type!==Hn?R.delayLeave=(x,L,q)=>{const D=XA(d,b);D[String(b.key)]=b,x[Vo]=()=>{L(),x[Vo]=void 0,delete E.delayedLeave,b=void 0},E.delayedLeave=()=>{q(),delete E.delayedLeave,b=void 0}}:b=void 0}else b&&(b=void 0);return m}}};function zA(s){let n=s[0];if(s.length>1){for(const c of s)if(c.type!==Hn){n=c;break}}return n}const ZF=XF;function XA(s,n){const{leavingVNodes:c}=s;let d=c.get(n.type);return d||(d=Object.create(null),c.set(n.type,d)),d}function Ry(s,n,c,d,f){const{appear:m,mode:y,persisted:M=!1,onBeforeEnter:S,onEnter:E,onAfterEnter:b,onEnterCancelled:R,onBeforeLeave:x,onLeave:L,onAfterLeave:q,onLeaveCancelled:D,onBeforeAppear:G,onAppear:J,onAfterAppear:ne,onAppearCancelled:z}=n,$=String(s.key),Z=XA(c,s),le=(B,me)=>{B&&Gi(B,d,9,me)},fe=(B,me)=>{const Ee=me[1];le(B,me),Bt(B)?B.every(ve=>ve.length<=1)&&Ee():B.length<=1&&Ee()},oe={mode:y,persisted:M,beforeEnter(B){let me=S;if(!c.isMounted)if(m)me=G||S;else return;B[Vo]&&B[Vo](!0);const Ee=Z[$];Ee&&ka(s,Ee)&&Ee.el[Vo]&&Ee.el[Vo](),le(me,[B])},enter(B){let me=E,Ee=b,ve=R;if(!c.isMounted)if(m)me=J||E,Ee=ne||b,ve=z||R;else return;let qe=!1;const Qe=B[hp]=ut=>{qe||(qe=!0,ut?le(ve,[B]):le(Ee,[B]),oe.delayedLeave&&oe.delayedLeave(),B[hp]=void 0)};me?fe(me,[B,Qe]):Qe()},leave(B,me){const Ee=String(s.key);if(B[hp]&&B[hp](!0),c.isUnmounting)return me();le(x,[B]);let ve=!1;const qe=B[Vo]=Qe=>{ve||(ve=!0,me(),Qe?le(D,[B]):le(q,[B]),B[Vo]=void 0,Z[Ee]===s&&delete Z[Ee])};Z[Ee]=s,L?fe(L,[B,qe]):qe()},clone(B){const me=Ry(B,n,c,d,f);return f&&f(me),me}};return oe}function yv(s){if(ah(s))return s=jo(s),s.children=null,s}function KC(s){if(!ah(s))return WA(s.type)&&s.children?zA(s.children):s;const{shapeFlag:n,children:c}=s;if(c){if(n&16)return c[0];if(n&32&&Ht(c.default))return c.default()}}function wu(s,n){s.shapeFlag&6&&s.component?(s.transition=n,wu(s.component.subTree,n)):s.shapeFlag&128?(s.ssContent.transition=n.clone(s.ssContent),s.ssFallback.transition=n.clone(s.ssFallback)):s.transition=n}function ZA(s,n=!1,c){let d=[],f=0;for(let m=0;m<s.length;m++){let y=s[m];const M=c==null?y.key:String(c)+String(y.key!=null?y.key:m);y.type===si?(y.patchFlag&128&&f++,d=d.concat(ZA(y.children,n,M))):(n||y.type!==Hn)&&d.push(M!=null?jo(y,{key:M}):y)}if(f>1)for(let m=0;m<d.length;m++)d[m].patchFlag=-2;return d}/*! #__NO_SIDE_EFFECTS__ */function fM(s,n){return Ht(s)?dn({name:s.name},n,{setup:s}):s}function e1(s){s.ids=[s.ids[0]+s.ids[2]+++"-",0,0]}function Bp(s,n,c,d,f=!1){if(Bt(s)){s.forEach((q,D)=>Bp(q,n&&(Bt(n)?n[D]:n),c,d,f));return}if(Yc(d)&&!f){d.shapeFlag&512&&d.type.__asyncResolved&&d.component.subTree.component&&Bp(s,n,c,d.component.subTree);return}const m=d.shapeFlag&4?dh(d.component):d.el,y=f?null:m,{i:M,r:S}=s,E=n&&n.r,b=M.refs===Rr?M.refs={}:M.refs,R=M.setupState,x=mr(R),L=R===Rr?()=>!1:q=>Mr(x,q);if(E!=null&&E!==S&&(Jr(E)?(b[E]=null,L(E)&&(R[E]=null)):Nn(E)&&(E.value=null)),Ht(S))Hu(S,M,12,[y,b]);else{const q=Jr(S),D=Nn(S);if(q||D){const G=()=>{if(s.f){const J=q?L(S)?R[S]:b[S]:S.value;f?Bt(J)&&rM(J,m):Bt(J)?J.includes(m)||J.push(m):q?(b[S]=[m],L(S)&&(R[S]=b[S])):(S.value=[m],s.k&&(b[s.k]=S.value))}else q?(b[S]=y,L(S)&&(R[S]=y)):D&&(S.value=y,s.k&&(b[s.k]=y))};y?(G.id=-1,ti(G,c)):G()}}}nh().requestIdleCallback;nh().cancelIdleCallback;const Yc=s=>!!s.type.__asyncLoader,ah=s=>s.type.__isKeepAlive;function eB(s,n){t1(s,"a",n)}function tB(s,n){t1(s,"da",n)}function t1(s,n,c=mn){const d=s.__wdc||(s.__wdc=()=>{let f=c;for(;f;){if(f.isDeactivated)return;f=f.parent}return s()});if(ch(n,d,c),c){let f=c.parent;for(;f&&f.parent;)ah(f.parent.vnode)&&rB(d,n,c,f),f=f.parent}}function rB(s,n,c,d){const f=ch(n,s,d,!0);n1(()=>{rM(d[n],f)},c)}function ch(s,n,c=mn,d=!1){if(c){const f=c[s]||(c[s]=[]),m=n.__weh||(n.__weh=(...y)=>{$o();const M=$u(c),S=Gi(n,c,s,y);return M(),Ko(),S});return d?f.unshift(m):f.push(m),m}}const zs=s=>(n,c=mn)=>{(!Lu||s==="sp")&&ch(s,(...d)=>n(...d),c)},nB=zs("bm"),mM=zs("m"),iB=zs("bu"),sB=zs("u"),r1=zs("bum"),n1=zs("um"),oB=zs("sp"),aB=zs("rtg"),cB=zs("rtc");function lB(s,n=mn){ch("ec",s,n)}const uB="components";function Ny(s,n){return pB(uB,s,!0,n)||s}const dB=Symbol.for("v-ndc");function pB(s,n,c=!0,d=!1){const f=un||mn;if(f){const m=f.type;{const M=ZB(m,!1);if(M&&(M===n||M===bi(n)||M===rh(bi(n))))return m}const y=YC(f[s]||m[s],n)||YC(f.appContext[s],n);return!y&&d?m:y}}function YC(s,n){return s&&(s[n]||s[bi(n)]||s[rh(bi(n))])}function M7(s,n,c,d){let f;const m=c,y=Bt(s);if(y||Jr(s)){const M=y&&$c(s);let S=!1;M&&(S=!Ci(s),s=ih(s)),f=new Array(s.length);for(let E=0,b=s.length;E<b;E++)f[E]=n(S?An(s[E]):s[E],E,void 0,m)}else if(typeof s=="number"){f=new Array(s);for(let M=0;M<s;M++)f[M]=n(M+1,M,void 0,m)}else if(Vr(s))if(s[Symbol.iterator])f=Array.from(s,(M,S)=>n(M,S,void 0,m));else{const M=Object.keys(s);f=new Array(M.length);for(let S=0,E=M.length;S<E;S++){const b=M[S];f[S]=n(s[b],b,S,m)}}else f=[];return f}function T7(s,n,c={},d,f){if(un.ce||un.parent&&Yc(un.parent)&&un.parent.ce)return n!=="default"&&(c.name=n),xa(),Py(si,null,[cn("slot",c,d&&d())],64);let m=s[n];m&&m._c&&(m._d=!1),xa();const y=m&&i1(m(c)),M=c.key||y&&y.key,S=Py(si,{key:(M&&!Qs(M)?M:`_${n}`)+(!y&&d?"_fb":"")},y||(d?d():[]),y&&s._===1?64:-2);return m&&m._c&&(m._d=!0),S}function i1(s){return s.some(n=>Pu(n)?!(n.type===Hn||n.type===si&&!i1(n.children)):!0)?s:null}const ky=s=>s?C1(s)?dh(s):ky(s.parent):null,Tu=dn(Object.create(null),{$:s=>s,$el:s=>s.vnode.el,$data:s=>s.data,$props:s=>s.props,$attrs:s=>s.attrs,$slots:s=>s.slots,$refs:s=>s.refs,$parent:s=>ky(s.parent),$root:s=>ky(s.root),$host:s=>s.ce,$emit:s=>s.emit,$options:s=>o1(s),$forceUpdate:s=>s.f||(s.f=()=>{hM(s.update)}),$nextTick:s=>s.n||(s.n=jA.bind(s.proxy)),$watch:s=>xB.bind(s)}),_v=(s,n)=>s!==Rr&&!s.__isScriptSetup&&Mr(s,n),hB={get({_:s},n){if(n==="__v_skip")return!0;const{ctx:c,setupState:d,data:f,props:m,accessCache:y,type:M,appContext:S}=s;let E;if(n[0]!=="$"){const L=y[n];if(L!==void 0)switch(L){case 1:return d[n];case 2:return f[n];case 4:return c[n];case 3:return m[n]}else{if(_v(d,n))return y[n]=1,d[n];if(f!==Rr&&Mr(f,n))return y[n]=2,f[n];if((E=s.propsOptions[0])&&Mr(E,n))return y[n]=3,m[n];if(c!==Rr&&Mr(c,n))return y[n]=4,c[n];Oy&&(y[n]=0)}}const b=Tu[n];let R,x;if(b)return n==="$attrs"&&bn(s.attrs,"get",""),b(s);if((R=M.__cssModules)&&(R=R[n]))return R;if(c!==Rr&&Mr(c,n))return y[n]=4,c[n];if(x=S.config.globalProperties,Mr(x,n))return x[n]},set({_:s},n,c){const{data:d,setupState:f,ctx:m}=s;return _v(f,n)?(f[n]=c,!0):d!==Rr&&Mr(d,n)?(d[n]=c,!0):Mr(s.props,n)||n[0]==="$"&&n.slice(1)in s?!1:(m[n]=c,!0)},has({_:{data:s,setupState:n,accessCache:c,ctx:d,appContext:f,propsOptions:m}},y){let M;return!!c[y]||s!==Rr&&Mr(s,y)||_v(n,y)||(M=m[0])&&Mr(M,y)||Mr(d,y)||Mr(Tu,y)||Mr(f.config.globalProperties,y)},defineProperty(s,n,c){return c.get!=null?s._.accessCache[n]=0:Mr(c,"value")&&this.set(s,n,c.value,null),Reflect.defineProperty(s,n,c)}};function WC(s){return Bt(s)?s.reduce((n,c)=>(n[c]=null,n),{}):s}let Oy=!0;function fB(s){const n=o1(s),c=s.proxy,d=s.ctx;Oy=!1,n.beforeCreate&&JC(n.beforeCreate,s,"bc");const{data:f,computed:m,methods:y,watch:M,provide:S,inject:E,created:b,beforeMount:R,mounted:x,beforeUpdate:L,updated:q,activated:D,deactivated:G,beforeDestroy:J,beforeUnmount:ne,destroyed:z,unmounted:$,render:Z,renderTracked:le,renderTriggered:fe,errorCaptured:oe,serverPrefetch:B,expose:me,inheritAttrs:Ee,components:ve,directives:qe,filters:Qe}=n;if(E&&mB(E,d,null),y)for(const Fe in y){const Xe=y[Fe];Ht(Xe)&&(d[Fe]=Xe.bind(c))}if(f){const Fe=f.call(c,c);Vr(Fe)&&(s.data=sh(Fe))}if(Oy=!0,m)for(const Fe in m){const Xe=m[Fe],yt=Ht(Xe)?Xe.bind(c,c):Ht(Xe.get)?Xe.get.bind(c,c):as,Wt=!Ht(Xe)&&Ht(Xe.set)?Xe.set.bind(c):as,jt=Mi({get:yt,set:Wt});Object.defineProperty(d,Fe,{enumerable:!0,configurable:!0,get:()=>jt.value,set:Tt=>jt.value=Tt})}if(M)for(const Fe in M)s1(M[Fe],d,c,Fe);if(S){const Fe=Ht(S)?S.call(c):S;Reflect.ownKeys(Fe).forEach(Xe=>{Cp(Xe,Fe[Xe])})}b&&JC(b,s,"c");function he(Fe,Xe){Bt(Xe)?Xe.forEach(yt=>Fe(yt.bind(c))):Xe&&Fe(Xe.bind(c))}if(he(nB,R),he(mM,x),he(iB,L),he(sB,q),he(eB,D),he(tB,G),he(lB,oe),he(cB,le),he(aB,fe),he(r1,ne),he(n1,$),he(oB,B),Bt(me))if(me.length){const Fe=s.exposed||(s.exposed={});me.forEach(Xe=>{Object.defineProperty(Fe,Xe,{get:()=>c[Xe],set:yt=>c[Xe]=yt})})}else s.exposed||(s.exposed={});Z&&s.render===as&&(s.render=Z),Ee!=null&&(s.inheritAttrs=Ee),ve&&(s.components=ve),qe&&(s.directives=qe),B&&e1(s)}function mB(s,n,c=as){Bt(s)&&(s=wy(s));for(const d in s){const f=s[d];let m;Vr(f)?"default"in f?m=Fi(f.from||d,f.default,!0):m=Fi(f.from||d):m=Fi(f),Nn(m)?Object.defineProperty(n,d,{enumerable:!0,configurable:!0,get:()=>m.value,set:y=>m.value=y}):n[d]=m}}function JC(s,n,c){Gi(Bt(s)?s.map(d=>d.bind(n.proxy)):s.bind(n.proxy),n,c)}function s1(s,n,c,d){let f=d.includes(".")?M1(c,d):()=>c[d];if(Jr(s)){const m=n[s];Ht(m)&&bp(f,m)}else if(Ht(s))bp(f,s.bind(c));else if(Vr(s))if(Bt(s))s.forEach(m=>s1(m,n,c,d));else{const m=Ht(s.handler)?s.handler.bind(c):n[s.handler];Ht(m)&&bp(f,m,s)}}function o1(s){const n=s.type,{mixins:c,extends:d}=n,{mixins:f,optionsCache:m,config:{optionMergeStrategies:y}}=s.appContext,M=m.get(n);let S;return M?S=M:!f.length&&!c&&!d?S=n:(S={},f.length&&f.forEach(E=>qp(S,E,y,!0)),qp(S,n,y)),Vr(n)&&m.set(n,S),S}function qp(s,n,c,d=!1){const{mixins:f,extends:m}=n;m&&qp(s,m,c,!0),f&&f.forEach(y=>qp(s,y,c,!0));for(const y in n)if(!(d&&y==="expose")){const M=gB[y]||c&&c[y];s[y]=M?M(s[y],n[y]):n[y]}return s}const gB={data:QC,props:zC,emits:zC,methods:mu,computed:mu,beforeCreate:Fn,created:Fn,beforeMount:Fn,mounted:Fn,beforeUpdate:Fn,updated:Fn,beforeDestroy:Fn,beforeUnmount:Fn,destroyed:Fn,unmounted:Fn,activated:Fn,deactivated:Fn,errorCaptured:Fn,serverPrefetch:Fn,components:mu,directives:mu,watch:yB,provide:QC,inject:vB};function QC(s,n){return n?s?function(){return dn(Ht(s)?s.call(this,this):s,Ht(n)?n.call(this,this):n)}:n:s}function vB(s,n){return mu(wy(s),wy(n))}function wy(s){if(Bt(s)){const n={};for(let c=0;c<s.length;c++)n[s[c]]=s[c];return n}return s}function Fn(s,n){return s?[...new Set([].concat(s,n))]:n}function mu(s,n){return s?dn(Object.create(null),s,n):n}function zC(s,n){return s?Bt(s)&&Bt(n)?[...new Set([...s,...n])]:dn(Object.create(null),WC(s),WC(n??{})):n}function yB(s,n){if(!s)return n;if(!n)return s;const c=dn(Object.create(null),s);for(const d in n)c[d]=Fn(s[d],n[d]);return c}function a1(){return{app:null,config:{isNativeTag:oF,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let _B=0;function MB(s,n){return function(d,f=null){Ht(d)||(d=dn({},d)),f!=null&&!Vr(f)&&(f=null);const m=a1(),y=new WeakSet,M=[];let S=!1;const E=m.app={_uid:_B++,_component:d,_props:f,_container:null,_context:m,_instance:null,version:tq,get config(){return m.config},set config(b){},use(b,...R){return y.has(b)||(b&&Ht(b.install)?(y.add(b),b.install(E,...R)):Ht(b)&&(y.add(b),b(E,...R))),E},mixin(b){return m.mixins.includes(b)||m.mixins.push(b),E},component(b,R){return R?(m.components[b]=R,E):m.components[b]},directive(b,R){return R?(m.directives[b]=R,E):m.directives[b]},mount(b,R,x){if(!S){const L=E._ceVNode||cn(d,f);return L.appContext=m,x===!0?x="svg":x===!1&&(x=void 0),s(L,b,x),S=!0,E._container=b,b.__vue_app__=E,dh(L.component)}},onUnmount(b){M.push(b)},unmount(){S&&(Gi(M,E._instance,16),s(null,E._container),delete E._container.__vue_app__)},provide(b,R){return m.provides[b]=R,E},runWithContext(b){const R=Wc;Wc=E;try{return b()}finally{Wc=R}}};return E}}let Wc=null;function Cp(s,n){if(mn){let c=mn.provides;const d=mn.parent&&mn.parent.provides;d===c&&(c=mn.provides=Object.create(d)),c[s]=n}}function Fi(s,n,c=!1){const d=mn||un;if(d||Wc){const f=Wc?Wc._context.provides:d?d.parent==null?d.vnode.appContext&&d.vnode.appContext.provides:d.parent.provides:void 0;if(f&&s in f)return f[s];if(arguments.length>1)return c&&Ht(n)?n.call(d&&d.proxy):n}}const c1={},l1=()=>Object.create(c1),u1=s=>Object.getPrototypeOf(s)===c1;function TB(s,n,c,d=!1){const f={},m=l1();s.propsDefaults=Object.create(null),d1(s,n,f,m);for(const y in s.propsOptions[0])y in f||(f[y]=void 0);c?s.props=d?f:UA(f):s.type.props?s.props=f:s.props=m,s.attrs=m}function IB(s,n,c,d){const{props:f,attrs:m,vnode:{patchFlag:y}}=s,M=mr(f),[S]=s.propsOptions;let E=!1;if((d||y>0)&&!(y&16)){if(y&8){const b=s.vnode.dynamicProps;for(let R=0;R<b.length;R++){let x=b[R];if(lh(s.emitsOptions,x))continue;const L=n[x];if(S)if(Mr(m,x))L!==m[x]&&(m[x]=L,E=!0);else{const q=bi(x);f[q]=xy(S,M,q,L,s,!1)}else L!==m[x]&&(m[x]=L,E=!0)}}}else{d1(s,n,f,m)&&(E=!0);let b;for(const R in M)(!n||!Mr(n,R)&&((b=Fa(R))===R||!Mr(n,b)))&&(S?c&&(c[R]!==void 0||c[b]!==void 0)&&(f[R]=xy(S,M,R,void 0,s,!0)):delete f[R]);if(m!==M)for(const R in m)(!n||!Mr(n,R))&&(delete m[R],E=!0)}E&&Gs(s.attrs,"set","")}function d1(s,n,c,d){const[f,m]=s.propsOptions;let y=!1,M;if(n)for(let S in n){if(yu(S))continue;const E=n[S];let b;f&&Mr(f,b=bi(S))?!m||!m.includes(b)?c[b]=E:(M||(M={}))[b]=E:lh(s.emitsOptions,S)||(!(S in d)||E!==d[S])&&(d[S]=E,y=!0)}if(m){const S=mr(c),E=M||Rr;for(let b=0;b<m.length;b++){const R=m[b];c[R]=xy(f,S,R,E[R],s,!Mr(E,R))}}return y}function xy(s,n,c,d,f,m){const y=s[c];if(y!=null){const M=Mr(y,"default");if(M&&d===void 0){const S=y.default;if(y.type!==Function&&!y.skipFactory&&Ht(S)){const{propsDefaults:E}=f;if(c in E)d=E[c];else{const b=$u(f);d=E[c]=S.call(null,n),b()}}else d=S;f.ce&&f.ce._setProp(c,d)}y[0]&&(m&&!M?d=!1:y[1]&&(d===""||d===Fa(c))&&(d=!0))}return d}const SB=new WeakMap;function p1(s,n,c=!1){const d=c?SB:n.propsCache,f=d.get(s);if(f)return f;const m=s.props,y={},M=[];let S=!1;if(!Ht(s)){const b=R=>{S=!0;const[x,L]=p1(R,n,!0);dn(y,x),L&&M.push(...L)};!c&&n.mixins.length&&n.mixins.forEach(b),s.extends&&b(s.extends),s.mixins&&s.mixins.forEach(b)}if(!m&&!S)return Vr(s)&&d.set(s,jc),jc;if(Bt(m))for(let b=0;b<m.length;b++){const R=bi(m[b]);XC(R)&&(y[R]=Rr)}else if(m)for(const b in m){const R=bi(b);if(XC(R)){const x=m[b],L=y[R]=Bt(x)||Ht(x)?{type:x}:dn({},x),q=L.type;let D=!1,G=!0;if(Bt(q))for(let J=0;J<q.length;++J){const ne=q[J],z=Ht(ne)&&ne.name;if(z==="Boolean"){D=!0;break}else z==="String"&&(G=!1)}else D=Ht(q)&&q.name==="Boolean";L[0]=D,L[1]=G,(D||Mr(L,"default"))&&M.push(R)}}const E=[y,M];return Vr(s)&&d.set(s,E),E}function XC(s){return s[0]!=="$"&&!yu(s)}const h1=s=>s[0]==="_"||s==="$stable",gM=s=>Bt(s)?s.map(ss):[ss(s)],EB=(s,n,c)=>{if(n._n)return n;const d=Ep((...f)=>gM(n(...f)),c);return d._c=!1,d},f1=(s,n,c)=>{const d=s._ctx;for(const f in s){if(h1(f))continue;const m=s[f];if(Ht(m))n[f]=EB(f,m,d);else if(m!=null){const y=gM(m);n[f]=()=>y}}},m1=(s,n)=>{const c=gM(n);s.slots.default=()=>c},g1=(s,n,c)=>{for(const d in n)(c||d!=="_")&&(s[d]=n[d])},CB=(s,n,c)=>{const d=s.slots=l1();if(s.vnode.shapeFlag&32){const f=n._;f?(g1(d,n,c),c&&MA(d,"_",f,!0)):f1(n,d)}else n&&m1(s,n)},bB=(s,n,c)=>{const{vnode:d,slots:f}=s;let m=!0,y=Rr;if(d.shapeFlag&32){const M=n._;M?c&&M===1?m=!1:g1(f,n,c):(m=!n.$stable,f1(n,f)),y=n}else n&&(m1(s,n),y={default:1});if(m)for(const M in f)!h1(M)&&y[M]==null&&delete f[M]},ti=BB;function AB(s){return RB(s)}function RB(s,n){const c=nh();c.__VUE__=!0;const{insert:d,remove:f,patchProp:m,createElement:y,createText:M,createComment:S,setText:E,setElementText:b,parentNode:R,nextSibling:x,setScopeId:L=as,insertStaticContent:q}=s,D=(X,K,de,Ae=null,ke=null,Ne=null,De=void 0,Ue=null,Ve=!!K.dynamicChildren)=>{if(X===K)return;X&&!ka(X,K)&&(Ae=ue(X),Tt(X,ke,Ne,!0),X=null),K.patchFlag===-2&&(Ve=!1,K.dynamicChildren=null);const{type:Ye,ref:Ge,shapeFlag:ot}=K;switch(Ye){case uh:G(X,K,de,Ae);break;case Hn:J(X,K,de,Ae);break;case Tv:X==null&&ne(K,de,Ae,De);break;case si:ve(X,K,de,Ae,ke,Ne,De,Ue,Ve);break;default:ot&1?Z(X,K,de,Ae,ke,Ne,De,Ue,Ve):ot&6?qe(X,K,de,Ae,ke,Ne,De,Ue,Ve):(ot&64||ot&128)&&Ye.process(X,K,de,Ae,ke,Ne,De,Ue,Ve,_e)}Ge!=null&&ke&&Bp(Ge,X&&X.ref,Ne,K||X,!K)},G=(X,K,de,Ae)=>{if(X==null)d(K.el=M(K.children),de,Ae);else{const ke=K.el=X.el;K.children!==X.children&&E(ke,K.children)}},J=(X,K,de,Ae)=>{X==null?d(K.el=S(K.children||""),de,Ae):K.el=X.el},ne=(X,K,de,Ae)=>{[X.el,X.anchor]=q(X.children,K,de,Ae,X.el,X.anchor)},z=({el:X,anchor:K},de,Ae)=>{let ke;for(;X&&X!==K;)ke=x(X),d(X,de,Ae),X=ke;d(K,de,Ae)},$=({el:X,anchor:K})=>{let de;for(;X&&X!==K;)de=x(X),f(X),X=de;f(K)},Z=(X,K,de,Ae,ke,Ne,De,Ue,Ve)=>{K.type==="svg"?De="svg":K.type==="math"&&(De="mathml"),X==null?le(K,de,Ae,ke,Ne,De,Ue,Ve):B(X,K,ke,Ne,De,Ue,Ve)},le=(X,K,de,Ae,ke,Ne,De,Ue)=>{let Ve,Ye;const{props:Ge,shapeFlag:ot,transition:It,dirs:kt}=X;if(Ve=X.el=y(X.type,Ne,Ge&&Ge.is,Ge),ot&8?b(Ve,X.children):ot&16&&oe(X.children,Ve,null,Ae,ke,Mv(X,Ne),De,Ue),kt&&Ea(X,null,Ae,"created"),fe(Ve,X,X.scopeId,De,Ae),Ge){for(const nr in Ge)nr!=="value"&&!yu(nr)&&m(Ve,nr,null,Ge[nr],Ne,Ae);"value"in Ge&&m(Ve,"value",null,Ge.value,Ne),(Ye=Ge.onVnodeBeforeMount)&&ns(Ye,Ae,X)}kt&&Ea(X,null,Ae,"beforeMount");const Jt=NB(ke,It);Jt&&It.beforeEnter(Ve),d(Ve,K,de),((Ye=Ge&&Ge.onVnodeMounted)||Jt||kt)&&ti(()=>{Ye&&ns(Ye,Ae,X),Jt&&It.enter(Ve),kt&&Ea(X,null,Ae,"mounted")},ke)},fe=(X,K,de,Ae,ke)=>{if(de&&L(X,de),Ae)for(let Ne=0;Ne<Ae.length;Ne++)L(X,Ae[Ne]);if(ke){let Ne=ke.subTree;if(K===Ne||I1(Ne.type)&&(Ne.ssContent===K||Ne.ssFallback===K)){const De=ke.vnode;fe(X,De,De.scopeId,De.slotScopeIds,ke.parent)}}},oe=(X,K,de,Ae,ke,Ne,De,Ue,Ve=0)=>{for(let Ye=Ve;Ye<X.length;Ye++){const Ge=X[Ye]=Ue?Do(X[Ye]):ss(X[Ye]);D(null,Ge,K,de,Ae,ke,Ne,De,Ue)}},B=(X,K,de,Ae,ke,Ne,De)=>{const Ue=K.el=X.el;let{patchFlag:Ve,dynamicChildren:Ye,dirs:Ge}=K;Ve|=X.patchFlag&16;const ot=X.props||Rr,It=K.props||Rr;let kt;if(de&&Ca(de,!1),(kt=It.onVnodeBeforeUpdate)&&ns(kt,de,K,X),Ge&&Ea(K,X,de,"beforeUpdate"),de&&Ca(de,!0),(ot.innerHTML&&It.innerHTML==null||ot.textContent&&It.textContent==null)&&b(Ue,""),Ye?me(X.dynamicChildren,Ye,Ue,de,Ae,Mv(K,ke),Ne):De||Xe(X,K,Ue,null,de,Ae,Mv(K,ke),Ne,!1),Ve>0){if(Ve&16)Ee(Ue,ot,It,de,ke);else if(Ve&2&&ot.class!==It.class&&m(Ue,"class",null,It.class,ke),Ve&4&&m(Ue,"style",ot.style,It.style,ke),Ve&8){const Jt=K.dynamicProps;for(let nr=0;nr<Jt.length;nr++){const Xt=Jt[nr],kn=ot[Xt],Er=It[Xt];(Er!==kn||Xt==="value")&&m(Ue,Xt,kn,Er,ke,de)}}Ve&1&&X.children!==K.children&&b(Ue,K.children)}else!De&&Ye==null&&Ee(Ue,ot,It,de,ke);((kt=It.onVnodeUpdated)||Ge)&&ti(()=>{kt&&ns(kt,de,K,X),Ge&&Ea(K,X,de,"updated")},Ae)},me=(X,K,de,Ae,ke,Ne,De)=>{for(let Ue=0;Ue<K.length;Ue++){const Ve=X[Ue],Ye=K[Ue],Ge=Ve.el&&(Ve.type===si||!ka(Ve,Ye)||Ve.shapeFlag&70)?R(Ve.el):de;D(Ve,Ye,Ge,null,Ae,ke,Ne,De,!0)}},Ee=(X,K,de,Ae,ke)=>{if(K!==de){if(K!==Rr)for(const Ne in K)!yu(Ne)&&!(Ne in de)&&m(X,Ne,K[Ne],null,ke,Ae);for(const Ne in de){if(yu(Ne))continue;const De=de[Ne],Ue=K[Ne];De!==Ue&&Ne!=="value"&&m(X,Ne,Ue,De,ke,Ae)}"value"in de&&m(X,"value",K.value,de.value,ke)}},ve=(X,K,de,Ae,ke,Ne,De,Ue,Ve)=>{const Ye=K.el=X?X.el:M(""),Ge=K.anchor=X?X.anchor:M("");let{patchFlag:ot,dynamicChildren:It,slotScopeIds:kt}=K;kt&&(Ue=Ue?Ue.concat(kt):kt),X==null?(d(Ye,de,Ae),d(Ge,de,Ae),oe(K.children||[],de,Ge,ke,Ne,De,Ue,Ve)):ot>0&&ot&64&&It&&X.dynamicChildren?(me(X.dynamicChildren,It,de,ke,Ne,De,Ue),(K.key!=null||ke&&K===ke.subTree)&&v1(X,K,!0)):Xe(X,K,de,Ge,ke,Ne,De,Ue,Ve)},qe=(X,K,de,Ae,ke,Ne,De,Ue,Ve)=>{K.slotScopeIds=Ue,X==null?K.shapeFlag&512?ke.ctx.activate(K,de,Ae,De,Ve):Qe(K,de,Ae,ke,Ne,De,Ve):ut(X,K,Ve)},Qe=(X,K,de,Ae,ke,Ne,De)=>{const Ue=X.component=WB(X,Ae,ke);if(ah(X)&&(Ue.ctx.renderer=_e),JB(Ue,!1,De),Ue.asyncDep){if(ke&&ke.registerDep(Ue,he,De),!X.el){const Ve=Ue.subTree=cn(Hn);J(null,Ve,K,de)}}else he(Ue,X,K,de,ke,Ne,De)},ut=(X,K,de)=>{const Ae=K.component=X.component;if(UB(X,K,de))if(Ae.asyncDep&&!Ae.asyncResolved){Fe(Ae,K,de);return}else Ae.next=K,Ae.update();else K.el=X.el,Ae.vnode=K},he=(X,K,de,Ae,ke,Ne,De)=>{const Ue=()=>{if(X.isMounted){let{next:ot,bu:It,u:kt,parent:Jt,vnode:nr}=X;{const Ct=y1(X);if(Ct){ot&&(ot.el=nr.el,Fe(X,ot,De)),Ct.asyncDep.then(()=>{X.isUnmounted||Ue()});return}}let Xt=ot,kn;Ca(X,!1),ot?(ot.el=nr.el,Fe(X,ot,De)):ot=nr,It&&hv(It),(kn=ot.props&&ot.props.onVnodeBeforeUpdate)&&ns(kn,Jt,ot,nr),Ca(X,!0);const Er=eb(X),ui=X.subTree;X.subTree=Er,D(ui,Er,R(ui.el),ue(ui),X,ke,Ne),ot.el=Er.el,Xt===null&&FB(X,Er.el),kt&&ti(kt,ke),(kn=ot.props&&ot.props.onVnodeUpdated)&&ti(()=>ns(kn,Jt,ot,nr),ke)}else{let ot;const{el:It,props:kt}=K,{bm:Jt,m:nr,parent:Xt,root:kn,type:Er}=X,ui=Yc(K);Ca(X,!1),Jt&&hv(Jt),!ui&&(ot=kt&&kt.onVnodeBeforeMount)&&ns(ot,Xt,K),Ca(X,!0);{kn.ce&&kn.ce._injectChildStyle(Er);const Ct=X.subTree=eb(X);D(null,Ct,de,Ae,X,ke,Ne),K.el=Ct.el}if(nr&&ti(nr,ke),!ui&&(ot=kt&&kt.onVnodeMounted)){const Ct=K;ti(()=>ns(ot,Xt,Ct),ke)}(K.shapeFlag&256||Xt&&Yc(Xt.vnode)&&Xt.vnode.shapeFlag&256)&&X.a&&ti(X.a,ke),X.isMounted=!0,K=de=Ae=null}};X.scope.on();const Ve=X.effect=new EA(Ue);X.scope.off();const Ye=X.update=Ve.run.bind(Ve),Ge=X.job=Ve.runIfDirty.bind(Ve);Ge.i=X,Ge.id=X.uid,Ve.scheduler=()=>hM(Ge),Ca(X,!0),Ye()},Fe=(X,K,de)=>{K.component=X;const Ae=X.vnode.props;X.vnode=K,X.next=null,IB(X,K.props,Ae,de),bB(X,K.children,de),$o(),$C(X),Ko()},Xe=(X,K,de,Ae,ke,Ne,De,Ue,Ve=!1)=>{const Ye=X&&X.children,Ge=X?X.shapeFlag:0,ot=K.children,{patchFlag:It,shapeFlag:kt}=K;if(It>0){if(It&128){Wt(Ye,ot,de,Ae,ke,Ne,De,Ue,Ve);return}else if(It&256){yt(Ye,ot,de,Ae,ke,Ne,De,Ue,Ve);return}}kt&8?(Ge&16&&St(Ye,ke,Ne),ot!==Ye&&b(de,ot)):Ge&16?kt&16?Wt(Ye,ot,de,Ae,ke,Ne,De,Ue,Ve):St(Ye,ke,Ne,!0):(Ge&8&&b(de,""),kt&16&&oe(ot,de,Ae,ke,Ne,De,Ue,Ve))},yt=(X,K,de,Ae,ke,Ne,De,Ue,Ve)=>{X=X||jc,K=K||jc;const Ye=X.length,Ge=K.length,ot=Math.min(Ye,Ge);let It;for(It=0;It<ot;It++){const kt=K[It]=Ve?Do(K[It]):ss(K[It]);D(X[It],kt,de,null,ke,Ne,De,Ue,Ve)}Ye>Ge?St(X,ke,Ne,!0,!1,ot):oe(K,de,Ae,ke,Ne,De,Ue,Ve,ot)},Wt=(X,K,de,Ae,ke,Ne,De,Ue,Ve)=>{let Ye=0;const Ge=K.length;let ot=X.length-1,It=Ge-1;for(;Ye<=ot&&Ye<=It;){const kt=X[Ye],Jt=K[Ye]=Ve?Do(K[Ye]):ss(K[Ye]);if(ka(kt,Jt))D(kt,Jt,de,null,ke,Ne,De,Ue,Ve);else break;Ye++}for(;Ye<=ot&&Ye<=It;){const kt=X[ot],Jt=K[It]=Ve?Do(K[It]):ss(K[It]);if(ka(kt,Jt))D(kt,Jt,de,null,ke,Ne,De,Ue,Ve);else break;ot--,It--}if(Ye>ot){if(Ye<=It){const kt=It+1,Jt=kt<Ge?K[kt].el:Ae;for(;Ye<=It;)D(null,K[Ye]=Ve?Do(K[Ye]):ss(K[Ye]),de,Jt,ke,Ne,De,Ue,Ve),Ye++}}else if(Ye>It)for(;Ye<=ot;)Tt(X[Ye],ke,Ne,!0),Ye++;else{const kt=Ye,Jt=Ye,nr=new Map;for(Ye=Jt;Ye<=It;Ye++){const On=K[Ye]=Ve?Do(K[Ye]):ss(K[Ye]);On.key!=null&&nr.set(On.key,Ye)}let Xt,kn=0;const Er=It-Jt+1;let ui=!1,Ct=0;const Wo=new Array(Er);for(Ye=0;Ye<Er;Ye++)Wo[Ye]=0;for(Ye=kt;Ye<=ot;Ye++){const On=X[Ye];if(kn>=Er){Tt(On,ke,Ne,!0);continue}let _n;if(On.key!=null)_n=nr.get(On.key);else for(Xt=Jt;Xt<=It;Xt++)if(Wo[Xt-Jt]===0&&ka(On,K[Xt])){_n=Xt;break}_n===void 0?Tt(On,ke,Ne,!0):(Wo[_n-Jt]=Ye+1,_n>=Ct?Ct=_n:ui=!0,D(On,K[_n],de,null,ke,Ne,De,Ue,Ve),kn++)}const Xu=ui?kB(Wo):jc;for(Xt=Xu.length-1,Ye=Er-1;Ye>=0;Ye--){const On=Jt+Ye,_n=K[On],Xs=On+1<Ge?K[On+1].el:Ae;Wo[Ye]===0?D(null,_n,de,Xs,ke,Ne,De,Ue,Ve):ui&&(Xt<0||Ye!==Xu[Xt]?jt(_n,de,Xs,2):Xt--)}}},jt=(X,K,de,Ae,ke=null)=>{const{el:Ne,type:De,transition:Ue,children:Ve,shapeFlag:Ye}=X;if(Ye&6){jt(X.component.subTree,K,de,Ae);return}if(Ye&128){X.suspense.move(K,de,Ae);return}if(Ye&64){De.move(X,K,de,_e);return}if(De===si){d(Ne,K,de);for(let ot=0;ot<Ve.length;ot++)jt(Ve[ot],K,de,Ae);d(X.anchor,K,de);return}if(De===Tv){z(X,K,de);return}if(Ae!==2&&Ye&1&&Ue)if(Ae===0)Ue.beforeEnter(Ne),d(Ne,K,de),ti(()=>Ue.enter(Ne),ke);else{const{leave:ot,delayLeave:It,afterLeave:kt}=Ue,Jt=()=>d(Ne,K,de),nr=()=>{ot(Ne,()=>{Jt(),kt&&kt()})};It?It(Ne,Jt,nr):nr()}else d(Ne,K,de)},Tt=(X,K,de,Ae=!1,ke=!1)=>{const{type:Ne,props:De,ref:Ue,children:Ve,dynamicChildren:Ye,shapeFlag:Ge,patchFlag:ot,dirs:It,cacheIndex:kt}=X;if(ot===-2&&(ke=!1),Ue!=null&&Bp(Ue,null,de,X,!0),kt!=null&&(K.renderCache[kt]=void 0),Ge&256){K.ctx.deactivate(X);return}const Jt=Ge&1&&It,nr=!Yc(X);let Xt;if(nr&&(Xt=De&&De.onVnodeBeforeUnmount)&&ns(Xt,K,X),Ge&6)we(X.component,de,Ae);else{if(Ge&128){X.suspense.unmount(de,Ae);return}Jt&&Ea(X,null,K,"beforeUnmount"),Ge&64?X.type.remove(X,K,de,_e,Ae):Ye&&!Ye.hasOnce&&(Ne!==si||ot>0&&ot&64)?St(Ye,K,de,!1,!0):(Ne===si&&ot&384||!ke&&Ge&16)&&St(Ve,K,de),Ae&&Le(X)}(nr&&(Xt=De&&De.onVnodeUnmounted)||Jt)&&ti(()=>{Xt&&ns(Xt,K,X),Jt&&Ea(X,null,K,"unmounted")},de)},Le=X=>{const{type:K,el:de,anchor:Ae,transition:ke}=X;if(K===si){Ce(de,Ae);return}if(K===Tv){$(X);return}const Ne=()=>{f(de),ke&&!ke.persisted&&ke.afterLeave&&ke.afterLeave()};if(X.shapeFlag&1&&ke&&!ke.persisted){const{leave:De,delayLeave:Ue}=ke,Ve=()=>De(de,Ne);Ue?Ue(X.el,Ne,Ve):Ve()}else Ne()},Ce=(X,K)=>{let de;for(;X!==K;)de=x(X),f(X),X=de;f(K)},we=(X,K,de)=>{const{bum:Ae,scope:ke,job:Ne,subTree:De,um:Ue,m:Ve,a:Ye}=X;ZC(Ve),ZC(Ye),Ae&&hv(Ae),ke.stop(),Ne&&(Ne.flags|=8,Tt(De,X,K,de)),Ue&&ti(Ue,K),ti(()=>{X.isUnmounted=!0},K),K&&K.pendingBranch&&!K.isUnmounted&&X.asyncDep&&!X.asyncResolved&&X.suspenseId===K.pendingId&&(K.deps--,K.deps===0&&K.resolve())},St=(X,K,de,Ae=!1,ke=!1,Ne=0)=>{for(let De=Ne;De<X.length;De++)Tt(X[De],K,de,Ae,ke)},ue=X=>{if(X.shapeFlag&6)return ue(X.component.subTree);if(X.shapeFlag&128)return X.suspense.next();const K=x(X.anchor||X.el),de=K&&K[QF];return de?x(de):K};let ge=!1;const be=(X,K,de)=>{X==null?K._vnode&&Tt(K._vnode,null,null,!0):D(K._vnode||null,X,K,null,null,null,de),K._vnode=X,ge||(ge=!0,$C(),$A(),ge=!1)},_e={p:D,um:Tt,m:jt,r:Le,mt:Qe,mc:oe,pc:Xe,pbc:me,n:ue,o:s};return{render:be,hydrate:void 0,createApp:MB(be)}}function Mv({type:s,props:n},c){return c==="svg"&&s==="foreignObject"||c==="mathml"&&s==="annotation-xml"&&n&&n.encoding&&n.encoding.includes("html")?void 0:c}function Ca({effect:s,job:n},c){c?(s.flags|=32,n.flags|=4):(s.flags&=-33,n.flags&=-5)}function NB(s,n){return(!s||s&&!s.pendingBranch)&&n&&!n.persisted}function v1(s,n,c=!1){const d=s.children,f=n.children;if(Bt(d)&&Bt(f))for(let m=0;m<d.length;m++){const y=d[m];let M=f[m];M.shapeFlag&1&&!M.dynamicChildren&&((M.patchFlag<=0||M.patchFlag===32)&&(M=f[m]=Do(f[m]),M.el=y.el),!c&&M.patchFlag!==-2&&v1(y,M)),M.type===uh&&(M.el=y.el)}}function kB(s){const n=s.slice(),c=[0];let d,f,m,y,M;const S=s.length;for(d=0;d<S;d++){const E=s[d];if(E!==0){if(f=c[c.length-1],s[f]<E){n[d]=f,c.push(d);continue}for(m=0,y=c.length-1;m<y;)M=m+y>>1,s[c[M]]<E?m=M+1:y=M;E<s[c[m]]&&(m>0&&(n[d]=c[m-1]),c[m]=d)}}for(m=c.length,y=c[m-1];m-- >0;)c[m]=y,y=n[y];return c}function y1(s){const n=s.subTree.component;if(n)return n.asyncDep&&!n.asyncResolved?n:y1(n)}function ZC(s){if(s)for(let n=0;n<s.length;n++)s[n].flags|=8}const OB=Symbol.for("v-scx"),wB=()=>Fi(OB);function bp(s,n,c){return _1(s,n,c)}function _1(s,n,c=Rr){const{immediate:d,deep:f,flush:m,once:y}=c,M=dn({},c),S=n&&d||!n&&m!=="post";let E;if(Lu){if(m==="sync"){const L=wB();E=L.__watcherHandles||(L.__watcherHandles=[])}else if(!S){const L=()=>{};return L.stop=as,L.resume=as,L.pause=as,L}}const b=mn;M.call=(L,q,D)=>Gi(L,b,q,D);let R=!1;m==="post"?M.scheduler=L=>{ti(L,b&&b.suspense)}:m!=="sync"&&(R=!0,M.scheduler=(L,q)=>{q?L():hM(L)}),M.augmentJob=L=>{n&&(L.flags|=4),R&&(L.flags|=2,b&&(L.id=b.uid,L.i=b))};const x=KF(s,n,M);return Lu&&(E?E.push(x):S&&x()),x}function xB(s,n,c){const d=this.proxy,f=Jr(s)?s.includes(".")?M1(d,s):()=>d[s]:s.bind(d,d);let m;Ht(n)?m=n:(m=n.handler,c=n);const y=$u(this),M=_1(f,m.bind(d),c);return y(),M}function M1(s,n){const c=n.split(".");return()=>{let d=s;for(let f=0;f<c.length&&d;f++)d=d[c[f]];return d}}const PB=(s,n)=>n==="modelValue"||n==="model-value"?s.modelModifiers:s[`${n}Modifiers`]||s[`${bi(n)}Modifiers`]||s[`${Fa(n)}Modifiers`];function LB(s,n,...c){if(s.isUnmounted)return;const d=s.vnode.props||Rr;let f=c;const m=n.startsWith("update:"),y=m&&PB(d,n.slice(7));y&&(y.trim&&(f=c.map(b=>Jr(b)?b.trim():b)),y.number&&(f=c.map(dF)));let M,S=d[M=pv(n)]||d[M=pv(bi(n))];!S&&m&&(S=d[M=pv(Fa(n))]),S&&Gi(S,s,6,f);const E=d[M+"Once"];if(E){if(!s.emitted)s.emitted={};else if(s.emitted[M])return;s.emitted[M]=!0,Gi(E,s,6,f)}}function T1(s,n,c=!1){const d=n.emitsCache,f=d.get(s);if(f!==void 0)return f;const m=s.emits;let y={},M=!1;if(!Ht(s)){const S=E=>{const b=T1(E,n,!0);b&&(M=!0,dn(y,b))};!c&&n.mixins.length&&n.mixins.forEach(S),s.extends&&S(s.extends),s.mixins&&s.mixins.forEach(S)}return!m&&!M?(Vr(s)&&d.set(s,null),null):(Bt(m)?m.forEach(S=>y[S]=null):dn(y,m),Vr(s)&&d.set(s,y),y)}function lh(s,n){return!s||!Zp(n)?!1:(n=n.slice(2).replace(/Once$/,""),Mr(s,n[0].toLowerCase()+n.slice(1))||Mr(s,Fa(n))||Mr(s,n))}function eb(s){const{type:n,vnode:c,proxy:d,withProxy:f,propsOptions:[m],slots:y,attrs:M,emit:S,render:E,renderCache:b,props:R,data:x,setupState:L,ctx:q,inheritAttrs:D}=s,G=Fp(s);let J,ne;try{if(c.shapeFlag&4){const $=f||d,Z=$;J=ss(E.call(Z,$,b,R,L,x,q)),ne=M}else{const $=n;J=ss($.length>1?$(R,{attrs:M,slots:y,emit:S}):$(R,null)),ne=n.props?M:VB(M)}}catch($){Iu.length=0,oh($,s,1),J=cn(Hn)}let z=J;if(ne&&D!==!1){const $=Object.keys(ne),{shapeFlag:Z}=z;$.length&&Z&7&&(m&&$.some(tM)&&(ne=DB(ne,m)),z=jo(z,ne,!1,!0))}return c.dirs&&(z=jo(z,null,!1,!0),z.dirs=z.dirs?z.dirs.concat(c.dirs):c.dirs),c.transition&&wu(z,c.transition),J=z,Fp(G),J}const VB=s=>{let n;for(const c in s)(c==="class"||c==="style"||Zp(c))&&((n||(n={}))[c]=s[c]);return n},DB=(s,n)=>{const c={};for(const d in s)(!tM(d)||!(d.slice(9)in n))&&(c[d]=s[d]);return c};function UB(s,n,c){const{props:d,children:f,component:m}=s,{props:y,children:M,patchFlag:S}=n,E=m.emitsOptions;if(n.dirs||n.transition)return!0;if(c&&S>=0){if(S&1024)return!0;if(S&16)return d?tb(d,y,E):!!y;if(S&8){const b=n.dynamicProps;for(let R=0;R<b.length;R++){const x=b[R];if(y[x]!==d[x]&&!lh(E,x))return!0}}}else return(f||M)&&(!M||!M.$stable)?!0:d===y?!1:d?y?tb(d,y,E):!0:!!y;return!1}function tb(s,n,c){const d=Object.keys(n);if(d.length!==Object.keys(s).length)return!0;for(let f=0;f<d.length;f++){const m=d[f];if(n[m]!==s[m]&&!lh(c,m))return!0}return!1}function FB({vnode:s,parent:n},c){for(;n;){const d=n.subTree;if(d.suspense&&d.suspense.activeBranch===s&&(d.el=s.el),d===s)(s=n.vnode).el=c,n=n.parent;else break}}const I1=s=>s.__isSuspense;function BB(s,n){n&&n.pendingBranch?Bt(s)?n.effects.push(...s):n.effects.push(s):JF(s)}const si=Symbol.for("v-fgt"),uh=Symbol.for("v-txt"),Hn=Symbol.for("v-cmt"),Tv=Symbol.for("v-stc"),Iu=[];let ci=null;function xa(s=!1){Iu.push(ci=s?null:[])}function qB(){Iu.pop(),ci=Iu[Iu.length-1]||null}let xu=1;function rb(s,n=!1){xu+=s,s<0&&ci&&n&&(ci.hasOnce=!0)}function S1(s){return s.dynamicChildren=xu>0?ci||jc:null,qB(),xu>0&&ci&&ci.push(s),s}function Ap(s,n,c,d,f,m){return S1(ri(s,n,c,d,f,m,!0))}function Py(s,n,c,d,f){return S1(cn(s,n,c,d,f,!0))}function Pu(s){return s?s.__v_isVNode===!0:!1}function ka(s,n){return s.type===n.type&&s.key===n.key}const E1=({key:s})=>s??null,Rp=({ref:s,ref_key:n,ref_for:c})=>(typeof s=="number"&&(s=""+s),s!=null?Jr(s)||Nn(s)||Ht(s)?{i:un,r:s,k:n,f:!!c}:s:null);function ri(s,n=null,c=null,d=0,f=null,m=s===si?0:1,y=!1,M=!1){const S={__v_isVNode:!0,__v_skip:!0,type:s,props:n,key:n&&E1(n),ref:n&&Rp(n),scopeId:YA,slotScopeIds:null,children:c,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:m,patchFlag:d,dynamicProps:f,dynamicChildren:null,appContext:null,ctx:un};return M?(vM(S,c),m&128&&s.normalize(S)):c&&(S.shapeFlag|=Jr(c)?8:16),xu>0&&!y&&ci&&(S.patchFlag>0||m&6)&&S.patchFlag!==32&&ci.push(S),S}const cn=GB;function GB(s,n=null,c=null,d=0,f=null,m=!1){if((!s||s===dB)&&(s=Hn),Pu(s)){const M=jo(s,n,!0);return c&&vM(M,c),xu>0&&!m&&ci&&(M.shapeFlag&6?ci[ci.indexOf(s)]=M:ci.push(M)),M.patchFlag=-2,M}if(eq(s)&&(s=s.__vccOpts),n){n=jB(n);let{class:M,style:S}=n;M&&!Jr(M)&&(n.class=sM(M)),Vr(S)&&(pM(S)&&!Bt(S)&&(S=dn({},S)),n.style=iM(S))}const y=Jr(s)?1:I1(s)?128:WA(s)?64:Vr(s)?4:Ht(s)?2:0;return ri(s,n,c,d,f,y,m,!0)}function jB(s){return s?pM(s)||u1(s)?dn({},s):s:null}function jo(s,n,c=!1,d=!1){const{props:f,ref:m,patchFlag:y,children:M,transition:S}=s,E=n?$B(f||{},n):f,b={__v_isVNode:!0,__v_skip:!0,type:s.type,props:E,key:E&&E1(E),ref:n&&n.ref?c&&m?Bt(m)?m.concat(Rp(n)):[m,Rp(n)]:Rp(n):m,scopeId:s.scopeId,slotScopeIds:s.slotScopeIds,children:M,target:s.target,targetStart:s.targetStart,targetAnchor:s.targetAnchor,staticCount:s.staticCount,shapeFlag:s.shapeFlag,patchFlag:n&&s.type!==si?y===-1?16:y|16:y,dynamicProps:s.dynamicProps,dynamicChildren:s.dynamicChildren,appContext:s.appContext,dirs:s.dirs,transition:S,component:s.component,suspense:s.suspense,ssContent:s.ssContent&&jo(s.ssContent),ssFallback:s.ssFallback&&jo(s.ssFallback),el:s.el,anchor:s.anchor,ctx:s.ctx,ce:s.ce};return S&&d&&wu(b,S.clone(b)),b}function HB(s=" ",n=0){return cn(uh,null,s,n)}function Np(s="",n=!1){return n?(xa(),Py(Hn,null,s)):cn(Hn,null,s)}function ss(s){return s==null||typeof s=="boolean"?cn(Hn):Bt(s)?cn(si,null,s.slice()):Pu(s)?Do(s):cn(uh,null,String(s))}function Do(s){return s.el===null&&s.patchFlag!==-1||s.memo?s:jo(s)}function vM(s,n){let c=0;const{shapeFlag:d}=s;if(n==null)n=null;else if(Bt(n))c=16;else if(typeof n=="object")if(d&65){const f=n.default;f&&(f._c&&(f._d=!1),vM(s,f()),f._c&&(f._d=!0));return}else{c=32;const f=n._;!f&&!u1(n)?n._ctx=un:f===3&&un&&(un.slots._===1?n._=1:(n._=2,s.patchFlag|=1024))}else Ht(n)?(n={default:n,_ctx:un},c=32):(n=String(n),d&64?(c=16,n=[HB(n)]):c=8);s.children=n,s.shapeFlag|=c}function $B(...s){const n={};for(let c=0;c<s.length;c++){const d=s[c];for(const f in d)if(f==="class")n.class!==d.class&&(n.class=sM([n.class,d.class]));else if(f==="style")n.style=iM([n.style,d.style]);else if(Zp(f)){const m=n[f],y=d[f];y&&m!==y&&!(Bt(m)&&m.includes(y))&&(n[f]=m?[].concat(m,y):y)}else f!==""&&(n[f]=d[f])}return n}function ns(s,n,c,d=null){Gi(s,n,7,[c,d])}const KB=a1();let YB=0;function WB(s,n,c){const d=s.type,f=(n?n.appContext:s.appContext)||KB,m={uid:YB++,vnode:s,type:d,parent:n,appContext:f,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new _F(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:n?n.provides:Object.create(f.provides),ids:n?n.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:p1(d,f),emitsOptions:T1(d,f),emit:null,emitted:null,propsDefaults:Rr,inheritAttrs:d.inheritAttrs,ctx:Rr,data:Rr,props:Rr,attrs:Rr,slots:Rr,refs:Rr,setupState:Rr,setupContext:null,suspense:c,suspenseId:c?c.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return m.ctx={_:m},m.root=n?n.root:m,m.emit=LB.bind(null,m),s.ce&&s.ce(m),m}let mn=null;const yM=()=>mn||un;let Gp,Ly;{const s=nh(),n=(c,d)=>{let f;return(f=s[c])||(f=s[c]=[]),f.push(d),m=>{f.length>1?f.forEach(y=>y(m)):f[0](m)}};Gp=n("__VUE_INSTANCE_SETTERS__",c=>mn=c),Ly=n("__VUE_SSR_SETTERS__",c=>Lu=c)}const $u=s=>{const n=mn;return Gp(s),s.scope.on(),()=>{s.scope.off(),Gp(n)}},nb=()=>{mn&&mn.scope.off(),Gp(null)};function C1(s){return s.vnode.shapeFlag&4}let Lu=!1;function JB(s,n=!1,c=!1){n&&Ly(n);const{props:d,children:f}=s.vnode,m=C1(s);TB(s,d,m,n),CB(s,f,c);const y=m?QB(s,n):void 0;return n&&Ly(!1),y}function QB(s,n){const c=s.type;s.accessCache=Object.create(null),s.proxy=new Proxy(s.ctx,hB);const{setup:d}=c;if(d){$o();const f=s.setupContext=d.length>1?XB(s):null,m=$u(s),y=Hu(d,s,0,[s.props,f]),M=vA(y);if(Ko(),m(),(M||s.sp)&&!Yc(s)&&e1(s),M){if(y.then(nb,nb),n)return y.then(S=>{ib(s,S)}).catch(S=>{oh(S,s,0)});s.asyncDep=y}else ib(s,y)}else b1(s)}function ib(s,n,c){Ht(n)?s.type.__ssrInlineRender?s.ssrRender=n:s.render=n:Vr(n)&&(s.setupState=qA(n)),b1(s)}function b1(s,n,c){const d=s.type;s.render||(s.render=d.render||as);{const f=$u(s);$o();try{fB(s)}finally{Ko(),f()}}}const zB={get(s,n){return bn(s,"get",""),s[n]}};function XB(s){const n=c=>{s.exposed=c||{}};return{attrs:new Proxy(s.attrs,zB),slots:s.slots,emit:s.emit,expose:n}}function dh(s){return s.exposed?s.exposeProxy||(s.exposeProxy=new Proxy(qA(FF(s.exposed)),{get(n,c){if(c in n)return n[c];if(c in Tu)return Tu[c](s)},has(n,c){return c in n||c in Tu}})):s.proxy}function ZB(s,n=!0){return Ht(s)?s.displayName||s.name:s.name||n&&s.__name}function eq(s){return Ht(s)&&"__vccOpts"in s}const Mi=(s,n)=>HF(s,n,Lu);function _M(s,n,c){const d=arguments.length;return d===2?Vr(n)&&!Bt(n)?Pu(n)?cn(s,null,[n]):cn(s,n):cn(s,null,n):(d>3?c=Array.prototype.slice.call(arguments,2):d===3&&Pu(c)&&(c=[c]),cn(s,n,c))}const tq="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Vy;const sb=typeof window<"u"&&window.trustedTypes;if(sb)try{Vy=sb.createPolicy("vue",{createHTML:s=>s})}catch{}const A1=Vy?s=>Vy.createHTML(s):s=>s,rq="http://www.w3.org/2000/svg",nq="http://www.w3.org/1998/Math/MathML",qs=typeof document<"u"?document:null,ob=qs&&qs.createElement("template"),iq={insert:(s,n,c)=>{n.insertBefore(s,c||null)},remove:s=>{const n=s.parentNode;n&&n.removeChild(s)},createElement:(s,n,c,d)=>{const f=n==="svg"?qs.createElementNS(rq,s):n==="mathml"?qs.createElementNS(nq,s):c?qs.createElement(s,{is:c}):qs.createElement(s);return s==="select"&&d&&d.multiple!=null&&f.setAttribute("multiple",d.multiple),f},createText:s=>qs.createTextNode(s),createComment:s=>qs.createComment(s),setText:(s,n)=>{s.nodeValue=n},setElementText:(s,n)=>{s.textContent=n},parentNode:s=>s.parentNode,nextSibling:s=>s.nextSibling,querySelector:s=>qs.querySelector(s),setScopeId(s,n){s.setAttribute(n,"")},insertStaticContent(s,n,c,d,f,m){const y=c?c.previousSibling:n.lastChild;if(f&&(f===m||f.nextSibling))for(;n.insertBefore(f.cloneNode(!0),c),!(f===m||!(f=f.nextSibling)););else{ob.innerHTML=A1(d==="svg"?`<svg>${s}</svg>`:d==="mathml"?`<math>${s}</math>`:s);const M=ob.content;if(d==="svg"||d==="mathml"){const S=M.firstChild;for(;S.firstChild;)M.appendChild(S.firstChild);M.removeChild(S)}n.insertBefore(M,c)}return[y?y.nextSibling:n.firstChild,c?c.previousSibling:n.lastChild]}},Oo="transition",au="animation",Vu=Symbol("_vtc"),R1={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},sq=dn({},JA,R1),oq=s=>(s.displayName="Transition",s.props=sq,s),I7=oq((s,{slots:n})=>_M(ZF,aq(s),n)),ba=(s,n=[])=>{Bt(s)?s.forEach(c=>c(...n)):s&&s(...n)},ab=s=>s?Bt(s)?s.some(n=>n.length>1):s.length>1:!1;function aq(s){const n={};for(const ve in s)ve in R1||(n[ve]=s[ve]);if(s.css===!1)return n;const{name:c="v",type:d,duration:f,enterFromClass:m=`${c}-enter-from`,enterActiveClass:y=`${c}-enter-active`,enterToClass:M=`${c}-enter-to`,appearFromClass:S=m,appearActiveClass:E=y,appearToClass:b=M,leaveFromClass:R=`${c}-leave-from`,leaveActiveClass:x=`${c}-leave-active`,leaveToClass:L=`${c}-leave-to`}=s,q=cq(f),D=q&&q[0],G=q&&q[1],{onBeforeEnter:J,onEnter:ne,onEnterCancelled:z,onLeave:$,onLeaveCancelled:Z,onBeforeAppear:le=J,onAppear:fe=ne,onAppearCancelled:oe=z}=n,B=(ve,qe,Qe,ut)=>{ve._enterCancelled=ut,Aa(ve,qe?b:M),Aa(ve,qe?E:y),Qe&&Qe()},me=(ve,qe)=>{ve._isLeaving=!1,Aa(ve,R),Aa(ve,L),Aa(ve,x),qe&&qe()},Ee=ve=>(qe,Qe)=>{const ut=ve?fe:ne,he=()=>B(qe,ve,Qe);ba(ut,[qe,he]),cb(()=>{Aa(qe,ve?S:m),Us(qe,ve?b:M),ab(ut)||lb(qe,d,D,he)})};return dn(n,{onBeforeEnter(ve){ba(J,[ve]),Us(ve,m),Us(ve,y)},onBeforeAppear(ve){ba(le,[ve]),Us(ve,S),Us(ve,E)},onEnter:Ee(!1),onAppear:Ee(!0),onLeave(ve,qe){ve._isLeaving=!0;const Qe=()=>me(ve,qe);Us(ve,R),ve._enterCancelled?(Us(ve,x),pb()):(pb(),Us(ve,x)),cb(()=>{ve._isLeaving&&(Aa(ve,R),Us(ve,L),ab($)||lb(ve,d,G,Qe))}),ba($,[ve,Qe])},onEnterCancelled(ve){B(ve,!1,void 0,!0),ba(z,[ve])},onAppearCancelled(ve){B(ve,!0,void 0,!0),ba(oe,[ve])},onLeaveCancelled(ve){me(ve),ba(Z,[ve])}})}function cq(s){if(s==null)return null;if(Vr(s))return[Iv(s.enter),Iv(s.leave)];{const n=Iv(s);return[n,n]}}function Iv(s){return pF(s)}function Us(s,n){n.split(/\s+/).forEach(c=>c&&s.classList.add(c)),(s[Vu]||(s[Vu]=new Set)).add(n)}function Aa(s,n){n.split(/\s+/).forEach(d=>d&&s.classList.remove(d));const c=s[Vu];c&&(c.delete(n),c.size||(s[Vu]=void 0))}function cb(s){requestAnimationFrame(()=>{requestAnimationFrame(s)})}let lq=0;function lb(s,n,c,d){const f=s._endId=++lq,m=()=>{f===s._endId&&d()};if(c!=null)return setTimeout(m,c);const{type:y,timeout:M,propCount:S}=uq(s,n);if(!y)return d();const E=y+"end";let b=0;const R=()=>{s.removeEventListener(E,x),m()},x=L=>{L.target===s&&++b>=S&&R()};setTimeout(()=>{b<S&&R()},M+1),s.addEventListener(E,x)}function uq(s,n){const c=window.getComputedStyle(s),d=q=>(c[q]||"").split(", "),f=d(`${Oo}Delay`),m=d(`${Oo}Duration`),y=ub(f,m),M=d(`${au}Delay`),S=d(`${au}Duration`),E=ub(M,S);let b=null,R=0,x=0;n===Oo?y>0&&(b=Oo,R=y,x=m.length):n===au?E>0&&(b=au,R=E,x=S.length):(R=Math.max(y,E),b=R>0?y>E?Oo:au:null,x=b?b===Oo?m.length:S.length:0);const L=b===Oo&&/\b(transform|all)(,|$)/.test(d(`${Oo}Property`).toString());return{type:b,timeout:R,propCount:x,hasTransform:L}}function ub(s,n){for(;s.length<n.length;)s=s.concat(s);return Math.max(...n.map((c,d)=>db(c)+db(s[d])))}function db(s){return s==="auto"?0:Number(s.slice(0,-1).replace(",","."))*1e3}function pb(){return document.body.offsetHeight}function dq(s,n,c){const d=s[Vu];d&&(n=(n?[n,...d]:[...d]).join(" ")),n==null?s.removeAttribute("class"):c?s.setAttribute("class",n):s.className=n}const jp=Symbol("_vod"),N1=Symbol("_vsh"),S7={beforeMount(s,{value:n},{transition:c}){s[jp]=s.style.display==="none"?"":s.style.display,c&&n?c.beforeEnter(s):cu(s,n)},mounted(s,{value:n},{transition:c}){c&&n&&c.enter(s)},updated(s,{value:n,oldValue:c},{transition:d}){!n!=!c&&(d?n?(d.beforeEnter(s),cu(s,!0),d.enter(s)):d.leave(s,()=>{cu(s,!1)}):cu(s,n))},beforeUnmount(s,{value:n}){cu(s,n)}};function cu(s,n){s.style.display=n?s[jp]:"none",s[N1]=!n}const pq=Symbol(""),hq=/(^|;)\s*display\s*:/;function fq(s,n,c){const d=s.style,f=Jr(c);let m=!1;if(c&&!f){if(n)if(Jr(n))for(const y of n.split(";")){const M=y.slice(0,y.indexOf(":")).trim();c[M]==null&&kp(d,M,"")}else for(const y in n)c[y]==null&&kp(d,y,"");for(const y in c)y==="display"&&(m=!0),kp(d,y,c[y])}else if(f){if(n!==c){const y=d[pq];y&&(c+=";"+y),d.cssText=c,m=hq.test(c)}}else n&&s.removeAttribute("style");jp in s&&(s[jp]=m?d.display:"",s[N1]&&(d.display="none"))}const hb=/\s*!important$/;function kp(s,n,c){if(Bt(c))c.forEach(d=>kp(s,n,d));else if(c==null&&(c=""),n.startsWith("--"))s.setProperty(n,c);else{const d=mq(s,n);hb.test(c)?s.setProperty(Fa(d),c.replace(hb,""),"important"):s[d]=c}}const fb=["Webkit","Moz","ms"],Sv={};function mq(s,n){const c=Sv[n];if(c)return c;let d=bi(n);if(d!=="filter"&&d in s)return Sv[n]=d;d=rh(d);for(let f=0;f<fb.length;f++){const m=fb[f]+d;if(m in s)return Sv[n]=m}return n}const mb="http://www.w3.org/1999/xlink";function gb(s,n,c,d,f,m=yF(n)){d&&n.startsWith("xlink:")?c==null?s.removeAttributeNS(mb,n.slice(6,n.length)):s.setAttributeNS(mb,n,c):c==null||m&&!TA(c)?s.removeAttribute(n):s.setAttribute(n,m?"":Qs(c)?String(c):c)}function vb(s,n,c,d,f){if(n==="innerHTML"||n==="textContent"){c!=null&&(s[n]=n==="innerHTML"?A1(c):c);return}const m=s.tagName;if(n==="value"&&m!=="PROGRESS"&&!m.includes("-")){const M=m==="OPTION"?s.getAttribute("value")||"":s.value,S=c==null?s.type==="checkbox"?"on":"":String(c);(M!==S||!("_value"in s))&&(s.value=S),c==null&&s.removeAttribute(n),s._value=c;return}let y=!1;if(c===""||c==null){const M=typeof s[n];M==="boolean"?c=TA(c):c==null&&M==="string"?(c="",y=!0):M==="number"&&(c=0,y=!0)}try{s[n]=c}catch{}y&&s.removeAttribute(f||n)}function gq(s,n,c,d){s.addEventListener(n,c,d)}function vq(s,n,c,d){s.removeEventListener(n,c,d)}const yb=Symbol("_vei");function yq(s,n,c,d,f=null){const m=s[yb]||(s[yb]={}),y=m[n];if(d&&y)y.value=d;else{const[M,S]=_q(n);if(d){const E=m[n]=Iq(d,f);gq(s,M,E,S)}else y&&(vq(s,M,y,S),m[n]=void 0)}}const _b=/(?:Once|Passive|Capture)$/;function _q(s){let n;if(_b.test(s)){n={};let d;for(;d=s.match(_b);)s=s.slice(0,s.length-d[0].length),n[d[0].toLowerCase()]=!0}return[s[2]===":"?s.slice(3):Fa(s.slice(2)),n]}let Ev=0;const Mq=Promise.resolve(),Tq=()=>Ev||(Mq.then(()=>Ev=0),Ev=Date.now());function Iq(s,n){const c=d=>{if(!d._vts)d._vts=Date.now();else if(d._vts<=c.attached)return;Gi(Sq(d,c.value),n,5,[d])};return c.value=s,c.attached=Tq(),c}function Sq(s,n){if(Bt(n)){const c=s.stopImmediatePropagation;return s.stopImmediatePropagation=()=>{c.call(s),s._stopped=!0},n.map(d=>f=>!f._stopped&&d&&d(f))}else return n}const Mb=s=>s.charCodeAt(0)===111&&s.charCodeAt(1)===110&&s.charCodeAt(2)>96&&s.charCodeAt(2)<123,Eq=(s,n,c,d,f,m)=>{const y=f==="svg";n==="class"?dq(s,d,y):n==="style"?fq(s,c,d):Zp(n)?tM(n)||yq(s,n,c,d,m):(n[0]==="."?(n=n.slice(1),!0):n[0]==="^"?(n=n.slice(1),!1):Cq(s,n,d,y))?(vb(s,n,d),!s.tagName.includes("-")&&(n==="value"||n==="checked"||n==="selected")&&gb(s,n,d,y,m,n!=="value")):s._isVueCE&&(/[A-Z]/.test(n)||!Jr(d))?vb(s,bi(n),d,m,n):(n==="true-value"?s._trueValue=d:n==="false-value"&&(s._falseValue=d),gb(s,n,d,y))};function Cq(s,n,c,d){if(d)return!!(n==="innerHTML"||n==="textContent"||n in s&&Mb(n)&&Ht(c));if(n==="spellcheck"||n==="draggable"||n==="translate"||n==="form"||n==="list"&&s.tagName==="INPUT"||n==="type"&&s.tagName==="TEXTAREA")return!1;if(n==="width"||n==="height"){const f=s.tagName;if(f==="IMG"||f==="VIDEO"||f==="CANVAS"||f==="SOURCE")return!1}return Mb(n)&&Jr(c)?!1:n in s}const bq=["ctrl","shift","alt","meta"],Aq={stop:s=>s.stopPropagation(),prevent:s=>s.preventDefault(),self:s=>s.target!==s.currentTarget,ctrl:s=>!s.ctrlKey,shift:s=>!s.shiftKey,alt:s=>!s.altKey,meta:s=>!s.metaKey,left:s=>"button"in s&&s.button!==0,middle:s=>"button"in s&&s.button!==1,right:s=>"button"in s&&s.button!==2,exact:(s,n)=>bq.some(c=>s[`${c}Key`]&&!n.includes(c))},E7=(s,n)=>{const c=s._withMods||(s._withMods={}),d=n.join(".");return c[d]||(c[d]=(f,...m)=>{for(let y=0;y<n.length;y++){const M=Aq[n[y]];if(M&&M(f,n))return}return s(f,...m)})},Rq=dn({patchProp:Eq},iq);let Tb;function k1(){return Tb||(Tb=AB(Rq))}const C7=(...s)=>{k1().render(...s)},Nq=(...s)=>{const n=k1().createApp(...s),{mount:c}=n;return n.mount=d=>{const f=Oq(d);if(!f)return;const m=n._component;!Ht(m)&&!m.render&&!m.template&&(m.template=f.innerHTML),f.nodeType===1&&(f.textContent="");const y=c(f,!1,kq(f));return f instanceof Element&&(f.removeAttribute("v-cloak"),f.setAttribute("data-v-app","")),y},n};function kq(s){if(s instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&s instanceof MathMLElement)return"mathml"}function Oq(s){return Jr(s)?document.querySelector(s):s}/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const xc=typeof document<"u";function O1(s){return typeof s=="object"||"displayName"in s||"props"in s||"__vccOpts"in s}function wq(s){return s.__esModule||s[Symbol.toStringTag]==="Module"||s.default&&O1(s.default)}const _r=Object.assign;function Cv(s,n){const c={};for(const d in n){const f=n[d];c[d]=ji(f)?f.map(s):s(f)}return c}const Su=()=>{},ji=Array.isArray,w1=/#/g,xq=/&/g,Pq=/\//g,Lq=/=/g,Vq=/\?/g,x1=/\+/g,Dq=/%5B/g,Uq=/%5D/g,P1=/%5E/g,Fq=/%60/g,L1=/%7B/g,Bq=/%7C/g,V1=/%7D/g,qq=/%20/g;function MM(s){return encodeURI(""+s).replace(Bq,"|").replace(Dq,"[").replace(Uq,"]")}function Gq(s){return MM(s).replace(L1,"{").replace(V1,"}").replace(P1,"^")}function Dy(s){return MM(s).replace(x1,"%2B").replace(qq,"+").replace(w1,"%23").replace(xq,"%26").replace(Fq,"`").replace(L1,"{").replace(V1,"}").replace(P1,"^")}function jq(s){return Dy(s).replace(Lq,"%3D")}function Hq(s){return MM(s).replace(w1,"%23").replace(Vq,"%3F")}function $q(s){return s==null?"":Hq(s).replace(Pq,"%2F")}function Du(s){try{return decodeURIComponent(""+s)}catch{}return""+s}const Kq=/\/$/,Yq=s=>s.replace(Kq,"");function bv(s,n,c="/"){let d,f={},m="",y="";const M=n.indexOf("#");let S=n.indexOf("?");return M<S&&M>=0&&(S=-1),S>-1&&(d=n.slice(0,S),m=n.slice(S+1,M>-1?M:n.length),f=s(m)),M>-1&&(d=d||n.slice(0,M),y=n.slice(M,n.length)),d=zq(d??n,c),{fullPath:d+(m&&"?")+m+y,path:d,query:f,hash:Du(y)}}function Wq(s,n){const c=n.query?s(n.query):"";return n.path+(c&&"?")+c+(n.hash||"")}function Ib(s,n){return!n||!s.toLowerCase().startsWith(n.toLowerCase())?s:s.slice(n.length)||"/"}function Jq(s,n,c){const d=n.matched.length-1,f=c.matched.length-1;return d>-1&&d===f&&Jc(n.matched[d],c.matched[f])&&D1(n.params,c.params)&&s(n.query)===s(c.query)&&n.hash===c.hash}function Jc(s,n){return(s.aliasOf||s)===(n.aliasOf||n)}function D1(s,n){if(Object.keys(s).length!==Object.keys(n).length)return!1;for(const c in s)if(!Qq(s[c],n[c]))return!1;return!0}function Qq(s,n){return ji(s)?Sb(s,n):ji(n)?Sb(n,s):s===n}function Sb(s,n){return ji(n)?s.length===n.length&&s.every((c,d)=>c===n[d]):s.length===1&&s[0]===n}function zq(s,n){if(s.startsWith("/"))return s;if(!s)return n;const c=n.split("/"),d=s.split("/"),f=d[d.length-1];(f===".."||f===".")&&d.push("");let m=c.length-1,y,M;for(y=0;y<d.length;y++)if(M=d[y],M!==".")if(M==="..")m>1&&m--;else break;return c.slice(0,m).join("/")+"/"+d.slice(y).join("/")}const wo={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Uu;(function(s){s.pop="pop",s.push="push"})(Uu||(Uu={}));var Eu;(function(s){s.back="back",s.forward="forward",s.unknown=""})(Eu||(Eu={}));function Xq(s){if(!s)if(xc){const n=document.querySelector("base");s=n&&n.getAttribute("href")||"/",s=s.replace(/^\w+:\/\/[^\/]+/,"")}else s="/";return s[0]!=="/"&&s[0]!=="#"&&(s="/"+s),Yq(s)}const Zq=/^[^#]+#/;function e5(s,n){return s.replace(Zq,"#")+n}function t5(s,n){const c=document.documentElement.getBoundingClientRect(),d=s.getBoundingClientRect();return{behavior:n.behavior,left:d.left-c.left-(n.left||0),top:d.top-c.top-(n.top||0)}}const ph=()=>({left:window.scrollX,top:window.scrollY});function r5(s){let n;if("el"in s){const c=s.el,d=typeof c=="string"&&c.startsWith("#"),f=typeof c=="string"?d?document.getElementById(c.slice(1)):document.querySelector(c):c;if(!f)return;n=t5(f,s)}else n=s;"scrollBehavior"in document.documentElement.style?window.scrollTo(n):window.scrollTo(n.left!=null?n.left:window.scrollX,n.top!=null?n.top:window.scrollY)}function Eb(s,n){return(history.state?history.state.position-n:-1)+s}const Uy=new Map;function n5(s,n){Uy.set(s,n)}function i5(s){const n=Uy.get(s);return Uy.delete(s),n}let s5=()=>location.protocol+"//"+location.host;function U1(s,n){const{pathname:c,search:d,hash:f}=n,m=s.indexOf("#");if(m>-1){let M=f.includes(s.slice(m))?s.slice(m).length:1,S=f.slice(M);return S[0]!=="/"&&(S="/"+S),Ib(S,"")}return Ib(c,s)+d+f}function o5(s,n,c,d){let f=[],m=[],y=null;const M=({state:x})=>{const L=U1(s,location),q=c.value,D=n.value;let G=0;if(x){if(c.value=L,n.value=x,y&&y===q){y=null;return}G=D?x.position-D.position:0}else d(L);f.forEach(J=>{J(c.value,q,{delta:G,type:Uu.pop,direction:G?G>0?Eu.forward:Eu.back:Eu.unknown})})};function S(){y=c.value}function E(x){f.push(x);const L=()=>{const q=f.indexOf(x);q>-1&&f.splice(q,1)};return m.push(L),L}function b(){const{history:x}=window;x.state&&x.replaceState(_r({},x.state,{scroll:ph()}),"")}function R(){for(const x of m)x();m=[],window.removeEventListener("popstate",M),window.removeEventListener("beforeunload",b)}return window.addEventListener("popstate",M),window.addEventListener("beforeunload",b,{passive:!0}),{pauseListeners:S,listen:E,destroy:R}}function Cb(s,n,c,d=!1,f=!1){return{back:s,current:n,forward:c,replaced:d,position:window.history.length,scroll:f?ph():null}}function a5(s){const{history:n,location:c}=window,d={value:U1(s,c)},f={value:n.state};f.value||m(d.value,{back:null,current:d.value,forward:null,position:n.length-1,replaced:!0,scroll:null},!0);function m(S,E,b){const R=s.indexOf("#"),x=R>-1?(c.host&&document.querySelector("base")?s:s.slice(R))+S:s5()+s+S;try{n[b?"replaceState":"pushState"](E,"",x),f.value=E}catch(L){console.error(L),c[b?"replace":"assign"](x)}}function y(S,E){const b=_r({},n.state,Cb(f.value.back,S,f.value.forward,!0),E,{position:f.value.position});m(S,b,!0),d.value=S}function M(S,E){const b=_r({},f.value,n.state,{forward:S,scroll:ph()});m(b.current,b,!0);const R=_r({},Cb(d.value,S,null),{position:b.position+1},E);m(S,R,!1),d.value=S}return{location:d,state:f,push:M,replace:y}}function c5(s){s=Xq(s);const n=a5(s),c=o5(s,n.state,n.location,n.replace);function d(m,y=!0){y||c.pauseListeners(),history.go(m)}const f=_r({location:"",base:s,go:d,createHref:e5.bind(null,s)},n,c);return Object.defineProperty(f,"location",{enumerable:!0,get:()=>n.location.value}),Object.defineProperty(f,"state",{enumerable:!0,get:()=>n.state.value}),f}function l5(s){return s=location.host?s||location.pathname+location.search:"",s.includes("#")||(s+="#"),c5(s)}function u5(s){return typeof s=="string"||s&&typeof s=="object"}function F1(s){return typeof s=="string"||typeof s=="symbol"}const B1=Symbol("");var bb;(function(s){s[s.aborted=4]="aborted",s[s.cancelled=8]="cancelled",s[s.duplicated=16]="duplicated"})(bb||(bb={}));function Qc(s,n){return _r(new Error,{type:s,[B1]:!0},n)}function Fs(s,n){return s instanceof Error&&B1 in s&&(n==null||!!(s.type&n))}const Ab="[^/]+?",d5={sensitive:!1,strict:!1,start:!0,end:!0},p5=/[.+*?^${}()[\]/\\]/g;function h5(s,n){const c=_r({},d5,n),d=[];let f=c.start?"^":"";const m=[];for(const E of s){const b=E.length?[]:[90];c.strict&&!E.length&&(f+="/");for(let R=0;R<E.length;R++){const x=E[R];let L=40+(c.sensitive?.25:0);if(x.type===0)R||(f+="/"),f+=x.value.replace(p5,"\\$&"),L+=40;else if(x.type===1){const{value:q,repeatable:D,optional:G,regexp:J}=x;m.push({name:q,repeatable:D,optional:G});const ne=J||Ab;if(ne!==Ab){L+=10;try{new RegExp(`(${ne})`)}catch($){throw new Error(`Invalid custom RegExp for param "${q}" (${ne}): `+$.message)}}let z=D?`((?:${ne})(?:/(?:${ne}))*)`:`(${ne})`;R||(z=G&&E.length<2?`(?:/${z})`:"/"+z),G&&(z+="?"),f+=z,L+=20,G&&(L+=-8),D&&(L+=-20),ne===".*"&&(L+=-50)}b.push(L)}d.push(b)}if(c.strict&&c.end){const E=d.length-1;d[E][d[E].length-1]+=.7000000000000001}c.strict||(f+="/?"),c.end?f+="$":c.strict&&!f.endsWith("/")&&(f+="(?:/|$)");const y=new RegExp(f,c.sensitive?"":"i");function M(E){const b=E.match(y),R={};if(!b)return null;for(let x=1;x<b.length;x++){const L=b[x]||"",q=m[x-1];R[q.name]=L&&q.repeatable?L.split("/"):L}return R}function S(E){let b="",R=!1;for(const x of s){(!R||!b.endsWith("/"))&&(b+="/"),R=!1;for(const L of x)if(L.type===0)b+=L.value;else if(L.type===1){const{value:q,repeatable:D,optional:G}=L,J=q in E?E[q]:"";if(ji(J)&&!D)throw new Error(`Provided param "${q}" is an array but it is not repeatable (* or + modifiers)`);const ne=ji(J)?J.join("/"):J;if(!ne)if(G)x.length<2&&(b.endsWith("/")?b=b.slice(0,-1):R=!0);else throw new Error(`Missing required param "${q}"`);b+=ne}}return b||"/"}return{re:y,score:d,keys:m,parse:M,stringify:S}}function f5(s,n){let c=0;for(;c<s.length&&c<n.length;){const d=n[c]-s[c];if(d)return d;c++}return s.length<n.length?s.length===1&&s[0]===80?-1:1:s.length>n.length?n.length===1&&n[0]===80?1:-1:0}function q1(s,n){let c=0;const d=s.score,f=n.score;for(;c<d.length&&c<f.length;){const m=f5(d[c],f[c]);if(m)return m;c++}if(Math.abs(f.length-d.length)===1){if(Rb(d))return 1;if(Rb(f))return-1}return f.length-d.length}function Rb(s){const n=s[s.length-1];return s.length>0&&n[n.length-1]<0}const m5={type:0,value:""},g5=/[a-zA-Z0-9_]/;function v5(s){if(!s)return[[]];if(s==="/")return[[m5]];if(!s.startsWith("/"))throw new Error(`Invalid path "${s}"`);function n(L){throw new Error(`ERR (${c})/"${E}": ${L}`)}let c=0,d=c;const f=[];let m;function y(){m&&f.push(m),m=[]}let M=0,S,E="",b="";function R(){E&&(c===0?m.push({type:0,value:E}):c===1||c===2||c===3?(m.length>1&&(S==="*"||S==="+")&&n(`A repeatable param (${E}) must be alone in its segment. eg: '/:ids+.`),m.push({type:1,value:E,regexp:b,repeatable:S==="*"||S==="+",optional:S==="*"||S==="?"})):n("Invalid state to consume buffer"),E="")}function x(){E+=S}for(;M<s.length;){if(S=s[M++],S==="\\"&&c!==2){d=c,c=4;continue}switch(c){case 0:S==="/"?(E&&R(),y()):S===":"?(R(),c=1):x();break;case 4:x(),c=d;break;case 1:S==="("?c=2:g5.test(S)?x():(R(),c=0,S!=="*"&&S!=="?"&&S!=="+"&&M--);break;case 2:S===")"?b[b.length-1]=="\\"?b=b.slice(0,-1)+S:c=3:b+=S;break;case 3:R(),c=0,S!=="*"&&S!=="?"&&S!=="+"&&M--,b="";break;default:n("Unknown state");break}}return c===2&&n(`Unfinished custom RegExp for param "${E}"`),R(),y(),f}function y5(s,n,c){const d=h5(v5(s.path),c),f=_r(d,{record:s,parent:n,children:[],alias:[]});return n&&!f.record.aliasOf==!n.record.aliasOf&&n.children.push(f),f}function _5(s,n){const c=[],d=new Map;n=wb({strict:!1,end:!0,sensitive:!1},n);function f(R){return d.get(R)}function m(R,x,L){const q=!L,D=kb(R);D.aliasOf=L&&L.record;const G=wb(n,R),J=[D];if("alias"in R){const $=typeof R.alias=="string"?[R.alias]:R.alias;for(const Z of $)J.push(kb(_r({},D,{components:L?L.record.components:D.components,path:Z,aliasOf:L?L.record:D})))}let ne,z;for(const $ of J){const{path:Z}=$;if(x&&Z[0]!=="/"){const le=x.record.path,fe=le[le.length-1]==="/"?"":"/";$.path=x.record.path+(Z&&fe+Z)}if(ne=y5($,x,G),L?L.alias.push(ne):(z=z||ne,z!==ne&&z.alias.push(ne),q&&R.name&&!Ob(ne)&&y(R.name)),G1(ne)&&S(ne),D.children){const le=D.children;for(let fe=0;fe<le.length;fe++)m(le[fe],ne,L&&L.children[fe])}L=L||ne}return z?()=>{y(z)}:Su}function y(R){if(F1(R)){const x=d.get(R);x&&(d.delete(R),c.splice(c.indexOf(x),1),x.children.forEach(y),x.alias.forEach(y))}else{const x=c.indexOf(R);x>-1&&(c.splice(x,1),R.record.name&&d.delete(R.record.name),R.children.forEach(y),R.alias.forEach(y))}}function M(){return c}function S(R){const x=I5(R,c);c.splice(x,0,R),R.record.name&&!Ob(R)&&d.set(R.record.name,R)}function E(R,x){let L,q={},D,G;if("name"in R&&R.name){if(L=d.get(R.name),!L)throw Qc(1,{location:R});G=L.record.name,q=_r(Nb(x.params,L.keys.filter(z=>!z.optional).concat(L.parent?L.parent.keys.filter(z=>z.optional):[]).map(z=>z.name)),R.params&&Nb(R.params,L.keys.map(z=>z.name))),D=L.stringify(q)}else if(R.path!=null)D=R.path,L=c.find(z=>z.re.test(D)),L&&(q=L.parse(D),G=L.record.name);else{if(L=x.name?d.get(x.name):c.find(z=>z.re.test(x.path)),!L)throw Qc(1,{location:R,currentLocation:x});G=L.record.name,q=_r({},x.params,R.params),D=L.stringify(q)}const J=[];let ne=L;for(;ne;)J.unshift(ne.record),ne=ne.parent;return{name:G,path:D,params:q,matched:J,meta:T5(J)}}s.forEach(R=>m(R));function b(){c.length=0,d.clear()}return{addRoute:m,resolve:E,removeRoute:y,clearRoutes:b,getRoutes:M,getRecordMatcher:f}}function Nb(s,n){const c={};for(const d of n)d in s&&(c[d]=s[d]);return c}function kb(s){const n={path:s.path,redirect:s.redirect,name:s.name,meta:s.meta||{},aliasOf:s.aliasOf,beforeEnter:s.beforeEnter,props:M5(s),children:s.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in s?s.components||null:s.component&&{default:s.component}};return Object.defineProperty(n,"mods",{value:{}}),n}function M5(s){const n={},c=s.props||!1;if("component"in s)n.default=c;else for(const d in s.components)n[d]=typeof c=="object"?c[d]:c;return n}function Ob(s){for(;s;){if(s.record.aliasOf)return!0;s=s.parent}return!1}function T5(s){return s.reduce((n,c)=>_r(n,c.meta),{})}function wb(s,n){const c={};for(const d in s)c[d]=d in n?n[d]:s[d];return c}function I5(s,n){let c=0,d=n.length;for(;c!==d;){const m=c+d>>1;q1(s,n[m])<0?d=m:c=m+1}const f=S5(s);return f&&(d=n.lastIndexOf(f,d-1)),d}function S5(s){let n=s;for(;n=n.parent;)if(G1(n)&&q1(s,n)===0)return n}function G1({record:s}){return!!(s.name||s.components&&Object.keys(s.components).length||s.redirect)}function E5(s){const n={};if(s===""||s==="?")return n;const d=(s[0]==="?"?s.slice(1):s).split("&");for(let f=0;f<d.length;++f){const m=d[f].replace(x1," "),y=m.indexOf("="),M=Du(y<0?m:m.slice(0,y)),S=y<0?null:Du(m.slice(y+1));if(M in n){let E=n[M];ji(E)||(E=n[M]=[E]),E.push(S)}else n[M]=S}return n}function xb(s){let n="";for(let c in s){const d=s[c];if(c=jq(c),d==null){d!==void 0&&(n+=(n.length?"&":"")+c);continue}(ji(d)?d.map(m=>m&&Dy(m)):[d&&Dy(d)]).forEach(m=>{m!==void 0&&(n+=(n.length?"&":"")+c,m!=null&&(n+="="+m))})}return n}function C5(s){const n={};for(const c in s){const d=s[c];d!==void 0&&(n[c]=ji(d)?d.map(f=>f==null?null:""+f):d==null?d:""+d)}return n}const b5=Symbol(""),Pb=Symbol(""),hh=Symbol(""),TM=Symbol(""),Fy=Symbol("");function lu(){let s=[];function n(d){return s.push(d),()=>{const f=s.indexOf(d);f>-1&&s.splice(f,1)}}function c(){s=[]}return{add:n,list:()=>s.slice(),reset:c}}function Uo(s,n,c,d,f,m=y=>y()){const y=d&&(d.enterCallbacks[f]=d.enterCallbacks[f]||[]);return()=>new Promise((M,S)=>{const E=x=>{x===!1?S(Qc(4,{from:c,to:n})):x instanceof Error?S(x):u5(x)?S(Qc(2,{from:n,to:x})):(y&&d.enterCallbacks[f]===y&&typeof x=="function"&&y.push(x),M())},b=m(()=>s.call(d&&d.instances[f],n,c,E));let R=Promise.resolve(b);s.length<3&&(R=R.then(E)),R.catch(x=>S(x))})}function Av(s,n,c,d,f=m=>m()){const m=[];for(const y of s)for(const M in y.components){let S=y.components[M];if(!(n!=="beforeRouteEnter"&&!y.instances[M]))if(O1(S)){const b=(S.__vccOpts||S)[n];b&&m.push(Uo(b,c,d,y,M,f))}else{let E=S();m.push(()=>E.then(b=>{if(!b)throw new Error(`Couldn't resolve component "${M}" at "${y.path}"`);const R=wq(b)?b.default:b;y.mods[M]=b,y.components[M]=R;const L=(R.__vccOpts||R)[n];return L&&Uo(L,c,d,y,M,f)()}))}}return m}function Lb(s){const n=Fi(hh),c=Fi(TM),d=Mi(()=>{const S=qn(s.to);return n.resolve(S)}),f=Mi(()=>{const{matched:S}=d.value,{length:E}=S,b=S[E-1],R=c.matched;if(!b||!R.length)return-1;const x=R.findIndex(Jc.bind(null,b));if(x>-1)return x;const L=Vb(S[E-2]);return E>1&&Vb(b)===L&&R[R.length-1].path!==L?R.findIndex(Jc.bind(null,S[E-2])):x}),m=Mi(()=>f.value>-1&&O5(c.params,d.value.params)),y=Mi(()=>f.value>-1&&f.value===c.matched.length-1&&D1(c.params,d.value.params));function M(S={}){if(k5(S)){const E=n[qn(s.replace)?"replace":"push"](qn(s.to)).catch(Su);return s.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>E),E}return Promise.resolve()}return{route:d,href:Mi(()=>d.value.href),isActive:m,isExactActive:y,navigate:M}}function A5(s){return s.length===1?s[0]:s}const R5=fM({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Lb,setup(s,{slots:n}){const c=sh(Lb(s)),{options:d}=Fi(hh),f=Mi(()=>({[Db(s.activeClass,d.linkActiveClass,"router-link-active")]:c.isActive,[Db(s.exactActiveClass,d.linkExactActiveClass,"router-link-exact-active")]:c.isExactActive}));return()=>{const m=n.default&&A5(n.default(c));return s.custom?m:_M("a",{"aria-current":c.isExactActive?s.ariaCurrentValue:null,href:c.href,onClick:c.navigate,class:f.value},m)}}}),N5=R5;function k5(s){if(!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)&&!s.defaultPrevented&&!(s.button!==void 0&&s.button!==0)){if(s.currentTarget&&s.currentTarget.getAttribute){const n=s.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(n))return}return s.preventDefault&&s.preventDefault(),!0}}function O5(s,n){for(const c in n){const d=n[c],f=s[c];if(typeof d=="string"){if(d!==f)return!1}else if(!ji(f)||f.length!==d.length||d.some((m,y)=>m!==f[y]))return!1}return!0}function Vb(s){return s?s.aliasOf?s.aliasOf.path:s.path:""}const Db=(s,n,c)=>s??n??c,w5=fM({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(s,{attrs:n,slots:c}){const d=Fi(Fy),f=Mi(()=>s.route||d.value),m=Fi(Pb,0),y=Mi(()=>{let E=qn(m);const{matched:b}=f.value;let R;for(;(R=b[E])&&!R.components;)E++;return E}),M=Mi(()=>f.value.matched[y.value]);Cp(Pb,Mi(()=>y.value+1)),Cp(b5,M),Cp(Fy,f);const S=Ay();return bp(()=>[S.value,M.value,s.name],([E,b,R],[x,L,q])=>{b&&(b.instances[R]=E,L&&L!==b&&E&&E===x&&(b.leaveGuards.size||(b.leaveGuards=L.leaveGuards),b.updateGuards.size||(b.updateGuards=L.updateGuards))),E&&b&&(!L||!Jc(b,L)||!x)&&(b.enterCallbacks[R]||[]).forEach(D=>D(E))},{flush:"post"}),()=>{const E=f.value,b=s.name,R=M.value,x=R&&R.components[b];if(!x)return Ub(c.default,{Component:x,route:E});const L=R.props[b],q=L?L===!0?E.params:typeof L=="function"?L(E):L:null,G=_M(x,_r({},q,n,{onVnodeUnmounted:J=>{J.component.isUnmounted&&(R.instances[b]=null)},ref:S}));return Ub(c.default,{Component:G,route:E})||G}}});function Ub(s,n){if(!s)return null;const c=s(n);return c.length===1?c[0]:c}const x5=w5;function P5(s){const n=_5(s.routes,s),c=s.parseQuery||E5,d=s.stringifyQuery||xb,f=s.history,m=lu(),y=lu(),M=lu(),S=BF(wo);let E=wo;xc&&s.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const b=Cv.bind(null,ue=>""+ue),R=Cv.bind(null,$q),x=Cv.bind(null,Du);function L(ue,ge){let be,_e;return F1(ue)?(be=n.getRecordMatcher(ue),_e=ge):_e=ue,n.addRoute(_e,be)}function q(ue){const ge=n.getRecordMatcher(ue);ge&&n.removeRoute(ge)}function D(){return n.getRoutes().map(ue=>ue.record)}function G(ue){return!!n.getRecordMatcher(ue)}function J(ue,ge){if(ge=_r({},ge||S.value),typeof ue=="string"){const de=bv(c,ue,ge.path),Ae=n.resolve({path:de.path},ge),ke=f.createHref(de.fullPath);return _r(de,Ae,{params:x(Ae.params),hash:Du(de.hash),redirectedFrom:void 0,href:ke})}let be;if(ue.path!=null)be=_r({},ue,{path:bv(c,ue.path,ge.path).path});else{const de=_r({},ue.params);for(const Ae in de)de[Ae]==null&&delete de[Ae];be=_r({},ue,{params:R(de)}),ge.params=R(ge.params)}const _e=n.resolve(be,ge),ct=ue.hash||"";_e.params=b(x(_e.params));const X=Wq(d,_r({},ue,{hash:Gq(ct),path:_e.path})),K=f.createHref(X);return _r({fullPath:X,hash:ct,query:d===xb?C5(ue.query):ue.query||{}},_e,{redirectedFrom:void 0,href:K})}function ne(ue){return typeof ue=="string"?bv(c,ue,S.value.path):_r({},ue)}function z(ue,ge){if(E!==ue)return Qc(8,{from:ge,to:ue})}function $(ue){return fe(ue)}function Z(ue){return $(_r(ne(ue),{replace:!0}))}function le(ue){const ge=ue.matched[ue.matched.length-1];if(ge&&ge.redirect){const{redirect:be}=ge;let _e=typeof be=="function"?be(ue):be;return typeof _e=="string"&&(_e=_e.includes("?")||_e.includes("#")?_e=ne(_e):{path:_e},_e.params={}),_r({query:ue.query,hash:ue.hash,params:_e.path!=null?{}:ue.params},_e)}}function fe(ue,ge){const be=E=J(ue),_e=S.value,ct=ue.state,X=ue.force,K=ue.replace===!0,de=le(be);if(de)return fe(_r(ne(de),{state:typeof de=="object"?_r({},ct,de.state):ct,force:X,replace:K}),ge||be);const Ae=be;Ae.redirectedFrom=ge;let ke;return!X&&Jq(d,_e,be)&&(ke=Qc(16,{to:Ae,from:_e}),jt(_e,_e,!0,!1)),(ke?Promise.resolve(ke):me(Ae,_e)).catch(Ne=>Fs(Ne)?Fs(Ne,2)?Ne:Wt(Ne):Xe(Ne,Ae,_e)).then(Ne=>{if(Ne){if(Fs(Ne,2))return fe(_r({replace:K},ne(Ne.to),{state:typeof Ne.to=="object"?_r({},ct,Ne.to.state):ct,force:X}),ge||Ae)}else Ne=ve(Ae,_e,!0,K,ct);return Ee(Ae,_e,Ne),Ne})}function oe(ue,ge){const be=z(ue,ge);return be?Promise.reject(be):Promise.resolve()}function B(ue){const ge=Ce.values().next().value;return ge&&typeof ge.runWithContext=="function"?ge.runWithContext(ue):ue()}function me(ue,ge){let be;const[_e,ct,X]=L5(ue,ge);be=Av(_e.reverse(),"beforeRouteLeave",ue,ge);for(const de of _e)de.leaveGuards.forEach(Ae=>{be.push(Uo(Ae,ue,ge))});const K=oe.bind(null,ue,ge);return be.push(K),St(be).then(()=>{be=[];for(const de of m.list())be.push(Uo(de,ue,ge));return be.push(K),St(be)}).then(()=>{be=Av(ct,"beforeRouteUpdate",ue,ge);for(const de of ct)de.updateGuards.forEach(Ae=>{be.push(Uo(Ae,ue,ge))});return be.push(K),St(be)}).then(()=>{be=[];for(const de of X)if(de.beforeEnter)if(ji(de.beforeEnter))for(const Ae of de.beforeEnter)be.push(Uo(Ae,ue,ge));else be.push(Uo(de.beforeEnter,ue,ge));return be.push(K),St(be)}).then(()=>(ue.matched.forEach(de=>de.enterCallbacks={}),be=Av(X,"beforeRouteEnter",ue,ge,B),be.push(K),St(be))).then(()=>{be=[];for(const de of y.list())be.push(Uo(de,ue,ge));return be.push(K),St(be)}).catch(de=>Fs(de,8)?de:Promise.reject(de))}function Ee(ue,ge,be){M.list().forEach(_e=>B(()=>_e(ue,ge,be)))}function ve(ue,ge,be,_e,ct){const X=z(ue,ge);if(X)return X;const K=ge===wo,de=xc?history.state:{};be&&(_e||K?f.replace(ue.fullPath,_r({scroll:K&&de&&de.scroll},ct)):f.push(ue.fullPath,ct)),S.value=ue,jt(ue,ge,be,K),Wt()}let qe;function Qe(){qe||(qe=f.listen((ue,ge,be)=>{if(!we.listening)return;const _e=J(ue),ct=le(_e);if(ct){fe(_r(ct,{replace:!0,force:!0}),_e).catch(Su);return}E=_e;const X=S.value;xc&&n5(Eb(X.fullPath,be.delta),ph()),me(_e,X).catch(K=>Fs(K,12)?K:Fs(K,2)?(fe(_r(ne(K.to),{force:!0}),_e).then(de=>{Fs(de,20)&&!be.delta&&be.type===Uu.pop&&f.go(-1,!1)}).catch(Su),Promise.reject()):(be.delta&&f.go(-be.delta,!1),Xe(K,_e,X))).then(K=>{K=K||ve(_e,X,!1),K&&(be.delta&&!Fs(K,8)?f.go(-be.delta,!1):be.type===Uu.pop&&Fs(K,20)&&f.go(-1,!1)),Ee(_e,X,K)}).catch(Su)}))}let ut=lu(),he=lu(),Fe;function Xe(ue,ge,be){Wt(ue);const _e=he.list();return _e.length?_e.forEach(ct=>ct(ue,ge,be)):console.error(ue),Promise.reject(ue)}function yt(){return Fe&&S.value!==wo?Promise.resolve():new Promise((ue,ge)=>{ut.add([ue,ge])})}function Wt(ue){return Fe||(Fe=!ue,Qe(),ut.list().forEach(([ge,be])=>ue?be(ue):ge()),ut.reset()),ue}function jt(ue,ge,be,_e){const{scrollBehavior:ct}=s;if(!xc||!ct)return Promise.resolve();const X=!be&&i5(Eb(ue.fullPath,0))||(_e||!be)&&history.state&&history.state.scroll||null;return jA().then(()=>ct(ue,ge,X)).then(K=>K&&r5(K)).catch(K=>Xe(K,ue,ge))}const Tt=ue=>f.go(ue);let Le;const Ce=new Set,we={currentRoute:S,listening:!0,addRoute:L,removeRoute:q,clearRoutes:n.clearRoutes,hasRoute:G,getRoutes:D,resolve:J,options:s,push:$,replace:Z,go:Tt,back:()=>Tt(-1),forward:()=>Tt(1),beforeEach:m.add,beforeResolve:y.add,afterEach:M.add,onError:he.add,isReady:yt,install(ue){const ge=this;ue.component("RouterLink",N5),ue.component("RouterView",x5),ue.config.globalProperties.$router=ge,Object.defineProperty(ue.config.globalProperties,"$route",{enumerable:!0,get:()=>qn(S)}),xc&&!Le&&S.value===wo&&(Le=!0,$(f.location).catch(ct=>{}));const be={};for(const ct in wo)Object.defineProperty(be,ct,{get:()=>S.value[ct],enumerable:!0});ue.provide(hh,ge),ue.provide(TM,UA(be)),ue.provide(Fy,S);const _e=ue.unmount;Ce.add(ue),ue.unmount=function(){Ce.delete(ue),Ce.size<1&&(E=wo,qe&&qe(),qe=null,S.value=wo,Le=!1,Fe=!1),_e()}}};function St(ue){return ue.reduce((ge,be)=>ge.then(()=>B(be)),Promise.resolve())}return we}function L5(s,n){const c=[],d=[],f=[],m=Math.max(n.matched.length,s.matched.length);for(let y=0;y<m;y++){const M=n.matched[y];M&&(s.matched.find(E=>Jc(E,M))?d.push(M):c.push(M));const S=s.matched[y];S&&(n.matched.find(E=>Jc(E,S))||f.push(S))}return[c,d,f]}function b7(){return Fi(hh)}function V5(s){return Fi(TM)}const wr={chat:"/chat",messageReadInfo:"/chat/message-read-info",p2pSetting:"/p2p-setting",conversation:"/conversation",conversationSearch:"/conversation/search",contacts:"/contacts",blacklist:"/contacts/blacklist",validlist:"/contacts/validlist",teamlist:"/contacts/teamlist",my:"/my",userSetting:"/user/setting",myDetail:"/user/my-detail",myDetailEdit:"/user/my-detail-edit",aboutNetease:"/user/aboutNetease",addFriend:"/friend/add",friendCard:"/friend/friend-card",friendInfoEdit:"/friend/edit",teamCreate:"/team/create",teamSetting:"/team/setting",teamMember:"/team/member",teamInfoEdit:"/team/info-edit",teamAvatarEdit:"/team/info/avatar-edit",teamIntroduceEdit:"/team/info/introduce-edit",teamAdd:"/team/add",teamNick:"/team/nick",login:"/login"},D5=P5({history:l5(),routes:[{path:"/",redirect:wr.conversation},{path:wr.chat,name:"Chat",component:()=>Or(()=>import("./ChatPage-71DSnefE.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url)},{path:wr.messageReadInfo,name:"MessageReadInfo",component:()=>Or(()=>import("./MessageReadInfoPage-DMbIeLXv.js"),__vite__mapDeps([23,4,5,6,7,8,9,10,11,13,14,24,25,26]),import.meta.url)},{path:wr.p2pSetting,name:"P2pSetting",component:()=>Or(()=>import("./P2pSettingPage-DJJhAvHS.js"),__vite__mapDeps([27,28,7,8,29,10,11,19,20,30,31,32]),import.meta.url)},{path:wr.conversation,name:"Conversation",component:()=>Or(()=>import("./ConversationPage-Bz2EBWDN.js"),__vite__mapDeps([33,7,8,4,5,24,25,10,11,13,14,21,19,20,1,2,3,34]),import.meta.url)},{path:wr.conversationSearch,name:"ConversationSearch",component:()=>Or(()=>import("./ConversationSearchPage-Bdj_H1MT.js"),__vite__mapDeps([35,28,7,8,29,19,20,10,11,13,14,24,25,17,18,36]),import.meta.url)},{path:wr.contacts,name:"Contacts",component:()=>Or(()=>import("./ContactsPage-DjBaYd2K.js"),__vite__mapDeps([37,7,8,10,11,24,25,1,2,3,38]),import.meta.url)},{path:wr.blacklist,name:"Blacklist",component:()=>Or(()=>import("./BlackListPage-BwPUmMM-.js"),__vite__mapDeps([39,24,25,10,11,13,14,28,7,8,29,19,20,40]),import.meta.url)},{path:wr.validlist,name:"ValidList",component:()=>Or(()=>import("./ValidListPage-BPmhIx2R.js"),__vite__mapDeps([41,24,25,10,11,28,7,8,29,13,14,19,20,42]),import.meta.url)},{path:wr.teamlist,name:"TeamList",component:()=>Or(()=>import("./TeamListPage-fwlcmu65.js"),__vite__mapDeps([43,24,25,10,11,28,7,8,29,44]),import.meta.url)},{path:wr.my,name:"My",component:()=>Or(()=>import("./MyPage-D7YBWj-h.js"),__vite__mapDeps([45,46,10,11,7,8,19,20,47,48]),import.meta.url)},{path:wr.userSetting,name:"UserSetting",component:()=>Or(()=>import("./SettingPage-BZ1qaAR_.js"),__vite__mapDeps([49,28,7,8,29,30,31,19,20,15,16,50]),import.meta.url)},{path:wr.myDetail,name:"MyDetail",component:()=>Or(()=>import("./MyDetailPage-D08Nf92z.js"),__vite__mapDeps([51,10,11,7,8,28,29,52,53,19,20,54]),import.meta.url)},{path:wr.myDetailEdit,name:"MyDetailEdit",component:()=>Or(()=>import("./MyDetailEditPage-0M5180b5.js"),__vite__mapDeps([55,7,8,28,29,17,18,19,20,56]),import.meta.url)},{path:wr.aboutNetease,name:"AboutNetease",component:()=>Or(()=>import("./AboutNeteasePage-uo1GfJ8A.js"),__vite__mapDeps([57,28,7,8,29,3,58]),import.meta.url)},{path:wr.friendCard,name:"FriendCard",component:()=>Or(()=>import("./FriendCardPage-DA0F-sVd.js"),__vite__mapDeps([59,46,10,11,7,8,19,20,47,28,29,30,31,15,16,60]),import.meta.url)},{path:wr.addFriend,name:"AddFriend",component:()=>Or(()=>import("./AddFriendPage-DaQTFvOS.js"),__vite__mapDeps([61,10,11,28,7,8,29,24,25,62,63,17,18,19,20,64]),import.meta.url)},{path:wr.friendInfoEdit,name:"FriendInfoEdit",component:()=>Or(()=>import("./FriendInfoEditPage-DsOApGcf.js"),__vite__mapDeps([65,28,7,8,29,19,20,17,18,66]),import.meta.url)},{path:"/team/create",name:"TeamCreate",component:()=>Or(()=>import("./TeamCreatePage-BN4DjG37.js"),__vite__mapDeps([67,68,10,11,13,14,24,25,69,28,7,8,29,19,20,70]),import.meta.url)},{path:wr.teamSetting,name:"TeamSetting",component:()=>Or(()=>import("./TeamSetPage-Bx3_Ka-P.js"),__vite__mapDeps([71,28,7,8,29,10,11,30,31,19,20,15,16,72]),import.meta.url)},{path:wr.teamMember,name:"TeamMMember",component:()=>Or(()=>import("./TeamMemberPage-CJ8r7aXR.js"),__vite__mapDeps([73,10,11,28,7,8,29,13,14,24,25,15,16,19,20,74]),import.meta.url)},{path:wr.teamInfoEdit,name:"TeamInfoEdit",component:()=>Or(()=>import("./TeamInfoEditPage-C4xIe4I5.js"),__vite__mapDeps([75,28,7,8,29,10,11,76]),import.meta.url)},{path:wr.teamAvatarEdit,name:"TeamAvatarEdit",component:()=>Or(()=>import("./TeamAvatarEditPage-DZ0KY7Lh.js"),__vite__mapDeps([77,28,7,8,29,62,63,19,20,52,53,78]),import.meta.url)},{path:wr.teamIntroduceEdit,name:"TeamNameEdit",component:()=>Or(()=>import("./TeamIntroduceEditPage-CL6Tyj1r.js"),__vite__mapDeps([79,28,7,8,29,17,18,62,63,19,20,80]),import.meta.url)},{path:wr.teamAdd,name:"TeamAdd",component:()=>Or(()=>import("./TeamAddPage-C3DsU9Zj.js"),__vite__mapDeps([81,68,10,11,13,14,24,25,69,28,7,8,29,2,19,20,82]),import.meta.url)},{path:wr.teamNick,name:"TeamNick",component:()=>Or(()=>import("./TeamNickPage-Cgeo16II.js"),__vite__mapDeps([83,7,8,28,29,17,18,19,20,84]),import.meta.url)},{path:wr.login,name:"Login",component:()=>Or(()=>import("./LoginPage-DXZQ5Pe_.js"),__vite__mapDeps([85,17,18,19,20,12,86]),import.meta.url)}]}),U5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAYAAACohjseAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAARfSURBVHgB7ZpdctpWFMfPuRCHZtwZlkAeO52aaKZDIojHsIKSFdReQZIVYK+gyQrAKwhdgUlTTO08gM1DH8sSmCbjcSx0T87BsYPEp+BK6IHfDGMsI6S/zrnn6xpgw4ZYg7Ai7fZ/ace5yjjgPiFNaURIf/927Cl+pZLbHct63Ic1sJTA1sdukX/saYIyED1Z8LQeX62BCv7M/7pTh4gIJFCEEVGFCIqwGj2lsAaD5LFt/9SDEFlIYKv1b4YSTtWAMD9i1aNCbqcGIaHmfeD0vPvSVU47BHFCBgiqp+eXf0BIzLRg82O3ApoOIQoQOzcPtkslw8FoqgUjFSdwsNpyPhm35EQLNluX+yy9CmsAiV7nn2XfgCHGBEpA0co5AVkf66F/s/XjY1OuOuaiOuFUYH3ihPTDL//vgyE8AsV6HNX2Yd0o/A0M4RGowSlCDJCUdMIlIBjAI5AS8DvEhNT150VLwJl4BCKBkS81gU5QBgzgDzJG3MII5BXYXtJlk3dvWq12RkN8ubr+VG6eXVaJ04hC6HDR//4BJuu53M+dWefdW/A6BWvp16aBgJ4b10ns3R6H9G1djBWH3HbzvMsvLkymcC+wZFkiMDYik+j2Fvqg9KNcsLPI6jDN+VC+3xoQAxCol8tZHguiq2cHQM7fUoH5RXrThEvvIQYQYsN/DBO4N/9MyPhFegQ6D3UNYuCmynWPxg7qhfvRjE4M3t1/1+hfZB1qoLewThBqtm31Rg8Nu5sgKYzXZfPs4lDejhXbgy39RtYArImJ1lNQgcDgSyn3xgSKFWmgX8A60HQ0xXoZCE6aG+jy1JFF1E0vInXyuaw1emzV3pQLgtrUkUXB5kmXhgOIAFkSnAbGvGbV3pTntsW5Y0Mp4UipEwLMQFgMXKtQ8OY9meZxObby6GLu2FDWxJctbWleHxAG2j3wixu6JpkZeAWbbLM1XaUO+ansGbEoP7SCnT30XsPoTKi/9ObLX2eXZQUkUSrLzyl4Hxm+OIY6K+8uCadnFzW26OLTgAnipN+7cj6fBNjMmQ9H0SREjaw526qNHhLLsbh3RsWBFA14HKXAPkfL0sSAIm5JZkeVknpse6cRicBhntO6ZBe8VUqYQ2bC5DCvzk0TBqj/wGnGX4LJXqPsWkEYQ2ZZ499GGaFakBP16+dT9hkGri7z9rb5IZcvgIViwWE3wtXJ8xmbKLvPsq8MFw99eaD+6GxeIOFbcUl/MJnELt+MCZHIe/9KT36gxlxUrOZqdbBr/9IIcp6I/NC6AN6zD9rz9fjhHKtEsp6fMTo0kug/tLrF7dSgY91O5pbi738uXiHivA3QOrv+0aNH0Fv0WkYEmuJbDyoiJwYfvtkX+afB/gUlijSxMMMelIsBmDL4Qo2BPSRWAgUJThIwJs2FrlPbcwOXn1i56CiTGu3C053A9xs7C94hlY+Ud98tSYGtJ8RWoHAnctjXIS4VoWMtUBCRN1u6RC4cw4YNGzZsiJivcdoHaHbGVV4AAAAASUVORK5CYII=",F5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAYAAACohjseAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAARVSURBVHgB7ZpdbhpJEMerZoDNSisb32D2bbPJavEJAidY7wliKx+KHEt2TgCcIESynUhJZHKCOCcAn8DzEMd+7BuYxPlQMqYrVcY4MAxmBno+Hvg9QcM085+qruqqBmDOnEyDMCOlLSp6P744ALoESEVCKF5NrlGhhSqX+8N1G9iBFJhK4O2Ns7LWcIcVrPAUpZCXKf6xtkZ4d7y9sA8JEUmgCCOiKgGUYTYUEDYLhdwbt/G7ghgJJbD06Jvj2d6eAWF+FBLUj3YXmhAT1qQv3Fz/vMniDmMQJzi8ZvduPT57CjFxrQX/Xj+rcuCoQSKQW8jrittYMhqMxlowWXECljzPNm7JQAveWv+0Kq4DKUCanhw/X2yAIUYESkD5YXstfulAOnQK+e6fplx1xEU5oFQhPXFC8btnrYIhhgSK9TharkLKWID/gSGGBHqWV4YMICmptHVaBAMMuyjCXcgI5+e5sFvAaxkSyE/OyKQmICQHDOAPMkbcwgS853UG3++1aKp7y/Vf/PXo1IEMowFWXrVJcrOkD5cIDtjj9h9W0L3uuisL3rgBqdRr47Bh+Ma1VCA9xJJlRKhaCIcs+vB1i1bHzXMl8DKxZkak1l0V8qsl2XW9ZuuyGzv+D/1RtA2ZgNTR7pLf9a4NgJK/uwgtv8jhKEp0AJkA2yMjyB2EyTh+kUMCf8vrJmTATXW+Ww8YLkM4ROTb/pshgRfrEOkZpEvzpLGkBgcug0iUNFF62eqVeiOb7UJON2QNQEoEWo8jJkSEXXpTcueIQLEikv0/pAFSPch6NF11U5TcObZlkXzRS+6HncXlwREJFtxmbE0pUIrd5tiWhXS6uOO1BolASuf1iNewuCrNUJtKVTKxbShbOMu2uMJHB2ICqbvsz3uvDmiT73Dm1sXEtuHJiyXF3a5lWR8QA5q9xC/uIo8R1MAAkTrbYk20rRpfdMeIRfmhfdherA0OzbrufHSmPnz5Z+PTyjnRCm94/yUKfT7xi/jFCe7Mp0vCzccfmwgYvhsQLK4o2ywwWHRLFM1BwsiaO9lZbA6OieUut1dGOwr8W28SE4hAHe7qVk4CAoruWc4Bs6gHFWxPjKJmINXlSHw0RhyZFyfWu8ir8Qsk2P/K4vxbMN4Ml9ktD+MQx+2Mer+VEauLEvA5w27wOQMHAD4dNt/kEnHsmrX++5gsSEp2J8c74w9R7ldwS24GzNHh+Z4MihPMC+R68mvAegtCbsaQyLZNsMzzjTxQgy5KykJr7f32QjvKVSKS16PUb5FqPnZxJWlgUuvQSKK/vXFa/pwDV81w5MUit1jkpAPQfRZVz7O4tUq4v6UYEWiKi+K2JzI4+HDo57Ub6S8oCeXBcNyrYJMtVIExjS+aoiGWKYGCrCcJGPirk30FB4yJgctPplx0kKBdzn1p2Eckcxbsw0FEWeyuA5aMbD0hswKFvkjoiZsqQmdaoCAibbEk5zyYM2fOnDkJ8xO56c+RN6RV9AAAAABJRU5ErkJggg==",B5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAYAAACohjseAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMISURBVHgB7ZpbUhNBFIb/7klSFlWW2QHDo2UpzAsaER1WgDsgrkBYQXAFsAPJCswOSCkQgYdwefDR2YERFTFJd3t6IlVccmmawZlU9VeVmq45nZ78k+lzTp8ewOFwOByOgTDcgu3GUZl5WFIKIf4DCmgxhhoX+Xel0sPI5DvWArf3jyuQahXp0ALzFuZmHx2M6shhQaPxxU9RnKbIINZMOloJlOiESBk9LTabX4uj+lkJBFc+MsA9tO5I4BjhBI47TuC4k4MFUvI65zJuU3bh0116pcB8JA8FdFWlkEBxjy3BglulaudsNpvF/BlfZ9zuRwyCSzFVKgWRbn/cPXrtAR8u2QtkD3r2QRj/g43941Cq6/GPMxaVgsd1apa39o4mWUJ5KeWc9XNxmrwUB5J7uClGAnVSLaV6389GorHz+XDl+bPpdSZQpVkdIkMYORnGVTjMTvMw7A0m6sgYRgIFEA0fhX3Th24u5yNjGD2i3YJcz7e5TxNj8qqNQR1O5OWqbnOlEnUySWAkcCEIWnQoD+uzQ16OpuPQPmlgFQebtEw5+5fJe51CUTC5KNNdHw7ESuBp+2SZpFV0W+oZqpBZXC467jiB/ZigsKHzRP1BVwQKqoqMYuVkgl7YaF04Vf7UON7gXG0iYxgJ1GHhd/dHhbzlzFUbOdConb+/Mh9M1bd2D6u2y5q7wkjg6Z+TVcpi3g6yFzo/v9NhWUm+QXlrpgSaJdsMQ8tzlK5Nx4N5vIWMYSSwC1YbZqfHtOdkhJhBxjB6RF8+fVLb3msGEN41ARIsmi/FC159uyrIGMZedG420BsdfTc7tBM67fxag5I+EoIS9xm9B3K+i6S83KI+eVOsajIUEkIqOoXxAJw9kBJlGmhkGd2CCDrG6mVan5VKojWZSwPH4lj8OCqZUOWqP358nVsk8y5VG3ecwHHHCeyLZBEywBmKI1NDK4Hte6KGlNGl/YVg6m4E6jKiUmoF6dFiQrwx6Wg9B1/QXgQlonQRNfJdlQTRLwLVqZIQXNyYcTgcDofDkr9wNAb6qhQHBwAAAABJRU5ErkJggg==",q5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAYAAACohjseAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAL/SURBVHgB7ZrPTxNBFMe/s901GIyUA0dDOQImlr/A9upF/wNKgsYAieUvKP4F7EUPGoNcPdW/oPVgvOIB9WKyFz14oZTIr2Xn+aYNKrBux+lCt8l8kmYn+6bTfvtm5r03W8BisVgsln8i0AezS+0KjzBPQAlXAH/ZFl/qnuc93fKvB5rvMWNmaa8GQWsYDC1BTnn7+Y2tXh0dGFB8fFAYoDhFHkKu63Q0Ehg6YQkDRi2LYnUn36ufkUByqIAMcKg82QMjgcOEFTjsWIHDjgsDHDhNKWSnTYQCZwt3OWcoIGVGPIGZgoujENgOQpjQV6p2iopHYej4BDGPFFm8N4qbo91J9vX7Cd6+Pzhjl1409cUfD5LG0PbgywaV+KMK5++zH4OHZdHkZmV2uT2ZVl56ayL3W5xiYsxsNWkJfNWgCglsUIxNTQEWv8oifU4vNvlGCRlC62fR8ErHHsmoiYyhKzBIHERgR11d1y0gY2hNUe7kR7xb8vSbvGAkfORfaa3TJEp1k0kDLYELZaEKzUpSn+mV9gMOGYl9BoFRHCxWKX+Iw04mnzuO8gS6z+5bQwYxEnh80q46JGqqTalE0svD5qLDjhUYx74rfel5U+rFp1tzvMlsIqMYbTKBP67CRuuvW5XbK3uvJVEDGUNL4EaD8tJBjeNc8byNN9HAIaxyrGxOL+9uipQrin7REhipTIXwJM5GXfsuX6o54SgvZkqg7hpMPp4TuKMuJEULGUNXYD3JKFSZ1EEWkTG0puhiWdRfNGguh4trUBW8i92CV2U1NWQM7V30UVmoBx2xDztUbhqGe+sUU/Gb8qMl0f4p/xxZfDuBCUZhgkNCSUKWVFsIZ4zFVUjjGP1/OAoJb94dYHbSRXufjA+djAR2xJ0m20S4LJQHP3w6Rj/YVG3YsQKHHSswDiFFgAwwcraiicVIoHctqmPACIHmVrdsS8RIoBqYi9xVDAgBakVutKDT13gNfn425nOSvSAE9fyvSlooYcpzkSfnej1VslgsFotFg19QzvqsB5GTswAAAABJRU5ErkJggg==",G5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAYAAACohjseAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALhSURBVHgB7ZpPbhMxFId/zwkVC5ByhGHJgrbZVEyhIj0B3ID0BG1P0PYEtCcoR4ATNBJKR0oX0z8glp0jRKJCVdPx4zmliAVJJraneKT5pChSNOP4y/PYfs8BampqamrsIZREcnLRYfBbMJaZEclHESxQmtbj+EUPljThmbEY847W3EEAeBNM08vWz5sfhyL2DgHhRTBJvkcidwTLYVgmCo4YOa1GQcoZnAW5MTpEoHIGJ8F+ct6VGbKDgHGLoMIOAsda0EQPAQ/Ne6wFuYH3qADWgiQ7FFQAK8H+4JuRa6ECWAlq0pWQMzivg6FjJahYDVERrARvHt1keCCuHz85hQNWguvt9lDyvAwlQ+Bsvf3MabQ4PIP8GSXDRD04Yi2oWX1Cyag834Mj1oJrUkZgQg9lQfgYx+0MjjgtE40835C3UmZUH9EbtwMHzC8s9RcvHfkbaXPbR/QMzgv965dL+1KH8ScpbZk24QlvZcMvydmuUuSUH5rI+ZQzeK2LJkkasVJHDIrmuY9ksspz2ltzqH9ObBslMC5lSL5IM8oZZYr9+Q6USJqmravr5jKRltddeiU1nKEmyp4u5L222RHVuFFaBE2l+xrDVmO00Mr/lT82b7O47WcpmIYXwSRNIz1qdGQYLjGTOZuIqGDGz7JRUIRT6cmpDN8zlT/qxfHzDJ6wFhxH6PZqU2Q63mujRJIi8YEP2bkF78VyzVv0EHUZ2ZOK6J6t6FyCx4OLTc28Sw9fcMqI+WDVYhNQWPB4cP5BhuIW/iPyjO+vrixuz3VPkYv6g6+HYN1FCMiQfbWyuFH08pmb7f7JxU4wcgZGNzF9KsjUCP4++7tEgBQ9u58awfzu7C9IuMGFojgxguPyPOcpAqZIFCdHUN92ETi6gZl/eJgoyIqWEDqs38y6ZKJgNY7HKJp1xbRJpgonSDP7OFHQayGpLAr0ceo62O+ny1o1g4xkE5JPxuXnkzU1NTVT+QU83yOxmhhBHgAAAABJRU5ErkJggg==",j5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAYAAACohjseAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALPSURBVHgB7ZphatswFMf/UtJ92lhyA38c66C+QZMTbDdoQhmUUmh6gjQnWAobjLGSHmE7QdwTLIPB+m2+QbtlMKhjvz2ZdPTDYjuSnMrgH4SERJH1y7Mkv+cANTU1NTX6CJTEi6N5hwReIiGfQB4fyoMGUojut7dPAmjShGVSMaJhQtQB3b1b2u+YizVBf0Ctxe18wmKv4BBWBP2DP95tNJ9yoDw4hoQhqVwjmvJLDw5iLBg1ogkclVMYCW4f/urxOtKBwxgJ8jYwhONoC6roweFT8w79CArsoQJoC/Lc81EBtAS3D38ruRYqgJagkFQJOYXxPug6WoKUiBtUBC3BrUdRiA3RbC5mMEBLcDZuqwiGKB0Kl8fSxmAfpM8oHRHAEG1BCfkJJZNsxSMYoi2oygicpwcoj4urcTuEIUbbRBzHfX4qZUW1ET2FkeDV+3bIBSUrA7kP93liI3oK443++7unY15w7ElyX2mftrqDJZ4f/TzlBNEoP1SRsymnsFrPe3Zw7cmGnK5bAxUCvGCJkUn9c2XfKIE0GZbYI8ouZ5Qp9u8YKBFvcN16vGj6RInP5Y00AxGEG65Wh/NmHISGVyk1KDGCk2maM7Yifoj/JMdccQ77XRGiZKwIsoyXqPKhxM5y3nkonvGr03TG83GGBF953wpsimsLqgglEsdLoQ7sMuO5emZDdm3Be2IDbKAuwwO8kISRruhagh8v6Zh341NsvuAU8g969ror1r4IKCx4fklvllF7MHiejvd3xcla3ynS6DygCddBe3AAdcrud0S/aPvci22O3NAVOYUaixpT0faZEVTLfyzwAw7C06XLczLIa5cZQZabwFFEwTtbKyP4YUq+FPgChykSRZnxQQ+Ow9HJ/cODzPj2DlxHYDevSdYcrMLtMS+vQZZgFe4g5Y5xpSBPYOvVMtsUGWPmPqhWUuFoJDeVT9bU1NRk8hfeAO2OCS47mQAAAABJRU5ErkJggg==";function pr(s){for(var n=arguments.length,c=new Array(n>1?n-1:0),d=1;d<n;d++)c[d-1]=arguments[d];throw new Error(typeof s=="number"?"[MobX] minified error nr: "+s+(c.length?" "+c.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+s)}var H5={};function IM(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:H5}var j1=Object.assign,Hp=Object.getOwnPropertyDescriptor,cs=Object.defineProperty,fh=Object.prototype,By=[];Object.freeze(By);var H1={};Object.freeze(H1);var $5=typeof Proxy<"u",K5=Object.toString();function $1(){$5||pr("Proxy not available")}function K1(s){var n=!1;return function(){if(!n)return n=!0,s.apply(this,arguments)}}var Lc=function(){};function Hi(s){return typeof s=="function"}function Va(s){var n=typeof s;switch(n){case"string":case"symbol":case"number":return!0}return!1}function mh(s){return s!==null&&typeof s=="object"}function Ws(s){if(!mh(s))return!1;var n=Object.getPrototypeOf(s);if(n==null)return!0;var c=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return typeof c=="function"&&c.toString()===K5}function Y1(s){var n=s==null?void 0:s.constructor;return n?n.name==="GeneratorFunction"||n.displayName==="GeneratorFunction":!1}function gh(s,n,c){cs(s,n,{enumerable:!1,writable:!0,configurable:!0,value:c})}function W1(s,n,c){cs(s,n,{enumerable:!1,writable:!1,configurable:!0,value:c})}function Ba(s,n){var c="isMobX"+s;return n.prototype[c]=!0,function(d){return mh(d)&&d[c]===!0}}function Zc(s){return s!=null&&Object.prototype.toString.call(s)==="[object Map]"}function Y5(s){var n=Object.getPrototypeOf(s),c=Object.getPrototypeOf(n),d=Object.getPrototypeOf(c);return d===null}function Hs(s){return s!=null&&Object.prototype.toString.call(s)==="[object Set]"}var J1=typeof Object.getOwnPropertySymbols<"u";function W5(s){var n=Object.keys(s);if(!J1)return n;var c=Object.getOwnPropertySymbols(s);return c.length?[].concat(n,c.filter(function(d){return fh.propertyIsEnumerable.call(s,d)})):n}var Fu=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:J1?function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:Object.getOwnPropertyNames;function Q1(s){return s===null?null:typeof s=="object"?""+s:s}function Go(s,n){return fh.hasOwnProperty.call(s,n)}var J5=Object.getOwnPropertyDescriptors||function(n){var c={};return Fu(n).forEach(function(d){c[d]=Hp(n,d)}),c};function oi(s,n){return!!(s&n)}function ai(s,n,c){return c?s|=n:s&=~n,s}function Fb(s,n){(n==null||n>s.length)&&(n=s.length);for(var c=0,d=Array(n);c<n;c++)d[c]=s[c];return d}function Q5(s,n){for(var c=0;c<n.length;c++){var d=n[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(s,X5(d.key),d)}}function el(s,n,c){return n&&Q5(s.prototype,n),Object.defineProperty(s,"prototype",{writable:!1}),s}function Vc(s,n){var c=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(c)return(c=c.call(s)).next.bind(c);if(Array.isArray(s)||(c=Z5(s))||n){c&&(s=c);var d=0;return function(){return d>=s.length?{done:!0}:{done:!1,value:s[d++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zc(){return zc=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var c=arguments[n];for(var d in c)({}).hasOwnProperty.call(c,d)&&(s[d]=c[d])}return s},zc.apply(null,arguments)}function z1(s,n){s.prototype=Object.create(n.prototype),s.prototype.constructor=s,qy(s,n)}function qy(s,n){return qy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,d){return c.__proto__=d,c},qy(s,n)}function z5(s,n){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var d=c.call(s,n);if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}function X5(s){var n=z5(s,"string");return typeof n=="symbol"?n:n+""}function Z5(s,n){if(s){if(typeof s=="string")return Fb(s,n);var c={}.toString.call(s).slice(8,-1);return c==="Object"&&s.constructor&&(c=s.constructor.name),c==="Map"||c==="Set"?Array.from(s):c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?Fb(s,n):void 0}}var Dc=Symbol("mobx-stored-annotations");function ls(s){function n(c,d){if(Yu(d))return s.decorate_20223_(c,d);Ku(c,d,s)}return Object.assign(n,s)}function Ku(s,n,c){Go(s,Dc)||gh(s,Dc,zc({},s[Dc])),sG(c)||(s[Dc][n]=c)}function Yu(s){return typeof s=="object"&&typeof s.kind=="string"}var Ft=Symbol("mobx administration"),Yo=function(){function s(c){c===void 0&&(c="Atom"),this.name_=void 0,this.flags_=0,this.observers_=new Set,this.lastAccessedBy_=0,this.lowestObserverState_=dr.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=c}var n=s.prototype;return n.onBO=function(){this.onBOL&&this.onBOL.forEach(function(d){return d()})},n.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(d){return d()})},n.reportObserved=function(){return pR(this)},n.reportChanged=function(){Si(),hR(this),Ei()},n.toString=function(){return this.name_},el(s,[{key:"isBeingObserved",get:function(){return oi(this.flags_,s.isBeingObservedMask_)},set:function(d){this.flags_=ai(this.flags_,s.isBeingObservedMask_,d)}},{key:"isPendingUnobservation",get:function(){return oi(this.flags_,s.isPendingUnobservationMask_)},set:function(d){this.flags_=ai(this.flags_,s.isPendingUnobservationMask_,d)}},{key:"diffValue",get:function(){return oi(this.flags_,s.diffValueMask_)?1:0},set:function(d){this.flags_=ai(this.flags_,s.diffValueMask_,d===1)}}])}();Yo.isBeingObservedMask_=1;Yo.isPendingUnobservationMask_=2;Yo.diffValueMask_=4;var SM=Ba("Atom",Yo);function X1(s,n,c){n===void 0&&(n=Lc),c===void 0&&(c=Lc);var d=new Yo(s);return n!==Lc&&a6(d,n),c!==Lc&&_R(d,c),d}function eG(s,n){return OR(s,n)}function tG(s,n){return Object.is?Object.is(s,n):s===n?s!==0||1/s===1/n:s!==s&&n!==n}var $p={structural:eG,default:tG};function Da(s,n,c){return SR(s)?s:Array.isArray(s)?gn.array(s,{name:c}):Ws(s)?gn.object(s,void 0,{name:c}):Zc(s)?gn.map(s,{name:c}):Hs(s)?gn.set(s,{name:c}):typeof s=="function"&&!qu(s)&&!Gu(s)?Y1(s)?Xc(s):Bu(c,s):s}function rG(s,n,c){if(s==null||Ih(s)||Th(s)||Ga(s)||os(s))return s;if(Array.isArray(s))return gn.array(s,{name:c,deep:!1});if(Ws(s))return gn.object(s,void 0,{name:c,deep:!1});if(Zc(s))return gn.map(s,{name:c,deep:!1});if(Hs(s))return gn.set(s,{name:c,deep:!1})}function vh(s){return s}function nG(s,n){return OR(s,n)?n:s}var iG="override";function sG(s){return s.annotationType_===iG}function Wu(s,n){return{annotationType_:s,options_:n,make_:oG,extend_:aG,decorate_20223_:cG}}function oG(s,n,c,d){var f;if((f=this.options_)!=null&&f.bound)return this.extend_(s,n,c,!1)===null?0:1;if(d===s.target_)return this.extend_(s,n,c,!1)===null?0:2;if(qu(c.value))return 1;var m=Z1(s,this,n,c,!1);return cs(d,n,m),2}function aG(s,n,c,d){var f=Z1(s,this,n,c);return s.defineProperty_(n,f,d)}function cG(s,n){var c=n.kind,d=n.name,f=n.addInitializer,m=this,y=function(E){var b,R,x,L;return Ua((b=(R=m.options_)==null?void 0:R.name)!=null?b:d.toString(),E,(x=(L=m.options_)==null?void 0:L.autoAction)!=null?x:!1)};if(c=="field")return function(S){var E,b=S;return qu(b)||(b=y(b)),(E=m.options_)!=null&&E.bound&&(b=b.bind(this),b.isMobxAction=!0),b};if(c=="method"){var M;return qu(s)||(s=y(s)),(M=this.options_)!=null&&M.bound&&f(function(){var S=this,E=S[d].bind(S);E.isMobxAction=!0,S[d]=E}),s}pr("Cannot apply '"+m.annotationType_+"' to '"+String(d)+"' (kind: "+c+"):"+(`
'`+m.annotationType_+"' can only be used on properties with a function value."))}function lG(s,n,c,d){n.annotationType_,d.value}function Z1(s,n,c,d,f){var m,y,M,S,E,b,R;f===void 0&&(f=ft.safeDescriptors),lG(s,n,c,d);var x=d.value;if((m=n.options_)!=null&&m.bound){var L;x=x.bind((L=s.proxy_)!=null?L:s.target_)}return{value:Ua((y=(M=n.options_)==null?void 0:M.name)!=null?y:c.toString(),x,(S=(E=n.options_)==null?void 0:E.autoAction)!=null?S:!1,(b=n.options_)!=null&&b.bound?(R=s.proxy_)!=null?R:s.target_:void 0),configurable:f?s.isPlainObject_:!0,enumerable:!1,writable:!f}}function eR(s,n){return{annotationType_:s,options_:n,make_:uG,extend_:dG,decorate_20223_:pG}}function uG(s,n,c,d){var f;if(d===s.target_)return this.extend_(s,n,c,!1)===null?0:2;if((f=this.options_)!=null&&f.bound&&(!Go(s.target_,n)||!Gu(s.target_[n]))&&this.extend_(s,n,c,!1)===null)return 0;if(Gu(c.value))return 1;var m=tR(s,this,n,c,!1,!1);return cs(d,n,m),2}function dG(s,n,c,d){var f,m=tR(s,this,n,c,(f=this.options_)==null?void 0:f.bound);return s.defineProperty_(n,m,d)}function pG(s,n){var c,d=n.name,f=n.addInitializer;return Gu(s)||(s=Xc(s)),(c=this.options_)!=null&&c.bound&&f(function(){var m=this,y=m[d].bind(m);y.isMobXFlow=!0,m[d]=y}),s}function hG(s,n,c,d){n.annotationType_,d.value}function tR(s,n,c,d,f,m){m===void 0&&(m=ft.safeDescriptors),hG(s,n,c,d);var y=d.value;if(Gu(y)||(y=Xc(y)),f){var M;y=y.bind((M=s.proxy_)!=null?M:s.target_),y.isMobXFlow=!0}return{value:y,configurable:m?s.isPlainObject_:!0,enumerable:!1,writable:!m}}function EM(s,n){return{annotationType_:s,options_:n,make_:fG,extend_:mG,decorate_20223_:gG}}function fG(s,n,c){return this.extend_(s,n,c,!1)===null?0:1}function mG(s,n,c,d){return vG(s,this,n,c),s.defineComputedProperty_(n,zc({},this.options_,{get:c.get,set:c.set}),d)}function gG(s,n){var c=this,d=n.name,f=n.addInitializer;return f(function(){var m=tl(this)[Ft],y=zc({},c.options_,{get:s,context:this});y.name||(y.name="ObservableObject."+d.toString()),m.values_.set(d,new $i(y))}),function(){return this[Ft].getObservablePropValue_(d)}}function vG(s,n,c,d){n.annotationType_,d.get}function yh(s,n){return{annotationType_:s,options_:n,make_:yG,extend_:_G,decorate_20223_:MG}}function yG(s,n,c){return this.extend_(s,n,c,!1)===null?0:1}function _G(s,n,c,d){var f,m;return TG(s,this),s.defineObservableProperty_(n,c.value,(f=(m=this.options_)==null?void 0:m.enhancer)!=null?f:Da,d)}function MG(s,n){var c=this,d=n.kind,f=n.name,m=new WeakSet;function y(M,S){var E,b,R=tl(M)[Ft],x=new Pa(S,(E=(b=c.options_)==null?void 0:b.enhancer)!=null?E:Da,"ObservableObject."+f.toString(),!1);R.values_.set(f,x),m.add(M)}if(d=="accessor")return{get:function(){return m.has(this)||y(this,s.get.call(this)),this[Ft].getObservablePropValue_(f)},set:function(S){return m.has(this)||y(this,S),this[Ft].setObservablePropValue_(f,S)},init:function(S){return m.has(this)||y(this,S),S}}}function TG(s,n,c,d){n.annotationType_}var IG="true",SG=rR();function rR(s){return{annotationType_:IG,options_:s,make_:EG,extend_:CG,decorate_20223_:bG}}function EG(s,n,c,d){var f,m;if(c.get)return _h.make_(s,n,c,d);if(c.set){var y=Ua(n.toString(),c.set);return d===s.target_?s.defineProperty_(n,{configurable:ft.safeDescriptors?s.isPlainObject_:!0,set:y})===null?0:2:(cs(d,n,{configurable:!0,set:y}),2)}if(d!==s.target_&&typeof c.value=="function"){var M;if(Y1(c.value)){var S,E=(S=this.options_)!=null&&S.autoBind?Xc.bound:Xc;return E.make_(s,n,c,d)}var b=(M=this.options_)!=null&&M.autoBind?Bu.bound:Bu;return b.make_(s,n,c,d)}var R=((f=this.options_)==null?void 0:f.deep)===!1?gn.ref:gn;if(typeof c.value=="function"&&(m=this.options_)!=null&&m.autoBind){var x;c.value=c.value.bind((x=s.proxy_)!=null?x:s.target_)}return R.make_(s,n,c,d)}function CG(s,n,c,d){var f,m;if(c.get)return _h.extend_(s,n,c,d);if(c.set)return s.defineProperty_(n,{configurable:ft.safeDescriptors?s.isPlainObject_:!0,set:Ua(n.toString(),c.set)},d);if(typeof c.value=="function"&&(f=this.options_)!=null&&f.autoBind){var y;c.value=c.value.bind((y=s.proxy_)!=null?y:s.target_)}var M=((m=this.options_)==null?void 0:m.deep)===!1?gn.ref:gn;return M.extend_(s,n,c,d)}function bG(s,n){pr("'"+this.annotationType_+"' cannot be used as a decorator")}var AG="observable",RG="observable.ref",NG="observable.shallow",kG="observable.struct",nR={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(nR);function fp(s){return s||nR}var Gy=yh(AG),OG=yh(RG,{enhancer:vh}),wG=yh(NG,{enhancer:rG}),xG=yh(kG,{enhancer:nG}),iR=ls(Gy);function mp(s){return s.deep===!0?Da:s.deep===!1?vh:LG(s.defaultDecorator)}function PG(s){var n;return s?(n=s.defaultDecorator)!=null?n:rR(s):void 0}function LG(s){var n,c;return s&&(n=(c=s.options_)==null?void 0:c.enhancer)!=null?n:Da}function sR(s,n,c){if(Yu(n))return Gy.decorate_20223_(s,n);if(Va(n)){Ku(s,n,Gy);return}return SR(s)?s:Ws(s)?gn.object(s,n,c):Array.isArray(s)?gn.array(s,n):Zc(s)?gn.map(s,n):Hs(s)?gn.set(s,n):typeof s=="object"&&s!==null?s:gn.box(s,n)}j1(sR,iR);var VG={box:function(n,c){var d=fp(c);return new Pa(n,mp(d),d.name,!0,d.equals)},array:function(n,c){var d=fp(c);return(ft.useProxies===!1||d.proxy===!1?C6:m6)(n,mp(d),d.name)},map:function(n,c){var d=fp(c);return new CR(n,mp(d),d.name)},set:function(n,c){var d=fp(c);return new bR(n,mp(d),d.name)},object:function(n,c,d){return ja(function(){return TR(ft.useProxies===!1||(d==null?void 0:d.proxy)===!1?tl({},d):p6({},d),n,c)})},ref:ls(OG),shallow:ls(wG),deep:iR,struct:ls(xG)},gn=j1(sR,VG),oR="computed",DG="computed.struct",jy=EM(oR),UG=EM(DG,{equals:$p.structural}),_h=function(n,c){if(Yu(c))return jy.decorate_20223_(n,c);if(Va(c))return Ku(n,c,jy);if(Ws(n))return ls(EM(oR,n));var d=Ws(c)?c:{};return d.get=n,d.name||(d.name=n.name||""),new $i(d)};Object.assign(_h,jy);_h.struct=ls(UG);var Bb,qb,Kp=0,FG=1,BG=(Bb=(qb=Hp(function(){},"name"))==null?void 0:qb.configurable)!=null?Bb:!1,Gb={value:"action",configurable:!0,writable:!1,enumerable:!1};function Ua(s,n,c,d){c===void 0&&(c=!1);function f(){return qG(s,c,n,d||this,arguments)}return f.isMobxAction=!0,f.toString=function(){return n.toString()},BG&&(Gb.value=s,cs(f,"name",Gb)),f}function qG(s,n,c,d,f){var m=GG(s,n);try{return c.apply(d,f)}catch(y){throw m.error_=y,y}finally{jG(m)}}function GG(s,n,c,d){var f=!1,m=0,y=ft.trackingDerivation,M=!n||!y;Si();var S=ft.allowStateChanges;M&&(qa(),S=CM(!0));var E=AM(!0),b={runAsAction_:M,prevDerivation_:y,prevAllowStateChanges_:S,prevAllowStateReads_:E,notifySpy_:f,startTime_:m,actionId_:FG++,parentActionId_:Kp};return Kp=b.actionId_,b}function jG(s){Kp!==s.actionId_&&pr(30),Kp=s.parentActionId_,s.error_!==void 0&&(ft.suppressReactionErrors=!0),bM(s.prevAllowStateChanges_),Cu(s.prevAllowStateReads_),Ei(),s.runAsAction_&&Ys(s.prevDerivation_),ft.suppressReactionErrors=!1}function CM(s){var n=ft.allowStateChanges;return ft.allowStateChanges=s,n}function bM(s){ft.allowStateChanges=s}var Pa=function(s){function n(d,f,m,y,M){var S;return m===void 0&&(m="ObservableValue"),M===void 0&&(M=$p.default),S=s.call(this,m)||this,S.enhancer=void 0,S.name_=void 0,S.equals=void 0,S.hasUnreportedChange_=!1,S.interceptors_=void 0,S.changeListeners_=void 0,S.value_=void 0,S.dehancer=void 0,S.enhancer=f,S.name_=m,S.equals=M,S.value_=f(d,void 0,m),S}z1(n,s);var c=n.prototype;return c.dehanceValue=function(f){return this.dehancer!==void 0?this.dehancer(f):f},c.set=function(f){this.value_,f=this.prepareNewValue_(f),f!==ft.UNCHANGED&&this.setNewValue_(f)},c.prepareNewValue_=function(f){if(Ti(this)){var m=Ii(this,{object:this,type:us,newValue:f});if(!m)return ft.UNCHANGED;f=m.newValue}return f=this.enhancer(f,this.value_,this.name_),this.equals(this.value_,f)?ft.UNCHANGED:f},c.setNewValue_=function(f){var m=this.value_;this.value_=f,this.reportChanged(),Bi(this)&&qi(this,{type:us,object:this,newValue:f,oldValue:m})},c.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},c.intercept_=function(f){return Ju(this,f)},c.observe_=function(f,m){return m&&f({observableKind:"value",debugObjectName:this.name_,object:this,type:us,newValue:this.value_,oldValue:void 0}),Qu(this,f)},c.raw=function(){return this.value_},c.toJSON=function(){return this.get()},c.toString=function(){return this.name_+"["+this.value_+"]"},c.valueOf=function(){return Q1(this.get())},c[Symbol.toPrimitive]=function(){return this.valueOf()},n}(Yo),$i=function(){function s(c){this.dependenciesState_=dr.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.observers_=new Set,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=dr.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new Wp(null),this.name_=void 0,this.triggeredBy_=void 0,this.flags_=0,this.derivation=void 0,this.setter_=void 0,this.isTracing_=Yp.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,c.get||pr(31),this.derivation=c.get,this.name_=c.name||"ComputedValue",c.set&&(this.setter_=Ua("ComputedValue-setter",c.set)),this.equals_=c.equals||(c.compareStructural||c.struct?$p.structural:$p.default),this.scope_=c.context,this.requiresReaction_=c.requiresReaction,this.keepAlive_=!!c.keepAlive}var n=s.prototype;return n.onBecomeStale_=function(){YG(this)},n.onBO=function(){this.onBOL&&this.onBOL.forEach(function(d){return d()})},n.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(d){return d()})},n.get=function(){if(this.isComputing&&pr(32,this.name_,this.derivation),ft.inBatch===0&&this.observers_.size===0&&!this.keepAlive_)Hy(this)&&(this.warnAboutUntrackedRead_(),Si(),this.value_=this.computeValue_(!1),Ei());else if(pR(this),Hy(this)){var d=ft.trackingContext;this.keepAlive_&&!d&&(ft.trackingContext=this),this.trackAndCompute()&&KG(this),ft.trackingContext=d}var f=this.value_;if(Op(f))throw f.cause;return f},n.set=function(d){if(this.setter_){this.isRunningSetter&&pr(33,this.name_),this.isRunningSetter=!0;try{this.setter_.call(this.scope_,d)}finally{this.isRunningSetter=!1}}else pr(34,this.name_)},n.trackAndCompute=function(){var d=this.value_,f=this.dependenciesState_===dr.NOT_TRACKING_,m=this.computeValue_(!0),y=f||Op(d)||Op(m)||!this.equals_(d,m);return y&&(this.value_=m),y},n.computeValue_=function(d){this.isComputing=!0;var f=CM(!1),m;if(d)m=aR(this,this.derivation,this.scope_);else if(ft.disableErrorBoundaries===!0)m=this.derivation.call(this.scope_);else try{m=this.derivation.call(this.scope_)}catch(y){m=new Wp(y)}return bM(f),this.isComputing=!1,m},n.suspend_=function(){this.keepAlive_||($y(this),this.value_=void 0)},n.observe_=function(d,f){var m=this,y=!0,M=void 0;return yR(function(){var S=m.get();if(!y||f){var E=qa();d({observableKind:"computed",debugObjectName:m.name_,type:us,object:m,newValue:S,oldValue:M}),Ys(E)}y=!1,M=S})},n.warnAboutUntrackedRead_=function(){},n.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},n.valueOf=function(){return Q1(this.get())},n[Symbol.toPrimitive]=function(){return this.valueOf()},el(s,[{key:"isComputing",get:function(){return oi(this.flags_,s.isComputingMask_)},set:function(d){this.flags_=ai(this.flags_,s.isComputingMask_,d)}},{key:"isRunningSetter",get:function(){return oi(this.flags_,s.isRunningSetterMask_)},set:function(d){this.flags_=ai(this.flags_,s.isRunningSetterMask_,d)}},{key:"isBeingObserved",get:function(){return oi(this.flags_,s.isBeingObservedMask_)},set:function(d){this.flags_=ai(this.flags_,s.isBeingObservedMask_,d)}},{key:"isPendingUnobservation",get:function(){return oi(this.flags_,s.isPendingUnobservationMask_)},set:function(d){this.flags_=ai(this.flags_,s.isPendingUnobservationMask_,d)}},{key:"diffValue",get:function(){return oi(this.flags_,s.diffValueMask_)?1:0},set:function(d){this.flags_=ai(this.flags_,s.diffValueMask_,d===1)}}])}();$i.isComputingMask_=1;$i.isRunningSetterMask_=2;$i.isBeingObservedMask_=4;$i.isPendingUnobservationMask_=8;$i.diffValueMask_=16;var Mh=Ba("ComputedValue",$i),dr;(function(s){s[s.NOT_TRACKING_=-1]="NOT_TRACKING_",s[s.UP_TO_DATE_=0]="UP_TO_DATE_",s[s.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",s[s.STALE_=2]="STALE_"})(dr||(dr={}));var Yp;(function(s){s[s.NONE=0]="NONE",s[s.LOG=1]="LOG",s[s.BREAK=2]="BREAK"})(Yp||(Yp={}));var Wp=function(n){this.cause=void 0,this.cause=n};function Op(s){return s instanceof Wp}function Hy(s){switch(s.dependenciesState_){case dr.UP_TO_DATE_:return!1;case dr.NOT_TRACKING_:case dr.STALE_:return!0;case dr.POSSIBLY_STALE_:{for(var n=AM(!0),c=qa(),d=s.observing_,f=d.length,m=0;m<f;m++){var y=d[m];if(Mh(y)){if(ft.disableErrorBoundaries)y.get();else try{y.get()}catch{return Ys(c),Cu(n),!0}if(s.dependenciesState_===dr.STALE_)return Ys(c),Cu(n),!0}}return lR(s),Ys(c),Cu(n),!1}}}function aR(s,n,c){var d=AM(!0);lR(s),s.newObserving_=new Array(s.runId_===0?100:s.observing_.length),s.unboundDepsCount_=0,s.runId_=++ft.runId;var f=ft.trackingDerivation;ft.trackingDerivation=s,ft.inBatch++;var m;if(ft.disableErrorBoundaries===!0)m=n.call(c);else try{m=n.call(c)}catch(y){m=new Wp(y)}return ft.inBatch--,ft.trackingDerivation=f,HG(s),Cu(d),m}function HG(s){for(var n=s.observing_,c=s.observing_=s.newObserving_,d=dr.UP_TO_DATE_,f=0,m=s.unboundDepsCount_,y=0;y<m;y++){var M=c[y];M.diffValue===0&&(M.diffValue=1,f!==y&&(c[f]=M),f++),M.dependenciesState_>d&&(d=M.dependenciesState_)}for(c.length=f,s.newObserving_=null,m=n.length;m--;){var S=n[m];S.diffValue===0&&uR(S,s),S.diffValue=0}for(;f--;){var E=c[f];E.diffValue===1&&(E.diffValue=0,$G(E,s))}d!==dr.UP_TO_DATE_&&(s.dependenciesState_=d,s.onBecomeStale_())}function $y(s){var n=s.observing_;s.observing_=[];for(var c=n.length;c--;)uR(n[c],s);s.dependenciesState_=dr.NOT_TRACKING_}function cR(s){var n=qa();try{return s()}finally{Ys(n)}}function qa(){var s=ft.trackingDerivation;return ft.trackingDerivation=null,s}function Ys(s){ft.trackingDerivation=s}function AM(s){var n=ft.allowStateReads;return ft.allowStateReads=s,n}function Cu(s){ft.allowStateReads=s}function lR(s){if(s.dependenciesState_!==dr.UP_TO_DATE_){s.dependenciesState_=dr.UP_TO_DATE_;for(var n=s.observing_,c=n.length;c--;)n[c].lowestObserverState_=dr.UP_TO_DATE_}}var Rv=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},Nv=!0,ft=function(){var s=IM();return s.__mobxInstanceCount>0&&!s.__mobxGlobals&&(Nv=!1),s.__mobxGlobals&&s.__mobxGlobals.version!==new Rv().version&&(Nv=!1),Nv?s.__mobxGlobals?(s.__mobxInstanceCount+=1,s.__mobxGlobals.UNCHANGED||(s.__mobxGlobals.UNCHANGED={}),s.__mobxGlobals):(s.__mobxInstanceCount=1,s.__mobxGlobals=new Rv):(setTimeout(function(){pr(35)},1),new Rv)}();function $G(s,n){s.observers_.add(n),s.lowestObserverState_>n.dependenciesState_&&(s.lowestObserverState_=n.dependenciesState_)}function uR(s,n){s.observers_.delete(n),s.observers_.size===0&&dR(s)}function dR(s){s.isPendingUnobservation===!1&&(s.isPendingUnobservation=!0,ft.pendingUnobservations.push(s))}function Si(){ft.inBatch++}function Ei(){if(--ft.inBatch===0){fR();for(var s=ft.pendingUnobservations,n=0;n<s.length;n++){var c=s[n];c.isPendingUnobservation=!1,c.observers_.size===0&&(c.isBeingObserved&&(c.isBeingObserved=!1,c.onBUO()),c instanceof $i&&c.suspend_())}ft.pendingUnobservations=[]}}function pR(s){var n=ft.trackingDerivation;return n!==null?(n.runId_!==s.lastAccessedBy_&&(s.lastAccessedBy_=n.runId_,n.newObserving_[n.unboundDepsCount_++]=s,!s.isBeingObserved&&ft.trackingContext&&(s.isBeingObserved=!0,s.onBO())),s.isBeingObserved):(s.observers_.size===0&&ft.inBatch>0&&dR(s),!1)}function hR(s){s.lowestObserverState_!==dr.STALE_&&(s.lowestObserverState_=dr.STALE_,s.observers_.forEach(function(n){n.dependenciesState_===dr.UP_TO_DATE_&&n.onBecomeStale_(),n.dependenciesState_=dr.STALE_}))}function KG(s){s.lowestObserverState_!==dr.STALE_&&(s.lowestObserverState_=dr.STALE_,s.observers_.forEach(function(n){n.dependenciesState_===dr.POSSIBLY_STALE_?n.dependenciesState_=dr.STALE_:n.dependenciesState_===dr.UP_TO_DATE_&&(s.lowestObserverState_=dr.UP_TO_DATE_)}))}function YG(s){s.lowestObserverState_===dr.UP_TO_DATE_&&(s.lowestObserverState_=dr.POSSIBLY_STALE_,s.observers_.forEach(function(n){n.dependenciesState_===dr.UP_TO_DATE_&&(n.dependenciesState_=dr.POSSIBLY_STALE_,n.onBecomeStale_())}))}var Ho=function(){function s(c,d,f,m){c===void 0&&(c="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=dr.NOT_TRACKING_,this.runId_=0,this.unboundDepsCount_=0,this.flags_=0,this.isTracing_=Yp.NONE,this.name_=c,this.onInvalidate_=d,this.errorHandler_=f,this.requiresObservable_=m}var n=s.prototype;return n.onBecomeStale_=function(){this.schedule_()},n.schedule_=function(){this.isScheduled||(this.isScheduled=!0,ft.pendingReactions.push(this),fR())},n.runReaction_=function(){if(!this.isDisposed){Si(),this.isScheduled=!1;var d=ft.trackingContext;if(ft.trackingContext=this,Hy(this)){this.isTrackPending=!0;try{this.onInvalidate_()}catch(f){this.reportExceptionInDerivation_(f)}}ft.trackingContext=d,Ei()}},n.track=function(d){if(!this.isDisposed){Si(),this.isRunning=!0;var f=ft.trackingContext;ft.trackingContext=this;var m=aR(this,d,void 0);ft.trackingContext=f,this.isRunning=!1,this.isTrackPending=!1,this.isDisposed&&$y(this),Op(m)&&this.reportExceptionInDerivation_(m.cause),Ei()}},n.reportExceptionInDerivation_=function(d){var f=this;if(this.errorHandler_){this.errorHandler_(d,this);return}if(ft.disableErrorBoundaries)throw d;var m="[mobx] uncaught error in '"+this+"'";ft.suppressReactionErrors||console.error(m,d),ft.globalReactionErrorHandlers.forEach(function(y){return y(d,f)})},n.dispose=function(){this.isDisposed||(this.isDisposed=!0,this.isRunning||(Si(),$y(this),Ei()))},n.getDisposer_=function(d){var f=this,m=function y(){f.dispose(),d==null||d.removeEventListener==null||d.removeEventListener("abort",y)};return d==null||d.addEventListener==null||d.addEventListener("abort",m),m[Ft]=this,m},n.toString=function(){return"Reaction["+this.name_+"]"},n.trace=function(d){},el(s,[{key:"isDisposed",get:function(){return oi(this.flags_,s.isDisposedMask_)},set:function(d){this.flags_=ai(this.flags_,s.isDisposedMask_,d)}},{key:"isScheduled",get:function(){return oi(this.flags_,s.isScheduledMask_)},set:function(d){this.flags_=ai(this.flags_,s.isScheduledMask_,d)}},{key:"isTrackPending",get:function(){return oi(this.flags_,s.isTrackPendingMask_)},set:function(d){this.flags_=ai(this.flags_,s.isTrackPendingMask_,d)}},{key:"isRunning",get:function(){return oi(this.flags_,s.isRunningMask_)},set:function(d){this.flags_=ai(this.flags_,s.isRunningMask_,d)}},{key:"diffValue",get:function(){return oi(this.flags_,s.diffValueMask_)?1:0},set:function(d){this.flags_=ai(this.flags_,s.diffValueMask_,d===1)}}])}();Ho.isDisposedMask_=1;Ho.isScheduledMask_=2;Ho.isTrackPendingMask_=4;Ho.isRunningMask_=8;Ho.diffValueMask_=16;var WG=100,JG=function(n){return n()};function fR(){ft.inBatch>0||ft.isRunningReactions||JG(QG)}function QG(){ft.isRunningReactions=!0;for(var s=ft.pendingReactions,n=0;s.length>0;){++n===WG&&(console.error("[mobx] cycle in reaction: "+s[0]),s.splice(0));for(var c=s.splice(0),d=0,f=c.length;d<f;d++)c[d].runReaction_()}ft.isRunningReactions=!1}var Jp=Ba("Reaction",Ho);function bu(){return!1}function zG(s){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}var mR="action",XG="action.bound",gR="autoAction",ZG="autoAction.bound",e6="<unnamed action>",Ky=Wu(mR),t6=Wu(XG,{bound:!0}),Yy=Wu(gR,{autoAction:!0}),r6=Wu(ZG,{autoAction:!0,bound:!0});function vR(s){var n=function(d,f){if(Hi(d))return Ua(d.name||e6,d,s);if(Hi(f))return Ua(d,f,s);if(Yu(f))return(s?Yy:Ky).decorate_20223_(d,f);if(Va(f))return Ku(d,f,s?Yy:Ky);if(Va(d))return ls(Wu(s?gR:mR,{name:d,autoAction:s}))};return n}var Uc=vR(!1);Object.assign(Uc,Ky);var Bu=vR(!0);Object.assign(Bu,Yy);Uc.bound=ls(t6);Bu.bound=ls(r6);function qu(s){return Hi(s)&&s.isMobxAction===!0}function yR(s,n){var c,d,f,m;n===void 0&&(n=H1);var y=(c=(d=n)==null?void 0:d.name)!=null?c:"Autorun",M=!n.scheduler&&!n.delay,S;if(M)S=new Ho(y,function(){this.track(R)},n.onError,n.requiresObservable);else{var E=i6(n),b=!1;S=new Ho(y,function(){b||(b=!0,E(function(){b=!1,S.isDisposed||S.track(R)}))},n.onError,n.requiresObservable)}function R(){s(S)}return(f=n)!=null&&(f=f.signal)!=null&&f.aborted||S.schedule_(),S.getDisposer_((m=n)==null?void 0:m.signal)}var n6=function(n){return n()};function i6(s){return s.scheduler?s.scheduler:s.delay?function(n){return setTimeout(n,s.delay)}:n6}var s6="onBO",o6="onBUO";function a6(s,n,c){return MR(s6,s,n,c)}function _R(s,n,c){return MR(o6,s,n,c)}function MR(s,n,c,d){var f=Wy(n),m=Hi(d)?d:c,y=s+"L";return f[y]?f[y].add(m):f[y]=new Set([m]),function(){var M=f[y];M&&(M.delete(m),M.size===0&&delete f[y])}}function TR(s,n,c,d){var f=J5(n);return ja(function(){var m=tl(s,d)[Ft];Fu(f).forEach(function(y){m.extend_(y,f[y],c&&y in c?c[y]:!0)})}),s}var c6=0;function IR(){this.message="FLOW_CANCELLED"}IR.prototype=Object.create(Error.prototype);var kv=eR("flow"),l6=eR("flow.bound",{bound:!0}),Xc=Object.assign(function(n,c){if(Yu(c))return kv.decorate_20223_(n,c);if(Va(c))return Ku(n,c,kv);var d=n,f=d.name||"<unnamed flow>",m=function(){var M=this,S=arguments,E=++c6,b=Uc(f+" - runid: "+E+" - init",d).apply(M,S),R,x=void 0,L=new Promise(function(q,D){var G=0;R=D;function J($){x=void 0;var Z;try{Z=Uc(f+" - runid: "+E+" - yield "+G++,b.next).call(b,$)}catch(le){return D(le)}z(Z)}function ne($){x=void 0;var Z;try{Z=Uc(f+" - runid: "+E+" - yield "+G++,b.throw).call(b,$)}catch(le){return D(le)}z(Z)}function z($){if(Hi($==null?void 0:$.then)){$.then(z,D);return}return $.done?q($.value):(x=Promise.resolve($.value),x.then(J,ne))}J(void 0)});return L.cancel=Uc(f+" - runid: "+E+" - cancel",function(){try{x&&jb(x);var q=b.return(void 0),D=Promise.resolve(q.value);D.then(Lc,Lc),jb(D),R(new IR)}catch(G){R(G)}}),L};return m.isMobXFlow=!0,m},kv);Xc.bound=ls(l6);function jb(s){Hi(s.cancel)&&s.cancel()}function Gu(s){return(s==null?void 0:s.isMobXFlow)===!0}function u6(s,n){return s?Ih(s)||!!s[Ft]||SM(s)||Jp(s)||Mh(s):!1}function SR(s){return u6(s)}function $s(s,n){n===void 0&&(n=void 0),Si();try{return s.apply(n)}finally{Ei()}}function Rc(s){return s[Ft]}var d6={has:function(n,c){return Rc(n).has_(c)},get:function(n,c){return Rc(n).get_(c)},set:function(n,c,d){var f;return Va(c)?(f=Rc(n).set_(c,d,!0))!=null?f:!0:!1},deleteProperty:function(n,c){var d;return Va(c)?(d=Rc(n).delete_(c,!0))!=null?d:!0:!1},defineProperty:function(n,c,d){var f;return(f=Rc(n).defineProperty_(c,d))!=null?f:!0},ownKeys:function(n){return Rc(n).ownKeys_()},preventExtensions:function(n){pr(13)}};function p6(s,n){var c,d;return $1(),s=tl(s,n),(d=(c=s[Ft]).proxy_)!=null?d:c.proxy_=new Proxy(s,d6)}function Ti(s){return s.interceptors_!==void 0&&s.interceptors_.length>0}function Ju(s,n){var c=s.interceptors_||(s.interceptors_=[]);return c.push(n),K1(function(){var d=c.indexOf(n);d!==-1&&c.splice(d,1)})}function Ii(s,n){var c=qa();try{for(var d=[].concat(s.interceptors_||[]),f=0,m=d.length;f<m&&(n=d[f](n),n&&!n.type&&pr(14),!!n);f++);return n}finally{Ys(c)}}function Bi(s){return s.changeListeners_!==void 0&&s.changeListeners_.length>0}function Qu(s,n){var c=s.changeListeners_||(s.changeListeners_=[]);return c.push(n),K1(function(){var d=c.indexOf(n);d!==-1&&c.splice(d,1)})}function qi(s,n){var c=qa(),d=s.changeListeners_;if(d){d=d.slice();for(var f=0,m=d.length;f<m;f++)d[f](n);Ys(c)}}var Ov=Symbol("mobx-keys");function vn(s,n,c){return Ws(s)?TR(s,s,n,c):(ja(function(){var d=tl(s,c)[Ft];if(!s[Ov]){var f=Object.getPrototypeOf(s),m=new Set([].concat(Fu(s),Fu(f)));m.delete("constructor"),m.delete(Ft),gh(f,Ov,m)}s[Ov].forEach(function(y){return d.make_(y,n&&y in n?n[y]:!0)})}),s)}var Hb="splice",us="update",h6=1e4,f6={get:function(n,c){var d=n[Ft];return c===Ft?d:c==="length"?d.getArrayLength_():typeof c=="string"&&!isNaN(c)?d.get_(parseInt(c)):Go(Qp,c)?Qp[c]:n[c]},set:function(n,c,d){var f=n[Ft];return c==="length"&&f.setArrayLength_(d),typeof c=="symbol"||isNaN(c)?n[c]=d:f.set_(parseInt(c),d),!0},preventExtensions:function(){pr(15)}},RM=function(){function s(c,d,f,m){c===void 0&&(c="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=f,this.legacyMode_=m,this.atom_=new Yo(c),this.enhancer_=function(y,M){return d(y,M,"ObservableArray[..]")}}var n=s.prototype;return n.dehanceValue_=function(d){return this.dehancer!==void 0?this.dehancer(d):d},n.dehanceValues_=function(d){return this.dehancer!==void 0&&d.length>0?d.map(this.dehancer):d},n.intercept_=function(d){return Ju(this,d)},n.observe_=function(d,f){return f===void 0&&(f=!1),f&&d({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),Qu(this,d)},n.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},n.setArrayLength_=function(d){(typeof d!="number"||isNaN(d)||d<0)&&pr("Out of range: "+d);var f=this.values_.length;if(d!==f)if(d>f){for(var m=new Array(d-f),y=0;y<d-f;y++)m[y]=void 0;this.spliceWithArray_(f,0,m)}else this.spliceWithArray_(d,f-d)},n.updateArrayLength_=function(d,f){d!==this.lastKnownLength_&&pr(16),this.lastKnownLength_+=f,this.legacyMode_&&f>0&&kR(d+f+1)},n.spliceWithArray_=function(d,f,m){var y=this;this.atom_;var M=this.values_.length;if(d===void 0?d=0:d>M?d=M:d<0&&(d=Math.max(0,M+d)),arguments.length===1?f=M-d:f==null?f=0:f=Math.max(0,Math.min(f,M-d)),m===void 0&&(m=By),Ti(this)){var S=Ii(this,{object:this.proxy_,type:Hb,index:d,removedCount:f,added:m});if(!S)return By;f=S.removedCount,m=S.added}if(m=m.length===0?m:m.map(function(R){return y.enhancer_(R,void 0)}),this.legacyMode_){var E=m.length-f;this.updateArrayLength_(M,E)}var b=this.spliceItemsIntoValues_(d,f,m);return(f!==0||m.length!==0)&&this.notifyArraySplice_(d,m,b),this.dehanceValues_(b)},n.spliceItemsIntoValues_=function(d,f,m){if(m.length<h6){var y;return(y=this.values_).splice.apply(y,[d,f].concat(m))}else{var M=this.values_.slice(d,d+f),S=this.values_.slice(d+f);this.values_.length+=m.length-f;for(var E=0;E<m.length;E++)this.values_[d+E]=m[E];for(var b=0;b<S.length;b++)this.values_[d+m.length+b]=S[b];return M}},n.notifyArrayChildUpdate_=function(d,f,m){var y=!this.owned_&&bu(),M=Bi(this),S=M||y?{observableKind:"array",object:this.proxy_,type:us,debugObjectName:this.atom_.name_,index:d,newValue:f,oldValue:m}:null;this.atom_.reportChanged(),M&&qi(this,S)},n.notifyArraySplice_=function(d,f,m){var y=!this.owned_&&bu(),M=Bi(this),S=M||y?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:Hb,index:d,removed:m,added:f,removedCount:m.length,addedCount:f.length}:null;this.atom_.reportChanged(),M&&qi(this,S)},n.get_=function(d){if(this.legacyMode_&&d>=this.values_.length){console.warn("[mobx] Out of bounds read: "+d);return}return this.atom_.reportObserved(),this.dehanceValue_(this.values_[d])},n.set_=function(d,f){var m=this.values_;if(this.legacyMode_&&d>m.length&&pr(17,d,m.length),d<m.length){this.atom_;var y=m[d];if(Ti(this)){var M=Ii(this,{type:us,object:this.proxy_,index:d,newValue:f});if(!M)return;f=M.newValue}f=this.enhancer_(f,y);var S=f!==y;S&&(m[d]=f,this.notifyArrayChildUpdate_(d,f,y))}else{for(var E=new Array(d+1-m.length),b=0;b<E.length-1;b++)E[b]=void 0;E[E.length-1]=f,this.spliceWithArray_(m.length,0,E)}},s}();function m6(s,n,c,d){return c===void 0&&(c="ObservableArray"),d===void 0&&(d=!1),$1(),ja(function(){var f=new RM(c,n,d,!1);W1(f.values_,Ft,f);var m=new Proxy(f.values_,f6);return f.proxy_=m,s&&s.length&&f.spliceWithArray_(0,0,s),m})}var Qp={clear:function(){return this.splice(0)},replace:function(n){var c=this[Ft];return c.spliceWithArray_(0,c.values_.length,n)},toJSON:function(){return this.slice()},splice:function(n,c){for(var d=arguments.length,f=new Array(d>2?d-2:0),m=2;m<d;m++)f[m-2]=arguments[m];var y=this[Ft];switch(arguments.length){case 0:return[];case 1:return y.spliceWithArray_(n);case 2:return y.spliceWithArray_(n,c)}return y.spliceWithArray_(n,c,f)},spliceWithArray:function(n,c,d){return this[Ft].spliceWithArray_(n,c,d)},push:function(){for(var n=this[Ft],c=arguments.length,d=new Array(c),f=0;f<c;f++)d[f]=arguments[f];return n.spliceWithArray_(n.values_.length,0,d),n.values_.length},pop:function(){return this.splice(Math.max(this[Ft].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var n=this[Ft],c=arguments.length,d=new Array(c),f=0;f<c;f++)d[f]=arguments[f];return n.spliceWithArray_(0,0,d),n.values_.length},reverse:function(){return ft.trackingDerivation&&pr(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){ft.trackingDerivation&&pr(37,"sort");var n=this.slice();return n.sort.apply(n,arguments),this.replace(n),this},remove:function(n){var c=this[Ft],d=c.dehanceValues_(c.values_).indexOf(n);return d>-1?(this.splice(d,1),!0):!1}};Pr("at",li);Pr("concat",li);Pr("flat",li);Pr("includes",li);Pr("indexOf",li);Pr("join",li);Pr("lastIndexOf",li);Pr("slice",li);Pr("toString",li);Pr("toLocaleString",li);Pr("toSorted",li);Pr("toSpliced",li);Pr("with",li);Pr("every",Ki);Pr("filter",Ki);Pr("find",Ki);Pr("findIndex",Ki);Pr("findLast",Ki);Pr("findLastIndex",Ki);Pr("flatMap",Ki);Pr("forEach",Ki);Pr("map",Ki);Pr("some",Ki);Pr("toReversed",Ki);Pr("reduce",ER);Pr("reduceRight",ER);function Pr(s,n){typeof Array.prototype[s]=="function"&&(Qp[s]=n(s))}function li(s){return function(){var n=this[Ft];n.atom_.reportObserved();var c=n.dehanceValues_(n.values_);return c[s].apply(c,arguments)}}function Ki(s){return function(n,c){var d=this,f=this[Ft];f.atom_.reportObserved();var m=f.dehanceValues_(f.values_);return m[s](function(y,M){return n.call(c,y,M,d)})}}function ER(s){return function(){var n=this,c=this[Ft];c.atom_.reportObserved();var d=c.dehanceValues_(c.values_),f=arguments[0];return arguments[0]=function(m,y,M){return f(m,y,M,n)},d[s].apply(d,arguments)}}var g6=Ba("ObservableArrayAdministration",RM);function Th(s){return mh(s)&&g6(s[Ft])}var v6={},Bo="add",zp="delete",CR=function(){function s(c,d,f){var m=this;d===void 0&&(d=Da),f===void 0&&(f="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[Ft]=v6,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=d,this.name_=f,Hi(Map)||pr(18),ja(function(){m.keysAtom_=X1("ObservableMap.keys()"),m.data_=new Map,m.hasMap_=new Map,c&&m.merge(c)})}var n=s.prototype;return n.has_=function(d){return this.data_.has(d)},n.has=function(d){var f=this;if(!ft.trackingDerivation)return this.has_(d);var m=this.hasMap_.get(d);if(!m){var y=m=new Pa(this.has_(d),vh,"ObservableMap.key?",!1);this.hasMap_.set(d,y),_R(y,function(){return f.hasMap_.delete(d)})}return m.get()},n.set=function(d,f){var m=this.has_(d);if(Ti(this)){var y=Ii(this,{type:m?us:Bo,object:this,newValue:f,name:d});if(!y)return this;f=y.newValue}return m?this.updateValue_(d,f):this.addValue_(d,f),this},n.delete=function(d){var f=this;if(this.keysAtom_,Ti(this)){var m=Ii(this,{type:zp,object:this,name:d});if(!m)return!1}if(this.has_(d)){var y=bu(),M=Bi(this),S=M||y?{observableKind:"map",debugObjectName:this.name_,type:zp,object:this,oldValue:this.data_.get(d).value_,name:d}:null;return $s(function(){var E;f.keysAtom_.reportChanged(),(E=f.hasMap_.get(d))==null||E.setNewValue_(!1);var b=f.data_.get(d);b.setNewValue_(void 0),f.data_.delete(d)}),M&&qi(this,S),!0}return!1},n.updateValue_=function(d,f){var m=this.data_.get(d);if(f=m.prepareNewValue_(f),f!==ft.UNCHANGED){var y=bu(),M=Bi(this),S=M||y?{observableKind:"map",debugObjectName:this.name_,type:us,object:this,oldValue:m.value_,name:d,newValue:f}:null;m.setNewValue_(f),M&&qi(this,S)}},n.addValue_=function(d,f){var m=this;this.keysAtom_,$s(function(){var E,b=new Pa(f,m.enhancer_,"ObservableMap.key",!1);m.data_.set(d,b),f=b.value_,(E=m.hasMap_.get(d))==null||E.setNewValue_(!0),m.keysAtom_.reportChanged()});var y=bu(),M=Bi(this),S=M||y?{observableKind:"map",debugObjectName:this.name_,type:Bo,object:this,name:d,newValue:f}:null;M&&qi(this,S)},n.get=function(d){return this.has(d)?this.dehanceValue_(this.data_.get(d).get()):this.dehanceValue_(void 0)},n.dehanceValue_=function(d){return this.dehancer!==void 0?this.dehancer(d):d},n.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},n.values=function(){var d=this,f=this.keys();return $b({next:function(){var y=f.next(),M=y.done,S=y.value;return{done:M,value:M?void 0:d.get(S)}}})},n.entries=function(){var d=this,f=this.keys();return $b({next:function(){var y=f.next(),M=y.done,S=y.value;return{done:M,value:M?void 0:[S,d.get(S)]}}})},n[Symbol.iterator]=function(){return this.entries()},n.forEach=function(d,f){for(var m=Vc(this),y;!(y=m()).done;){var M=y.value,S=M[0],E=M[1];d.call(f,E,S,this)}},n.merge=function(d){var f=this;return Ga(d)&&(d=new Map(d)),$s(function(){Ws(d)?W5(d).forEach(function(m){return f.set(m,d[m])}):Array.isArray(d)?d.forEach(function(m){var y=m[0],M=m[1];return f.set(y,M)}):Zc(d)?(Y5(d)||pr(19,d),d.forEach(function(m,y){return f.set(y,m)})):d!=null&&pr(20,d)}),this},n.clear=function(){var d=this;$s(function(){cR(function(){for(var f=Vc(d.keys()),m;!(m=f()).done;){var y=m.value;d.delete(y)}})})},n.replace=function(d){var f=this;return $s(function(){for(var m=y6(d),y=new Map,M=!1,S=Vc(f.data_.keys()),E;!(E=S()).done;){var b=E.value;if(!m.has(b)){var R=f.delete(b);if(R)M=!0;else{var x=f.data_.get(b);y.set(b,x)}}}for(var L=Vc(m.entries()),q;!(q=L()).done;){var D=q.value,G=D[0],J=D[1],ne=f.data_.has(G);if(f.set(G,J),f.data_.has(G)){var z=f.data_.get(G);y.set(G,z),ne||(M=!0)}}if(!M)if(f.data_.size!==y.size)f.keysAtom_.reportChanged();else for(var $=f.data_.keys(),Z=y.keys(),le=$.next(),fe=Z.next();!le.done;){if(le.value!==fe.value){f.keysAtom_.reportChanged();break}le=$.next(),fe=Z.next()}f.data_=y}),this},n.toString=function(){return"[object ObservableMap]"},n.toJSON=function(){return Array.from(this)},n.observe_=function(d,f){return Qu(this,d)},n.intercept_=function(d){return Ju(this,d)},el(s,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Map"}}])}(),Ga=Ba("ObservableMap",CR);function $b(s){return s[Symbol.toStringTag]="MapIterator",kM(s)}function y6(s){if(Zc(s)||Ga(s))return s;if(Array.isArray(s))return new Map(s);if(Ws(s)){var n=new Map;for(var c in s)n.set(c,s[c]);return n}else return pr(21,s)}var _6={},bR=function(){function s(c,d,f){var m=this;d===void 0&&(d=Da),f===void 0&&(f="ObservableSet"),this.name_=void 0,this[Ft]=_6,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=f,Hi(Set)||pr(22),this.enhancer_=function(y,M){return d(y,M,f)},ja(function(){m.atom_=X1(m.name_),c&&m.replace(c)})}var n=s.prototype;return n.dehanceValue_=function(d){return this.dehancer!==void 0?this.dehancer(d):d},n.clear=function(){var d=this;$s(function(){cR(function(){for(var f=Vc(d.data_.values()),m;!(m=f()).done;){var y=m.value;d.delete(y)}})})},n.forEach=function(d,f){for(var m=Vc(this),y;!(y=m()).done;){var M=y.value;d.call(f,M,M,this)}},n.add=function(d){var f=this;if(this.atom_,Ti(this)){var m=Ii(this,{type:Bo,object:this,newValue:d});if(!m)return this}if(!this.has(d)){$s(function(){f.data_.add(f.enhancer_(d,void 0)),f.atom_.reportChanged()});var y=!1,M=Bi(this),S=M||y?{observableKind:"set",debugObjectName:this.name_,type:Bo,object:this,newValue:d}:null;M&&qi(this,S)}return this},n.delete=function(d){var f=this;if(Ti(this)){var m=Ii(this,{type:zp,object:this,oldValue:d});if(!m)return!1}if(this.has(d)){var y=!1,M=Bi(this),S=M||y?{observableKind:"set",debugObjectName:this.name_,type:zp,object:this,oldValue:d}:null;return $s(function(){f.atom_.reportChanged(),f.data_.delete(d)}),M&&qi(this,S),!0}return!1},n.has=function(d){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(d))},n.entries=function(){var d=this.values();return Kb({next:function(){var m=d.next(),y=m.value,M=m.done;return M?{value:void 0,done:M}:{value:[y,y],done:M}}})},n.keys=function(){return this.values()},n.values=function(){this.atom_.reportObserved();var d=this,f=this.data_.values();return Kb({next:function(){var y=f.next(),M=y.value,S=y.done;return S?{value:void 0,done:S}:{value:d.dehanceValue_(M),done:S}}})},n.intersection=function(d){if(Hs(d)&&!os(d))return d.intersection(this);var f=new Set(this);return f.intersection(d)},n.union=function(d){if(Hs(d)&&!os(d))return d.union(this);var f=new Set(this);return f.union(d)},n.difference=function(d){return new Set(this).difference(d)},n.symmetricDifference=function(d){if(Hs(d)&&!os(d))return d.symmetricDifference(this);var f=new Set(this);return f.symmetricDifference(d)},n.isSubsetOf=function(d){return new Set(this).isSubsetOf(d)},n.isSupersetOf=function(d){return new Set(this).isSupersetOf(d)},n.isDisjointFrom=function(d){if(Hs(d)&&!os(d))return d.isDisjointFrom(this);var f=new Set(this);return f.isDisjointFrom(d)},n.replace=function(d){var f=this;return os(d)&&(d=new Set(d)),$s(function(){Array.isArray(d)?(f.clear(),d.forEach(function(m){return f.add(m)})):Hs(d)?(f.clear(),d.forEach(function(m){return f.add(m)})):d!=null&&pr("Cannot initialize set from "+d)}),this},n.observe_=function(d,f){return Qu(this,d)},n.intercept_=function(d){return Ju(this,d)},n.toJSON=function(){return Array.from(this)},n.toString=function(){return"[object ObservableSet]"},n[Symbol.iterator]=function(){return this.values()},el(s,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Set"}}])}(),os=Ba("ObservableSet",bR);function Kb(s){return s[Symbol.toStringTag]="SetIterator",kM(s)}var Yb=Object.create(null),Wb="remove",AR=function(){function s(c,d,f,m){d===void 0&&(d=new Map),m===void 0&&(m=SG),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=c,this.values_=d,this.name_=f,this.defaultAnnotation_=m,this.keysAtom_=new Yo("ObservableObject.keys"),this.isPlainObject_=Ws(this.target_)}var n=s.prototype;return n.getObservablePropValue_=function(d){return this.values_.get(d).get()},n.setObservablePropValue_=function(d,f){var m=this.values_.get(d);if(m instanceof $i)return m.set(f),!0;if(Ti(this)){var y=Ii(this,{type:us,object:this.proxy_||this.target_,name:d,newValue:f});if(!y)return null;f=y.newValue}if(f=m.prepareNewValue_(f),f!==ft.UNCHANGED){var M=Bi(this),S=!1,E=M||S?{type:us,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:m.value_,name:d,newValue:f}:null;m.setNewValue_(f),M&&qi(this,E)}return!0},n.get_=function(d){return ft.trackingDerivation&&!Go(this.target_,d)&&this.has_(d),this.target_[d]},n.set_=function(d,f,m){return m===void 0&&(m=!1),Go(this.target_,d)?this.values_.has(d)?this.setObservablePropValue_(d,f):m?Reflect.set(this.target_,d,f):(this.target_[d]=f,!0):this.extend_(d,{value:f,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,m)},n.has_=function(d){if(!ft.trackingDerivation)return d in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var f=this.pendingKeys_.get(d);return f||(f=new Pa(d in this.target_,vh,"ObservableObject.key?",!1),this.pendingKeys_.set(d,f)),f.get()},n.make_=function(d,f){if(f===!0&&(f=this.defaultAnnotation_),f!==!1){if(!(d in this.target_)){var m;if((m=this.target_[Dc])!=null&&m[d])return;pr(1,f.annotationType_,this.name_+"."+d.toString())}for(var y=this.target_;y&&y!==fh;){var M=Hp(y,d);if(M){var S=f.make_(this,d,M,y);if(S===0)return;if(S===1)break}y=Object.getPrototypeOf(y)}Qb(this,f,d)}},n.extend_=function(d,f,m,y){if(y===void 0&&(y=!1),m===!0&&(m=this.defaultAnnotation_),m===!1)return this.defineProperty_(d,f,y);var M=m.extend_(this,d,f,y);return M&&Qb(this,m,d),M},n.defineProperty_=function(d,f,m){m===void 0&&(m=!1),this.keysAtom_;try{Si();var y=this.delete_(d);if(!y)return y;if(Ti(this)){var M=Ii(this,{object:this.proxy_||this.target_,name:d,type:Bo,newValue:f.value});if(!M)return null;var S=M.newValue;f.value!==S&&(f=zc({},f,{value:S}))}if(m){if(!Reflect.defineProperty(this.target_,d,f))return!1}else cs(this.target_,d,f);this.notifyPropertyAddition_(d,f.value)}finally{Ei()}return!0},n.defineObservableProperty_=function(d,f,m,y){y===void 0&&(y=!1),this.keysAtom_;try{Si();var M=this.delete_(d);if(!M)return M;if(Ti(this)){var S=Ii(this,{object:this.proxy_||this.target_,name:d,type:Bo,newValue:f});if(!S)return null;f=S.newValue}var E=Jb(d),b={configurable:ft.safeDescriptors?this.isPlainObject_:!0,enumerable:!0,get:E.get,set:E.set};if(y){if(!Reflect.defineProperty(this.target_,d,b))return!1}else cs(this.target_,d,b);var R=new Pa(f,m,"ObservableObject.key",!1);this.values_.set(d,R),this.notifyPropertyAddition_(d,R.value_)}finally{Ei()}return!0},n.defineComputedProperty_=function(d,f,m){m===void 0&&(m=!1),this.keysAtom_;try{Si();var y=this.delete_(d);if(!y)return y;if(Ti(this)){var M=Ii(this,{object:this.proxy_||this.target_,name:d,type:Bo,newValue:void 0});if(!M)return null}f.name||(f.name="ObservableObject.key"),f.context=this.proxy_||this.target_;var S=Jb(d),E={configurable:ft.safeDescriptors?this.isPlainObject_:!0,enumerable:!1,get:S.get,set:S.set};if(m){if(!Reflect.defineProperty(this.target_,d,E))return!1}else cs(this.target_,d,E);this.values_.set(d,new $i(f)),this.notifyPropertyAddition_(d,void 0)}finally{Ei()}return!0},n.delete_=function(d,f){if(f===void 0&&(f=!1),this.keysAtom_,!Go(this.target_,d))return!0;if(Ti(this)){var m=Ii(this,{object:this.proxy_||this.target_,name:d,type:Wb});if(!m)return null}try{var y;Si();var M=Bi(this),S=!1,E=this.values_.get(d),b=void 0;if(!E&&(M||S)){var R;b=(R=Hp(this.target_,d))==null?void 0:R.value}if(f){if(!Reflect.deleteProperty(this.target_,d))return!1}else delete this.target_[d];if(E&&(this.values_.delete(d),E instanceof Pa&&(b=E.value_),hR(E)),this.keysAtom_.reportChanged(),(y=this.pendingKeys_)==null||(y=y.get(d))==null||y.set(d in this.target_),M||S){var x={type:Wb,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:b,name:d};M&&qi(this,x)}}finally{Ei()}return!0},n.observe_=function(d,f){return Qu(this,d)},n.intercept_=function(d){return Ju(this,d)},n.notifyPropertyAddition_=function(d,f){var m,y=Bi(this),M=!1;if(y||M){var S=y||M?{type:Bo,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:d,newValue:f}:null;y&&qi(this,S)}(m=this.pendingKeys_)==null||(m=m.get(d))==null||m.set(!0),this.keysAtom_.reportChanged()},n.ownKeys_=function(){return this.keysAtom_.reportObserved(),Fu(this.target_)},n.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},s}();function tl(s,n){var c;if(Go(s,Ft))return s;var d=(c=n==null?void 0:n.name)!=null?c:"ObservableObject",f=new AR(s,new Map,String(d),PG(n));return gh(s,Ft,f),s}var M6=Ba("ObservableObjectAdministration",AR);function Jb(s){return Yb[s]||(Yb[s]={get:function(){return this[Ft].getObservablePropValue_(s)},set:function(c){return this[Ft].setObservablePropValue_(s,c)}})}function Ih(s){return mh(s)?M6(s[Ft]):!1}function Qb(s,n,c){var d;(d=s.target_[Dc])==null||delete d[c]}var T6=NR(0),I6=function(){var s=!1,n={};return Object.defineProperty(n,"0",{set:function(){s=!0}}),Object.create(n)[0]=1,s===!1}(),wv=0,RR=function(){};function S6(s,n){Object.setPrototypeOf?Object.setPrototypeOf(s.prototype,n):s.prototype.__proto__!==void 0?s.prototype.__proto__=n:s.prototype=n}S6(RR,Array.prototype);var NM=function(s){function n(d,f,m,y){var M;return m===void 0&&(m="ObservableArray"),y===void 0&&(y=!1),M=s.call(this)||this,ja(function(){var S=new RM(m,f,y,!0);S.proxy_=M,W1(M,Ft,S),d&&d.length&&M.spliceWithArray(0,0,d),I6&&Object.defineProperty(M,"0",T6)}),M}z1(n,s);var c=n.prototype;return c.concat=function(){this[Ft].atom_.reportObserved();for(var f=arguments.length,m=new Array(f),y=0;y<f;y++)m[y]=arguments[y];return Array.prototype.concat.apply(this.slice(),m.map(function(M){return Th(M)?M.slice():M}))},c[Symbol.iterator]=function(){var d=this,f=0;return kM({next:function(){return f<d.length?{value:d[f++],done:!1}:{done:!0,value:void 0}}})},el(n,[{key:"length",get:function(){return this[Ft].getArrayLength_()},set:function(f){this[Ft].setArrayLength_(f)}},{key:Symbol.toStringTag,get:function(){return"Array"}}])}(RR);Object.entries(Qp).forEach(function(s){var n=s[0],c=s[1];n!=="concat"&&gh(NM.prototype,n,c)});function NR(s){return{enumerable:!1,configurable:!0,get:function(){return this[Ft].get_(s)},set:function(c){this[Ft].set_(s,c)}}}function E6(s){cs(NM.prototype,""+s,NR(s))}function kR(s){if(s>wv){for(var n=wv;n<s+100;n++)E6(n);wv=s}}kR(1e3);function C6(s,n,c){return new NM(s,n,c)}function Wy(s,n){if(typeof s=="object"&&s!==null){if(Th(s))return n!==void 0&&pr(23),s[Ft].atom_;if(os(s))return s.atom_;if(Ga(s)){if(n===void 0)return s.keysAtom_;var c=s.data_.get(n)||s.hasMap_.get(n);return c||pr(25,n,Jy(s)),c}if(Ih(s)){if(!n)return pr(26);var d=s[Ft].values_.get(n);return d||pr(27,n,Jy(s)),d}if(SM(s)||Mh(s)||Jp(s))return s}else if(Hi(s)&&Jp(s[Ft]))return s[Ft];pr(28)}function b6(s,n){if(s||pr(29),SM(s)||Mh(s)||Jp(s)||Ga(s)||os(s))return s;if(s[Ft])return s[Ft];pr(24,s)}function Jy(s,n){var c;if(n!==void 0)c=Wy(s,n);else{if(qu(s))return s.name;Ih(s)||Ga(s)||os(s)?c=b6(s):c=Wy(s)}return c.name_}function ja(s){var n=qa(),c=CM(!0);Si();try{return s()}finally{Ei(),bM(c),Ys(n)}}var zb=fh.toString;function OR(s,n,c){return c===void 0&&(c=-1),Qy(s,n,c)}function Qy(s,n,c,d,f){if(s===n)return s!==0||1/s===1/n;if(s==null||n==null)return!1;if(s!==s)return n!==n;var m=typeof s;if(m!=="function"&&m!=="object"&&typeof n!="object")return!1;var y=zb.call(s);if(y!==zb.call(n))return!1;switch(y){case"[object RegExp]":case"[object String]":return""+s==""+n;case"[object Number]":return+s!=+s?+n!=+n:+s==0?1/+s===1/n:+s==+n;case"[object Date]":case"[object Boolean]":return+s==+n;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(s)===Symbol.valueOf.call(n);case"[object Map]":case"[object Set]":c>=0&&c++;break}s=Xb(s),n=Xb(n);var M=y==="[object Array]";if(!M){if(typeof s!="object"||typeof n!="object")return!1;var S=s.constructor,E=n.constructor;if(S!==E&&!(Hi(S)&&S instanceof S&&Hi(E)&&E instanceof E)&&"constructor"in s&&"constructor"in n)return!1}if(c===0)return!1;c<0&&(c=-1),d=d||[],f=f||[];for(var b=d.length;b--;)if(d[b]===s)return f[b]===n;if(d.push(s),f.push(n),M){if(b=s.length,b!==n.length)return!1;for(;b--;)if(!Qy(s[b],n[b],c-1,d,f))return!1}else{var R=Object.keys(s),x;if(b=R.length,Object.keys(n).length!==b)return!1;for(;b--;)if(x=R[b],!(Go(n,x)&&Qy(s[x],n[x],c-1,d,f)))return!1}return d.pop(),f.pop(),!0}function Xb(s){return Th(s)?s.slice():Zc(s)||Ga(s)||Hs(s)||os(s)?Array.from(s.entries()):s}var Zb,A6=((Zb=IM().Iterator)==null?void 0:Zb.prototype)||{};function kM(s){return s[Symbol.iterator]=R6,Object.assign(Object.create(A6),s)}function R6(){return this}["Symbol","Map","Set"].forEach(function(s){var n=IM();typeof n[s]>"u"&&pr("MobX requires global '"+s+"' to be available or polyfilled")});typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:zG,extras:{getDebugName:Jy},$mobx:Ft});const N6={appText:"NIM H5",messageText:"Message",contactText:"Contacts",mineText:"Me",logoutText:"Log out",commsEaseText:"About NIM",logoutConfirmText:"Are you sure you want to log out?",avatarText:"Avatar",accountText:"Account",name:"Nickname",genderText:"Gender",remark:"remark",mobile:"Phone",email:"Email",sign:"Signature",man:"Male",woman:"Female",unknow:"Unknown",birthText:"Birthday",FriendPageText:"Friend Card",startConversationText:"Start Chat",addText:"Add",applyFriendSuccessText:"Request Sent",applyFriendFailText:"Request Failed",addFriendText:"Add Friend",addFriendFailText:"Add Friend Failed",deleteFriendText:"Delete Friend",deleteFriendConfirmText:"Are you sure you want to delete this friend?",deleteFriendSuccessText:"Delete Friend Success",deleteFriendFailText:"Delete Friend Failed",setBlackFailText:"Add to blacklist failed",removeBlackFailText:"Remove from blacklist failed",removeBlackSuccessText:"Remove from blacklist success",addPermissionText:"Please add relevant permissions in the system settings page",FailAvatarText:"Avatar upload failed",chooseDefaultImage:"Choose default image",chatButtonText:"Go to Chat",gotoChatFailText:"Go to chat failed",chatWithFriendText:"Chat",okText:"OK",updateText:"Update",cancelText:"Cancel",friendSelectText:"Select Friend",telErrorText:"Invalid phone number format",emailErrorText:"Invalid email format",createButtonText:"Create",createP2PText:"Start Chat",createTeamText:"Create Team",addTeamMemberText:"Add Team Member",addTeamMemberFailText:"Add Team Member Failed",teamTitlePlaceholder:"Enter Team Name",maxSelectedText:"You can only select up to 200 friends",createTeamSuccessText:"Create Team Success",createTeamFailedText:"Create Team Failed",PersonalPageText:"PersonalCard",deleteSessionText:"Delete",sessionMuteText:"Mute Notifications",sessionMuteFailText:"Mute Notifications Failed",sessionUnMuteFailText:"Unmute Notifications Failed",stickTopText:"Pin Chat",deleteStickTopText:"Unpin Chat",addStickTopText:"Pin",deleteSessionFailText:"Delete Conversation Failed",deleteStickTopFailText:"Unpin Chat Failed",addStickTopFailText:"Pin Message Failed",teamMemberText:"Team Members",saveText:"Save",setText:"Settings",failText:"Failed",saveSuccessText:"Save Success",saveFailedText:"Save Failed",searchTeamPlaceholder:"Enter Team Name",teamTitle:"Team Name",teamInfoText:"Team Infomation",teamIntro:"Introduction",teamAvatar:"Team Avatar",networkError:"Current network error",searchFailText:"Search Failed",offlineText:"Network is unavailable, please check network settings.",connectingText:"The current IM connection has been disconnected and is reconnecting",teamMenuText:"My Groups",teamChooseText:"My Team Chats",chooseText:"Choose",friendSelect:"Please select a contact",getHistoryMsgFailedText:"Failed to get message history",deleteText:"Delete",recallText:"Recall",copyText:"Copy",forwardText:"Forward",forwardComment:"forward comment",replyText:"Reply",replyNotFindText:"Message has recalled or deleted",forwardToTeamText:"Forward to Team",forwardToFriendText:"Forward to Contact",sessionRecordText:"Conversation Record",chatInputPlaceHolder:"What would you like to say?",enableV2CloudConversationText:"Enable V2 Cloud Conversation",SwitchToEnglishText:"Switch to English",pinText:"Mark",pinFailedText:"Mark Failed",unpinText:"Unmark",unpinFailedText:"Unmark Failed",noPinListText:"No Mark",collectionText:"Collection",deleteCollectionText:"Delete collection",addCollectionSuccessText:"Add collection success",addCollectionFailedText:"Add collection Failed",deleteCollectionFailedText:"Delete collection Failed",noCollectionsText:"No collection",teamBannedText:"Message Banned",you:"You",pinThisText:"Marked this message",delete:"Delete this message",recall:"Recalled a message",recall2:"This message has been recalled",recall3:"Recall this message",recallMsgFailText:"Recall Message Failed",reeditText:"Edit",loadingMoreText:"Loading",noMoreText:"No more",deleteMsgSuccessText:"Delete Success",deleteMsgFailText:"Delete Failed",conversationEmptyText:"No conversation",teamOwner:"Team Owner",teamManager:"Team Manager",teamEmptyText:"NoGroup Chats",blacklistEmptyText:"No Blocked Contacts",blacklistSubTitle:"You will not get messages from anyone on the list.    ",validEmptyText:"No Verification Messages",dismissTeamText:"Dismiss Team",dismissTeamConfirmText:"Are you sure you want to dismiss this team?",leaveTeamTitle:"Leave Team",leaveTeamConfirmText:"Are you sure you want to leave this team?",leaveTeamSuccessText:"You have left this team",leaveTeamFailedText:"Failed to leave this team",dismissTeamSuccessText:"Dismiss Team Success",dismissTeamFailedText:"Dismiss Team Failed",updateTeamSuccessText:"Update Success",updateTeamFailedText:"Update Failed",teamTitleConfirmText:"Team name cannot be empty",teamIntroConfirmText:"Team introduction cannot be empty",aliasConfirmText:"Alias cannot be empty",sendImageFailedText:"Failed to send Image",sendVideoFailedText:"Failed to send Video",sendAudioFailedText:"Failed to send Audio",sendFileFailedText:"Failed to send File",sendMsgFailedText:"Failed to send Message",tipText:"tip",selectImageText:"please select image",friendEditPlaceholder:"Please enter the friend's nickname",uikitVersion:"Version",IMVersion:"IM Version",productInfoText:"Product Info",weekText:"Weeks ago",dayText:"Days ago",hourText:"Hours ago",minuteText:"Minutes ago",nowText:"Just now",sendText:"Send",sendToText:"Send to",textMsgText:"Text Message",audioMsgText:"Audio Message",videoMsgText:"Video Message",fileMsgText:"File Message",callMsgText:"Call Message",geoMsgText:"Location Message",imgMsgText:"Image Message",notiMsgText:"Notification Message",robotMsgText:"Robot Message",tipMsgText:"Tip Message",customMsgText:"Custom Message",unknowMsgText:"Unknown Message",noFriendText:"No Friends",onDismissTeamText:"This team has been dismissed",onRemoveTeamText:"You have left the team",selectSessionFailText:"Failed to select conversation",noExistUser:"This user does not exist",enterAccount:"Enter account",validMsgText:"Verification Message",blacklistText:"Blocked Contacts",applyTeamText:"Apply to Join Team",acceptResultText:"Accepted",rejectResultText:"Rejected",rejectTeamInviteText:"Rejected team invitation",beRejectResultText:"Rejected friend request",passResultText:"Accepted friend request",acceptedText:"This request has been accepted",acceptFailedText:"Failed to accept this request",rejectedText:"This request has been rejected",rejectFailedText:"Failed to reject this request",passFriendAskText:"I have accepted your friend request, let's start chatting!",applyFriendText:"Add you as a friend",rejectText:"Reject",acceptText:"Accept",inviteTeamText:"Invite to Team",addBlacklist:"Block",removeBlacklist:"Unblock",forwardSuccessText:"Forward Success",forwardFailText:"Forward Failed",getMessageFailed:"Fail to get message",getForwardMessageFailed:"Fail to get forward message",sendFailWithInBlackText:"The other party has blocked you, message sending failed",sendFailWithDeleteText:"The relationship between both parties has been terminated, please reapply for contact",friendVerificationText:"Friend Verification",teamAll:"all",chooseMentionText:"Choose Mention",someoneText:"someone",meText:"mention",teamMutePlaceholder:"The current team owner has set the team to mute",viewMoreText:"View More",resendMsgFailText:"Resend Failed",audioBtnText:"Press and hold to speak",audioRemindText:"Release to send",audioErrorText:"Recording failed",videoPlayText:"Video Play",voiceCallText:"Voice Call",videoCallText:"Video Call",callDurationText:"call duration",callCancelText:"canceled",callRejectedText:"rejected",callTimeoutText:"Missed call",callBusyText:"busy line",callFailedText:"call failed",wxAppFileCopyText:"Please paste the URL in the mobile browser.",shootText:"shoot",albumText:"album",msgReadPageTitleText:"Message Reading Status",readText:"Read",unreadText:"Unread",fileText:"file",allUnReadText:"All Unread",msgRecallTimeErrorText:"Message recall time exceeded",allReadText:"All Read",searchText:"Search",searchTitleText:"Search",friendText:"Friend",teamText:"Team",searchResultNullText:"User does not exist",conversationSendFailText:"[Send Failed]",conversationNotificationText:"[Notification]",fileMsgTitleText:"[File Message]",collectionFromText:"Collection from",copySuccessText:"Copy Success",openUrlText:"Copied. Open in browser.",teamManagerText:"Team Manager",teamManagerSettingText:"Team Manager Setting",updateTeamInfoText:"Who is allowed to edit team details",teamOwnerAndManagerText:"TeamOwnerAndManager",updateTeamInviteText:"Who is allowed to invite team members",updateTeamAtText:"Who is allowed to @",addMemberText:"Add Member",removeText:"remove",securityTipText:"For test only. Beware of money transfer, lottery winnings & strange call scams.",sendToFriend:"send to friend",sendToTeam:"send to team",Laugh:"[Laugh]",Happy:"[Happy]",Sexy:"[Sexy]",Cool:"[Cool]",Mischievous:"[Mischievous]",Kiss:"[Kiss]",Spit:"[Spit]",Squint:"[Squint]",Cute:"[Cute]",Grimace:"[Grimace]",Snicker:"[Snicker]",Joy:"[Joy]",Ecstasy:"[Ecstasy]",Surprise:"[Surprise]",Tears:"[Tears]",Sweat:"[Sweat]",Angle:"[Angle]",Funny:"[Funny]",Awkward:"[Awkward]",Thrill:"[Thrill]",Cry:"[Cry]",Fretting:"[Fretting]",Terrorist:"[Terrorist]",Halo:"[Halo]",Shame:"[Shame]",Sleep:"[Sleep]",Tired:"[Tired]",Mask:"[Mask]",ok:"[ok]",AllRight:"[All right]",Despise:"[Despise]",Uncomfortable:"[Uncomfortable]",Disdain:"[Disdain]",ill:"[ill]",Mad:"[Mad]",Ghost:"[Ghost]",Angry:"[Angry]",Unhappy:"[Unhappy]",Frown:"[Frown]",Broken:"[Broken]",Beckoning:"[Beckoning]",Ok:"[Ok]",Low:"[Low]",Nice:"[Nice]",Applause:"[Applause]",GoodJob:"[Good job]",Hit:"[Hit]",Please:"[Please]",Bye:"[Bye]",First:"[First]",Fist:"[Fist]",GiveMeFive:"[Give me five]",Knife:"[Knife]",Hi:"[Hi]",No:"[No]",Hold:"[Hold]",Think:"[Think]",Pig:"[Pig]",NoListen:"[No listen]",NoLook:"[No look]",NoWords:"[No words]",Monkey:"[Monkey]",Bomb:"[Bomb]",Cloud:"[Cloud]",Rocket:"[Rocket]",Ambulance:"[Ambulance]",Poop:"[Poop]",190001:"internal error",190002:"illegal state",191001:"misuse",191002:"cancelled",191003:"callback failed",191004:"invalid parameter",191005:"timeout",191006:"resource not exist",191007:"resource already exist",192001:"connect failed",192002:"connect timeout",192003:"disconnected",192004:"protocol timeout",192005:"protocol send failed",192006:"request failed",107319:"PIN limit exceeded",107320:"PIN not exist",107322:"PIN already exist",107327:"PIN function disabled",189301:"collection limit exceeded",189302:"collection not exist",189449:"collection concurrent operation failed",109432:"no permission"},k6={appText:"IM H5",messageText:"",contactText:"",mineText:"",logoutText:"",commsEaseText:"",logoutConfirmText:"?",avatarText:"",updateAvatarText:"",accountText:"",name:"",genderText:"",remarkText:"",mobile:"",email:"",sign:"",man:"",woman:"",unknow:"",birthText:"",FriendPageText:"",startConversationText:"",addText:"",removeText:"",addTeamManagerSuccessText:"",addTeamManagerFailText:"",confirmRemoveText:"",removeManagerExplain:"",removeMemberExplain:"",removeSuccessText:"",removeFailText:"",userNotInTeam:"",noTeamManager:"",noTeamMember:"",applyFriendSuccessText:"",applyFriendFailText:"",addFriendText:"",addMemberText:"",addFriendFailText:"",deleteFriendText:"",deleteFriendConfirmText:"",deleteFriendSuccessText:"",deleteFriendFailText:"",setBlackFailText:"",removeBlackFailText:"",removeBlackSuccessText:"",addPermissionText:"",FailAvatarText:"",chooseDefaultImage:"",chatButtonText:"",gotoChatFailText:"",chatWithFriendText:"",okText:"",updateText:"",cancelText:"",friendSelectText:"",telErrorText:"",emailErrorText:"",createButtonText:"",createP2PText:"",createTeamText:"",addTeamMemberText:"",addTeamMemberFailText:"",teamTitlePlaceholder:"",maxSelectedText:"200",createTeamSuccessText:"",createTeamFailedText:"",PersonalPageText:"",deleteSessionText:"",sessionMuteText:"",sessionMuteFailText:"",sessionUnMuteFailText:"",stickTopText:"",deleteStickTopText:"",addStickTopText:"",deleteSessionFailText:"",deleteStickTopFailText:"",addStickTopFailText:"",teamMemberText:"",teamManagerText:"",teamManagerSettingText:"",updateTeamInfoText:"",updateTeamInviteText:"",updateTeamAtText:"@",transformTeam:"",transformTeamContent:"",doubt:"",transformTeamSuccessText:"",transformTeamFailedText:"",transformTeamText:"",teamBannedText:"",saveText:"",setText:"",failText:"",saveSuccessText:"",saveFailedText:"",searchTeamPlaceholder:"",nickInTeamEmptyText:"",teamTitle:"",teamInfoText:"",teamIntro:"",teamAvatar:"",networkError:"",searchFailText:"",offlineText:"",connectingText:"IM...",teamMenuText:"",teamChooseText:"",chooseText:"",friendSelect:"",pleaseSelectMember:"",teamMemebrSelect:"",getHistoryMsgFailedText:"",deleteText:"",recallText:"",copyText:"",forwardText:"",forwardComment:"",forwardSuccessText:"",forwardFailedText:"",getMessageFailed:"",replyText:"",replyNotFindText:"",msgRecallTimeErrorText:"",enableV2CloudConversationText:"",SwitchToEnglish:"",copySuccessText:"",tipText:"",selectImageText:"",uikitVersion:"",IMVersion:"IM",productInfoText:"",forwardToTeamText:"",forwardToFriendText:"",sessionRecordText:"",chatInputPlaceHolder:"~",pinText:"",pinFailedText:"",unpinText:"",unpinFailedText:"",noPinListText:"",collectionText:"",deleteCollectionText:"",addCollectionSuccessText:"",addCollectionFailedText:"",deleteCollectionFailedText:"",noCollectionsText:"",you:"",pinThisText:"",delete:"",recall:"",recall2:"",recall3:"",recallMsgFailText:"",reeditText:"",loadingMoreText:"",noMoreText:"",deleteMsgSuccessText:"",deleteMsgFailText:"",conversationEmptyText:"",teamOwner:"",teamManager:"",manager:"",teamEmptyText:"",blacklistEmptyText:"",blacklistSubTitle:"",validEmptyText:"",dismissTeamText:"",dismissTeamConfirmText:"",leaveTeamTitle:"",leaveTeamConfirmText:"",leaveTeamSuccessText:"",leaveTeamFailedText:"",dismissTeamSuccessText:"",dismissTeamFailedText:"",updateTeamSuccessText:"",updateTeamFailedText:"",teamTitleConfirmText:"",teamIntroConfirmText:"",aliasConfirmText:"",sendImageFailedText:"",sendVideoFailedText:"",sendAudioFailedText:"",sendFileFailedText:"",sendMsgFailedText:"",weekText:"",dayText:"",hourText:"",minuteText:"",nowText:"",sendText:"",sendToText:"",textMsgText:"",audioMsgText:"",videoMsgText:"",fileMsgText:"",callMsgText:"",geoMsgText:"",imgMsgText:"",notiMsgText:"",robotMsgText:"",tipMsgText:"",customMsgText:"",unknowMsgText:"",noFriendText:"",onDismissTeamText:"",onRemoveTeamText:"",selectSessionFailText:"",noExistUser:"",enterAccount:"",validMsgText:"",blacklistText:"",applyTeamText:"",acceptResultText:"",rejectResultText:"",rejectTeamInviteText:"",beRejectResultText:"",passResultText:"",acceptedText:"",acceptFailedText:"",rejectedText:"",rejectFailedText:"",passFriendAskText:"~",applyFriendText:"",rejectText:"",acceptText:"",inviteTeamText:"",addBlacklist:"",removeBlacklist:"",teamAll:"",sendFailWithInBlackText:"",sendFailWithDeleteText:"",friendVerificationText:"",chooseMentionText:"",someoneText:"",meText:"",teamMutePlaceholder:"",noPermission:"",muteAllTeamFailedText:"",unmuteAllTeamFailedText:"",friendEditPlaceholder:"",nickInTeam:"",viewMoreText:"",resendMsgFailText:"",audioBtnText:"",audioRemindText:"",audioErrorText:"",videoPlayText:"",updateTeamAvatar:"",updateTeamName:"",updateTeamIntro:"",updateTeamInviteMode:"",updateTeamUpdateTeamMode:"",updateAllowAt:"@",updateTeamMute:"",onlyTeamOwner:"",teamOwnerAndManagerText:"",closeText:"",openText:"",joinTeamText:"",leaveTeamText:"",beRemoveTeamText:"",beAddTeamManagersText:"",beRemoveTeamManagersText:"",newGroupOwnerText:"",callDurationText:"",callCancelText:"",callRejectedText:"",callTimeoutText:"",callBusyText:"",callFailedText:"",wxAppFileCopyText:"",shootText:"",albumText:"",voiceCallText:"",videoCallText:"",msgReadPageTitleText:"",readText:"",unreadText:"",fileText:"",allUnReadText:"",allReadText:"",searchText:"",searchTitleText:"",friendText:"",teamText:"",searchResultNullText:"",conversationSendFailText:"[]",conversationNotificationText:"[]",getForwardMessageFailed:"",fileMsgTitleText:"[]",collectionFromText:"",openUrlText:"",SwitchToEnglishText:"",securityTipText:"",sendToFriend:"",sendToTeam:"",Laugh:"[]",Happy:"[]",Sexy:"[]",Cool:"[]",Mischievous:"[]",Kiss:"[]",Spit:"[]",Squint:"[]",Cute:"[]",Grimace:"[]",Snicker:"[]",Joy:"[]",Ecstasy:"[]",Surprise:"[]",Tears:"[]",Sweat:"[]",Angle:"[]",Funny:"[]",Awkward:"[]",Thrill:"[]",Cry:"[]",Fretting:"[]",Terrorist:"[]",Halo:"[]",Shame:"[]",Sleep:"[]",Tired:"[]",Mask:"[]",ok:"[OK]",AllRight:"[]",Despise:"[]",Uncomfortable:"[]",Disdain:"[]",ill:"[]",Mad:"[]",Ghost:"[]",Angry:"[]",Unhappy:"[]",Frown:"[]",Broken:"[]",Beckoning:"[]",Ok:"[]",Low:"[]",Nice:"[]",Applause:"[]",GoodJob:"[]",Hit:"[]",Please:"[]",Bye:"[]",First:"[]",Fist:"[]",GiveMeFive:"[]",Knife:"[]",Hi:"[]",No:"[]",Hold:"[]",Think:"[]",Pig:"[]",NoListen:"[]",NoLook:"[]",NoWords:"[]",Monkey:"[]",Bomb:"[]",Cloud:"[]",Rocket:"[]",Ambulance:"[]",Poop:"[]",190001:"",190002:"",191001:"",191002:"",191003:"",191004:"",191005:"",191006:"",191007:"",192001:"",192002:"",192003:"",192004:"",192005:"",192006:"",107319:"PIN ",107320:"PIN ",107322:" PIN",107327:" PIN ",189301:"",189302:"",189449:"",109432:""},O6={en:N6,zh:k6};let wR="zh";function w6(s){wR=s}const xv=s=>O6[wR][s]||s,x6={key:0,class:"tabbar"},P6={class:"tab-item-content"},L6={class:"icon-wrapper"},V6=["src"],D6={key:0,class:"unread-dot"},U6={class:"tab-item-content"},F6={class:"icon-wrapper"},B6=["src"],q6={key:0,class:"unread-dot"},G6={class:"tab-item-content"},j6=["src"],H6=fM({__name:"TabBar",setup(s){const n=V5(),c=Mi(()=>["/conversation","/contacts","/my"].includes(n.path)),d=Ay(!1),f=Ay(!1),{proxy:m}=yM(),y=m==null?void 0:m.$UIKitStore;return mM(()=>{yR(()=>{var S,E,b;const M=(S=y==null?void 0:y.sdkOptions)==null?void 0:S.enableV2CloudConversation;d.value=M?!!((E=y==null?void 0:y.conversationStore)!=null&&E.totalUnreadCount):!!((b=y==null?void 0:y.localConversationStore)!=null&&b.totalUnreadCount),f.value=!!(y!=null&&y.sysMsgStore.getTotalUnreadMsgsCount())})}),(M,S)=>{const E=Ny("router-link");return c.value?(xa(),Ap("nav",x6,[cn(E,{to:"/conversation",class:"tab-item"},{default:Ep(()=>[ri("div",P6,[ri("div",L6,[ri("img",{src:M.$route.path==="/conversation"?qn(F5):qn(U5),class:"tab-icon"},null,8,V6),d.value?(xa(),Ap("span",D6)):Np("",!0)]),ri("span",null,Sp(qn(xv)("messageText")),1)])]),_:1}),cn(E,{to:"/contacts",class:"tab-item"},{default:Ep(()=>[ri("div",U6,[ri("div",F6,[ri("img",{src:M.$route.path==="/contacts"?qn(q5):qn(B5),class:"tab-icon"},null,8,B6),f.value?(xa(),Ap("span",q6)):Np("",!0)]),ri("span",null,Sp(qn(xv)("contactText")),1)])]),_:1}),cn(E,{to:"/my",class:"tab-item"},{default:Ep(()=>[ri("div",G6,[ri("img",{src:M.$route.path==="/my"?qn(j5):qn(G5),class:"tab-icon"},null,8,j6),ri("span",null,Sp(qn(xv)("mineText")),1)])]),_:1})])):Np("",!0)}}}),xR=(s,n)=>{const c=s.__vccOpts||s;for(const[d,f]of n)c[d]=f;return c},$6=xR(H6,[["__scopeId","data-v-48f0d81c"]]);var Pv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zu(s){var n={exports:{}};return s(n,n.exports),n.exports}var zy,Xy,Zy,e_,t_,r_,n_,i_,s_,o_,a_,c_,l_,u_,d_,p_,h_,f_,m_,g_,v_,y_,__,M_,T_,I_,S_,E_,C_,b_,A_,R_,N_,k_,O_,w_,x_,P_,L_,V_,D_,U_,F_,B_,q_,G_,j_,H_,$_,K_,Y_,W_,J_,ju=zu(function(s){var n=Object.prototype.hasOwnProperty,c="~";function d(){}function f(S,E,b){this.fn=S,this.context=E,this.once=b||!1}function m(S,E,b,R,x){if(typeof b!="function")throw new TypeError("The listener must be a function");var L=new f(b,R||S,x),q=c?c+E:E;return S._events[q]?S._events[q].fn?S._events[q]=[S._events[q],L]:S._events[q].push(L):(S._events[q]=L,S._eventsCount++),S}function y(S,E){--S._eventsCount==0?S._events=new d:delete S._events[E]}function M(){this._events=new d,this._eventsCount=0}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(c=!1)),M.prototype.eventNames=function(){var E,b,R=[];if(this._eventsCount===0)return R;for(b in E=this._events)n.call(E,b)&&R.push(c?b.slice(1):b);return Object.getOwnPropertySymbols?R.concat(Object.getOwnPropertySymbols(E)):R},M.prototype.listeners=function(E){var b=c?c+E:E,R=this._events[b];if(!R)return[];if(R.fn)return[R.fn];for(var x=0,L=R.length,q=new Array(L);x<L;x++)q[x]=R[x].fn;return q},M.prototype.listenerCount=function(E){var b=c?c+E:E,R=this._events[b];return R?R.fn?1:R.length:0},M.prototype.emit=function(E,b,R,x,L,q){var D=c?c+E:E;if(!this._events[D])return!1;var G,J,ne=this._events[D],z=arguments.length;if(ne.fn){switch(ne.once&&this.removeListener(E,ne.fn,void 0,!0),z){case 1:return ne.fn.call(ne.context),!0;case 2:return ne.fn.call(ne.context,b),!0;case 3:return ne.fn.call(ne.context,b,R),!0;case 4:return ne.fn.call(ne.context,b,R,x),!0;case 5:return ne.fn.call(ne.context,b,R,x,L),!0;case 6:return ne.fn.call(ne.context,b,R,x,L,q),!0}for(J=1,G=new Array(z-1);J<z;J++)G[J-1]=arguments[J];ne.fn.apply(ne.context,G)}else{var $,Z=ne.length;for(J=0;J<Z;J++)switch(ne[J].once&&this.removeListener(E,ne[J].fn,void 0,!0),z){case 1:ne[J].fn.call(ne[J].context);break;case 2:ne[J].fn.call(ne[J].context,b);break;case 3:ne[J].fn.call(ne[J].context,b,R);break;case 4:ne[J].fn.call(ne[J].context,b,R,x);break;default:if(!G)for($=1,G=new Array(z-1);$<z;$++)G[$-1]=arguments[$];ne[J].fn.apply(ne[J].context,G)}}return!0},M.prototype.on=function(E,b,R){return m(this,E,b,R,!1)},M.prototype.once=function(E,b,R){return m(this,E,b,R,!0)},M.prototype.removeListener=function(E,b,R,x){var L=c?c+E:E;if(!this._events[L])return this;if(!b)return y(this,L),this;var q=this._events[L];if(q.fn)q.fn!==b||x&&!q.once||R&&q.context!==R||y(this,L);else{for(var D=0,G=[],J=q.length;D<J;D++)(q[D].fn!==b||x&&!q[D].once||R&&q[D].context!==R)&&G.push(q[D]);G.length?this._events[L]=G.length===1?G[0]:G:y(this,L)}return this},M.prototype.removeAllListeners=function(E){var b;return E?(b=c?c+E:E,this._events[b]&&y(this,b)):(this._events=new d,this._eventsCount=0),this},M.prototype.off=M.prototype.removeListener,M.prototype.addListener=M.prototype.on,M.prefixed=c,M.EventEmitter=M,s.exports=M}),K6=zu(function(s,n){s.exports=function(){function c(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */c=function(){return L};var L={},q=Object.prototype,D=q.hasOwnProperty,G=typeof Symbol=="function"?Symbol:{},J=G.iterator||"@@iterator",ne=G.asyncIterator||"@@asyncIterator",z=G.toStringTag||"@@toStringTag";function $(Le,Ce,we){return Object.defineProperty(Le,Ce,{value:we,enumerable:!0,configurable:!0,writable:!0}),Le[Ce]}try{$({},"")}catch{$=function(Ce,we,St){return Ce[we]=St}}function Z(Le,Ce,we,St){var ue=Ce&&Ce.prototype instanceof oe?Ce:oe,ge=Object.create(ue.prototype),be=new Wt(St||[]);return ge._invoke=function(_e,ct,X){var K="suspendedStart";return function(de,Ae){if(K==="executing")throw new Error("Generator is already running");if(K==="completed"){if(de==="throw")throw Ae;return Tt()}for(X.method=de,X.arg=Ae;;){var ke=X.delegate;if(ke){var Ne=Fe(ke,X);if(Ne){if(Ne===fe)continue;return Ne}}if(X.method==="next")X.sent=X._sent=X.arg;else if(X.method==="throw"){if(K==="suspendedStart")throw K="completed",X.arg;X.dispatchException(X.arg)}else X.method==="return"&&X.abrupt("return",X.arg);K="executing";var De=le(_e,ct,X);if(De.type==="normal"){if(K=X.done?"completed":"suspendedYield",De.arg===fe)continue;return{value:De.arg,done:X.done}}De.type==="throw"&&(K="completed",X.method="throw",X.arg=De.arg)}}}(Le,we,be),ge}function le(Le,Ce,we){try{return{type:"normal",arg:Le.call(Ce,we)}}catch(St){return{type:"throw",arg:St}}}L.wrap=Z;var fe={};function oe(){}function B(){}function me(){}var Ee={};$(Ee,J,function(){return this});var ve=Object.getPrototypeOf,qe=ve&&ve(ve(jt([])));qe&&qe!==q&&D.call(qe,J)&&(Ee=qe);var Qe=me.prototype=oe.prototype=Object.create(Ee);function ut(Le){["next","throw","return"].forEach(function(Ce){$(Le,Ce,function(we){return this._invoke(Ce,we)})})}function he(Le,Ce){function we(ue,ge,be,_e){var ct=le(Le[ue],Le,ge);if(ct.type!=="throw"){var X=ct.arg,K=X.value;return K&&typeof K=="object"&&D.call(K,"__await")?Ce.resolve(K.__await).then(function(de){we("next",de,be,_e)},function(de){we("throw",de,be,_e)}):Ce.resolve(K).then(function(de){X.value=de,be(X)},function(de){return we("throw",de,be,_e)})}_e(ct.arg)}var St;this._invoke=function(ue,ge){function be(){return new Ce(function(_e,ct){we(ue,ge,_e,ct)})}return St=St?St.then(be,be):be()}}function Fe(Le,Ce){var we=Le.iterator[Ce.method];if(we===void 0){if(Ce.delegate=null,Ce.method==="throw"){if(Le.iterator.return&&(Ce.method="return",Ce.arg=void 0,Fe(Le,Ce),Ce.method==="throw"))return fe;Ce.method="throw",Ce.arg=new TypeError("The iterator does not provide a 'throw' method")}return fe}var St=le(we,Le.iterator,Ce.arg);if(St.type==="throw")return Ce.method="throw",Ce.arg=St.arg,Ce.delegate=null,fe;var ue=St.arg;return ue?ue.done?(Ce[Le.resultName]=ue.value,Ce.next=Le.nextLoc,Ce.method!=="return"&&(Ce.method="next",Ce.arg=void 0),Ce.delegate=null,fe):ue:(Ce.method="throw",Ce.arg=new TypeError("iterator result is not an object"),Ce.delegate=null,fe)}function Xe(Le){var Ce={tryLoc:Le[0]};1 in Le&&(Ce.catchLoc=Le[1]),2 in Le&&(Ce.finallyLoc=Le[2],Ce.afterLoc=Le[3]),this.tryEntries.push(Ce)}function yt(Le){var Ce=Le.completion||{};Ce.type="normal",delete Ce.arg,Le.completion=Ce}function Wt(Le){this.tryEntries=[{tryLoc:"root"}],Le.forEach(Xe,this),this.reset(!0)}function jt(Le){if(Le){var Ce=Le[J];if(Ce)return Ce.call(Le);if(typeof Le.next=="function")return Le;if(!isNaN(Le.length)){var we=-1,St=function ue(){for(;++we<Le.length;)if(D.call(Le,we))return ue.value=Le[we],ue.done=!1,ue;return ue.value=void 0,ue.done=!0,ue};return St.next=St}}return{next:Tt}}function Tt(){return{value:void 0,done:!0}}return B.prototype=me,$(Qe,"constructor",me),$(me,"constructor",B),B.displayName=$(me,z,"GeneratorFunction"),L.isGeneratorFunction=function(Le){var Ce=typeof Le=="function"&&Le.constructor;return!!Ce&&(Ce===B||(Ce.displayName||Ce.name)==="GeneratorFunction")},L.mark=function(Le){return Object.setPrototypeOf?Object.setPrototypeOf(Le,me):(Le.__proto__=me,$(Le,z,"GeneratorFunction")),Le.prototype=Object.create(Qe),Le},L.awrap=function(Le){return{__await:Le}},ut(he.prototype),$(he.prototype,ne,function(){return this}),L.AsyncIterator=he,L.async=function(Le,Ce,we,St,ue){ue===void 0&&(ue=Promise);var ge=new he(Z(Le,Ce,we,St),ue);return L.isGeneratorFunction(Ce)?ge:ge.next().then(function(be){return be.done?be.value:ge.next()})},ut(Qe),$(Qe,z,"Generator"),$(Qe,J,function(){return this}),$(Qe,"toString",function(){return"[object Generator]"}),L.keys=function(Le){var Ce=[];for(var we in Le)Ce.push(we);return Ce.reverse(),function St(){for(;Ce.length;){var ue=Ce.pop();if(ue in Le)return St.value=ue,St.done=!1,St}return St.done=!0,St}},L.values=jt,Wt.prototype={constructor:Wt,reset:function(Le){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(yt),!Le)for(var Ce in this)Ce.charAt(0)==="t"&&D.call(this,Ce)&&!isNaN(+Ce.slice(1))&&(this[Ce]=void 0)},stop:function(){this.done=!0;var Le=this.tryEntries[0].completion;if(Le.type==="throw")throw Le.arg;return this.rval},dispatchException:function(Le){if(this.done)throw Le;var Ce=this;function we(ct,X){return ge.type="throw",ge.arg=Le,Ce.next=ct,X&&(Ce.method="next",Ce.arg=void 0),!!X}for(var St=this.tryEntries.length-1;St>=0;--St){var ue=this.tryEntries[St],ge=ue.completion;if(ue.tryLoc==="root")return we("end");if(ue.tryLoc<=this.prev){var be=D.call(ue,"catchLoc"),_e=D.call(ue,"finallyLoc");if(be&&_e){if(this.prev<ue.catchLoc)return we(ue.catchLoc,!0);if(this.prev<ue.finallyLoc)return we(ue.finallyLoc)}else if(be){if(this.prev<ue.catchLoc)return we(ue.catchLoc,!0)}else{if(!_e)throw new Error("try statement without catch or finally");if(this.prev<ue.finallyLoc)return we(ue.finallyLoc)}}}},abrupt:function(Le,Ce){for(var we=this.tryEntries.length-1;we>=0;--we){var St=this.tryEntries[we];if(St.tryLoc<=this.prev&&D.call(St,"finallyLoc")&&this.prev<St.finallyLoc){var ue=St;break}}ue&&(Le==="break"||Le==="continue")&&ue.tryLoc<=Ce&&Ce<=ue.finallyLoc&&(ue=null);var ge=ue?ue.completion:{};return ge.type=Le,ge.arg=Ce,ue?(this.method="next",this.next=ue.finallyLoc,fe):this.complete(ge)},complete:function(Le,Ce){if(Le.type==="throw")throw Le.arg;return Le.type==="break"||Le.type==="continue"?this.next=Le.arg:Le.type==="return"?(this.rval=this.arg=Le.arg,this.method="return",this.next="end"):Le.type==="normal"&&Ce&&(this.next=Ce),fe},finish:function(Le){for(var Ce=this.tryEntries.length-1;Ce>=0;--Ce){var we=this.tryEntries[Ce];if(we.finallyLoc===Le)return this.complete(we.completion,we.afterLoc),yt(we),fe}},catch:function(Le){for(var Ce=this.tryEntries.length-1;Ce>=0;--Ce){var we=this.tryEntries[Ce];if(we.tryLoc===Le){var St=we.completion;if(St.type==="throw"){var ue=St.arg;yt(we)}return ue}}throw new Error("illegal catch attempt")},delegateYield:function(Le,Ce,we){return this.delegate={iterator:jt(Le),resultName:Ce,nextLoc:we},this.method==="next"&&(this.arg=void 0),fe}},L}function d(L){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(q){return typeof q}:function(q){return q&&typeof Symbol=="function"&&q.constructor===Symbol&&q!==Symbol.prototype?"symbol":typeof q},d(L)}function f(L,q){if(!(L instanceof q))throw new TypeError("Cannot call a class as a function")}function m(L,q){for(var D=0;D<q.length;D++){var G=q[D];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty(L,G.key,G)}}function y(L,q,D){return q&&m(L.prototype,q),Object.defineProperty(L,"prototype",{writable:!1}),L}function M(L,q,D,G){function J(ne){return ne instanceof D?ne:new D(function(z){z(ne)})}return new(D||(D=Promise))(function(ne,z){function $(fe){try{le(G.next(fe))}catch(oe){z(oe)}}function Z(fe){try{le(G.throw(fe))}catch(oe){z(oe)}}function le(fe){fe.done?ne(fe.value):J(fe.value).then($,Z)}le((G=G.apply(L,[])).next())})}var S={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:72e5},E=12,b=8e3,R=function(){},x=function(){function L(q){f(this,L),this.isUploadEnable=!0,this.serverAllowUpload=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=S,this.configPath="dispatcher/req",this.dataReportPath="statics/report/common/form",this.traceMsgCache={},this.reqRetryCount=0,this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Date.now(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(q),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return y(L,[{key:"setConfig",value:function(D){var G=Object.assign({},this.reportConfig.common,D.common);this.reportConfig=Object.assign({},this.reportConfig,D),this.reportConfig.common=G,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function(D,G){var J=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(D,Object.assign({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},G)).catch(function(ne){var z,$;($=(z=J.reportConfig)===null||z===void 0?void 0:z.logger)===null||$===void 0||$.warn("Reporter immediately upload failed",ne)})}},{key:"report",value:function(D,G){var J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(J.priority||(J.priority=this.getEventPriority(D,G)),this.reportConfig.isDataReportEnable&&D){if(D==="login"&&G.succeed===!1&&G.process_id){var ne=this.lastFailLogin[G.process_id]||0;if(G.start_time-ne<S.loginFailIgnoreInterval)return;this.lastFailLogin[G.process_id]=G.start_time}var z=Date.now();J.priority==="HIGH"?this.highPriorityMsgList.push({module:D,msg:G,createTime:z}):J.priority==="NORMAL"?this.msgList.push({module:D,msg:G,createTime:z}):J.priority==="LOW"&&this.lowPriorityMsgList.push({module:D,msg:G,createTime:z}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(D,G){if(this.reportConfig.isDataReportEnable&&D&&!this.traceMsgCache[D]){var J=Object.assign(Object.assign({start_time:Date.now()},G),{extension:[]});this.traceMsgCache[D]=J}}},{key:"reportTraceUpdate",value:function(D){}},{key:"reportTraceUpdateV2",value:function(D,G,J){var ne,z=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[D]){var $=this.traceMsgCache[D].extension,Z=$.length,le=new Date().getTime();Z===0?G.duration=le-this.traceMsgCache[D].start_time:$[Z-1].end_time?G.duration=le-$[Z-1].end_time:G.duration=le-this.traceMsgCache[D].start_time,$.push(Object.assign({end_time:le},G));var fe=$.length-1;J!=null&&J.asyncParams&&((ne=this.traceMsgCache[D]).asyncPromiseArray||(ne.asyncPromiseArray=[]),this.traceMsgCache[D].asyncPromiseArray.push(J.asyncParams.then(function(oe){z.traceMsgCache[D]&&z.traceMsgCache[D].extension[fe]&&Object.assign(z.traceMsgCache[D].extension[fe],oe)})))}}},{key:"reportTraceEnd",value:function(D){var G,J=this,ne=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[D])if(D!=="nos"||ne===!1){typeof ne=="boolean"?this.traceMsgCache[D].succeed=!!ne:this.traceMsgCache[D].state=ne,this.traceMsgCache[D].duration=Date.now()-this.traceMsgCache[D].start_time,this.traceMsgCache[D].extension.forEach(function(Z){delete Z.end_time});var z=this.traceMsgCache[D];if(this.traceMsgCache[D]=null,z.asyncPromiseArray){(G=this.endedAsyncMsgByModule)[D]||(G[D]=[]),this.endedAsyncMsgByModule[D].push(z);var $=function(){J.endedAsyncMsgByModule[D]&&J.endedAsyncMsgByModule[D].includes(z)&&(delete z.asyncPromiseArray,J.report(D,z,{priority:J.getEventPriority(D,z)}))};Promise.all(z.asyncPromiseArray).then($).catch($)}else this.report(D,z,{priority:this.getEventPriority(D,z)})}else this.traceMsgCache[D]=null}},{key:"getEventPriority",value:function(D,G){if(D==="exceptions"){if(G.action===0||G.action===2||G.action===1&&G.exception_service!==0)return"HIGH"}else if(D==="msgReceive"||D==="nim_api_trace")return"LOW";return"NORMAL"}},{key:"reportTraceCancel",value:function(D){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[D]=[],this.traceMsgCache[D]=null)}},{key:"pause",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function(){var D=this;this.reportConfig.isDataReportEnable&&(Object.keys(this.traceMsgCache).forEach(function(G){D.reportTraceEnd(G,1)}),this.timer!==null&&clearTimeout(this.timer),this.setConfig=R,this.report=R,this.reportTraceStart=R,this.reportTraceUpdate=R,this.reportTraceEnd=R,this.pause=R,this.restore=R,this.destroy=R,this.reqRetryCount=0,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function(){var D,G;return M(this,void 0,void 0,c().mark(function J(){var ne,z,$,Z,le,fe=this;return c().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(!this.loading){B.next=2;break}return B.abrupt("return");case 2:this.loading=!0,ne=this.reportConfig.common||{},z=this.reportConfig.compassDataEndpoint.split(",").map(function(me){return"".concat(me,"/").concat(fe.configPath)}),$=c().mark(function me(Ee){return c().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:if(!fe.initConfigLoaded&&!fe.isDestroyed){qe.next=2;break}return qe.abrupt("return","break");case 2:return qe.prev=2,qe.next=5,fe.reportConfig.request(z[Ee],{method:"GET",dataType:"json",params:{deviceId:ne.dev_id,sdkVer:ne.sdk_ver,platform:ne.platform,appkey:ne.app_key},timeout:fe.reportConfig.timeout}).then(function(Qe){var ut,he;if(!fe.isDestroyed){if(Qe.status===200&&Qe.data&&Qe.data.code===200){fe.initConfigLoaded=!0;var Fe=Qe.data.data||{};fe.reportConfig.maxSize=Fe.maxSize>1e3?1e3:Fe.maxSize,fe.reportConfig.maxInterval=Fe.maxInterval>1e4?1e4:Fe.maxInterval,fe.reportConfig.maxInterval=Fe.maxInterval<10?10:Fe.maxInterval,fe.reportConfig.minInterval=Fe.minInterval<2?2:Fe.minInterval,fe.reportConfig.maxDelay=Fe.maxDelay||300,fe.reportConfig.maxInterval=1e3*fe.reportConfig.maxInterval,fe.reportConfig.minInterval=1e3*fe.reportConfig.minInterval,fe.reportConfig.maxDelay=1e3*fe.reportConfig.maxDelay,Fe.endpoint?fe.dataReportEndpoint=Fe.endpoint:fe.dataReportEndpoint=z[Ee],fe.serverAllowUpload=!0,fe.loading=!1,fe.reportHeartBeat()}else Qe.status===200&&(fe.initConfigLoaded=!0);(he=(ut=fe.reportConfig)===null||ut===void 0?void 0:ut.logger)===null||he===void 0||he.log("Get reporter upload config success")}}).catch(function(Qe){var ut,he;fe.isDestroyed||(fe.loading=!1,(he=(ut=fe.reportConfig)===null||ut===void 0?void 0:ut.logger)===null||he===void 0||he.error("Get reporter upload config failed",Qe),fe.reqRetryCount<E&&(fe.reqRetryCount++,setTimeout(function(){fe.isDestroyed||fe.initUploadConfig()},b)))});case 5:qe.next=14;break;case 7:if(qe.prev=7,qe.t0=qe.catch(2),!fe.isDestroyed){qe.next=11;break}return qe.abrupt("return",{v:void 0});case 11:fe.loading=!1,(G=(D=fe.reportConfig)===null||D===void 0?void 0:D.logger)===null||G===void 0||G.error("Exec reporter request failed",qe.t0),fe.reqRetryCount<E&&(fe.reqRetryCount++,setTimeout(function(){fe.isDestroyed||fe.initUploadConfig()},b));case 14:case"end":return qe.stop()}},me,null,[[2,7]])}),Z=0;case 7:if(!(Z<z.length)){B.next=17;break}return B.delegateYield($(Z),"t0",9);case 9:if((le=B.t0)!=="break"){B.next=12;break}return B.abrupt("break",17);case 12:if(d(le)!=="object"){B.next=14;break}return B.abrupt("return",le.v);case 14:Z++,B.next=7;break;case 17:case"end":return B.stop()}},J,this)}))}},{key:"reportHeartBeat",value:function(){var D=this;this.isDestroyed||(this.timer=setTimeout(function(){D.reportHeartBeat()},this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function(){if(!this.isDestroyed){var D=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Date.now()-this.lastReportTime>=D&&this.upload()}}},{key:"getUploadMsg",value:function(){var D=this,G={},J=Date.now();this.highPriorityMsgList=this.highPriorityMsgList.filter(function(le){return J-le.createTime<D.reportConfig.maxDelay}),this.msgList=this.msgList.filter(function(le){return J-le.createTime<D.reportConfig.maxDelay}),this.lowPriorityMsgList=this.lowPriorityMsgList.filter(function(le){return J-le.createTime<D.reportConfig.maxDelay}),this.cacheMsgList=this.cacheMsgList.filter(function(le){return J-le.createTime<D.reportConfig.maxDelay});var ne=this.highPriorityMsgList.slice(0,this.reportConfig.maxSize);if(this.highPriorityMsgList=this.highPriorityMsgList.slice(ne.length),ne.length<this.reportConfig.maxSize){var z=this.reportConfig.maxSize-ne.length;ne=ne.concat(this.msgList.slice(0,z)),this.msgList=this.msgList.slice(z)}if(ne.length<this.reportConfig.maxSize){var $=this.reportConfig.maxSize-ne.length;ne=ne.concat(this.lowPriorityMsgList.slice(0,$)),this.lowPriorityMsgList=this.lowPriorityMsgList.slice($)}if(ne.length<this.reportConfig.maxSize){var Z=this.reportConfig.maxSize-ne.length;ne=ne.concat(this.cacheMsgList.slice(0,Z)),this.cacheMsgList=this.cacheMsgList.slice(Z)}return ne.forEach(function(le){G[le.module]?G[le.module].push(le.msg):G[le.module]=[le.msg]}),{uploadMsgArr:ne,uploadMsg:G}}},{key:"upload",value:function(){var D,G,J=this;if(this.isUploadEnable&&this.serverAllowUpload&&!(this.lastReportTime&&Date.now()-this.lastReportTime<this.reportConfig.minInterval)){var ne=this.getUploadMsg(),z=ne.uploadMsgArr,$=ne.uploadMsg;if(z.length){this.lastReportTime=Date.now();try{var Z="".concat(this.dataReportEndpoint,"/").concat(this.dataReportPath);this.reportConfig.request(Z,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:$},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch(function(le){var fe,oe;J.cacheMsgList=J.cacheMsgList.concat(z).slice(0,J.reportConfig.cacheMaxSize),(oe=(fe=J.reportConfig)===null||fe===void 0?void 0:fe.logger)===null||oe===void 0||oe.warn("Reporter upload failed",le)})}catch(le){(G=(D=this.reportConfig)===null||D===void 0?void 0:D.logger)===null||G===void 0||G.warn("Exec reporter request failed",le)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),L}();return x}()});(function(s){s[s.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",s[s.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC"})(zy||(zy={})),function(s){s[s.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",s[s.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",s[s.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(Xy||(Xy={})),function(s){s[s.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",s[s.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",s[s.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(Zy||(Zy={})),function(s){s[s.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",s[s.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",s[s.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",s[s.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(e_||(e_={})),function(s){s[s.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",s[s.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",s[s.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(t_||(t_={})),function(s){s[s.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",s[s.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(r_||(r_={})),function(s){s[s.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",s[s.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(n_||(n_={})),function(s){s[s.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",s[s.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",s[s.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",s[s.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",s[s.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(i_||(i_={})),function(s){s[s.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",s[s.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(s_||(s_={})),function(s){s[s.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",s[s.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",s[s.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",s[s.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(o_||(o_={})),function(s){s[s.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",s[s.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",s[s.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(a_||(a_={})),function(s){s[s.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",s[s.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",s[s.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",s[s.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(c_||(c_={})),function(s){s[s.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",s[s.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",s[s.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",s[s.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",s[s.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",s[s.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",s[s.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",s[s.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",s[s.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(l_||(l_={})),function(s){s[s.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",s[s.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",s[s.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",s[s.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(u_||(u_={})),function(s){s[s.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",s[s.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",s[s.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(d_||(d_={})),function(s){s[s.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",s[s.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",s[s.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",s[s.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(p_||(p_={})),function(s){s[s.NIM_MESSAGE_AI_STREAM_STATUS_STREAMING=-1]="NIM_MESSAGE_AI_STREAM_STATUS_STREAMING",s[s.NIM_MESSAGE_AI_STREAM_STATUS_NONE=0]="NIM_MESSAGE_AI_STREAM_STATUS_NONE",s[s.NIM_MESSAGE_AI_STREAM_STATUS_PLACEHOLDER=1]="NIM_MESSAGE_AI_STREAM_STATUS_PLACEHOLDER",s[s.NIM_MESSAGE_AI_STREAM_STATUS_CANCEL=2]="NIM_MESSAGE_AI_STREAM_STATUS_CANCEL",s[s.NIM_MESSAGE_AI_STREAM_STATUS_UPDATE=3]="NIM_MESSAGE_AI_STREAM_STATUS_UPDATE",s[s.NIM_MESSAGE_AI_STREAM_STATUS_COMPLETE=4]="NIM_MESSAGE_AI_STREAM_STATUS_COMPLETE",s[s.NIM_MESSAGE_AI_STREAM_STATUS_EXCEPTION=5]="NIM_MESSAGE_AI_STREAM_STATUS_EXCEPTION"}(h_||(h_={})),function(s){s[s.V2NIM_MESSAGE_AI_STREAM_STOP_OP_DEFAULT=0]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_DEFAULT",s[s.V2NIM_MESSAGE_AI_STREAM_STOP_OP_REVOKE=1]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_REVOKE",s[s.V2NIM_MESSAGE_AI_STREAM_STOP_OP_UPDATE=2]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_UPDATE"}(f_||(f_={})),function(s){s[s.V2NIM_MESSAGE_AI_REGEN_OP_UPDATE=1]="V2NIM_MESSAGE_AI_REGEN_OP_UPDATE",s[s.V2NIM_MESSAGE_AI_REGEN_OP_NEW=2]="V2NIM_MESSAGE_AI_REGEN_OP_NEW"}(m_||(m_={})),function(s){s[s.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",s[s.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",s[s.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}(g_||(g_={})),function(s){s[s.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",s[s.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",s[s.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",s[s.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",s[s.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",s[s.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",s[s.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",s[s.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",s[s.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",s[s.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",s[s.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",s[s.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",s[s.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(v_||(v_={})),function(s){s[s.V2NIM_SEARCH_KEYWORD_MATCH_TYPE_OR=0]="V2NIM_SEARCH_KEYWORD_MATCH_TYPE_OR",s[s.V2NIM_SEARCH_KEYWORD_MATCH_TYPE_AND=1]="V2NIM_SEARCH_KEYWORD_MATCH_TYPE_AND"}(y_||(y_={})),function(s){s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",s[s.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(__||(__={})),function(s){s[s.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",s[s.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",s[s.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",s[s.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(M_||(M_={})),function(s){s[s.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",s[s.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",s[s.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",s[s.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(T_||(T_={})),function(s){s[s.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",s[s.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(I_||(I_={})),function(s){s[s.V2NIM_CLEAR_HISTORY_MODE_ALL=0]="V2NIM_CLEAR_HISTORY_MODE_ALL",s[s.V2NIM_CLEAR_HISTORY_MODE_LOCAL=1]="V2NIM_CLEAR_HISTORY_MODE_LOCAL"}(S_||(S_={})),function(s){s[s.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",s[s.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",s[s.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",s[s.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",s[s.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",s[s.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(E_||(E_={})),function(s){s[s.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",s[s.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",s[s.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(C_||(C_={})),function(s){s[s.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",s[s.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(b_||(b_={})),function(s){s[s.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",s[s.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",s[s.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",s[s.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(A_||(A_={})),function(s){s[s.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",s[s.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(R_||(R_={})),function(s){s[s.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",s[s.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",s[s.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",s[s.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",s[s.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",s[s.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",s[s.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",s[s.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(N_||(N_={})),function(s){s[s.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",s[s.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",s[s.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(k_||(k_={})),function(s){s[s.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",s[s.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(O_||(O_={})),function(s){s[s.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",s[s.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",s[s.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(w_||(w_={})),function(s){s[s.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",s[s.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",s[s.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(x_||(x_={})),function(s){s[s.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",s[s.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",s[s.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(P_||(P_={})),function(s){s[s.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",s[s.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(L_||(L_={})),function(s){s[s.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",s[s.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(V_||(V_={})),function(s){s[s.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",s[s.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(D_||(D_={})),function(s){s[s.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",s[s.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",s[s.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=3]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(U_||(U_={})),function(s){s[s.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",s[s.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(F_||(F_={})),function(s){s[s.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",s[s.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",s[s.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(B_||(B_={})),function(s){s[s.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",s[s.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",s[s.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",s[s.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(q_||(q_={})),function(s){s[s.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",s[s.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",s[s.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",s[s.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(G_||(G_={})),function(s){s[s.teamApply=0]="teamApply",s[s.teamApplyReject=1]="teamApplyReject",s[s.teamInvite=2]="teamInvite",s[s.teamInviteReject=3]="teamInviteReject",s[s.tlistUpdate=4]="tlistUpdate",s[s.superTeamApply=15]="superTeamApply",s[s.superTeamApplyReject=16]="superTeamApplyReject",s[s.superTeamInvite=17]="superTeamInvite",s[s.superTeamInviteReject=18]="superTeamInviteReject"}(j_||(j_={})),function(s){s[s.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",s[s.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",s[s.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",s[s.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}(H_||(H_={})),function(s){s[s.V2NIM_AI_MODEL_STREAM_CALL_STATUS_NONE=0]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_NONE",s[s.V2NIM_AI_MODEL_STREAM_CALL_STATUS_CANCEL=2]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_CANCEL",s[s.V2NIM_AI_MODEL_STREAM_CALL_STATUS_COMPLETE=4]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_COMPLETE",s[s.V2NIM_AI_MODEL_STREAM_CALL_STATUS_EXCEPTION=5]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_EXCEPTION"}($_||($_={})),function(s){s.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",s.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",s.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}(K_||(K_={})),function(s){s[s.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",s[s.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",s[s.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",s[s.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",s[s.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",s[s.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",s[s.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",s[s.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",s[s.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL"}(Y_||(Y_={})),function(s){s[s.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",s[s.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",s[s.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(W_||(W_={})),function(s){s[s.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",s[s.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",s[s.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",s[s.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(J_||(J_={}));var OM={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation faileduse open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_IS_NOT_STICK_TOP:{code:110305,message:"conversation is not stick top"},V2NIM_ERROR_CODE_STICK_TOP_DISABLED:{code:110306,message:"conversation stick top disabled"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"},V2NIM_ERROR_CODE_STREAM_OUTPUT_STOPPED:{code:189318,message:"Streaming text response stopped"},V2NIM_ERROR_CODE_STREAM_OUTPUT_GENERATED:{code:189319,message:"Streaming text response generated"},V2NIM_ERROR_CODE_STREAM_OUTPUT_ABORTED:{code:189320,message:"Streaming text response aborted due to exception"},V2NIM_ERROR_CODE_INTERRUPTION_REJECTED:{code:189321,message:"Non-streaming messages cannot be interrupted"}},PR=Object.keys(OM),rt=PR.reduce(function(s,n){var c=OM[n];return s[n]=c.code,s},{}),wM=PR.reduce(function(s,n){var c=OM[n];return s[c.code]=c.message,s},{}),Y6=Object.freeze({__proto__:null,V2NIMErrorCode:rt,V2NIMErrorDesc:wM,get V2NIMDataSyncLevel(){return zy},get V2NIMDataSyncType(){return Xy},get V2NIMDataSyncState(){return Zy},get V2NIMConversationType(){return e_},get V2NIMLastMessageState(){return t_},get V2NIMFriendAddMode(){return r_},get V2NIMFriendAddApplicationType(){return n_},get V2NIMFriendAddApplicationStatus(){return i_},get V2NIMFriendDeletionType(){return s_},get V2NIMFriendVerifyType(){return o_},get V2NIMLoginAuthType(){return a_},get V2NIMLoginStatus(){return c_},get V2NIMLoginClientType(){return l_},get V2NIMKickedOfflineReason(){return u_},get V2NIMLoginClientChange(){return d_},get V2NIMConnectStatus(){return p_},get V2NIMMessageType(){return v_},get V2NIMMessageNotificationType(){return __},get V2NIMMessageAttachmentUploadState(){return M_},get V2NIMMessageSendingState(){return T_},get V2NIMQueryDirection(){return I_},get V2NIMMessageRevokeType(){return E_},get V2NIMMessagePinState(){return C_},get V2NIMMessageQuickCommentType(){return b_},get V2NIMClientAntispamOperateType(){return A_},get V2NIMSortOrder(){return R_},get V2NIMSystemMessageType(){return N_},get V2NIMMessageAIStreamStatus(){return h_},get V2NIMMessageAIStreamStopOpType(){return f_},get V2NIMMessageAIRegenOpType(){return m_},get V2NIMMessageAIStatus(){return g_},get V2NIMSearchKeywordMatchType(){return y_},get V2NIMClearHistoryMode(){return S_},get V2NIMTeamMessageMuteMode(){return k_},get V2NIMP2PMessageMuteMode(){return O_},get V2NIMTeamMemberRoleQueryType(){return w_},get V2NIMTeamType(){return x_},get V2NIMTeamJoinMode(){return P_},get V2NIMTeamAgreeMode(){return L_},get V2NIMTeamInviteMode(){return V_},get V2NIMTeamUpdateInfoMode(){return D_},get V2NIMTeamChatBannedMode(){return U_},get V2NIMTeamUpdateExtensionMode(){return F_},get V2NIMTeamJoinActionType(){return q_},get V2NIMTeamJoinActionStatus(){return G_},get V2NIMTeamNotificationType(){return j_},get V2NIMTeamMemberRole(){return B_},get V2NIMAIModelRoleType(){return K_},get V2NIMAIModelType(){return H_},get V2NIMAIModelStreamCallStatus(){return $_},get V2NIMSignallingChannelType(){return W_},get V2NIMSignallingEventType(){return Y_},get V2NIMUserStatusType(){return J_}});class Gt extends Error{constructor(n){super(n.desc),this.name="V2NIMError",this.code=n.code||0,this.desc=n.desc||wM[this.code]||LR[this.code]||"",this.message=this.desc,this.detail=n.detail||{}}toString(){var n,c=`${this.name}
 code: ${this.code}
 message: "${this.message}"
 detail: ${this.detail?JSON.stringify(this.detail):""}`;return!((n=this==null?void 0:this.detail)===null||n===void 0)&&n.rawError&&(c+=`
 rawError: ${this.detail.rawError.message}`),c}}class Lv extends Gt{constructor(n,c={},d){super({code:rt.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:n,rules:d,data:c}}),this.name="validateError",this.message=this.message+`
`+JSON.stringify(this.detail,null,2),this.data=c,this.rules=d}}class Au extends Gt{constructor(n){var c,d,f;super({code:rt.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:(c=n.detail)===null||c===void 0?void 0:c.reason,rules:(d=n.detail)===null||d===void 0?void 0:d.rules,data:(f=n.detail)===null||f===void 0?void 0:f.data}}),this.name="ValidateErrorV2"}}var LR={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"};function e2(s,n){return n instanceof RegExp?"__REGEXP "+n.toString():n}function Ks(s,n={},c,d=!1){var f={};return Object.keys(s).forEach(m=>{var y=s[m].type,M=c?`In ${c}, `:"";if(n==null){var S=`${M}param is null or undefined`;throw d?new Au({detail:{reason:S,data:{key:m},rules:"required"}}):new Lv(S,{key:m},"required")}if(n[m]===void 0){if(s[m].required===!1)return void(f[m]=n[m]);var E=`${M}param '${m}' is required`;throw d?new Au({detail:{reason:E,data:{key:m},rules:"required"}}):new Lv(E,{key:m},"required")}var b=W6[y];if(b&&!b(n,m,s[m],d)){var R=`${M}param '${m}' unexpected`,x={key:m,value:n[m]};throw d?new Au({detail:{reason:R,data:x,rules:JSON.stringify(s[m],e2)}}):new Lv(R,x,JSON.stringify(s[m],e2))}f[m]=n[m]}),f}var W6={string:function(s,n,c){var{allowEmpty:d,max:f,min:m,regExp:y}=c,M=s[n];return typeof M=="string"&&(d!==!1||M!=="")&&!(typeof f=="number"&&M.length>f)&&!(typeof m=="number"&&M.length<m)&&!(function(E){return Object.prototype.toString.call(E)==="[object RegExp]"}(y)&&!y.test(M))},number:function(s,n,c){var{min:d,max:f}=c,m=s[n];return typeof m=="number"&&!(typeof d=="number"&&m<d)&&!(typeof f=="number"&&m>f)},boolean:function(s,n){return typeof s[n]=="boolean"},file:function(s,n){return!0},enum:function(s,n,c){var{values:d}=c,f=s[n];return!d||d.indexOf(f)>-1},jsonstr:function(s,n){try{var c=JSON.parse(s[n]);return typeof c=="object"&&c!==null}catch{return!1}},func:function(s,n){return typeof s[n]=="function"},array:function(s,n,c,d=!1){var{itemType:f,itemRules:m,rules:y,min:M,max:S,values:E}=c,b=s[n];if(!Array.isArray(b)||typeof S=="number"&&b.length>S||typeof M=="number"&&b.length<M)return!1;if(m)b.forEach((R,x)=>{Ks({[x]:m},{[x]:R},`${n}[${x}]`,d)});else if(y)b.forEach((R,x)=>Ks(y,R,`${n}[${x}]`,d));else if(f==="enum"){if(E&&function(x,L){return L=L||[],(x=x||[]).filter(q=>L.indexOf(q)===-1)}(b,E).length)return!1}else if(f&&!b.every(R=>typeof R===f))return!1;return!0},object:function(s,n,c,d=!1){var{rules:f,allowEmpty:m}=c,y=s[n];if(typeof y!="object"||y===null)return!1;if(f){var M=Object.keys(f),S=Object.keys(y).filter(E=>M.indexOf(E)>-1);if(m===!1&&S.length===0)return!1;Ks(f,y,n,d)}return!0}};class VR{constructor(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}addTimer(n,c=0,d=1){var f=new Date().getTime(),m=this.id;return this.timerList.push({id:m,loop:d,count:0,timeout:f+c,interval:c,callback:n}),this.id++,this.checkTimer(f),m}checkTimer(n=new Date().getTime()){if(this.removeFinished(),this.timerList.length!==0||this.timer==null){var c=0;for(var d of this.timerList)(c===0||c>d.timeout)&&(c=d.timeout);this.timerList.length!==0&&(this.timer===null||c<this.timeout||this.timeout<n)&&(this.timer=setTimeout(this.nowTime.bind(this),c-n),this.timeout=c)}}nowTime(){var n=new Date().getTime();for(var c of this.timerList)n>=c.timeout&&(c.callback(),c.count++,c.timeout=n+c.interval);this.clerTime(),this.checkTimer(n)}clerTime(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}deleteTimer(n){for(var c=this.timerList.length-1;c>=0;c--)this.timerList[c].id===n&&this.timerList.splice(c,1)}removeFinished(){for(var n=this.timerList.length-1;n>=0;n--){var c=this.timerList[n];c.loop>=0&&c.count>=c.loop&&this.timerList.splice(n,1)}}destroy(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null}}function Q_(s,n){var c={};for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&n.indexOf(d)<0&&(c[d]=s[d]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var f=0;for(d=Object.getOwnPropertySymbols(s);f<d.length;f++)n.indexOf(d[f])<0&&Object.prototype.propertyIsEnumerable.call(s,d[f])&&(c[d[f]]=s[d[f]])}return c}function tr(s,n,c,d){return new(c||(c=Promise))(function(f,m){function y(E){try{S(d.next(E))}catch(b){m(b)}}function M(E){try{S(d.throw(E))}catch(b){m(b)}}function S(E){E.done?f(E.value):function(R){return R instanceof c?R:new c(function(x){x(R)})}(E.value).then(y,M)}S((d=d.apply(s,[])).next())})}function DR(s){return s!=null&&typeof s=="object"&&Object.getPrototypeOf(s)==Object.prototype}var J6={getNetworkStatus:()=>Promise.resolve({net_type:0,net_connect:!0}),onNetworkStatusChange(s){},offNetworkStatusChange(){}},zt={setLogger:function(s){throw new Error("setLogger not implemented.")},platform:"",WebSocket:class{constructor(n,c){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}close(n,c){throw new Error("Method not implemented.")}send(n){throw new Error("Method not implemented.")}onclose(n){throw new Error("Method not implemented.")}onerror(n){throw new Error("Method not implemented.")}onmessage(n){throw new Error("Method not implemented.")}onopen(n){throw new Error("Method not implemented.")}},localStorage:{},request:function(s,n){throw new Error("request not implemented.")},uploadFile:function(s){throw new Error("uploadFile not implemented.")},getSystemInfo:function(){throw new Error("getSystemInfo not implemented.")},getFileUploadInformation(s){throw new Error("getFileUploadInformation not implemented.")},envPayload:{},net:J6,logStorage:class{constructor(n){}open(){return Promise.resolve()}close(){}addLogs(n){return Promise.resolve()}extractLogs(){return Promise.resolve()}}},Vv=["error","warn","log","debug"],xo=function(){},t2=["off","error","warn","log","debug"];class Q6{constructor(n,c={}){this.storageArr=[],this.debugLevel="off",this.timer=0,this.strategies={debug:{name:"debg",func:console.log},log:{name:"info",func:console.log},warn:{name:"warn",func:console.warn},error:{name:"erro",func:console.error}},this.debug=xo,this.log=xo,this.warn=xo,this.error=xo,this.iid=Math.round(1e3*Math.random()),this.debugLevel=t2.includes(n)?n:"off",c.debugLevel&&(this.debugLevel=t2.includes(c.debugLevel)?c.debugLevel:this.debugLevel),this.logStorage=c.storageEnable===!1?null:new zt.logStorage(c==null?void 0:c.storageName),this.setOptions(c),this.setLogFunc(this.debugLevel),this.setTimer(),this.open()}getDebugMode(){return this.debugLevel==="debug"}open(n){this.logStorage&&this.logStorage.open(n).then(()=>{this.log("Logger::open success")}).catch(c=>{this.warn("Logger::open failed",c)})}setOptions(n){if(n&&n.logFunc){var c=n.logFunc;for(var d in c){var f=d,m=c[f];m&&(this.strategies[f].func=m)}}}setLogFunc(n,c="log"){var d=Vv.findIndex(m=>m===n),f=Vv.findIndex(m=>m===c);Vv.forEach((m,y)=>{this[m]=function(){if(!(y>d&&y>f)){var M=Array.prototype.slice.call(arguments),S=this.strategies[m],E=this.formatArgs(M,S.name);y<=f&&this.logStorage&&this.prepareSaveLog(E,m),y<=d&&S.func(E)}}})}extractLogs(){var n;return this.logStorage?(n=this.logStorage)===null||n===void 0?void 0:n.extractLogs():Promise.resolve("")}prepareSaveLog(n,c){this.storageArr.push({text:n,level:c,time:Date.now(),iid:this.iid}),this.timer||this.setTimer(),this.storageArr.length>=100&&(this.triggerTimer(),this.storageArr=[])}saveLogs(){return tr(this,void 0,void 0,function*(){if(this.logStorage){var n=this.storageArr;this.storageArr=[];try{yield this.logStorage.addLogs(n)}catch{}}})}clearTimer(){this.timer&&clearTimeout(this.timer),this.timer=0}setTimer(){this.clearTimer(),this.timer=setTimeout(this.triggerTimer.bind(this),5e3)}triggerTimer(){this.clearTimer(),this.saveLogs()}formatArgs(n,c){var d=new Date;return`[NIM ${this.iid} ${c} ${`${d.getMonth()+1}-${d.getDate()} ${d.getHours()}:${d.getMinutes()}:${d.getSeconds()}:${d.getMilliseconds()}`}] `+n.map(f=>f instanceof Gt?f.toString():f instanceof Error?f&&f.message?f.message:f:typeof f=="object"?JSON.stringify(f):f).join(" ")}destroy(){this.debug=xo,this.log=xo,this.warn=xo,this.error=xo,this.saveLogs(),this.clearTimer(),this.storageArr=[],this.logStorage&&this.logStorage.close()}}function Kr(s,n){if(typeof s!="object"||s===null)return s;for(var c=(n=n||"").split("."),d=0;d<c.length;d++){var f=c[d],m=s[f],y=f.indexOf("["),M=f.indexOf("]");if(y!==-1&&M!==-1&&y<M){var S=f.slice(0,y),E=parseInt(f.slice(y+1,M));m=s[S],m=Array.isArray(m)?m[E]:void 0}if(m==null)return m;s=m}return s}var Bs,Nc=(Bs=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return Bs()+Bs()+Bs()+Bs()+Bs()+Bs()+Bs()+Bs()});function r2(){return typeof tt<"u"&&tt.getSystemInfo?"TT":typeof swan<"u"&&swan.getSystemInfo?"BAIDU":typeof my<"u"&&my.getSystemInfo?"ALI":typeof wx<"u"&&wx.getSystemInfo?"WX":"unknow environment"}function Ru(s,n){return function(d,f,m,y){for(var M in d=d||{},m=m||{},y=y||(()=>{}),f=f||{}){var S=y(d[M],f[M]);d[M]=S===void 0?f[M]:S}for(var E in m){var b=y(d[E],m[E]);d[E]=b===void 0?m[E]:b}return d}({},s,n,function(c,d){return d===void 0?c:d})}function gp(){return Promise.resolve()}function uu(){}class z6{constructor(n){this.lastSuccUploadHost="",this.core=n}getFileUploadInformation(n){return zt.getFileUploadInformation(n)}request(n,c,d){var f=new Date().getTime(),m=(d==null?void 0:d.exception_service)||0;return zt.request(n,c).catch(y=>{var M,S,E,b,R=y;throw this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||((S=(M=this.core)===null||M===void 0?void 0:M.auth)===null||S===void 0?void 0:S.account),trace_id:(b=(E=this.core.clientSocket)===null||E===void 0?void 0:E.socket)===null||b===void 0?void 0:b.sessionId,start_time:f,action:1,exception_service:m}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:typeof R.code=="number"?R.code:0,description:R.message||`${R.code}`,operation_type:0,target:n,context:c?JSON.stringify(c):""},{asyncParams:zt.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),y})}uploadFile(n){var c,d,f,m;return tr(this,void 0,void 0,function*(){for(var y=zt.platform==="BROWSER",M=y?n.chunkUploadHostBackupList:n.commonUploadHostBackupList,S=y?n.chunkUploadHost:n.commonUploadHost,E=M.indexOf(S),b=E===-1?[S,...M]:[S,...M.slice(0,E),...M.slice(E+1)],R=Math.max(b.indexOf(this.lastSuccUploadHost),0),x=null,L=0;L<b.length;L++){var q=new Date().getTime(),D=b[(L+R)%b.length];try{var G=yield zt.uploadFile(Object.assign(Object.assign({},n),y?{chunkUploadHost:D}:{commonUploadHost:D}));return this.lastSuccUploadHost=D,G}catch(ne){this.core.cloudStorage.nos.nosErrorCount--,x=ne;var J=ne;if(this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||((d=(c=this.core)===null||c===void 0?void 0:c.auth)===null||d===void 0?void 0:d.account),trace_id:(m=(f=this.core.clientSocket)===null||f===void 0?void 0:f.socket)===null||m===void 0?void 0:m.sessionId,start_time:q,action:1,exception_service:3}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:typeof J.code=="number"?J.code:0,description:J.message||`${J.code}`,operation_type:1,target:D},{asyncParams:zt.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),ne&&(ne.code===rt.V2NIM_ERROR_CODE_CANCELLED||ne.errCode===10499))throw ne}}throw x})}}var UR="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo";class X6{constructor(n,c){this.abtInfo={},this.core=n,this.config=Ru({isAbtestEnable:!0,abtestUrl:UR,abtestProjectKey:"imElite_sdk_abtest_web"},c)}setOptions(n){this.config=Ru(this.config,n)}abtRequest(){var n,c;return tr(this,void 0,void 0,function*(){if(this.config.isAbtestEnable&&!this.abtInfo.experiments&&this.config.abtestUrl){var d;try{d=yield this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.8.30",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7})}catch{this.core.logger.warn("ABTest request failed")}this.abtInfo=((c=(n=d==null?void 0:d.data)===null||n===void 0?void 0:n.data)===null||c===void 0?void 0:c.abtInfo)||{}}})}}class z_{constructor(){this.abortFns=[]}add(n){var c=function(f){var m={},y=new Promise(function(M,S){m.abort=S});return m.promise=Promise.race([f,y]),m}(n);return this.abortFns.push(c.abort),c.promise}clear(n){this.abortFns.forEach(c=>c(n||new Gt({code:rt.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))),this.abortFns=[]}destroy(){this.clear()}}var n2={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},i2={timestamp:0,rtt:0,baseClock:0,baseTime:0};class FR{constructor(n,c,d="getServerTime"){this.serverOrigin=i2,this.config=n2,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=n,this.logger=n.logger,this.promiseManager=new z_,this.cmdName=d,c&&this.setOptions(c)}setOptions(n){this.config=Object.assign({},n2,this.config,n)}reset(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=i2,this.currentChance=0}setOriginTimetick(){return tr(this,void 0,void 0,function*(){if(this.config.enable&&!(this.isSettingNTP||this.currentChance>=this.config.maxChances)){var n=Kr(this.core,"auth.status"),c=Kr(this.core,"status"),d=Kr(this.core,"V2NIMLoginService.lifeCycle.loginStatus");if(n==="logined"||c==="logined"||d===1){this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0;var f,m="TimeOrigin::setOriginTimetick:",y=Date.now();this.core.logger.debug(`${m} getServerTime start, times ${this.currentChance}`);try{f=Kr(yield this.promiseManager.add(this.core.sendCmd(this.cmdName)),"content.time"),this.isSettingNTP=!1}catch(E){var M=E;return this.isSettingNTP=!1,this.logger.warn(`${m} Calculate Delay time, getServerTime error`,M),void(M.code!==rt.V2NIM_ERROR_CODE_CANCELLED&&(clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)))}if(!f)return this.core.logger.warn(`${m} Calculate Delay time incorrect format`),void(this.config.enable=!1);var S=Date.now()-y;this.doSet(f,S)}}})}doSet(n,c){var d="TimeOrigin::setOriginTimetick:";c>this.config.tolerantRTT?(this.logger.warn(`${d} denied RTT:${c}`),clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)):c>this.config.bestRTT?(this.serverOrigin.rtt&&c>=this.serverOrigin.rtt?this.logger.warn(`${d} ignore RTT:${c}`):(this.setServerOrigin(c,n),this.logger.log(`${d} accept reluctantly RTT:${c}`)),clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.failedDelay)):(this.setServerOrigin(c,n),this.logger.debug(`${d} accept best RTT:${c}`),this.currentChance=0,clearTimeout(this.timer),this.timer=setTimeout(this.setOriginTimetick.bind(this),this.successDelay))}getNTPTime(n){if(n===void 0&&(n=this.getTimeNode()),this.checkNodeReliable(n)){var c=Math.floor(n.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+c}return Date.now()}checkNodeReliable(n){if(n===void 0&&(n=this.getTimeNode()),this.serverOrigin.timestamp){if(this.serverOrigin.baseClock===0)return!0;var c=n.clock-this.serverOrigin.baseClock,d=n.time-this.serverOrigin.baseTime;return Math.abs(d-c)<500}return!1}checkPerformance(){return zt.platform==="BROWSER"}static checkPerformance(){return zt.platform==="BROWSER"}getTimeNode(){return{clock:this.checkPerformance()?performance.now():0,time:Date.now()}}static getTimeNode(){return{clock:0,time:Date.now()}}setServerOrigin(n,c){this.serverOrigin={timestamp:c+Math.floor(n/2),rtt:n,baseClock:this.checkPerformance()?performance.now():0,baseTime:Date.now()}}}var Dv={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]};class Z6{constructor(n,c){this.traceData=Dv,this.core=n,this.traceData=Object.assign({},Dv,c),this.traceData.extension=[]}reset(){this.traceData=Object.assign({},Dv),this.traceData.extension=[]}start(){var n,c;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=((c=(n=this.core.clientSocket)===null||n===void 0?void 0:n.socket)===null||c===void 0?void 0:c.sessionId)||"",this.traceData.start_time=new Date().getTime()}update(n){return tr(this,void 0,void 0,function*(){var{net_type:c,net_connect:d}=yield zt.net.getNetworkStatus();this.traceData.extension.push(Object.assign({code:0,foreground:!0,foreg_backg_switch:!1,net_type:c,net_connect:d},n))})}end(n){var c=this.traceData.extension[0],d=this.traceData.extension[1];if(c&&c.operation_type===0&&d&&d.operation_type===1){var f=c.net_type!==d.net_type||c.net_connect!==d.net_connect;if(n||!f)return this.traceData.duration=new Date().getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()}}var s2={user_id:"",trace_id:"",net_connect:!0,net_type:0,duration:0,start_time:0,history:[],succeed:!1};class ej{constructor(n){this.traceData=s2,this.core=n,this.reset()}reset(){this.traceData=Object.assign({},s2),this.traceData.history=[]}start(n){this.reset(),this.traceData.user_id=n,this.traceData.start_time=Date.now()}updateBegin(n){this.traceData.history.push(Object.assign({head:"",body:"",start_time:Date.now(),httpdns:!1,index:0},n))}updateComplete(n){this.traceData.history.forEach(c=>{c.target===n.target&&(Object.assign(c,n),c.duration=Date.now()-c.start_time)})}end(n){return tr(this,void 0,void 0,function*(){if(this.traceData.succeed=n,this.traceData.history=this.traceData.history.filter(f=>f.code!==void 0),this.traceData.history.length!==0){this.traceData.duration=Date.now()-this.traceData.start_time;var{net_type:c,net_connect:d}=yield zt.net.getNetworkStatus();this.traceData.net_type=c,this.traceData.net_connect=d,this.core.reporter.report("nim_sdk_lbs_records",this.traceData),this.reset()}else this.reset()})}}function tj(s){var n,c,d=!0;return typeof((n=s==null?void 0:s.reporterConfig)===null||n===void 0?void 0:n.enableCompass)=="boolean"?d=s.reporterConfig.enableCompass:typeof((c=s==null?void 0:s.reporterConfig)===null||c===void 0?void 0:c.isDataReportEnable)=="boolean"&&(d=s.reporterConfig.isDataReportEnable),d}var vp={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},o2="ReporterHook::setMonitorForResources:";class rj{constructor(n,c){this.traceData=vp,this.core=n,this.traceData=Object.assign({},vp,c)}reset(){this.traceData=Object.assign({},vp)}start(){var n,c;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=((c=(n=this.core.clientSocket)===null||n===void 0?void 0:n.socket)===null||c===void 0?void 0:c.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Date.now()}update(n){return tr(this,void 0,void 0,function*(){this.traceData.user_id&&(this.core.logger.log(`${o2} upload update`,n),Object.assign(this.traceData,n))})}end(n){this.traceData.user_id&&(this.core.logger.log(`${o2} upload end cause of ${n}`),this.traceData.state=n,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Date.now())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=vp)}}var yp={},Uv={},a2={},nj={apiVersion:"v1",debugLevel:"off",needReconnect:!0,reconnectionAttempts:Number.MAX_SAFE_INTEGER,lbsUrls:["https://lbs.netease.im/lbs/webconf.jsp"],linkUrl:"weblink.netease.im:443",abtestUrl:UR,isAbtestEnable:!0};class ii extends ju{constructor(n,c={}){if(super(),this.instanceName="NIM",this.pluginMap={},this.eventBus=new ju,this.options={},this.V2NIMConversationIdUtil={},this.V2NIMMessageCreator={},this.V2NIMMessageAttachmentCreator={},this.V2NIMClientAntispamUtil={},this.DataStructureConverter={},this.V2NIMMessageConverter={},this.V2NIMMessageLogUtil={},this.V2NIMMessageExtendUtil={},this.V2NIMStorageUtil={},this.V2NIMNotificationService={},this.V2NIMStorageService={},this.auth={},this.V1NIMLoginService={},this.V2NIMLoginService={},this.clientSocket={},this.V2NIMSyncService={},this.V2NIMLocalConversationService={},this.V2NIMConversationService={},this.V2NIMConversationGroupService={},this.V2NIMMessageService={},this.V2NIMTeamService={},this.V2NIMUserService={},this.V2NIMFriendService={},this.V2NIMSettingService={},this.V2NIMAIService={},this.V2NIMSignallingService={},this.V2NIMSubscriptionService={},this.V2NIMPassthroughService={},this.YSFService={},this.offlinePush={},this.sync={},this.msg={},this.msgLog={},this.session={},this.cloudSession={},this.misc={},this.user={},this.friend={},this.systemMessage={},this.team={},this.event={},this.msgExtend={},this.cloudStorage={},this.passThrough={},this.superTeam={},this.plugin={},this.signaling={},this.qchatChannel={},this.qchatMedia={},this.qchatMsg={},this.qchatRole={},this.qchatServer={},this.pluginMap=a2,this.logger=new Q6(n.debugLevel,c.loggerConfig),c.privateConf){var{authConfig:d,cloudStorageConfig:f,reporterConfig:m}=this.getConfigFromPrivate(c.privateConf);Object.assign(n,d),this.setInitOptions(n),this.otherOptions=Object.assign(Object.assign({},c),{cloudStorageConfig:Object.assign(Object.assign({storageKeyPrefix:"NIM"},c.cloudStorageConfig),f),reporterConfig:Object.assign(Object.assign({},c.reporterConfig),m),V1NIMLoginServiceConfig:Object.assign(Object.assign(Object.assign({},n),c.V1NIMLoginServiceConfig),d),V2NIMLoginServiceConfig:Object.assign(Object.assign({},c.V2NIMLoginServiceConfig),d)})}else this.setInitOptions(n),this.otherOptions=Object.assign(Object.assign({},c),{V1NIMLoginServiceConfig:Object.assign(Object.assign({},n),c.V1NIMLoginServiceConfig),cloudStorageConfig:Object.assign({storageKeyPrefix:"NIM"},c.cloudStorageConfig)});this.timerManager=new VR,this.timeOrigin=new FR(this),this.adapters=new z6(this),this.abtest=new X6(this,Object.assign(Object.assign({isAbtestEnable:this.options.isAbtestEnable,abtestUrl:this.options.abtestUrl},this.otherOptions.abtestConfig),{abtestProjectKey:"imElite_sdk_abtest_web"}));var y=zt.getSystemInfo(),M=function(E,b){var R,x,L=(R=b==null?void 0:b.reporterConfig)===null||R===void 0?void 0:R.compassDataEndpoint,q=(x=b==null?void 0:b.reporterConfig)===null||x===void 0?void 0:x.reportConfigUrl;if(L)return L;if(q){var D=q.match(/^https:\/\/([^/]+)\/*/);return Array.isArray(D)&&D.length>=1?`https://${D[1]}`:(E.error(`Invalid reportConfigUrl: ${q}`),"https://statistic.live.126.net,https://statistic-overseas.yunxinfw.com")}return"https://statistic.live.126.net,https://statistic-overseas.yunxinfw.com"}(this.logger,this.otherOptions);this.reporter=new K6(Object.assign(Object.assign({},M?{compassDataEndpoint:M}:{}),{isDataReportEnable:tj(this.otherOptions),common:{app_key:n.appkey,dev_id:"",platform:"Web",sdk_ver:"10.8.30",env:"online",os_name:y.os,os_ver:y.osVer,lib_env:y.libEnv,host_env:y.hostEnv,host_env_ver:y.hostEnvVer,manufactor:y.manufactor,model:y.model,v2:this.options.apiVersion!=="v1"},request:zt.request,logger:this.logger,autoStart:!0})),this.reporterHookLinkKeep=new Z6(this),this.reporterHookCloudStorage=new rj(this),this.reporterHookLBS=new ej(this),zt.setLogger(this.logger),this.getServiceKeys(Object.keys(yp)).forEach(S=>{if(!this[S]||!this[S].name){var E=yp[S];this[S]=new E(this)}}),Object.keys(yp).forEach(S=>{this.callSetOptions(S)}),Object.keys(Uv).forEach(S=>{var E=Uv[S];E!==void 0&&(this[S]=new E(this))}),ii.instance=this,this.logger.log(`NIM init, version:10.8.30, sdk version:100830, appkey:${n.appkey}`)}getServiceKeys(n){var c=n.findIndex(b=>b==="V1NIMLoginService");if(c>-1){var d=n[c];n.splice(c,1),this.options.apiVersion==="v1"&&n.unshift(d)}var f=n.findIndex(b=>b==="V2NIMLoginService");if(f>-1){var m=n[f];n.splice(f,1),this.options.apiVersion==="v2"&&n.unshift(m)}var y=n.findIndex(b=>b==="sync");if(y>-1){var M=n[y];n.splice(y,1),this.options.apiVersion==="v1"&&n.push(M)}var S=n.findIndex(b=>b==="V2NIMSyncService");if(S>-1){var E=n[S];n.splice(S,1),this.options.apiVersion==="v2"&&n.push(E)}return n}static getInstance(n,c){if(!ii.instance){if(n)return new ii(n,c);throw new Error("Instance not exist, please input options")}if(n){if(ii.instance.options.account===n.account&&ii.instance.options.appkey===n.appkey)return ii.instance.setOptions(n),ii.instance;throw new Error("Unexpected login")}return ii.instance}setInitOptions(n){Ks({appkey:{type:"string"},apiVersion:{type:"enum",values:["v1","v2"],required:!1},binaryWebsocket:{type:"boolean",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},n),this.options=Object.assign(Object.assign({},nj),n)}getConfigFromPrivate(n){var c;return n?{authConfig:JSON.parse(JSON.stringify({appkey:n.appkey||void 0,lbsUrls:n.weblbsUrl?[n.weblbsUrl]:void 0,linkUrl:n.link_web||void 0,linkSSL:(c=n.websdkSsl)!==null&&c!==void 0?c:void 0})),cloudStorageConfig:JSON.parse(JSON.stringify({chunkUploadHost:n.nos_uploader||void 0,commonUploadHost:n.nos_uploader||void 0,commonUploadHostBackupList:n.nos_uploader?[n.nos_uploader]:void 0,chunkUploadHostBackupList:n.nos_uploader?[n.nos_uploader]:void 0,uploadReplaceFormat:n.nos_downloader_v2?`${n.nosSsl?"https://":"http://"}${n.nos_downloader_v2}`:void 0,downloadUrl:n.nos_accelerate!==void 0?n.nos_accelerate:void 0,downloadHostList:n.nos_accelerate_host===""?[]:typeof n.nos_accelerate_host=="string"?[n.nos_accelerate_host]:Array.isArray(n.nos_accelerate_host)?n.nos_accelerate_host:void 0})),reporterConfig:JSON.parse(JSON.stringify({enableCompass:typeof n.enableCompass=="boolean"?n.enableCompass:void 0,compassDataEndpoint:n.compassDataEndpoint||void 0}))}:{authConfig:{},cloudStorageConfig:{},reporterConfig:{}}}connect(n={}){return this.V1NIMLoginService.login(n)}setOptions(n){if(typeof n=="object"&&n!==null){if(Object.prototype.hasOwnProperty.call(n,"account")&&n.account!==this.options.account||Object.prototype.hasOwnProperty.call(n,"appkey")&&n.appkey!==this.options.appkey)throw new Gt({code:rt.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions account and appkey is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(n,"apiVersion")&&n.apiVersion!==this.options.apiVersion)throw new Gt({code:rt.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions apiVersion is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(n,"binaryWebsocket")&&n.binaryWebsocket!==this.options.binaryWebsocket)throw new Gt({code:rt.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions binaryWebsocket is not allowed to reset"}});Ks({token:{type:"string",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},n),this.logger.log("NIM::setOptions options is",n),this.options=Object.assign(Object.assign({},this.options),n),this.V1NIMLoginService.setOptions&&this.V1NIMLoginService.setOptions(this.options)}}getOptions(){return this.options}disconnect(){return this.V1NIMLoginService.logout()}_disconnect(){return this.options.apiVersion==="v1"?this.V1NIMLoginService.logout():this.options.apiVersion==="v2"?Kr(this.V2NIMLoginService,"lifeCycle.connectStatus")===0&&Kr(this.V2NIMLoginService,"lifeCycle.loginStatus")===0?Promise.resolve():this.V2NIMLoginService.logout():Promise.resolve()}destroy(){return ii.instance=void 0,this._disconnect().then(()=>{this.status="destroyed",this.removeAllListeners(),this.eventBus.removeAllListeners(),this.logger.destroy(),this.reporter.destroy(),this.timerManager.destroy(),this._clearModuleData("destroy"),this._removeAllModuleListeners(),this.connect=gp,this.disconnect=gp,this._disconnect=gp,this.destroy=gp})}_clearModuleData(n="logout"){Object.values(this).forEach(c=>{c&&typeof c.reset=="function"&&c.reset(n)})}_removeAllModuleListeners(){Object.values(this).forEach(n=>{n&&typeof n.removeAllListeners=="function"&&n.removeAllListeners()})}kick(n){return this.V1NIMLoginService.kick(n)}sendCmd(n,c,d){return this.clientSocket.sendCmd(n,c,d)}emit(n,...c){try{var d=Date.now(),f=super.emit(n,...c),m=Date.now()-d;return m>=10&&this.logger.warn(`Core::emit event: ${n} process takes: ${m}ms`),f}catch(y){return this.logger.error(`Core::emit event: ${n}. Error: ${y}`),setTimeout(()=>{throw this.logger.error(`Core::emit throw error in setTimeout. event: ${n}. Error: ${y}`),y},0),!1}}get account(){return this.auth.account}get status(){return this.V1NIMLoginService.status}set status(n){this.V1NIMLoginService.status=n}get config(){return{timeout:8e3,deviceId:this.auth.deviceId}}_registerDep(n,c){this[c]&&this[c].name||(this[c]=new n(this),this.callSetOptions(c))}callSetOptions(n){var c=`${n}Config`,d=`${n}Options`,f=this.otherOptions[c]||this.otherOptions[d]||{},m=Kr(this,`${n}.setOptions`);typeof m=="function"&&(n==="cloudStorage"&&(f=this.otherOptions[c]||this.otherOptions.serverConfig||{}),m.call(this[n],f))}static registerService(n,c){yp[c]=n}static registerPrivateService(n,c){Uv[c]=n}static registerPlugin(n,c){a2[c]=n}}ii.sdkVersion=100830,ii.sdkVersionFormat="10.8.30";var xM={},Fc={};function BR(s,n,c,d){var f=xM[s];if(!f)return c.error("createCmd:: can not find cmd config: ",s),null;var m={SER:n,SID:f.sid,CID:f.cid,Q:[]};return f.params&&d&&f.params.forEach(function(y){var M=d[y.name];if(M!=null){var S=y.type,{reflectMapper:E,select:b}=y;switch(y.type){case"PropertyArray":S="ArrayMable",M=M.map(R=>({t:"Property",v:E?c2(R,E,b):R}));break;case"Property":M=E?c2(M,E,b):M;break;case"Bool":M=M?"true":"false"}m.Q.push({t:S,v:M})}}),{packet:m,hasPacketResponse:typeof f.hasPacketResponse!="boolean"||f.hasPacketResponse,hasPacketTimer:typeof f.hasPacketTimer!="boolean"||f.hasPacketTimer}}function qR(s,n){var c;try{c=JSON.parse(s)}catch{return void n.error(`Parse command error:"${s}"`)}var d=c.sid+"_"+c.cid,f=c.r;if(["4_1","4_2","4_10","4_11"].includes(d)){var m=c.r[1].headerPacket;d=`${m.sid}_${m.cid}`,c.sid=m.sid,c.cid=m.cid,f=c.r[1].body}var y=Fc[d],M=[];if(y){for(var S of y)M.push(ij(c,S.config,S.cmd,f,n));return M}n.error("parseCmd:: mapper not exist",d,c.code)}function ij(s,n,c,d,f){var m,y={cmd:c,raw:s,error:null,service:n==null?void 0:n.service,content:{},__receiveTimeNode:FR.getTimeNode()};if(!c||!n)return y.notFound=!0,y;(n.sid===18||n.sid>=26&&n.sid<100)&&(s.code=function(E){if(typeof E!="number"||E!=E)throw new Gt({code:rt.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:`${E}`}});if(E<0||E>=0&&E<1e3||E>=2e4&&E<=20099)return E;var b=(65535&E)>>9;return b-=b<=38?1:2,1e5+1e3*b+(511&E)}(s.code));var M=function(E,b){var R=wM[E],x=LR[E];return x===null?null:new Gt({code:E,desc:R||x||E,detail:{cmd:b,timetag:Date.now()}})}(s.code,c);if(y.error=M,y.error){if(y.error.detail.cmd=c,!(!((m=n==null?void 0:n.ignoreErrCodes)===null||m===void 0)&&m.includes(s.code)))return y;f.warn("parseCmd:: ignore error ",y.error),y.error.detail.ignore=!0}return n.response&&n.response.forEach((S,E)=>{var b=d[E],R=S.type,x=S.name,L=S.reflectMapper;if(b!==void 0)switch(R){case"Property":y.content[x]=L?X_(b,L):b;break;case"PropertyArray":y.content[x]=b.map(q=>L?X_(q,L):q);break;case"Int":case"Long":case"Byte":y.content[x]=+b;break;case"Bool":y.content[x]=b==="true"||b===!0||b===1;break;default:y.content[x]=b}}),y}function c2(s,n,c){var d={};for(var f in s=function(E,b){var R={};for(var x in b){var L=b[x],q=typeof L=="number"?x:L.access?L.access:x,D=q.split("."),G=E;for(var J of D){if(G[J]===void 0||G[J]===null){G=void 0;break}G=G[J]}G!==void 0&&(R[q]=G)}return R}(s,n),n){var m=n[f],y=typeof m=="number"?f:m.access?m.access:f;if(!c||c.includes(f))if(y in s){if(typeof m=="number")d[m]=s[y];else if(typeof m=="object")if(m.converter){var M=m.converter(s[y],s);M!==void 0&&(d[m.id]=M)}else d[m.id]=s[y]}else typeof m=="object"&&m.def&&(typeof m.def=="function"?d[m.id]=m.def(s):d[m.id]=m.def)}return d}function X_(s,n){var c={};for(var d in s){var f=n[d];if(typeof f=="string")c[f]=s[d];else if(typeof f=="object"&&"prop"in f){var m=f.access?f.access:f.prop;if(f.converter){var y=f.converter(s[d],s);y!==void 0&&(c[m]=y)}else f.type&&f.type==="number"?c[m]=+s[d]:f.type&&f.type==="boolean"?c[m]=!(s[d]==="0"||!s[d]):c[m]=s[d]}}for(var M in n){var S=n[M];if(S&&S.def!==void 0){var E=S.access?S.access:S.prop;E in c||(typeof S.def=="function"?c[E]=S.def(s):c[E]=S.def)}}return c=function(R){var x={},L=function(D){var G=D.split(".");G.reduce(function(J,ne,z){return J[ne]||(J[ne]=isNaN(Number(G[z+1]))?G.length-1==z?R[D]:{}:[])},x)};for(var q in R)L(q);return x}(c),c}function wp(s){for(var n in Object.assign(xM,s.cmdConfig),s.cmdMap){var c=s.cmdMap[n],d=s.cmdConfig[c];if(d)if(Array.isArray(Fc[n])){var f=!1;for(var m of Fc[n])if(m.cmd===c&&m.config.service===d.service){f=!0;break}f||Fc[n].push({config:d,cmd:c})}else Fc[n]=[{config:d,cmd:c}]}}function Re(s){var n={};for(var c in s){var d=s[c];typeof d=="number"?n[d]=c:typeof d=="object"&&(n[d.id]={prop:c,type:d.retType,access:d.retAccess?d.retAccess:d.access?d.access:c,def:d.retDef,converter:d.retConverter})}return n}function sr(s){return s?1:0}function sj(s){return parseInt(s)===1}function du(s){if(s&&typeof s=="object")try{return JSON.stringify(s)}catch{return}}function Xp(s){if(s&&typeof s=="string")try{return JSON.parse(s)}catch{return}}function PM(s,n){if(!DR(n))return{};var c=JSON.parse(JSON.stringify(n)),d=GR(s,c);return JSON.parse(JSON.stringify(Object.assign(Object.assign({},c),d)))}function GR(s,n){if(!DR(n))return{};var c={};return Object.keys(s).forEach(d=>{var f=s[d].type;if(typeof f!="string"){var m=GR(s[d],n);Object.keys(m).length>0&&(c[d]=m)}else{var y=s[d],M=y.rawKey||d,S=oj[f](n,M,y);S!==void 0&&(n[M]=void 0,c[d]=S)}}),c}var oj={number:function(s,n){if(s[n]!==void 0)return+s[n]},string:function(s,n){if(s[n]!==void 0)return s[n]},boolean:function(s,n){return+s[n]>0||+s[n]!=0&&void 0},enum:function(s,n,c){return c.values[s[n]]},object:function(s,n){if(s[n]!==void 0)try{return JSON.parse(s[n])}catch{return{}}}};function l2(s){return PM({type:{type:"number"},port:{type:"number"},customClientType:{type:"number"},timestamp:{type:"number"},loginType:{type:"number"}},s)}function er(s){s=s||{};var n={};for(var c in s)n[s[c]]=c;return n}var aj={"26_3":"v2Login","26_5":"v2Logout","26_8":"v2KickOffline","26_9":"v2BeKicked","26_10":"v2LoginClientChange","36_1":"v2GetChatroomLinkAddress"},cj={"1_2":"heartbeat","2_7":"nimLoginClientChange","24_8":"qchatLoginClientChange"},Bc={webLoginReqTag:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,clientId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,thirdPartyExtension:116,token:1e3},mixAuthRepTag:{clientId:1,consid:2,clientIP:3,port:4,type:5,customClientType:6,timestamp:7,customTag:8,os:9,pushType:10,hasTokenPreviously:11,loginType:12},nimAuthRepTag:{type:3,os:4,mac:5,clientId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,consid:102,clientIP:103,port:104,timestamp:109,pushType:110,hasTokenPreviously:111},qchatAuthRepTag:{clientId:8,consid:102,clientIP:103,port:104,type:6,customClientType:13,timestamp:105,os:30,pushType:100,hasTokenPreviously:101}},lj={v2Login:{sid:26,cid:3,service:"auth",params:[{type:"Property",name:"tag",reflectMapper:Bc.webLoginReqTag}],response:[{type:"Property",name:"data",reflectMapper:er(Bc.mixAuthRepTag)},{type:"PropertyArray",name:"loginClients",reflectMapper:er(Bc.mixAuthRepTag)}]},v2Logout:{sid:26,cid:5,service:"auth"},v2KickOffline:{sid:26,cid:8,service:"auth",params:[{type:"StrArray",name:"clientIds"}],response:[{type:"StrArray",name:"clientIds"}]},v2BeKicked:{sid:26,cid:9,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"reasonDesc"},{type:"Int",name:"customClientType"}]},v2LoginClientChange:{sid:26,cid:10,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:er(Bc.mixAuthRepTag)}]},v2GetChatroomLinkAddress:{sid:36,cid:1,service:"auth",params:[{type:"Long",name:"roomId"},{type:"Bool",name:"miniProgram"}],response:[{type:"StrArray",name:"linkAddress"}]}},uj={heartbeat:{sid:1,cid:2,service:"auth"},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:er(Bc.nimAuthRepTag)}]},qchatLoginClientChange:{sid:24,cid:8,service:"auth",response:[{type:"Byte",name:"state"},{type:"Property",name:"data",reflectMapper:er(Bc.qchatAuthRepTag)}]}},LM=Pc;function Pc(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}Pc.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var n=Math.random(),c=Math.floor(n*this.jitter*s);s=(1&Math.floor(10*n))==0?s-c:s+c}return 0|Math.min(s,this.max)},Pc.prototype.reset=function(){this.attempts=0},Pc.prototype.setMin=function(s){this.ms=s},Pc.prototype.setMax=function(s){this.max=s},Pc.prototype.setJitter=function(s){this.jitter=s};var u2=function(s){var n;if(s!==void 0)return(n=ur(s)).sign=1,n},jR=function(s){return Object.prototype.toString.call(s)==="[object Array]"},HR=function(s){return[typeof s=="number",typeof s=="string"&&s.length>0,jR(s)&&s.length>0,s instanceof ur].some(function(n){return n===!0})},$R="Invalid Number",dj="Invalid Number - Division By Zero";function ur(s){var n;if(!(this instanceof ur))return new ur(s);if(this.number=[],this.sign=1,this.rest=0,HR(s)){if(jR(s)){for((s.length&&s[0]==="-"||s[0]==="+")&&(this.sign=s[0]==="+"?1:-1,s.shift(0)),n=s.length-1;n>=0;n--)if(!this.addDigit(s[n]))return}else for((s=s.toString()).charAt(0)!=="-"&&s.charAt(0)!=="+"||(this.sign=s.charAt(0)==="+"?1:-1,s=s.substring(1)),n=s.length-1;n>=0;n--)if(!this.addDigit(parseInt(s.charAt(n),10)))return}else this.number=$R}ur.prototype.addDigit=function(s){return function(n){return/^\d$/.test(n)}(s)?(this.number.push(s),this):(this.number=$R,!1)},ur.prototype._compare=function(s){var n,c;if(!HR(s))return null;if(n=ur(s),this.sign!==n.sign)return this.sign;if(this.number.length>n.number.length)return this.sign;if(this.number.length<n.number.length)return-1*this.sign;for(c=this.number.length-1;c>=0;c--){if(this.number[c]>n.number[c])return this.sign;if(this.number[c]<n.number[c])return-1*this.sign}return 0},ur.prototype.gt=function(s){return this._compare(s)>0},ur.prototype.gte=function(s){return this._compare(s)>=0},ur.prototype.equals=function(s){return this._compare(s)===0},ur.prototype.lte=function(s){return this._compare(s)<=0},ur.prototype.lt=function(s){return this._compare(s)<0},ur.prototype.subtract=function(s){var n;return s===void 0?this:(n=ur(s),this.sign!==n.sign?(this.number=ur._add(this,n),this):(this.sign=this.lt(n)?-1:1,this.number=u2(this).lt(u2(n))?ur._subtract(n,this):ur._subtract(this,n),this))},ur._add=function(s,n){var c,d=0,f=Math.max(s.number.length,n.number.length);for(c=0;c<f||d>0;c++)s.number[c]=(d+=(s.number[c]||0)+(n.number[c]||0))%10,d=Math.floor(d/10);return s.number},ur._subtract=function(s,n){var c,d=0,f=s.number.length;for(c=0;c<f;c++)s.number[c]-=(n.number[c]||0)+d,s.number[c]+=10*(d=s.number[c]<0?1:0);for(c=0,f=s.number.length-1;s.number[f-c]===0&&f-c>0;)c++;return c>0&&s.number.splice(-c),s.number},ur.prototype.multiply=function(s){if(s===void 0)return this;var n,c,d=ur(s),f=0,m=[];if(this.isZero()||d.isZero())return ur(0);for(this.sign*=d.sign,n=0;n<this.number.length;n++)for(f=0,c=0;c<d.number.length||f>0;c++)m[n+c]=(f+=(m[n+c]||0)+this.number[n]*(d.number[c]||0))%10,f=Math.floor(f/10);return this.number=m,this},ur.prototype.divide=function(s){if(s===void 0)return this;var n,c,d=ur(s),f=[],m=ur(0);if(d.isZero())return this.number=dj,this;if(this.isZero())return this.rest=ur(0),this;if(this.sign*=d.sign,d.sign=1,d.number.length===1&&d.number[0]===1)return this.rest=ur(0),this;for(n=this.number.length-1;n>=0;n--)for(m.multiply(10),m.number[0]=this.number[n],f[n]=0;d.lte(m);)f[n]++,m.subtract(d);for(n=0,c=f.length-1;f[c-n]===0&&c-n>0;)n++;return n>0&&f.splice(-n),this.rest=m,this.number=f,this},ur.prototype.mod=function(s){return this.divide(s).rest},ur.prototype.isZero=function(){var s;for(s=0;s<this.number.length;s++)if(this.number[s]!==0)return!1;return!0},ur.prototype.toString=function(){var s,n="";if(typeof this.number=="string")return this.number;for(s=this.number.length-1;s>=0;s--)n+=this.number[s];return this.sign>0?n:"-"+n};var Rn,gu=Math.pow(2,32);function d2(s){for(var n=new Uint8Array(5),c=new DataView(n.buffer),d=0;(4294967168&s)!=0;)c.setUint8(d++,127&s|128),s>>>=7;return c.setUint8(d++,127&s),n.slice(0,d)}function pj(s){return typeof TextDecoder=="function"?new TextDecoder("utf-8").decode(s):function(c){for(var d="",f=0;f<c.length;){var m=c[f],y=0,M=0;if(m<=127?(y=0,M=255&m):m<=223?(y=1,M=31&m):m<=239?(y=2,M=15&m):m<=244&&(y=3,M=7&m),c.length-f-y>0)for(var S=0;S<y;)M=M<<6|63&(m=c[f+S+1]),S+=1;else M=65533,y=c.length-f;d+=String.fromCodePoint(M),f+=y+1}return d}(s)}class hj{constructor(n){this.offset=0,this.buffer=new Uint8Array(n),this.view=new DataView(n)}checkBufferBoundaryAccess(){return this.offset>=this.buffer.byteLength}length(){var n;return((n=this.view)===null||n===void 0?void 0:n.byteLength)||0}getBuffer(){return this.view.buffer}getOffset(){return this.offset}popRaw(n){try{var c=this.buffer.slice(this.offset,this.offset+n);return this.offset+=n,c}catch(d){throw new Error(`UnpackException raw ${d&&d.message}`)}}popByte(){try{var n=this.view.getUint8(this.offset);return this.offset+=1,n}catch(c){throw new Error(`UnpackException byte ${c&&c.message}`)}}popVarbin(){return this.popRaw(this.popVarInt())}popString(){try{return pj(this.popVarbin())}catch(n){throw new Error(`UnpackException string ${n&&n.message}`)}}popInt(){try{var n=this.view.getUint32(this.offset,!0);return this.offset+=4,n}catch(c){throw new Error(`UnpackException int ${c&&c.message}`)}}popVarInt(){var n=1,c=0,d=0,f=0;do if(c+=(127&(d=this.popByte()))*n,n*=128,(f+=1)>5)throw new Error("Variable length quantity is too long");while((128&d)!=0);return c}popLong(){try{var n=function(d,f=!1){var m=new DataView(d.buffer),[y,M]=f?[4,0]:[0,4],S=m.getUint32(y,f),E=m.getUint32(M,f);return S>0?S*gu+E:E}(this.buffer.slice(this.offset,this.offset+8),!0);return this.offset+=8,Number(n)}catch(c){throw new Error(`UnpackException long ${c&&c.message}`)}}popShort(){try{var n=this.view.getUint16(this.offset,!0);return this.offset+=2,n}catch(c){throw new Error(`UnpackException short ${c&&c.message}`)}}popBoolean(){return this.popByte()>0}toString(){return Array.from(new Uint8Array(this.buffer)).toString()}reset(){this.offset=0,this.buffer=null,this.view=null}}class Sh{constructor(n){this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.resCode=200,this.innerHeader=null,this.msgId=0,this.bodyArr=[],this.unpack=new hj(n)}reset(){this.innerHeader=null,this.bodyArr=[],this.unpack.reset()}getBodyDetail(){return this.bodyArr.join("")}unmarshalHeader(){var n=this._unmarshalHeader();this.packetLength=n.packetLength,this.serviceId=n.serviceId,this.commandId=n.commandId,this.serialId=n.serialId,this.tag=n.tag,this.resCode=n.resCode,n.serviceId===4&&[1,2,10,11].includes(n.commandId)&&(this.msgId=this.unmarshalLong(),this.innerHeader=this._unmarshalHeader())}_unmarshalHeader(){var n=this.unpack.popVarInt(),c=this.unpack.popByte(),d=this.unpack.popByte(),f=this.unpack.popShort(),m=this.unpack.popByte(),y=200;return this.hasRescode(m)&&(y=this.unpack.popShort()),{packetLength:n,serviceId:c,commandId:d,serialId:f,tag:m,resCode:y}}hasRescode(n){return((n=n||this.tag)&Sh.RES_CODE)!=0}getHeader(){return{packetLength:this.packetLength,sid:this.serviceId,cid:this.commandId,ser:this.serialId,code:this.resCode}}getInnerHeader(){return this.innerHeader?{sid:this.innerHeader.serviceId,cid:this.innerHeader.commandId}:null}unmarshalProperty(){var n=this.unpack.popVarInt(),c={};this.bodyArr.push(`
Property(${n}) {`);for(var d=0;d<n;d++){var f=this.unpack.popVarInt();this.bodyArr.push(`${f}:`);var m=this.unpack.popString();this.bodyArr.push(`"${m.length} ${this.unpack.getOffset()}",`),c[f]=m}return this.bodyArr.push("},"),c}unmarshalPropertyArray(){var n=this.unpack.popVarInt(),c=[];this.bodyArr.push(`
PropertyArray(${n}) [`);for(var d=0;d<n;d++)c.push(this.unmarshalProperty());return this.bodyArr.push("],"),c}unmarshalLong(){var n=this.unpack.popLong();return this.bodyArr.push(`
Long:${n}`),n}unmarshalLongArray(){var n=this.unpack.popVarInt(),c=[];this.bodyArr.push(`
LongArray ${n}:`);for(var d=0;d<n;d++){var f=this.unpack.popLong();this.bodyArr.push(`${f},`),c.push(f)}return c}unmarshalStrArray(){var n=this.unpack.popVarInt(),c=[];this.bodyArr.push(`
StrArray ${n}:`);for(var d=0;d<n;d++){var f=this.unpack.popString();this.bodyArr.push(`${f},`),c.push(f)}return c}unmarshalStrLongMap(){var n=this.unpack.popVarInt(),c={};this.bodyArr.push(`
StrLongMap ${n}:`);for(var d=0;d<n;d++){var f=this.unpack.popString();this.bodyArr.push(`${f},`);var m=this.unpack.popLong();this.bodyArr.push(`${m};`),c[f]=m}return c}unmarshalStrStrMap(){var n=this.unpack.popVarInt(),c={};this.bodyArr.push(`
StrStrMap ${n}:`);for(var d=0;d<n;d++){var f=this.unpack.popString();this.bodyArr.push(`${f},`);var m=this.unpack.popString();this.bodyArr.push(`${m};`),c[f]=m}return c}unmarshalLongLongMap(){var n=this.unpack.popVarInt(),c={};this.bodyArr.push(`
StrLongLongMap ${n}:`);for(var d=0;d<n;d++){var f=this.unpack.popLong();this.bodyArr.push(`${f},`);var m=this.unpack.popLong();this.bodyArr.push(`${m};`),c[f]=m}return{m_map:c}}unmarshalKVArray(){var n=this.unpack.popVarInt(),c=[];this.bodyArr.push(`
KVArray ${n}:`);for(var d=0;d<n;d++)c.push(this.unmarshalStrStrMap());return c}unmarshal(n){var c=Object.assign(Object.assign({},this.getHeader()),{r:[]});if(this.innerHeader&&(c.r[0]=this.msgId,c.r[1]={body:[],headerPacket:this.getInnerHeader()}),![200,406,808,810,7101].includes(c.code))return JSON.stringify(c);if(this.packetLength>0&&this.packetLength>this.unpack.length())throw new Error(`UnpackException packetLength(${this.packetLength}) greater than bufferLength(${this.unpack.length()})`);var d=[];return n&&n.forEach(f=>{if(!this.unpack.checkBufferBoundaryAccess())switch(f.type){case"PropertyArray":d.push(this.unmarshalPropertyArray());break;case"Property":d.push(this.unmarshalProperty());break;case"Byte":d.push(this.unpack.popByte());break;case"Int":d.push(this.unpack.popInt());break;case"Bool":d.push(this.unpack.popBoolean());break;case"Long":d.push(this.unmarshalLong());break;case"LongArray":d.push(this.unmarshalLongArray());break;case"String":d.push(this.unpack.popString());break;case"StrArray":d.push(this.unmarshalStrArray());break;case"StrStrMap":d.push(this.unmarshalStrStrMap());break;case"StrLongMap":d.push(this.unmarshalStrLongMap());break;case"LongLongMap":d.push(this.unmarshalLongLongMap());break;case"KVArray":d.push(this.unmarshalKVArray())}}),this.innerHeader?c.r[1].body=d:c.r=d,JSON.stringify(c)}}Sh.RES_CODE=2;class fj{constructor(){this.offset=0,this.pageSize=1024,this.capacity=1048576,this.buffer=new Uint8Array(this.pageSize),this.view=new DataView(this.buffer.buffer)}reset(){this.offset=0,this.buffer=null,this.view=null}size(){return this.offset}getBuffer(){return this.buffer.slice(0,this.offset).buffer}ensureCapacity(n){var c=this.offset+n;if(c>this.capacity)throw new Error("PackException over limit");if(c>this.buffer.byteLength){var d=Math.ceil(c/this.pageSize)*this.pageSize,f=new Uint8Array(d);f.set(this.buffer),this.buffer=f,this.view=new DataView(this.buffer.buffer)}}putRaw(n){this.ensureCapacity(n.length);try{this.buffer.set(n,this.offset),this.offset+=n.length}catch{throw new Error("PackException raw")}}putByte(n){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,n)}catch{throw new Error("PackException byte")}}putString(n){try{var c=function(f){if(typeof TextEncoder=="function")return new TextEncoder().encode(f);var m=function(M){for(var S=[],E=M.length,b=0;b<E;){var R=M.codePointAt(b),x=0,L=0;for(R<=127?(x=0,L=0):R<=2047?(x=6,L=192):R<=65535?(x=12,L=224):R<=2097151&&(x=18,L=240),S.push(L|R>>x),x-=6;x>=0;)S.push(128|R>>x&63),x-=6;b+=R>=65536?2:1}return S}(f);return new Uint8Array(m)}(n);this.putVarbin(c)}catch{throw new Error("PackException string")}}putInt(n){this.ensureCapacity(4);try{this.view.setInt32(this.offset,n,!0),this.offset+=4}catch{throw new Error("PackException int")}}putVarInt(n){var c=d2(n);this.putRaw(c)}putBoolean(n){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,n?1:0)}catch{throw new Error("PackException boolean")}}putLong(n){this.ensureCapacity(8);try{var c=function(f,m=!1){var y=new Uint8Array(8),M=new DataView(y.buffer),S=Number(f>gu-1?f/gu:0),E=Number(4294967295&f),[b,R]=m?[4,0]:[0,4];return M.setUint32(b,S,m),M.setUint32(R,E,m),y}(n,!0);this.buffer.set(c,this.offset),this.offset+=8}catch{throw new Error("PackException long")}}putStringAsLong(n){this.ensureCapacity(8);try{var c=function(f,m=!1){var y=new Uint8Array(8),M=new DataView(y.buffer),S=ur(f).divide(gu).number.reverse().join(""),E=ur(f).mod(gu).number.reverse().join(""),b=Number(S),R=Number(E),[x,L]=m?[4,0]:[0,4];return M.setUint32(x,b,m),M.setUint32(L,R,m),y}(n,!0);this.buffer.set(c,this.offset),this.offset+=8}catch{throw new Error("PackException stringAsLong")}}putShort(n){this.ensureCapacity(2);try{this.view.setInt16(this.offset,n,!0),this.offset+=2}catch{throw new Error("PackException short")}}putVarbin(n){if(!n)return this.ensureCapacity(1),this.putVarInt(0);if(n.byteLength>Math.pow(2,31)-2)throw new Error("PackException varbin. too long");var c=d2(n.length);this.ensureCapacity(c.length+n.length);try{this.buffer.set(c,this.offset),this.offset+=c.length,this.buffer.set(n,this.offset),this.offset+=n.length}catch{throw new Error("PackException varbin")}}}function Ra(s){if(typeof s!="number"){if(s==null)return!1;s=Number(s)}if(isNaN(s))throw new Error("Number type conversion error");return!0}function kc(s){return s==null}class mj{constructor(n,c,d){this.pack=new fj,this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.serviceId=n,this.commandId=c,this.serialId=d}marshalHeader(){this.pack.putVarInt(this.packetLength),this.pack.putByte(this.serviceId),this.pack.putByte(this.commandId),this.pack.putShort(this.serialId),this.pack.putByte(this.tag)}marshalProperty(n){var c=Object.keys(n).filter(d=>!kc(d));this.pack.putVarInt(c.length),c.forEach(d=>{this.pack.putVarInt(Number(d)),Array.isArray(n[d])||Object.prototype.toString.call(n[d])==="[object Object]"?this.pack.putString(JSON.stringify(n[d])):this.pack.putString(String(n[d]))})}marshalPropertyArray(n){var c=n.length;this.pack.putVarInt(c),n.forEach(d=>{this.marshalProperty(d==null?void 0:d.v)})}marshalStrArray(n){var c=n.filter(f=>!kc(f)),d=c.length;this.pack.putVarInt(d),c.forEach(f=>{this.pack.putString(String(f))})}marshalLongArray(n){var c=n.filter(f=>Ra(f)),d=c.length;this.pack.putVarInt(d),c.forEach(f=>{this.putLong(f)})}marshalStrStrMap(n){var c=Object.keys(n).filter(d=>!kc(n[d])&&!kc(d));this.pack.putVarInt(c.length),c.forEach(d=>{this.pack.putString(String(d)),this.pack.putString(String(n[d]))})}marshalStrLongMap(n){var c=Object.keys(n).filter(d=>Ra(n[d])&&!kc(d));this.pack.putVarInt(c.length),c.forEach(d=>{this.pack.putString(String(d)),this.putLong(n[d])})}marshalLongLongMap(n){var c=Object.keys(n).filter(d=>{var f=Number(d);return Ra(f)&&Ra(n[f])});this.pack.putVarInt(c.length),c.forEach(d=>{var f=Number(d);this.putLong(f),this.putLong(n[f])})}marshalKVArray(n){var c=n.length;this.pack.putVarInt(c),n.forEach(d=>{this.marshalStrStrMap(d)})}putLong(n){typeof n=="string"&&n.length>15?this.pack.putStringAsLong(n):this.pack.putLong(Number(n))}marshal(n,c){return this.marshalHeader(),c&&c.forEach((d,f)=>{var m,y=d.type,M=(m=n[f])===null||m===void 0?void 0:m.v;if(!kc(M))switch(y){case"PropertyArray":this.marshalPropertyArray(M);break;case"Property":this.marshalProperty(M);break;case"Byte":if(!Ra(M))return;this.pack.putByte(Number(M));break;case"Int":if(!Ra(M))return;this.pack.putInt(Number(M));break;case"Bool":M==="false"?M=!1:M==="true"&&(M=!0),this.pack.putBoolean(M);break;case"Long":if(!Ra(M))return;this.putLong(M);break;case"LongArray":this.marshalLongArray(M);break;case"String":this.pack.putString(String(M));break;case"StrArray":this.marshalStrArray(M);break;case"StrStrMap":this.marshalStrStrMap(M);break;case"StrLongMap":this.marshalStrLongMap(M);break;case"LongLongMap":this.marshalLongLongMap(M);break;case"KVArray":this.marshalKVArray(M)}}),this.pack.getBuffer()}reset(){this.pack.reset()}}class gj extends ju{constructor(n,c,d){super(),this.websocket=null,this.socketConnectTimer=0,this.linkSSL=!0,this.url="",this.core=n,this.url=c,this.linkSSL=d,this.status="disconnected",this.logger=n.logger,this.connect()}connect(){this.status!=="connecting"&&this.status!=="connected"?(this.status="connecting",this._createWebsocket(`${this.linkSSL?"wss":"ws"}://${this.url}/websocket`)):this.logger.warn("imsocket::socket is connecting or connected",this.status)}close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.close()}catch(n){this.logger.warn("imsocket::attempt to close websocket error",n)}this.clean(),this.emit("disconnect")}}clean(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)}onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)}_createWebsocket(n){this.socketConnectTimer=setTimeout(()=>{this.logger.error("imsocket::Websocket connect timeout. url: ",n),this.emit("connectFailed",new Gt({code:Kr(this.core,"options.apiVersion")==="v2"?rt.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:`imsocket::Websocket connect timeout. url: ${n}`}}))},this.core.options.socketConnectTimeout||8e3),this.socketUrl=n,this.websocket=new zt.WebSocket(n),this.websocket.binaryType="arraybuffer",this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onclose=c=>{c=c||{},this.logger.log(`imsocket::Websocket onclose done ${c.wasClean}/${c.code}/${c.reason}`),this.status==="connected"?(this.clean(),this.emit("disconnect")):(this.clean(),this.emit("connectFailed",new Gt({code:Kr(this.core,"options.apiVersion")==="v2"?rt.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onclose done"}})))},this.websocket.onerror=c=>{this.logger.error("imsocket::Websocket onerror",c),this.status==="connected"?(this.clean(),this.emit("disconnect")):(this.clean(),this.emit("connectFailed",new Gt({code:Kr(this.core,"options.apiVersion")==="v2"?rt.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onerror."}})))},this.websocket.onopen=()=>{this.onConnect()}}onMessage(n){if(n.data){var c=new Sh(n.data),d={sid:-1,cid:-1,ser:-1,packetLength:-1},f=null;try{c.unmarshalHeader(),d=c.getHeader(),f=c.getInnerHeader()}catch(L){this.reportBinaryError({err:L,sid:f?f.sid:d==null?void 0:d.sid,cid:f?f.cid:d==null?void 0:d.cid,rawBuf:n.data,type:"decode"})}var m=f?f.sid:d.sid,y=f?f.cid:d.cid,M=`${m}_${y}`,S=Fc[M];if(S&&S.length>0){var E,b=S[0].config;try{E=c.unmarshal(b.response)}catch(L){var R=c.getBodyDetail();this.reportBinaryError({err:L,rawBuf:n.data,sid:m,cid:y,parseDetail:R,type:"decode"}),c.reset();var x=Object.assign(Object.assign({},d),{sid:m,cid:y,code:rt.V2NIM_ERROR_CODE_UNPACK_ERROR});return this.logger.error(`imsocket::onMessage "${x.sid}_${x.cid}", ser ${x.ser}, packetLength ${x.packetLength} unmarshal error. ${R} 
`,L),void this.emit("message",JSON.stringify(x))}this.emit("message",E)}else this.core.logger.warn("imsocket::onMessage cmd not found",M);c.reset()}}send(n,c,d,f,m){var y,M,S=new mj(n,c,d),E=xM[f],b="";try{b=JSON.stringify(m),M=S.marshal(JSON.parse(b),E.params)}catch(R){throw this.reportBinaryError({err:R,sid:n,cid:c,rawStr:b,type:"encode"}),S.reset(),new Gt({code:rt.V2NIM_ERROR_CODE_PACK_ERROR,detail:{reason:`${n}-${c}, ser ${d} marshal error`,rawError:R}})}(y=this.websocket)===null||y===void 0||y.send(M),S.reset()}reportBinaryError(n){var c,d,f,{err:m,rawStr:y,sid:M,cid:S,type:E,parseDetail:b}=n,R=n.rawBuf;if(R){try{f=function(q){if(typeof btoa!="function")return"";for(var D="",G=new Uint8Array(q),J=G.byteLength,ne=0;ne<J;ne++)D+=String.fromCharCode(G[ne]);return G=null,btoa(D)}(R)}catch(L){f=`reportBinaryError::arrayBufferToBase64 parsing failed, error: ${L==null?void 0:L.message}, sid: ${M}, cid: ${S}`,this.core.logger.error(f)}R=null}this.core.reporter.reportTraceStart("exceptions",{user_id:(c=this.core.auth)===null||c===void 0?void 0:c.account,trace_id:(d=this.core.clientSocket.socket)===null||d===void 0?void 0:d.sessionId,start_time:Date.now(),action:2,exception_service:9});var x=m?(`${m.message};;;`||`${m.code};;;`)+(b?`parseDetail: ${b};;;`:"")+(y?` rawStr: ${y}`:"")+(f?` rawBuf: ${f}`:""):"";this.core.reporter.reportTraceUpdateV2("exceptions",{code:E==="encode"?rt.V2NIM_ERROR_CODE_PACK_ERROR:rt.V2NIM_ERROR_CODE_UNPACK_ERROR,description:x,operation_type:E==="encode"?3:4,target:`${M}-${S}`},{asyncParams:zt.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)}}(function(s){s[s.ACTIVE=1]="ACTIVE",s[s.KICKED=2]="KICKED",s[s.OFFLINE=3]="OFFLINE"})(Rn||(Rn={}));class vj{constructor(n){this.isReconnect=!1,this.packetTimeout=8e3,this.linkSSL=!0,this.packetSer=1,this.backoff=new LM({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Map,this.pingTimer=0,this.hasNetworkListener=!1,this.core=n,this.auth=n.auth,this.logger=n.logger,this.reporter=n.reporter,this.timerManager=n.timerManager,this.eventBus=n.eventBus,this.setListener()}setListener(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.isReconnect=!0})}setSessionId(n){this.socket&&(this.socket.sessionId=n)}setLinkSSL(n){this.linkSSL=n}connect(n,c=!1){var d,f;return tr(this,void 0,void 0,function*(){this.isReconnect=c;var m=this.core.auth.getConnectStatus();if(m===1){var y=`clientSocket::connect status is ${m}, and would not repeat connect`,M=new Gt({code:rt.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:y}});return this.logger.warn(y),Promise.reject(M)}this.auth.lifeCycle.processEvent("connect");try{yield this.auth.doLoginStepsManager.add(this.doConnect(n)),this.logger.log(`clientSocketV2:: connect success with link url: ${n}, isReconnect: ${c}`),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:n,code:200,mixlink:!0,succeed:!0},{asyncParams:zt.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc")}catch(E){var S=E;throw this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:n,code:S.code||0,description:`connectFailed:${S.message}`,mixlink:!0,succeed:!1},{asyncParams:zt.net.getNetworkStatus()}),S.code===rt.V2NIM_ERROR_CODE_CANCELLED||S.code===rt.V2NIM_ERROR_CODE_TIMEOUT?((d=this.socket)===null||d===void 0||d.close(),(f=this.socket)===null||f===void 0||f.removeAllListeners(),this.socket=void 0,E):(this.logger.warn(`clientSocketV2::connect failed with link url: ${n}`,S),this.auth.lifeCycle.processEvent("connectFail",S),E)}})}doConnect(n){var c=!1;return new Promise((d,f)=>{this.socket=new gj(this.core,n,this.linkSSL),this.socket.on("connect",()=>{this.logger.log("clientSocketV2::socket on connect",n),this.core.reporterHookLinkKeep.start(),this.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:n}),c=!0,d()}),this.socket.on("message",this.onMessage.bind(this)),this.socket.on("disconnect",m=>tr(this,void 0,void 0,function*(){c=!0,this.logger.log(`clientSocketV2::socket on disconnect ${n}`,m),yield this.core.reporterHookLinkKeep.update({code:(m==null?void 0:m.code)||0,description:(m==null?void 0:m.reason)||"socket on disconnect",operation_type:1,target:n}),this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Rn.OFFLINE,"SocketOnDisconnect")})),this.socket.on("connectFailed",m=>{c?this.ping():(this.logger.error(`clientSocketV2::connectFailed:${n}, reason:${m&&m.message}`),this.cleanSocket()),c=!0,f(m)})})}cleanSocket(){this.socket&&(typeof this.socket.removeAllListeners=="function"&&this.socket.removeAllListeners(),typeof this.socket.close=="function"&&this.socket.close(),this.socket=void 0)}resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()}doDisconnect(n,c){if(this.logger.log(`clientSocketV2::doDisconnect: type ${n}, reason `,c),this.core.auth.getConnectStatus()!==0){var d={1:"close",2:"kicked",3:"broken"}[n]||"";this.markAllCmdInvaild(new Gt({code:rt.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:d}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),n===Rn.ACTIVE||n===Rn.KICKED?this.destroyOnlineListener():n===Rn.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new Gt({code:rt.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log(`clientSocketV2::doDisconnect: pending reconnect ${this.isReconnect}`),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")}sendCmd(n,c,d){var f=this.core.auth.getLoginStatus(),m={cmd:n};if(f!==1&&!["v2Login","login","chatroomLogin","v2ChatroomLogin"].includes(n))return this.logger.warn(`clientSocketV2::NIM login status is ${f}, so can not sendCmd ${n}`),Promise.reject(new Gt({code:rt.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:Object.assign({reason:"Can not sendCmd due to no logined"},m)}));var y=n!=="heartbeat",M=y?this.packetSer++:0,S=BR(n,M,this.logger,c);if(!S){var E=new Gt({code:rt.V2NIM_ERROR_CODE_INTERNAL,detail:Object.assign(Object.assign({},m),{reason:`SendCmd::createCmd error: ${M} ${n}`})});return this.logger.error(E),Promise.reject(E)}var{packet:b,hasPacketResponse:R,hasPacketTimer:x}=S,L=JSON.stringify(b);y&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::sendCmd: ${b.SID}_${b.CID},${n},ser:${M}`,L):this.logger.log(`clientSocketV2::sendCmd: ${b.SID}_${b.CID},${n},ser:${M}`));var q=new Date().getTime();return new Promise((D,G)=>{R&&this.sendingCmdMap.set(M,{cmd:n,params:c,callback:[D,G],timer:x?setTimeout(()=>{var ne=new Gt({code:rt.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:Object.assign({ser:M,reason:`Packet Timeout: ser ${M} cmd ${n}`,timetag:new Date().getTime()},m)});this.markCmdInvalid(M,ne,n)},d&&d.timeout?d.timeout:this.packetTimeout):null});try{this.socket.send(b.SID,b.CID,M,n,b.Q),R||D(b)}catch(ne){var J=new Gt({code:rt.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:Object.assign({ser:M,reason:"Unable to send packet"+(ne&&ne.message?": "+ne.message:""),timetag:new Date().getTime(),rawError:ne},m)});this.markCmdInvalid(M,J,n),G(J)}}).catch(D=>tr(this,void 0,void 0,function*(){var G=D;return[rt.V2NIM_ERROR_CODE_DISCONNECT,rt.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,rt.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED].includes(G.code)&&this.reportSendCmdFailed(G,{sid:b.SID,cid:b.CID,ser:M},q),Promise.reject(G)}))}reportSendCmdFailed(n,c,d){var f;this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:(f=this.socket)===null||f===void 0?void 0:f.sessionId,start_time:d,action:2,exception_service:6});var m=Kr(n,"detail.disconnect_reason")||"",y=n.code===rt.V2NIM_ERROR_CODE_DISCONNECT?JSON.stringify({disconnect_reason:m}):n.detail.reason;this.reporter.reportTraceUpdateV2("exceptions",{code:n.code,description:y,operation_type:1,target:`${c.sid}-${c.cid}`,context:`${c.ser}`},{asyncParams:zt.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1)}onMessage(n){var c=qR(n,this.logger);if(c){var d=c[0],f=d.raw.ser;for(var m of(d.cmd!=="heartbeat"&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::recvCmd ${d.raw.sid}_${d.raw.cid},${d.cmd},ser:${f}`,n):this.logger.log(`clientSocketV2::recvCmd ${d.raw.sid}_${d.raw.cid},${d.cmd},ser:${f},code:${d.raw.code}`)),c)){if(m.error&&this.logger.error("clientSocketV2::onMessage packet error",`${m.raw.sid}_${m.raw.cid}, ser:${f},`,m.error),m.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",`${m.raw.sid}_${m.raw.cid}, ser:${f}`);this.packetHandler(m)}}}packetHandler(n){var c,d,f,m;if(n){var y=n.raw.ser,M=this.sendingCmdMap.get(y);if(M&&M.cmd===n.cmd){var{callback:S,timer:E,params:b}=M;if(clearTimeout(E),n.params=b,this.sendingCmdMap.delete(y),n.cmd==="heartbeat")return void S[0]();var R=(d=(c=this.core[n.service])===null||c===void 0?void 0:c.process)===null||d===void 0?void 0:d.call(c,n);R&&typeof R.then=="function"?R.then(L=>{S[0](L)}).catch(L=>{S[1](L)}):(this.logger.log("clientSocketV2::handlerFn without promise",n.service,n.cmd),S[0](n))}else{var x=(m=(f=this.core[n.service])===null||f===void 0?void 0:f.process)===null||m===void 0?void 0:m.call(f,n);x&&typeof x.then=="function"&&x.catch(L=>{this.logger.error("clientSocketV2::no obj cache, no process handler",L)})}}}markCmdInvalid(n,c,d){var f=this.sendingCmdMap.get(n);if(f){var{callback:m,timer:y}=f;y&&clearTimeout(y),this.sendingCmdMap.delete(n),this.logger.warn(`clientSocketV2::packet ${n}, ${d} is invalid:`,c),m[1](c)}}markAllCmdInvaild(n){this.logger.log("markAllCmdInvaild",n),this.sendingCmdMap.forEach(c=>{var{callback:d,timer:f,cmd:m}=c;this.logger.log(`clientSocketV2::markAllCmdInvaild:cmd ${m}`),f&&clearTimeout(f),d[1](n)}),this.sendingCmdMap.clear()}ping(){var n;return tr(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);try{yield this.sendCmd("heartbeat")}catch(c){if(c.code===rt.V2NIM_ERROR_CODE_DISCONNECT)return;if(yield this.testHeartBeat5Timeout())return yield this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:(n=this.socket)===null||n===void 0?void 0:n.url}),this.core.reporterHookLinkKeep.end(!0),void this.doDisconnect(Rn.OFFLINE,"PingError")}this.pingTimer=setTimeout(()=>{this.ping()},3e4)})}testHeartBeat5Timeout(){return tr(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);for(var n=0;n<5;n++)try{return yield this.sendCmd("heartbeat",{},{timeout:3e3}),!1}catch{this.logger.log(`clientSocketV2::test heartbeat ${n} Timeout`)}return!0})}initOnlineListener(){this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,zt.net.onNetworkStatusChange(n=>{this.logger.log("clientSocketV2::onlineListener:network change",n);var c=this.auth.getConnectStatus(),d=this.auth.getLoginStatus();n.isConnected&&d===1?this.ping():n.isConnected&&c===3?(this.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),this.auth.reconnect.clearReconnectTimer(),this.auth.reconnect.doReLogin()):n.isConnected||this.doDisconnect(Rn.OFFLINE,"OfflineListener")}))}destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),this.hasNetworkListener=!1}}var Fo,p2=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],h2=["transport not supported","client not handshaken","unauthorized"],yj=["reconnect"];class _j extends ju{constructor(n,c,d){super(),this.websocket=null,this.socketConnectTimer=0,this.url="",this.linkSSL=!0,this.core=n,this.url=c,this.linkSSL=d,this.status="disconnected",this.logger=n.logger,this.connect()}connect(){this.status!=="connecting"&&this.status!=="connected"?(this.status="connecting",this.core.adapters.request(`${this.linkSSL?"https":"http"}://${this.url}/socket.io/1/?t=${Date.now()}`,{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then(n=>{if(this.status==="connecting"){var[c,d]=n.data.split(":");return this.sessionId=c,this.logger.log(`imsocket::XHR success. status ${this.status}, ${this.status==="connecting"?"continue websocket connection":"stop websocket connection"}`),this._createWebsocket(`${this.linkSSL?"wss":"ws"}://${this.url}/socket.io/1/websocket/${c}`)}}).catch(n=>{if(this.status==="connecting"){var c=`imsocket::XHR fail. raw message: "${(n=n||{}).message}", code: "${n.code}"`,d=n.code;d=Kr(this.core,"options.apiVersion")==="v2"?n.code===rt.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?rt.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:rt.V2NIM_ERROR_CODE_CONNECT_FAILED:n.code===408?408:415;var f=new Gt({code:d,detail:{reason:c,rawError:n}});this.logger.error(c),this.status="disconnected",this.emit("handshakeFailed",f)}})):this.logger.warn("imsocket::socket is connecting or connected",this.status)}close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(n){this.logger.warn("imsocket::attempt to send encodePacket error",n)}try{this.websocket.close()}catch(n){this.logger.warn("imsocket::attempt to close websocket error",n)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}}clean(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)}onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)}_createWebsocket(n){this.socketConnectTimer=setTimeout(()=>{this.logger.error("imsocket::Websocket connect timeout. url: ",this.socketUrl),this.emit("handshakeFailed",new Gt({code:Kr(this.core,"options.apiVersion")==="v2"?rt.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:`imsocket::Websocket connect timeout. url: ${this.socketUrl}`}}))},this.core.options.socketConnectTimeout||8e3),this.socketUrl=n,this.websocket=new zt.WebSocket(n),this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onclose=c=>{c=c||{},this.logger.log(`imsocket::Websocket onclose done ${c.wasClean}/${c.code}/${c.reason}`),this.clean(),this.emit("disconnect",{code:c.code||0,reason:c.reason})},this.websocket.onerror=c=>{this.logger.error("imsocket::Websocket onerror",c),this.core.status==="logined"&&this.core.clientSocket.ping()}}onMessage(n){var c,d=this.decodePacket(n.data);if(d)switch(d.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",d.data);break;case"event":d.name&&this.emit(d.name,d.args);break;case"error":d.reason==="unauthorized"?this.emit("connect_failed",d.reason):this.emit("error",d.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new Gt({code:Kr(this.core,"options.apiVersion")==="v2"?rt.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:`imsocket::Websocket connect failed, onMessage socket error. url: ${this.socketUrl}`}}));break;case"heartbeat":(c=this.websocket)===null||c===void 0||c.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",d.type)}}encodePacket(n){var c,d,{type:f,id:m="",endpoint:y="",ack:M}=n,S=null;if(!f)return"";switch(f){case"error":c=n.reason?h2.indexOf(n.reason):"",d=n.advice?yj.indexOf(n.advice):"",c===""&&d===""||(S=c+(d!==""?"+"+d:""));break;case"message":n.data!==""&&(S=n.data);break;case"event":c={name:n.name},c=n.args&&n.args.length?{name:n.name,args:n.args}:{name:n.name},S=JSON.stringify(c);break;case"json":S=JSON.stringify(n.data);break;case"connect":n.qs&&(S=n.qs);break;case"ack":S=n.ackId+(n.args&&n.args.length?"+"+JSON.stringify(n.args):"")}var E=[p2.indexOf(f),m+(M==="data"?"+":""),y];return S!=null&&E.push(S),E.join(":")}decodePacket(n){if(n)if(n.charAt(0)!=""){var c=n.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(c){var d,[,f,m,y,M,S]=c,E={type:p2[+f],endpoint:M};switch(m&&(E.id=m,E.ack=!y||"data"),E.type){case"error":d=S.split("+"),E.reason=h2[+d[0]]||"";break;case"message":E.data=S||"";break;case"connect":E.qs=S||"";break;case"event":try{var b=JSON.parse(S);E.name=b.name,E.args=b.args}catch(R){this.logger.error("imsocket::parseData::type::event error",R)}E.args=E.args||[];break;case"json":try{E.data=JSON.parse(S)}catch(R){this.logger.error("imsocket::parseData::type::json error",R)}break;case"ack":if((d=S.match(/^([0-9]+)(\+)?(.*)/))&&(E.ackId=d[1],E.args=[],d[3]))try{E.args=d[3]?JSON.parse(d[3]):[]}catch(R){this.logger.error("imsocket::parseData::type::ack error",R)}}return E}}else this.logger.error("imsocket::unrecognize dataStr",n.slice(0,20))}send(n){var c,d={data:n,type:"message",endpoint:""};(c=this.websocket)===null||c===void 0||c.send(this.encodePacket(d))}}(function(s){s[s.ACTIVE=1]="ACTIVE",s[s.KICKED=2]="KICKED",s[s.OFFLINE=3]="OFFLINE"})(Fo||(Fo={}));class Mj{constructor(n){this.isReconnect=!1,this.packetTimeout=8e3,this.linkSSL=!0,this.packetSer=1,this.backoff=new LM({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Map,this.pingTimer=0,this.hasNetworkListener=!1,this.core=n,this.auth=n.auth,this.logger=n.logger,this.reporter=n.reporter,this.timerManager=n.timerManager,this.eventBus=n.eventBus,this.setListener()}setListener(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.isReconnect=!0})}setSessionId(n){this.socket&&(this.socket.sessionId=n)}setLinkSSL(n){this.linkSSL=n}connect(n,c=!1){var d,f;return tr(this,void 0,void 0,function*(){this.isReconnect=c;var m=this.core.auth.getConnectStatus();if(m===1){var y=`clientSocket::connect status is ${m}, and would not repeat connect`,M=new Gt({code:rt.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:y}});return this.logger.warn(y),Promise.reject(M)}this.auth.lifeCycle.processEvent("connect");try{yield this.auth.doLoginStepsManager.add(this.doConnect(n)),this.logger.log(`clientSocketV2:: connect success with link url: ${n}, isReconnect: ${c}`),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:n,code:200,mixlink:!0,succeed:!0},{asyncParams:zt.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc")}catch(E){var S=E;throw this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:n,code:S.code||0,description:`connectFailed:${S.message}`,mixlink:!0,succeed:!1},{asyncParams:zt.net.getNetworkStatus()}),S.code===rt.V2NIM_ERROR_CODE_CANCELLED||S.code===rt.V2NIM_ERROR_CODE_TIMEOUT?((d=this.socket)===null||d===void 0||d.close(),(f=this.socket)===null||f===void 0||f.removeAllListeners(),this.socket=void 0,E):(this.logger.warn(`clientSocketV2::connect failed with link url: ${n}`,S),this.auth.lifeCycle.processEvent("connectFail",S),E)}})}doConnect(n){var c=!1;return new Promise((d,f)=>{this.socket=new _j(this.core,n,this.linkSSL),this.socket.on("connect",()=>{this.logger.log("clientSocketV2::socket on connect",n),this.core.reporterHookLinkKeep.start(),this.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:n}),c=!0,d()}),this.socket.on("message",this.onMessage.bind(this)),this.socket.on("disconnect",m=>tr(this,void 0,void 0,function*(){c=!0,this.logger.log("clientSocketV2::socket on disconnect",m),yield this.core.reporterHookLinkKeep.update({code:(m==null?void 0:m.code)||0,description:(m==null?void 0:m.reason)||"socket on disconnect",operation_type:1,target:n}),this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Fo.OFFLINE,"SocketOnDisconnect")})),this.socket.on("handshakeFailed",m=>{c?this.ping():(this.logger.error(`clientSocketV2::handshake failed: "${m&&m.message}"`),this.cleanSocket()),c=!0,f(m)})})}cleanSocket(){this.socket&&(typeof this.socket.removeAllListeners=="function"&&this.socket.removeAllListeners(),typeof this.socket.close=="function"&&this.socket.close(),this.socket=void 0)}resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()}doDisconnect(n,c){if(this.logger.log(`clientSocketV2::doDisconnect: type ${n}, reason `,c),this.core.auth.getConnectStatus()!==0){var d={1:"close",2:"kicked",3:"broken"}[n]||"";this.markAllCmdInvaild(new Gt({code:rt.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:d}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),n===Fo.ACTIVE||n===Fo.KICKED?this.destroyOnlineListener():n===Fo.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new Gt({code:rt.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log(`clientSocketV2::doDisconnect: pending reconnect ${this.isReconnect}`),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")}sendCmd(n,c,d){var f=this.core.auth.getLoginStatus(),m={cmd:n};if(f!==1&&!["v2Login","login","chatroomLogin","v2ChatroomLogin"].includes(n))return this.logger.warn(`clientSocketV2::NIM login status is ${f}, so can not sendCmd ${n}`),Promise.reject(new Gt({code:rt.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:Object.assign({reason:"Can not sendCmd due to no logined"},m)}));var y=n!=="heartbeat",M=y?this.packetSer++:0,S=BR(n,M,this.logger,c);if(!S){var E=new Gt({code:rt.V2NIM_ERROR_CODE_INTERNAL,detail:Object.assign(Object.assign({},m),{reason:`SendCmd::createCmd error: ${M} ${n}`})});return this.logger.error(E),Promise.reject(E)}var{packet:b,hasPacketResponse:R,hasPacketTimer:x}=S,L=JSON.stringify(b);y&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::sendCmd: ${b.SID}_${b.CID},${n},ser:${M}`,L):this.logger.log(`clientSocketV2::sendCmd: ${b.SID}_${b.CID},${n},ser:${M}`));var q=new Date().getTime();return new Promise((D,G)=>{R&&this.sendingCmdMap.set(M,{cmd:n,params:c,callback:[D,G],timer:x?setTimeout(()=>{var ne=new Gt({code:rt.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:Object.assign({ser:M,reason:`Packet Timeout: ser ${M} cmd ${n}`,timetag:new Date().getTime()},m)});this.markCmdInvalid(M,ne,n)},d&&d.timeout?d.timeout:this.packetTimeout):null});try{this.socket.send(L),R||D(b)}catch(ne){var J=new Gt({code:rt.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:Object.assign({ser:M,reason:"Unable to send packet"+(ne&&ne.message?": "+ne.message:""),timetag:new Date().getTime(),rawError:ne},m)});this.markCmdInvalid(M,J,n),G(J)}}).catch(D=>tr(this,void 0,void 0,function*(){var G,J=D;if(![rt.V2NIM_ERROR_CODE_DISCONNECT,rt.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,rt.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED].includes(J.code))return Promise.reject(J);this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:(G=this.socket)===null||G===void 0?void 0:G.sessionId,start_time:q,action:2,exception_service:6});var ne=Kr(J,"detail.disconnect_reason")||"",z=J.code===rt.V2NIM_ERROR_CODE_DISCONNECT?JSON.stringify({disconnect_reason:ne}):J.detail.reason;return this.reporter.reportTraceUpdateV2("exceptions",{code:J.code,description:z,operation_type:1,target:`${b.SID}-${b.CID}`,context:`${b.SER}`},{asyncParams:zt.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),Promise.reject(J)}))}onMessage(n){var c=qR(n,this.logger);if(c)for(var d of c){var f=d.raw.ser;if(d.error&&this.logger.error("clientSocketV2::onMessage packet error",`${d.raw.sid}_${d.raw.cid}, ser:${f},`,d.error),d.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",`${d.raw.sid}_${d.raw.cid}, ser:${f}`);d.cmd!=="heartbeat"&&(this.logger.getDebugMode()?this.logger.debug(`clientSocketV2::recvCmd ${d.raw.sid}_${d.raw.cid},${d.cmd},ser:${f}`,d.content):this.logger.log(`clientSocketV2::recvCmd ${d.raw.sid}_${d.raw.cid},${d.cmd},ser:${f};code:${d.raw.code}`)),this.packetHandler(d)}}packetHandler(n){var c,d,f,m;if(n){var y=n.raw.ser,M=this.sendingCmdMap.get(y);if(M&&M.cmd===n.cmd){var{callback:S,timer:E,params:b}=M;if(clearTimeout(E),n.params=b,this.sendingCmdMap.delete(y),n.cmd==="heartbeat")return void S[0]();var R=(d=(c=this.core[n.service])===null||c===void 0?void 0:c.process)===null||d===void 0?void 0:d.call(c,n);R&&typeof R.then=="function"?R.then(L=>{S[0](L)}).catch(L=>{S[1](L)}):(this.logger.log("clientSocketV2::handlerFn without promise",n.service,n.cmd),S[0](n))}else{var x=(m=(f=this.core[n.service])===null||f===void 0?void 0:f.process)===null||m===void 0?void 0:m.call(f,n);x&&typeof x.then=="function"&&x.catch(L=>{this.logger.error("clientSocketV2::no obj cache, no process handler",L)})}}}markCmdInvalid(n,c,d){var f=this.sendingCmdMap.get(n);if(f){var{callback:m,timer:y}=f;y&&clearTimeout(y),this.sendingCmdMap.delete(n),this.logger.warn(`clientSocketV2::packet ${n}, ${d} is invalid:`,c),m[1](c)}}markAllCmdInvaild(n){this.logger.log("markAllCmdInvaild",n),this.sendingCmdMap.forEach(c=>{var{callback:d,timer:f,cmd:m}=c;this.logger.log(`clientSocketV2::markAllCmdInvaild:cmd ${m}`),f&&clearTimeout(f),d[1](n)}),this.sendingCmdMap.clear()}ping(){var n;return tr(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);try{yield this.sendCmd("heartbeat")}catch(c){if(c.code===rt.V2NIM_ERROR_CODE_DISCONNECT)return;if(yield this.testHeartBeat5Timeout())return yield this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:(n=this.socket)===null||n===void 0?void 0:n.url}),this.core.reporterHookLinkKeep.end(!0),void this.doDisconnect(Fo.OFFLINE,"PingError")}this.pingTimer=setTimeout(()=>{this.ping()},3e4)})}testHeartBeat5Timeout(){return tr(this,void 0,void 0,function*(){clearTimeout(this.pingTimer);for(var n=0;n<5;n++)try{return yield this.sendCmd("heartbeat",{},{timeout:3e3}),!1}catch{this.logger.log(`clientSocketV2::test heartbeat ${n} Timeout`)}return!0})}initOnlineListener(){this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,zt.net.onNetworkStatusChange(n=>{this.logger.log("clientSocketV2::onlineListener:network change",n);var c=this.auth.getConnectStatus(),d=this.auth.getLoginStatus();n.isConnected&&d===1?this.ping():n.isConnected&&c===3?(this.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),this.auth.reconnect.clearReconnectTimer(),this.auth.reconnect.doReLogin()):n.isConnected||this.doDisconnect(Fo.OFFLINE,"OfflineListener")}))}destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),this.hasNetworkListener=!1}}class Tj{constructor(n){this.currenRetryCount=0,this.backoff=new LM({max:8e3,min:1600,jitter:.01}),this.reconnectTimer=0,this.core=n,this.auth=n.V2NIMLoginService}reset(){this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer)}clearReconnectTimer(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)}attempToReLogin(){var n=this.backoff.duration();if(typeof this.reconnectDelayProvider=="function")try{var c=this.reconnectDelayProvider(n);typeof c=="number"&&c>=0&&(n=c>=1e3?c:c+200+Math.ceil(300*Math.random()))}catch(d){this.core.logger.error("reconnect::connectDelayProvider excute failed,",d)}return this.currenRetryCount++,this.core.logger.log(`reconnect::reconnect timer is about to be set, delay ${n} ms, current retry count is ${this.currenRetryCount}`),this.core.reporter.reportTraceStart("login",{user_id:this.auth.getLoginUser(),action:"auto_login",binary_websocket:this.auth.binaryWebsocket}),this.clearReconnectTimer(),this.reconnectTimer=setTimeout(()=>{this.core.logger.log("reconnect::reconnect timer is now triggered");var d=this.auth.getConnectStatus();d===3?this.doReLogin():this.core.logger.warn(`reconnect::reconnect timer is over because connect status now is ${d}`)},n),!0}doReLogin(){this.auth.loginOption.forceMode=!1,this.auth.originLoginPromise=this.auth.doLogin(!0);var n=this.auth.previousLoginManager.add(this.auth.originLoginPromise);return n.then(()=>{this.core.reporter.reportTraceEnd("login",!0)}).catch(c=>{var d=c;if(this.core.logger.warn("reconnect::try login but failed due to",d),this.core.reporter.reportTraceEnd("login",!1),this.auth.checkLoginTerminalCode(d&&d.code))return this.auth.clientSocket.doDisconnect(Rn.ACTIVE,"ReloginTerminated"),void this.auth.lifeCycle.processEvent("exited",d);d&&d.code===399&&this.auth.lbs.reset(),this.auth.lifeCycle.processEvent("waiting")}),n}_setReconnectDelayProvider(n){this.reconnectDelayProvider=n}}function Ij(s){s=s||[];for(var n=[],c=0;c<s.length;c++)n.indexOf(s[c])===-1&&n.push(s[c]);return n}class Sj{constructor(n){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=n,this.auth=n.V2NIMLoginService}getLbsInfos(){return tr(this,void 0,void 0,function*(){if(this.socketLinkUrls.length>0){var n=this.socketLinkUrls.shift();return this.socketLinkUrls=[],this.core.logger.log("V2NIMLoginService::getLbsInfos:use cache link",n),Promise.resolve(n)}this.auth.lifeCycle.processEvent("addressing"),this.core.reporterHookLBS.start(this.core.account);var c=Ij(this.auth.config.lbsUrls);try{var d=yield this.ladderLoad(c);if(d.status!==200||!d.data)throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",d.status,d),new Gt({code:rt.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:`V2NIMLoginService::getLbsInfos failed, status ${d.status}`}});this.success(d)}catch(m){var f=m;if(this.core.logger.error(`V2NIMLoginService::lbs getLbsInfos error, use default link: ${this.auth.config.linkUrl}. error:`,m),this.reportForFail(c[0],f.code,f.message),this.checkTerminator(f.code))throw m;this.socketLinkUrls=[this.auth.config.linkUrl]}return this.socketLinkUrls.shift()})}checkTerminator(n){return n===rt.V2NIM_ERROR_CODE_CANCELLED||n===rt.V2NIM_ERROR_CODE_TIMEOUT}generateUrl(n){var c=n.indexOf("?")>-1?"&":"?";return n+c+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"}requstLbs(n){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(n),{method:"GET",dataType:"json",timeout:8e3}))}setLadderTimer(n,c,d,f){this.timer&&clearTimeout(this.timer);var m=n[c];this.timer=setTimeout(()=>{m&&(this.setLadderTimer(n,c+1,d,f),this.core.logger.log(`V2NIMLoginService::getLbsInfos ${c}:`,m),this.reportForLbsStart(m,c),this.requstLbs(m).then(y=>{this.reset(),d(Object.assign(Object.assign({},y),{url:m}))}).catch(y=>{var M;if(this.core.logger.warn(`V2NIMLoginService::getLbsInfos ${c} failed:`,y),this.failedCount+=1,this.reportForFailOnce(m,y.code,((M=y.detail)===null||M===void 0?void 0:M.reason)||y.message),this.failedCount>=n.length||this.checkTerminator(y.code))return this.reset(),void f(y)}))},2e3)}ladderLoad(n){return new Promise((c,d)=>{n.length>1&&this.setLadderTimer(n,1,c,d);var f=n[0];this.core.logger.log("V2NIMLoginService::getLbsInfos 0:",f),this.reportForLbsStart(f,0),this.requstLbs(f).then(m=>{this.reset(),c(Object.assign(Object.assign({},m),{url:f}))}).catch(m=>{var y;this.failedCount+=1,this.core.logger.warn("V2NIMLoginService::getLbsInfos 0 failed:",m),this.reportForFailOnce(f,m.code,((y=m.detail)===null||y===void 0?void 0:y.reason)||m.message),(this.failedCount>=n.length||this.checkTerminator(m.code))&&(this.reset(),d(m))})})}success(n){var c,d,f=n.data.common,m=f["mix.link"]||[],y=f["link.default"]||[];this.socketLinkUrls=m.concat(y).concat(this.auth.config.linkUrl),n.data["nos-chunk"]&&(!((c=this.core.cloudStorage)===null||c===void 0)&&c.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nos-chunk",n.data["nos-chunk"]),this.core.cloudStorage.setOptions({chunkUploadHost:n.data["nos-chunk"]})),Array.isArray(n.data.nosup)&&n.data.nosup.length>0&&(!((d=this.core.cloudStorage)===null||d===void 0)&&d.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nosup",n.data.nosup),this.core.cloudStorage.setOptions({commonUploadHostBackupList:n.data.nosup,commonUploadHost:n.data.nosup[0]})),this.core.logger.log("V2NIMLoginService::getLbsInfos success, socket link:",this.socketLinkUrls.slice(0),"chunkUploadHost: ",n.data["nos-chunk"]),this.reportForLbsSuccess(n.url,n.data)}reportForLbsStart(n,c){this.core.reporterHookLBS.updateBegin({target:n,index:c})}reportForLbsSuccess(n,c){this.core.reporterHookLBS.updateComplete({target:n,code:200,body:JSON.stringify(c)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:n,code:200,succeed:!0},{asyncParams:zt.net.getNetworkStatus()})}reportForFailOnce(n,c,d){this.core.reporterHookLBS.updateComplete({target:n,code:c,body:d})}reportForFail(n,c,d){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:n,description:d,code:c,succeed:!1},{asyncParams:zt.net.getNetworkStatus()})}reset(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)}}class Ej{constructor(n){this.lastLoginClientKey="__NIM_LAST_LOGIN_CLIENT__",this.loginClients=[],this.loginClientOfThisConnection={},this.core=n,this.auth=n.V2NIMLoginService}verifyAuthentication(n){return tr(this,void 0,void 0,function*(){var c=yield this.auth.doLoginStepsManager.add(this.refreshLoginToken(this.auth.account)),d=yield this.auth.doLoginStepsManager.add(this.refreshThirdPartyExt(this.auth.account));this.auth.token=c;var f,m=zt.getSystemInfo(),y={appkey:this.core.options.appkey,account:this.auth.account,token:c,authType:this.auth.loginOption.authType,appLogin:n?0:1,clientType:16,clientSession:this.auth.clientSession,clientId:this.auth.deviceId,sdkVersion:100830,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.8.30":m.userAgent.replace("{{appkey}}",this.core.options.appkey).slice(0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:m.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:m.hostEnvEnum,sdkHumanVersion:this.core.options.flutterSdkVersion||"10.8.30",os:m.os,browser:m.browser,protocolVersion:1,customClientType:this.auth.config.customClientType,customTag:this.auth.config.customTag,thirdPartyExtension:d};m.os.toLowerCase(),this.core.logger.log("V2NIMLoginService::do login ",y.account,y.clientSession,y.appLogin);try{f=yield this.auth.doLoginStepsManager.add(this.auth.clientSocket.sendCmd("v2Login",{tag:y}))}catch(b){var M=b;throw this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:M.code||0,succeed:!1,description:M.message},{asyncParams:zt.net.getNetworkStatus()}),M.code===rt.V2NIM_ERROR_CODE_CANCELLED||M.code===rt.V2NIM_ERROR_CODE_TIMEOUT||this.processLoginFailed(M),M}var{data:S,loginClients:E}=f.content;return this.changeLoginClient(1,E),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:200,succeed:!0},{asyncParams:zt.net.getNetworkStatus()}),this.loginClientOfThisConnection=l2(S),this.core.clientSocket.setSessionId(S.consid),zt.localStorage.setItem(this.lastLoginClientKey,JSON.stringify(Object.assign({account:this.auth.account},this.loginClientOfThisConnection))),this.loginClientOfThisConnection})}refreshLoginToken(n){return tr(this,void 0,void 0,function*(){if(this.auth.loginOption.authType===0)return this.auth.token;if(typeof this.auth.loginOption.tokenProvider!="function")return this.auth.token;try{var c=yield this.auth.loginOption.tokenProvider(n);if(typeof c=="string")return c;throw this.core.logger.error("V2NIMLoginService::excute tokenProvider complete but got Unexpected value:",c),new Gt({code:rt.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute tokenProvider complete but got Unexpected value",rawData:c}})}catch(m){var d=m,f=d;throw d.code!==rt.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute tokenProvider error:",d),f=new Gt({code:rt.V2NIM_ERROR_CODE_CALLBACK_FAILED,desc:"Excute tokenProvider error",detail:{rawError:m}})),this.processLoginFailed(d),f}})}refreshThirdPartyExt(n){return tr(this,void 0,void 0,function*(){if(typeof this.auth.loginOption.loginExtensionProvider!="function")return"";try{var c=yield this.auth.loginOption.loginExtensionProvider(n);if(typeof c=="string")return c;throw this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider complete but got Unexpected value:",c),new Gt({code:rt.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider complete but got Unexpected value",rawData:c}})}catch(m){var d=m,f=d;if(d.code!==rt.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider error:",d),f=new Gt({code:rt.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider error",rawError:m}})),this.auth.loginOption.authType===2)throw this.processLoginFailed(d),f;return""}})}processLoginFailed(n){this.auth.clientSocket.doDisconnect(Rn.ACTIVE,n),this.checkLoginTerminalCode(n.code)&&(this.auth.authenticator.reset(),this.auth.authenticator.clearLastLoginClient()),this.auth.lifeCycle.processEvent("loginFail",n)}changeLoginClient(n,c){var d=c.map(y=>l2(y));if(n===1)this.loginClients=d,this.auth.emit("onLoginClientChanged",n,this.loginClients);else if(n===2){var f=d.filter(y=>{var M=this.loginClients.filter(S=>S.clientId===y.clientId);return this.loginClients.push(y),M.length===0});f.length>0&&this.auth.emit("onLoginClientChanged",n,f)}else if(n===3){var m=d.filter(y=>(function(S,E){E=E||(()=>!0);for(var b=[],R=(S=S||[]).length,x=0,L=0;L<R;L++)E(S[L-x])&&(b.push(S.splice(L-x,1)[0]),x+=1);return b}(this.loginClients,M=>M.clientId===y.clientId&&M.consid===y.consid),this.loginClients.filter(M=>M.clientId===y.clientId).length===0));m.length>0&&this.auth.emit("onLoginClientChanged",n,m)}}checkAutoLogin(n){if(n)return!1;var c=zt.localStorage.getItem(this.lastLoginClientKey);if(!c)return!1;var d="",f="";try{var m=JSON.parse(c);d=Kr(m,"clientId"),f=Kr(m,"account")}catch{return!1}return d===this.auth.deviceId&&f===this.auth.account}checkLoginTerminalCode(n){return[rt.V2NIM_ERROR_CODE_CANCELLED,rt.V2NIM_ERROR_CODE_TIMEOUT,rt.V2NIM_ERROR_CODE_HANDSHAKE,302,317,rt.V2NIM_ERROR_CODE_FORBIDDEN,rt.V2NIM_ERROR_CODE_NOT_FOUND,rt.V2NIM_ERROR_CODE_PARAMETER_ERROR,rt.V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN,422,rt.V2NIM_ERROR_CODE_IM_DISABLED,rt.V2NIM_ERROR_CODE_APPKEY_NOT_EXIST,rt.V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED,rt.V2NIM_ERROR_CODE_APPKEY_BLOCKED,rt.V2NIM_ERROR_CODE_INVALID_TOKEN,rt.V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED,rt.V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST,rt.V2NIM_ERROR_CODE_ACCOUNT_BANNED,rt.V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST].includes(n)}reset(){this.loginClients=[],this.loginClientOfThisConnection={}}clearLastLoginClient(){zt.localStorage.removeItem(this.lastLoginClientKey)}}class f2 extends ju{constructor(n,c){super(),this.name=n,this.logger=c.logger,this.core=c}checkV2(){var n=this.core.options.apiVersion;if(n==="v2")return!0;throw new Gt({code:rt.V2NIM_ERROR_CODE_MISUSE,detail:{reason:`The version "${n}" of client is not supported.`}})}checkLogin(){if(this.core.V2NIMLoginService.getLoginStatus()===0)throw new Gt({code:rt.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Client logout."}})}emit(n,...c){this.logger.debug(`${this.name}::emit event: '${n.toString()}',`,c[0]!==void 0?c[0]:"",c[1]!==void 0?c[1]:"",c[2]!==void 0?c[2]:"");try{return super.emit(n,...c)}catch(d){return setTimeout(()=>{throw this.logger.error(`${this.name}::emit throw error in setTimeout. event: ${n.toString()}. Error`,d),d},0),!1}}process(n){var c=this[n.cmd+"Handler"],d=this.handler&&this.handler[n.cmd+"Handler"];if(typeof c=="function"||typeof d=="function"){if(n.error)return this.logger.error(`${n.cmd}::recvError`,n.error),Promise.reject(n.error);try{var f=c?c.call(this,n):d.call(this.handler,n);return Promise.resolve(f)}catch(y){return Promise.reject(y)}}var m=Kr(n,"error.detail.ignore");return n.error&&!m?Promise.reject(n.error):Promise.resolve(n)}}class Cj{constructor(n){this.name="V2NIMLoginLifeCycle",this.loginStatus=0,this.connectStatus=0,this.core=n,this.auth=n.V2NIMLoginService,this.logger=n.logger}processEvent(n,c,d){var f=this.getConnectStatus();switch(n){case"addressing":this.logger.log(`${this.name}::addressing`),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connect":this.logger.log(`${this.name}::connecting`),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connectSucc":this.logger.log(`${this.name}::connect success`),this.setLoginStatus(2),this.setConnectStatus(1);break;case"connectFail":this.logger.log(`${this.name}::connect fail`,c),this.setLoginStatus(3),this.setConnectStatus(0,c);break;case"connectionBroken":this.logger.log(`${this.name}::connectionBroken:`,c),this.setLoginStatus(3),this.setConnectStatus(0,c),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleDisconnected",c);break;case"loginSucc":this.logger.log(`${this.name}::login success, verify authentication success`),this.setLoginStatus(1),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLoginSucc",d);break;case"loginFail":if(this.logger.log(`${this.name}::login fail due to verify authentication failed:`,c),!c)return;this.setLoginStatus(this.auth.authenticator.checkLoginTerminalCode(c.code)?0:3),this.setConnectStatus(0,c),this.auth.emit("onLoginFailed",c);break;case"logout":this.logger.log(`${this.name}::logout`),this.setLoginStatus(0),this.setConnectStatus(0),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"kicked":this.logger.log(`${this.name}::kicked`,d),this.setLoginStatus(0),this.setConnectStatus(0,c),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleKicked");break;case"exited":this.logger.log(`${this.name}::exited`,c),this.setLoginStatus(0),this.setConnectStatus(0,c);break;case"waiting":this.logger.log(`${this.name}::waiting to reconnect`),this.setLoginStatus(3),this.setConnectStatus(3),f!==2&&this.auth.reconnect.attempToReLogin()}}getConnectStatus(){return this.connectStatus}getLoginStatus(){return this.loginStatus}setLoginStatus(n){n!==this.loginStatus&&(this.loginStatus=n,this.auth.emit("onLoginStatus",n))}setConnectStatus(n,c){if(n!==this.connectStatus){var d=this.connectStatus;this.connectStatus=n,this.auth.emit("onConnectStatus",n),this.delegateConnectEvent(d,n,c)}}delegateConnectEvent(n,c,d){n===1&&c===0&&d&&this.auth.emit("onDisconnected",d),n===2&&c===0&&d&&this.auth.emit("onConnectFailed",d)}}class bj{constructor(n){this.core=n,this.auth=n.V2NIMLoginService,this.datas=[]}switchDataSync(n){return tr(this,void 0,void 0,function*(){var{type:c,state:d,error:f,subType:m}=n,y=this.datas.filter(S=>S.type===c&&S.subType===m);y.length>0?(y[0].state=d,y[0].error=f):this.datas.push({type:c,state:d,subType:m});var M=this.datas.every(S=>S.state===3);c===1&&(d===2&&m==="mainSync"?(this.core.eventBus.emit("V2NIMLoginService/syncing"),this.auth.emit("onDataSync",c,d)):d===3&&M&&(this.core.eventBus.emit("V2NIMLoginService/syncDone",f),this.auth.emit("onDataSync",c,d,f)))})}checkSyncing(){return this.datas.some(n=>n.subType==="mainSync"&&n.state===2)}reset(){this.datas=[]}}var Aj={"6_3":"notifylog","6_4":"uploadLog","6_23":"getServerTime","6_31":"notifyDetect","6_32":"uploadDetect"},m2={type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},Rj={notifylog:{sid:6,cid:3,service:"misc"},uploadLog:{sid:6,cid:4,service:"misc",hasPacketResponse:!1,params:[{type:"String",name:"url"},{type:"Property",name:"data",reflectMapper:{type:1,content:2}}]},getServerTime:{sid:6,cid:23,service:"misc",response:[{type:"Long",name:"time"}]},notifyDetect:{sid:6,cid:31,service:"misc",response:[{type:"Property",name:"data",reflectMapper:Re(m2)}]},uploadDetect:{sid:6,cid:32,service:"misc",hasPacketResponse:!1,params:[{type:"Property",name:"data",reflectMapper:m2}]}},Nj={type:{type:"number"},t1:{type:"number"},t2:{type:"number"},t3:{type:"number"},t4:{type:"number"},t5:{type:"number"},t6:{type:"number"}};class kj extends class{constructor(c,d){this.name=c,this.core=d,this.name=c,this.logger=d.logger,this.core=d}process(c){var d=this[c.cmd+"Handler"];if(typeof d=="function")return d.call(this,c);var f=Kr(c,"error.detail.ignore");return c.error&&!f?Promise.reject(c.error):Promise.resolve(c)}}{constructor(n){super("misc",n),this.core=n,wp({cmdMap:Aj,cmdConfig:Rj}),this.setListener()}setListener(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.core.timeOrigin.setOriginTimetick()}),this.core.eventBus.on("logined",()=>{this.core.timeOrigin.setOriginTimetick()})}getServerTime(){return tr(this,void 0,void 0,function*(){var n=yield this.core.clientSocket.sendCmd("getServerTime");return parseInt(n.content.time)})}notifyDetectHandler(n){return tr(this,void 0,void 0,function*(){var c=function(f){return PM(Nj,f)}(n.content.data);c.t3=n.__receiveTimeNode.time,c.t4=Date.now();try{yield this.core.clientSocket.sendCmd("uploadDetect",{data:c})}catch(d){this.core.logger.warn("misc::notifyDetectHandler:upload failed",d)}})}notifylogHandler(){return tr(this,void 0,void 0,function*(){var n=void 0;try{n=yield this.core.logger.extractLogs()}catch{return}if(n&&typeof n!="string"){var c="";try{c=(yield this.core.cloudStorage.uploadFile({type:"file",file:n})).url}catch{return}if(c){c+=(c.indexOf("?")>0?"&":"?")+"download="+new Date().getTime()+"_web.log";try{yield this.core.clientSocket.sendCmd("uploadLog",{url:c})}catch{return}}}})}}function g2(s,n){s=s||{};var c={};return(n=n||[]).forEach(d=>{s[d]!==void 0&&(c[d]=s[d])}),c}var Oj=["https://lbs.netease.im/lbs/webconf.jsp"],v2={retryCount:3,timeout:6e4,forceMode:!1,authType:0,syncLevel:0},wj={"27_1":"v2NIMSync","27_10":"v2QChatSync"},xj={v2NIMSync:{sid:27,cid:1,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,p2pTeamModifyMessage:30,superTeamModifyMessage:31,filterMsgs:100}}],response:[{type:"Long",name:"timetag"}]},v2QChatSync:{sid:27,cid:10,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Long",name:"timetag"}]}};zu(function(s,n){s.exports=function(){function c(m){if(m){var y="";return Object.keys(m).forEach(function(M,S){y+=S===0?"?":"&",y+=`${M}=${m[M]}`}),y}return""}class d extends Error{constructor(y,M,S,E){super(S),this.source=y,this.code=M,this.desc=S,this.detail=E||{}}}function f(m,y={dataType:"json",method:"GET",timeout:5e3}){var M=y.dataType==="text"?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",S=y.method==="GET"?c(y.params):"";return new Promise(function(E,b){if(window.XMLHttpRequest){var R,x=new XMLHttpRequest;if(x.onreadystatechange=function(){if(x.readyState===4)if(x.status===200){try{R=JSON.parse(x.response||"{}")}catch{R=x.response}E({status:x.status,data:R})}else setTimeout(()=>{b(new d(1,x.status,`readyState: ${x.readyState}; statusText: ${x.statusText}`))},0)},x.open(y.method,`${m}${S}`),x.timeout=y.timeout||5e3,x.setRequestHeader("Content-Type",M),y.headers)for(var L in y.headers)x.setRequestHeader(L,y.headers[L]);x.ontimeout=function(q){b(new d(1,408,q&&q.message?q.message:"request timeout"))},x.send(JSON.stringify(y.data))}else b(new d(2,10400,"request no suppout"))})}return f}()});zu(function(s,n){s.exports=function(){var c={d:function(oe,B){for(var me in B)c.o(B,me)&&!c.o(oe,me)&&Object.defineProperty(oe,me,{enumerable:!0,get:B[me]})},o:function(oe,B){return Object.prototype.hasOwnProperty.call(oe,B)}},d={};c.d(d,{default:function(){return fe}});var f=function oe(B){for(var me in function(Ee,ve){if(!(Ee instanceof ve))throw new TypeError("Cannot call a class as a function")}(this,oe),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(Ee){},this.onProgress=function(Ee){},this.onUploadProgress=function(Ee){},this.onComplete=function(Ee){},B)this[me]=B[me]};function m(oe,B){var me=typeof Symbol<"u"&&oe[Symbol.iterator]||oe["@@iterator"];if(!me){if(Array.isArray(oe)||(me=function(he,Fe){if(he){if(typeof he=="string")return y(he,Fe);var Xe=Object.prototype.toString.call(he).slice(8,-1);return Xe==="Object"&&he.constructor&&(Xe=he.constructor.name),Xe==="Map"||Xe==="Set"?Array.from(he):Xe==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Xe)?y(he,Fe):void 0}}(oe))||B){me&&(oe=me);var Ee=0,ve=function(){};return{s:ve,n:function(){return Ee>=oe.length?{done:!0}:{done:!1,value:oe[Ee++]}},e:function(he){throw he},f:ve}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var qe,Qe=!0,ut=!1;return{s:function(){me=me.call(oe)},n:function(){var he=me.next();return Qe=he.done,he},e:function(he){ut=!0,qe=he},f:function(){try{Qe||me.return==null||me.return()}finally{if(ut)throw qe}}}}function y(oe,B){(B==null||B>oe.length)&&(B=oe.length);for(var me=0,Ee=new Array(B);me<B;me++)Ee[me]=oe[me];return Ee}var M={privateObj:{},setItem:function(oe,B){M.privateObj[oe]=B},getItem:function(oe){return M.privateObj[oe]},removeItem:function(oe){delete M.privateObj[oe]},getKeys:function(){return Object.keys(M.privateObj)}},S={getFileKey:function(oe){var B=oe.size.toString(),me=oe.lastModified.toString();return"_NosUploader_"+oe.name+B.slice(B.length-5)+me.slice(me.length-5)},getFileInfo:function(oe){var B=M.getItem(oe);if(!B)return null;try{return JSON.parse(B)}catch{return null}},initFile:function(oe,B,me){S.clearExpiredInfo();var Ee=this.getFileKey(B),ve={ctx:oe.ctx!==void 0?oe.ctx:"",bucket:oe.bucketName,obj:oe.objectName,token:oe.token,modifyAt:Date.now(),end:!1};return oe.payload&&(ve.payload=oe.payload),me&&M.setItem(Ee,JSON.stringify(ve)),Ee},setUploadContext:function(oe,B,me){var Ee=this.getFileInfo(oe);Ee&&(Ee.ctx=B,me&&M.setItem(oe,JSON.stringify(Ee)))},setComplete:function(oe,B){var me=this.getFileInfo(oe);me&&(me.modifyAt=Date.now(),me.end=!0,B&&M.setItem(oe,JSON.stringify(me)))},getUploadContext:function(oe){var B=this.getFileInfo(oe);return B?B.ctx:""},removeFileInfo:function(oe){oe.indexOf("_NosUploader_")===0&&M.removeItem(oe)},clearExpiredInfo:function(){var oe,B=typeof M.getKeys=="function"?M.getKeys():Object.keys(M),me=Date.now(),Ee=[],ve=m(B);try{for(ve.s();!(oe=ve.n()).done;){var qe=oe.value;if(qe.indexOf("_NosUploader_")===0){var Qe=S.getFileInfo(qe);Qe===null||me-Qe.modifyAt>fe.expireTime?M.removeItem(qe):Ee.push({fileInfo:Qe,key:qe})}}}catch(Xe){ve.e(Xe)}finally{ve.f()}if(Ee.length>fe.maxFileCache){var ut,he=m(Ee.sort(function(Xe,yt){return yt.fileInfo.modifyAt-Xe.fileInfo.modifyAt}).slice(fe.maxFileCache));try{for(he.s();!(ut=he.n()).done;){var Fe=ut.value;Fe.key.indexOf("_NosUploader_")===0&&M.removeItem(Fe.key)}}catch(Xe){he.e(Xe)}finally{he.f()}}}},E=S;function b(oe){return(b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B})(oe)}function R(oe,B){return!B||b(B)!=="object"&&typeof B!="function"?function(me){if(me===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return me}(oe):B}function x(oe){var B=typeof Map=="function"?new Map:void 0;return(x=function(me){if(me===null||(Ee=me,Function.toString.call(Ee).indexOf("[native code]")===-1))return me;var Ee;if(typeof me!="function")throw new TypeError("Super expression must either be null or a function");if(B!==void 0){if(B.has(me))return B.get(me);B.set(me,ve)}function ve(){return L(me,arguments,G(this).constructor)}return ve.prototype=Object.create(me.prototype,{constructor:{value:ve,enumerable:!1,writable:!0,configurable:!0}}),D(ve,me)})(oe)}function L(oe,B,me){return(L=q()?Reflect.construct:function(Ee,ve,qe){var Qe=[null];Qe.push.apply(Qe,ve);var ut=new(Function.bind.apply(Ee,Qe));return qe&&D(ut,qe.prototype),ut}).apply(null,arguments)}function q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(oe,B){return(D=Object.setPrototypeOf||function(me,Ee){return me.__proto__=Ee,me})(oe,B)}function G(oe){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)})(oe)}var J=function(oe){(function(qe,Qe){if(typeof Qe!="function"&&Qe!==null)throw new TypeError("Super expression must either be null or a function");qe.prototype=Object.create(Qe&&Qe.prototype,{constructor:{value:qe,writable:!0,configurable:!0}}),Qe&&D(qe,Qe)})(ve,oe);var B,me,Ee=(B=ve,me=q(),function(){var qe,Qe=G(B);if(me){var ut=G(this).constructor;qe=Reflect.construct(Qe,arguments,ut)}else qe=Qe.apply(this,arguments);return R(this,qe)});function ve(qe,Qe){var ut;return function(he,Fe){if(!(he instanceof Fe))throw new TypeError("Cannot call a class as a function")}(this,ve),(ut=Ee.call(this,"NosUploadError:"+qe)).errCode=Qe,ut.errMsg=qe,ut}return ve}(x(Error)),ne=function oe(B,me,Ee){if(B.uploadState==="uploading"){var ve=B.config,qe=B.param,Qe=E.getUploadContext(B.fileKey);if(!Qe)return Ee(0);var ut=new XMLHttpRequest,he=ve.directUploadAddr+"/".concat(qe.bucketName)+"/".concat(encodeURIComponent(qe.objectName))+"?uploadContext"+"&context=".concat(Qe)+"&version=".concat(ve.version);ut.onreadystatechange=function(){var Fe;if(B.uploadState!=="abort"&&ut.readyState===4){var Xe;try{Xe=JSON.parse(ut.responseText)}catch{Xe={errMsg:"JsonParseError in getOffset. xhr.status = "+ut.status+". xhr.responseText: "+ut.responseText,errCode:500}}ut.status===200?Xe.errCode?B.config.onError(new J(Xe.errMsg,Xe.errCode)):Ee(Xe.offset):ut.status.toString().match(/^5/)?oe(B,me-1,Ee):me>0?(typeof((Fe=ve.logger)===null||Fe===void 0?void 0:Fe.error)=="function"&&ve.logger.error("getOffset(".concat(he,") error. retry after 3 seconds. ").concat(new Date().toTimeString())),setTimeout(function(){oe(B,me-1,Ee)},3500)):ut.status?(E.removeFileInfo(B.fileKey),ve.onError(new J("getOffset(".concat(he,") error: ").concat(ut.status," ").concat(ut.statusText)))):ve.onError(new J("getOffset(".concat(he,") error. no Error Code")))}},ut.open("get",he),ut.setRequestHeader("x-nos-token",qe.token),ut.timeout=ve.getOffsetTimeout,ut.send()}},z=function oe(B,me,Ee,ve){if(B.uploadState==="uploading"){var qe=B.param,Qe=B.config,ut=File.prototype.slice,he=qe.ctx!==void 0?qe.ctx:"",Fe=me+Qe.trunkSize>=B.file.size,Xe=Fe?B.file.size:me+Qe.trunkSize,yt=new XMLHttpRequest,Wt=Qe.directUploadAddr+"/".concat(qe.bucketName)+"/".concat(encodeURIComponent(qe.objectName));if(yt.upload.onprogress=function(Tt){if(B.uploadState!=="abort"){var Le=0;Tt.lengthComputable?(Le=(me+Tt.loaded)/B.file.size,Qe.onProgress(Le),Qe.onUploadProgress({loaded:Tt.loaded,total:B.file.size,percentage:Le,percentageText:(100*Le).toFixed(2)+"%"})):Qe.onError(new J("browser does not support query upload progress"))}},yt.onreadystatechange=function(){var Tt,Le;if(B.uploadState!=="abort"&&yt.readyState===4){var Ce;try{Ce=JSON.parse(yt.responseText)}catch(we){typeof((Tt=Qe.logger)===null||Tt===void 0?void 0:Tt.error)=="function"&&Qe.logger.error("JsonParseError in uploadTrunk. xhr.status = "+yt.status+". xhr.responseText: "+yt.responseText,we),Ce={errMsg:"JsonParseError in uploadTrunk. xhr.status = "+yt.status+". xhr.responseText: "+yt.responseText}}yt.status===200?(B.setContext(Ce.context),Fe?(ve(),B.setComplete()):oe(B,Ce.offset,Qe.retryCount,ve)):yt.status.toString().match(/^5/)?Ee>0?oe(B,me,Ee-1,ve):(E.removeFileInfo(B.fileKey),Qe.onError(new J(Ce.errMsg,Ce.errCode))):Ee>0?(typeof((Le=Qe.logger)===null||Le===void 0?void 0:Le.error)=="function"&&Qe.logger.error("uploadTrunk(".concat(Wt,") error. retry after 3 seconds. ").concat(new Date().toTimeString())),setTimeout(function(){oe(B,me,Ee-1,ve)},3500)):yt.status?(E.removeFileInfo(B.fileKey),Qe.onError(new J("uploadTrunk(".concat(Wt,") error: ").concat(yt.status," ").concat(yt.statusText)))):Qe.onError(new J("uploadTrunk(".concat(Wt,") error. no Error Code. Please check your network")))}},yt.open("post",Wt+"?offset=".concat(me)+"&complete=".concat(Fe)+"&context=".concat(he)+"&version=".concat(Qe.version)),yt.setRequestHeader("x-nos-token",qe.token),qe.md5&&yt.setRequestHeader("content-md5",qe.md5),B.file.type&&yt.setRequestHeader("content-type",B.file.type),yt.timeout=Qe.trunkUploadTimeout,typeof FileReader<"u"){var jt=new FileReader;jt.addEventListener("load",function(Tt){var Le;((Le=Tt==null?void 0:Tt.target)===null||Le===void 0?void 0:Le.result)instanceof ArrayBuffer&&Tt.target.result.byteLength>0?yt.send(Tt.target.result):Qe.onError(new J("Read ArrayBuffer failed",194003))}),jt.addEventListener("error",function(Tt){var Le=Tt.target.error;Qe.onError(new J("Read ArrayBuffer error. ".concat(Le.toString()),194003))}),jt.readAsArrayBuffer(ut.call(B.file,me,Xe))}else yt.send(ut.call(B.file,me,Xe))}};function $(oe,B){for(var me=0;me<B.length;me++){var Ee=B[me];Ee.enumerable=Ee.enumerable||!1,Ee.configurable=!0,"value"in Ee&&(Ee.writable=!0),Object.defineProperty(oe,Ee.key,Ee)}}var Z=function(){function oe(me,Ee,ve){(function(qe,Qe){if(!(qe instanceof Qe))throw new TypeError("Cannot call a class as a function")})(this,oe),this.uploadState="paused",this.config=ve,this.file=me,this.param=Ee,this.fileKey=E.initFile(Ee,me,this.config.enableCache),this.resume()}var B;return(B=[{key:"resume",value:function(){var me=this;if(this.uploadState!=="uploading"){this.setUploadState("uploading");var Ee=this.config;ne(this,Ee.retryCount,function(ve){z(me,ve,Ee.retryCount,function(){me.setUploadState("ended"),typeof Ee.onComplete=="function"&&Ee.onComplete(me.param)})})}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){this.uploadState!=="ended"&&this.uploadState!=="abort"&&(this.setUploadState("abort"),this.config.onError(new J("Upload Aborted",10499)))}},{key:"setUploadState",value:function(me){me!==this.uploadState&&(this.uploadState=me)}},{key:"setContext",value:function(me){E.setUploadContext(this.fileKey,me,this.config.enableCache),this.param.ctx=me}},{key:"setComplete",value:function(){E.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&$(oe.prototype,B),oe}(),le={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function(oe){var B=E.getFileKey(oe),me=E.getFileInfo(B);return me===null?null:Date.now()-me.modifyAt>le.expireTime?(E.removeFileInfo(B),null):{uploadInfo:Object.assign({bucketName:me.bucket,objectName:me.obj,token:me.token,ctx:me.ctx},me.payload?{payload:me.payload}:{}),complete:me.end}},setMaxFileCache:function(oe){le.maxFileCache=oe},setExpireTime:function(oe){le.expireTime=oe},printCaches:function(){if(typeof localStorage<"u")for(var oe=0,B=Object.keys(localStorage);oe<B.length;oe++){var me=B[oe],Ee=E.getFileInfo(me);Ee&&console.log(Ee,"modifiedAt",new Date(Ee.modifyAt).toTimeString())}},createConfig:function(oe){return new f(oe)},createTask:function(oe,B,me){return new Z(oe,B,me)}},fe=le;return d.default}()});/*!
* Platform.js v1.3.6
* Copyright 2014-2020 Benjamin Tan
* Copyright 2011-2013 John-David Dalton
* Available under MIT license
*/zu(function(s,n){(function(){var c={function:!0,object:!0}[typeof window]&&window||this,d=n,f=s&&!s.nodeType&&s,m=d&&f&&typeof Pv=="object"&&Pv;!m||m.global!==m&&m.window!==m&&m.self!==m||(c=m);var y=Math.pow(2,53)-1,M=/\bOpera/,S=Object.prototype,E=S.hasOwnProperty,b=S.toString;function R(z){return(z=String(z)).charAt(0).toUpperCase()+z.slice(1)}function x(z){return z=J(z),/^(?:webOS|i(?:OS|P))/.test(z)?z:R(z)}function L(z,$){for(var Z in z)E.call(z,Z)&&$(z[Z],Z,z)}function q(z){return z==null?R(z):b.call(z).slice(8,-1)}function D(z){return String(z).replace(/([ -])(?!$)/g,"$1?")}function G(z,$){var Z=null;return function(fe,oe){var B=-1,me=fe?fe.length:0;if(typeof me=="number"&&me>-1&&me<=y)for(;++B<me;)oe(fe[B],B,fe);else L(fe,oe)}(z,function(le,fe){Z=$(Z,le,fe,z)}),Z}function J(z){return String(z).replace(/^ +| +$/g,"")}var ne=function z($){var Z=c,le=$&&typeof $=="object"&&q($)!="String";le&&(Z=$,$=null);var fe=Z.navigator||{},oe=fe.userAgent||"";$||($=oe);var B,me,Ee=le?!!fe.likeChrome:/\bChrome\b/.test($)&&!/internal|\n/i.test(b.toString()),ve="Object",qe=le?ve:"ScriptBridgingProxyObject",Qe=le?ve:"Environment",ut=le&&Z.java?"JavaPackage":q(Z.java),he=le?ve:"RuntimeObject",Fe=/\bJava/.test(ut)&&Z.java,Xe=Fe&&q(Z.environment)==Qe,yt=Fe?"a":"",Wt=Fe?"b":"",jt=Z.document||{},Tt=Z.operamini||Z.opera,Le=M.test(Le=le&&Tt?Tt["[[Class]]"]:q(Tt))?Le:Tt=null,Ce=$,we=[],St=null,ue=$==oe,ge=ue&&Tt&&typeof Tt.version=="function"&&Tt.version(),be=function(De){return G(De,function(Ue,Ve){return Ue||RegExp("\\b"+(Ve.pattern||D(Ve))+"\\b","i").exec($)&&(Ve.label||Ve)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),_e=function(De){return G(De,function(Ue,Ve){return Ue||RegExp("\\b"+(Ve.pattern||D(Ve))+"\\b","i").exec($)&&(Ve.label||Ve)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),ct=de([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),X=function(De){return G(De,function(Ue,Ve,Ye){return Ue||(Ve[ct]||Ve[/^[a-z]+(?: +[a-z]+\b)*/i.exec(ct)]||RegExp("\\b"+D(Ye)+"(?:\\b|\\w*\\d)","i").exec($))&&Ye})}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),K=function(De){return G(De,function(Ue,Ve){var Ye=Ve.pattern||D(Ve);return!Ue&&(Ue=RegExp("\\b"+Ye+"(?:/[\\d.]+|[ \\w.]*)","i").exec($))&&(Ue=function(ot,It,kt){var Jt={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return It&&kt&&/^Win/i.test(ot)&&!/^Windows Phone /i.test(ot)&&(Jt=Jt[/[\d.]+$/.exec(ot)])&&(ot="Windows "+Jt),ot=String(ot),It&&kt&&(ot=ot.replace(RegExp(It,"i"),kt)),x(ot.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(Ue,Ye,Ve.label||Ve)),Ue})}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function de(Ne){return G(Ne,function(De,Ue){var Ve=Ue.pattern||D(Ue);return!De&&(De=RegExp("\\b"+Ve+" *\\d+[.\\w_]*","i").exec($)||RegExp("\\b"+Ve+" *\\w+-[\\w]*","i").exec($)||RegExp("\\b"+Ve+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec($))&&((De=String(Ue.label&&!RegExp(Ve,"i").test(Ue.label)?Ue.label:De).split("/"))[1]&&!/[\d.]+/.test(De[0])&&(De[0]+=" "+De[1]),Ue=Ue.label||Ue,De=x(De[0].replace(RegExp(Ve,"i"),Ue).replace(RegExp("; *(?:"+Ue+"[_-])?","i")," ").replace(RegExp("("+Ue+")[-_.]?(\\w)","i"),"$1 $2"))),De})}function Ae(Ne){return G(Ne,function(De,Ue){return De||(RegExp(Ue+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec($)||0)[1]||null})}if(be&&(be=[be]),/\bAndroid\b/.test(K)&&!ct&&(B=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec($))&&(ct=J(B[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),X&&!ct?ct=de([X]):X&&ct&&(ct=ct.replace(RegExp("^("+D(X)+")[-_.\\s]","i"),X+" ").replace(RegExp("^("+D(X)+")[-_.]?(\\w)","i"),X+" $2")),(B=/\bGoogle TV\b/.exec(ct))&&(ct=B[0]),/\bSimulator\b/i.test($)&&(ct=(ct?ct+" ":"")+"Simulator"),_e=="Opera Mini"&&/\bOPiOS\b/.test($)&&we.push("running in Turbo/Uncompressed mode"),_e=="IE"&&/\blike iPhone OS\b/.test($)?(X=(B=z($.replace(/like iPhone OS/,""))).manufacturer,ct=B.product):/^iP/.test(ct)?(_e||(_e="Safari"),K="iOS"+((B=/ OS ([\d_]+)/i.exec($))?" "+B[1].replace(/_/g,"."):"")):_e=="Konqueror"&&/^Linux\b/i.test(K)?K="Kubuntu":X&&X!="Google"&&(/Chrome/.test(_e)&&!/\bMobile Safari\b/i.test($)||/\bVita\b/.test(ct))||/\bAndroid\b/.test(K)&&/^Chrome/.test(_e)&&/\bVersion\//i.test($)?(_e="Android Browser",K=/\bAndroid\b/.test(K)?K:"Android"):_e=="Silk"?(/\bMobi/i.test($)||(K="Android",we.unshift("desktop mode")),/Accelerated *= *true/i.test($)&&we.unshift("accelerated")):_e=="UC Browser"&&/\bUCWEB\b/.test($)?we.push("speed mode"):_e=="PaleMoon"&&(B=/\bFirefox\/([\d.]+)\b/.exec($))?we.push("identifying as Firefox "+B[1]):_e=="Firefox"&&(B=/\b(Mobile|Tablet|TV)\b/i.exec($))?(K||(K="Firefox OS"),ct||(ct=B[1])):!_e||(B=!/\bMinefield\b/i.test($)&&/\b(?:Firefox|Safari)\b/.exec(_e))?(_e&&!ct&&/[\/,]|^[^(]+?\)/.test($.slice($.indexOf(B+"/")+8))&&(_e=null),(B=ct||X||K)&&(ct||X||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(K))&&(_e=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(K)?K:B)+" Browser")):_e=="Electron"&&(B=(/\bChrome\/([\d.]+)\b/.exec($)||0)[1])&&we.push("Chromium "+B),ge||(ge=Ae(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",D(_e),"(?:Firefox|Minefield|NetFront)"])),(B=(be=="iCab"&&parseFloat(ge)>3?"WebKit":/\bOpera\b/.test(_e)&&(/\bOPR\b/.test($)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test($)&&!/^(?:Trident|EdgeHTML)$/.test(be)&&"WebKit"||!be&&/\bMSIE\b/i.test($)&&(K=="Mac OS"?"Tasman":"Trident")||be=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(_e)&&"NetFront")&&(be=[B]),_e=="IE"&&(B=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec($)||0)[1])?(_e+=" Mobile",K="Windows Phone "+(/\+$/.test(B)?B:B+".x"),we.unshift("desktop mode")):/\bWPDesktop\b/i.test($)?(_e="IE Mobile",K="Windows Phone 8.x",we.unshift("desktop mode"),ge||(ge=(/\brv:([\d.]+)/.exec($)||0)[1])):_e!="IE"&&be=="Trident"&&(B=/\brv:([\d.]+)/.exec($))&&(_e&&we.push("identifying as "+_e+(ge?" "+ge:"")),_e="IE",ge=B[1]),ue){if(function(De,Ue){var Ve=De!=null?typeof De[Ue]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(Ve)||Ve=="object"&&!De[Ue])}(Z,"global"))if(Fe&&(Ce=(B=Fe.lang.System).getProperty("os.arch"),K=K||B.getProperty("os.name")+" "+B.getProperty("os.version")),Xe){try{ge=Z.require("ringo/engine").version.join("."),_e="RingoJS"}catch{(B=Z.system)&&B.global.system==Z.system&&(_e="Narwhal",K||(K=B[0].os||null))}_e||(_e="Rhino")}else typeof Z.process=="object"&&!Z.process.browser&&(B=Z.process)&&(typeof B.versions=="object"&&(typeof B.versions.electron=="string"?(we.push("Node "+B.versions.node),_e="Electron",ge=B.versions.electron):typeof B.versions.nw=="string"&&(we.push("Chromium "+ge,"Node "+B.versions.node),_e="NW.js",ge=B.versions.nw)),_e||(_e="Node.js",Ce=B.arch,K=B.platform,ge=(ge=/[\d.]+/.exec(B.version))?ge[0]:null));else q(B=Z.runtime)==qe?(_e="Adobe AIR",K=B.flash.system.Capabilities.os):q(B=Z.phantom)==he?(_e="PhantomJS",ge=(B=B.version||null)&&B.major+"."+B.minor+"."+B.patch):typeof jt.documentMode=="number"&&(B=/\bTrident\/(\d+)/i.exec($))?(ge=[ge,jt.documentMode],(B=+B[1]+4)!=ge[1]&&(we.push("IE "+ge[1]+" mode"),be&&(be[1]=""),ge[1]=B),ge=_e=="IE"?String(ge[1].toFixed(1)):ge[0]):typeof jt.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(_e)&&(we.push("masking as "+_e+" "+ge),_e="IE",ge="11.0",be=["Trident"],K="Windows");K=K&&x(K)}if(ge&&(B=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(ge)||/(?:alpha|beta)(?: ?\d)?/i.exec($+";"+(ue&&fe.appMinorVersion))||/\bMinefield\b/i.test($)&&"a")&&(St=/b/i.test(B)?"beta":"alpha",ge=ge.replace(RegExp(B+"\\+?$"),"")+(St=="beta"?Wt:yt)+(/\d+\+?/.exec(B)||"")),_e=="Fennec"||_e=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(K))_e="Firefox Mobile";else if(_e=="Maxthon"&&ge)ge=ge.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(ct))ct=="Xbox 360"&&(K=null),ct=="Xbox 360"&&/\bIEMobile\b/.test($)&&we.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(_e)&&(!_e||ct||/Browser|Mobi/.test(_e))||K!="Windows CE"&&!/Mobi/i.test($))if(_e=="IE"&&ue)try{Z.external===null&&we.unshift("platform preview")}catch{we.unshift("embedded")}else(/\bBlackBerry\b/.test(ct)||/\bBB10\b/.test($))&&(B=(RegExp(ct.replace(/ +/g," *")+"/([.\\d]+)","i").exec($)||0)[1]||ge)?(K=((B=[B,/BB10/.test($)])[1]?(ct=null,X="BlackBerry"):"Device Software")+" "+B[0],ge=null):this!=L&&ct!="Wii"&&(ue&&Tt||/Opera/.test(_e)&&/\b(?:MSIE|Firefox)\b/i.test($)||_e=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(K)||_e=="IE"&&(K&&!/^Win/.test(K)&&ge>5.5||/\bWindows XP\b/.test(K)&&ge>8||ge==8&&!/\bTrident\b/.test($)))&&!M.test(B=z.call(L,$.replace(M,"")+";"))&&B.name&&(B="ing as "+B.name+((B=B.version)?" "+B:""),M.test(_e)?(/\bIE\b/.test(B)&&K=="Mac OS"&&(K=null),B="identify"+B):(B="mask"+B,_e=Le?x(Le.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(B)&&(K=null),ue||(ge=null)),be=["Presto"],we.push(B));else _e+=" Mobile";(B=(/\bAppleWebKit\/([\d.]+\+?)/i.exec($)||0)[1])&&(B=[parseFloat(B.replace(/\.(\d)$/,".0$1")),B],_e=="Safari"&&B[1].slice(-1)=="+"?(_e="WebKit Nightly",St="alpha",ge=B[1].slice(0,-1)):ge!=B[1]&&ge!=(B[2]=(/\bSafari\/([\d.]+\+?)/i.exec($)||0)[1])||(ge=null),B[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec($)||0)[1],B[0]==537.36&&B[2]==537.36&&parseFloat(B[1])>=28&&be=="WebKit"&&(be=["Blink"]),ue&&(Ee||B[1])?(be&&(be[1]="like Chrome"),B=B[1]||((B=B[0])<530?1:B<532?2:B<532.05?3:B<533?4:B<534.03?5:B<534.07?6:B<534.1?7:B<534.13?8:B<534.16?9:B<534.24?10:B<534.3?11:B<535.01?12:B<535.02?"13+":B<535.07?15:B<535.11?16:B<535.19?17:B<536.05?18:B<536.1?19:B<537.01?20:B<537.11?"21+":B<537.13?23:B<537.18?24:B<537.24?25:B<537.36?26:be!="Blink"?"27":"28")):(be&&(be[1]="like Safari"),B=(B=B[0])<400?1:B<500?2:B<526?3:B<533?4:B<534?"4+":B<535?5:B<537?6:B<538?7:B<601?8:B<602?9:B<604?10:B<606?11:B<608?12:"12"),be&&(be[1]+=" "+(B+=typeof B=="number"?".x":/[.+]/.test(B)?"":"+")),_e=="Safari"&&(!ge||parseInt(ge)>45)?ge=B:_e=="Chrome"&&/\bHeadlessChrome/i.test($)&&we.unshift("headless")),_e=="Opera"&&(B=/\bzbov|zvav$/.exec(K))?(_e+=" ",we.unshift("desktop mode"),B=="zvav"?(_e+="Mini",ge=null):_e+="Mobile",K=K.replace(RegExp(" *"+B+"$"),"")):_e=="Safari"&&/\bChrome\b/.exec(be&&be[1])?(we.unshift("desktop mode"),_e="Chrome Mobile",ge=null,/\bOS X\b/.test(K)?(X="Apple",K="iOS 4.3+"):K=null):/\bSRWare Iron\b/.test(_e)&&!ge&&(ge=Ae("Chrome")),ge&&ge.indexOf(B=/[\d.]+$/.exec(K))==0&&$.indexOf("/"+B+"-")>-1&&(K=J(K.replace(B,""))),K&&K.indexOf(_e)!=-1&&!RegExp(_e+" OS").test(K)&&(K=K.replace(RegExp(" *"+D(_e)+" *"),"")),be&&!/\b(?:Avant|Nook)\b/.test(_e)&&(/Browser|Lunascape|Maxthon/.test(_e)||_e!="Safari"&&/^iOS/.test(K)&&/\bSafari\b/.test(be[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(_e)&&be[1])&&(B=be[be.length-1])&&we.push(B),we.length&&(we=["("+we.join("; ")+")"]),X&&ct&&ct.indexOf(X)<0&&we.push("on "+X),ct&&we.push((/^on /.test(we[we.length-1])?"":"on ")+ct),K&&(B=/ ([\d.+]+)$/.exec(K),me=B&&K.charAt(K.length-B[0].length-1)=="/",K={architecture:32,family:B&&!me?K.replace(B[0],""):K,version:B?B[1]:null,toString:function(){var Ne=this.version;return this.family+(Ne&&!me?" "+Ne:"")+(this.architecture==64?" 64-bit":"")}}),(B=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(Ce))&&!/\bi686\b/i.test(Ce)?(K&&(K.architecture=64,K.family=K.family.replace(RegExp(" *"+B),"")),_e&&(/\bWOW64\b/i.test($)||ue&&/\w(?:86|32)$/.test(fe.cpuClass||fe.platform)&&!/\bWin64; x64\b/i.test($))&&we.unshift("32-bit")):K&&/^OS X/.test(K.family)&&_e=="Chrome"&&parseFloat(ge)>=39&&(K.architecture=64),$||($=null);var ke={};return ke.description=$,ke.layout=be&&be[0],ke.manufacturer=X,ke.name=_e,ke.prerelease=St,ke.product=ct,ke.ua=$,ke.version=_e&&ge,ke.os=K||{architecture:null,family:null,version:null,toString:function(){return"null"}},ke.parse=z,ke.toString=function(){return this.description||""},ke.version&&we.unshift(ge),ke.name&&we.unshift(_e),K&&_e&&(K!=String(K).split(" ")[0]||K!=_e.split(" ")[0]&&!ct)&&we.push(ct?"("+K+")":"on "+K),we.length&&(ke.description=we.join(" ")),ke}();d&&f?L(ne,function(z,$){d[$]=z}):c.platform=ne}).call(Pv)});var Pj={accountId:{type:"string",allowEmpty:!1},content:{type:"object",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number",allowEmpty:!1}}},messages:{type:"array",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number"},role:{type:"enum",values:["assistant","user","system"]}}},promptVariables:{type:"jsonstr",required:!1},modelConfigParams:{type:"object",required:!1,rules:{prompt:{type:"string",required:!1},maxTokens:{type:"number",required:!1},topP:{type:"number",required:!1},temperature:{type:"number",required:!1}}},aiStream:{type:"boolean",required:!1}};Object.assign({requestId:{type:"string",allowEmpty:!1}},Pj);var KR={sceneName:{type:"string",required:!1},name:{type:"string",required:!1}},Lj=Object.assign(Object.assign({},KR),{duration:{type:"number",required:!1}});Object.assign(Object.assign({},Lj),{width:{type:"number",required:!1},height:{type:"number",required:!1}});Object.assign(Object.assign({},KR),{width:{type:"number",required:!1},height:{type:"number",required:!1}});var Xn={teamId:1,name:3,teamType:{id:4,retConverter:s=>+s==0?1:+s},ownerAccountId:5,memberLimit:{id:6,retType:"number"},isValidTeam:{id:8,retConverter:(s,n)=>+s==1&&(n[13]===void 0||+n[13]==1)},memberCount:{id:9,retType:"number"},memberUpdateTime:{id:10,retType:"number"},createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},intro:14,announcement:15,joinMode:{id:16,retType:"number"},serverExtension:18,customerExtension:19,avatar:20,agreeMode:{id:21,retType:"number"},inviteMode:{id:22,retType:"number"},updateInfoMode:{id:23,retType:"number"},updateExtensionMode:{id:24,retType:"number"},chatBannedMode:{id:101,retType:"number"}},pu={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},joinTime:{id:10,retType:"number"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,followAccountIds:{id:16,retConverter:s=>{try{return JSON.parse(s)}catch{return[]}}}},_p={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,joinTime:{id:15,retType:"number"},followAccountIds:{id:17,retConverter:s=>{try{return JSON.parse(s)}catch{return[]}}}};Re(Xn),Re(Xn),Re(Xn),Re(Xn),Re(Xn),Re(Xn),Re(Xn),Re(Xn),Re(Xn),Re(Xn),Re(pu),Re(_p),Re(pu),Re(_p),Re(pu),Re(Xn),Re(Xn),Re(pu),Re(pu),Re(Xn),Re(Xn),Re(_p),Re(_p);function Vj(s,n){if(!n)return"";switch(s){case 100:return n.raw||"";case 1:case 3:case 2:case 6:return function(d){var f=d,{width:m,height:y,duration:M,path:S,file:E,raw:b,ctx:R,payload:x,bucketName:L,objectName:q,token:D,ext:G}=f,J=Q_(f,["width","height","duration","path","file","raw","ctx","payload","bucketName","objectName","token","ext"]),ne=typeof G=="string"&&G[0]==="."?G.slice(1):G;return JSON.stringify(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},J),G===void 0?{}:{ext:ne}),m===void 0?{}:{w:m}),y===void 0?{}:{h:y}),M===void 0?{}:{dur:M}))}(n);case 4:return function(d){return JSON.stringify({lat:d.latitude,lng:d.longitude,title:d.address})}(n);case 12:return function(d){var f=Q_(d,["raw"]);try{return JSON.stringify(Object.assign(Object.assign({},f),{durations:d.durations.map(m=>({accid:m.accountId,duration:m.duration}))}))}catch{return JSON.stringify(d)}}(n);default:return n.raw||JSON.stringify(n)}}function Dj(s,n){var c;try{switch(c=JSON.parse(s),n){case 100:return{raw:s};case 4:return function(f,m){return{latitude:m.lat,longitude:m.lng,address:m.title,raw:f}}(s,c);case 2:case 3:case 1:case 6:return function(f,m){var{w:y,h:M,dur:S,ext:E}=m,b=Q_(m,["w","h","dur","ext"]),R=typeof E=="string"&&E[0]!=="."?`.${E}`:E;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},b),E===void 0?{}:{ext:R}),y===void 0?{}:{width:y}),M===void 0?{}:{height:M}),S===void 0?{}:{duration:S}),{raw:f})}(s,c);case 12:return function(f,m){return Object.assign(Object.assign({},m),{durations:m.durations.map(y=>({accountId:y.accid,duration:y.duration})),raw:f})}(s,c);default:return typeof c=="object"&&c?Object.assign(Object.assign({},c),{raw:s}):{raw:s}}}catch{return typeof c=="object"&&c?Object.assign(Object.assign({},c),{raw:s}):{raw:s}}}var cr={conversationType:{id:0,converter:YR,retConverter:VM},receiverId:1,senderId:2,fromClientType:4,fromDeviceId:5,fromNick:6,createTime:{id:7,retType:"number"},messageType:{id:8,retType:"number"},text:9,attachment:{id:10,converter:(s,n)=>Vj(n.messageType,s),retConverter:(s,n)=>Dj(s,Number(n[8]))},messageClientId:11,messageServerId:12,resend:{id:13,converter:sr,retType:"boolean"},userUpdateTime:{id:14,retType:"number"},serverExtension:15,pushPayload:{id:16,access:"pushConfig.pushPayload"},pushContent:{id:17,access:"pushConfig.pushContent"},forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:s=>{if(s["pushConfig.forcePush"])return"#%@all@%#"},converter:(s,n)=>{if(n["pushConfig.forcePush"])return s?JSON.stringify(s):"#%@all@%#"},retConverter(s){if(s!=="#%@all@%#"&&s)try{return JSON.parse(s)}catch{return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,access:"pushConfig.forcePush",converter:sr,retType:"boolean"},antispamCustomMessageEnabled:{id:21,def:s=>Kr(s,"antispamConfig.antispamCustomMessage")?1:void 0,retConverter:()=>{}},antispamCustomMessage:{id:22,access:"antispamConfig.antispamCustomMessage"},antispamBusinessId:{id:23,access:"antispamConfig.antispamBusinessId"},clientAntispamHit:{id:24,access:"clientAntispamHit",converter:sr,retType:"boolean"},antispamEnabled:{id:25,access:"antispamConfig.antispamEnabled",converter:sr,retType:"boolean"},needAck:{id:26,access:"messageConfig.readReceiptEnabled",converter:sr,retType:"boolean"},lastMessageUpdateEnabled:{id:28,access:"messageConfig.lastMessageUpdateEnabled",converter:sr,retType:"boolean"},threadReplySenderId:{id:29,access:"threadReply.senderId"},threadReplyReceiverId:{id:30,access:"threadReply.receiverId"},threadReplyTime:{id:31,access:"threadReply.createTime",retType:"number"},threadReplyServerId:{id:32,access:"threadReply.messageServerId"},threadReplyClientId:{id:33,access:"threadReply.messageClientId"},threadRootSenderId:{id:34,access:"threadRoot.senderId"},threadRootReceiverId:{id:35,access:"threadRoot.receiverId"},threadRootTime:{id:36,access:"threadRoot.createTime",retType:"number"},threadRootServerId:{id:37,access:"threadRoot.messageServerId"},threadRootClientId:{id:38,access:"threadRoot.messageClientId"},isDeleted:{id:39,converter:sr,retType:"boolean"},callbackExtension:40,subType:{id:41,retType:"number"},antispamCheating:{id:42,access:"antispamConfig.antispamCheating"},routeEnvironment:{id:43,access:"routeConfig.routeEnvironment"},antispamExtension:{id:44,access:"antispamConfig.antispamExtension"},antispamResult:45,__clientExt:{id:46,converter:du,retConverter:Xp},robotFunction:{id:47,access:"robotConfig.function"},robotTopic:{id:48,access:"robotConfig.topic"},robotCustomContent:{id:49,access:"robotConfig.customContent"},robotAccount:{id:50,access:"robotConfig.accountId"},_conversationOnlineSyncNotify:{id:51},_conversationOnlineSyncData:{id:52},aiAgentMsgDirection:{id:55,access:"aiConfig.aiStatus",retAccess:"aiConfig.aiStatus",retType:"number"},aiAgentAccount:{id:56,access:"aiConfig.accountId",retAccess:"aiConfig.accountId"},aiAgentContent:{id:57,access:"aiConfig.content",converter:du,retConverter:uu},aiAgentMessages:{id:58,access:"aiConfig.messages",converter:du,retConverter:uu},aiAgentPromptVariables:{id:59,access:"aiConfig.promptVariables",retConverter:uu},aiAgentModelConfigParams:{id:60,access:"aiConfig.modelConfigParams",converter:du,retConverter:uu},errorCode:{id:61,access:"messageStatus.errorCode",converter:uu,retType:"number"},modifyTime:{id:62,retType:"number"},modifyAccountId:63,aiStream:{id:65,access:"aiConfig.aiStream",converter:sr,retConverter:sj},aiRAGs:{id:66,access:"aiConfig.aiRAGs",retConverter:function(n){try{var c=JSON.parse(n);return c&&c.length>0?c.map(d=>(d.description=d.desc,delete d.desc,d)):[]}catch{return[]}}},aiStreamStatus:{id:67,access:"aiConfig.aiStreamStatus",retType:"number"},historyEnabled:{id:100,access:"messageConfig.historyEnabled",converter:sr,retType:"boolean"},roamingEnabled:{id:101,access:"messageConfig.roamingEnabled",converter:sr,retType:"boolean"},onlineSyncEnabled:{id:102,access:"messageConfig.onlineSyncEnabled",converter:sr,retType:"boolean"},routeEnabled:{id:105,access:"routeConfig.routeEnabled",converter:sr,retType:"boolean"},pushEnable:{id:107,access:"pushConfig.pushEnabled",converter:sr,retType:"boolean"},offlineEnabled:{id:108,access:"messageConfig.offlineEnabled",converter:sr,retType:"boolean"},unreadEnabled:{id:109,access:"messageConfig.unreadEnabled",converter:sr,retType:"boolean"},pushNickEnabled:{id:110,access:"pushConfig.pushNickEnabled",converter:sr,retType:"boolean"},msgAckSnapshot:{id:112,retType:"number"},receiverIds:{id:154,access:"targetConfig.receiverIds",converter:du,retConverter:()=>{}},inclusive:{id:155,access:"targetConfig.inclusive",converter:s=>s?1:2,retConverter:()=>{}},newMemberVisible:{id:156,access:"targetConfig.newMemberVisible",converter:s=>s?1:2,retConverter:()=>{}}};Re(cr);var xp={conversationType:{id:1,access:"messageRefer.conversationType",retType:"number"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},messageServerId:{id:4,access:"messageRefer.messageServerId"},messageClientId:{id:5,access:"messageRefer.messageClientId"},createTime:{id:6,access:"messageRefer.createTime",retType:"number"},deleteTime:{id:7,retType:"number"},serverExtension:8};Re(xp);var Uj={version:1,md5:2,nosurl:3,thesaurus:4},y2={createTime:{id:0,retType:"number"},sysMsgType:1,receiverId:2,senderId:3,postscript:4,attach:5,pushContent:8,pushPayload:9,messageClientId:10,messageServerId:11,deleteMsgCreatetime:{id:14,retType:"number"},opeAccount:16,env:21,callbackExtension:22},Mp={receiverId:0,messageServerId:1,readCount:{id:100,retType:"number"},unreadCount:{id:101,retType:"number"},messageClientId:102,latestReadAccount:103};Re(cr),Re(cr),Re(cr),Re(cr),Re(cr),Re(cr),Re(Mp),Re(cr),Re(cr),Re(cr),Re(Mp),Re(Mp),Re(Mp),Re(y2),Re(y2),Re(xp),Re(xp),Re(xp),Re(Uj),Re(cr),Re(cr),Re(cr),Re(cr),Re(cr),Re(cr);function YR(s){return s===1?0:s===2?1:s===3?5:void 0}function VM(s){var n=parseInt(s);return n===0?1:n===1?2:n===5?3:0}var qc={timestamp:{id:0,retType:"number"},type:{id:1,retType:"number"},receiverId:2,senderId:3,postscript:4,content:5,idServer:6,offlineEnabled:{id:7,converter:sr,retConverter:function(s,n){return n[6]!=="0"&&!!parseInt(s)},access:"notificationConfig.offlineEnabled"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"},deletedIdClient:10,deletedIdServer:11,antispamEnabled:{id:12,converter:sr,retType:"boolean",access:"antispamConfig.antispamEnabled"},antispamCustomNotification:{id:13,access:"antispamConfig.antispamCustomNotification"},deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:s=>{if(s.type===101&&s["pushConfig.forcePush"])return"#%@all@%#"},converter:(s,n)=>{if(n["pushConfig.forcePush"])return s?JSON.stringify(s):"#%@all@%#"},retConverter(s){if(s!=="#%@all@%#"&&s)try{return JSON.parse(s)}catch{return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,converter:sr,retType:"boolean",access:"pushConfig.forcePush"},routeEnvironment:{id:21,access:"routeConfig.routeEnvironment"},callbackExt:22,clientNotificationId:{id:23,access:"notificationConfig.clientNotificationId"},conversationOnlineSyncNotify:24,conversationOnlineSyncData:25,routeEnabled:{id:105,converter:sr,retType:"boolean",access:"routeConfig.routeEnabled"},pushEnabled:{id:107,converter:sr,retType:"boolean",access:"pushConfig.pushEnabled"},unreadEnabled:{id:109,converter:sr,retType:"boolean",access:"notificationConfig.unreadEnabled"},pushNickEnabled:{id:110,converter:sr,retType:"boolean",access:"pushConfig.pushNickEnabled"}},_2={id:1,senderId:2,timestamp:{id:4,retType:"number"},content:5};Re(qc),Re(_2),Re(_2),Re(qc),Re(qc),Re(qc);Re(cr),Re(cr),Re(cr),Re(qc),Re(qc);var M2,T2;(function(s){s[s.nos=1]="nos",s[s.s3=2]="s3"})(M2||(M2={})),function(s){s[s.dontNeed=-1]="dontNeed",s[s.time=2]="time",s[s.urls=3]="urls"}(T2||(T2={}));var Po={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4,policyVersion:5},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}};er(Po.nosToken),er(Po.nosSafeUrlTag),er(Po.nosConfigTag),er(Po.grayConfigTag),er(Po.mixStorePolicyTag),er(Po.mixStoreTokenResTag),er(Po.mixStoreAuthTokenResTag),er(Po.nosAccessTokenTag);var hu={id:1,ext:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}};Re(hu),Re(hu),Re(hu),Re(hu),Re(hu);var I2;(function(s){s[s.createConversation=1]="createConversation",s[s.deleteConversation=2]="deleteConversation",s[s.updateConversation=3]="updateConversation",s[s.setConversationTop=4]="setConversationTop",s[s.clearConversationUnread=5]="clearConversationUnread",s[s.addConversationToGroup=6]="addConversationToGroup",s[s.removeConversationFromGroup=7]="removeConversationFromGroup",s[s.modifyConversationOnSendMessage=8]="modifyConversationOnSendMessage",s[s.modifyConversationOnDeleteMessage=9]="modifyConversationOnDeleteMessage",s[s.modifyConversationOnRecallMessage=10]="modifyConversationOnRecallMessage",s[s.modifyConversationOnClearMessage=11]="modifyConversationOnClearMessage",s[s.oneClickClearConversationUnread=12]="oneClickClearConversationUnread",s[s.modifyConversationOnUpdateMessage=13]="modifyConversationOnUpdateMessage"})(I2||(I2={}));var Bn={conversationId:1,type:2,serverExtension:3,groupIds:4,lastMessage:5,lastMessageState:6,unreadCount:7,stickTop:8,sortOrder:9,version:10,deleteFlag:11,createTime:12,updateTime:13},Tp={type:1,oneClickClearUnreadType:2,oneClickClearUnreadConversationType:3,oneClickClearUnreadGroupId:4,oneClickClearUnreadVersion:5,deleteConversationClearMessage:6};er(Bn),er(Bn),er(Bn),er(Bn),er(Bn),er(Bn),er(Bn),er(Bn),er(Bn),er(Bn),er(Bn),er(Tp),er(Bn),er(Tp),er(Tp),er(Tp);var S2;(function(s){s[s.createConversationGroup=1]="createConversationGroup",s[s.deleteConversationGroup=2]="deleteConversationGroup",s[s.updateConversationGroup=3]="updateConversationGroup",s[s.addConversationToGroup=4]="addConversationToGroup",s[s.removeConversationFromGroup=5]="removeConversationFromGroup"})(S2||(S2={}));var Oc={groupId:1,name:2,serverExtension:3,createTime:4,updateTime:5};er(Oc),er(Bn),er(Oc),er(Oc),er(Oc),er(Oc),er(Bn),er(Bn),er(Oc);var E2={conversationType:{id:0,retType:"number"},receiverId:1,deleteRoam:{id:2,converter:sr},teamId:3,onlineSync:{id:4,converter:sr},deleteTime:{id:6,retType:"number"},serverExtension:7};Re(cr),Re(cr),Re(cr),Re(cr),Re(E2),Re(E2);var Fj={conversationType:{id:1,converter:YR,retConverter:VM,access:"messageRefer.conversationType"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},createTime:{id:4,retType:"number",access:"messageRefer.createTime"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},detail:7,modify:{id:8,retType:"number"}},Bj={conversationType:{id:1,access:"messageRefer.conversationType",retConverter:VM},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},time:{id:4,access:"messageRefer.createTime",converter:sr,retType:"number"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},operatorId:7,serverExtension:8,createTime:{id:9,converter:sr,retType:"number"},updateTime:{id:10,converter:sr,retType:"number"}},C2={operatorId:1,index:{id:2,retType:"number"},createTime:{id:3,retType:"number"},serverExtension:4,pushEnabled:{id:5,access:"pushConfig.pushEnabled",converter:sr},needBadge:{id:6,access:"pushConfig.needBadge",converter:sr},title:{id:7,access:"pushConfig.title"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"}},Fv={accid:1,serverExtension:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},Bv={collectionId:1,collectionType:{id:2,retType:"number"},collectionData:3,serverExtension:4,uniqueId:5,createTime:{id:6,retType:"number"},updateTime:{id:7,retType:"number"}},qj={keyword:1,beginTime:2,endTime:3,messageLimit:5,sortOrder:{id:6,converter:s=>s===0?2:1},p2pAccountIds:{id:7,converter:s=>s.join(",")},teamIds:{id:8,converter:s=>s.join(",")},senderAccountIds:{id:9,converter:s=>s.join(",")},messageTypes:{id:10,converter:s=>s.join(",")},messageSubtypes:{id:11,converter:s=>s.join(",")}};Object.assign(Object.assign({},qj),{conversationLimit:4});Re(Bj),Re(cr),Re(C2),Re(cr),Re(C2),Re(Fj),Re(cr),Re(Fv),Re(cr),Re(Fv),Re(cr),Re(Fv),Re(Bv),Re(Bv),Re(Bv),Re(cr),Re(cr),Re(cr),Re(cr),Re({total:{id:1,retType:"number"},timestamp:{id:2,retType:"number"}}),Re(cr);var b2,WR={joinMode:{type:"enum",values:[1,0,2],required:!1},agreeMode:{type:"enum",values:[0,1],required:!1},inviteMode:{type:"enum",values:[1,0],required:!1},updateInfoMode:{type:"enum",values:[1,0],required:!1},updateExtensionMode:{type:"enum",values:[1,0],required:!1},chatBannedMode:{type:"enum",values:[0,1],required:!1}};Object.assign({name:{type:"string",allowEmpty:!1},teamType:{type:"enum",values:[1,2]},memberLimit:{type:"number",min:1,required:!1}},WR);var A2={type:"string"};Object.assign(Object.assign({},A2),{required:!1}),Object.assign(Object.assign({},A2),{required:!1});Object.assign({name:{type:"string",allowEmpty:!1,required:!1},memberLimit:{type:"number",min:1,required:!1}},WR);(function(s){s[s.TEAM_INVITATION=0]="TEAM_INVITATION",s[s.TEAM_KICK=1]="TEAM_KICK",s[s.TEAM_LEAVE=2]="TEAM_LEAVE",s[s.TEAM_UPDATED=3]="TEAM_UPDATED",s[s.TEAM_DISMISS=4]="TEAM_DISMISS",s[s.TEAM_APPLY_ACCEPT=5]="TEAM_APPLY_ACCEPT",s[s.TEAM_TRANSFER_OWNER=6]="TEAM_TRANSFER_OWNER",s[s.TEAM_ADD_MANAGER=7]="TEAM_ADD_MANAGER",s[s.TEAM_REMOVE_MANAGER=8]="TEAM_REMOVE_MANAGER",s[s.TEAM_INVITE_ACCEPT=9]="TEAM_INVITE_ACCEPT",s[s.TEAM_MEMBER_MUTE=10]="TEAM_MEMBER_MUTE",s[s.SUPER_TEAM_INVITATION=401]="SUPER_TEAM_INVITATION",s[s.SUPER_TEAM_KICK=402]="SUPER_TEAM_KICK",s[s.SUPER_TEAM_LEAVE=403]="SUPER_TEAM_LEAVE",s[s.SUPER_TEAM_UPDATE=404]="SUPER_TEAM_UPDATE",s[s.SUPER_TEAM_DISMISS=405]="SUPER_TEAM_DISMISS",s[s.SUPER_TEAM_TRANSFER_OWNER=406]="SUPER_TEAM_TRANSFER_OWNER",s[s.SUPER_TEAM_ADD_MANAGER=407]="SUPER_TEAM_ADD_MANAGER",s[s.SUPER_TEAM_REMOVE_MANAGER=408]="SUPER_TEAM_REMOVE_MANAGER",s[s.SUPER_TEAM_MEMBER_MUTE=409]="SUPER_TEAM_MEMBER_MUTE",s[s.SUPER_TEAM_APPLY_ACCEPT=410]="SUPER_TEAM_APPLY_ACCEPT",s[s.SUPER_TEAM_INVITE_ACCEPT=411]="SUPER_TEAM_INVITE_ACCEPT"})(b2||(b2={}));var Pp={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"}};Re(Pp),Re(Pp),Re({accountId:0,isMute:{id:1,retType:"boolean"},isBlock:{id:2,retType:"boolean"}}),Re(Pp);var qv={accountId:4,relationShip:{id:5,retType:"number"},source:{id:7,retType:"number"},alias:8,serverExtension:10,createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},customerExtension:13};Re({serverExt:1}),Re(qv),Re(qv),Re(Pp),Re(qv);var Js=Js||function(s){var n;typeof window<"u"&&window.crypto&&(n=window.crypto),typeof self<"u"&&self.crypto&&(n=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(n=globalThis.crypto),!n&&typeof window<"u"&&window.msCrypto&&(n=window.msCrypto),!n&&typeof global<"u"&&global.crypto&&(n=global.crypto);var c=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},d=Object.create||function(){function q(){}return function(D){var G;return q.prototype=D,G=new q,q.prototype=null,G}}(),f={},m=f.lib={},y=m.Base={extend:function(q){var D=d(this);return q&&D.mixIn(q),D.hasOwnProperty("init")&&this.init!==D.init||(D.init=function(){D.$super.init.apply(this,arguments)}),D.init.prototype=D,D.$super=this,D},create:function(){var q=this.extend();return q.init.apply(q,arguments),q},init:function(){},mixIn:function(q){for(var D in q)q.hasOwnProperty(D)&&(this[D]=q[D]);q.hasOwnProperty("toString")&&(this.toString=q.toString)},clone:function(){return this.init.prototype.extend(this)}},M=m.WordArray=y.extend({init:function(q,D){q=this.words=q||[],this.sigBytes=D??4*q.length},toString:function(q){return(q||E).stringify(this)},concat:function(q){var D=this.words,G=q.words,J=this.sigBytes,ne=q.sigBytes;if(this.clamp(),J%4)for(var z=0;z<ne;z++){var $=G[z>>>2]>>>24-z%4*8&255;D[J+z>>>2]|=$<<24-(J+z)%4*8}else for(var Z=0;Z<ne;Z+=4)D[J+Z>>>2]=G[Z>>>2];return this.sigBytes+=ne,this},clamp:function(){var q=this.words,D=this.sigBytes;q[D>>>2]&=4294967295<<32-D%4*8,q.length=s.ceil(D/4)},clone:function(){var q=y.clone.call(this);return q.words=this.words.slice(0),q},random:function(q){for(var D=[],G=0;G<q;G+=4)D.push(c());return new M.init(D,q)}}),S=f.enc={},E=S.Hex={stringify:function(q){for(var D=q.words,G=q.sigBytes,J=[],ne=0;ne<G;ne++){var z=D[ne>>>2]>>>24-ne%4*8&255;J.push((z>>>4).toString(16)),J.push((15&z).toString(16))}return J.join("")},parse:function(q){for(var D=q.length,G=[],J=0;J<D;J+=2)G[J>>>3]|=parseInt(q.substr(J,2),16)<<24-J%8*4;return new M.init(G,D/2)}},b=S.Latin1={stringify:function(q){for(var D=q.words,G=q.sigBytes,J=[],ne=0;ne<G;ne++){var z=D[ne>>>2]>>>24-ne%4*8&255;J.push(String.fromCharCode(z))}return J.join("")},parse:function(q){for(var D=q.length,G=[],J=0;J<D;J++)G[J>>>2]|=(255&q.charCodeAt(J))<<24-J%4*8;return new M.init(G,D)}},R=S.Utf8={stringify:function(q){try{return decodeURIComponent(escape(b.stringify(q)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(q){return b.parse(unescape(encodeURIComponent(q)))}},x=m.BufferedBlockAlgorithm=y.extend({reset:function(){this._data=new M.init,this._nDataBytes=0},_append:function(q){typeof q=="string"&&(q=R.parse(q)),this._data.concat(q),this._nDataBytes+=q.sigBytes},_process:function(q){var D,G=this._data,J=G.words,ne=G.sigBytes,z=this.blockSize,$=ne/(4*z),Z=($=q?s.ceil($):s.max((0|$)-this._minBufferSize,0))*z,le=s.min(4*Z,ne);if(Z){for(var fe=0;fe<Z;fe+=z)this._doProcessBlock(J,fe);D=J.splice(0,Z),G.sigBytes-=le}return new M.init(D,le)},clone:function(){var q=y.clone.call(this);return q._data=this._data.clone(),q},_minBufferSize:0});m.Hasher=x.extend({cfg:y.extend(),init:function(q){this.cfg=this.cfg.extend(q),this.reset()},reset:function(){x.reset.call(this),this._doReset()},update:function(q){return this._append(q),this._process(),this},finalize:function(q){return q&&this._append(q),this._doFinalize()},blockSize:16,_createHelper:function(q){return function(D,G){return new q.init(G).finalize(D)}},_createHmacHelper:function(q){return function(D,G){return new L.HMAC.init(q,G).finalize(D)}}});var L=f.algo={};return f}(Math);Js.enc.Utf8;var DM=Js,JR=DM.lib,R2=JR.Base,Gj=JR.WordArray,QR=DM.algo,jj=QR.MD5,Hj=QR.EvpKDF=R2.extend({cfg:R2.extend({keySize:4,hasher:jj,iterations:1}),init:function(s){this.cfg=this.cfg.extend(s)},compute:function(s,n){for(var c,d=this.cfg,f=d.hasher.create(),m=Gj.create(),y=m.words,M=d.keySize,S=d.iterations;y.length<M;){c&&f.update(c),c=f.update(s).finalize(n),f.reset();for(var E=1;E<S;E++)c=f.finalize(c),f.reset();m.concat(c)}return m.sigBytes=4*M,m}});DM.EvpKDF=function(s,n,c){return Hj.create(c).compute(s,n)},Js.EvpKDF;var zR=Js,$j=zR.lib.WordArray;zR.enc.Base64={stringify:function(s){var n=s.words,c=s.sigBytes,d=this._map;s.clamp();for(var f=[],m=0;m<c;m+=3)for(var y=(n[m>>>2]>>>24-m%4*8&255)<<16|(n[m+1>>>2]>>>24-(m+1)%4*8&255)<<8|n[m+2>>>2]>>>24-(m+2)%4*8&255,M=0;M<4&&m+.75*M<c;M++)f.push(d.charAt(y>>>6*(3-M)&63));var S=d.charAt(64);if(S)for(;f.length%4;)f.push(S);return f.join("")},parse:function(s){var n=s.length,c=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var f=0;f<c.length;f++)d[c.charCodeAt(f)]=f}var m=c.charAt(64);if(m){var y=s.indexOf(m);y!==-1&&(n=y)}return function(S,E,b){for(var R=[],x=0,L=0;L<E;L++)if(L%4){var q=b[S.charCodeAt(L-1)]<<L%4*2|b[S.charCodeAt(L)]>>>6-L%4*2;R[x>>>2]|=q<<24-x%4*8,x++}return $j.create(R,x)}(s,n,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},Js.enc.Base64,function(s){s.lib.Cipher||function(){var n=s,c=n.lib,d=c.Base,f=c.WordArray,m=c.BufferedBlockAlgorithm,y=n.enc;y.Utf8;var M=y.Base64,S=n.algo.EvpKDF,E=c.Cipher=m.extend({cfg:d.extend(),createEncryptor:function(z,$){return this.create(this._ENC_XFORM_MODE,z,$)},createDecryptor:function(z,$){return this.create(this._DEC_XFORM_MODE,z,$)},init:function(z,$,Z){this.cfg=this.cfg.extend(Z),this._xformMode=z,this._key=$,this.reset()},reset:function(){m.reset.call(this),this._doReset()},process:function(z){return this._append(z),this._process()},finalize:function(z){return z&&this._append(z),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function z($){return typeof $=="string"?ne:G}return function($){return{encrypt:function(Z,le,fe){return z(le).encrypt($,Z,le,fe)},decrypt:function(Z,le,fe){return z(le).decrypt($,Z,le,fe)}}}}()});c.StreamCipher=E.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var b=n.mode={},R=c.BlockCipherMode=d.extend({createEncryptor:function(z,$){return this.Encryptor.create(z,$)},createDecryptor:function(z,$){return this.Decryptor.create(z,$)},init:function(z,$){this._cipher=z,this._iv=$}}),x=b.CBC=function(){var z=R.extend();function $(Z,le,fe){var oe,B=this._iv;B?(oe=B,this._iv=void 0):oe=this._prevBlock;for(var me=0;me<fe;me++)Z[le+me]^=oe[me]}return z.Encryptor=z.extend({processBlock:function(Z,le){var fe=this._cipher,oe=fe.blockSize;$.call(this,Z,le,oe),fe.encryptBlock(Z,le),this._prevBlock=Z.slice(le,le+oe)}}),z.Decryptor=z.extend({processBlock:function(Z,le){var fe=this._cipher,oe=fe.blockSize,B=Z.slice(le,le+oe);fe.decryptBlock(Z,le),$.call(this,Z,le,oe),this._prevBlock=B}}),z}(),L=(n.pad={}).Pkcs7={pad:function(z,$){for(var Z=4*$,le=Z-z.sigBytes%Z,fe=le<<24|le<<16|le<<8|le,oe=[],B=0;B<le;B+=4)oe.push(fe);var me=f.create(oe,le);z.concat(me)},unpad:function(z){var $=255&z.words[z.sigBytes-1>>>2];z.sigBytes-=$}};c.BlockCipher=E.extend({cfg:E.cfg.extend({mode:x,padding:L}),reset:function(){var z;E.reset.call(this);var $=this.cfg,Z=$.iv,le=$.mode;this._xformMode==this._ENC_XFORM_MODE?z=le.createEncryptor:(z=le.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==z?this._mode.init(this,Z&&Z.words):(this._mode=z.call(le,this,Z&&Z.words),this._mode.__creator=z)},_doProcessBlock:function(z,$){this._mode.processBlock(z,$)},_doFinalize:function(){var z,$=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?($.pad(this._data,this.blockSize),z=this._process(!0)):(z=this._process(!0),$.unpad(z)),z},blockSize:4});var q=c.CipherParams=d.extend({init:function(z){this.mixIn(z)},toString:function(z){return(z||this.formatter).stringify(this)}}),D=(n.format={}).OpenSSL={stringify:function(z){var $=z.ciphertext,Z=z.salt;return(Z?f.create([1398893684,1701076831]).concat(Z).concat($):$).toString(M)},parse:function(z){var $,Z=M.parse(z),le=Z.words;return le[0]==1398893684&&le[1]==1701076831&&($=f.create(le.slice(2,4)),le.splice(0,4),Z.sigBytes-=16),q.create({ciphertext:Z,salt:$})}},G=c.SerializableCipher=d.extend({cfg:d.extend({format:D}),encrypt:function(z,$,Z,le){le=this.cfg.extend(le);var fe=z.createEncryptor(Z,le),oe=fe.finalize($),B=fe.cfg;return q.create({ciphertext:oe,key:Z,iv:B.iv,algorithm:z,mode:B.mode,padding:B.padding,blockSize:z.blockSize,formatter:le.format})},decrypt:function(z,$,Z,le){return le=this.cfg.extend(le),$=this._parse($,le.format),z.createDecryptor(Z,le).finalize($.ciphertext)},_parse:function(z,$){return typeof z=="string"?$.parse(z,this):z}}),J=(n.kdf={}).OpenSSL={execute:function(z,$,Z,le){le||(le=f.random(8));var fe=S.create({keySize:$+Z}).compute(z,le),oe=f.create(fe.words.slice($),4*Z);return fe.sigBytes=4*$,q.create({key:fe,iv:oe,salt:le})}},ne=c.PasswordBasedCipher=G.extend({cfg:G.cfg.extend({kdf:J}),encrypt:function(z,$,Z,le){var fe=(le=this.cfg.extend(le)).kdf.execute(Z,z.keySize,z.ivSize);le.iv=fe.iv;var oe=G.encrypt.call(this,z,$,fe.key,le);return oe.mixIn(fe),oe},decrypt:function(z,$,Z,le){le=this.cfg.extend(le),$=this._parse($,le.format);var fe=le.kdf.execute(Z,z.keySize,z.ivSize,$.salt);return le.iv=fe.iv,G.decrypt.call(this,z,$,fe.key,le)}})}()}(Js);var Eh=Js,UM=Eh.lib.StreamCipher,XR=Eh.algo,Lp=XR.RC4=UM.extend({_doReset:function(){for(var s=this._key,n=s.words,c=s.sigBytes,d=this._S=[],f=0;f<256;f++)d[f]=f;f=0;for(var m=0;f<256;f++){var y=f%c,M=n[y>>>2]>>>24-y%4*8&255;m=(m+d[f]+M)%256;var S=d[f];d[f]=d[m],d[m]=S}this._i=this._j=0},_doProcessBlock:function(s,n){s[n]^=ZR.call(this)},keySize:8,ivSize:0});function ZR(){for(var s=this._S,n=this._i,c=this._j,d=0,f=0;f<4;f++){c=(c+s[n=(n+1)%256])%256;var m=s[n];s[n]=s[c],s[c]=m,d|=s[(s[n]+s[c])%256]<<24-8*f}return this._i=n,this._j=c,d}Eh.RC4=UM._createHelper(Lp);var Kj=XR.RC4Drop=Lp.extend({cfg:Lp.cfg.extend({drop:192}),_doReset:function(){Lp._doReset.call(this);for(var s=this.cfg.drop;s>0;s--)ZR.call(this)}});Eh.RC4Drop=UM._createHelper(Kj);Js.RC4;var Yj={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,modelType:{id:11,retType:"number"},modelConfig:{id:12,retConverter:s=>{if(s=Xp(s)){var n=Object.keys(s).reduce((c,d)=>(c[function(m){return(m=m||"").split("_").map((y,M)=>M===0?y:y[0].toUpperCase()+y.slice(1)).join("")}(d)]=s[d],c),{});if(typeof n.promptKeys=="string")try{n.promptKeys=JSON.parse(n.promptKeys)}catch{}return n}}},yunxinConfig:{id:13,retConverter:s=>{if(s=Xp(s))return s}},valid:{id:14,retType:"boolean"},createTime:{id:15,retType:"number"},updateTime:{id:16,retType:"number"}};function eN(s){try{var n=JSON.parse(s);return typeof n.index=="number"?{msg:n.msg||"",type:n.type,lastChunk:{content:n.msg,chunkTime:parseInt(n.timestamp),type:n.type,index:parseInt(n.index)}}:n}catch{return}}function tN(s){try{var n=JSON.parse(s);return n&&n.length>0?n.map(c=>(c.description=c.desc,delete c.desc,c)):[]}catch{return[]}}var N2={code:{id:1,retType:"number"},accountId:2,requestId:3,content:{id:4,retConverter:eN},aiRAGs:{id:5,retConverter:tN},timestamp:{id:6,retType:"number"},aiStreamStatus:{id:7,retType:"number"},aiStream:{id:8,retType:"boolean"}},Wj={serverId:1,clientId:2,type:{id:3,retType:"number"},content:{id:4,retConverter:eN},aiRAGs:{id:6,retConverter:tN}};Re(N2),Re(Yj),Re({hasMore:{id:16,retType:"boolean"},nextToken:2}),Re(cr),Re(N2),Re(Wj);var Jj={accountId:1,uid:{id:2,retType:"number"},joinTime:{id:3,retType:"number"},expireTime:{id:4,retType:"number"},deviceId:5},Zn={channelType:{id:1,retType:"number",retAccess:"channelInfo.channelType"},channelName:{id:2,retAccess:"channelInfo.channelName"},channelId:{id:3,retAccess:"channelInfo.channelId"},createTime:{id:4,retType:"number",retAccess:"channelInfo.createTime"},expireTime:{id:5,retType:"number",retAccess:"channelInfo.expireTime"},creatorAccountId:{id:6,retAccess:"channelInfo.creatorAccountId"},channelExtension:{id:7,retAccess:"channelInfo.channelExtension"},channelValid:{id:8,retDef:!0,retAccess:"channelInfo.channelValid",retConverter:s=>parseInt(s)!==1},fromAccid:10,toAccid:11,requestId:12,pushEnabled:{id:13,access:"pushConfig.pushEnabled",converter:sr,retType:"boolean"},pushTitle:{id:14,access:"pushConfig.pushTitle"},pushContent:{id:15,access:"pushConfig.pushContent"},pushPayload:{id:16,access:"pushConfig.pushPayload"},unreadEnabled:{id:17,access:"signallingConfig.unreadEnabled",converter:sr,retType:"boolean",def:1},members:{id:18,retAccess:"members",retConverter:s=>{try{return JSON.parse(s).map(n=>X_(n,Re(Jj)))}catch{return}}},attach:{id:19,retConverter:Xp},serverExtension:{id:20,retDef:""},offlineEnabled:{id:21,converter:sr,retType:"boolean",def:1},msgId:22,selfUid:{id:23,retType:"number",access:"signallingConfig.selfUid"},time:{id:24,retType:"number"},rtcChannelName:{id:25,access:"rtcConfig.rtcChannelName"},rtcTokenTtl:{id:26,retType:"number",access:"rtcConfig.rtcTokenTtl",retAccess:"rtcInfo.rtcTokenTtl"},rtcToken:{id:27,retAccess:"rtcInfo.rtcToken"},rtcParams:{id:28,access:"rtcConfig.rtcParams",retAccess:"rtcInfo.rtcParams"},callStatus:{id:30,retType:"number"}};Re(Zn),Re(Zn),Re(Zn),Re(Zn),Re(Zn),Re(Zn),Re(Zn),Re(Zn),Re(Zn),Re(Zn),Re(Zn),Re(Zn),Re(Zn),Re(Zn);var Gc,Gv={eventType:{id:1,retType:"number"},statusType:{id:2,retType:"number"},uniqueId:3,extension:4,duration:{id:5,retType:"number"},onlineOnly:{id:6,retType:"boolean",converter:s=>s?1:2},multiSync:{id:7,retType:"boolean",converter:sr},publishTime:{id:10,retType:"number"},serverId:11,clientType:{id:12,retType:"number"},serverExtension:13,extensionReceived:14,accountId:103},k2={eventType:{id:1,retType:"number"},duration:{id:2,retType:"number"},immediateSync:{id:3,retType:"number",converter:sr},accountId:102,subscribeTime:{id:105,retType:"number"}};Re(Gv),Re(Gv),Re(k2),Re(k2),Re(Gv);(function(s){s[s.V2NIM_PROXY_REQUEST_METHOD_GET=1]="V2NIM_PROXY_REQUEST_METHOD_GET",s[s.V2NIM_PROXY_REQUEST_METHOD_POST=2]="V2NIM_PROXY_REQUEST_METHOD_POST",s[s.V2NIM_PROXY_REQUEST_METHOD_PUT=3]="V2NIM_PROXY_REQUEST_METHOD_PUT",s[s.V2NIM_PROXY_REQUEST_METHOD_DELETE=4]="V2NIM_PROXY_REQUEST_METHOD_DELETE"})(Gc||(Gc={}));var Qj={zone:1,path:2,method:3,header:4,body:5};Re(Qj),Re({fromAccountId:1,body:2,time:{id:3,retType:"number"}});Gc.V2NIM_PROXY_REQUEST_METHOD_DELETE,Gc.V2NIM_PROXY_REQUEST_METHOD_GET,Gc.V2NIM_PROXY_REQUEST_METHOD_POST,Gc.V2NIM_PROXY_REQUEST_METHOD_PUT;var O2=ii;O2.registerService(class extends f2{constructor(n,c={}){var d;super("V2NIMLoginService",n),this.account="",this.previousLoginAccount="",this.token="",this.deviceId="",this.clientSession="",this.processId="",this.kickedDetail=null,this.binaryWebsocket=!0,this.core._registerDep(kj,"misc"),wp({cmdMap:aj,cmdConfig:lj}),n.options.apiVersion==="v2"&&(wp({cmdMap:cj,cmdConfig:uj}),this.core.auth=this),this.previousLoginManager=new z_,this.doLoginStepsManager=new z_,this.loginTimerManager=new VR,this.loginOption=Object.assign({},v2),this.config={lbsUrls:Oj,linkUrl:"weblink.netease.im:443",linkSSL:!0},this.setOptions(c),n.V2NIMLoginService=this,this.core.options.binaryWebsocket!==!1&&typeof Uint8Array=="function"?(this.binaryWebsocket=!0,d=new vj(this.core)):(this.binaryWebsocket=!1,d=new Mj(this.core)),this.clientSocket=d,this.core.options.apiVersion==="v2"&&(this.core.clientSocket=d),this.lifeCycle=new Cj(n),this.reconnect=new Tj(n),this.lbs=new Sj(n),this.authenticator=new Ej(n),this.dataSync=new bj(n)}get hasSettingService(){var n;return!!(!((n=this.core.V2NIMSettingService)===null||n===void 0)&&n.name)}setOptions(n){var c,d,f;Ks({lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},n,"",!0),this.config=Ru(this.config,n),(d=(c=this.core.clientSocket)===null||c===void 0?void 0:c.setLinkSSL)===null||d===void 0||d.call(c,(f=this.config.linkSSL)===null||f===void 0||f);var m="",y="";this.config.isFixedDeviceId?(m=zt.localStorage.getItem("__NIM_DEVC_ID__")||Nc(),y=zt.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||Nc(),zt.localStorage.setItem("__NIM_DEVC_ID__",m),zt.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",y)):(m=Nc(),y=Nc()),this.deviceId=m,this.clientSession=y,this.core.reporter.setConfig({common:{dev_id:m}})}reset(){this.account="",this.token="",this.processId="",this.lbs.reset(),this.reconnect.reset(),this.authenticator.reset(),this.authenticator.clearLastLoginClient(),this.dataSync.reset()}login(n,c,d={}){return tr(this,void 0,void 0,function*(){this._checkApiVersion();var f=zt.getSystemInfo()||{};if(f.os&&f.os.toLowerCase(),!n)throw new Au({detail:{reason:"Empty account"}});if(Ks({retryCount:{type:"number",min:0,required:!1},forceMode:{type:"boolean",required:!1},authType:{type:"enum",values:[0,1,2],required:!1},syncLevel:{type:"enum",values:[1,0],required:!1}},d,"",!0),d.authType===0&&!c)throw new Au({detail:{reason:"When authType is 0, token cannot be empty"}});if(this.previousLoginAccount!==""&&this.previousLoginAccount!==n&&this.core._clearModuleData(),this.getLoginStatus()===0)this.logger.log(`V2NIMLoginService::login:allowLogin:${n}`,d);else{if(this.getLoginStatus()===1)return this.smoothForLogined(n,c,d);if(this.getLoginStatus()===2)return this.smoothForLogining(n,c,d)}this.account=n,this.previousLoginAccount=n,this.token=c,this.processId=Nc(),this.loginOption=Ru(v2,d),this.kickedDetail=null,this.loginTimerManager.destroy(),this.loginTimerManager.addTimer(()=>{var m=new Gt({code:rt.V2NIM_ERROR_CODE_TIMEOUT,detail:{reason:"Login API timeout"}});this.doLoginStepsManager.clear(m),this.previousLoginManager.clear(m),this.originLoginPromise=void 0,this.lifeCycle.processEvent("exited",m)},this.loginOption.timeout>0?this.loginOption.timeout:6e4,1);try{yield this.multiTryDoLogin(),this.loginTimerManager.destroy()}catch(m){throw this.loginTimerManager.destroy(),m}})}getChatroomLinkAddress(n,c){return tr(this,void 0,void 0,function*(){Ks({roomId:{type:"string",regExp:/^\d+$/,required:!0,allowEmpty:!1},miniProgram:{type:"boolean",required:!1}},{roomId:n,miniProgram:c},"",!0);var d=r2()!=="unknow environment";return c=c===void 0?d:c,(yield this.clientSocket.sendCmd("v2GetChatroomLinkAddress",{roomId:n,miniProgram:c})).content.linkAddress})}multiTryDoLogin(n){return tr(this,void 0,void 0,function*(){for(var c=new Gt({code:rt.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"loginFailed"}}),d=0;d<=this.loginOption.retryCount;d++){var f=`V2NIMLoginService::times of login try: ${d}`;d>0?this.logger.warn(f):this.logger.log(f);try{this.originLoginPromise=n||this.doLogin(!1),n=void 0;var m=yield this.previousLoginManager.add(this.originLoginPromise);return this.core.reporter.reportTraceEnd("login",!0),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.originLoginPromise=void 0,m}catch(y){if(c=y||c,this.logger.error(`V2NIMLoginService::login failed, times of login try: ${d}, err.code: ${c==null?void 0:c.code}, err.message: "${c==null?void 0:c.message}"`),c.code!==rt.V2NIM_ERROR_CODE_CANCELLED&&this.core.reporter.reportTraceEnd("login",!1),this.reconnect.clearReconnectTimer(),this.checkLoginTerminalCode(c&&c.code))throw this.lifeCycle.processEvent("exited",c),c;c&&c.code===399&&this.lbs.reset()}}throw this.lifeCycle.processEvent("exited",c),c})}doLogin(n){var c,d;return tr(this,void 0,void 0,function*(){var f=!!n||this.authenticator.checkAutoLogin(this.loginOption.forceMode);this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",f?{user_id:this.account,action:"auto_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}:{user_id:this.account,action:"manual_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:JSON.stringify(this.loginOption),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:zt.net.getNetworkStatus()});var m=yield this.doLoginStepsManager.add(this.lbs.getLbsInfos());yield this.doLoginStepsManager.add(this.clientSocket.connect(m,n));var y=yield this.doLoginStepsManager.add(this.authenticator.verifyAuthentication(f));if(this.processId=Nc(),this.clientSocket.resetSocketConfig(),this.reconnect.reset(),this.dataSync.reset(),this.lifeCycle.processEvent("loginSucc",void 0,Object.assign(Object.assign({},y),{isReconnect:n})),this.clientSocket.ping(),this.core.abtest.abtRequest(),typeof((c=this.core.V2NIMClientAntispamUtil)===null||c===void 0?void 0:c.downloadLocalAntiSpamVocabs)=="function"&&this.core.V2NIMClientAntispamUtil.downloadLocalAntiSpamVocabs(),typeof((d=this.core.cloudStorage)===null||d===void 0?void 0:d.init)=="function")try{yield this.core.cloudStorage.init(y.timestamp)}catch(M){this.logger.warn("doLogin::cloudStorage init error",M)}return y})}smoothForLogined(n,c,d){return tr(this,void 0,void 0,function*(){var f=this.checkIsSameLogin(n,c,d);return this.logger.warn(`V2NIMLoginService::smoothForLogined:Logined, isSameLogin ${f}`),f?void 0:(yield this.logout(),this.login(n,c,d))})}smoothForLogining(n,c,d){return tr(this,void 0,void 0,function*(){var f=this.checkIsSameLogin(n,c,d);if(this.logger.warn(`V2NIMLoginService::smoothForLogining:Logining progress exists, abort the previous login attempt and start next attempt, isSameLogin ${f}`),this.previousLoginManager.clear(),this.reconnect.reset(),this.account=n,this.previousLoginAccount=n,this.token=c,this.loginOption=Ru(this.loginOption,d),!f)return this.doLoginStepsManager.clear(),this.clientSocket.doDisconnect(Rn.ACTIVE,"Aborted"),this.reset(),this.lifeCycle.processEvent("logout"),yield Promise.resolve(),this.login(n,c,d);if(!this.originLoginPromise)throw new Gt({code:rt.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"NoPreviousLoginExists"}});this.reconnect.reset(),yield Promise.resolve(),yield this.multiTryDoLogin(this.originLoginPromise)})}checkIsSameLogin(n,c,d){return this.account===n&&this.loginOption.authType===d.authType&&(d.authType!==0||this.token===c)}logout(){return tr(this,void 0,void 0,function*(){this._checkApiVersion(),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.loginTimerManager.destroy(),this.originLoginPromise=void 0;var n=this.getConnectStatus(),c=this.getLoginStatus();switch(c){case 1:try{yield this.clientSocket.sendCmd("v2Logout",void 0,{timeout:1e3}),this.clientSocket.doDisconnect(Rn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout")}catch(d){this.logger.error("Instance::disconnect sendCmd:logout error",d),this.clientSocket.doDisconnect(Rn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout")}break;case 2:case 3:this.clientSocket.doDisconnect(Rn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout");break;case 0:throw this.core._clearModuleData(),new Gt({code:rt.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:`Illegal logout. loginStatus ${c}. connectStatus ${n}`}});default:throw this.core._clearModuleData(),new Gt({code:rt.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:`Illegal logout. illegal status: loginStatus ${c}. connectStatus ${n}`}})}})}getConnectStatus(){return this.lifeCycle.getConnectStatus()}getLoginStatus(){return this.lifeCycle.getLoginStatus()}getLoginUser(){return this.account}getLoginClients(){return function(c,d){c=c||[],d=d||"";for(var f=[],m=[],y=0;y<c.length;y++){var M=c[y][d];m.indexOf(M)===-1&&(m.push(M),f.push(c[y]))}return f}(this.authenticator.loginClients,"clientId").map(n=>g2(n,["type","os","timestamp","customTag","customClientType","clientId","clientIP"]))}getCurrentLoginClient(){var n;if(!((n=this.authenticator.loginClientOfThisConnection)===null||n===void 0)&&n.clientId)return g2(this.authenticator.loginClientOfThisConnection,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])}getDataSync(){var n=this.dataSync.datas;return n&&n.length>0?n.map(c=>({type:c.type,state:c.state})):null}setReconnectDelayProvider(n){this.reconnect._setReconnectDelayProvider(n)}kickOffline(n){return tr(this,void 0,void 0,function*(){if(this._checkApiVersion(),Ks({clientId:{type:"string",allowEmpty:!1}},n,"",!0),Kr(yield this.clientSocket.sendCmd("v2KickOffline",{clientIds:[n.clientId]}),"content.clientIds.length")===0)throw new Gt({code:rt.V2NIM_ERROR_CODE_REQUEST_FAILED})})}getKickedOfflineDetail(){return this.kickedDetail}checkLoginTerminalCode(n){return this.authenticator.checkLoginTerminalCode(n)}checkIllegalState(){if(!this.getLoginUser())throw new Gt({code:rt.V2NIM_ERROR_CODE_ILLEGAL_STATE})}_checkApiVersion(){if(this.core.options.apiVersion!=="v2")throw new Gt({code:rt.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v2"'}})}v2LoginHandler(n){if(n.error)throw this.clientSocket.doDisconnect(Rn.ACTIVE,n.error),n.error;return n}v2LoginClientChangeHandler(n){this.authenticator.changeLoginClient(parseInt(n.content.state),n.content.datas)}nimLoginClientChangeHandler(n){this.authenticator.changeLoginClient(parseInt(n.content.state),n.content.datas)}qchatLoginClientChangeHandler(n){var c=parseInt(n.content.state);c=c===1?2:3,this.authenticator.changeLoginClient(c,[n.content.data])}v2BeKickedHandler(n){if(n.error)this.core.logger.error("v2BeKickedHandler error, ",n.error);else{var c=function(f){return PM({reason:{type:"number"},clientType:{type:"number"},customClientType:{type:"number"}},f)}(n.content);this.core.logger.warn("v2Bekicked::",c),this.kickedDetail=c,this.clientSocket.doDisconnect(Rn.KICKED,c),this.core._clearModuleData(),this.lifeCycle.processEvent("kicked",new Gt({code:rt.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to kicked"}}),c),this.emit("onKickedOffline",c)}}emit(n,...c){var d=`${this.name}::emit ${n.toString()}`;if(n==="onLoginFailed"||n==="onDisconnected"||n==="onConnectFailed"){var f=c[0];this.logger.log(`${d}`,f.toString())}else if(n==="onDataSync"){var m=c[2];this.logger.log(`${d}`,c[0],c[1],m&&m.toString())}else this.logger.log(`${d}`,...c);return super.emit(n,...c)}},"V2NIMLoginService"),O2.registerService(class extends f2{constructor(n){super("V2NIMSyncService",n),this.teamKey=["teams","superTeams","myTeamMembers","mySuperTeamMembers"],this.config={},this.timetags={},this.core.options.apiVersion==="v2"&&(this.initEventListeners(),wp({cmdMap:wj,cmdConfig:xj}))}reset(){this.timetags={}}setOptions(n){var c=this.core,d=!(!c.V2NIMConversationService.name&&!c.V2NIMLocalConversationService.name);return this.config=Object.assign({myInfo:!!c.V2NIMUserService.name,offlineMsgs:!!c.V2NIMMessageService.name,roamingMsgs:!!c.V2NIMMessageService.name,relations:!!c.V2NIMUserService.name,friends:!!c.V2NIMFriendService.name,friendUsers:!!c.V2NIMUserService.name,msgReceipts:!!c.V2NIMMessageService.name,broadcastMsgs:!!c.V2NIMNotificationService.name,recallMsg:!!c.V2NIMMessageService.name,sessionAck:d,superTeamSessionAck:d,stickTopSessions:d,superTeamRoamingMsgs:!!c.V2NIMTeamService.name,deleteSuperTeamMsg:!!c.V2NIMTeamService.name,deleteSelfMsgs:!!c.V2NIMMessageService.name,sessionHistoryMsgsDelete:!!c.V2NIMMessageService.name,avSignal:!!c.V2NIMSignallingService.name,teams:!!c.V2NIMTeamService.name,superTeams:!!c.V2NIMTeamService.name,myTeamMembers:!!c.V2NIMTeamService.name,mySuperTeamMembers:!!c.V2NIMTeamService.name,p2pTeamModifyMessage:!!c.V2NIMMessageService.name,superTeamModifyMessage:!!c.V2NIMMessageService.name},n),this.config}doBasicSync(){return tr(this,void 0,void 0,function*(){var n=Object.keys(this.config).filter(f=>!this.teamKey.includes(f)&&this.config[f]),c=this.genSyncParams(n);this.logger.log("V2Sync:basic",c);var d=(yield this.core.clientSocket.sendCmd("v2NIMSync",{tag:c})).content.timetag;this.setTimetags(d,n),yield this.delaySyncDone(),yield this.handleImmediate(),this.core.logger.log("sync::basic sync complete in",d)})}doTeamSync(){return tr(this,void 0,void 0,function*(){var n=this.teamKey.filter(m=>this.config[m]);if(n.length!==0){var c=this.genSyncParams(n);this.core.eventBus.emit("V2NIMTeamService/onSyncStarted"),this.logger.log("V2Sync:team",c);var d=null;try{d=yield this.core.clientSocket.sendCmd("v2NIMSync",{tag:c})}catch(m){throw this.core.eventBus.emit("V2NIMTeamService/onSyncFailed",m),m}this.core.eventBus.emit("V2NIMTeamService/onSyncFinished");var f=d.content.timetag;this.setTimetags(f,this.teamKey),this.core.logger.log("sync::team sync complete in",f)}})}doQchatSync(){return tr(this,void 0,void 0,function*(){var n=yield this.core.clientSocket.sendCmd("v2QChatSync",{tag:{systemNotification:0}});this.core.logger.log("sync::qchat sync complete in",n.content.timetag)})}doSync(){return tr(this,void 0,void 0,function*(){var n=Kr(this.core,"V2NIMLoginService.authenticator.loginClientOfThisConnection.loginType");if(n!==void 0){if(this.logger.log(`sync::doSync:type ${n}`),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:2,subType:"mainSync"}),n===1)try{yield this.doBasicSync(),yield this.doTeamSync()}catch(c){return void this.doSyncComplete(c)}else if(n===2)try{yield this.doQchatSync()}catch(c){return void this.doSyncComplete(c)}else{if(n!==3)return;try{yield this.doBasicSync(),yield this.doTeamSync(),yield this.doQchatSync()}catch(c){return void this.doSyncComplete(c)}}this.doSyncComplete()}else this.logger.warn("sync::doSync: no loginType, stop sync")})}doSyncComplete(n){n&&this.core.logger.log("sync::doSync complete but got error",n),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:n,subType:"mainSync"})}initEventListeners(){this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",()=>{this.doSync()})}genSyncParams(n){return n.reduce((c,d)=>{var f=d;return c[f]=this.timetags[f]||0,c},{})}setTimetags(n,c){c.forEach(d=>{this.timetags[d]=n})}handleImmediate(){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),Promise.resolve()}delaySyncDone(){return r2()==="ALI"?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new Promise(n=>{setTimeout(()=>{n()},100)})):Promise.resolve()}},"V2NIMSyncService");var fu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function FM(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Ip={exports:{}},jv,w2;function rN(){return w2||(w2=1,jv=function(n,c){return function(){for(var f=new Array(arguments.length),m=0;m<f.length;m++)f[m]=arguments[m];return n.apply(c,f)}}),jv}var Hv,x2;function yn(){if(x2)return Hv;x2=1;var s=rN(),n=Object.prototype.toString,c=function(he){return function(Fe){var Xe=n.call(Fe);return he[Xe]||(he[Xe]=Xe.slice(8,-1).toLowerCase())}}(Object.create(null));function d(he){return he=he.toLowerCase(),function(Xe){return c(Xe)===he}}function f(he){return Array.isArray(he)}function m(he){return typeof he>"u"}function y(he){return he!==null&&!m(he)&&he.constructor!==null&&!m(he.constructor)&&typeof he.constructor.isBuffer=="function"&&he.constructor.isBuffer(he)}var M=d("ArrayBuffer");function S(he){var Fe;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?Fe=ArrayBuffer.isView(he):Fe=he&&he.buffer&&M(he.buffer),Fe}function E(he){return typeof he=="string"}function b(he){return typeof he=="number"}function R(he){return he!==null&&typeof he=="object"}function x(he){if(c(he)!=="object")return!1;var Fe=Object.getPrototypeOf(he);return Fe===null||Fe===Object.prototype}var L=d("Date"),q=d("File"),D=d("Blob"),G=d("FileList");function J(he){return n.call(he)==="[object Function]"}function ne(he){return R(he)&&J(he.pipe)}function z(he){var Fe="[object FormData]";return he&&(typeof FormData=="function"&&he instanceof FormData||n.call(he)===Fe||J(he.toString)&&he.toString()===Fe)}var $=d("URLSearchParams");function Z(he){return he.trim?he.trim():he.replace(/^\s+|\s+$/g,"")}function le(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function fe(he,Fe){if(!(he===null||typeof he>"u"))if(typeof he!="object"&&(he=[he]),f(he))for(var Xe=0,yt=he.length;Xe<yt;Xe++)Fe.call(null,he[Xe],Xe,he);else for(var Wt in he)Object.prototype.hasOwnProperty.call(he,Wt)&&Fe.call(null,he[Wt],Wt,he)}function oe(){var he={};function Fe(Wt,jt){x(he[jt])&&x(Wt)?he[jt]=oe(he[jt],Wt):x(Wt)?he[jt]=oe({},Wt):f(Wt)?he[jt]=Wt.slice():he[jt]=Wt}for(var Xe=0,yt=arguments.length;Xe<yt;Xe++)fe(arguments[Xe],Fe);return he}function B(he,Fe,Xe){return fe(Fe,function(Wt,jt){Xe&&typeof Wt=="function"?he[jt]=s(Wt,Xe):he[jt]=Wt}),he}function me(he){return he.charCodeAt(0)===65279&&(he=he.slice(1)),he}function Ee(he,Fe,Xe,yt){he.prototype=Object.create(Fe.prototype,yt),he.prototype.constructor=he,Xe&&Object.assign(he.prototype,Xe)}function ve(he,Fe,Xe){var yt,Wt,jt,Tt={};Fe=Fe||{};do{for(yt=Object.getOwnPropertyNames(he),Wt=yt.length;Wt-- >0;)jt=yt[Wt],Tt[jt]||(Fe[jt]=he[jt],Tt[jt]=!0);he=Object.getPrototypeOf(he)}while(he&&(!Xe||Xe(he,Fe))&&he!==Object.prototype);return Fe}function qe(he,Fe,Xe){he=String(he),(Xe===void 0||Xe>he.length)&&(Xe=he.length),Xe-=Fe.length;var yt=he.indexOf(Fe,Xe);return yt!==-1&&yt===Xe}function Qe(he){if(!he)return null;var Fe=he.length;if(m(Fe))return null;for(var Xe=new Array(Fe);Fe-- >0;)Xe[Fe]=he[Fe];return Xe}var ut=function(he){return function(Fe){return he&&Fe instanceof he}}(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array));return Hv={isArray:f,isArrayBuffer:M,isBuffer:y,isFormData:z,isArrayBufferView:S,isString:E,isNumber:b,isObject:R,isPlainObject:x,isUndefined:m,isDate:L,isFile:q,isBlob:D,isFunction:J,isStream:ne,isURLSearchParams:$,isStandardBrowserEnv:le,forEach:fe,merge:oe,extend:B,trim:Z,stripBOM:me,inherits:Ee,toFlatObject:ve,kindOf:c,kindOfTest:d,endsWith:qe,toArray:Qe,isTypedArray:ut,isFileList:G},Hv}var $v,P2;function nN(){if(P2)return $v;P2=1;var s=yn();function n(c){return encodeURIComponent(c).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}return $v=function(d,f,m){if(!f)return d;var y;if(m)y=m(f);else if(s.isURLSearchParams(f))y=f.toString();else{var M=[];s.forEach(f,function(b,R){b===null||typeof b>"u"||(s.isArray(b)?R=R+"[]":b=[b],s.forEach(b,function(L){s.isDate(L)?L=L.toISOString():s.isObject(L)&&(L=JSON.stringify(L)),M.push(n(R)+"="+n(L))}))}),y=M.join("&")}if(y){var S=d.indexOf("#");S!==-1&&(d=d.slice(0,S)),d+=(d.indexOf("?")===-1?"?":"&")+y}return d},$v}var Kv,L2;function zj(){if(L2)return Kv;L2=1;var s=yn();function n(){this.handlers=[]}return n.prototype.use=function(d,f,m){return this.handlers.push({fulfilled:d,rejected:f,synchronous:m?m.synchronous:!1,runWhen:m?m.runWhen:null}),this.handlers.length-1},n.prototype.eject=function(d){this.handlers[d]&&(this.handlers[d]=null)},n.prototype.forEach=function(d){s.forEach(this.handlers,function(m){m!==null&&d(m)})},Kv=n,Kv}var Yv,V2;function Xj(){if(V2)return Yv;V2=1;var s=yn();return Yv=function(c,d){s.forEach(c,function(m,y){y!==d&&y.toUpperCase()===d.toUpperCase()&&(c[d]=m,delete c[y])})},Yv}var Wv,D2;function rl(){if(D2)return Wv;D2=1;var s=yn();function n(f,m,y,M,S){Error.call(this),this.message=f,this.name="AxiosError",m&&(this.code=m),y&&(this.config=y),M&&(this.request=M),S&&(this.response=S)}s.inherits(n,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var c=n.prototype,d={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(f){d[f]={value:f}}),Object.defineProperties(n,d),Object.defineProperty(c,"isAxiosError",{value:!0}),n.from=function(f,m,y,M,S,E){var b=Object.create(c);return s.toFlatObject(f,b,function(x){return x!==Error.prototype}),n.call(b,f.message,m,y,M,S),b.name=f.name,E&&Object.assign(b,E),b},Wv=n,Wv}var Jv,U2;function iN(){return U2||(U2=1,Jv={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}),Jv}var Qv,F2;function sN(){if(F2)return Qv;F2=1;var s=yn();function n(c,d){d=d||new FormData;var f=[];function m(M){return M===null?"":s.isDate(M)?M.toISOString():s.isArrayBuffer(M)||s.isTypedArray(M)?typeof Blob=="function"?new Blob([M]):Buffer.from(M):M}function y(M,S){if(s.isPlainObject(M)||s.isArray(M)){if(f.indexOf(M)!==-1)throw Error("Circular reference detected in "+S);f.push(M),s.forEach(M,function(b,R){if(!s.isUndefined(b)){var x=S?S+"."+R:R,L;if(b&&!S&&typeof b=="object"){if(s.endsWith(R,"{}"))b=JSON.stringify(b);else if(s.endsWith(R,"[]")&&(L=s.toArray(b))){L.forEach(function(q){!s.isUndefined(q)&&d.append(x,m(q))});return}}y(b,x)}}),f.pop()}else d.append(S,m(M))}return y(c),d}return Qv=n,Qv}var zv,B2;function Zj(){if(B2)return zv;B2=1;var s=rl();return zv=function(c,d,f){var m=f.config.validateStatus;!f.status||!m||m(f.status)?c(f):d(new s("Request failed with status code "+f.status,[s.ERR_BAD_REQUEST,s.ERR_BAD_RESPONSE][Math.floor(f.status/100)-4],f.config,f.request,f))},zv}var Xv,q2;function e8(){if(q2)return Xv;q2=1;var s=yn();return Xv=s.isStandardBrowserEnv()?function(){return{write:function(d,f,m,y,M,S){var E=[];E.push(d+"="+encodeURIComponent(f)),s.isNumber(m)&&E.push("expires="+new Date(m).toGMTString()),s.isString(y)&&E.push("path="+y),s.isString(M)&&E.push("domain="+M),S===!0&&E.push("secure"),document.cookie=E.join("; ")},read:function(d){var f=document.cookie.match(new RegExp("(^|;\\s*)("+d+")=([^;]*)"));return f?decodeURIComponent(f[3]):null},remove:function(d){this.write(d,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Xv}var Zv,G2;function t8(){return G2||(G2=1,Zv=function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}),Zv}var ey,j2;function r8(){return j2||(j2=1,ey=function(n,c){return c?n.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,""):n}),ey}var ty,H2;function oN(){if(H2)return ty;H2=1;var s=t8(),n=r8();return ty=function(d,f){return d&&!s(f)?n(d,f):f},ty}var ry,$2;function n8(){if($2)return ry;$2=1;var s=yn(),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return ry=function(d){var f={},m,y,M;return d&&s.forEach(d.split(`
`),function(E){if(M=E.indexOf(":"),m=s.trim(E.substr(0,M)).toLowerCase(),y=s.trim(E.substr(M+1)),m){if(f[m]&&n.indexOf(m)>=0)return;m==="set-cookie"?f[m]=(f[m]?f[m]:[]).concat([y]):f[m]=f[m]?f[m]+", "+y:y}}),f},ry}var ny,K2;function i8(){if(K2)return ny;K2=1;var s=yn();return ny=s.isStandardBrowserEnv()?function(){var c=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a"),f;function m(y){var M=y;return c&&(d.setAttribute("href",M),M=d.href),d.setAttribute("href",M),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return f=m(window.location.href),function(M){var S=s.isString(M)?m(M):M;return S.protocol===f.protocol&&S.host===f.host}}():function(){return function(){return!0}}(),ny}var iy,Y2;function Ch(){if(Y2)return iy;Y2=1;var s=rl(),n=yn();function c(d){s.call(this,d??"canceled",s.ERR_CANCELED),this.name="CanceledError"}return n.inherits(c,s,{__CANCEL__:!0}),iy=c,iy}var sy,W2;function s8(){return W2||(W2=1,sy=function(n){var c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return c&&c[1]||""}),sy}var oy,J2;function Q2(){if(J2)return oy;J2=1;var s=yn(),n=Zj(),c=e8(),d=nN(),f=oN(),m=n8(),y=i8(),M=iN(),S=rl(),E=Ch(),b=s8();return oy=function(x){return new Promise(function(q,D){var G=x.data,J=x.headers,ne=x.responseType,z;function $(){x.cancelToken&&x.cancelToken.unsubscribe(z),x.signal&&x.signal.removeEventListener("abort",z)}s.isFormData(G)&&s.isStandardBrowserEnv()&&delete J["Content-Type"];var Z=new XMLHttpRequest;if(x.auth){var le=x.auth.username||"",fe=x.auth.password?unescape(encodeURIComponent(x.auth.password)):"";J.Authorization="Basic "+btoa(le+":"+fe)}var oe=f(x.baseURL,x.url);Z.open(x.method.toUpperCase(),d(oe,x.params,x.paramsSerializer),!0),Z.timeout=x.timeout;function B(){if(Z){var ve="getAllResponseHeaders"in Z?m(Z.getAllResponseHeaders()):null,qe=!ne||ne==="text"||ne==="json"?Z.responseText:Z.response,Qe={data:qe,status:Z.status,statusText:Z.statusText,headers:ve,config:x,request:Z};n(function(he){q(he),$()},function(he){D(he),$()},Qe),Z=null}}if("onloadend"in Z?Z.onloadend=B:Z.onreadystatechange=function(){!Z||Z.readyState!==4||Z.status===0&&!(Z.responseURL&&Z.responseURL.indexOf("file:")===0)||setTimeout(B)},Z.onabort=function(){Z&&(D(new S("Request aborted",S.ECONNABORTED,x,Z)),Z=null)},Z.onerror=function(){D(new S("Network Error",S.ERR_NETWORK,x,Z,Z)),Z=null},Z.ontimeout=function(){var qe=x.timeout?"timeout of "+x.timeout+"ms exceeded":"timeout exceeded",Qe=x.transitional||M;x.timeoutErrorMessage&&(qe=x.timeoutErrorMessage),D(new S(qe,Qe.clarifyTimeoutError?S.ETIMEDOUT:S.ECONNABORTED,x,Z)),Z=null},s.isStandardBrowserEnv()){var me=(x.withCredentials||y(oe))&&x.xsrfCookieName?c.read(x.xsrfCookieName):void 0;me&&(J[x.xsrfHeaderName]=me)}"setRequestHeader"in Z&&s.forEach(J,function(qe,Qe){typeof G>"u"&&Qe.toLowerCase()==="content-type"?delete J[Qe]:Z.setRequestHeader(Qe,qe)}),s.isUndefined(x.withCredentials)||(Z.withCredentials=!!x.withCredentials),ne&&ne!=="json"&&(Z.responseType=x.responseType),typeof x.onDownloadProgress=="function"&&Z.addEventListener("progress",x.onDownloadProgress),typeof x.onUploadProgress=="function"&&Z.upload&&Z.upload.addEventListener("progress",x.onUploadProgress),(x.cancelToken||x.signal)&&(z=function(ve){Z&&(D(!ve||ve&&ve.type?new E:ve),Z.abort(),Z=null)},x.cancelToken&&x.cancelToken.subscribe(z),x.signal&&(x.signal.aborted?z():x.signal.addEventListener("abort",z))),G||(G=null);var Ee=b(oe);if(Ee&&["http","https","file"].indexOf(Ee)===-1){D(new S("Unsupported protocol "+Ee+":",S.ERR_BAD_REQUEST,x));return}Z.send(G)})},oy}var ay,z2;function o8(){return z2||(z2=1,ay=null),ay}var cy,X2;function BM(){if(X2)return cy;X2=1;var s=yn(),n=Xj(),c=rl(),d=iN(),f=sN(),m={"Content-Type":"application/x-www-form-urlencoded"};function y(b,R){!s.isUndefined(b)&&s.isUndefined(b["Content-Type"])&&(b["Content-Type"]=R)}function M(){var b;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(b=Q2()),b}function S(b,R,x){if(s.isString(b))try{return(R||JSON.parse)(b),s.trim(b)}catch(L){if(L.name!=="SyntaxError")throw L}return(x||JSON.stringify)(b)}var E={transitional:d,adapter:M(),transformRequest:[function(R,x){if(n(x,"Accept"),n(x,"Content-Type"),s.isFormData(R)||s.isArrayBuffer(R)||s.isBuffer(R)||s.isStream(R)||s.isFile(R)||s.isBlob(R))return R;if(s.isArrayBufferView(R))return R.buffer;if(s.isURLSearchParams(R))return y(x,"application/x-www-form-urlencoded;charset=utf-8"),R.toString();var L=s.isObject(R),q=x&&x["Content-Type"],D;if((D=s.isFileList(R))||L&&q==="multipart/form-data"){var G=this.env&&this.env.FormData;return f(D?{"files[]":R}:R,G&&new G)}else if(L||q==="application/json")return y(x,"application/json"),S(R);return R}],transformResponse:[function(R){var x=this.transitional||E.transitional,L=x&&x.silentJSONParsing,q=x&&x.forcedJSONParsing,D=!L&&this.responseType==="json";if(D||q&&s.isString(R)&&R.length)try{return JSON.parse(R)}catch(G){if(D)throw G.name==="SyntaxError"?c.from(G,c.ERR_BAD_RESPONSE,this,null,this.response):G}return R}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:o8()},validateStatus:function(R){return R>=200&&R<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};return s.forEach(["delete","get","head"],function(R){E.headers[R]={}}),s.forEach(["post","put","patch"],function(R){E.headers[R]=s.merge(m)}),cy=E,cy}var ly,Z2;function a8(){if(Z2)return ly;Z2=1;var s=yn(),n=BM();return ly=function(d,f,m){var y=this||n;return s.forEach(m,function(S){d=S.call(y,d,f)}),d},ly}var uy,eA;function aN(){return eA||(eA=1,uy=function(n){return!!(n&&n.__CANCEL__)}),uy}var dy,tA;function c8(){if(tA)return dy;tA=1;var s=yn(),n=a8(),c=aN(),d=BM(),f=Ch();function m(y){if(y.cancelToken&&y.cancelToken.throwIfRequested(),y.signal&&y.signal.aborted)throw new f}return dy=function(M){m(M),M.headers=M.headers||{},M.data=n.call(M,M.data,M.headers,M.transformRequest),M.headers=s.merge(M.headers.common||{},M.headers[M.method]||{},M.headers),s.forEach(["delete","get","head","post","put","patch","common"],function(b){delete M.headers[b]});var S=M.adapter||d.adapter;return S(M).then(function(b){return m(M),b.data=n.call(M,b.data,b.headers,M.transformResponse),b},function(b){return c(b)||(m(M),b&&b.response&&(b.response.data=n.call(M,b.response.data,b.response.headers,M.transformResponse))),Promise.reject(b)})},dy}var py,rA;function cN(){if(rA)return py;rA=1;var s=yn();return py=function(c,d){d=d||{};var f={};function m(R,x){return s.isPlainObject(R)&&s.isPlainObject(x)?s.merge(R,x):s.isPlainObject(x)?s.merge({},x):s.isArray(x)?x.slice():x}function y(R){if(s.isUndefined(d[R])){if(!s.isUndefined(c[R]))return m(void 0,c[R])}else return m(c[R],d[R])}function M(R){if(!s.isUndefined(d[R]))return m(void 0,d[R])}function S(R){if(s.isUndefined(d[R])){if(!s.isUndefined(c[R]))return m(void 0,c[R])}else return m(void 0,d[R])}function E(R){if(R in d)return m(c[R],d[R]);if(R in c)return m(void 0,c[R])}var b={url:M,method:M,data:M,baseURL:S,transformRequest:S,transformResponse:S,paramsSerializer:S,timeout:S,timeoutMessage:S,withCredentials:S,adapter:S,responseType:S,xsrfCookieName:S,xsrfHeaderName:S,onUploadProgress:S,onDownloadProgress:S,decompress:S,maxContentLength:S,maxBodyLength:S,beforeRedirect:S,transport:S,httpAgent:S,httpsAgent:S,cancelToken:S,socketPath:S,responseEncoding:S,validateStatus:E};return s.forEach(Object.keys(c).concat(Object.keys(d)),function(x){var L=b[x]||y,q=L(x);s.isUndefined(q)&&L!==E||(f[x]=q)}),f},py}var hy,nA;function lN(){return nA||(nA=1,hy={version:"0.27.2"}),hy}var fy,iA;function l8(){if(iA)return fy;iA=1;var s=lN().version,n=rl(),c={};["object","boolean","number","function","string","symbol"].forEach(function(m,y){c[m]=function(S){return typeof S===m||"a"+(y<1?"n ":" ")+m}});var d={};c.transitional=function(y,M,S){function E(b,R){return"[Axios v"+s+"] Transitional option '"+b+"'"+R+(S?". "+S:"")}return function(b,R,x){if(y===!1)throw new n(E(R," has been removed"+(M?" in "+M:"")),n.ERR_DEPRECATED);return M&&!d[R]&&(d[R]=!0,console.warn(E(R," has been deprecated since v"+M+" and will be removed in the near future"))),y?y(b,R,x):!0}};function f(m,y,M){if(typeof m!="object")throw new n("options must be an object",n.ERR_BAD_OPTION_VALUE);for(var S=Object.keys(m),E=S.length;E-- >0;){var b=S[E],R=y[b];if(R){var x=m[b],L=x===void 0||R(x,b,m);if(L!==!0)throw new n("option "+b+" must be "+L,n.ERR_BAD_OPTION_VALUE);continue}if(M!==!0)throw new n("Unknown option "+b,n.ERR_BAD_OPTION)}}return fy={assertOptions:f,validators:c},fy}var gy,sA;function u8(){if(sA)return gy;sA=1;var s=yn(),n=nN(),c=zj(),d=c8(),f=cN(),m=oN(),y=l8(),M=y.validators;function S(E){this.defaults=E,this.interceptors={request:new c,response:new c}}return S.prototype.request=function(b,R){typeof b=="string"?(R=R||{},R.url=b):R=b||{},R=f(this.defaults,R),R.method?R.method=R.method.toLowerCase():this.defaults.method?R.method=this.defaults.method.toLowerCase():R.method="get";var x=R.transitional;x!==void 0&&y.assertOptions(x,{silentJSONParsing:M.transitional(M.boolean),forcedJSONParsing:M.transitional(M.boolean),clarifyTimeoutError:M.transitional(M.boolean)},!1);var L=[],q=!0;this.interceptors.request.forEach(function(le){typeof le.runWhen=="function"&&le.runWhen(R)===!1||(q=q&&le.synchronous,L.unshift(le.fulfilled,le.rejected))});var D=[];this.interceptors.response.forEach(function(le){D.push(le.fulfilled,le.rejected)});var G;if(!q){var J=[d,void 0];for(Array.prototype.unshift.apply(J,L),J=J.concat(D),G=Promise.resolve(R);J.length;)G=G.then(J.shift(),J.shift());return G}for(var ne=R;L.length;){var z=L.shift(),$=L.shift();try{ne=z(ne)}catch(Z){$(Z);break}}try{G=d(ne)}catch(Z){return Promise.reject(Z)}for(;D.length;)G=G.then(D.shift(),D.shift());return G},S.prototype.getUri=function(b){b=f(this.defaults,b);var R=m(b.baseURL,b.url);return n(R,b.params,b.paramsSerializer)},s.forEach(["delete","get","head","options"],function(b){S.prototype[b]=function(R,x){return this.request(f(x||{},{method:b,url:R,data:(x||{}).data}))}}),s.forEach(["post","put","patch"],function(b){function R(x){return function(q,D,G){return this.request(f(G||{},{method:b,headers:x?{"Content-Type":"multipart/form-data"}:{},url:q,data:D}))}}S.prototype[b]=R(),S.prototype[b+"Form"]=R(!0)}),gy=S,gy}var vy,oA;function d8(){if(oA)return vy;oA=1;var s=Ch();function n(c){if(typeof c!="function")throw new TypeError("executor must be a function.");var d;this.promise=new Promise(function(y){d=y});var f=this;this.promise.then(function(m){if(f._listeners){var y,M=f._listeners.length;for(y=0;y<M;y++)f._listeners[y](m);f._listeners=null}}),this.promise.then=function(m){var y,M=new Promise(function(S){f.subscribe(S),y=S}).then(m);return M.cancel=function(){f.unsubscribe(y)},M},c(function(y){f.reason||(f.reason=new s(y),d(f.reason))})}return n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.prototype.subscribe=function(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]},n.prototype.unsubscribe=function(d){if(this._listeners){var f=this._listeners.indexOf(d);f!==-1&&this._listeners.splice(f,1)}},n.source=function(){var d,f=new n(function(y){d=y});return{token:f,cancel:d}},vy=n,vy}var yy,aA;function p8(){return aA||(aA=1,yy=function(n){return function(d){return n.apply(null,d)}}),yy}var _y,cA;function h8(){if(cA)return _y;cA=1;var s=yn();return _y=function(c){return s.isObject(c)&&c.isAxiosError===!0},_y}var lA;function f8(){if(lA)return Ip.exports;lA=1;var s=yn(),n=rN(),c=u8(),d=cN(),f=BM();function m(M){var S=new c(M),E=n(c.prototype.request,S);return s.extend(E,c.prototype,S),s.extend(E,S),E.create=function(R){return m(d(M,R))},E}var y=m(f);return y.Axios=c,y.CanceledError=Ch(),y.CancelToken=d8(),y.isCancel=aN(),y.VERSION=lN().version,y.toFormData=sN(),y.AxiosError=rl(),y.Cancel=y.CanceledError,y.all=function(S){return Promise.all(S)},y.spread=p8(),y.isAxiosError=h8(),Ip.exports=y,Ip.exports.default=y,Ip.exports}var My,uA;function m8(){return uA||(uA=1,My=f8()),My}var g8=m8();const v8=FM(g8);var Ty={exports:{}},dA;function y8(){return dA||(dA=1,function(s){var n=Object.prototype.hasOwnProperty,c="~";function d(){}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(c=!1));function f(S,E,b){this.fn=S,this.context=E,this.once=b||!1}function m(S,E,b,R,x){if(typeof b!="function")throw new TypeError("The listener must be a function");var L=new f(b,R||S,x),q=c?c+E:E;return S._events[q]?S._events[q].fn?S._events[q]=[S._events[q],L]:S._events[q].push(L):(S._events[q]=L,S._eventsCount++),S}function y(S,E){--S._eventsCount===0?S._events=new d:delete S._events[E]}function M(){this._events=new d,this._eventsCount=0}M.prototype.eventNames=function(){var E=[],b,R;if(this._eventsCount===0)return E;for(R in b=this._events)n.call(b,R)&&E.push(c?R.slice(1):R);return Object.getOwnPropertySymbols?E.concat(Object.getOwnPropertySymbols(b)):E},M.prototype.listeners=function(E){var b=c?c+E:E,R=this._events[b];if(!R)return[];if(R.fn)return[R.fn];for(var x=0,L=R.length,q=new Array(L);x<L;x++)q[x]=R[x].fn;return q},M.prototype.listenerCount=function(E){var b=c?c+E:E,R=this._events[b];return R?R.fn?1:R.length:0},M.prototype.emit=function(E,b,R,x,L,q){var D=c?c+E:E;if(!this._events[D])return!1;var G=this._events[D],J=arguments.length,ne,z;if(G.fn){switch(G.once&&this.removeListener(E,G.fn,void 0,!0),J){case 1:return G.fn.call(G.context),!0;case 2:return G.fn.call(G.context,b),!0;case 3:return G.fn.call(G.context,b,R),!0;case 4:return G.fn.call(G.context,b,R,x),!0;case 5:return G.fn.call(G.context,b,R,x,L),!0;case 6:return G.fn.call(G.context,b,R,x,L,q),!0}for(z=1,ne=new Array(J-1);z<J;z++)ne[z-1]=arguments[z];G.fn.apply(G.context,ne)}else{var $=G.length,Z;for(z=0;z<$;z++)switch(G[z].once&&this.removeListener(E,G[z].fn,void 0,!0),J){case 1:G[z].fn.call(G[z].context);break;case 2:G[z].fn.call(G[z].context,b);break;case 3:G[z].fn.call(G[z].context,b,R);break;case 4:G[z].fn.call(G[z].context,b,R,x);break;default:if(!ne)for(Z=1,ne=new Array(J-1);Z<J;Z++)ne[Z-1]=arguments[Z];G[z].fn.apply(G[z].context,ne)}}return!0},M.prototype.on=function(E,b,R){return m(this,E,b,R,!1)},M.prototype.once=function(E,b,R){return m(this,E,b,R,!0)},M.prototype.removeListener=function(E,b,R,x){var L=c?c+E:E;if(!this._events[L])return this;if(!b)return y(this,L),this;var q=this._events[L];if(q.fn)q.fn===b&&(!x||q.once)&&(!R||q.context===R)&&y(this,L);else{for(var D=0,G=[],J=q.length;D<J;D++)(q[D].fn!==b||x&&!q[D].once||R&&q[D].context!==R)&&G.push(q[D]);G.length?this._events[L]=G.length===1?G[0]:G:y(this,L)}return this},M.prototype.removeAllListeners=function(E){var b;return E?(b=c?c+E:E,this._events[b]&&y(this,b)):(this._events=new d,this._eventsCount=0),this},M.prototype.off=M.prototype.removeListener,M.prototype.addListener=M.prototype.on,M.prefixed=c,M.EventEmitter=M,s.exports=M}(Ty)),Ty.exports}var _8=y8();const M8=FM(_8);var Z_=function(s,n){return Z_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&(c[f]=d[f])},Z_(s,n)};function qM(s,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");Z_(s,n);function c(){this.constructor=s}s.prototype=n===null?Object.create(n):(c.prototype=n.prototype,new c)}var Oa=function(){return Oa=Object.assign||function(n){for(var c,d=1,f=arguments.length;d<f;d++){c=arguments[d];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(n[m]=c[m])}return n},Oa.apply(this,arguments)};function uN(s,n,c,d){function f(m){return m instanceof c?m:new c(function(y){y(m)})}return new(c||(c=Promise))(function(m,y){function M(b){try{E(d.next(b))}catch(R){y(R)}}function S(b){try{E(d.throw(b))}catch(R){y(R)}}function E(b){b.done?m(b.value):f(b.value).then(M,S)}E((d=d.apply(s,[])).next())})}function dN(s,n){var c={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},d,f,m,y;return y={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function M(E){return function(b){return S([E,b])}}function S(E){if(d)throw new TypeError("Generator is already executing.");for(;y&&(y=0,E[0]&&(c=0)),c;)try{if(d=1,f&&(m=E[0]&2?f.return:E[0]?f.throw||((m=f.return)&&m.call(f),0):f.next)&&!(m=m.call(f,E[1])).done)return m;switch(f=0,m&&(E=[E[0]&2,m.value]),E[0]){case 0:case 1:m=E;break;case 4:return c.label++,{value:E[1],done:!1};case 5:c.label++,f=E[1],E=[0];continue;case 7:E=c.ops.pop(),c.trys.pop();continue;default:if(m=c.trys,!(m=m.length>0&&m[m.length-1])&&(E[0]===6||E[0]===2)){c=0;continue}if(E[0]===3&&(!m||E[1]>m[0]&&E[1]<m[3])){c.label=E[1];break}if(E[0]===6&&c.label<m[1]){c.label=m[1],m=E;break}if(m&&c.label<m[2]){c.label=m[2],c.ops.push(E);break}m[2]&&c.ops.pop(),c.trys.pop();continue}E=n.call(s,c)}catch(b){E=[6,b],f=0}finally{d=m=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function T8(s){var n=typeof Symbol=="function"&&Symbol.iterator,c=n&&s[n],d=0;if(c)return c.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&d>=s.length&&(s=void 0),{value:s&&s[d++],done:!s}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function I8(s,n){var c=typeof Symbol=="function"&&s[Symbol.iterator];if(!c)return s;var d=c.call(s),f,m=[],y;try{for(;(n===void 0||n-- >0)&&!(f=d.next()).done;)m.push(f.value)}catch(M){y={error:M}}finally{try{f&&!f.done&&(c=d.return)&&c.call(d)}finally{if(y)throw y.error}}return m}function S8(s,n,c){if(arguments.length===2)for(var d=0,f=n.length,m;d<f;d++)(m||!(d in n))&&(m||(m=Array.prototype.slice.call(n,0,d)),m[d]=n[d]);return s.concat(m||Array.prototype.slice.call(n))}var E8=function(s){var n=s.method,c=n===void 0?"POST":n,d=s.url,f=s.data,m=s.headers;return uN(void 0,void 0,void 0,function(){var y,M;return dN(this,function(S){switch(S.label){case 0:return S.trys.push([0,2,,3]),[4,v8({method:c,url:d,data:f,headers:m})];case 1:return y=S.sent(),y.data.code!==200?[2,Promise.reject(y.data)]:[2,y.data];case 2:return M=S.sent(),[2,Promise.reject(M)];case 3:return[2]}})})},C8=E8,b8=C8,A8="https://statistic.live.126.net/statics/report/xkit/action",R8=function(){function s(n){var c=n.appKey,d=n.version,f=n.component,m=n.nertcVersion,y=n.imVersion,M=n.platform,S=M===void 0?"Web":M,E=n.channel,b=E===void 0?"netease":E;this.platform=S,this.appKey=c,this.version=d,this.component=f,this.nertcVersion=m,this.imVersion=y,this.channel=b}return s.prototype.track=function(n,c){return uN(this,void 0,void 0,function(){var d,f,m,y,M,S,E,b,R;return dN(this,function(x){switch(x.label){case 0:d=this,f=d.appKey,m=d.version,y=d.component,M=d.nertcVersion,S=d.imVersion,E=d.platform,b=d.channel,R=Date.now(),x.label=1;case 1:return x.trys.push([1,3,,4]),[4,b8({method:"POST",url:A8,data:{appKey:f,version:m,component:y,timeStamp:R,nertcVersion:M,imVersion:S,platform:E,reportType:n,data:c,channel:b}})];case 2:return x.sent(),[3,4];case 3:return x.sent(),[3,4];case 4:return[2]}})})},s}(),N8=R8;(function(s){qM(n,s);function n(c){var d=s.call(this)||this;return d.visibilityState=document.visibilityState,d.entries=[],d._visibilitychange=function(){d.visibilityState=document.visibilityState,d._trigger()},d.intersectionObserver=new IntersectionObserver(d._intersectionObserverHandler.bind(d),c),document.addEventListener("visibilitychange",d._visibilitychange),d}return n.prototype.observe=function(c){return this.intersectionObserver.observe(c)},n.prototype.unobserve=function(c){return this.intersectionObserver.unobserve(c)},n.prototype.destroy=function(){this.intersectionObserver.disconnect(),document.removeEventListener("visibilitychange",this._visibilitychange),this.entries=[]},n.prototype._intersectionObserverHandler=function(c){this.entries=c,this._trigger()},n.prototype._trigger=function(){var c=this;this.entries.forEach(function(d){if(c.visibilityState!=="visible"||d.intersectionRatio<=0){c.emit("visibleChange",{visible:!1,target:d.target});return}c.emit("visibleChange",{visible:!0,target:d.target})})},n})(M8);var k8=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function O8(s,n){return n={exports:{}},s(n,n.exports),n.exports}var w8=O8(function(s){(function(n,c){s.exports?s.exports=c():n.log=c()})(k8,function(){var n=function(){},c="undefined",d=typeof window!==c&&typeof window.navigator!==c&&/Trident\/|MSIE /.test(window.navigator.userAgent),f=["trace","debug","info","warn","error"],m={},y=null;function M(D,G){var J=D[G];if(typeof J.bind=="function")return J.bind(D);try{return Function.prototype.bind.call(J,D)}catch{return function(){return Function.prototype.apply.apply(J,[D,arguments])}}}function S(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function E(D){return D==="debug"&&(D="log"),typeof console===c?!1:D==="trace"&&d?S:console[D]!==void 0?M(console,D):console.log!==void 0?M(console,"log"):n}function b(){for(var D=this.getLevel(),G=0;G<f.length;G++){var J=f[G];this[J]=G<D?n:this.methodFactory(J,D,this.name)}if(this.log=this.debug,typeof console===c&&D<this.levels.SILENT)return"No console available for logging"}function R(D){return function(){typeof console!==c&&(b.call(this),this[D].apply(this,arguments))}}function x(D,G,J){return E(D)||R.apply(this,arguments)}function L(D,G){var J=this,ne,z,$,Z="loglevel";typeof D=="string"?Z+=":"+D:typeof D=="symbol"&&(Z=void 0);function le(Ee){var ve=(f[Ee]||"silent").toUpperCase();if(!(typeof window===c||!Z)){try{window.localStorage[Z]=ve;return}catch{}try{window.document.cookie=encodeURIComponent(Z)+"="+ve+";"}catch{}}}function fe(){var Ee;if(!(typeof window===c||!Z)){try{Ee=window.localStorage[Z]}catch{}if(typeof Ee===c)try{var ve=window.document.cookie,qe=encodeURIComponent(Z),Qe=ve.indexOf(qe+"=");Qe!==-1&&(Ee=/^([^;]+)/.exec(ve.slice(Qe+qe.length+1))[1])}catch{}return J.levels[Ee]===void 0&&(Ee=void 0),Ee}}function oe(){if(!(typeof window===c||!Z)){try{window.localStorage.removeItem(Z)}catch{}try{window.document.cookie=encodeURIComponent(Z)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function B(Ee){var ve=Ee;if(typeof ve=="string"&&J.levels[ve.toUpperCase()]!==void 0&&(ve=J.levels[ve.toUpperCase()]),typeof ve=="number"&&ve>=0&&ve<=J.levels.SILENT)return ve;throw new TypeError("log.setLevel() called with invalid level: "+Ee)}J.name=D,J.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},J.methodFactory=G||x,J.getLevel=function(){return $??z??ne},J.setLevel=function(Ee,ve){return $=B(Ee),ve!==!1&&le($),b.call(J)},J.setDefaultLevel=function(Ee){z=B(Ee),fe()||J.setLevel(Ee,!1)},J.resetLevel=function(){$=null,oe(),b.call(J)},J.enableAll=function(Ee){J.setLevel(J.levels.TRACE,Ee)},J.disableAll=function(Ee){J.setLevel(J.levels.SILENT,Ee)},J.rebuild=function(){if(y!==J&&(ne=B(y.getLevel())),b.call(J),y===J)for(var Ee in m)m[Ee].rebuild()},ne=B(y?y.getLevel():"WARN");var me=fe();me!=null&&($=B(me)),b.call(J)}y=new L,y.getLogger=function(G){if(typeof G!="symbol"&&typeof G!="string"||G==="")throw new TypeError("You must supply a name when creating a logger.");var J=m[G];return J||(J=m[G]=new L(G,y.methodFactory)),J};var q=typeof window!==c?window.log:void 0;return y.noConflict=function(){return typeof window!==c&&window.log===y&&(window.log=q),y},y.getLoggers=function(){return m},y.default=y,y})}),x8=w8;function P8(s){var n=["scene/apps/[a-z0-9]{32}/",'"rtcKey":"[a-z0-9]{32}"','"imKey":"[a-z0-9]{32}"','"appkey":"[a-z0-9]{32}"','"appkey": "[a-z0-9]{32}"','appkey:"[a-z0-9]{32}"','appkey: "[a-z0-9]{32}"','"appkey":[a-z0-9]{32}','"appkey": [a-z0-9]{32}',"appkey:[a-z0-9]{32}","appkey: [a-z0-9]{32}"],c=["scene/apps/***/",'"rtcKey":"***"','"imKey":"***"','"appkey":"***"','"appkey": "***"','appkey:"***"','appkey: "***"','"appkey":***','"appkey": ***',"appkey:***","appkey: ***"];return n.forEach(function(d,f){var m=new RegExp(d,"gi");s=s.replace(m,c[f])}),s}var L8=function(s){var n=s===void 0?{appName:"",storeWindow:!1,needStringify:!0}:s,c=n.level,d=n.appName,f=d===void 0?"":d,m=n.storeWindow,y=m===void 0?!1:m,M=n.needStringify,S=M===void 0?!0:M,E=function(){var L=new Date,q=L.getFullYear(),D=L.getMonth()+1,G=L.getDate(),J=L.getHours()<10?"0".concat(L.getHours()):L.getHours(),ne=L.getMinutes()<10?"0".concat(L.getMinutes()):L.getMinutes(),z=L.getSeconds()<10?"0".concat(L.getSeconds()):L.getSeconds(),$="".concat(q,"-").concat(D,"-").concat(G," ").concat(J,":").concat(ne,":").concat(z);return $},b=function(){try{var L=navigator.userAgent.toLocaleLowerCase(),q=/(msie|firefox|chrome|opera|version).*?([\d.]+)/,D=L.match(q)||[],G=D[1].replace(/version/,"safari"),J=D[2];return{browser:G,ver:J}}catch{return null}},R=function(){var L=new Proxy(x8,{get:function(q,D){var G,J;if(D in q){var ne=q[D];if(!["log","info","warn","error","trace","debug"].includes(D))return ne;var z=E();b()&&(z+="[".concat((G=b())===null||G===void 0?void 0:G.browser," ").concat((J=b())===null||J===void 0?void 0:J.ver,"]")),z+="[".concat({log:"L",info:"I",warn:"W",error:"E",trace:"E",debug:"D"}[D],"]")+"[".concat(f,"]")+":";var $=this;return function(){for(var Z=[],le=0;le<arguments.length;le++)Z[le]=arguments[le];if(S)for(var fe=0;fe<Z.length;fe++){if(typeof Z[fe]=="object")try{Z[fe]=JSON.stringify(Z[fe])}catch{console.warn("[]",Z[fe])}typeof Z[fe]=="string"&&(Z[fe]=P8(Z[fe]))}return ne.apply($,S8([z],I8(Z),!1))}}}});return L},x=R();return c&&x.setLevel(c),y&&(window.__LOGGER__=x),x},pN=L8,pA;(function(s){s[s.LOW=0]="LOW",s[s.NORMAL=1]="NORMAL",s[s.HIGH=2]="HIGH"})(pA||(pA={}));var V8=function(){function s(n){this.appKey="",this.component="",this.data={},this.framework="",this.version="",this.startTime=0,this.endTime=0,this.duration=0,this.data.startTime=new Date().getTime(),this.data.timeStamp=this.data.startTime,this.eventId=n.eventId,this.priority=n.priority}return s.prototype.end=function(){this.data.endTime&&this.data.duration||(this.data.endTime=this.data.endTime||new Date().getTime(),this.data.duration=this.data.duration||this.data.endTime-this.data.startTime)},s.prototype.setAppInfo=function(n){this.appKey=n.appKey,this.component=n.component,this.version=n.version,n.framework&&(this.framework=n.framework)},s.prototype.endWith=function(n){var c=n.code,d=n.msg,f=n.requestId,m=n.serverCost;typeof c!="number"?this.data.code=-2:this.data.code=c,this.data.message=d,this.data.requestId=f,this.data.serverCost=m,this.end()},s.prototype.endWithSuccess=function(n){if(n){var c=n.requestId,d=n.serverCost;this.data.requestId=c,this.data.serverCost=d}this.data.code=0,this.data.message="success",this.end()},s.prototype.endWithFailure=function(n){if(n){var c=n.requestId,d=n.serverCost;this.data.requestId=c,this.data.serverCost=d}this.data.code=-1,this.data.message="failure",this.end()},s.prototype.setParams=function(n){return this.data.params=Oa({},n),this},s.prototype.addParams=function(n){return this.data.params=Oa(Oa({},this.data.params),n),this},s.prototype.setData=function(n){this.data=Oa(Oa({},this.data),n)},s.prototype.setUserId=function(n){this.data.userId=n},s}(),hA=function(s){qM(n,s);function n(c){return s.call(this,c)||this}return n}(V8);(function(s){qM(n,s);function n(c){var d=s.call(this,c)||this;return d._stepMap=new Map,d}return n.prototype.beginStep=function(c){if(this._stepMap.has(c))return this._stepMap[c];var d=new hA({eventId:c,priority:this.priority});return d.setData({step:c}),this._stepMap.set(c,d),d},n.prototype.addStep=function(c){this._stepMap.set(c.eventId,c)},n.prototype.removeStep=function(c){this._stepMap.delete(c)},n.prototype.endWith=function(c){s.prototype.endWith.call(this,c),this.end()},n.prototype.endWithSuccess=function(c){s.prototype.endWithSuccess.call(this,c),this.end()},n.prototype.endWithFailure=function(c){s.prototype.endWithFailure.call(this,c),this.end()},n.prototype.end=function(){var c,d,f=[];s.prototype.end.call(this);try{for(var m=T8(this._stepMap.values()),y=m.next();!y.done;y=m.next()){var M=y.value;M.data.index=f.length,f.push(M.data)}}catch(S){c={error:S}}finally{try{y&&!y.done&&(d=m.return)&&d.call(m)}finally{if(c)throw c.error}}f.length>0&&(this.data.steps=f)},n})(hA);var Be=function(){return Be=Object.assign||function(n){for(var c,d=1,f=arguments.length;d<f;d++){c=arguments[d];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(n[m]=c[m])}return n},Be.apply(this,arguments)};function D8(s,n){var c={};for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&n.indexOf(d)<0&&(c[d]=s[d]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,d=Object.getOwnPropertySymbols(s);f<d.length;f++)n.indexOf(d[f])<0&&Object.prototype.propertyIsEnumerable.call(s,d[f])&&(c[d[f]]=s[d[f]]);return c}function $e(s,n,c,d){function f(m){return m instanceof c?m:new c(function(y){y(m)})}return new(c||(c=Promise))(function(m,y){function M(b){try{E(d.next(b))}catch(R){y(R)}}function S(b){try{E(d.throw(b))}catch(R){y(R)}}function E(b){b.done?m(b.value):f(b.value).then(M,S)}E((d=d.apply(s,[])).next())})}function Ke(s,n){var c={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},d,f,m,y;return y={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function M(E){return function(b){return S([E,b])}}function S(E){if(d)throw new TypeError("Generator is already executing.");for(;y&&(y=0,E[0]&&(c=0)),c;)try{if(d=1,f&&(m=E[0]&2?f.return:E[0]?f.throw||((m=f.return)&&m.call(f),0):f.next)&&!(m=m.call(f,E[1])).done)return m;switch(f=0,m&&(E=[E[0]&2,m.value]),E[0]){case 0:case 1:m=E;break;case 4:return c.label++,{value:E[1],done:!1};case 5:c.label++,f=E[1],E=[0];continue;case 7:E=c.ops.pop(),c.trys.pop();continue;default:if(m=c.trys,!(m=m.length>0&&m[m.length-1])&&(E[0]===6||E[0]===2)){c=0;continue}if(E[0]===3&&(!m||E[1]>m[0]&&E[1]<m[3])){c.label=E[1];break}if(E[0]===6&&c.label<m[1]){c.label=m[1],m=E;break}if(m&&c.label<m[2]){c.label=m[2],c.ops.push(E);break}m[2]&&c.ops.pop(),c.trys.pop();continue}E=n.call(s,c)}catch(b){E=[6,b],f=0}finally{d=m=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function hN(s){var n=typeof Symbol=="function"&&Symbol.iterator,c=n&&s[n],d=0;if(c)return c.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&d>=s.length&&(s=void 0),{value:s&&s[d++],done:!s}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function jn(s,n){var c=typeof Symbol=="function"&&s[Symbol.iterator];if(!c)return s;var d=c.call(s),f,m=[],y;try{for(;(n===void 0||n-- >0)&&!(f=d.next()).done;)m.push(f.value)}catch(M){y={error:M}}finally{try{f&&!f.done&&(c=d.return)&&c.call(d)}finally{if(y)throw y.error}}return m}function fn(s,n,c){if(arguments.length===2)for(var d=0,f=n.length,m;d<f;d++)(m||!(d in n))&&(m||(m=Array.prototype.slice.call(n,0,d)),m[d]=n[d]);return s.concat(m||Array.prototype.slice.call(n))}var U8=function(){function s(n,c,d){this.rootStore=n,this.nim=c,this.localOptions=d,this.connectStatus=3,this.loginStatus=0,this.logger=null,vn(this),this._onLoginStatus=this._onLoginStatus.bind(this),this._onLoginFailed=this._onLoginFailed.bind(this),this._onKickedOffline=this._onKickedOffline.bind(this),this._onLoginClientChanged=this._onLoginClientChanged.bind(this),this._onConnectStatus=this._onConnectStatus.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this._onConnectFailed=this._onConnectFailed.bind(this),this._onDataSync=this._onDataSync.bind(this),this.logger=n.logger,c.V2NIMLoginService.on("onLoginStatus",this._onLoginStatus),c.V2NIMLoginService.on("onLoginFailed",this._onLoginFailed),c.V2NIMLoginService.on("onKickedOffline",this._onKickedOffline),c.V2NIMLoginService.on("onLoginClientChanged",this._onLoginClientChanged),c.V2NIMLoginService.on("onConnectStatus",this._onConnectStatus),c.V2NIMLoginService.on("onDisconnected",this._onDisconnected),c.V2NIMLoginService.on("onConnectFailed",this._onConnectFailed),c.V2NIMLoginService.on("onDataSync",this._onDataSync)}return s.prototype.destroy=function(){this.nim.V2NIMLoginService.off("onLoginStatus",this._onLoginStatus),this.nim.V2NIMLoginService.off("onLoginFailed",this._onLoginFailed),this.nim.V2NIMLoginService.off("onKickedOffline",this._onKickedOffline),this.nim.V2NIMLoginService.off("onLoginClientChanged",this._onLoginClientChanged),this.nim.V2NIMLoginService.off("onConnectStatus",this._onConnectStatus),this.nim.V2NIMLoginService.off("onDisconnected",this._onDisconnected),this.nim.V2NIMLoginService.off("onConnectFailed",this._onConnectFailed),this.nim.V2NIMLoginService.off("onDataSync",this._onDataSync)},s.prototype._onLoginStatus=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onLoginStatus",n),this.loginStatus=n},s.prototype._onLoginFailed=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onLoginFailed",n)},s.prototype._onKickedOffline=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onKickedOffline",n)},s.prototype._onLoginClientChanged=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onLoginClientChanged",n)},s.prototype._onConnectStatus=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onConnectStatus",n),this.connectStatus=n},s.prototype._onDisconnected=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onDisconnected",n)},s.prototype._onConnectFailed=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onConnectFailed",n)},s.prototype._onDataSync=function(n){var c,d,f,m;(c=this.logger)===null||c===void 0||c.log("_onDataSync",n),this.rootStore.userStore.getMyUserInfoActive(),this.rootStore.relationStore.getBlockListActive(),this.rootStore.relationStore.getP2PMuteListActive(),!((d=this.rootStore.sdkOptions)===null||d===void 0)&&d.enableV2CloudConversation?(f=this.rootStore.conversationStore)===null||f===void 0||f.getConversationListActive(0,this.localOptions.conversationLimit||100):(m=this.rootStore.localConversationStore)===null||m===void 0||m.getConversationListActive(0,this.localOptions.conversationLimit||100),this.rootStore.teamStore.getJoinedTeamListActive(),this.rootStore.friendStore.getFriendListActive(),this.rootStore.friendStore.getAddApplicationListActive({status:[],offset:0,limit:100}),this.rootStore.teamStore.getTeamJoinActionInfoListActive({offset:0,limit:100}),this.localOptions.aiVisible&&this.rootStore.aiUserStore.getAIUserListActive()},s}(),F8=function(){function s(n,c){this.rootStore=n,this.nim=c,this.friends=new Map,this.logger=null,vn(this),this._onFriendAdded=this._onFriendAdded.bind(this),this._onFriendDeleted=this._onFriendDeleted.bind(this),this._onFriendAddApplication=this._onFriendAddApplication.bind(this),this._onFriendAddRejected=this._onFriendAddRejected.bind(this),this._onFriendInfoChanged=this._onFriendInfoChanged.bind(this),this.logger=n.logger,c.V2NIMFriendService.on("onFriendAdded",this._onFriendAdded),c.V2NIMFriendService.on("onFriendDeleted",this._onFriendDeleted),c.V2NIMFriendService.on("onFriendAddApplication",this._onFriendAddApplication),c.V2NIMFriendService.on("onFriendAddRejected",this._onFriendAddRejected),c.V2NIMFriendService.on("onFriendInfoChanged",this._onFriendInfoChanged)}return s.prototype.resetState=function(){this.friends.clear()},s.prototype.destroy=function(){this.resetState(),this.nim.V2NIMFriendService.off("onFriendAdded",this._onFriendAdded),this.nim.V2NIMFriendService.off("onFriendDeleted",this._onFriendDeleted),this.nim.V2NIMFriendService.off("onFriendAddApplication",this._onFriendAddApplication),this.nim.V2NIMFriendService.off("onFriendAddRejected",this._onFriendAddRejected),this.nim.V2NIMFriendService.off("onFriendInfoChanged",this._onFriendInfoChanged)},s.prototype.getFriendListActive=function(){var n,c,d;return $e(this,void 0,void 0,function(){var f,m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(n=this.logger)===null||n===void 0||n.log("getFriendListActive"),[4,this.nim.V2NIMFriendService.getFriendList()];case 1:return f=y.sent(),this.addFriend(f),(c=this.logger)===null||c===void 0||c.log("getFriendListActive success",f),[2,f];case 2:throw m=y.sent(),(d=this.logger)===null||d===void 0||d.error("getFriendListActive failed: ",m),m;case 3:return[2]}})})},s.prototype.getAddApplicationListActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("getAddApplicationListActive"),[4,this.nim.V2NIMFriendService.getAddApplicationList(n)];case 1:return m=M.sent(),this.rootStore.sysMsgStore.addFriendApplyMsg(m.infos),(d=this.logger)===null||d===void 0||d.log("getAddApplicationListActive success",m),[2,m];case 2:throw y=M.sent(),(f=this.logger)===null||f===void 0||f.error("getAddApplicationListActive failed: ",y),y;case 3:return[2]}})})},s.prototype.addFriendActive=function(n,c){var d,f,m;return $e(this,void 0,void 0,function(){var y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("addFriendActive",n),[4,this.nim.V2NIMFriendService.addFriend(n,c)];case 1:return M.sent(),(f=this.logger)===null||f===void 0||f.log("addFriendActive success",n,c),[3,3];case 2:throw y=M.sent(),(m=this.logger)===null||m===void 0||m.error("addFriendActive failed: ",n,c,y),y;case 3:return[2]}})})},s.prototype.acceptAddApplicationActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("acceptAddApplicationActive",n),[4,this.nim.V2NIMFriendService.acceptAddApplication(n)];case 1:return y.sent(),(d=this.logger)===null||d===void 0||d.log("acceptAddApplicationActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("acceptAddApplicationActive failed: ",n,m),m;case 3:return[2]}})})},s.prototype.rejectAddApplicationActive=function(n,c){var d,f,m;return $e(this,void 0,void 0,function(){var y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("rejectAddApplicationActive",n,c),[4,this.nim.V2NIMFriendService.rejectAddApplication(n,c)];case 1:return M.sent(),(f=this.logger)===null||f===void 0||f.log("rejectFriendApplyActive success",n,c),[3,3];case 2:throw y=M.sent(),(m=this.logger)===null||m===void 0||m.error("rejectFriendApplyActive failed: ",n,c,y),y;case 3:return[2]}})})},s.prototype.deleteFriendActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("deleteFriendActive",n),[4,this.nim.V2NIMFriendService.deleteFriend(n,{deleteAlias:!0})];case 1:return y.sent(),this.removeFriend([n]),(d=this.logger)===null||d===void 0||d.log("deleteFriendActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("deleteFriendActive failed: ",n,m),m;case 3:return[2]}})})},s.prototype.setFriendInfoActive=function(n,c){var d,f,m;return $e(this,void 0,void 0,function(){var y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("setFriendInfoActive",n,c),[4,this.nim.V2NIMFriendService.setFriendInfo(n,c)];case 1:return M.sent(),(f=this.logger)===null||f===void 0||f.log("setFriendInfoActive success",n,c),[3,3];case 2:throw y=M.sent(),(m=this.logger)===null||m===void 0||m.error("setFriendInfoActive failed: ",n,c,y),y;case 3:return[2]}})})},s.prototype.addFriend=function(n){var c=this;n.filter(function(d){return!!d.accountId}).forEach(function(d){var f=c.friends.get(d.accountId);f?c.friends.set(d.accountId,Be(Be(Be({},f),d),d.userProfile)):c.friends.set(d.accountId,Be(Be({},d),d.userProfile))}),this.rootStore.userStore.addUsers(n.map(function(d){return Be(Be({},d),d.userProfile)}))},s.prototype.removeFriend=function(n){var c=this;n.forEach(function(d){c.friends.delete(d)})},s.prototype._onFriendAdded=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onFriendAdded",n),this.addFriend([n]),this.rootStore.sysMsgStore.updateFriendApplyMsg([{operatorAccountId:this.rootStore.userStore.myUserInfo.accountId,applicantAccountId:n.accountId,recipientAccountId:this.rootStore.userStore.myUserInfo.accountId,timestamp:Date.now(),status:1,isRead:!0,read:!0}])},s.prototype._onFriendDeleted=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onFriendDeleted",n),n&&this.removeFriend([n])},s.prototype._onFriendAddApplication=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onFriendAddApplication",n),n.applicantAccountId!==this.rootStore.userStore.myUserInfo.accountId&&this.rootStore.sysMsgStore.addFriendApplyMsg([n])},s.prototype._onFriendAddRejected=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onFriendAddRejected",n),this.rootStore.sysMsgStore.addFriendApplyMsg([Be(Be({},n),{isRead:!0})])},s.prototype._onFriendInfoChanged=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onFriendInfoChanged",n),this.addFriend([n])},s}(),GM="ait_all",B8=20,fA=20,q8=2*60*1e3,G8="@xkit-yx/im-store-v2",fN={name:G8},Vp=pN({level:"debug",appName:fN.name,needStringify:!1}),j8=function(s,n,c){var d=[],f=!1,m;return function(y){var M=this;return new Promise(function(S,E){var b=d.find(function(x){return x.args===y});if(b?b.queue.push({resolve:S,reject:E}):d.push({args:y,queue:[{resolve:S,reject:E}]}),!f){var R=function(x){x.length&&(f=!0,s.call(M,x.map(function(L){return L.args})).then(function(L){for(var q=function(){var D=x.shift();if(D){var G=L.find(function(J){return J.accountId===D.args});D.queue.forEach(function(J){return J.resolve(G)})}};x.length;)q()}).catch(function(L){for(;x.length;){var q=x.shift();q&&q.queue.forEach(function(D){return D.reject(L)})}}).finally(function(){f=!1,d.length&&R(d.splice(0,c))}))};d.length>=c?(clearTimeout(m),R(d.splice(0,c))):(clearTimeout(m),m=setTimeout(function(){R(d.splice(0,c))},n))}})}},H8=function(s,n){return function(c){for(var d=[],f=1;f<arguments.length;f++)d[f-1]=arguments[f];return $e(this,void 0,void 0,function(){var m,y,M,S,E,b,R,x;return Ke(this,function(L){switch(L.label){case 0:return c.length?[3,2]:[4,s.apply(this,[c].concat(d))];case 1:L.sent(),L.label=2;case 2:for(m=[],y=0;y<c.length;y+=n)m.push(c.slice(y,y+n));L.label=3;case 3:L.trys.push([3,8,9,10]),M=hN(m),S=M.next(),L.label=4;case 4:return S.done?[3,7]:(E=S.value,[4,s.apply(this,[E].concat(d))]);case 5:L.sent(),L.label=6;case 6:return S=M.next(),[3,4];case 7:return[3,10];case 8:return b=L.sent(),R={error:b},[3,10];case 9:try{S&&!S.done&&(x=M.return)&&x.call(M)}finally{if(R)throw R.error}return[7];case 10:return[2]}})})}},$8=function(){function s(n,c){n===void 0&&(n=20),c===void 0&&(c="rightToLeft"),this.itemLength=n,this.flow=c,this.queue=[],vn(this)}return s.prototype.push=function(n,c){this.queue.push(n),this._handle(c)},s.prototype.unshift=function(n,c){this.queue.unshift(n),this._handle(c)},s.prototype.pop=function(){return this.queue.pop()},s.prototype.shift=function(){return this.queue.shift()},s.prototype.resetLimitState=function(){this._handle()},s.prototype.clear=function(){this.queue.length=0},s.prototype.get=function(){return this.queue},s.prototype.set=function(n,c){this.queue=n,this._handle(c)},Object.defineProperty(s.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),s.prototype._handle=function(n){n===void 0&&(n=!1),this.queue.length>this.itemLength&&!n&&(this.flow==="leftToRight"?this.queue.splice(this.itemLength,this.queue.length-this.itemLength):this.queue.splice(0,this.queue.length-this.itemLength))},s}(),K8=function(){function s(n,c){n===void 0&&(n=20),c===void 0&&(c="rightToLeft"),this.itemLength=n,this.flow=c,this.map=new Map,vn(this)}return s.prototype.get=function(n){var c;return(c=this.map.get(n))===null||c===void 0?void 0:c.get()},s.prototype.set=function(n,c,d){var f=new $8(this.itemLength,this.flow);f.set(c,d),this.map.set(n,f)},s.prototype.delete=function(n){var c;return(c=this.map.get(n))===null||c===void 0||c.clear(),this.map.delete(n)},s.prototype.resetLimitState=function(){this.map.forEach(function(n){return n.resetLimitState()})},s.prototype.clear=function(){this.map.forEach(function(n){return n.clear()}),this.map.clear()},s.prototype.values=function(){return fn([],jn(this.map.values()),!1).map(function(n){return n.get()}).flat()},s}(),Y8=function(){function s(n){n===void 0&&(n=fA),this.map=new Map,this.pinConversationLimit=fA,this.pinConversationLimit=n,vn(this)}return s.prototype.set=function(n,c){var d=this.map.get(n)||new Map;if(this.map.has(n)&&this.map.delete(n),c.forEach(function(m){m.pinState!==0?d.set(m.messageRefer.messageClientId,m):d.delete(m.messageRefer.messageClientId)}),this.map.set(n,d),this.map.size>this.pinConversationLimit){var f=this.map.keys().next().value;f&&this.map.delete(f)}},s.prototype.get=function(n){var c=this.map.get(n);return c?(this.map.delete(n),this.map.set(n,c),c):null},s.prototype.delete=function(n,c){var d=this.map.get(n);d&&(this.map.delete(n),c.forEach(function(f){d.delete(f)}),this.map.set(n,d))},s.prototype.clear=function(){this.map&&(this.map.forEach(function(n){n.clear()}),this.map.clear())},s}(),W8=Y8,J8=function(){function s(n,c,d){this.rootStore=n,this.nim=c,this.localOptions=d,this.msgs=new K8(B8,"rightToLeft"),this.replyMsgs=new Map,this.logger=null,this.pinMsgs=new W8,this.collectionMsgs=new Map,vn(this),this.logger=n.logger,this._onReceiveMessages=this._onReceiveMessages.bind(this),this._onClearHistoryNotifications=this._onClearHistoryNotifications.bind(this),this._onMessageDeletedNotifications=this._onMessageDeletedNotifications.bind(this),this._onMessagePinNotification=this._onMessagePinNotification.bind(this),this._onMessageQuickCommentNotification=this._onMessageQuickCommentNotification.bind(this),this._onMessageRevokeNotifications=this._onMessageRevokeNotifications.bind(this),this._onReceiveP2PMessageReadReceipts=this._onReceiveP2PMessageReadReceipts.bind(this),this._onReceiveTeamMessageReadReceipts=this._onReceiveTeamMessageReadReceipts.bind(this),this._onReceiveMessagesModified=this._onReceiveMessagesModified.bind(this),this.getTeamMsgReadsActive=H8(this.getTeamMsgReadsActive,50),c.V2NIMMessageService.on("onReceiveMessages",this._onReceiveMessages),c.V2NIMMessageService.on("onClearHistoryNotifications",this._onClearHistoryNotifications),c.V2NIMMessageService.on("onMessageDeletedNotifications",this._onMessageDeletedNotifications),c.V2NIMMessageService.on("onMessagePinNotification",this._onMessagePinNotification),c.V2NIMMessageService.on("onMessageQuickCommentNotification",this._onMessageQuickCommentNotification),c.V2NIMMessageService.on("onMessageRevokeNotifications",this._onMessageRevokeNotifications),c.V2NIMMessageService.on("onReceiveP2PMessageReadReceipts",this._onReceiveP2PMessageReadReceipts),c.V2NIMMessageService.on("onReceiveTeamMessageReadReceipts",this._onReceiveTeamMessageReadReceipts),c.V2NIMMessageService.on("onReceiveMessagesModified",this._onReceiveMessagesModified)}return s.prototype.resetState=function(){this.msgs.clear(),this.replyMsgs.clear(),this.pinMsgs.clear()},s.prototype.destroy=function(){var n=this;this.resetState(),this.nim.V2NIMMessageService.off("onReceiveMessages",this._onReceiveMessages),this.nim.V2NIMMessageService.off("onClearHistoryNotifications",this._onClearHistoryNotifications),this.nim.V2NIMMessageService.off("onMessageDeletedNotifications",this._onMessageDeletedNotifications),this.nim.V2NIMMessageService.off("onMessagePinNotification",this._onMessagePinNotification),this.nim.V2NIMMessageService.off("onMessageQuickCommentNotification",this._onMessageQuickCommentNotification),this.nim.V2NIMMessageService.off("onMessageRevokeNotifications",this._onMessageRevokeNotifications),this.nim.V2NIMMessageService.off("onReceiveP2PMessageReadReceipts",this._onReceiveP2PMessageReadReceipts),this.nim.V2NIMMessageService.off("onReceiveTeamMessageReadReceipts",this._onReceiveTeamMessageReadReceipts),this.getMsg().forEach(function(c){n._handleClearMsgTimer(c)})},s.prototype.replyMsgActive=function(n){this.replyMsgs.set(n.conversationId,n)},s.prototype.removeReplyMsgActive=function(n){this.replyMsgs.delete(n)},s.prototype.getReplyMsgActive=function(n){var c=this.replyMsgs.get(n);if(c)return this.handleMsgForSDK(c)},s.prototype.reCallMsgActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("reCallMsgActive",n),[4,this.nim.V2NIMMessageService.revokeMessage(this.handleMsgForSDK(n))];case 1:return M.sent(),this.removeMsg(n.conversationId,[n.messageClientId]),m=this._createReCallMsg(n),this.addMsg(m.conversationId,[m]),(d=this.logger)===null||d===void 0||d.log("reCallMsgActive success",n),[3,3];case 2:throw y=M.sent(),(f=this.logger)===null||f===void 0||f.error("reCallMsgActive failed: ",n,y),y;case 3:return[2]}})})},s.prototype.deleteMsgActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M,S=this;return Ke(this,function(E){switch(E.label){case 0:return E.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("deleteMsgActive",n),[4,this.nim.V2NIMMessageService.deleteMessages(n.map(function(b){return S.handleMsgForSDK(b)}))];case 1:return E.sent(),m=n[0].conversationId,m&&(y=n.map(function(b){return b.messageClientId}),this.removeMsg(m,y)),(d=this.logger)===null||d===void 0||d.log("deleteMsgActive success",n),[3,3];case 2:throw M=E.sent(),(f=this.logger)===null||f===void 0||f.warn("deleteMsgActive failed, but delete msgs from memory: ",n,M),M;case 3:return[2]}})})},s.prototype.sendMessageActive=function(n){var c,d,f,m,y,M,S;return $e(this,void 0,void 0,function(){var E,b,R,x,L,q,D,G,J,ne,z,$,Z,le,fe,oe=this;return Ke(this,function(B){switch(B.label){case 0:(c=this.logger)===null||c===void 0||c.log("sendMessageActive",n),E=n.msg,b=n.conversationId,R=n.progress,x=n.sendBefore,L=n.serverExtension,q=n.previewImg,D=n.onAISend,G=Be({},E),J=this._formatExtField(b,L||JSON.parse(G.serverExtension||"{}")),G.serverExtension=Object.keys(J).length?JSON.stringify(J):void 0,G.senderId=this.rootStore.userStore.myUserInfo.accountId,G.receiverId=this.nim.V2NIMConversationIdUtil.parseConversationTargetId(b),G.conversationId=b,G.sendingState=3,q&&(G.previewImg=q),R&&(G.uploadProgress=0),B.label=1;case 1:return B.trys.push([1,4,,5]),[4,(f=(d=this.localOptions).sendMsgBefore)===null||f===void 0?void 0:f.call(d,n)];case 2:return ne=B.sent(),ne===!1?((m=this.logger)===null||m===void 0||m.log("sendMessageActive cancel",n,ne),[2]):(z=this._getAIConfig(G),this.addMsg(G.conversationId,[G]),G.messageType===0&&this.removeReplyMsgActive(b),x==null||x(G),$=z||ne!=null&&ne.aiConfig?Be(Be({},z),ne==null?void 0:ne.aiConfig):void 0,Z=Be(Be({},ne),{pushConfig:(ne==null?void 0:ne.pushConfig)||(J!=null&&J.yxAitMsg?this._formatExtAitToPushInfo(J.yxAitMsg,G.text||""):void 0),messageConfig:Be({readReceiptEnabled:!0},ne==null?void 0:ne.messageConfig),aiConfig:$}),(y=this.logger)===null||y===void 0||y.log("sendMessageActive finalParams: ",G,b,Z),[4,this.nim.V2NIMMessageService.sendMessage(G,b,Z,function(me){var Ee=R==null?void 0:R(me);if(Ee){var ve=oe.getMsg(b,[G.messageClientId])[0];ve&&oe.addMsg(b,[Be(Be({},ve),{uploadProgress:me})])}})]);case 3:return le=B.sent().message,$&&(D==null||D(le,$)),(E.messageType===6||E.messageType===1||E.messageType===3)&&(le.uploadProgress=100),this._handleSendMsgSuccess(le),(M=this.logger)===null||M===void 0||M.log("sendMessageActive success",le),[2,le];case 4:throw fe=B.sent(),(S=this.logger)===null||S===void 0||S.error("sendMessageActive failed: ",fe.toString(),G),fe.code===191002?this.removeMsg(b,[G.messageClientId]):this._handleSendMsgFail(G,fe.code),fe;case 5:return[2]}})})},s.prototype.cancelMessageAttachmentUploadActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("cancelMessageAttachmentUploadActive",n),[4,this.nim.V2NIMMessageService.cancelMessageAttachmentUpload(this.handleMsgForSDK(n))];case 1:return y.sent(),this.removeMsg(n.conversationId,[n.messageClientId]),(d=this.logger)===null||d===void 0||d.log("cancelMessageAttachmentUploadActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("cancelMessageAttachmentUploadActive failed: ",n,m),m;case 3:return[2]}})})},s.prototype.sendMsgReceiptActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("sendMsgReceiptActive",n),[4,this.nim.V2NIMMessageService.sendP2PMessageReceipt(this.handleMsgForSDK(n))];case 1:return y.sent(),(d=this.logger)===null||d===void 0||d.log("sendMsgReceiptActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("sendMsgReceiptActive failed: ",n,m.toString()),m;case 3:return[2]}})})},s.prototype.addCollectionActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("addCollectionActive",n),[4,this.nim.V2NIMMessageService.addCollection(n)];case 1:return y.sent(),(d=this.logger)===null||d===void 0||d.log("addCollectionActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("addCollectionActive failed: ",n,m.toString()),m;case 3:return[2]}})})},s.prototype.removeCollectionsActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("removeCollectionsActive",n),[4,this.nim.V2NIMMessageService.removeCollections(n)];case 1:return y.sent(),(d=this.logger)===null||d===void 0||d.log("removeCollectionsActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("removeCollectionsActive failed: ",n,m.toString()),m;case 3:return[2]}})})},s.prototype.getCollectionListByOptionActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M=this;return Ke(this,function(S){switch(S.label){case 0:m=[],S.label=1;case 1:return S.trys.push([1,3,,4]),(c=this.logger)===null||c===void 0||c.log("getCollectionListByOptionActive",n),[4,this.nim.V2NIMMessageService.getCollectionListByOption(n)];case 2:return m=S.sent(),m.forEach(function(E){var b=JSON.parse(E.collectionData),R=M.nim.V2NIMMessageConverter.messageDeserialization(b.message);R&&M.collectionMsgs.set(R.messageClientId,R)}),(d=this.logger)===null||d===void 0||d.log("getCollectionListByOptionActive success",n),[3,4];case 3:throw y=S.sent(),(f=this.logger)===null||f===void 0||f.error("getCollectionListByOptionActive failed: ",n,y.toString()),y;case 4:return[2,m]}})})},s.prototype.sendTeamMsgReceiptActive=function(n){var c,d,f,m;return $e(this,void 0,void 0,function(){var y,M,S=this;return Ke(this,function(E){switch(E.label){case 0:return E.trys.push([0,3,,4]),(c=this.logger)===null||c===void 0||c.log("sendTeamMsgReceiptActive",n),n.length?(y=n.map(function(b){return S.handleMsgForSDK(b)}),(d=this.logger)===null||d===void 0||d.log("sendTeamMsgReceiptActive finalParams: ",y),[4,this.nim.V2NIMMessageService.sendTeamMessageReceipts(y)]):[3,2];case 1:E.sent(),E.label=2;case 2:return(f=this.logger)===null||f===void 0||f.log("sendTeamMsgReceiptActive success",n),[3,4];case 3:throw M=E.sent(),(m=this.logger)===null||m===void 0||m.error("sendTeamMsgReceiptActive failed: ",n,M.toString()),M;case 4:return[2]}})})},s.prototype.getTeamMessageReceiptDetailsActive=function(n,c){var d,f,m;return $e(this,void 0,void 0,function(){var y,M;return Ke(this,function(S){switch(S.label){case 0:return S.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("getTeamMessageReceiptDetailsActive",n,c),[4,this.nim.V2NIMMessageService.getTeamMessageReceiptDetail(n,c)];case 1:return y=S.sent(),(f=this.logger)===null||f===void 0||f.log("getTeamMessageReceiptDetailsActive success:",n,c,y),[2,y];case 2:throw M=S.sent(),(m=this.logger)===null||m===void 0||m.error("sendTeamMsgReceiptActive failed: ",n,c,M.toString()),M;case 3:return[2]}})})},s.prototype.getHistoryMsgActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M,S,E,b,R,x,L,q,D;return Ke(this,function(G){switch(G.label){case 0:return G.trys.push([0,4,,5]),(c=this.logger)===null||c===void 0||c.log("getHistoryMsgActive",n),m=n.conversationId,y=n.endTime,M=n.lastMsgId,S=n.limit,E=S===void 0?100:S,b=this.nim.V2NIMConversationIdUtil.parseConversationType(m),R={conversationId:m,endTime:y,limit:E},M&&(x=this.getMsg(m,[M])[0],x&&(R.anchorMessage=x)),[4,this.nim.V2NIMMessageService.getMessageList(R)];case 1:return L=G.sent(),this.addMsg(m,L),b===2&&this.rootStore.localOptions.teamMsgReceiptVisible?(q=L.filter(function(J){return J.isSelf}).filter(function(J){return![5,10].includes(J.messageType)}),[4,this.getTeamMsgReadsActive(q,m)]):[3,3];case 2:G.sent(),G.label=3;case 3:return(d=this.logger)===null||d===void 0||d.log("getHistoryMsgActive success",n,R,L),[2,L];case 4:throw D=G.sent(),(f=this.logger)===null||f===void 0||f.error("getHistoryMsgActive failed: ",n,D.toString()),D;case 5:return[2]}})})},s.prototype.forwardMsgActive=function(n,c,d){var f,m,y,M;return $e(this,void 0,void 0,function(){var S,E,b,R,x,L;return Ke(this,function(q){switch(q.label){case 0:if(q.trys.push([0,5,,6]),(f=this.logger)===null||f===void 0||f.log("forwardMsgActive",n,c,d),S=n==null?void 0:n.serverExtension,S)try{S=JSON.parse(S),delete S.yxReplyMsg,delete S.yxAitMsg,S=JSON.stringify(S)}catch{}return E=["canRecall","reCallTimer","yxUnread","yxRead"],E.forEach(function(D){delete n[D]}),((m=n.pushConfig)===null||m===void 0?void 0:m.pushContent)===""&&delete n.pushConfig.pushContent,b=this.handleMsgForSDK(Be(Be({},n),{serverExtension:S})),R=this.nim.V2NIMMessageCreator.createForwardMessage(b),R?[4,this.sendMessageActive({msg:R,conversationId:c})]:[3,2];case 1:q.sent(),q.label=2;case 2:return d?(x=this.nim.V2NIMMessageCreator.createTextMessage(d),[4,this.sendMessageActive({msg:x,conversationId:c})]):[3,4];case 3:q.sent(),q.label=4;case 4:return(y=this.logger)===null||y===void 0||y.log("forwardMsgActive success",n,c,d),[3,6];case 5:throw L=q.sent(),(M=this.logger)===null||M===void 0||M.error("forwardMsgActive failed: ",L),L;case 6:return[2]}})})},s.prototype.getTeamMsgReadsActive=function(n,c){var d,f;return $e(this,void 0,void 0,function(){var m,y,M,S=this;return Ke(this,function(E){switch(E.label){case 0:if((d=this.logger)===null||d===void 0||d.log("getTeamMsgReadsActive",n,c),m=[],!n.length)return[3,4];E.label=1;case 1:return E.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.getTeamMessageReceipts(n.map(function(b){return S.handleMsgForSDK(b)}))];case 2:return m=E.sent(),[3,4];case 3:return y=E.sent(),(f=this.logger)===null||f===void 0||f.warn("getTeamMsgReadsActive failed but continue: ",y.toString()),[3,4];case 4:return M=n.filter(function(b){return m.some(function(R){return b.messageClientId===R.messageClientId})}).map(function(b){var R=m.find(function(x){return x.messageClientId===b.messageClientId});return R?S._updateReceiptMsg(b,{unread:R.unreadCount,read:R.readCount}):b}),this.addMsg(c,M),[2]}})})},s.prototype.pinMessageActive=function(n,c){var d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:(d=this.logger)===null||d===void 0||d.log("pinMessageActive",n,c),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.pinMessage(n,c)];case 2:return y.sent(),[3,4];case 3:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.warn("pinMessageActive failed but continue: ",m.toString()),m;case 4:return[2]}})})},s.prototype.unpinMessageActive=function(n,c){var d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:(d=this.logger)===null||d===void 0||d.log("uppinMessageActive",n,c),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.unpinMessage(n,c)];case 2:return y.sent(),[3,4];case 3:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.warn("uppinMessageActive failed but continue: ",m.toString()),m;case 4:return[2]}})})},s.prototype.updatePinMessageActive=function(n,c){var d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:(d=this.logger)===null||d===void 0||d.log("updatePinMessageActive",n,c),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.updatePinMessage(n,c)];case 2:return y.sent(),[3,4];case 3:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.warn("updatePinMessageActive failed but continue: ",m.toString()),m;case 4:return[2]}})})},s.prototype.getPinnedMessageListActive=function(n){return $e(this,void 0,void 0,function(){var c,d;return Ke(this,function(f){switch(f.label){case 0:return c=this.pinMsgs.get(n),d=[],c?(d=fn([],jn(c.values()),!1),[3,3]):[3,1];case 1:return[4,this._getPinnedMessageListByServer(n)];case 2:d=f.sent(),f.label=3;case 3:return[4,this.completePinnedMessageList(n,d)];case 4:return d=f.sent(),d=d.filter(function(m){return m.pinState>0&&m.message}).sort(function(m,y){return y.message.createTime-m.message.createTime}),[2,d]}})})},s.prototype.stopAIStreamMessageActive=function(n,c){var d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:(d=this.logger)===null||d===void 0||d.log("stopAIStreamMessageActive",n),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.stopAIStreamMessage(n,c)];case 2:return y.sent(),[3,4];case 3:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("stopAIStreamMessageActive failed ",m.toString()),m;case 4:return[2]}})})},s.prototype.regenAIMessageActive=function(n,c){var d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:(d=this.logger)===null||d===void 0||d.log("regenAIMessageActive",n),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.regenAIMessage(n,c)];case 2:return y.sent(),[3,4];case 3:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("regenAIMessageActive failed ",m.toString()),m;case 4:return[2]}})})},s.prototype.voiceToTextActive=function(n){var c,d;return $e(this,void 0,void 0,function(){var f,m;return Ke(this,function(y){switch(y.label){case 0:if(n.textOfVoice)return[2];if(!n.attachment)return[2];if(!("url"in n.attachment))return[2];if(!n.attachment.url)return[2];if(!("duration"in n.attachment))return[2];if(!n.attachment.duration)return[2];(c=this.logger)===null||c===void 0||c.log("voiceToTextActive",n),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.voiceToText({voiceUrl:n.attachment.url,duration:n.attachment.duration,sceneName:n.attachment.sceneName,mimeType:"aac",sampleRate:"16000"})];case 2:if(f=y.sent(),!f)throw new Error("voiceToText empty");return this.updateMsg(n.conversationId,n.messageClientId,{textOfVoice:f}),[3,4];case 3:throw m=y.sent(),(d=this.logger)===null||d===void 0||d.warn("voiceToTextActive failed: ",m.toString()),m;case 4:return[2]}})})},s.prototype.addMsg=function(n,c){var d=this,f=function(M,S){return M.createTime-S.createTime},m=this.msgs.get(n)||[],y=this.pinMsgs.get(n);c.filter(function(M){return!!M.messageClientId}).map(function(M){return M=d.handleReceiveAIMsg(M),y&&(M=d.handleMsgPinState(M,y)),M}).forEach(function(M){var S=Be({},M),E=m.find(function(b){return b.messageClientId===S.messageClientId});E?(E.createTime<=S.createTime||E.sendingState===3)&&(E.canRecall!==void 0&&E.reCallTimer!==void 0&&(S.canRecall=E.canRecall,S.reCallTimer=E.reCallTimer),E.textOfVoice&&(S.textOfVoice=E.textOfVoice),m.splice(m.indexOf(E),1,S)):m.push(M)}),this.msgs.set(n,fn([],jn(m),!1).sort(f),this.rootStore.uiStore.selectedConversation===n)},s.prototype.removeMsg=function(n,c){var d=this;if(!n){this.getMsg().forEach(function(m){d._handleClearMsgTimer(m)}),this.msgs.clear();return}var f=this.msgs.get(n);if(f){if(!c||!c.length){f.forEach(function(m){d._handleClearMsgTimer(m)}),this.msgs.delete(n);return}this.msgs.set(n,f.filter(function(m){var y=c.includes(m.messageClientId)&&!(m.messageType===100&&m.recallType==="beReCallMsg");return y&&d._handleClearMsgTimer(m),!y}),this.rootStore.uiStore.selectedConversation===n)}},s.prototype.deletePinInfoByMessageClientId=function(n,c){var d;(d=this.logger)===null||d===void 0||d.log("deletePinInfoByMessageClientId",n,c),this.pinMsgs.delete(n,c)},s.prototype.getMsg=function(n,c){if(!n)return this.msgs.values();var d=this.msgs.get(n)||[];return!c||!c.length?d:d.filter(function(f){return c.includes(f.messageClientId)})},s.prototype.updateMsg=function(n,c,d){var f=this.msgs.get(n);if(f){var m=f.findIndex(function(y){return y.messageClientId===c});m&&this.msgs.set(n,f.map(function(y){return y.messageClientId===c&&(y=Be(Be({},y),d)),y}),this.rootStore.uiStore.selectedConversation===n)}},s.prototype.handleReceiveAIMsg=function(n){var c=this.rootStore.userStore.myUserInfo.accountId,d=n.aiConfig,f=d&&d.aiStatus===2?d.accountId:n.senderId,m=f===c;return Be(Be({},n),{__kit__isSelf:n.isSelf,__kit__senderId:n.senderId,isSelf:m})},s.prototype.handleMsgPinState=function(n,c){var d=c.get(n.messageClientId);return d&&(n.pinState=d.pinState,n.operatorId=d.operatorId),n},s.prototype.handleMsgForSDK=function(n){var c=n.__kit__isSelf,d=n.__kit__senderId,f=D8(n,["__kit__isSelf","__kit__senderId"]),m=n.senderId,y=n.isSelf;return c&&(y=c),d&&(m=d),Be(Be({},f),{senderId:m,isSelf:y})},s.prototype._getMessageListByRefer=function(n){var c;return $e(this,void 0,void 0,function(){var d,f;return Ke(this,function(m){switch(m.label){case 0:d=[],m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.getMessageListByRefers(n)];case 2:return d=m.sent(),[3,4];case 3:return f=m.sent(),(c=this.logger)===null||c===void 0||c.warn("_getMessageListByRefer failed but continue: ",f.toString()),[3,4];case 4:return[2,d]}})})},s.prototype._getPinnedMessageListByServer=function(n){var c,d;return $e(this,void 0,void 0,function(){var f,m,y;return Ke(this,function(M){switch(M.label){case 0:(c=this.logger)===null||c===void 0||c.log("_getPinnedMessageListByServer",n),f=[],m=[],M.label=1;case 1:return M.trys.push([1,3,,4]),[4,this.nim.V2NIMMessageService.getPinnedMessageList(n)];case 2:return f=M.sent(),[3,4];case 3:return y=M.sent(),(d=this.logger)===null||d===void 0||d.warn("_getPinnedMessageListByServer failed but continue: ",y.toString()),[3,4];case 4:return f.forEach(function(S){m.push(Be({pinState:1},S))}),this.pinMsgs.set(n,m),m.length&&this._updateMsgsPinState(n,m),[2,m]}})})},s.prototype.completePinnedMessageList=function(n,c){return $e(this,void 0,void 0,function(){var d,f;return Ke(this,function(m){switch(m.label){case 0:return d=[],c.length?(f=[],c.forEach(function(y){y.message||f.push(y.messageRefer)}),f.length?[4,this._getMessageListByRefer(f)]:[2,c]):[2,c];case 1:return d=m.sent(),d.length&&(c=c.map(function(y){var M=d.find(function(S){return S.messageClientId===y.messageRefer.messageClientId});return M&&(y=Be(Be({},y),{message:M})),y}),this.pinMsgs.set(n,c)),[2,c]}})})},s.prototype._handleSendMsgSuccess=function(n){n&&n.conversationId&&this.addMsg(n.conversationId,[n])},s.prototype._handleSendMsgFail=function(n,c){if(n&&n.conversationId){var d=this.getMsg(n.conversationId,[n.messageClientId])[0];this._handleClearMsgTimer(d),this.addMsg(n.conversationId,[Be(Be(Be({},d),n),{messageStatus:{errorCode:c},uploadProgress:void 0,sendingState:2,errorCode:c})])}},s.prototype._handleClearMsgTimer=function(n){n&&(clearTimeout(n.canEditTimer),clearTimeout(n.reCallTimer))},s.prototype._onReceiveMessages=function(n){var c=this,d,f,m,y;(d=this.logger)===null||d===void 0||d.log("_onReceiveMessages: ",n),n.forEach(function(M){c.addMsg(M.conversationId,[M])}),!((f=this.rootStore.sdkOptions)===null||f===void 0)&&f.enableV2CloudConversation?(m=this.rootStore.conversationStore)===null||m===void 0||m.handleConversationWithAit(n):(y=this.rootStore.localConversationStore)===null||y===void 0||y.handleConversationWithAit(n)},s.prototype._onReceiveMessagesModified=function(n){var c=this,d;(d=this.logger)===null||d===void 0||d.log("_onReceiveMessagesModified: ",n),n.forEach(function(f){c.addMsg(f.conversationId,[f])})},s.prototype._onClearHistoryNotifications=function(n){var c=this,d;(d=this.logger)===null||d===void 0||d.log("_onClearHistory: ",n),n.forEach(function(f){c.removeMsg(f.conversationId)})},s.prototype._onMessageDeletedNotifications=function(n){var c=this,d;(d=this.logger)===null||d===void 0||d.log("_onMessageDeletedNotifications: ",n);var f={};n.forEach(function(m){var y=m.messageRefer.conversationId;f[y]?f[y].push(m):f[y]=[m]}),Object.keys(f).forEach(function(m){var y=f[m].map(function(M){return M.messageRefer.messageClientId});c.removeMsg(m,y),c.deletePinInfoByMessageClientId(m,y)})},s.prototype._onMessagePinNotification=function(n){var c=this,d=n.pin,f=d.operatorId,m=d.messageRefer,y=d.serverExtension,M=d.createTime,S=d.updateTime,E=this.pinMsgs.get(m.conversationId);if(E){var b=n.pinState,R=E==null?void 0:E.get(m.messageClientId),x=[{pinState:b,messageRefer:m,operatorId:f,serverExtension:y,createTime:(R==null?void 0:R.createTime)||M,updateTime:S}];this.completePinnedMessageList(m.conversationId,x).then(function(L){c._updateMsgsPinState(m.conversationId,L)})}},s.prototype._updateMsgsPinState=function(n,c){var d=this.getMsg(n)||[],f=!1;c.forEach(function(m){var y=d.find(function(S){return S.messageClientId===m.messageRefer.messageClientId});if(y&&y.pinState!==m.pinState){var M=Be({},y);M.pinState=m.pinState,M.operatorId=m.operatorId,d.splice(d.indexOf(y),1,M),f=!0}}),f&&this.msgs.set(n,d,this.rootStore.uiStore.selectedConversation===n)},s.prototype._onMessageQuickCommentNotification=function(){},s.prototype._onMessageRevokeNotifications=function(n){var c;return $e(this,void 0,void 0,function(){var d=this;return Ke(this,function(f){return(c=this.logger)===null||c===void 0||c.log("_onMessageRevokeNotifications: ",n),n.forEach(function(m){return $e(d,void 0,void 0,function(){var y,M,S,E,b,R,x,L,q,D,G,J,ne;return Ke(this,function(z){return y=this.getMsg(m.messageRefer.conversationId,[m.messageRefer.messageClientId])[0],y&&y.recallType?[2]:(M=m.messageRefer.conversationId,S=[m.messageRefer.messageClientId],this.removeMsg(M,S),this.deletePinInfoByMessageClientId(M,S),E=this._createBeReCallMsg(m),this.addMsg(E.conversationId,[E]),m.messageRefer.conversationType===2&&(b=!((L=this.rootStore.sdkOptions)===null||L===void 0)&&L.enableV2CloudConversation?(q=this.rootStore.conversationStore)===null||q===void 0?void 0:q.conversations.get(M):(D=this.rootStore.localConversationStore)===null||D===void 0?void 0:D.conversations.get(M),b&&(R=b.aitMsgs||[],x=m.messageRefer.messageClientId,R.includes(x)&&(R=R.filter(function($){return $!==x}),!((G=this.rootStore.sdkOptions)===null||G===void 0)&&G.enableV2CloudConversation?(J=this.rootStore.conversationStore)===null||J===void 0||J.updateConversation([Be(Be({},b),{aitMsgs:R})]):(ne=this.rootStore.localConversationStore)===null||ne===void 0||ne.updateConversation([Be(Be({},b),{aitMsgs:R})])))),[2])})})}),[2]})})},s.prototype._onReceiveP2PMessageReadReceipts=function(n){var c=this,d;(d=this.logger)===null||d===void 0||d.log("_onReceiveP2PMessageReadReceipts: ",n),n.forEach(function(f){var m,y,M,S,E,b,R=!((m=c.rootStore.sdkOptions)===null||m===void 0)&&m.enableV2CloudConversation?(y=c.rootStore.conversationStore)===null||y===void 0?void 0:y.conversations.get(f.conversationId):(M=c.rootStore.localConversationStore)===null||M===void 0?void 0:M.conversations.get(f.conversationId);R&&f.timestamp>(R.msgReceiptTime||0)&&(!((S=c.rootStore.sdkOptions)===null||S===void 0)&&S.enableV2CloudConversation?(E=c.rootStore.conversationStore)===null||E===void 0||E.updateConversation([Be(Be({},R),{msgReceiptTime:f.timestamp})]):(b=c.rootStore.localConversationStore)===null||b===void 0||b.updateConversation([Be(Be({},R),{msgReceiptTime:f.timestamp})]))})},s.prototype._onReceiveTeamMessageReadReceipts=function(n){var c=this,d;(d=this.logger)===null||d===void 0||d.log("_onReceiveTeamMessageReadReceipts: ",n),n.sort(function(f,m){return f.readCount-m.readCount}),n.forEach(function(f){var m=f.conversationId,y=c.getMsg(m,[f.messageClientId])[0];if(y){var M=c._updateReceiptMsg(y,{unread:f.unreadCount,read:f.readCount});c.addMsg(m,[M])}})},s.prototype._formatExtField=function(n,c){var d=c||{},f=this.getReplyMsgActive(n);return f&&(d.yxReplyMsg={idClient:f.messageClientId,scene:f.conversationType,from:f.senderId,receiverId:f.receiverId,to:f.conversationId,idServer:f.messageServerId,time:f.createTime}),d},s.prototype._updateReceiptMsg=function(n,c){return Be(Be({},n),{yxUnread:Number(c.unread),yxRead:Number(c.read)})},s.prototype._formatExtAitToPushInfo=function(n,c){function d(m){return Object.keys(m).includes(GM)?void 0:Object.keys(m)}var f={forcePushAccountIds:d(n),forcePush:!0,forcePushContent:c};return f},s.prototype._createReCallMsg=function(n){var c=this,d=Be(Be({},n),{isSelf:!0,sendingState:1,messageType:100,recallType:"reCallMsg",messageClientId:"recall-".concat(n.messageClientId)});return[100,0].includes(n.messageType)&&(d.oldText=n.text,d.canEdit=!0,d.canEditTimer=setTimeout(function(){var f=c.getMsg(d.conversationId,[d.messageClientId])[0];f&&c.addMsg(f.conversationId,[Be(Be({},f),{canEdit:!1})])},q8)),d},s.prototype._createBeReCallMsg=function(n){return Be(Be({},n.messageRefer),{isSelf:n.messageRefer.senderId===this.rootStore.userStore.myUserInfo.accountId,sendingState:1,messageType:100,recallType:"beReCallMsg",messageClientId:"recall-".concat(n.messageRefer.messageClientId)})},s.prototype._getAIConfig=function(n){var c=this,d,f=n.serverExtension,m=n.conversationId,y=n.receiverId,M=n.messageType,S=n.text,E=S===void 0?"":S,b;try{b=JSON.parse(f||"{}")}catch{b={}}var R=b.yxAitMsg||{},x=this.getReplyMsgActive(m),L=this.rootStore.uiStore.getRelation(y).relation,q=this.rootStore.userStore.myUserInfo.accountId,D=void 0;if(L==="ai")if(M===0){var G=(this.msgs.get(m)||[]).slice(-30).filter(function(Z){return Z.messageType===0}),J=G.findIndex(function(Z){return Z.senderId===q});G=J===-1?[]:G.slice(J),D={accountId:y,content:{msg:E,type:0},messages:G.map(function(Z){var le=Z.senderId===q?"user":"assistant";return{role:le,msg:Z.text||"",type:0}})}}else D={accountId:y};var ne={};Object.keys(R).forEach(function(Z){c.rootStore.aiUserStore.aiUsers.has(Z)&&(ne[Z]=R[Z])});var z=this._findMinStart(ne),$=this.rootStore.aiUserStore.aiUsers.get(z||"");return $&&(D={accountId:$.accountId,content:{msg:E,type:0}}),x&&D&&(x.messageType===0?D.messages=[{role:"user",msg:x.text||"",type:0}]:D.messages=void 0),D==null||(D.aiStream=(d=this.localOptions)===null||d===void 0?void 0:d.aiStream),D},s.prototype._findMinStart=function(n){var c,d,f=Number.MAX_VALUE,m=void 0;for(var y in n){var M=n[y].segments;try{for(var S=(c=void 0,hN(M)),E=S.next();!E.done;E=S.next()){var b=E.value;b.start<f&&(f=b.start,m=y)}}catch(R){c={error:R}}finally{try{E&&!E.done&&(d=S.return)&&d.call(S)}finally{if(c)throw c.error}}}return m},s}(),Q8=function(){function s(n,c){this.rootStore=n,this.nim=c,this.blacklist=[],this.mutes=[],this.logger=null,vn(this),this.logger=n.logger,this._onBlockListAdded=this._onBlockListAdded.bind(this),this._onBlockListRemoved=this._onBlockListRemoved.bind(this),this._onP2PMessageMuteModeChanged=this._onP2PMessageMuteModeChanged.bind(this),c.V2NIMUserService.on("onBlockListAdded",this._onBlockListAdded),c.V2NIMUserService.on("onBlockListRemoved",this._onBlockListRemoved),c.V2NIMSettingService.on("onP2PMessageMuteModeChanged",this._onP2PMessageMuteModeChanged)}return s.prototype.resetState=function(){this.blacklist=[],this.mutes=[]},s.prototype.destroy=function(){this.resetState(),this.nim.V2NIMUserService.off("onBlockListAdded",this._onBlockListAdded),this.nim.V2NIMUserService.off("onBlockListRemoved",this._onBlockListRemoved),this.nim.V2NIMSettingService.off("onP2PMessageMuteModeChanged",this._onP2PMessageMuteModeChanged)},s.prototype.addBlacklist=function(n){this.blacklist=fn([],jn(new Set(this.blacklist.concat(n))),!1)},s.prototype.removeBlacklist=function(n){this.blacklist=this.blacklist.filter(function(c){return n.every(function(d){return c!==d})})},s.prototype.isInBlacklist=function(n){return this.blacklist.includes(n)},s.prototype.addMutes=function(n){this.mutes=fn([],jn(new Set(this.mutes.concat(n))),!1)},s.prototype.removeMutes=function(n){this.mutes=this.mutes.filter(function(c){return n.every(function(d){return c!==d})})},s.prototype.getBlockListActive=function(){var n,c;return $e(this,void 0,void 0,function(){var d,f;return Ke(this,function(m){switch(m.label){case 0:return m.trys.push([0,2,,3]),(n=this.logger)===null||n===void 0||n.log("getBlockListActive"),[4,this.nim.V2NIMUserService.getBlockList()];case 1:return d=m.sent(),this.addBlacklist(d),[2,d];case 2:throw f=m.sent(),(c=this.logger)===null||c===void 0||c.error("getBlockListActive failed: ",f),f;case 3:return[2]}})})},s.prototype.getP2PMuteListActive=function(){var n,c;return $e(this,void 0,void 0,function(){var d,f;return Ke(this,function(m){switch(m.label){case 0:return m.trys.push([0,2,,3]),(n=this.logger)===null||n===void 0||n.log("getP2PMuteListActive"),[4,this.nim.V2NIMSettingService.getP2PMessageMuteList()];case 1:return d=m.sent(),this.addMutes(d),[2,d];case 2:throw f=m.sent(),(c=this.logger)===null||c===void 0||c.error("getP2PMuteListActive failed: ",f),f;case 3:return[2]}})})},s.prototype.addUserToBlockListActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("addUserToBlockListActive",n),[4,this.nim.V2NIMUserService.addUserToBlockList(n)];case 1:return y.sent(),this.addBlacklist([n]),(d=this.logger)===null||d===void 0||d.log("addUserToBlockListActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("addUserToBlockListActive failed: ",n,m),m;case 3:return[2]}})})},s.prototype.removeUserFromBlockListActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("removeUserFromBlockListActive",n),[4,this.nim.V2NIMUserService.removeUserFromBlockList(n)];case 1:return y.sent(),this.removeBlacklist([n]),(d=this.logger)===null||d===void 0||d.log("removeUserFromBlockListActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("removeUserFromBlockListActive failed: ",n,m),m;case 3:return[2]}})})},s.prototype.setP2PMessageMuteModeActive=function(n,c){var d,f,m;return $e(this,void 0,void 0,function(){var y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("setP2PMessageMuteModeActive",n,c),[4,this.nim.V2NIMSettingService.setP2PMessageMuteMode(n,c)];case 1:return M.sent(),c===1?this.addMutes([n]):c===0&&this.removeMutes([n]),(f=this.logger)===null||f===void 0||f.log("setP2PMessageMuteModeActive success",{accountId:n,muteMode:c}),[3,3];case 2:throw y=M.sent(),(m=this.logger)===null||m===void 0||m.error("setP2PMessageMuteModeActive failed: ",{accountId:n,muteMode:c},y),y;case 3:return[2]}})})},s.prototype._onBlockListAdded=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onBlockListAdded",n),this.addBlacklist([n.accountId])},s.prototype._onBlockListRemoved=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onBlockListRemoved",n),this.removeBlacklist([n])},s.prototype._onP2PMessageMuteModeChanged=function(n,c){var d;(d=this.logger)===null||d===void 0||d.log("_onP2PMessageMuteModeChanged",n,c),c===1?this.addMutes([n]):c===0&&this.removeMutes([n])},s}(),z8=function(){function s(n,c){this.rootStore=n,this.nim=c,this.conversations=new Map,this.totalUnreadCount=0,this.logger=null,vn(this),this._onSyncStarted=this._onSyncStarted.bind(this),this._onSyncFinished=this._onSyncFinished.bind(this),this._onSyncFailed=this._onSyncFailed.bind(this),this._onConversationCreated=this._onConversationCreated.bind(this),this._onConversationDeleted=this._onConversationDeleted.bind(this),this._onConversationChanged=this._onConversationChanged.bind(this),this._onTotalUnreadCountChanged=this._onTotalUnreadCountChanged.bind(this),this.logger=n.logger,c.V2NIMConversationService.on("onSyncStarted",this._onSyncStarted),c.V2NIMConversationService.on("onSyncFinished",this._onSyncFinished),c.V2NIMConversationService.on("onSyncFailed",this._onSyncFailed),c.V2NIMConversationService.on("onConversationCreated",this._onConversationCreated),c.V2NIMConversationService.on("onConversationDeleted",this._onConversationDeleted),c.V2NIMConversationService.on("onConversationChanged",this._onConversationChanged),c.V2NIMConversationService.on("onTotalUnreadCountChanged",this._onTotalUnreadCountChanged)}return s.prototype.resetState=function(){var n;(n=this.logger)===null||n===void 0||n.log("Conversation resetState"),this.conversations.clear(),this.totalUnreadCount=0},s.prototype.destroy=function(){this.resetState(),this.nim.V2NIMConversationService.off("onSyncStarted",this._onSyncStarted),this.nim.V2NIMConversationService.off("onSyncFinished",this._onSyncFinished),this.nim.V2NIMConversationService.off("onSyncFailed",this._onSyncFailed),this.nim.V2NIMConversationService.off("onConversationCreated",this._onConversationCreated),this.nim.V2NIMConversationService.off("onConversationDeleted",this._onConversationDeleted),this.nim.V2NIMConversationService.off("onConversationChanged",this._onConversationChanged),this.nim.V2NIMConversationService.off("onTotalUnreadCountChanged",this._onTotalUnreadCountChanged)},s.prototype.addConversation=function(n){var c=this;n.filter(function(d){return!!d.conversationId}).filter(function(d){return[1,2].includes(d.type)}).forEach(function(d){return $e(c,void 0,void 0,function(){var f;return Ke(this,function(m){return f=this.conversations.get(d.conversationId),this.conversations.set(d.conversationId,Be(Be({},f),d)),[2]})})})},s.prototype.updateConversation=function(n){var c=this;n.filter(function(d){return!!d.conversationId}).filter(function(d){return[1,2].includes(d.type)}).forEach(function(d){var f=c.conversations.get(d.conversationId);c.conversations.set(d.conversationId,Be(Be({},f),d))})},s.prototype.removeConversation=function(n){var c=this;n.forEach(function(d){c.conversations.delete(d),c.rootStore.uiStore.selectedConversation===d&&c.rootStore.uiStore.unselectConversation()})},s.prototype.resetConversation=function(n){var c,d,f,m;return $e(this,void 0,void 0,function(){var y,M;return Ke(this,function(S){switch(S.label){case 0:if((c=this.logger)===null||c===void 0||c.log("resetConversation",n),y=this.conversations.get(n),!y)return(d=this.logger)===null||d===void 0||d.warn("resetConversation: conversation is not found.",n),[2];S.label=1;case 1:return S.trys.push([1,4,,5]),y.unreadCount?(this._resetMemoryConversationUnreadCount(y),[4,this.nim.V2NIMConversationService.clearUnreadCountByIds([y.conversationId])]):[3,3];case 2:S.sent(),this._resetMemoryConversationUnreadCount(y),S.label=3;case 3:return(f=this.logger)===null||f===void 0||f.log("resetConversation success"),[3,5];case 4:throw M=S.sent(),(m=this.logger)===null||m===void 0||m.error("resetConversation failed: ",M),M;case 5:return[2]}})})},s.prototype.insertConversationActive=function(n,c,d){var f,m,y;return d===void 0&&(d=!0),$e(this,void 0,void 0,function(){var M,S,E;return Ke(this,function(b){switch(b.label){case 0:if(b.trys.push([0,5,,6]),(f=this.logger)===null||f===void 0||f.log("insertConversationActive",{conversationType:n,receiverId:c,isSelected:d}),M="",n===1)M=this.nim.V2NIMConversationIdUtil.p2pConversationId(c);else if(n===2)M=this.nim.V2NIMConversationIdUtil.teamConversationId(c);else throw new Error("Unsupported conversation type");return this.conversations.has(M)?[3,2]:[4,this.nim.V2NIMConversationService.createConversation(M)];case 1:S=b.sent(),this.addConversation([S]),b.label=2;case 2:return d?[4,this.rootStore.uiStore.selectConversation(M)]:[3,4];case 3:b.sent(),b.label=4;case 4:return(m=this.logger)===null||m===void 0||m.log("insertConversationActive success",{conversationType:n,receiverId:c,isSelected:d}),[3,6];case 5:throw E=b.sent(),(y=this.logger)===null||y===void 0||y.error("insertConversationActive failed: ",{conversationType:n,receiverId:c,isSelected:d},E),E;case 6:return[2]}})})},s.prototype.deleteConversationActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:y.trys.push([0,6,,7]),(c=this.logger)===null||c===void 0||c.log("deleteConversationActive",n),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.stickTopConversationActive(n,!1)];case 2:return y.sent(),[3,4];case 3:return y.sent(),[3,4];case 4:return this.removeConversation([n]),[4,this.nim.V2NIMConversationService.deleteConversation(n,!1)];case 5:return y.sent(),(d=this.logger)===null||d===void 0||d.log("deleteConversationActive success"),[3,7];case 6:return m=y.sent(),(f=this.logger)===null||f===void 0||f.warn("deleteConversationActive failed but continue: ",m),[3,7];case 7:return[2]}})})},s.prototype.stickTopConversationActive=function(n,c){var d,f,m;return $e(this,void 0,void 0,function(){var y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("stickTopConversationActive",n,c),[4,this.nim.V2NIMConversationService.stickTopConversation(n,c)];case 1:return M.sent(),(f=this.logger)===null||f===void 0||f.log("stickTopConversationActive success"),[3,3];case 2:throw y=M.sent(),(m=this.logger)===null||m===void 0||m.error("stickTopConversationActive failed: ",y),y;case 3:return[2]}})})},s.prototype.getConversationListActive=function(n,c){var d,f,m;return $e(this,void 0,void 0,function(){var y,M;return Ke(this,function(S){switch(S.label){case 0:return S.trys.push([0,3,,4]),(d=this.logger)===null||d===void 0||d.log("getConversationListActive",n,c),[4,this.nim.V2NIMConversationService.getConversationList(n,c)];case 1:return y=S.sent(),this.addConversation(y.conversationList),[4,this.getP2PMessageReceipt(y.conversationList.filter(function(E){return E.type===1}).map(function(E){return E.conversationId}))];case 2:return S.sent(),(f=this.logger)===null||f===void 0||f.log("getConversationListActive success",n,c,y),[2,y];case 3:throw M=S.sent(),(m=this.logger)===null||m===void 0||m.error("getConversationListActive failed: ",M,n,c),M;case 4:return[2]}})})},s.prototype.getP2PMessageReceipt=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M,S=this;return Ke(this,function(E){switch(E.label){case 0:return E.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("getP2PMessageReceipt",n),[4,Promise.all(n.map(function(b){return S.nim.V2NIMMessageService.getP2PMessageReceipt(b)}))];case 1:return m=E.sent(),y=m.map(function(b){var R=S.conversations.get(b.conversationId);if(R)return Be(Be({},R),{msgReceiptTime:b.timestamp})}).filter(function(b){return!!b}),this.updateConversation(y),(d=this.logger)===null||d===void 0||d.log("getP2PMessageReceipt success",n,m),[2,m];case 2:throw M=E.sent(),(f=this.logger)===null||f===void 0||f.error("getP2PMessageReceipt failed: ",M,n),M;case 3:return[2]}})})},s.prototype._resetMemoryConversationUnreadCount=function(n){var c=this.conversations.get(n.conversationId);c&&this.updateConversation([Be(Be({},c),{unreadCount:0})])},s.prototype.getConversationReadTimeActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("getConversationReadTimeActive",n),[4,this.nim.V2NIMConversationService.getConversationReadTime(n)];case 1:return m=M.sent(),(d=this.logger)===null||d===void 0||d.log("getConversationReadTimeActive success",n,m),[2,m];case 2:throw y=M.sent(),(f=this.logger)===null||f===void 0||f.error("getConversationReadTimeActive failed: ",y,n),y;case 3:return[2]}})})},s.prototype.markConversationReadActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("markConversationReadActive",n),[4,this.nim.V2NIMConversationService.markConversationRead(n)];case 1:return m=M.sent(),(d=this.logger)===null||d===void 0||d.log("markConversationReadActive success",n,m),[2,m];case 2:throw y=M.sent(),(f=this.logger)===null||f===void 0||f.error("markConversationReadActive failed: ",y,n),y;case 3:return[2]}})})},s.prototype.handleConversationWithAit=function(n){var c=this;n.map(function(d){return $e(c,void 0,void 0,function(){var f,m,y,M,S,E,b;return Ke(this,function(R){switch(R.label){case 0:return d.conversationType===2||d.conversationType===3?d!=null&&d.serverExtension?(f=this.hasAitMsg([d.serverExtension]),[4,this.getConversationReadTimeActive(d.conversationId)]):[3,2]:[3,2];case 1:m=R.sent(),y=d.conversationId==this.rootStore.uiStore.selectedConversation,M=d.senderId===((b=this.rootStore.userStore.myUserInfo)===null||b===void 0?void 0:b.accountId),d.createTime>m&&f&&!y&&!M&&(S=this.conversations.get(d.conversationId),S&&(E=S.aitMsgs||[],E.length===0?this.updateConversation([Be(Be({},S),{aitMsgs:[d.messageClientId]})]):this.updateConversation([Be(Be({},S),{aitMsgs:fn(fn([],jn(E),!1),[d.messageClientId],!1)})]))),R.label=2;case 2:return[2]}})})})},s.prototype.resetConversationAit=function(n){var c=this.conversations.get(n);((c==null?void 0:c.type)===2||(c==null?void 0:c.type)===3)&&this.updateConversation([Be(Be({},c),{aitMsgs:[]})])},s.prototype.hasAitMsg=function(n){var c=this,d=!1;return n!=null&&n.length&&(n==null||n.forEach(function(f){var m,y;try{var M=JSON.parse(f||"{}"),S=M.yxAitMsg,E=c.rootStore.userStore.myUserInfo.accountId;S&&((m=Object.keys(S))===null||m===void 0||m.forEach(function(b){(b===E||b===GM)&&(d=!0)}))}catch{(y=c.logger)===null||y===void 0||y.error("parse serverExtension failed: ",f)}})),d},s.prototype._onSyncStarted=function(){var n;(n=this.logger)===null||n===void 0||n.log("_onSyncStarted")},s.prototype._onSyncFinished=function(){var n,c;return $e(this,void 0,void 0,function(){return Ke(this,function(d){return(n=this.rootStore.conversationStore)===null||n===void 0||n.getConversationListActive(0,this.rootStore.localOptions.conversationLimit||100),(c=this.logger)===null||c===void 0||c.log("_onSyncFinished"),[2]})})},s.prototype._onSyncFailed=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onSyncFailed",n)},s.prototype._onConversationCreated=function(n){var c=this,d;if((d=this.logger)===null||d===void 0||d.log("_onConversationCreated",n),n.type===2)this.nim.V2NIMConversationService.getConversation(n.conversationId).then(function(m){c.addConversation([m]),m.lastMessage&&c.handleConversationWithAit([Be(Be({},m.lastMessage),m.lastMessage.messageRefer)])});else if(this.addConversation([n]),n.type===1){var f=n.conversationId;this.nim.V2NIMMessageService.getP2PMessageReceipt(f).then(function(m){var y=c.conversations.get(f);y&&c.updateConversation([Be(Be({},y),{msgReceiptTime:m.timestamp})])})}},s.prototype._onConversationDeleted=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onConversationDeleted",n),this.removeConversation(n)},s.prototype._onConversationChanged=function(n){var c;return $e(this,void 0,void 0,function(){var d=this;return Ke(this,function(f){return(c=this.logger)===null||c===void 0||c.log("_onConversationChanged",n),this.addConversation(n),n.forEach(function(m){return $e(d,void 0,void 0,function(){var y,M,S,E,b,R;return Ke(this,function(x){switch(x.label){case 0:return y=(S=m.lastMessage)===null||S===void 0?void 0:S.attachment,M=y==null?void 0:y.type,((E=m.lastMessage)===null||E===void 0?void 0:E.messageType)===5&&(M===1&&(!((b=y==null?void 0:y.targetIds)===null||b===void 0)&&b.includes(this.rootStore.userStore.myUserInfo.accountId))||M===2&&((R=m.lastMessage)===null||R===void 0?void 0:R.messageRefer.senderId)===this.rootStore.userStore.myUserInfo.accountId||M===4)?[4,this.deleteConversationActive(m.conversationId)]:[3,2];case 1:return x.sent(),[3,4];case 2:return this.rootStore.uiStore.selectedConversation!==m.conversationId?[3,4]:[4,this.resetConversation(m.conversationId)];case 3:x.sent(),x.label=4;case 4:return m.type===2&&m.unreadCount==0&&this.resetConversationAit(m.conversationId),[2]}})})}),[2]})})},s.prototype._onTotalUnreadCountChanged=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onTotalUnreadCountChanged",n),this.totalUnreadCount=n},s}(),X8=function(){function s(n,c,d){this.rootStore=n,this.nim=c,this.localOptions=d,this.teams=new Map,this.logger=null,vn(this),this.logger=n.logger,this._onReceiveTeamJoinActionInfo=this._onReceiveTeamJoinActionInfo.bind(this),this._onSyncFailed=this._onSyncFailed.bind(this),this._onSyncFinished=this._onSyncFinished.bind(this),this._onSyncStarted=this._onSyncStarted.bind(this),this._onTeamCreated=this._onTeamCreated.bind(this),this._onTeamDismissed=this._onTeamDismissed.bind(this),this._onTeamInfoUpdated=this._onTeamInfoUpdated.bind(this),this._onTeamJoined=this._onTeamJoined.bind(this),this._onTeamLeft=this._onTeamLeft.bind(this),this._onTeamMemberInfoUpdated=this._onTeamMemberInfoUpdated.bind(this),this._onTeamMemberJoined=this._onTeamMemberJoined.bind(this),this._onTeamMemberKicked=this._onTeamMemberKicked.bind(this),this._onTeamMemberLeft=this._onTeamMemberLeft.bind(this),c.V2NIMTeamService.on("onReceiveTeamJoinActionInfo",this._onReceiveTeamJoinActionInfo),c.V2NIMTeamService.on("onSyncFailed",this._onSyncFailed),c.V2NIMTeamService.on("onSyncFinished",this._onSyncFinished),c.V2NIMTeamService.on("onSyncStarted",this._onSyncStarted),c.V2NIMTeamService.on("onTeamCreated",this._onTeamCreated),c.V2NIMTeamService.on("onTeamDismissed",this._onTeamDismissed),c.V2NIMTeamService.on("onTeamInfoUpdated",this._onTeamInfoUpdated),c.V2NIMTeamService.on("onTeamJoined",this._onTeamJoined),c.V2NIMTeamService.on("onTeamLeft",this._onTeamLeft),c.V2NIMTeamService.on("onTeamMemberInfoUpdated",this._onTeamMemberInfoUpdated),c.V2NIMTeamService.on("onTeamMemberJoined",this._onTeamMemberJoined),c.V2NIMTeamService.on("onTeamMemberKicked",this._onTeamMemberKicked),c.V2NIMTeamService.on("onTeamMemberLeft",this._onTeamMemberLeft),c.V2NIMSettingService.on("onTeamMessageMuteModeChanged",this._onTeamMessageMuteModeChanged)}return s.prototype.resetState=function(){this.teams.clear()},s.prototype.destroy=function(){this.resetState(),this.nim.V2NIMTeamService.off("onReceiveTeamJoinActionInfo",this._onReceiveTeamJoinActionInfo),this.nim.V2NIMTeamService.off("onSyncFailed",this._onSyncFailed),this.nim.V2NIMTeamService.off("onSyncFinished",this._onSyncFinished),this.nim.V2NIMTeamService.off("onSyncStarted",this._onSyncStarted),this.nim.V2NIMTeamService.off("onTeamCreated",this._onTeamCreated),this.nim.V2NIMTeamService.off("onTeamDismissed",this._onTeamDismissed),this.nim.V2NIMTeamService.off("onTeamInfoUpdated",this._onTeamInfoUpdated),this.nim.V2NIMTeamService.off("onTeamJoined",this._onTeamJoined),this.nim.V2NIMTeamService.off("onTeamLeft",this._onTeamLeft),this.nim.V2NIMTeamService.off("onTeamMemberInfoUpdated",this._onTeamMemberInfoUpdated),this.nim.V2NIMTeamService.off("onTeamMemberJoined",this._onTeamMemberJoined),this.nim.V2NIMTeamService.off("onTeamMemberKicked",this._onTeamMemberKicked),this.nim.V2NIMTeamService.off("onTeamMemberLeft",this._onTeamMemberLeft),this.nim.V2NIMSettingService.off("onTeamMessageMuteModeChanged",this._onTeamMessageMuteModeChanged)},s.prototype.addTeam=function(n){var c=this;n.filter(function(d){return!!d.isValidTeam}).filter(function(d){return!!d.teamId}).forEach(function(d){c.teams.set(d.teamId,d)})},s.prototype.removeTeam=function(n){var c=this;n.forEach(function(d){c.teams.delete(d)})},s.prototype.updateTeam=function(n){var c=this;n.filter(function(d){return!!d.teamId}).forEach(function(d){var f=c.teams.get(d.teamId);if(f){var m=Be(Be({},f),d);c.teams.set(d.teamId,m)}})},s.prototype.createTeamActive=function(n){var c,d,f,m=n.accounts,y=n.type,M=y===void 0?1:y,S=n.avatar,E=n.name,b=n.intro,R=n.serverExtension;return $e(this,void 0,void 0,function(){var x,L;return Ke(this,function(q){switch(q.label){case 0:return q.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("createTeamActive",{accounts:m,avatar:S,name:E}),[4,this.nim.V2NIMTeamService.createTeam({avatar:S,teamType:M,joinMode:this.localOptions.teamJoinMode,agreeMode:this.localOptions.teamAgreeMode,inviteMode:this.localOptions.teamInviteMode,updateInfoMode:this.localOptions.teamUpdateTeamMode,updateExtensionMode:this.localOptions.teamUpdateExtMode,name:E,intro:b,serverExtension:R},m,"")];case 1:return x=q.sent().team,(d=this.logger)===null||d===void 0||d.log("createTeamActive success",x),[2,x];case 2:throw L=q.sent(),(f=this.logger)===null||f===void 0||f.error("createTeamActive failed: ",{accounts:m,avatar:S,name:E},L,L.code,L.detail),L;case 3:return[2]}})})},s.prototype.applyTeamActive=function(n,c){var d,f,m;return c===void 0&&(c=1),$e(this,void 0,void 0,function(){var y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("applyTeamActive",n),[4,this.nim.V2NIMTeamService.applyJoinTeam(n,c)];case 1:return M.sent(),(f=this.logger)===null||f===void 0||f.log("applyTeamActive success",n),[3,3];case 2:throw y=M.sent(),(m=this.logger)===null||m===void 0||m.error("applyTeamActive failed: ",n,y),y;case 3:return[2]}})})},s.prototype.leaveTeamActive=function(n,c){var d,f,m;return c===void 0&&(c=1),$e(this,void 0,void 0,function(){var y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("leaveTeamActive",n),[4,this.nim.V2NIMTeamService.leaveTeam(n,c)];case 1:return M.sent(),(f=this.logger)===null||f===void 0||f.log("leaveTeamActive success",n),[3,3];case 2:throw y=M.sent(),(m=this.logger)===null||m===void 0||m.error("leaveTeamActive failed: ",n,y),y;case 3:return[2]}})})},s.prototype.dismissTeamActive=function(n,c){var d,f,m;return c===void 0&&(c=1),$e(this,void 0,void 0,function(){var y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("dismissTeamActive",n),[4,this.nim.V2NIMTeamService.dismissTeam(n,c)];case 1:return M.sent(),(f=this.logger)===null||f===void 0||f.log("dismissTeamActive success",n),[3,3];case 2:throw y=M.sent(),(m=this.logger)===null||m===void 0||m.error("dismissTeamActive failed: ",n,y),y;case 3:return[2]}})})},s.prototype.transferTeamActive=function(n){var c,d,f,m=n.teamId,y=n.type,M=y===void 0?1:y,S=n.account,E=n.leave;return $e(this,void 0,void 0,function(){var b;return Ke(this,function(R){switch(R.label){case 0:return R.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("transferTeamActive",{teamId:m,type:M,account:S,leave:E}),[4,this.nim.V2NIMTeamService.transferTeamOwner(m,M,S,E??this.localOptions.leaveOnTransfer)];case 1:return R.sent(),(d=this.logger)===null||d===void 0||d.log("transferTeamActive success",{teamId:m,type:M,account:S,leave:E}),[3,3];case 2:throw b=R.sent(),(f=this.logger)===null||f===void 0||f.error("transferTeamActive failed: ",{teamId:m,type:M,account:S,leave:E},b),b;case 3:return[2]}})})},s.prototype.setTeamChatBannedActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("muteTeamActive",n),[4,this.nim.V2NIMTeamService.setTeamChatBannedMode(n.teamId,n.type||1,n.chatBannedMode)];case 1:return y.sent(),(d=this.logger)===null||d===void 0||d.log("muteTeamActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("muteTeamActive failed: ",n,m),m;case 3:return[2]}})})},s.prototype.updateTeamActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M,S,E;return Ke(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("updateTeamActive",n),m=n.teamId,y=n.type,M=y===void 0?1:y,S=n.info,[4,this.nim.V2NIMTeamService.updateTeamInfo(m,M,S)];case 1:return b.sent(),(d=this.logger)===null||d===void 0||d.log("updateTeamActive success",n),[3,3];case 2:throw E=b.sent(),(f=this.logger)===null||f===void 0||f.error("updateTeamActive failed: ",n,E),E;case 3:return[2]}})})},s.prototype.getTeamActive=function(n,c){var d;return c===void 0&&(c=1),$e(this,void 0,void 0,function(){var f;return Ke(this,function(m){switch(m.label){case 0:return(d=this.logger)===null||d===void 0||d.log("getTeamActive: ",n),f=this.teams.get(n),f?[2,f]:[4,this.getTeamForceActive(n,c)];case 1:return f=m.sent(),this.addTeam([f]),[2,f]}})})},s.prototype.getTeamForceActive=function(n,c){var d,f,m;return c===void 0&&(c=1),$e(this,void 0,void 0,function(){var y,M;return Ke(this,function(S){switch(S.label){case 0:return S.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("getTeamForceActive: ",n),[4,this.nim.V2NIMTeamService.getTeamInfo(n,c)];case 1:return y=S.sent(),(f=this.logger)===null||f===void 0||f.log("getTeamForceActive success",y),[2,y];case 2:throw M=S.sent(),(m=this.logger)===null||m===void 0||m.error("getTeamForceActive failed: ",n,M),M;case 3:return[2]}})})},s.prototype.setTeamMessageMuteModeActive=function(n,c,d){var f,m,y;return $e(this,void 0,void 0,function(){var M;return Ke(this,function(S){switch(S.label){case 0:return S.trys.push([0,2,,3]),(f=this.logger)===null||f===void 0||f.log("setTeamMessageMuteModeActive",{teamId:n,teamType:c,muteMode:d}),[4,this.nim.V2NIMSettingService.setTeamMessageMuteMode(n,c,d)];case 1:return S.sent(),(m=this.logger)===null||m===void 0||m.log("setTeamMessageMuteModeActive success",{teamId:n,teamType:c,muteMode:d}),[3,3];case 2:throw M=S.sent(),(y=this.logger)===null||y===void 0||y.error("setTeamMessageMuteModeActive failed: ",{teamId:n,teamType:c,muteMode:d},M),M;case 3:return[2]}})})},s.prototype.acceptTeamInviteActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("acceptTeamInviteActive: ",n),[4,this.nim.V2NIMTeamService.acceptInvitation(n)];case 1:return y.sent(),(d=this.logger)===null||d===void 0||d.log("acceptTeamInviteActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("acceptTeamInviteActive failed: ",n,m),m;case 3:return[2]}})})},s.prototype.rejectTeamInviteActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("rejectTeamInviteActive: ",n),[4,this.nim.V2NIMTeamService.rejectInvitation(n)];case 1:return y.sent(),(d=this.logger)===null||d===void 0||d.log("rejectTeamInviteActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("rejectTeamInviteActive failed: ",n,m),m;case 3:return[2]}})})},s.prototype.passTeamApplyActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("passTeamApplyActive: ",n),[4,this.nim.V2NIMTeamService.acceptJoinApplication(n)];case 1:return y.sent(),(d=this.logger)===null||d===void 0||d.log("passTeamApplyActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("passTeamApplyActive failed: ",n,m),m;case 3:return[2]}})})},s.prototype.rejectTeamApplyActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("rejectTeamApplyActive: ",n),[4,this.nim.V2NIMTeamService.rejectJoinApplication(n)];case 1:return y.sent(),(d=this.logger)===null||d===void 0||d.log("rejectTeamApplyActive success",n),[3,3];case 2:throw m=y.sent(),(f=this.logger)===null||f===void 0||f.error("rejectTeamApplyActive failed: ",n,m),m;case 3:return[2]}})})},s.prototype.updateTeamMemberRoleActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M,S,E,b;return Ke(this,function(R){switch(R.label){case 0:return R.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("addTeamManagersActive: ",n),m=n.teamId,y=n.type,M=y===void 0?1:y,S=n.accounts,E=n.role,[4,this.nim.V2NIMTeamService.updateTeamMemberRole(m,M,S,E)];case 1:return R.sent(),(d=this.logger)===null||d===void 0||d.log("addTeamManagersActive success",n),[3,3];case 2:throw b=R.sent(),(f=this.logger)===null||f===void 0||f.error("addTeamManagersActive failed: ",n,b),b;case 3:return[2]}})})},s.prototype.getTeamJoinActionInfoListActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("getTeamJoinActionInfoListActive: ",n),[4,this.nim.V2NIMTeamService.getTeamJoinActionInfoList(n)];case 1:return m=M.sent(),this.rootStore.sysMsgStore.addTeamJoinActionMsg(m.infos),(d=this.logger)===null||d===void 0||d.log("getTeamJoinActionInfoListActive success",m),[2,m];case 2:throw y=M.sent(),(f=this.logger)===null||f===void 0||f.error("getTeamJoinActionInfoListActive failed: ",n,y),y;case 3:return[2]}})})},s.prototype.getJoinedTeamListActive=function(){var n,c,d;return $e(this,void 0,void 0,function(){var f,m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(n=this.logger)===null||n===void 0||n.log("getJoinedTeamListActive"),[4,this.nim.V2NIMTeamService.getJoinedTeamList([1])];case 1:return f=y.sent(),this.addTeam(f),(c=this.logger)===null||c===void 0||c.log("getJoinedTeamListActive success",f),[2,f];case 2:throw m=y.sent(),(d=this.logger)===null||d===void 0||d.error("getJoinedTeamListActive failed: ",m),m;case 3:return[2]}})})},s.prototype.getTeamMessageMuteModeActive=function(n,c){var d,f,m;return $e(this,void 0,void 0,function(){var y,M;return Ke(this,function(S){switch(S.label){case 0:return S.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("getTeamMessageMuteModeActive",n,c),[4,this.nim.V2NIMSettingService.getTeamMessageMuteMode(n,c)];case 1:return y=S.sent(),(f=this.logger)===null||f===void 0||f.log("getTeamMessageMuteModeActive success",n,c),[2,y];case 2:throw M=S.sent(),(m=this.logger)===null||m===void 0||m.error("getTeamMessageMuteModeActive failed: ",n,c,M),M;case 3:return[2]}})})},s.prototype._onReceiveTeamJoinActionInfo=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onReceiveTeamJoinActionInfo: ",n),this.rootStore.sysMsgStore.addTeamJoinActionMsg([n])},s.prototype._onSyncFailed=function(n){var c;(c=this.logger)===null||c===void 0||c.log("V2NIMTeamService _onSyncFailed: ",n)},s.prototype._onSyncFinished=function(){var n,c;return $e(this,void 0,void 0,function(){return Ke(this,function(d){return(n=this.rootStore.conversationStore)===null||n===void 0||n.getConversationListActive(0,this.rootStore.localOptions.conversationLimit||100),(c=this.logger)===null||c===void 0||c.log("V2NIMTeamService _onSyncFinished"),[2]})})},s.prototype._onSyncStarted=function(){var n;(n=this.logger)===null||n===void 0||n.log("V2NIMTeamService _onSyncStarted")},s.prototype._onTeamCreated=function(n){var c;(c=this.logger)===null||c===void 0||c.log("V2NIMTeamService _onTeamCreated: ",n),this.addTeam([n])},s.prototype._onTeamDismissed=function(n){var c;(c=this.logger)===null||c===void 0||c.log("V2NIMTeamService _onTeamDismissed: ",n),this._handleRemoveTeam(n.teamId)},s.prototype._onTeamInfoUpdated=function(n){var c;(c=this.logger)===null||c===void 0||c.log("V2NIMTeamService _onTeamInfoUpdated: ",n),this.updateTeam([n])},s.prototype._onTeamJoined=function(n){var c;(c=this.logger)===null||c===void 0||c.log("V2NIMTeamService _onTeamJoined: ",n),this.addTeam([n])},s.prototype._onTeamLeft=function(n){var c;return $e(this,void 0,void 0,function(){return Ke(this,function(d){return(c=this.logger)===null||c===void 0||c.log("V2NIMTeamService _onTeamLeft: ",n),this._handleRemoveTeam(n.teamId),[2]})})},s.prototype._onTeamMemberInfoUpdated=function(n){var c;(c=this.logger)===null||c===void 0||c.log("V2NIMTeamService _onTeamMemberInfoUpdated: ",n);var d=n[0].teamId;this.rootStore.teamMemberStore.updateTeamMember(d,n)},s.prototype._onTeamMemberJoined=function(n){var c;return $e(this,void 0,void 0,function(){var d;return Ke(this,function(f){return(c=this.logger)===null||c===void 0||c.log("V2NIMTeamService _onTeamMemberJoined: ",n),d=n[0].teamId,this.rootStore.teamMemberStore.addTeamMember(d,n),[2]})})},s.prototype._onTeamMemberKicked=function(n,c){var d;return $e(this,void 0,void 0,function(){var f;return Ke(this,function(m){return(d=this.logger)===null||d===void 0||d.log("V2NIMTeamService _onTeamMemberKicked: ",n,c),f=c[0].teamId,this.rootStore.teamMemberStore.removeTeamMember(f,c.map(function(y){return y.accountId})),[2]})})},s.prototype._onTeamMemberLeft=function(n){var c;return $e(this,void 0,void 0,function(){var d;return Ke(this,function(f){return(c=this.logger)===null||c===void 0||c.log("V2NIMTeamService _onTeamMemberLeft: ",n),d=n[0].teamId,this.rootStore.teamMemberStore.removeTeamMember(d,n.map(function(m){return m.accountId})),[2]})})},s.prototype._handleRemoveTeam=function(n){this.removeTeam([n]),this.rootStore.teamMemberStore.removeTeamMember(n)},s.prototype._onTeamMessageMuteModeChanged=function(n,c,d){var f;(f=this.logger)===null||f===void 0||f.log("V2NIMTeamService _onTeamMessageMuteModeChanged: ",n,c,d)},s}(),Z8=function(){function s(n,c){this.rootStore=n,this.nim=c,this.teamMembers=new Map,this.logger=null,vn(this),this.logger=n.logger}return s.prototype.resetState=function(){this.teamMembers.clear()},s.prototype.destroy=function(){this.resetState()},s.prototype.addTeamMemberActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M,S,E,b;return Ke(this,function(R){switch(R.label){case 0:return R.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("addTeamMemberActive",n),m=n.teamId,y=n.type,M=y===void 0?1:y,S=n.accounts,E=n.ps,[4,this.nim.V2NIMTeamService.inviteMember(m,M,S,E)];case 1:return R.sent(),(d=this.logger)===null||d===void 0||d.log("addTeamMemberActive success",n),[3,3];case 2:throw b=R.sent(),(f=this.logger)===null||f===void 0||f.error("addTeamMemberActive failed: ",n,b),b;case 3:return[2]}})})},s.prototype.removeTeamMemberActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M,S,E;return Ke(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("removeTeamMemberActive",n),m=n.teamId,y=n.type,M=y===void 0?1:y,S=n.accounts,[4,this.nim.V2NIMTeamService.kickMember(m,M,S)];case 1:return b.sent(),(d=this.logger)===null||d===void 0||d.log("removeTeamMemberActive success",n),[3,3];case 2:throw E=b.sent(),(f=this.logger)===null||f===void 0||f.error("removeTeamMemberActive failed: ",n,E),E;case 3:return[2]}})})},s.prototype.getTeamMemberActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M,S,E,b;return Ke(this,function(R){switch(R.label){case 0:return R.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("getTeamMemberActive",n),m=n.teamId,y=n.queryOption,M=n.type,S=M===void 0?1:M,[4,this.nim.V2NIMTeamService.getTeamMemberList(m,S,y)];case 1:return E=R.sent(),(d=this.logger)===null||d===void 0||d.log("getTeamMemberActive success: ",m,S,y,E),this.setTeamMembers(m,E.memberList),[2,E];case 2:throw b=R.sent(),(f=this.logger)===null||f===void 0||f.error("getTeamMemberActive failed: ",n,b),b;case 3:return[2]}})})},s.prototype.updateMyMemberInfoActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M,S,E;return Ke(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("updateMyMemberInfo",n),m=n.teamId,y=n.type,M=y===void 0?1:y,S=n.memberInfo,[4,this.nim.V2NIMTeamService.updateSelfTeamMemberInfo(m,M,S)];case 1:return b.sent(),(d=this.logger)===null||d===void 0||d.log("updateMyMemberInfo success: ",n),[3,3];case 2:throw E=b.sent(),(f=this.logger)===null||f===void 0||f.error("updateMyMemberInfo failed: ",n,E),E;case 3:return[2]}})})},s.prototype.setTeamMembers=function(n,c){var d=new Map;c.forEach(function(f){d.set(f.accountId,f)}),this.teamMembers.set(n,d)},s.prototype.addTeamMember=function(n,c){var d=this.teamMembers.get(n);d||(d=new Map),c.filter(function(f){return!!f.inTeam}).filter(function(f){return!!f.accountId}).forEach(function(f){d.set(f.accountId,f)}),this.teamMembers.set(n,d)},s.prototype.removeTeamMember=function(n,c){if(!c||!c.length){this.teamMembers.delete(n);return}var d=this.teamMembers.get(n);d&&(c.forEach(function(f){d.delete(f)}),this.teamMembers.set(n,d))},s.prototype.updateTeamMember=function(n,c){var d=this.teamMembers.get(n);d&&(c.forEach(function(f){var m=d.get(f.accountId);m&&(m=Be(Be({},m),f),d.set(f.accountId,m))}),this.teamMembers.set(n,d))},s.prototype.getTeamMember=function(n,c){var d,f=fn([],jn(((d=this.teamMembers.get(n))===null||d===void 0?void 0:d.values())||[]),!1);return!c||!c.length?f:f.filter(function(m){return c.some(function(y){return y===m.accountId})})},s}(),e7=function(){function s(n,c){this.rootStore=n,this.nim=c,this.friendApplyMsg=new Map,this.teamJoinActionMsg=new Map,this.logger=null,vn(this),this.logger=n.logger}return s.prototype.resetState=function(){this.friendApplyMsg.clear(),this.teamJoinActionMsg.clear()},s.prototype.destroy=function(){this.resetState()},Object.defineProperty(s.prototype,"friendApplyMsgs",{get:function(){return Array.from(this.friendApplyMsg.values()).sort(function(n,c){return c.timestamp-n.timestamp})},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"teamJoinActionMsgs",{get:function(){return Array.from(this.teamJoinActionMsg.values()).sort(function(n,c){return c.timestamp-n.timestamp})},enumerable:!1,configurable:!0}),s.prototype.addFriendApplyMsg=function(n){var c=this;n.forEach(function(d){var f=c.createFriendApplyMsgKey(d);c.friendApplyMsg.set(f,d)})},s.prototype.deleteFriendApplyMsg=function(n){var c=this;n.forEach(function(d){var f=c.createFriendApplyMsgKey(d);c.friendApplyMsg.delete(f)})},s.prototype.updateFriendApplyMsg=function(n){var c=this;n.forEach(function(d){var f=c.createFriendApplyMsgKey(d),m=c.friendApplyMsg.get(f);m&&c.friendApplyMsg.set(f,Be(Be({},m),d))})},s.prototype.addTeamJoinActionMsg=function(n){var c=this;n.forEach(function(d){var f=c.createTeamJoinActionMsgKey(d);c.teamJoinActionMsg.set(f,d)})},s.prototype.deleteTeamJoinActionMsg=function(n){var c=this;n.forEach(function(d){var f=c.createTeamJoinActionMsgKey(d);c.teamJoinActionMsg.delete(f)})},s.prototype.updateTeamJoinActionMsg=function(n){var c=this;n.forEach(function(d){var f=c.createTeamJoinActionMsgKey(d),m=c.teamJoinActionMsg.get(f),y=Be(Be({},m),d);c.teamJoinActionMsg.set(f,y)})},s.prototype.getUnreadFriendApplyMsgsCount=function(){return this.friendApplyMsgs.filter(function(n){return!n.isRead}).length},s.prototype.getUnreadTeamJoinActionMsgsCount=function(){return this.teamJoinActionMsgs.filter(function(n){return!n.isRead}).length},s.prototype.getTotalUnreadMsgsCount=function(){return this.getUnreadFriendApplyMsgsCount()+this.getUnreadTeamJoinActionMsgsCount()},s.prototype.setAllApplyMsgRead=function(){this.updateFriendApplyMsg(this.friendApplyMsgs.map(function(n){return Be(Be({},n),{isRead:!0})})),this.updateTeamJoinActionMsg(this.teamJoinActionMsgs.map(function(n){return Be(Be({},n),{isRead:!0})}))},s.prototype.createTeamJoinActionMsgKey=function(n){return"".concat(n.teamId,"_").concat(n.operatorAccountId)},s.prototype.createFriendApplyMsgKey=function(n){return"".concat(n.applicantAccountId,"_").concat(n.recipientAccountId)},s}(),t7=function(){function s(n,c){this.rootStore=n,this.nim=c,this.users=new Map,this.myUserInfo={accountId:this.nim.V2NIMLoginService.getLoginUser(),name:"",createTime:Date.now(),updateTime:Date.now()},this.logger=null,this._getUserInfo=j8(this._getUserInfos,1e3,100),vn(this),this._onUserProfileChanged=this._onUserProfileChanged.bind(this),this.logger=n.logger,c.V2NIMUserService.on("onUserProfileChanged",this._onUserProfileChanged)}return s.prototype.resetState=function(){this.users.clear(),this.myUserInfo={accountId:this.nim.V2NIMLoginService.getLoginUser(),name:"",createTime:Date.now(),updateTime:Date.now()}},s.prototype.destroy=function(){this.resetState(),this.nim.V2NIMUserService.off("onUserProfileChanged",this._onUserProfileChanged)},s.prototype.addUsers=function(n){var c=this;n.filter(function(d){return!!d.accountId}).forEach(function(d){c.users.set(d.accountId,d)})},s.prototype.removeUsers=function(n){var c=this;n.forEach(function(d){c.users.delete(d)})},s.prototype.getMyUserServerExt=function(){var n,c={};try{c=JSON.parse(((n=this.myUserInfo)===null||n===void 0?void 0:n.serverExtension)||"{}")}catch{}return c},s.prototype.updateSelfUserProfileActive=function(n,c){var d,f,m,y;return $e(this,void 0,void 0,function(){var M,S,E,b;return Ke(this,function(R){switch(R.label){case 0:if(R.trys.push([0,6,,7]),(d=this.logger)===null||d===void 0||d.log("updateSelfUserProfileActive",n,c),!c)return[3,4];R.label=1;case 1:return R.trys.push([1,3,,4]),M=this.nim.V2NIMStorageService.createUploadFileTask({fileObj:c}),[4,this.nim.V2NIMStorageService.uploadFile(M,function(){})];case 2:return S=R.sent(),n.avatar=S,[3,4];case 3:return E=R.sent(),(f=this.logger)===null||f===void 0||f.warn("upload avatar error and save continue.",E),[3,4];case 4:return[4,this.nim.V2NIMUserService.updateSelfUserProfile(n)];case 5:return R.sent(),(m=this.logger)===null||m===void 0||m.log("updateSelfUserProfileActive success",n,c),[3,7];case 6:throw b=R.sent(),(y=this.logger)===null||y===void 0||y.error("updateSelfUserProfileActive failed:",n,b,c),b;case 7:return[2]}})})},s.prototype.getUserActive=function(n){var c,d;return $e(this,void 0,void 0,function(){var f;return Ke(this,function(m){return(c=this.logger)===null||c===void 0||c.log("getUserListActive",n),f=this.users.get(n),f?((d=this.logger)===null||d===void 0||d.log("getUserListActive success",f,n),[2,f]):[2,this.getUserForceActive(n)]})})},s.prototype.getUserForceActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("getUserListForceActive",n),[4,this._getUserInfo(n)];case 1:return m=M.sent(),(d=this.logger)===null||d===void 0||d.log("getUserListForceActive success",m,n),[2,m];case 2:throw y=M.sent(),(f=this.logger)===null||f===void 0||f.error("getUserListForceActive failed: ",n,y),y;case 3:return[2]}})})},s.prototype.getMyUserInfoActive=function(){var n,c,d;return $e(this,void 0,void 0,function(){var f,m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(n=this.logger)===null||n===void 0||n.log("getMyUserInfoActive"),[4,this.nim.V2NIMUserService.getUserList([this.nim.V2NIMLoginService.getLoginUser()])];case 1:return f=y.sent(),this.myUserInfo=f[0],this.addUsers(f),(c=this.logger)===null||c===void 0||c.log("getMyUserInfoActive success",f),[2,f[0]];case 2:throw m=y.sent(),(d=this.logger)===null||d===void 0||d.error("getMyUserInfoActive failed: ",m),m;case 3:return[2]}})})},s.prototype._getUserInfos=function(n){return $e(this,void 0,void 0,function(){var c;return Ke(this,function(d){switch(d.label){case 0:return[4,this.nim.V2NIMUserService.getUserList(n)];case 1:return c=d.sent(),this.addUsers(c),[2,c]}})})},s.prototype._onUserProfileChanged=function(n){var c=this,d;(d=this.logger)===null||d===void 0||d.log("_onUserProfileChanged: ",n),n.forEach(function(f){f.accountId===c.myUserInfo.accountId&&(c.myUserInfo=f)}),this.addUsers(n)},s}(),r7=function(){function s(n,c,d){this.rootStore=n,this.nim=c,this.localOptions=d,this.aiUsers=new Map,this.aiReqMsgs=[],this.aiResMsgs=[],this.logger=null,this.onSendAIProxyErrorHandler=function(){},this.requestIds=[],this.proxyAccountId="",vn(this),this.logger=n.logger,this._onProxyAIModelCall=this._onProxyAIModelCall.bind(this),this.nim.V2NIMAIService.on("onProxyAIModelCall",this._onProxyAIModelCall)}return Object.defineProperty(s.prototype,"aiProxying",{get:function(){return this.aiReqMsgs.length>this.aiResMsgs.length},enumerable:!1,configurable:!0}),s.prototype.resetState=function(){this.aiUsers.clear(),this.aiReqMsgs=[],this.aiResMsgs=[]},s.prototype.destroy=function(){this.resetState(),this.nim.V2NIMAIService.off("onProxyAIModelCall",this._onProxyAIModelCall)},s.prototype.addAIUsers=function(n){var c=this;n.filter(function(d){return!!d.accountId}).forEach(function(d){c.aiUsers.set(d.accountId,d)})},s.prototype.removeAIUsers=function(n){var c=this;n.forEach(function(d){c.aiUsers.delete(d)})},s.prototype.getAIUserList=function(n){var c=fn([],jn(this.aiUsers.values()),!1),d=function(f,m){return m.createTime-f.createTime};return n&&n.length?c.filter(function(f){return n.includes(f.accountId)}).sort(d):c.sort(d)},s.prototype.getAISearchUser=function(){var n,c,d=this.getAIUserList();return(c=(n=this.localOptions.aiUserAgentProvider)===null||n===void 0?void 0:n.getAISearchUser)===null||c===void 0?void 0:c.call(n,d)},s.prototype.getAITranslateUser=function(){var n,c,d=this.getAIUserList();return(c=(n=this.localOptions.aiUserAgentProvider)===null||n===void 0?void 0:n.getAITranslateUser)===null||c===void 0?void 0:c.call(n,d)},s.prototype.getAITranslateLangs=function(){var n,c,d=this.getAIUserList();return((c=(n=this.localOptions.aiUserAgentProvider)===null||n===void 0?void 0:n.getAITranslateLangs)===null||c===void 0?void 0:c.call(n,d))||[]},s.prototype.getAIUserServerExt=function(n){var c=this.aiUsers.get(n);if(!c)return{};try{return JSON.parse(c.serverExtension||"{}")}catch{return{}}},s.prototype.getAIChatUser=function(){var n=this,c=this.getAIUserList();return c.filter(function(d){var f=n.getAIUserServerExt(d.accountId);return f.aiChat===1})},s.prototype.getAIPinDefaultUser=function(){var n=this,c=this.getAIUserList();return c.filter(function(d){var f=n.getAIUserServerExt(d.accountId);return f.pinDefault===1})},s.prototype.getAIPinUser=function(){var n=this.rootStore.userStore.getMyUserServerExt();return this.getAIPinDefaultUser().filter(function(c){var d;return!(!((d=n.unpinAIUsers)===null||d===void 0)&&d.includes(c.accountId))})},s.prototype.isAIPinUser=function(n){return this.getAIPinUser().some(function(c){return c.accountId===n})},s.prototype.isAISearching=function(){var n;return this.proxyAccountId===((n=this.getAISearchUser())===null||n===void 0?void 0:n.accountId)},s.prototype.isAITranslating=function(){var n;return this.proxyAccountId===((n=this.getAITranslateUser())===null||n===void 0?void 0:n.accountId)},s.prototype.resetAIProxy=function(){this.requestIds=[],this.aiReqMsgs=[],this.aiResMsgs=[],this.proxyAccountId="",this.onSendAIProxyErrorHandler=function(){}},s.prototype.getAIUserListActive=function(){var n,c,d;return $e(this,void 0,void 0,function(){var f,m;return Ke(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),(n=this.logger)===null||n===void 0||n.log("getAIUserListActive"),[4,this.nim.V2NIMAIService.getAIUserList()];case 1:return f=y.sent(),this.addAIUsers(f),(c=this.logger)===null||c===void 0||c.log("getAIUserListActive success:",f),[3,3];case 2:return m=y.sent(),(d=this.logger)===null||d===void 0||d.log("getAIUserListActive failed:",m),[3,3];case 3:return[2]}})})},s.prototype.sendAIProxyActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("sendAIProxyActive",n),m=Be({},n),n.requestId?(this.resetAIProxy(),this.requestIds.push(n.requestId),this.proxyAccountId=n.accountId):(m.requestId=Math.random().toString(36).slice(2),this.requestIds.push(m.requestId)),n.onSendAIProxyErrorHandler&&(this.onSendAIProxyErrorHandler=n.onSendAIProxyErrorHandler),[4,this.nim.V2NIMAIService.proxyAIModelCall(m)];case 1:return M.sent(),this.aiReqMsgs.push(n.content),(d=this.logger)===null||d===void 0||d.log("sendAIProxyActive success:",n),[3,3];case 2:throw y=M.sent(),(f=this.logger)===null||f===void 0||f.error("sendAIProxyActive failed:",y.toString()),this.onSendAIProxyErrorHandler(y.code),y;case 3:return[2]}})})},s.prototype._onProxyAIModelCall=function(n){var c;(c=this.logger)===null||c===void 0||c.log("_onProxyAIModelCall",n),this.requestIds.includes(n.requestId)&&(n.code===200?this.aiResMsgs.push(n.content.msg):(this.aiReqMsgs.pop(),this.onSendAIProxyErrorHandler(n.code)))},s}(),n7=function(){function s(n){this.rootStore=n,this.selectedContactType="",this.selectedConversation="",this.logger=null,vn(this),this.logger=n.logger}return s.prototype.resetState=function(){this.selectedContactType="",this.selectedConversation=""},s.prototype.destroy=function(){this.resetState()},s.prototype.selectContactType=function(n){var c;(c=this.logger)===null||c===void 0||c.log("selectContactType: ",n),this.selectedContactType=n},s.prototype.unselectContactType=function(){var n;(n=this.logger)===null||n===void 0||n.log("unselectContactType"),this.selectedContactType=""},s.prototype.selectConversation=function(n){var c,d,f,m,y,M;return $e(this,void 0,void 0,function(){return Ke(this,function(S){switch(S.label){case 0:return(c=this.logger)===null||c===void 0||c.log("selectConversation: ",n),n===this.selectedConversation?[2]:(this.rootStore.msgStore.msgs.resetLimitState(),this.selectedConversation=n,n?!((d=this.rootStore.sdkOptions)===null||d===void 0)&&d.enableV2CloudConversation?((f=this.rootStore.conversationStore)===null||f===void 0||f.resetConversationAit(n),[4,(m=this.rootStore.conversationStore)===null||m===void 0?void 0:m.resetConversation(n)]):[3,2]:[3,4]);case 1:return S.sent(),[3,4];case 2:return(y=this.rootStore.localConversationStore)===null||y===void 0||y.resetConversationAit(n),[4,(M=this.rootStore.localConversationStore)===null||M===void 0?void 0:M.resetConversation(n)];case 3:S.sent(),S.label=4;case 4:return[2]}})})},s.prototype.unselectConversation=function(){var n;(n=this.logger)===null||n===void 0||n.log("unselectConversation"),this.selectedConversation="",this.rootStore.msgStore.msgs.resetLimitState()},s.prototype.getRelation=function(n){var c="stranger";return this.rootStore.userStore.myUserInfo.accountId===n?c="myself":this.rootStore.aiUserStore.aiUsers.has(n)?c="ai":this.rootStore.friendStore.friends.has(n)?c="friend":c="stranger",{relation:c,isInBlacklist:this.rootStore.relationStore.isInBlacklist(n)}},s.prototype.getFriendWithUserNameCard=function(n){var c=this.rootStore.friendStore.friends.get(n)||{accountId:"",serverExtension:"",customerExtension:""},d=this.rootStore.userStore.users.get(n)||{accountId:"",name:"",createTime:Date.now()};return Be(Be({},c),d)},s.prototype.getAppellation=function(n){var c,d=n.account,f=n.teamId,m=f===void 0?"":f,y=n.ignoreAlias,M=y===void 0?!1:y,S=n.nickFromMsg,E=S===void 0?"":S,b=this.rootStore.aiUserStore.aiUsers.get(d);if(b)return b.name||d;var R=this.rootStore.friendStore.friends.get(d),x=this.rootStore.userStore.users.get(d),L=(c=this.rootStore.teamMemberStore.teamMembers.get(m))===null||c===void 0?void 0:c.get(d);return!M&&(R==null?void 0:R.alias)||(L==null?void 0:L.teamNick)||(x==null?void 0:x.name)||E||d},Object.defineProperty(s.prototype,"friends",{get:function(){return fn([],jn(this.rootStore.friendStore.friends.values()),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"conversations",{get:function(){var n;return!((n=this.rootStore.conversationStore)===null||n===void 0)&&n.conversations.values()?fn([],jn(this.rootStore.conversationStore.conversations.values()),!1):[]},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"localConversations",{get:function(){var n;return!((n=this.rootStore.localConversationStore)===null||n===void 0)&&n.conversations.values()?fn([],jn(this.rootStore.localConversationStore.conversations.values()),!1):[]},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"users",{get:function(){return fn([],jn(this.rootStore.userStore.users.values()),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"teamList",{get:function(){var n=fn([],jn(this.rootStore.teamStore.teams.values()),!1);return n.filter(function(c){return c.isValidTeam}).sort(function(c,d){return d.createTime-c.createTime})},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"applyMsgs",{get:function(){return fn([],jn(this.rootStore.sysMsgStore.friendApplyMsg.values()),!1)},enumerable:!1,configurable:!0}),s}(),i7=function(){function s(n,c){this.rootStore=n,this.nim=c,vn(this)}return s.prototype.uploadFileActive=function(n){return $e(this,void 0,void 0,function(){var c,d,f,m;return Ke(this,function(y){switch(y.label){case 0:if(Vp.log("uploadFileActive",n),!n)throw c="upload avatar error, no file or filepath",Vp.warn(c),new Error(c);d="",y.label=1;case 1:return y.trys.push([1,3,,4]),f=this.nim.V2NIMStorageService.createUploadFileTask({fileObj:n}),[4,this.nim.V2NIMStorageService.uploadFile(f,function(){})];case 2:return d=y.sent(),[3,4];case 3:throw m=y.sent(),Vp.warn("upload avatar error ",m),m;case 4:return[2,d]}})})},s}(),s7="10.8.30",o7={version:s7},a7=function(){function s(n,c){this.rootStore=n,this.nim=c,this.conversations=new Map,this.totalUnreadCount=0,this.logger=null,vn(this),this._onSyncStarted=this._onSyncStarted.bind(this),this._onSyncFinished=this._onSyncFinished.bind(this),this._onSyncFailed=this._onSyncFailed.bind(this),this._onConversationCreated=this._onConversationCreated.bind(this),this._onConversationDeleted=this._onConversationDeleted.bind(this),this._onConversationChanged=this._onConversationChanged.bind(this),this._onTotalUnreadCountChanged=this._onTotalUnreadCountChanged.bind(this),this.logger=n.logger,c.V2NIMLocalConversationService.on("onSyncStarted",this._onSyncStarted),c.V2NIMLocalConversationService.on("onSyncFinished",this._onSyncFinished),c.V2NIMLocalConversationService.on("onSyncFailed",this._onSyncFailed),c.V2NIMLocalConversationService.on("onConversationCreated",this._onConversationCreated),c.V2NIMLocalConversationService.on("onConversationDeleted",this._onConversationDeleted),c.V2NIMLocalConversationService.on("onConversationChanged",this._onConversationChanged),c.V2NIMLocalConversationService.on("onTotalUnreadCountChanged",this._onTotalUnreadCountChanged)}return s.prototype.resetState=function(){var n;(n=this.logger)===null||n===void 0||n.log("LocalConversationStore Conversation resetState"),this.conversations.clear(),this.totalUnreadCount=0},s.prototype.destroy=function(){this.resetState(),this.nim.V2NIMLocalConversationService.off("onSyncStarted",this._onSyncStarted),this.nim.V2NIMLocalConversationService.off("onSyncFinished",this._onSyncFinished),this.nim.V2NIMLocalConversationService.off("onSyncFailed",this._onSyncFailed),this.nim.V2NIMLocalConversationService.off("onConversationCreated",this._onConversationCreated),this.nim.V2NIMLocalConversationService.off("onConversationDeleted",this._onConversationDeleted),this.nim.V2NIMLocalConversationService.off("onConversationChanged",this._onConversationChanged),this.nim.V2NIMLocalConversationService.off("onTotalUnreadCountChanged",this._onTotalUnreadCountChanged)},s.prototype.addConversation=function(n){var c=this;n.filter(function(d){return!!d.conversationId}).filter(function(d){return[1,2].includes(d.type)}).forEach(function(d){return $e(c,void 0,void 0,function(){var f;return Ke(this,function(m){return f=this.conversations.get(d.conversationId),this.conversations.set(d.conversationId,Be(Be({},f),d)),[2]})})})},s.prototype.updateConversation=function(n){var c=this;n.filter(function(d){return!!d.conversationId}).filter(function(d){return[1,2].includes(d.type)}).forEach(function(d){var f=c.conversations.get(d.conversationId);c.conversations.set(d.conversationId,Be(Be({},f),d))})},s.prototype.removeConversation=function(n){var c=this;n.forEach(function(d){c.conversations.delete(d),c.rootStore.uiStore.selectedConversation===d&&c.rootStore.uiStore.unselectConversation()})},s.prototype.resetConversation=function(n){var c,d,f,m;return $e(this,void 0,void 0,function(){var y,M;return Ke(this,function(S){switch(S.label){case 0:if((c=this.logger)===null||c===void 0||c.log("LocalConversationStore resetConversation",n),y=this.conversations.get(n),!y)return(d=this.logger)===null||d===void 0||d.warn("LocalConversationStore resetConversation: conversation is not found.",n),[2];S.label=1;case 1:return S.trys.push([1,4,,5]),y.unreadCount?(this._resetMemoryConversationUnreadCount(y),[4,this.nim.V2NIMLocalConversationService.clearUnreadCountByIds([y.conversationId])]):[3,3];case 2:S.sent(),this._resetMemoryConversationUnreadCount(y),S.label=3;case 3:return(f=this.logger)===null||f===void 0||f.log("LocalConversationStore resetConversation success"),[3,5];case 4:throw M=S.sent(),(m=this.logger)===null||m===void 0||m.error("LocalConversationStore resetConversation failed: ",M),M;case 5:return[2]}})})},s.prototype.insertConversationActive=function(n,c,d){var f,m,y;return d===void 0&&(d=!0),$e(this,void 0,void 0,function(){var M,S,E;return Ke(this,function(b){switch(b.label){case 0:if(b.trys.push([0,5,,6]),(f=this.logger)===null||f===void 0||f.log("LocalConversationStore insertConversationActive",{conversationType:n,receiverId:c,isSelected:d}),M="",n===1)M=this.nim.V2NIMConversationIdUtil.p2pConversationId(c);else if(n===2)M=this.nim.V2NIMConversationIdUtil.teamConversationId(c);else throw new Error("Unsupported conversation type");return this.conversations.has(M)?[3,2]:[4,this.nim.V2NIMLocalConversationService.createConversation(M)];case 1:S=b.sent(),this.addConversation([S]),b.label=2;case 2:return d?[4,this.rootStore.uiStore.selectConversation(M)]:[3,4];case 3:b.sent(),b.label=4;case 4:return(m=this.logger)===null||m===void 0||m.log("LocalConversationStore insertConversationActive success",{conversationType:n,receiverId:c,isSelected:d}),[3,6];case 5:throw E=b.sent(),(y=this.logger)===null||y===void 0||y.error("LocalConversationStore insertConversationActive failed: ",{conversationType:n,receiverId:c,isSelected:d},E),E;case 6:return[2]}})})},s.prototype.deleteConversationActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m;return Ke(this,function(y){switch(y.label){case 0:y.trys.push([0,6,,7]),(c=this.logger)===null||c===void 0||c.log("LocalConversationStore deleteConversationActive",n),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.stickTopConversationActive(n,!1)];case 2:return y.sent(),[3,4];case 3:return y.sent(),[3,4];case 4:return this.removeConversation([n]),[4,this.nim.V2NIMLocalConversationService.deleteConversation(n,!1)];case 5:return y.sent(),(d=this.logger)===null||d===void 0||d.log("LocalConversationStore deleteConversationActive success"),[3,7];case 6:return m=y.sent(),(f=this.logger)===null||f===void 0||f.warn("LocalConversationStore deleteConversationActive failed but continue: ",m),[3,7];case 7:return[2]}})})},s.prototype.stickTopConversationActive=function(n,c){var d,f,m;return $e(this,void 0,void 0,function(){var y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(d=this.logger)===null||d===void 0||d.log("LocalConversationStore stickTopConversationActive",n,c),[4,this.nim.V2NIMLocalConversationService.stickTopConversation(n,c)];case 1:return M.sent(),(f=this.logger)===null||f===void 0||f.log("LocalConversationStore stickTopConversationActive success"),[3,3];case 2:throw y=M.sent(),(m=this.logger)===null||m===void 0||m.error("LocalConversationStore stickTopConversationActive failed: ",y),y;case 3:return[2]}})})},s.prototype.getConversationListActive=function(n,c){var d,f,m;return $e(this,void 0,void 0,function(){var y,M;return Ke(this,function(S){switch(S.label){case 0:return S.trys.push([0,3,,4]),(d=this.logger)===null||d===void 0||d.log("LocalConversationStore getConversationListActive",n,c),[4,this.nim.V2NIMLocalConversationService.getConversationList(n,c)];case 1:return y=S.sent(),this.addConversation(y.conversationList),[4,this.getP2PMessageReceipt(y.conversationList.filter(function(E){return E.type===1}).map(function(E){return E.conversationId}))];case 2:return S.sent(),(f=this.logger)===null||f===void 0||f.log("LocalConversationStore getConversationListActive success",n,c,y),[2,y];case 3:throw M=S.sent(),(m=this.logger)===null||m===void 0||m.error("LocalConversationStore getConversationListActive failed: ",M,n,c),M;case 4:return[2]}})})},s.prototype.getP2PMessageReceipt=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y,M,S=this;return Ke(this,function(E){switch(E.label){case 0:return E.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("LocalConversationStore getP2PMessageReceipt",n),[4,Promise.all(n.map(function(b){return S.nim.V2NIMMessageService.getP2PMessageReceipt(b)}))];case 1:return m=E.sent(),y=m.map(function(b){var R=S.conversations.get(b.conversationId);if(R)return Be(Be({},R),{msgReceiptTime:b.timestamp})}).filter(function(b){return!!b}),this.updateConversation(y),(d=this.logger)===null||d===void 0||d.log("LocalConversationStore getP2PMessageReceipt success",n,m),[2,m];case 2:throw M=E.sent(),(f=this.logger)===null||f===void 0||f.error("LocalConversationStore getP2PMessageReceipt failed: ",M,n),M;case 3:return[2]}})})},s.prototype._resetMemoryConversationUnreadCount=function(n){var c=this.conversations.get(n.conversationId);c&&this.updateConversation([Be(Be({},c),{unreadCount:0})])},s.prototype.getConversationReadTimeActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("LocalConversationStore getConversationReadTimeActive",n),[4,this.nim.V2NIMLocalConversationService.getConversationReadTime(n)];case 1:return m=M.sent(),(d=this.logger)===null||d===void 0||d.log("LocalConversationStore getConversationReadTimeActive success",n,m),[2,m];case 2:throw y=M.sent(),(f=this.logger)===null||f===void 0||f.error("LocalConversationStore getConversationReadTimeActive failed: ",y,n),y;case 3:return[2]}})})},s.prototype.markConversationReadActive=function(n){var c,d,f;return $e(this,void 0,void 0,function(){var m,y;return Ke(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),(c=this.logger)===null||c===void 0||c.log("LocalConversationStore markConversationReadActive",n),[4,this.nim.V2NIMLocalConversationService.markConversationRead(n)];case 1:return m=M.sent(),(d=this.logger)===null||d===void 0||d.log("LocalConversationStore markConversationReadActive success",n,m),[2,m];case 2:throw y=M.sent(),(f=this.logger)===null||f===void 0||f.error("LocalConversationStore markConversationReadActive failed: ",y,n),y;case 3:return[2]}})})},s.prototype.handleConversationWithAit=function(n){var c=this;n.map(function(d){return $e(c,void 0,void 0,function(){var f,m,y,M,S,E,b;return Ke(this,function(R){switch(R.label){case 0:return d.conversationType===2||d.conversationType===3?d!=null&&d.serverExtension?(f=this.hasAitMsg([d.serverExtension]),[4,this.getConversationReadTimeActive(d.conversationId)]):[3,2]:[3,2];case 1:m=R.sent(),y=d.conversationId==this.rootStore.uiStore.selectedConversation,M=d.senderId===((b=this.rootStore.userStore.myUserInfo)===null||b===void 0?void 0:b.accountId),d.createTime>m&&f&&!y&&!M&&(S=this.conversations.get(d.conversationId),S?(E=S.aitMsgs||[],E.length===0?this.updateConversation([Be(Be({},S),{aitMsgs:[d.messageClientId]})]):this.updateConversation([Be(Be({},S),{aitMsgs:fn(fn([],jn(E),!1),[d.messageClientId],!1)})])):this.addConversation([{conversationId:d.conversationId,type:d.conversationType,aitMsgs:[d.messageClientId]}])),R.label=2;case 2:return[2]}})})})},s.prototype.resetConversationAit=function(n){var c=this.conversations.get(n);((c==null?void 0:c.type)===2||(c==null?void 0:c.type)===3)&&this.updateConversation([Be(Be({},c),{aitMsgs:[]})])},s.prototype.hasAitMsg=function(n){var c=this,d=!1;return n!=null&&n.length&&(n==null||n.forEach(function(f){var m,y;try{var M=JSON.parse(f||"{}"),S=M.yxAitMsg,E=c.rootStore.userStore.myUserInfo.accountId;S&&((m=Object.keys(S))===null||m===void 0||m.forEach(function(b){(b===E||b===GM)&&(d=!0)}))}catch{(y=c.logger)===null||y===void 0||y.error("LocalConversationStore parse serverExtension failed: ",f)}})),d},s.prototype._onSyncStarted=function(){var n;(n=this.logger)===null||n===void 0||n.log("LocalConversationStore _onSyncStarted")},s.prototype._onSyncFinished=function(){var n,c;return $e(this,void 0,void 0,function(){return Ke(this,function(d){return(n=this.logger)===null||n===void 0||n.log("LocalConversationStore _onSyncFinished"),(c=this.rootStore.localConversationStore)===null||c===void 0||c.getConversationListActive(0,this.rootStore.localOptions.conversationLimit||100),[2]})})},s.prototype._onSyncFailed=function(n){var c;(c=this.logger)===null||c===void 0||c.log("LocalConversationStore _onSyncFailed",n)},s.prototype._onConversationCreated=function(n){var c=this,d;if((d=this.logger)===null||d===void 0||d.log("LocalConversationStore _onConversationCreated",n),n.type===2)this.nim.V2NIMLocalConversationService.getConversation(n.conversationId).then(function(m){c.addConversation([m]),m.lastMessage&&c.handleConversationWithAit([Be(Be({},m.lastMessage),m.lastMessage.messageRefer)])});else if(this.addConversation([n]),n.type===1){var f=n.conversationId;this.nim.V2NIMMessageService.getP2PMessageReceipt(f).then(function(m){var y=c.conversations.get(f);y&&c.updateConversation([Be(Be({},y),{msgReceiptTime:m.timestamp})])})}},s.prototype._onConversationDeleted=function(n){var c;(c=this.logger)===null||c===void 0||c.log("LocalConversationStore _onConversationDeleted",n),this.removeConversation(n)},s.prototype._onConversationChanged=function(n){var c;return $e(this,void 0,void 0,function(){var d=this;return Ke(this,function(f){return(c=this.logger)===null||c===void 0||c.log("LocalConversationStore _onConversationChanged",n),this.addConversation(n),n.forEach(function(m){return $e(d,void 0,void 0,function(){var y,M,S,E,b,R;return Ke(this,function(x){switch(x.label){case 0:return y=(S=m.lastMessage)===null||S===void 0?void 0:S.attachment,M=y==null?void 0:y.type,((E=m.lastMessage)===null||E===void 0?void 0:E.messageType)===5&&(M===1&&(!((b=y==null?void 0:y.targetIds)===null||b===void 0)&&b.includes(this.rootStore.userStore.myUserInfo.accountId))||M===2&&((R=m.lastMessage)===null||R===void 0?void 0:R.messageRefer.senderId)===this.rootStore.userStore.myUserInfo.accountId||M===4)?[4,this.deleteConversationActive(m.conversationId)]:[3,2];case 1:return x.sent(),[3,4];case 2:return this.rootStore.uiStore.selectedConversation!==m.conversationId?[3,4]:[4,this.resetConversation(m.conversationId)];case 3:x.sent(),x.label=4;case 4:return m.type===2&&m.unreadCount==0&&this.resetConversationAit(m.conversationId),[2]}})})}),[2]})})},s.prototype._onTotalUnreadCountChanged=function(n){var c;(c=this.logger)===null||c===void 0||c.log("LocalConversationStore _onTotalUnreadCountChanged",n),this.totalUnreadCount=n},s}(),c7=function(){function s(n,c,d){d===void 0&&(d="Web");var f=this,m,y,M,S,E;this.localOptions={addFriendNeedVerify:!0,teamAgreeMode:1,teamJoinMode:0,teamInviteMode:0,teamUpdateTeamMode:0,teamUpdateExtMode:1,leaveOnTransfer:!1,needMention:!0,p2pMsgReceiptVisible:!1,teamMsgReceiptVisible:!1,loginStateVisible:!1,allowTransferTeamOwner:!1,teamManagerVisible:!1,aiVisible:!0,teamManagerLimit:10,sendMsgBefore:function(R){return $e(f,void 0,void 0,function(){return Ke(this,function(x){return[2,R]})})},aiUserAgentProvider:{},conversationLimit:100,debug:"debug",aiStream:!0,iconfontUrl:[]},this.sdkOptions={},this.conversationStore=null,this.localConversationStore=null,this.logger=null,vn(this),this.nim=n,this.localOptions=Be(Be({},this.localOptions),c),this.logger=((m=this.localOptions)===null||m===void 0?void 0:m.debug)=="off"?null:pN({level:(y=this.localOptions)===null||y===void 0?void 0:y.debug,appName:fN.name,needStringify:!1}),(M=this.logger)===null||M===void 0||M.log("store init",{localOptions:this.localOptions}),this.sdkOptions=Be({},(S=this.nim)===null||S===void 0?void 0:S.getOptions()),this.connectStore=new U8(this,n,this.localOptions),this.friendStore=new F8(this,n),this.msgStore=new J8(this,n,this.localOptions),this.relationStore=new Q8(this,n),!((E=this.sdkOptions)===null||E===void 0)&&E.enableV2CloudConversation?this.conversationStore=new z8(this,n):this.localConversationStore=new a7(this,n),this.teamStore=new X8(this,n,this.localOptions),this.teamMemberStore=new Z8(this,n),this.sysMsgStore=new e7(this,n),this.userStore=new t7(this,n),this.aiUserStore=new r7(this,n,this.localOptions),this.uiStore=new n7(this),this.storageStore=new i7(this,n);var b=["ContactKit","ConversationKit","ChatKit","SearchKit"];b.forEach(function(R){var x=new N8({appKey:f.nim.options.appkey,version:"10.0.0",component:R,imVersion:o7.version,platform:d});x.track("init","")})}return s.prototype.resetState=function(){var n,c,d,f;(n=this.logger)===null||n===void 0||n.log("store resetState"),this.friendStore.resetState(),this.msgStore.resetState(),this.relationStore.resetState(),!((c=this.sdkOptions)===null||c===void 0)&&c.enableV2CloudConversation?(d=this.conversationStore)===null||d===void 0||d.resetState():(f=this.localConversationStore)===null||f===void 0||f.resetState(),this.teamStore.resetState(),this.teamMemberStore.resetState(),this.sysMsgStore.resetState(),this.userStore.resetState(),this.aiUserStore.resetState(),this.uiStore.resetState()},s.prototype.destroy=function(){var n,c,d;Vp.log("store destroyed"),this.connectStore.destroy(),this.friendStore.destroy(),this.msgStore.destroy(),this.relationStore.destroy(),!((n=this.sdkOptions)===null||n===void 0)&&n.enableV2CloudConversation?(c=this.conversationStore)===null||c===void 0||c.destroy():(d=this.localConversationStore)===null||d===void 0||d.destroy(),this.teamStore.destroy(),this.teamMemberStore.destroy(),this.sysMsgStore.destroy(),this.userStore.destroy(),this.aiUserStore.destroy(),this.uiStore.destroy()},s.getInstance=function(n,c,d){return d===void 0&&(d="Web"),this.ins||(this.ins=new s(n,c,d)),this.ins},s}(),vu={exports:{}},l7=vu.exports,mA;function u7(){return mA||(mA=1,function(s,n){(function(c,d){d(n)})(l7,function(c){var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof fu<"u"?fu:typeof self<"u"?self:{};function f(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function m(a){var p={exports:{}};return a(p,p.exports),p.exports}var y,M,S=function(a){return a&&a.Math==Math&&a},E=S(typeof globalThis=="object"&&globalThis)||S(typeof window=="object"&&window)||S(typeof self=="object"&&self)||S(typeof d=="object"&&d)||function(){return this}()||Function("return this")(),b=function(a){try{return!!a()}catch{return!0}},R=!b(function(){var a=(function(){}).bind();return typeof a!="function"||a.hasOwnProperty("prototype")}),x=Function.prototype,L=x.apply,q=x.call,D=typeof Reflect=="object"&&Reflect.apply||(R?q.bind(L):function(){return q.apply(L,arguments)}),G=Function.prototype,J=G.bind,ne=G.call,z=R&&J.bind(ne,ne),$=R?function(a){return a&&z(a)}:function(a){return a&&function(){return ne.apply(a,arguments)}},Z=function(a){return typeof a=="function"},le=!b(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),fe=Function.prototype.call,oe=R?fe.bind(fe):function(){return fe.apply(fe,arguments)},B={}.propertyIsEnumerable,me=Object.getOwnPropertyDescriptor,Ee={f:me&&!B.call({1:2},1)?function(p){var l=me(this,p);return!!l&&l.enumerable}:B},ve=function(a,p){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:p}},qe=$({}.toString),Qe=$("".slice),ut=function(a){return Qe(qe(a),8,-1)},he=Object,Fe=$("".split),Xe=b(function(){return!he("z").propertyIsEnumerable(0)})?function(a){return ut(a)=="String"?Fe(a,""):he(a)}:he,yt=function(a){return a==null},Wt=TypeError,jt=function(a){if(yt(a))throw Wt("Can't call method on "+a);return a},Tt=function(a){return Xe(jt(a))},Le=typeof document=="object"&&document.all,Ce=Le===void 0&&Le!==void 0?function(a){return typeof a=="object"?a!==null:Z(a)||a===Le}:function(a){return typeof a=="object"?a!==null:Z(a)},we={},St=function(a){return Z(a)?a:void 0},ue=function(a,p){return arguments.length<2?St(we[a])||St(E[a]):we[a]&&we[a][p]||E[a]&&E[a][p]},ge=$({}.isPrototypeOf),be=ue("navigator","userAgent")||"",_e=E.process,ct=E.Deno,X=_e&&_e.versions||ct&&ct.version,K=X&&X.v8;K&&(M=(y=K.split("."))[0]>0&&y[0]<4?1:+(y[0]+y[1])),!M&&be&&(!(y=be.match(/Edge\/(\d+)/))||y[1]>=74)&&(y=be.match(/Chrome\/(\d+)/))&&(M=+y[1]);var de=M,Ae=!!Object.getOwnPropertySymbols&&!b(function(){var a=Symbol();return!String(a)||!(Object(a)instanceof Symbol)||!Symbol.sham&&de&&de<41}),ke=Ae&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ne=Object,De=ke?function(a){return typeof a=="symbol"}:function(a){var p=ue("Symbol");return Z(p)&&ge(p.prototype,Ne(a))},Ue=String,Ve=function(a){try{return Ue(a)}catch{return"Object"}},Ye=TypeError,Ge=function(a){if(Z(a))return a;throw Ye(Ve(a)+" is not a function")},ot=function(a,p){var l=a[p];return yt(l)?void 0:Ge(l)},It=TypeError,kt=Object.defineProperty,Jt="__core-js_shared__",nr=E[Jt]||function(a,p){try{kt(E,a,{value:p,configurable:!0,writable:!0})}catch{E[a]=p}return p}(Jt,{}),Xt=m(function(a){(a.exports=function(p,l){return nr[p]||(nr[p]=l!==void 0?l:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})}),kn=Object,Er=function(a){return kn(jt(a))},ui=$({}.hasOwnProperty),Ct=Object.hasOwn||function(p,l){return ui(Er(p),l)},Wo=0,Xu=Math.random(),On=$(1 .toString),_n=function(a){return"Symbol("+(a===void 0?"":a)+")_"+On(++Wo+Xu,36)},Xs=Xt("wks"),Jo=E.Symbol,jM=Jo&&Jo.for,gN=ke?Jo:Jo&&Jo.withoutSetter||_n,qr=function(a){if(!Ct(Xs,a)||!Ae&&typeof Xs[a]!="string"){var p="Symbol."+a;Ae&&Ct(Jo,a)?Xs[a]=Jo[a]:Xs[a]=ke&&jM?jM(p):gN(p)}return Xs[a]},vN=TypeError,yN=qr("toPrimitive"),_N=function(a,p){if(!Ce(a)||De(a))return a;var l,t=ot(a,yN);if(t){if(l=oe(t,a,p),!Ce(l)||De(l))return l;throw vN("Can't convert object to primitive value")}return function(e,r){var i,o;if(Z(i=e.toString)&&!Ce(o=oe(i,e))||Z(i=e.valueOf)&&!Ce(o=oe(i,e)))return o;throw It("Can't convert object to primitive value")}(a)},Qo=function(a){var p=_N(a,"string");return De(p)?p:p+""},bh=E.document,MN=Ce(bh)&&Ce(bh.createElement),Zu=function(a){return MN?bh.createElement(a):{}},HM=!le&&!b(function(){return Object.defineProperty(Zu("div"),"a",{get:function(){return 7}}).a!=7}),$M=Object.getOwnPropertyDescriptor,nl={f:le?$M:function(p,l){if(p=Tt(p),l=Qo(l),HM)try{return $M(p,l)}catch{}if(Ct(p,l))return ve(!oe(Ee.f,p,l),p[l])}},TN=/#|\.prototype\./,il=function(a,p){var l=SN[IN(a)];return l==CN||l!=EN&&(Z(p)?b(p):!!p)},IN=il.normalize=function(a){return String(a).replace(TN,".").toLowerCase()},SN=il.data={},EN=il.NATIVE="N",CN=il.POLYFILL="P",KM=il,bN=$($.bind),Yr=function(a,p){return Ge(a),p===void 0?a:R?bN(a,p):function(){return a.apply(p,arguments)}},YM=le&&b(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),AN=String,RN=TypeError,Pt=function(a){if(Ce(a))return a;throw RN(AN(a)+" is not an object")},NN=TypeError,Ah=Object.defineProperty,kN=Object.getOwnPropertyDescriptor,ON="enumerable",wN="configurable",xN="writable",$n={f:le?YM?function(p,l,t){if(Pt(p),l=Qo(l),Pt(t),typeof p=="function"&&l==="prototype"&&"value"in t&&xN in t&&!t.writable){var e=kN(p,l);e&&e.writable&&(p[l]=t.value,t={configurable:wN in t?t.configurable:e.configurable,enumerable:ON in t?t.enumerable:e.enumerable,writable:!1})}return Ah(p,l,t)}:Ah:function(p,l,t){if(Pt(p),l=Qo(l),Pt(t),HM)try{return Ah(p,l,t)}catch{}if("get"in t||"set"in t)throw NN("Accessors not supported");return"value"in t&&(p[l]=t.value),p}},Mn=le?function(a,p,l){return $n.f(a,p,ve(1,l))}:function(a,p,l){return a[p]=l,a},PN=nl.f,LN=function(a){var p=function(l,t,e){if(this instanceof p){switch(arguments.length){case 0:return new a;case 1:return new a(l);case 2:return new a(l,t)}return new a(l,t,e)}return D(a,this,arguments)};return p.prototype=a.prototype,p},je=function(a,p){var l,t,e,r,i,o,u,h,g=a.target,v=a.global,_=a.stat,I=a.proto,C=v?E:_?E[g]:(E[g]||{}).prototype,A=v?we:we[g]||Mn(we,g,{})[g],N=A.prototype;for(e in p)l=!KM(v?e:g+(_?".":"#")+e,a.forced)&&C&&Ct(C,e),i=A[e],l&&(o=a.dontCallGetSet?(h=PN(C,e))&&h.value:C[e]),r=l&&o?o:p[e],l&&typeof i==typeof r||(u=a.bind&&l?Yr(r,E):a.wrap&&l?LN(r):I&&Z(r)?$(r):r,(a.sham||r&&r.sham||i&&i.sham)&&Mn(u,"sham",!0),Mn(A,e,u),I&&(Ct(we,t=g+"Prototype")||Mn(we,t,{}),Mn(we[t],e,r),a.real&&N&&!N[e]&&Mn(N,e,r)))},WM=$n.f;je({target:"Object",stat:!0,forced:Object.defineProperty!==WM,sham:!le},{defineProperty:WM});var ed,VN=m(function(a){var p=we.Object,l=a.exports=function(e,r,i){return p.defineProperty(e,r,i)};p.defineProperty.sham&&(l.sham=!0)}),Zs=VN,Ai=f(m(function(a){function p(l,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Zs(l,r.key,r)}}a.exports=function(t,e,r){return e&&p(t.prototype,e),r&&p(t,r),Zs(t,"prototype",{writable:!1}),t},a.exports.__esModule=!0,a.exports.default=a.exports})),Ot=f(m(function(a){a.exports=function(l){if(l===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l},a.exports.__esModule=!0,a.exports.default=a.exports})),DN=Math.ceil,UN=Math.floor,FN=Math.trunc||function(p){var l=+p;return(l>0?UN:DN)(l)},sl=function(a){var p=+a;return p!=p||p===0?0:FN(p)},BN=Math.max,qN=Math.min,zo=function(a,p){var l=sl(a);return l<0?BN(l+p,0):qN(l,p)},GN=Math.min,JM=function(a){return a>0?GN(sl(a),9007199254740991):0},di=function(a){return JM(a.length)},QM=function(a){return function(p,l,t){var e,r=Tt(p),i=di(r),o=zo(t,i);if(a&&l!=l){for(;i>o;)if((e=r[o++])!=e)return!0}else for(;i>o;o++)if((a||o in r)&&r[o]===l)return a||o||0;return!a&&-1}},Rh={includes:QM(!0),indexOf:QM(!1)},Ha={},jN=Rh.indexOf,zM=$([].push),XM=function(a,p){var l,t=Tt(a),e=0,r=[];for(l in t)!Ct(Ha,l)&&Ct(t,l)&&zM(r,l);for(;p.length>e;)Ct(t,l=p[e++])&&(~jN(r,l)||zM(r,l));return r},td=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ds=Object.keys||function(p){return XM(p,td)},HN=le&&!YM?Object.defineProperties:function(p,l){Pt(p);for(var t,e=Tt(l),r=ds(l),i=r.length,o=0;i>o;)$n.f(p,t=r[o++],e[t]);return p},ZM={f:HN},Nh=ue("document","documentElement"),eT=Xt("keys"),rd=function(a){return eT[a]||(eT[a]=_n(a))},tT=rd("IE_PROTO"),kh=function(){},rT=function(a){return"<script>"+a+"<\/script>"},nT=function(a){a.write(rT("")),a.close();var p=a.parentWindow.Object;return a=null,p},nd=function(){try{ed=new ActiveXObject("htmlfile")}catch{}var a,p;nd=typeof document<"u"?document.domain&&ed?nT(ed):((p=Zu("iframe")).style.display="none",Nh.appendChild(p),p.src="javascript:",(a=p.contentWindow.document).open(),a.write(rT("document.F=Object")),a.close(),a.F):nT(ed);for(var l=td.length;l--;)delete nd.prototype[td[l]];return nd()};Ha[tT]=!0;var pi=Object.create||function(p,l){var t;return p!==null?(kh.prototype=Pt(p),t=new kh,kh.prototype=null,t[tT]=p):t=nd(),l===void 0?t:ZM.f(t,l)};je({target:"Object",stat:!0,sham:!le},{create:pi});var $N=we.Object,Ri=function(p,l){return $N.create(p,l)},KN=String,YN=TypeError,ol=Object.setPrototypeOf||("__proto__"in{}?function(){var a,p=!1,l={};try{(a=$(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(l,[]),p=l instanceof Array}catch{}return function(e,r){return Pt(e),function(i){if(typeof i=="object"||Z(i))return i;throw YN("Can't set "+KN(i)+" as a prototype")}(r),p?a(e,r):e.__proto__=r,e}}():void 0);je({target:"Object",stat:!0},{setPrototypeOf:ol});var ps=we.Object.setPrototypeOf,eo=$([].slice),iT=Function,WN=$([].concat),JN=$([].join),Oh={},QN=function(a,p,l){if(!Ct(Oh,p)){for(var t=[],e=0;e<p;e++)t[e]="a["+e+"]";Oh[p]=iT("C,a","return new C("+JN(t,",")+")")}return Oh[p](a,l)},wh=R?iT.bind:function(p){var l=Ge(this),t=l.prototype,e=eo(arguments,1),r=function(){var o=WN(e,eo(arguments));return this instanceof r?QN(l,o.length,o):l.apply(p,o)};return Ce(t)&&(r.prototype=t),r};je({target:"Function",proto:!0,forced:Function.bind!==wh},{bind:wh});var Gr=function(a){return we[a+"Prototype"]},zN=Gr("Function").bind,xh=Function.prototype,et=function(a){var p=a.bind;return a===xh||ge(xh,a)&&p===xh.bind?zN:p},Ph=m(function(a){function p(l,t){var e;return a.exports=p=ps?et(e=ps).call(e):function(i,o){return i.__proto__=o,i},a.exports.__esModule=!0,a.exports.default=a.exports,p(l,t)}a.exports=p,a.exports.__esModule=!0,a.exports.default=a.exports}),bt=f(m(function(a){a.exports=function(l,t){l.prototype=Ri(t.prototype),l.prototype.constructor=l,Ph(l,t)},a.exports.__esModule=!0,a.exports.default=a.exports}));je({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991});var sT=9007199254740991,al={f:Object.getOwnPropertySymbols},$a=Object.assign,oT=Object.defineProperty,XN=$([].concat),aT=!$a||b(function(){if(le&&$a({b:1},$a(oT({},"a",{enumerable:!0,get:function(){oT(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var a={},p={},l=Symbol(),t="abcdefghijklmnopqrst";return a[l]=7,t.split("").forEach(function(e){p[e]=e}),$a({},a)[l]!=7||ds($a({},p)).join("")!=t})?function(p,l){for(var t=Er(p),e=arguments.length,r=1,i=al.f,o=Ee.f;e>r;)for(var u,h=Xe(arguments[r++]),g=i?XN(ds(h),i(h)):ds(h),v=g.length,_=0;v>_;)u=g[_++],le&&!oe(o,h,u)||(t[u]=h[u]);return t}:$a;je({target:"Object",stat:!0,forced:Object.assign!==aT},{assign:aT});var O=we.Object.assign,ZN=b(function(){ds(1)});je({target:"Object",stat:!0,forced:ZN},{keys:function(p){return ds(Er(p))}});var id,cl,sd,pt=we.Object.keys,hs={},cT=E.WeakMap,ek=Z(cT)&&/native code/.test(String(cT)),lT="Object already initialized",Lh=E.TypeError,tk=E.WeakMap;if(ek||nr.state){var Xo=nr.state||(nr.state=new tk),rk=$(Xo.get),uT=$(Xo.has),nk=$(Xo.set);id=function(a,p){if(uT(Xo,a))throw Lh(lT);return p.facade=a,nk(Xo,a,p),p},cl=function(a){return rk(Xo,a)||{}},sd=function(a){return uT(Xo,a)}}else{var Ka=rd("state");Ha[Ka]=!0,id=function(a,p){if(Ct(a,Ka))throw Lh(lT);return p.facade=a,Mn(a,Ka,p),p},cl=function(a){return Ct(a,Ka)?a[Ka]:{}},sd=function(a){return Ct(a,Ka)}}var to,dT,pT,hi={set:id,get:cl,has:sd,enforce:function(a){return sd(a)?cl(a):id(a,{})},getterFor:function(a){return function(p){var l;if(!Ce(p)||(l=cl(p)).type!==a)throw Lh("Incompatible receiver, "+a+" required");return l}}},hT=Function.prototype,ik=le&&Object.getOwnPropertyDescriptor,fT=Ct(hT,"name"),mT={PROPER:fT&&(function(){}).name==="something",CONFIGURABLE:fT&&(!le||le&&ik(hT,"name").configurable)},gT=!b(function(){function a(){}return a.prototype.constructor=null,Object.getPrototypeOf(new a)!==a.prototype}),vT=rd("IE_PROTO"),Vh=Object,sk=Vh.prototype,Ya=gT?Vh.getPrototypeOf:function(a){var p=Er(a);if(Ct(p,vT))return p[vT];var l=p.constructor;return Z(l)&&p instanceof l?l.prototype:p instanceof Vh?sk:null},ro=function(a,p,l,t){return t&&t.enumerable?a[p]=l:Mn(a,p,l),a},Dh=qr("iterator"),yT=!1;[].keys&&("next"in(pT=[].keys())?(dT=Ya(Ya(pT)))!==Object.prototype&&(to=dT):yT=!0);var ok=!Ce(to)||b(function(){var a={};return to[Dh].call(a)!==a});to=ok?{}:pi(to),Z(to[Dh])||ro(to,Dh,function(){return this});var _T={IteratorPrototype:to,BUGGY_SAFARI_ITERATORS:yT},MT={};MT[qr("toStringTag")]="z";var Uh=String(MT)==="[object z]",ak=qr("toStringTag"),ck=Object,lk=ut(function(){return arguments}())=="Arguments",no=Uh?ut:function(a){var p,l,t;return a===void 0?"Undefined":a===null?"Null":typeof(l=function(e,r){try{return e[r]}catch{}}(p=ck(a),ak))=="string"?l:lk?ut(p):(t=ut(p))=="Object"&&Z(p.callee)?"Arguments":t},uk=Uh?{}.toString:function(){return"[object "+no(this)+"]"},dk=$n.f,TT=qr("toStringTag"),Zo=function(a,p,l,t){if(a){var e=l?a:a.prototype;Ct(e,TT)||dk(e,TT,{configurable:!0,value:p}),t&&!Uh&&Mn(e,"toString",uk)}},pk=_T.IteratorPrototype,hk=function(){return this},fk=mT.PROPER,od=_T.BUGGY_SAFARI_ITERATORS,Fh=qr("iterator"),IT="keys",ad="values",ST="entries",mk=function(){return this},Bh=function(a,p,l,t,e,r,i){(function(F,j,W,U){var ie=j+" Iterator";F.prototype=pi(pk,{next:ve(1,W)}),Zo(F,ie,!1,!0),hs[ie]=hk})(l,p,t);var o,u,h,g=function(F){if(F===e&&A)return A;if(!od&&F in I)return I[F];switch(F){case IT:return function(){return new l(this,F)};case ad:return function(){return new l(this,F)};case ST:return function(){return new l(this,F)}}return function(){return new l(this)}},v=p+" Iterator",_=!1,I=a.prototype,C=I[Fh]||I["@@iterator"]||e&&I[e],A=!od&&C||g(e),N=p=="Array"&&I.entries||C;if(N&&(o=Ya(N.call(new a)))!==Object.prototype&&o.next&&(Zo(o,v,!0,!0),hs[v]=mk),fk&&e==ad&&C&&C.name!==ad&&(_=!0,A=function(){return oe(C,this)}),e)if(u={values:g(ad),keys:r?A:g(IT),entries:g(ST)},i)for(h in u)(od||_||!(h in I))&&ro(I,h,u[h]);else je({target:p,proto:!0,forced:od||_},u);return i&&I[Fh]!==A&&ro(I,Fh,A,{}),hs[p]=A,u};$n.f;var ET="Array Iterator",gk=hi.set,vk=hi.getterFor(ET);Bh(Array,"Array",function(a,p){gk(this,{type:ET,target:Tt(a),index:0,kind:p})},function(){var a=vk(this),p=a.target,l=a.kind,t=a.index++;return!p||t>=p.length?(a.target=void 0,{value:void 0,done:!0}):l=="keys"?{value:t,done:!1}:l=="values"?{value:p[t],done:!1}:{value:[t,p[t]],done:!1}},"values"),hs.Arguments=hs.Array;var CT=qr("toStringTag");for(var qh in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var bT=E[qh],Gh=bT&&bT.prototype;Gh&&no(Gh)!==CT&&Mn(Gh,CT,qh),hs[qh]=hs.Array}var fs=Array.isArray||function(p){return ut(p)=="Array"},yk=$(Function.toString);Z(nr.inspectSource)||(nr.inspectSource=function(a){return yk(a)});var AT=nr.inspectSource,RT=function(){},_k=[],NT=ue("Reflect","construct"),jh=/^\s*(?:class|function)\b/,Mk=$(jh.exec),Tk=!jh.exec(RT),ll=function(p){if(!Z(p))return!1;try{return NT(RT,_k,p),!0}catch{return!1}},kT=function(p){if(!Z(p))return!1;switch(no(p)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Tk||!!Mk(jh,AT(p))}catch{return!0}};kT.sham=!0;var cd=!NT||b(function(){var a;return ll(ll.call)||!ll(Object)||!ll(function(){a=!0})||a})?kT:ll,Ik=qr("species"),OT=Array,Hh=function(a,p){return new(function(l){var t;return fs(l)&&(t=l.constructor,(cd(t)&&(t===OT||fs(t.prototype))||Ce(t)&&(t=t[Ik])===null)&&(t=void 0)),t===void 0?OT:t}(a))(p===0?0:p)},wT=$([].push),ea=function(a){var p=a==1,l=a==2,t=a==3,e=a==4,r=a==6,i=a==7,o=a==5||r;return function(u,h,g,v){for(var _,I,C=Er(u),A=Xe(C),N=Yr(h,g),F=di(A),j=0,W=v||Hh,U=p?W(u,F):l||i?W(u,0):void 0;F>j;j++)if((o||j in A)&&(I=N(_=A[j],j,C),a))if(p)U[j]=I;else if(I)switch(a){case 3:return!0;case 5:return _;case 6:return j;case 2:wT(U,_)}else switch(a){case 4:return!1;case 7:wT(U,_)}return r?-1:t||e?e:U}},ms={forEach:ea(0),map:ea(1),filter:ea(2),some:ea(3),every:ea(4),find:ea(5),findIndex:ea(6)},ta=function(a,p){var l=[][a];return!!l&&b(function(){l.call(null,p||function(){return 1},1)})},Sk=ms.forEach,xT=ta("forEach")?[].forEach:function(p){return Sk(this,p,arguments.length>1?arguments[1]:void 0)};je({target:"Array",proto:!0,forced:[].forEach!=xT},{forEach:xT});var Ek=Gr("Array").forEach,$h=Array.prototype,Ck={DOMTokenList:!0,NodeList:!0},ae=function(a){var p=a.forEach;return a===$h||ge($h,a)&&p===$h.forEach||Ct(Ck,no(a))?Ek:p},bk=ms.findIndex,Ak="findIndex",PT=!0;Ak in[]&&Array(1).findIndex(function(){PT=!1}),je({target:"Array",proto:!0,forced:PT},{findIndex:function(p){return bk(this,p,arguments.length>1?arguments[1]:void 0)}});var Rk=Gr("Array").findIndex,Kh=Array.prototype,Ni=function(a){var p=a.findIndex;return a===Kh||ge(Kh,a)&&p===Kh.findIndex?Rk:p},Nk=TypeError,kk=Object.getOwnPropertyDescriptor,Ok=le&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(a){return a instanceof TypeError}}()?function(a,p){if(fs(a)&&!kk(a,"length").writable)throw Nk("Cannot set read only .length");return a.length=p}:function(a,p){return a.length=p},wk=TypeError,Yh=function(a){if(a>9007199254740991)throw wk("Maximum allowed index exceeded");return a},ra=function(a,p,l){var t=Qo(p);t in a?$n.f(a,t,ve(0,l)):a[t]=l},xk=TypeError,ld=function(a,p){if(!delete a[p])throw xk("Cannot delete property "+Ve(p)+" of "+Ve(a))},Pk=qr("species"),ul=function(a){return de>=51||!b(function(){var p=[];return(p.constructor={})[Pk]=function(){return{foo:1}},p[a](Boolean).foo!==1})},Lk=ul("splice"),Vk=Math.max,Dk=Math.min;je({target:"Array",proto:!0,forced:!Lk},{splice:function(p,l){var t,e,r,i,o,u,h=Er(this),g=di(h),v=zo(p,g),_=arguments.length;for(_===0?t=e=0:_===1?(t=0,e=g-v):(t=_-2,e=Dk(Vk(sl(l),0),g-v)),Yh(g+t-e),r=Hh(h,e),i=0;i<e;i++)(o=v+i)in h&&ra(r,i,h[o]);if(r.length=e,t<e){for(i=v;i<g-e;i++)u=i+t,(o=i+e)in h?h[u]=h[o]:ld(h,u);for(i=g;i>g-e+t;i--)ld(h,i-1)}else if(t>e)for(i=g-e;i>v;i--)u=i+t-1,(o=i+e-1)in h?h[u]=h[o]:ld(h,u);for(i=0;i<t;i++)h[i+v]=arguments[i+2];return Ok(h,g-e+t),r}});var Uk=Gr("Array").splice,Wh=Array.prototype,wn=function(a){var p=a.splice;return a===Wh||ge(Wh,a)&&p===Wh.splice?Uk:p},io=ue("JSON","stringify"),ud=$(/./.exec),LT=$("".charAt),Fk=$("".charCodeAt),Bk=$("".replace),qk=$(1 .toString),Gk=/[\uD800-\uDFFF]/g,VT=/^[\uD800-\uDBFF]$/,DT=/^[\uDC00-\uDFFF]$/,UT=!Ae||b(function(){var a=ue("Symbol")();return io([a])!="[null]"||io({a})!="{}"||io(Object(a))!="{}"}),FT=b(function(){return io("\uDF06\uD834")!=='"\\udf06\\ud834"'||io("\uDEAD")!=='"\\udead"'}),jk=function(a,p){var l=eo(arguments),t=p;if((Ce(p)||a!==void 0)&&!De(a))return fs(p)||(p=function(e,r){if(Z(t)&&(r=oe(t,this,e,r)),!De(r))return r}),l[1]=p,D(io,null,l)},Hk=function(a,p,l){var t=LT(l,p-1),e=LT(l,p+1);return ud(VT,a)&&!ud(DT,e)||ud(DT,a)&&!ud(VT,t)?"\\u"+qk(Fk(a,0),16):a};io&&je({target:"JSON",stat:!0,forced:UT||FT},{stringify:function(p,l,t){var e=eo(arguments),r=D(UT?jk:io,null,e);return FT&&typeof r=="string"?Bk(r,Gk,Hk):r}}),we.JSON||(we.JSON={stringify:JSON.stringify});var $k=function(p,l,t){return D(we.JSON.stringify,null,arguments)},xe=$k;je({target:"Array",stat:!0},{isArray:fs});var qt=we.Array.isArray,Kk=td.concat("length","prototype"),dl={f:Object.getOwnPropertyNames||function(p){return XM(p,Kk)}},Yk=$([].concat),Wk=ue("Reflect","ownKeys")||function(p){var l=dl.f(Pt(p)),t=al.f;return t?Yk(l,t(p)):l},BT=Error,Jk=$("".replace),Qk=String(BT("zxcasd").stack),qT=/\n\s*at [^:]*:[^\n]*/,zk=qT.test(Qk),Xk=function(a,p){if(zk&&typeof a=="string"&&!BT.prepareStackTrace)for(;p--;)a=Jk(a,qT,"");return a},Zk=function(a,p){Ce(p)&&"cause"in p&&Mn(a,"cause",p.cause)},eO=qr("iterator"),tO=Array.prototype,GT=function(a){return a!==void 0&&(hs.Array===a||tO[eO]===a)},rO=qr("iterator"),dd=function(a){if(!yt(a))return ot(a,rO)||ot(a,"@@iterator")||hs[no(a)]},nO=TypeError,Wa=function(a,p){var l=arguments.length<2?dd(a):p;if(Ge(l))return Pt(oe(l,a));throw nO(Ve(a)+" is not iterable")},Jh=function(a,p,l){var t,e;Pt(a);try{if(!(t=ot(a,"return"))){if(p==="throw")throw l;return l}t=oe(t,a)}catch(r){e=!0,t=r}if(p==="throw")throw l;if(e)throw t;return Pt(t),l},iO=TypeError,pd=function(a,p){this.stopped=a,this.result=p},jT=pd.prototype,rr=function(a,p,l){var t,e,r,i,o,u,h,g=l&&l.that,v=!(!l||!l.AS_ENTRIES),_=!(!l||!l.IS_RECORD),I=!(!l||!l.IS_ITERATOR),C=!(!l||!l.INTERRUPTED),A=Yr(p,g),N=function(j){return t&&Jh(t,"normal",j),new pd(!0,j)},F=function(j){return v?(Pt(j),C?A(j[0],j[1],N):A(j[0],j[1])):C?A(j,N):A(j)};if(_)t=a.iterator;else if(I)t=a;else{if(!(e=dd(a)))throw iO(Ve(a)+" is not iterable");if(GT(e)){for(r=0,i=di(a);i>r;r++)if((o=F(a[r]))&&ge(jT,o))return o;return new pd(!1)}t=Wa(a,e)}for(u=_?a.next:t.next;!(h=oe(u,t)).done;){try{o=F(h.value)}catch(j){Jh(t,"throw",j)}if(typeof o=="object"&&o&&ge(jT,o))return o}return new pd(!1)},sO=String,xn=function(a){if(no(a)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return sO(a)},oO=function(a,p){return a===void 0?arguments.length<2?"":p:xn(a)},aO=!b(function(){var a=Error("a");return!("stack"in a)||(Object.defineProperty(a,"stack",ve(1,7)),a.stack!==7)}),cO=qr("toStringTag"),hd=Error,lO=[].push,pl=function(p,l){var t,e=arguments.length>2?arguments[2]:void 0,r=ge(Qh,this);ol?t=ol(hd(),r?Ya(this):Qh):(t=r?this:pi(Qh),Mn(t,cO,"Error")),l!==void 0&&Mn(t,"message",oO(l)),aO&&Mn(t,"stack",Xk(t.stack,1)),Zk(t,e);var i=[];return rr(p,lO,{that:i}),Mn(t,"errors",i),t};ol?ol(pl,hd):function(a,p,l){for(var t=Wk(p),e=$n.f,r=nl.f,i=0;i<t.length;i++){var o=t[i];Ct(a,o)||l&&Ct(l,o)||e(a,o,r(p,o))}}(pl,hd,{name:!0});var Qh=pl.prototype=pi(hd.prototype,{constructor:ve(1,pl),message:ve(1,""),name:ve(1,"AggregateError")});je({global:!0},{AggregateError:pl});var hl,Ja,HT,zh,Yi=ut(E.process)=="process",$T=qr("species"),KT=function(a){var p=ue(a),l=$n.f;le&&p&&!p[$T]&&l(p,$T,{configurable:!0,get:function(){return this}})},uO=TypeError,Xh=function(a,p){if(ge(p,a))return a;throw uO("Incorrect invocation")},dO=TypeError,fd=function(a){if(cd(a))return a;throw dO(Ve(a)+" is not a constructor")},pO=qr("species"),ki=function(a,p){var l,t=Pt(a).constructor;return t===void 0||yt(l=Pt(t)[pO])?p:fd(l)},hO=TypeError,YT=function(a,p){if(a<p)throw hO("Not enough arguments");return a},WT=/(?:ipad|iphone|ipod).*applewebkit/i.test(be),Zh=E.setImmediate,JT=E.clearImmediate,fO=E.process,ef=E.Dispatch,mO=E.Function,QT=E.MessageChannel,gO=E.String,tf=0,fl={},vO="onreadystatechange";try{hl=E.location}catch{}var rf=function(a){if(Ct(fl,a)){var p=fl[a];delete fl[a],p()}},nf=function(a){return function(){rf(a)}},zT=function(a){rf(a.data)},XT=function(a){E.postMessage(gO(a),hl.protocol+"//"+hl.host)};Zh&&JT||(Zh=function(p){YT(arguments.length,1);var l=Z(p)?p:mO(p),t=eo(arguments,1);return fl[++tf]=function(){D(l,void 0,t)},Ja(tf),tf},JT=function(p){delete fl[p]},Yi?Ja=function(a){fO.nextTick(nf(a))}:ef&&ef.now?Ja=function(a){ef.now(nf(a))}:QT&&!WT?(zh=(HT=new QT).port2,HT.port1.onmessage=zT,Ja=Yr(zh.postMessage,zh)):E.addEventListener&&Z(E.postMessage)&&!E.importScripts&&hl&&hl.protocol!=="file:"&&!b(XT)?(Ja=XT,E.addEventListener("message",zT,!1)):Ja=vO in Zu("script")?function(a){Nh.appendChild(Zu("script")).onreadystatechange=function(){Nh.removeChild(this),rf(a)}}:function(a){setTimeout(nf(a),0)});var ml,na,gl,Qa,sf,of,af,ZT,eI={set:Zh},yO=/ipad|iphone|ipod/i.test(be)&&E.Pebble!==void 0,_O=/web0s(?!.*chrome)/i.test(be),MO=nl.f,cf=eI.set,tI=E.MutationObserver||E.WebKitMutationObserver,rI=E.document,nI=E.process,md=E.Promise,iI=MO(E,"queueMicrotask"),sI=iI&&iI.value;sI||(ml=function(){var a,p;for(Yi&&(a=nI.domain)&&a.exit();na;){p=na.fn,na=na.next;try{p()}catch(l){throw na?Qa():gl=void 0,l}}gl=void 0,a&&a.enter()},WT||Yi||_O||!tI||!rI?!yO&&md&&md.resolve?((af=md.resolve(void 0)).constructor=md,ZT=Yr(af.then,af),Qa=function(){ZT(ml)}):Yi?Qa=function(){nI.nextTick(ml)}:(cf=Yr(cf,E),Qa=function(){cf(ml)}):(sf=!0,of=rI.createTextNode(""),new tI(ml).observe(of,{characterData:!0}),Qa=function(){of.data=sf=!sf}));var lf=sI||function(a){var p={fn:a,next:void 0};gl&&(gl.next=p),na||(na=p,Qa()),gl=p},za=function(a){try{return{error:!1,value:a()}}catch(p){return{error:!0,value:p}}},oI=function(){this.head=null,this.tail=null};oI.prototype={add:function(a){var p={item:a,next:null};this.head?this.tail.next=p:this.head=p,this.tail=p},get:function(){var a=this.head;if(a)return this.head=a.next,this.tail===a&&(this.tail=null),a.item}};var uf,aI,TO=oI,Pn=E.Promise,cI=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",IO=!cI&&!Yi&&typeof window=="object"&&typeof document=="object",lI=Pn&&Pn.prototype,SO=qr("species"),uI=Z(E.PromiseRejectionEvent),EO=KM("Promise",function(){var a=AT(Pn),p=a!==String(Pn);if(!p&&de===66||!lI.catch||!lI.finally)return!0;if(!de||de<51||!/native code/.test(a)){var l=new Pn(function(e){e(1)}),t=function(e){e(function(){},function(){})};if((l.constructor={})[SO]=t,!(l.then(function(){})instanceof t))return!0}return!p&&(IO||cI)&&!uI}),Xa={CONSTRUCTOR:EO,REJECTION_EVENT:uI},CO=TypeError,bO=function(a){var p,l;this.promise=new a(function(t,e){if(p!==void 0||l!==void 0)throw CO("Bad Promise constructor");p=t,l=e}),this.resolve=Ge(p),this.reject=Ge(l)},gs={f:function(a){return new bO(a)}},dI=eI.set,gd="Promise",pI=Xa.CONSTRUCTOR,AO=Xa.REJECTION_EVENT,df=hi.getterFor(gd),RO=hi.set,NO=Pn&&Pn.prototype,vl=Pn,pf=NO,hI=E.TypeError,hf=E.document,ff=E.process,mf=gs.f,kO=mf,OO=!!(hf&&hf.createEvent&&E.dispatchEvent),fI="unhandledrejection",mI=function(a){var p;return!(!Ce(a)||!Z(p=a.then))&&p},gI=function(a,p){var l,t,e,r=p.value,i=p.state==1,o=i?a.ok:a.fail,u=a.resolve,h=a.reject,g=a.domain;try{o?(i||(p.rejection===2&&xO(p),p.rejection=1),o===!0?l=r:(g&&g.enter(),l=o(r),g&&(g.exit(),e=!0)),l===a.promise?h(hI("Promise-chain cycle")):(t=mI(l))?oe(t,l,u,h):u(l)):h(r)}catch(v){g&&!e&&g.exit(),h(v)}},vI=function(a,p){a.notified||(a.notified=!0,lf(function(){for(var l,t=a.reactions;l=t.get();)gI(l,a);a.notified=!1,p&&!a.rejection&&wO(a)}))},yI=function(a,p,l){var t,e;OO?((t=hf.createEvent("Event")).promise=p,t.reason=l,t.initEvent(a,!1,!0),E.dispatchEvent(t)):t={promise:p,reason:l},!AO&&(e=E["on"+a])?e(t):a===fI&&function(r,i){var o=E.console;o&&o.error&&(arguments.length==1?o.error(r):o.error(r,i))}("Unhandled promise rejection",l)},wO=function(a){oe(dI,E,function(){var p,l=a.facade,t=a.value;if(_I(a)&&(p=za(function(){Yi?ff.emit("unhandledRejection",t,l):yI(fI,l,t)}),a.rejection=Yi||_I(a)?2:1,p.error))throw p.value})},_I=function(a){return a.rejection!==1&&!a.parent},xO=function(a){oe(dI,E,function(){var p=a.facade;Yi?ff.emit("rejectionHandled",p):yI("rejectionhandled",p,a.value)})},Za=function(a,p,l){return function(t){a(p,t,l)}},ec=function(a,p,l){a.done||(a.done=!0,l&&(a=l),a.value=p,a.state=2,vI(a,!0))},gf=function(a,p,l){if(!a.done){a.done=!0,l&&(a=l);try{if(a.facade===p)throw hI("Promise can't be resolved itself");var t=mI(p);t?lf(function(){var e={done:!1};try{oe(t,p,Za(gf,e,a),Za(ec,e,a))}catch(r){ec(e,r,a)}}):(a.value=p,a.state=1,vI(a,!1))}catch(e){ec({done:!1},e,a)}}};pI&&(pf=(vl=function(p){Xh(this,pf),Ge(p),oe(uf,this);var l=df(this);try{p(Za(gf,l),Za(ec,l))}catch(t){ec(l,t)}}).prototype,(uf=function(p){RO(this,{type:gd,done:!1,notified:!1,parent:!1,reactions:new TO,rejection:!1,state:0,value:void 0})}).prototype=ro(pf,"then",function(p,l){var t=df(this),e=mf(ki(this,vl));return t.parent=!0,e.ok=!Z(p)||p,e.fail=Z(l)&&l,e.domain=Yi?ff.domain:void 0,t.state==0?t.reactions.add(e):lf(function(){gI(e,t)}),e.promise}),aI=function(){var a=new uf,p=df(a);this.promise=a,this.resolve=Za(gf,p),this.reject=Za(ec,p)},gs.f=mf=function(a){return a===vl||a===void 0?new aI(a):kO(a)}),je({global:!0,wrap:!0,forced:pI},{Promise:vl}),Zo(vl,gd,!1,!0),KT(gd);var MI=qr("iterator"),TI=!1;try{var PO=0,II={next:function(){return{done:!!PO++}},return:function(){TI=!0}};II[MI]=function(){return this},Array.from(II,function(){throw 2})}catch{}var SI=function(a,p){if(!TI)return!1;var l=!1;try{var t={};t[MI]=function(){return{next:function(){return{done:l=!0}}}},a(t)}catch{}return l},EI=Xa.CONSTRUCTOR||!SI(function(a){Pn.all(a).then(void 0,function(){})});je({target:"Promise",stat:!0,forced:EI},{all:function(p){var l=this,t=gs.f(l),e=t.resolve,r=t.reject,i=za(function(){var o=Ge(l.resolve),u=[],h=0,g=1;rr(p,function(v){var _=h++,I=!1;g++,oe(o,l,v).then(function(C){I||(I=!0,u[_]=C,--g||e(u))},r)}),--g||e(u)});return i.error&&r(i.value),t.promise}});var LO=Xa.CONSTRUCTOR;Pn&&Pn.prototype,je({target:"Promise",proto:!0,forced:LO,real:!0},{catch:function(a){return this.then(void 0,a)}}),je({target:"Promise",stat:!0,forced:EI},{race:function(p){var l=this,t=gs.f(l),e=t.reject,r=za(function(){var i=Ge(l.resolve);rr(p,function(o){oe(i,l,o).then(t.resolve,e)})});return r.error&&e(r.value),t.promise}}),je({target:"Promise",stat:!0,forced:Xa.CONSTRUCTOR},{reject:function(p){var l=gs.f(this);return oe(l.reject,void 0,p),l.promise}});var vf=function(a,p){if(Pt(a),Ce(p)&&p.constructor===a)return p;var l=gs.f(a);return(0,l.resolve)(p),l.promise},VO=Xa.CONSTRUCTOR,DO=ue("Promise"),UO=!VO;je({target:"Promise",stat:!0,forced:!0},{resolve:function(p){return vf(UO&&this===DO?Pn:this,p)}}),je({target:"Promise",stat:!0},{allSettled:function(p){var l=this,t=gs.f(l),e=t.resolve,r=t.reject,i=za(function(){var o=Ge(l.resolve),u=[],h=0,g=1;rr(p,function(v){var _=h++,I=!1;g++,oe(o,l,v).then(function(C){I||(I=!0,u[_]={status:"fulfilled",value:C},--g||e(u))},function(C){I||(I=!0,u[_]={status:"rejected",reason:C},--g||e(u))})}),--g||e(u)});return i.error&&r(i.value),t.promise}});var CI="No one promise resolved";je({target:"Promise",stat:!0},{any:function(p){var l=this,t=ue("AggregateError"),e=gs.f(l),r=e.resolve,i=e.reject,o=za(function(){var u=Ge(l.resolve),h=[],g=0,v=1,_=!1;rr(p,function(I){var C=g++,A=!1;v++,oe(u,l,I).then(function(N){A||_||(_=!0,r(N))},function(N){A||_||(A=!0,h[C]=N,--v||i(new t(h,CI)))})}),--v||i(new t(h,CI))});return o.error&&i(o.value),e.promise}});var FO=Pn&&Pn.prototype,BO=!!Pn&&b(function(){FO.finally.call({then:function(){}},function(){})});je({target:"Promise",proto:!0,real:!0,forced:BO},{finally:function(a){var p=ki(this,ue("Promise")),l=Z(a);return this.then(l?function(t){return vf(p,a()).then(function(){return t})}:a,l?function(t){return vf(p,a()).then(function(){throw t})}:a)}});var qO=$("".charAt),bI=$("".charCodeAt),GO=$("".slice),AI=function(a){return function(p,l){var t,e,r=xn(jt(p)),i=sl(l),o=r.length;return i<0||i>=o?a?"":void 0:(t=bI(r,i))<55296||t>56319||i+1===o||(e=bI(r,i+1))<56320||e>57343?a?qO(r,i):t:a?GO(r,i,i+2):e-56320+(t-55296<<10)+65536}},RI={codeAt:AI(!1),charAt:AI(!0)},jO=RI.charAt,NI="String Iterator",HO=hi.set,$O=hi.getterFor(NI);Bh(String,"String",function(a){HO(this,{type:NI,string:xn(a),index:0})},function(){var p,l=$O(this),t=l.string,e=l.index;return e>=t.length?{value:void 0,done:!0}:(p=jO(t,e),l.index+=p.length,{value:p,done:!1})});var KO=we.Promise;je({target:"Promise",stat:!0,forced:!0},{try:function(a){var p=gs.f(this),l=za(a);return(l.error?p.reject:p.resolve)(l.value),p.promise}});var He=KO,YO=Ee.f,WO=$(YO),JO=$([].push),kI=function(a){return function(p){for(var l,t=Tt(p),e=ds(t),r=e.length,i=0,o=[];r>i;)l=e[i++],le&&!WO(t,l)||JO(o,a?[l,t[l]]:t[l]);return o}},OI={entries:kI(!0),values:kI(!1)},QO=OI.values;je({target:"Object",stat:!0},{values:function(p){return QO(p)}});var yf=we.Object.values,wI=Date,zO=$(wI.prototype.getTime);je({target:"Date",stat:!0},{now:function(){return zO(new wI)}});var Dt=we.Date.now,xI=qr("isConcatSpreadable"),XO=de>=51||!b(function(){var a=[];return a[xI]=!1,a.concat()[0]!==a}),ZO=ul("concat"),ew=function(a){if(!Ce(a))return!1;var p=a[xI];return p!==void 0?!!p:fs(a)};je({target:"Array",proto:!0,forced:!XO||!ZO},{concat:function(p){var l,t,e,r,i,o=Er(this),u=Hh(o,0),h=0;for(l=-1,e=arguments.length;l<e;l++)if(ew(i=l===-1?o:arguments[l]))for(r=di(i),Yh(h+r),t=0;t<r;t++,h++)t in i&&ra(u,h,i[t]);else Yh(h+1),ra(u,h++,i);return u.length=h,u}});var tw=Gr("Array").concat,_f=Array.prototype,dt=function(a){var p=a.concat;return a===_f||ge(_f,a)&&p===_f.concat?tw:p},rw=/MSIE .\./.test(be),nw=E.Function,PI=function(a){return rw?function(p,l){var t=YT(arguments.length,1)>2,e=Z(p)?p:nw(p),r=t?eo(arguments,2):void 0;return a(t?function(){D(e,this,r)}:e,l)}:a},LI={setTimeout:PI(E.setTimeout),setInterval:PI(E.setInterval)},VI=LI.setInterval;je({global:!0,bind:!0,forced:E.setInterval!==VI},{setInterval:VI});var DI=LI.setTimeout;je({global:!0,bind:!0,forced:E.setTimeout!==DI},{setTimeout:DI});var or=we.setTimeout,ia=m(function(a){var p=Object.prototype.hasOwnProperty,l="~";function t(){}function e(u,h,g){this.fn=u,this.context=h,this.once=g||!1}function r(u,h,g,v,_){if(typeof g!="function")throw new TypeError("The listener must be a function");var I=new e(g,v||u,_),C=l?l+h:h;return u._events[C]?u._events[C].fn?u._events[C]=[u._events[C],I]:u._events[C].push(I):(u._events[C]=I,u._eventsCount++),u}function i(u,h){--u._eventsCount==0?u._events=new t:delete u._events[h]}function o(){this._events=new t,this._eventsCount=0}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(l=!1)),o.prototype.eventNames=function(){var h,g,v=[];if(this._eventsCount===0)return v;for(g in h=this._events)p.call(h,g)&&v.push(l?g.slice(1):g);return Object.getOwnPropertySymbols?v.concat(Object.getOwnPropertySymbols(h)):v},o.prototype.listeners=function(h){var g=l?l+h:h,v=this._events[g];if(!v)return[];if(v.fn)return[v.fn];for(var _=0,I=v.length,C=new Array(I);_<I;_++)C[_]=v[_].fn;return C},o.prototype.listenerCount=function(h){var g=l?l+h:h,v=this._events[g];return v?v.fn?1:v.length:0},o.prototype.emit=function(h,g,v,_,I,C){var A=l?l+h:h;if(!this._events[A])return!1;var N,F,j=this._events[A],W=arguments.length;if(j.fn){switch(j.once&&this.removeListener(h,j.fn,void 0,!0),W){case 1:return j.fn.call(j.context),!0;case 2:return j.fn.call(j.context,g),!0;case 3:return j.fn.call(j.context,g,v),!0;case 4:return j.fn.call(j.context,g,v,_),!0;case 5:return j.fn.call(j.context,g,v,_,I),!0;case 6:return j.fn.call(j.context,g,v,_,I,C),!0}for(F=1,N=new Array(W-1);F<W;F++)N[F-1]=arguments[F];j.fn.apply(j.context,N)}else{var U,ie=j.length;for(F=0;F<ie;F++)switch(j[F].once&&this.removeListener(h,j[F].fn,void 0,!0),W){case 1:j[F].fn.call(j[F].context);break;case 2:j[F].fn.call(j[F].context,g);break;case 3:j[F].fn.call(j[F].context,g,v);break;case 4:j[F].fn.call(j[F].context,g,v,_);break;default:if(!N)for(U=1,N=new Array(W-1);U<W;U++)N[U-1]=arguments[U];j[F].fn.apply(j[F].context,N)}}return!0},o.prototype.on=function(h,g,v){return r(this,h,g,v,!1)},o.prototype.once=function(h,g,v){return r(this,h,g,v,!0)},o.prototype.removeListener=function(h,g,v,_){var I=l?l+h:h;if(!this._events[I])return this;if(!g)return i(this,I),this;var C=this._events[I];if(C.fn)C.fn!==g||_&&!C.once||v&&C.context!==v||i(this,I);else{for(var A=0,N=[],F=C.length;A<F;A++)(C[A].fn!==g||_&&!C[A].once||v&&C[A].context!==v)&&N.push(C[A]);N.length?this._events[I]=N.length===1?N[0]:N:i(this,I)}return this},o.prototype.removeAllListeners=function(h){var g;return h?(g=l?l+h:h,this._events[g]&&i(this,g)):(this._events=new t,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=l,o.EventEmitter=o,a.exports=o});je({global:!0},{globalThis:E});var Mf=E,iw=Array,sw=Math.max,Tf=function(a,p,l){for(var t=di(a),e=zo(p,t),r=zo(l===void 0?t:l,t),i=iw(sw(r-e,0)),o=0;e<r;e++,o++)ra(i,o,a[e]);return i.length=o,i},UI=dl.f,FI=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],If={f:function(p){return FI&&ut(p)=="Window"?function(l){try{return UI(l)}catch{return Tf(FI)}}(p):UI(Tt(p))}},Sf={f:qr},ow=$n.f,Hr=function(a){var p=we.Symbol||(we.Symbol={});Ct(p,a)||ow(p,a,{value:Sf.f(a)})},BI=function(){var a=ue("Symbol"),p=a&&a.prototype,l=p&&p.valueOf,t=qr("toPrimitive");p&&!p[t]&&ro(p,t,function(e){return oe(l,this)},{})},vd=ms.forEach,Kn=rd("hidden"),yd="Symbol",aw=hi.set,qI=hi.getterFor(yd),Oi=Object.prototype,sa=E.Symbol,yl=sa&&sa.prototype,cw=E.TypeError,Ef=E.QObject,GI=nl.f,so=$n.f,jI=If.f,lw=Ee.f,HI=$([].push),vs=Xt("symbols"),_l=Xt("op-symbols"),uw=Xt("wks"),Cf=!Ef||!Ef.prototype||!Ef.prototype.findChild,bf=le&&b(function(){return pi(so({},"a",{get:function(){return so(this,"a",{value:7}).a}})).a!=7})?function(a,p,l){var t=GI(Oi,p);t&&delete Oi[p],so(a,p,l),t&&a!==Oi&&so(Oi,p,t)}:so,Af=function(a,p){var l=vs[a]=pi(yl);return aw(l,{type:yd,tag:a,description:p}),le||(l.description=p),l},_d=function(p,l,t){p===Oi&&_d(_l,l,t),Pt(p);var e=Qo(l);return Pt(t),Ct(vs,e)?(t.enumerable?(Ct(p,Kn)&&p[Kn][e]&&(p[Kn][e]=!1),t=pi(t,{enumerable:ve(0,!1)})):(Ct(p,Kn)||so(p,Kn,ve(1,{})),p[Kn][e]=!0),bf(p,e,t)):so(p,e,t)},Rf=function(p,l){Pt(p);var t=Tt(l),e=ds(t).concat(WI(t));return vd(e,function(r){le&&!oe($I,t,r)||_d(p,r,t[r])}),p},$I=function(p){var l=Qo(p),t=oe(lw,this,l);return!(this===Oi&&Ct(vs,l)&&!Ct(_l,l))&&(!(t||!Ct(this,l)||!Ct(vs,l)||Ct(this,Kn)&&this[Kn][l])||t)},KI=function(p,l){var t=Tt(p),e=Qo(l);if(t!==Oi||!Ct(vs,e)||Ct(_l,e)){var r=GI(t,e);return!r||!Ct(vs,e)||Ct(t,Kn)&&t[Kn][e]||(r.enumerable=!0),r}},YI=function(p){var l=jI(Tt(p)),t=[];return vd(l,function(e){Ct(vs,e)||Ct(Ha,e)||HI(t,e)}),t},WI=function(a){var p=a===Oi,l=jI(p?_l:Tt(a)),t=[];return vd(l,function(e){!Ct(vs,e)||p&&!Ct(Oi,e)||HI(t,vs[e])}),t};Ae||(sa=function(){if(ge(yl,this))throw cw("Symbol is not a constructor");var p=arguments.length&&arguments[0]!==void 0?xn(arguments[0]):void 0,l=_n(p),t=function(e){this===Oi&&oe(t,_l,e),Ct(this,Kn)&&Ct(this[Kn],l)&&(this[Kn][l]=!1),bf(this,l,ve(1,e))};return le&&Cf&&bf(Oi,l,{configurable:!0,set:t}),Af(l,p)},yl=sa.prototype,ro(yl,"toString",function(){return qI(this).tag}),ro(sa,"withoutSetter",function(a){return Af(_n(a),a)}),Ee.f=$I,$n.f=_d,ZM.f=Rf,nl.f=KI,dl.f=If.f=YI,al.f=WI,Sf.f=function(a){return Af(qr(a),a)},le&&so(yl,"description",{configurable:!0,get:function(){return qI(this).description}})),je({global:!0,wrap:!0,forced:!Ae,sham:!Ae},{Symbol:sa}),vd(ds(uw),function(a){Hr(a)}),je({target:yd,stat:!0,forced:!Ae},{useSetter:function(){Cf=!0},useSimple:function(){Cf=!1}}),je({target:"Object",stat:!0,forced:!Ae,sham:!le},{create:function(p,l){return l===void 0?pi(p):Rf(pi(p),l)},defineProperty:_d,defineProperties:Rf,getOwnPropertyDescriptor:KI}),je({target:"Object",stat:!0,forced:!Ae},{getOwnPropertyNames:YI}),BI(),Zo(sa,yd),Ha[Kn]=!0;var JI=Ae&&!!Symbol.for&&!!Symbol.keyFor,Nf=Xt("string-to-symbol-registry"),dw=Xt("symbol-to-string-registry");je({target:"Symbol",stat:!0,forced:!JI},{for:function(a){var p=xn(a);if(Ct(Nf,p))return Nf[p];var l=ue("Symbol")(p);return Nf[p]=l,dw[l]=p,l}});var QI=Xt("symbol-to-string-registry");je({target:"Symbol",stat:!0,forced:!JI},{keyFor:function(p){if(!De(p))throw TypeError(Ve(p)+" is not a symbol");if(Ct(QI,p))return QI[p]}});var pw=!Ae||b(function(){al.f(1)});je({target:"Object",stat:!0,forced:pw},{getOwnPropertySymbols:function(p){var l=al.f;return l?l(Er(p)):[]}}),Hr("asyncIterator"),Hr("hasInstance"),Hr("isConcatSpreadable"),Hr("iterator"),Hr("match"),Hr("matchAll"),Hr("replace"),Hr("search"),Hr("species"),Hr("split"),Hr("toPrimitive"),BI(),Hr("toStringTag"),Zo(ue("Symbol"),"Symbol"),Hr("unscopables"),Zo(E.JSON,"JSON",!0);var hw=we.Symbol;Hr("asyncDispose"),Hr("dispose"),Hr("matcher"),Hr("metadataKey"),Hr("observable"),Hr("metadata"),Hr("patternMatch"),Hr("replaceAll");var gr=hw,fw=b(function(){Ya(1)});je({target:"Object",stat:!0,forced:fw,sham:!gT},{getPrototypeOf:function(p){return Ya(Er(p))}});var wi=we.Object.getPrototypeOf,mw=$([].reverse),zI=[1,2];je({target:"Array",proto:!0,forced:String(zI)===String(zI.reverse())},{reverse:function(){return fs(this)&&(this.length=this.length),mw(this)}});var gw=Gr("Array").reverse,kf=Array.prototype,Wi=function(a){var p=a.reverse;return a===kf||ge(kf,a)&&p===kf.reverse?gw:p},vw=ul("slice"),yw=qr("species"),Of=Array,_w=Math.max;je({target:"Array",proto:!0,forced:!vw},{slice:function(p,l){var t,e,r,i=Tt(this),o=di(i),u=zo(p,o),h=zo(l===void 0?o:l,o);if(fs(i)&&(t=i.constructor,(cd(t)&&(t===Of||fs(t.prototype))||Ce(t)&&(t=t[yw])===null)&&(t=void 0),t===Of||t===void 0))return eo(i,u,h);for(e=new(t===void 0?Of:t)(_w(h-u,0)),r=0;u<h;u++,r++)u in i&&ra(e,r,i[u]);return e.length=r,e}});var Mw=Gr("Array").slice,wf=Array.prototype,ht=function(a){var p=a.slice;return a===wf||ge(wf,a)&&p===wf.slice?Mw:p},xf=Sf.f("iterator"),Tw=Rh.includes,Iw=b(function(){return!Array(1).includes()});je({target:"Array",proto:!0,forced:Iw},{includes:function(p){return Tw(this,p,arguments.length>1?arguments[1]:void 0)}});var Sw=Gr("Array").includes,Ew=qr("match"),Cw=TypeError,XI=function(a){if(function(p){var l;return Ce(p)&&((l=p[Ew])!==void 0?!!l:ut(p)=="RegExp")}(a))throw Cw("The method doesn't accept regular expressions");return a},bw=qr("match"),ZI=function(a){var p=/./;try{"/./"[a](p)}catch{try{return p[bw]=!1,"/./"[a](p)}catch{}}return!1},Aw=$("".indexOf);je({target:"String",proto:!0,forced:!ZI("includes")},{includes:function(p){return!!~Aw(xn(jt(this)),xn(XI(p)),arguments.length>1?arguments[1]:void 0)}});var Rw=Gr("String").includes,Pf=Array.prototype,Lf=String.prototype,_t=function(a){var p=a.includes;return a===Pf||ge(Pf,a)&&p===Pf.includes?Sw:typeof a=="string"||a===Lf||ge(Lf,a)&&p===Lf.includes?Rw:p},Nw=ms.map,kw=ul("map");je({target:"Array",proto:!0,forced:!kw},{map:function(p){return Nw(this,p,arguments.length>1?arguments[1]:void 0)}});var Ow=Gr("Array").map,Vf=Array.prototype,se=function(a){var p=a.map;return a===Vf||ge(Vf,a)&&p===Vf.map?Ow:p},ww=ms.filter,xw=ul("filter");je({target:"Array",proto:!0,forced:!xw},{filter:function(p){return ww(this,p,arguments.length>1?arguments[1]:void 0)}});var Pw=Gr("Array").filter,Df=Array.prototype,at=function(a){var p=a.filter;return a===Df||ge(Df,a)&&p===Df.filter?Pw:p},Lw=m(function(a,p){a.exports=function(){function l(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */l=function(){return I};var I={},C=Object.prototype,A=C.hasOwnProperty,N=typeof gr=="function"?gr:{},F=N.iterator||"@@iterator",j=N.asyncIterator||"@@asyncIterator",W=N.toStringTag||"@@toStringTag";function U(Ie,Oe,mt){return Zs(Ie,Oe,{value:mt,enumerable:!0,configurable:!0,writable:!0}),Ie[Oe]}try{U({},"")}catch{U=function(mt,Je,Lt){return mt[Je]=Lt}}function ie(Ie,Oe,mt,Je){var Lt=Oe&&Oe.prototype instanceof V?Oe:V,Et=Ri(Lt.prototype),lt=new vt(Je||[]);return Et._invoke=function($t,Ze,gt){var ir="suspendedStart";return function(st,nu){if(ir==="executing")throw new Error("Generator is already running");if(ir==="completed"){if(st==="throw")throw nu;return At()}for(gt.method=st,gt.arg=nu;;){var iu=gt.delegate;if(iu){var an=ze(iu,gt);if(an){if(an===H)continue;return an}}if(gt.method==="next")gt.sent=gt._sent=gt.arg;else if(gt.method==="throw"){if(ir==="suspendedStart")throw ir="completed",gt.arg;gt.dispatchException(gt.arg)}else gt.method==="return"&&gt.abrupt("return",gt.arg);ir="executing";var en=te($t,Ze,gt);if(en.type==="normal"){if(ir=gt.done?"completed":"suspendedYield",en.arg===H)continue;return{value:en.arg,done:gt.done}}en.type==="throw"&&(ir="completed",gt.method="throw",gt.arg=en.arg)}}}(Ie,mt,lt),Et}function te(Ie,Oe,mt){try{return{type:"normal",arg:Ie.call(Oe,mt)}}catch(Je){return{type:"throw",arg:Je}}}I.wrap=ie;var H={};function V(){}function w(){}function Y(){}var re={};U(re,F,function(){return this});var ee=wi&&wi(wi(ar([])));ee&&ee!==C&&A.call(ee,F)&&(re=ee);var pe=Y.prototype=V.prototype=Ri(re);function ye(Ie){var Oe;ae(Oe=["next","throw","return"]).call(Oe,function(mt){U(Ie,mt,function(Je){return this._invoke(mt,Je)})})}function Q(Ie,Oe){function mt(Lt,Et,lt,$t){var Ze=te(Ie[Lt],Ie,Et);if(Ze.type!=="throw"){var gt=Ze.arg,ir=gt.value;return ir&&typeof ir=="object"&&A.call(ir,"__await")?Oe.resolve(ir.__await).then(function(st){mt("next",st,lt,$t)},function(st){mt("throw",st,lt,$t)}):Oe.resolve(ir).then(function(st){gt.value=st,lt(gt)},function(st){return mt("throw",st,lt,$t)})}$t(Ze.arg)}var Je;this._invoke=function(Lt,Et){function lt(){return new Oe(function($t,Ze){mt(Lt,Et,$t,Ze)})}return Je=Je?Je.then(lt,lt):lt()}}function ze(Ie,Oe){var mt=Ie.iterator[Oe.method];if(mt===void 0){if(Oe.delegate=null,Oe.method==="throw"){if(Ie.iterator.return&&(Oe.method="return",Oe.arg=void 0,ze(Ie,Oe),Oe.method==="throw"))return H;Oe.method="throw",Oe.arg=new TypeError("The iterator does not provide a 'throw' method")}return H}var Je=te(mt,Ie.iterator,Oe.arg);if(Je.type==="throw")return Oe.method="throw",Oe.arg=Je.arg,Oe.delegate=null,H;var Lt=Je.arg;return Lt?Lt.done?(Oe[Ie.resultName]=Lt.value,Oe.next=Ie.nextLoc,Oe.method!=="return"&&(Oe.method="next",Oe.arg=void 0),Oe.delegate=null,H):Lt:(Oe.method="throw",Oe.arg=new TypeError("iterator result is not an object"),Oe.delegate=null,H)}function nt(Ie){var Oe={tryLoc:Ie[0]};1 in Ie&&(Oe.catchLoc=Ie[1]),2 in Ie&&(Oe.finallyLoc=Ie[2],Oe.afterLoc=Ie[3]),this.tryEntries.push(Oe)}function Se(Ie){var Oe=Ie.completion||{};Oe.type="normal",delete Oe.arg,Ie.completion=Oe}function vt(Ie){this.tryEntries=[{tryLoc:"root"}],ae(Ie).call(Ie,nt,this),this.reset(!0)}function ar(Ie){if(Ie){var Oe=Ie[F];if(Oe)return Oe.call(Ie);if(typeof Ie.next=="function")return Ie;if(!isNaN(Ie.length)){var mt=-1,Je=function Lt(){for(;++mt<Ie.length;)if(A.call(Ie,mt))return Lt.value=Ie[mt],Lt.done=!1,Lt;return Lt.value=void 0,Lt.done=!0,Lt};return Je.next=Je}}return{next:At}}function At(){return{value:void 0,done:!0}}return w.prototype=Y,U(pe,"constructor",Y),U(Y,"constructor",w),w.displayName=U(Y,W,"GeneratorFunction"),I.isGeneratorFunction=function(Ie){var Oe=typeof Ie=="function"&&Ie.constructor;return!!Oe&&(Oe===w||(Oe.displayName||Oe.name)==="GeneratorFunction")},I.mark=function(Ie){return ps?ps(Ie,Y):(Ie.__proto__=Y,U(Ie,W,"GeneratorFunction")),Ie.prototype=Ri(pe),Ie},I.awrap=function(Ie){return{__await:Ie}},ye(Q.prototype),U(Q.prototype,j,function(){return this}),I.AsyncIterator=Q,I.async=function(Ie,Oe,mt,Je,Lt){Lt===void 0&&(Lt=He);var Et=new Q(ie(Ie,Oe,mt,Je),Lt);return I.isGeneratorFunction(Oe)?Et:Et.next().then(function(lt){return lt.done?lt.value:Et.next()})},ye(pe),U(pe,W,"Generator"),U(pe,F,function(){return this}),U(pe,"toString",function(){return"[object Generator]"}),I.keys=function(Ie){var Oe=[];for(var mt in Ie)Oe.push(mt);return Wi(Oe).call(Oe),function Je(){for(;Oe.length;){var Lt=Oe.pop();if(Lt in Ie)return Je.value=Lt,Je.done=!1,Je}return Je.done=!0,Je}},I.values=ar,vt.prototype={constructor:vt,reset:function(Oe){var mt;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,ae(mt=this.tryEntries).call(mt,Se),!Oe)for(var Je in this)Je.charAt(0)==="t"&&A.call(this,Je)&&!isNaN(+ht(Je).call(Je,1))&&(this[Je]=void 0)},stop:function(){this.done=!0;var Oe=this.tryEntries[0].completion;if(Oe.type==="throw")throw Oe.arg;return this.rval},dispatchException:function(Oe){if(this.done)throw Oe;var mt=this;function Je(gt,ir){return lt.type="throw",lt.arg=Oe,mt.next=gt,ir&&(mt.method="next",mt.arg=void 0),!!ir}for(var Lt=this.tryEntries.length-1;Lt>=0;--Lt){var Et=this.tryEntries[Lt],lt=Et.completion;if(Et.tryLoc==="root")return Je("end");if(Et.tryLoc<=this.prev){var $t=A.call(Et,"catchLoc"),Ze=A.call(Et,"finallyLoc");if($t&&Ze){if(this.prev<Et.catchLoc)return Je(Et.catchLoc,!0);if(this.prev<Et.finallyLoc)return Je(Et.finallyLoc)}else if($t){if(this.prev<Et.catchLoc)return Je(Et.catchLoc,!0)}else{if(!Ze)throw new Error("try statement without catch or finally");if(this.prev<Et.finallyLoc)return Je(Et.finallyLoc)}}}},abrupt:function(Oe,mt){for(var Je=this.tryEntries.length-1;Je>=0;--Je){var Lt=this.tryEntries[Je];if(Lt.tryLoc<=this.prev&&A.call(Lt,"finallyLoc")&&this.prev<Lt.finallyLoc){var Et=Lt;break}}Et&&(Oe==="break"||Oe==="continue")&&Et.tryLoc<=mt&&mt<=Et.finallyLoc&&(Et=null);var lt=Et?Et.completion:{};return lt.type=Oe,lt.arg=mt,Et?(this.method="next",this.next=Et.finallyLoc,H):this.complete(lt)},complete:function(Oe,mt){if(Oe.type==="throw")throw Oe.arg;return Oe.type==="break"||Oe.type==="continue"?this.next=Oe.arg:Oe.type==="return"?(this.rval=this.arg=Oe.arg,this.method="return",this.next="end"):Oe.type==="normal"&&mt&&(this.next=mt),H},finish:function(Oe){for(var mt=this.tryEntries.length-1;mt>=0;--mt){var Je=this.tryEntries[mt];if(Je.finallyLoc===Oe)return this.complete(Je.completion,Je.afterLoc),Se(Je),H}},catch:function(Oe){for(var mt=this.tryEntries.length-1;mt>=0;--mt){var Je=this.tryEntries[mt];if(Je.tryLoc===Oe){var Lt=Je.completion;if(Lt.type==="throw"){var Et=Lt.arg;Se(Je)}return Et}}throw new Error("illegal catch attempt")},delegateYield:function(Oe,mt,Je){return this.delegate={iterator:ar(Oe),resultName:mt,nextLoc:Je},this.method==="next"&&(this.arg=void 0),H}},I}function t(I){return t=typeof gr=="function"&&typeof xf=="symbol"?function(C){return typeof C}:function(C){return C&&typeof gr=="function"&&C.constructor===gr&&C!==gr.prototype?"symbol":typeof C},t(I)}function e(I,C){if(!(I instanceof C))throw new TypeError("Cannot call a class as a function")}function r(I,C){for(var A=0;A<C.length;A++){var N=C[A];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Zs(I,N.key,N)}}function i(I,C,A){return C&&r(I.prototype,C),Zs(I,"prototype",{writable:!1}),I}function o(I,C,A,N){function F(j){return j instanceof A?j:new A(function(W){W(j)})}return new(A||(A=He))(function(j,W){function U(H){try{te(N.next(H))}catch(V){W(V)}}function ie(H){try{te(N.throw(H))}catch(V){W(V)}}function te(H){H.done?j(H.value):F(H.value).then(U,ie)}te((N=N.apply(I,[])).next())})}var u={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:72e5},h=12,g=8e3,v=function(){},_=function(){function I(C){e(this,I),this.isUploadEnable=!0,this.serverAllowUpload=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=u,this.configPath="dispatcher/req",this.dataReportPath="statics/report/common/form",this.traceMsgCache={},this.reqRetryCount=0,this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Dt(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(C),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return i(I,[{key:"setConfig",value:function(A){var N=O({},this.reportConfig.common,A.common);this.reportConfig=O({},this.reportConfig,A),this.reportConfig.common=N,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function(A,N){var F=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(A,O({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},N)).catch(function(j){var W,U;(U=(W=F.reportConfig)===null||W===void 0?void 0:W.logger)===null||U===void 0||U.warn("Reporter immediately upload failed",j)})}},{key:"report",value:function(A,N){var F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(F.priority||(F.priority=this.getEventPriority(A,N)),this.reportConfig.isDataReportEnable&&A){if(A==="login"&&N.succeed===!1&&N.process_id){var j=this.lastFailLogin[N.process_id]||0;if(N.start_time-j<u.loginFailIgnoreInterval)return;this.lastFailLogin[N.process_id]=N.start_time}var W=Dt();F.priority==="HIGH"?this.highPriorityMsgList.push({module:A,msg:N,createTime:W}):F.priority==="NORMAL"?this.msgList.push({module:A,msg:N,createTime:W}):F.priority==="LOW"&&this.lowPriorityMsgList.push({module:A,msg:N,createTime:W}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(A,N){if(this.reportConfig.isDataReportEnable&&A&&!this.traceMsgCache[A]){var F=O(O({start_time:Dt()},N),{extension:[]});this.traceMsgCache[A]=F}}},{key:"reportTraceUpdate",value:function(A){}},{key:"reportTraceUpdateV2",value:function(A,N,F){var j,W=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[A]){var U=this.traceMsgCache[A].extension,ie=U.length,te=new Date().getTime();ie===0?N.duration=te-this.traceMsgCache[A].start_time:U[ie-1].end_time?N.duration=te-U[ie-1].end_time:N.duration=te-this.traceMsgCache[A].start_time,U.push(O({end_time:te},N));var H=U.length-1;F!=null&&F.asyncParams&&((j=this.traceMsgCache[A]).asyncPromiseArray||(j.asyncPromiseArray=[]),this.traceMsgCache[A].asyncPromiseArray.push(F.asyncParams.then(function(V){W.traceMsgCache[A]&&W.traceMsgCache[A].extension[H]&&O(W.traceMsgCache[A].extension[H],V)})))}}},{key:"reportTraceEnd",value:function(A){var N,F,j=this,W=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[A])if(A!=="nos"||W===!1){typeof W=="boolean"?this.traceMsgCache[A].succeed=!!W:this.traceMsgCache[A].state=W,this.traceMsgCache[A].duration=Dt()-this.traceMsgCache[A].start_time,ae(N=this.traceMsgCache[A].extension).call(N,function(te){delete te.end_time});var U=this.traceMsgCache[A];if(this.traceMsgCache[A]=null,U.asyncPromiseArray){(F=this.endedAsyncMsgByModule)[A]||(F[A]=[]),this.endedAsyncMsgByModule[A].push(U);var ie=function(){var H;j.endedAsyncMsgByModule[A]&&_t(H=j.endedAsyncMsgByModule[A]).call(H,U)&&(delete U.asyncPromiseArray,j.report(A,U,{priority:j.getEventPriority(A,U)}))};He.all(U.asyncPromiseArray).then(ie).catch(ie)}else this.report(A,U,{priority:this.getEventPriority(A,U)})}else this.traceMsgCache[A]=null}},{key:"getEventPriority",value:function(A,N){if(A==="exceptions"){if(N.action===0||N.action===2||N.action===1&&N.exception_service!==0)return"HIGH"}else if(A==="msgReceive"||A==="nim_api_trace")return"LOW";return"NORMAL"}},{key:"reportTraceCancel",value:function(A){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[A]=[],this.traceMsgCache[A]=null)}},{key:"pause",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function(){var A,N=this;this.reportConfig.isDataReportEnable&&(ae(A=pt(this.traceMsgCache)).call(A,function(F){N.reportTraceEnd(F,1)}),this.timer!==null&&clearTimeout(this.timer),this.setConfig=v,this.report=v,this.reportTraceStart=v,this.reportTraceUpdate=v,this.reportTraceEnd=v,this.pause=v,this.restore=v,this.destroy=v,this.reqRetryCount=0,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function(){var A,N;return o(this,void 0,void 0,l().mark(function F(){var j,W,U,ie,te,H=this;return l().wrap(function(w){for(var Y;;)switch(w.prev=w.next){case 0:if(!this.loading){w.next=2;break}return w.abrupt("return");case 2:this.loading=!0,j=this.reportConfig.common||{},W=se(Y=this.reportConfig.compassDataEndpoint.split(",")).call(Y,function(re){var ee;return dt(ee="".concat(re,"/")).call(ee,H.configPath)}),U=l().mark(function re(ee){return l().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(!H.initConfigLoaded&&!H.isDestroyed){ye.next=2;break}return ye.abrupt("return","break");case 2:return ye.prev=2,ye.next=5,H.reportConfig.request(W[ee],{method:"GET",dataType:"json",params:{deviceId:j.dev_id,sdkVer:j.sdk_ver,platform:j.platform,appkey:j.app_key},timeout:H.reportConfig.timeout}).then(function(Q){var ze,nt;if(!H.isDestroyed){if(Q.status===200&&Q.data&&Q.data.code===200){H.initConfigLoaded=!0;var Se=Q.data.data||{};H.reportConfig.maxSize=Se.maxSize>1e3?1e3:Se.maxSize,H.reportConfig.maxInterval=Se.maxInterval>1e4?1e4:Se.maxInterval,H.reportConfig.maxInterval=Se.maxInterval<10?10:Se.maxInterval,H.reportConfig.minInterval=Se.minInterval<2?2:Se.minInterval,H.reportConfig.maxDelay=Se.maxDelay||300,H.reportConfig.maxInterval=1e3*H.reportConfig.maxInterval,H.reportConfig.minInterval=1e3*H.reportConfig.minInterval,H.reportConfig.maxDelay=1e3*H.reportConfig.maxDelay,Se.endpoint?H.dataReportEndpoint=Se.endpoint:H.dataReportEndpoint=W[ee],H.serverAllowUpload=!0,H.loading=!1,H.reportHeartBeat()}else Q.status===200&&(H.initConfigLoaded=!0);(nt=(ze=H.reportConfig)===null||ze===void 0?void 0:ze.logger)===null||nt===void 0||nt.log("Get reporter upload config success")}}).catch(function(Q){var ze,nt;H.isDestroyed||(H.loading=!1,(nt=(ze=H.reportConfig)===null||ze===void 0?void 0:ze.logger)===null||nt===void 0||nt.error("Get reporter upload config failed",Q),H.reqRetryCount<h&&(H.reqRetryCount++,or(function(){H.isDestroyed||H.initUploadConfig()},g)))});case 5:ye.next=14;break;case 7:if(ye.prev=7,ye.t0=ye.catch(2),!H.isDestroyed){ye.next=11;break}return ye.abrupt("return",{v:void 0});case 11:H.loading=!1,(N=(A=H.reportConfig)===null||A===void 0?void 0:A.logger)===null||N===void 0||N.error("Exec reporter request failed",ye.t0),H.reqRetryCount<h&&(H.reqRetryCount++,or(function(){H.isDestroyed||H.initUploadConfig()},g));case 14:case"end":return ye.stop()}},re,null,[[2,7]])}),ie=0;case 7:if(!(ie<W.length)){w.next=17;break}return w.delegateYield(U(ie),"t0",9);case 9:if((te=w.t0)!=="break"){w.next=12;break}return w.abrupt("break",17);case 12:if(t(te)!=="object"){w.next=14;break}return w.abrupt("return",te.v);case 14:ie++,w.next=7;break;case 17:case"end":return w.stop()}},F,this)}))}},{key:"reportHeartBeat",value:function(){var A=this;this.isDestroyed||(this.timer=or(function(){A.reportHeartBeat()},this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function(){if(!this.isDestroyed){var A=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Dt()-this.lastReportTime>=A&&this.upload()}}},{key:"getUploadMsg",value:function(){var A,N,F,j,W,U,ie=this,te={},H=Dt();this.highPriorityMsgList=at(A=this.highPriorityMsgList).call(A,function(Se){return H-Se.createTime<ie.reportConfig.maxDelay}),this.msgList=at(N=this.msgList).call(N,function(Se){return H-Se.createTime<ie.reportConfig.maxDelay}),this.lowPriorityMsgList=at(F=this.lowPriorityMsgList).call(F,function(Se){return H-Se.createTime<ie.reportConfig.maxDelay}),this.cacheMsgList=at(j=this.cacheMsgList).call(j,function(Se){return H-Se.createTime<ie.reportConfig.maxDelay});var V=ht(W=this.highPriorityMsgList).call(W,0,this.reportConfig.maxSize);if(this.highPriorityMsgList=ht(U=this.highPriorityMsgList).call(U,V.length),V.length<this.reportConfig.maxSize){var w,Y,re=this.reportConfig.maxSize-V.length;V=dt(V).call(V,ht(w=this.msgList).call(w,0,re)),this.msgList=ht(Y=this.msgList).call(Y,re)}if(V.length<this.reportConfig.maxSize){var ee,pe,ye=this.reportConfig.maxSize-V.length;V=dt(V).call(V,ht(ee=this.lowPriorityMsgList).call(ee,0,ye)),this.lowPriorityMsgList=ht(pe=this.lowPriorityMsgList).call(pe,ye)}if(V.length<this.reportConfig.maxSize){var Q,ze,nt=this.reportConfig.maxSize-V.length;V=dt(V).call(V,ht(Q=this.cacheMsgList).call(Q,0,nt)),this.cacheMsgList=ht(ze=this.cacheMsgList).call(ze,nt)}return ae(V).call(V,function(Se){te[Se.module]?te[Se.module].push(Se.msg):te[Se.module]=[Se.msg]}),{uploadMsgArr:V,uploadMsg:te}}},{key:"upload",value:function(){var A,N,F=this;if(this.isUploadEnable&&this.serverAllowUpload&&!(this.lastReportTime&&Dt()-this.lastReportTime<this.reportConfig.minInterval)){var j=this.getUploadMsg(),W=j.uploadMsgArr,U=j.uploadMsg;if(W.length){this.lastReportTime=Dt();try{var ie,te=dt(ie="".concat(this.dataReportEndpoint,"/")).call(ie,this.dataReportPath);this.reportConfig.request(te,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:U},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch(function(H){var V,w,Y,re;F.cacheMsgList=ht(V=dt(w=F.cacheMsgList).call(w,W)).call(V,0,F.reportConfig.cacheMaxSize),(re=(Y=F.reportConfig)===null||Y===void 0?void 0:Y.logger)===null||re===void 0||re.warn("Reporter upload failed",H)})}catch(H){(N=(A=this.reportConfig)===null||A===void 0?void 0:A.logger)===null||N===void 0||N.warn("Exec reporter request failed",H)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),I}();return _}()}),Vw=Gr("Array").values,Uf=Array.prototype,Dw={DOMTokenList:!0,NodeList:!0},fi=function(a){var p=a.values;return a===Uf||ge(Uf,a)&&p===Uf.values||Ct(Dw,no(a))?Vw:p},Uw=Rh.indexOf,Ff=$([].indexOf),eS=!!Ff&&1/Ff([1],1,-0)<0,Fw=ta("indexOf");je({target:"Array",proto:!0,forced:eS||!Fw},{indexOf:function(p){var l=arguments.length>1?arguments[1]:void 0;return eS?Ff(this,p,l)||0:Uw(this,p,l)}});var Bw=Gr("Array").indexOf,Bf=Array.prototype,wt=function(a){var p=a.indexOf;return a===Bf||ge(Bf,a)&&p===Bf.indexOf?Bw:p},qw=ms.every,Gw=ta("every");je({target:"Array",proto:!0,forced:!Gw},{every:function(p){return qw(this,p,arguments.length>1?arguments[1]:void 0)}});var jw=Gr("Array").every,qf=Array.prototype,Md=function(a){var p=a.every;return a===qf||ge(qf,a)&&p===qf.every?jw:p},tS=b(function(){if(typeof ArrayBuffer=="function"){var a=new ArrayBuffer(8);Object.isExtensible(a)&&Object.defineProperty(a,"a",{value:8})}}),Td=Object.isExtensible,Gf=b(function(){Td(1)})||tS?function(p){return!!Ce(p)&&(!tS||ut(p)!="ArrayBuffer")&&(!Td||Td(p))}:Td,Hw=!b(function(){return Object.isExtensible(Object.preventExtensions({}))}),rS=m(function(a){var p=$n.f,l=!1,t=_n("meta"),e=0,r=function(o){p(o,t,{value:{objectID:"O"+e++,weakData:{}}})},i=a.exports={enable:function(){i.enable=function(){},l=!0;var o=dl.f,u=$([].splice),h={};h[t]=1,o(h).length&&(dl.f=function(g){for(var v=o(g),_=0,I=v.length;_<I;_++)if(v[_]===t){u(v,_,1);break}return v},je({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:If.f}))},fastKey:function(o,u){if(!Ce(o))return typeof o=="symbol"?o:(typeof o=="string"?"S":"P")+o;if(!Ct(o,t)){if(!Gf(o))return"F";if(!u)return"E";r(o)}return o[t].objectID},getWeakData:function(o,u){if(!Ct(o,t)){if(!Gf(o))return!0;if(!u)return!1;r(o)}return o[t].weakData},onFreeze:function(o){return Hw&&l&&Gf(o)&&!Ct(o,t)&&r(o),o}};Ha[t]=!0}),$w=$n.f,Kw=ms.forEach,Yw=hi.set,Ww=hi.getterFor,nS=function(a,p,l){var t,e=a.indexOf("Map")!==-1,r=a.indexOf("Weak")!==-1,i=e?"set":"add",o=E[a],u=o&&o.prototype,h={};if(le&&Z(o)&&(r||u.forEach&&!b(function(){new o().entries().next()}))){var g=(t=p(function(_,I){Yw(Xh(_,g),{type:a,collection:new o}),I!=null&&rr(I,_[i],{that:_,AS_ENTRIES:e})})).prototype,v=Ww(a);Kw(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(_){var I=_=="add"||_=="set";!(_ in u)||r&&_=="clear"||Mn(g,_,function(C,A){var N=v(this).collection;if(!I&&r&&!Ce(C))return _=="get"&&void 0;var F=N[_](C===0?0:C,A);return I?this:F})}),r||$w(g,"size",{configurable:!0,get:function(){return v(this).collection.size}})}else t=l.getConstructor(p,a,e,i),rS.enable();return Zo(t,a,!1,!0),h[a]=t,je({global:!0,forced:!0},h),r||l.setStrong(t,a,e),t},iS=function(a,p,l){for(var t in p)ro(a,t,p[t],l);return a},Jw=$n.f,sS=rS.fastKey,oS=hi.set,jf=hi.getterFor,aS={getConstructor:function(a,p,l,t){var e=a(function(h,g){Xh(h,r),oS(h,{type:p,index:pi(null),first:void 0,last:void 0,size:0}),le||(h.size=0),yt(g)||rr(g,h[t],{that:h,AS_ENTRIES:l})}),r=e.prototype,i=jf(p),o=function(h,g,v){var _,I,C=i(h),A=u(h,g);return A?A.value=v:(C.last=A={index:I=sS(g,!0),key:g,value:v,previous:_=C.last,next:void 0,removed:!1},C.first||(C.first=A),_&&(_.next=A),le?C.size++:h.size++,I!=="F"&&(C.index[I]=A)),h},u=function(h,g){var v,_=i(h),I=sS(g);if(I!=="F")return _.index[I];for(v=_.first;v;v=v.next)if(v.key==g)return v};return iS(r,{clear:function(){for(var g=i(this),v=g.index,_=g.first;_;)_.removed=!0,_.previous&&(_.previous=_.previous.next=void 0),delete v[_.index],_=_.next;g.first=g.last=void 0,le?g.size=0:this.size=0},delete:function(h){var g=this,v=i(g),_=u(g,h);if(_){var I=_.next,C=_.previous;delete v.index[_.index],_.removed=!0,C&&(C.next=I),I&&(I.previous=C),v.first==_&&(v.first=I),v.last==_&&(v.last=C),le?v.size--:g.size--}return!!_},forEach:function(g){for(var v,_=i(this),I=Yr(g,arguments.length>1?arguments[1]:void 0);v=v?v.next:_.first;)for(I(v.value,v.key,this);v&&v.removed;)v=v.previous},has:function(g){return!!u(this,g)}}),iS(r,l?{get:function(g){var v=u(this,g);return v&&v.value},set:function(g,v){return o(this,g===0?0:g,v)}}:{add:function(g){return o(this,g=g===0?0:g,g)}}),le&&Jw(r,"size",{get:function(){return i(this).size}}),e},setStrong:function(a,p,l){var t=p+" Iterator",e=jf(p),r=jf(t);Bh(a,p,function(i,o){oS(this,{type:t,target:i,state:e(i),kind:o,last:void 0})},function(){for(var i=r(this),o=i.kind,u=i.last;u&&u.removed;)u=u.previous;return i.target&&(i.last=u=u?u.next:i.state.first)?o=="keys"?{value:u.key,done:!1}:o=="values"?{value:u.value,done:!1}:{value:[u.key,u.value],done:!1}:(i.target=void 0,{value:void 0,done:!0})},l?"entries":"values",!l,!0),KT(p)}};nS("Map",function(a){return function(){return a(this,arguments.length?arguments[0]:void 0)}},aS);var Qw=we.Map,cS=[].push,lS=function(p){var l,t,e,r,i=arguments.length,o=i>1?arguments[1]:void 0;return fd(this),(l=o!==void 0)&&Ge(o),yt(p)?new this:(t=[],l?(e=0,r=Yr(o,i>2?arguments[2]:void 0),rr(p,function(u){oe(cS,t,r(u,e++))})):rr(p,cS,{that:t}),new this(t))};je({target:"Map",stat:!0,forced:!0},{from:lS});var uS=function(){return new this(eo(arguments))};je({target:"Map",stat:!0,forced:!0},{of:uS});var dS=function(){for(var p,l=Pt(this),t=Ge(l.delete),e=!0,r=0,i=arguments.length;r<i;r++)p=oe(t,l,arguments[r]),e=e&&p;return!!e};je({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:dS}),je({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(p,l){var t,e,r=Pt(this),i=Ge(r.get),o=Ge(r.has),u=Ge(r.set);return oe(o,r,p)?(t=oe(i,r,p),"update"in l&&(t=l.update(t,p,r),oe(u,r,p,t)),t):(e=l.insert(p,r),oe(u,r,p,e),e)}});var Ji=Wa;je({target:"Map",proto:!0,real:!0,forced:!0},{every:function(p){var l=Pt(this),t=Ji(l),e=Yr(p,arguments.length>1?arguments[1]:void 0);return!rr(t,function(r,i,o){if(!e(i,r,l))return o()},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),je({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(p){var l=Pt(this),t=Ji(l),e=Yr(p,arguments.length>1?arguments[1]:void 0),r=new(ki(l,ue("Map"))),i=Ge(r.set);return rr(t,function(o,u){e(u,o,l)&&oe(i,r,o,u)},{AS_ENTRIES:!0,IS_ITERATOR:!0}),r}}),je({target:"Map",proto:!0,real:!0,forced:!0},{find:function(p){var l=Pt(this),t=Ji(l),e=Yr(p,arguments.length>1?arguments[1]:void 0);return rr(t,function(r,i,o){if(e(i,r,l))return o(i)},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),je({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(p){var l=Pt(this),t=Ji(l),e=Yr(p,arguments.length>1?arguments[1]:void 0);return rr(t,function(r,i,o){if(e(i,r,l))return o(r)},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var zw=$([].push);je({target:"Map",stat:!0,forced:!0},{groupBy:function(p,l){Ge(l);var t=Wa(p),e=new this,r=Ge(e.has),i=Ge(e.get),o=Ge(e.set);return rr(t,function(u){var h=l(u);oe(r,e,h)?zw(oe(i,e,h),u):oe(o,e,h,[u])},{IS_ITERATOR:!0}),e}}),je({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(p){return rr(Ji(Pt(this)),function(l,t,e){if((r=t)===(i=p)||r!=r&&i!=i)return e();var r,i},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),je({target:"Map",stat:!0,forced:!0},{keyBy:function(p,l){var t=new this;Ge(l);var e=Ge(t.set);return rr(p,function(r){oe(e,t,l(r),r)}),t}}),je({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(p){return rr(Ji(Pt(this)),function(l,t,e){if(t===p)return e(l)},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),je({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(p){var l=Pt(this),t=Ji(l),e=Yr(p,arguments.length>1?arguments[1]:void 0),r=new(ki(l,ue("Map"))),i=Ge(r.set);return rr(t,function(o,u){oe(i,r,e(u,o,l),u)},{AS_ENTRIES:!0,IS_ITERATOR:!0}),r}}),je({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(p){var l=Pt(this),t=Ji(l),e=Yr(p,arguments.length>1?arguments[1]:void 0),r=new(ki(l,ue("Map"))),i=Ge(r.set);return rr(t,function(o,u){oe(i,r,o,e(u,o,l))},{AS_ENTRIES:!0,IS_ITERATOR:!0}),r}}),je({target:"Map",proto:!0,real:!0,forced:!0},{merge:function(p){for(var l=Pt(this),t=Ge(l.set),e=arguments.length,r=0;r<e;)rr(arguments[r++],t,{that:l,AS_ENTRIES:!0});return l}});var Xw=TypeError;je({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(p){var l=Pt(this),t=Ji(l),e=arguments.length<2,r=e?void 0:arguments[1];if(Ge(p),rr(t,function(i,o){e?(e=!1,r=o):r=p(r,o,i,l)},{AS_ENTRIES:!0,IS_ITERATOR:!0}),e)throw Xw("Reduce of empty map with no initial value");return r}}),je({target:"Map",proto:!0,real:!0,forced:!0},{some:function(p){var l=Pt(this),t=Ji(l),e=Yr(p,arguments.length>1?arguments[1]:void 0);return rr(t,function(r,i,o){if(e(i,r,l))return o()},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Zw=TypeError;je({target:"Map",proto:!0,real:!0,forced:!0},{update:function(p,l){var t=Pt(this),e=Ge(t.get),r=Ge(t.has),i=Ge(t.set),o=arguments.length;Ge(l);var u=oe(r,t,p);if(!u&&o<3)throw Zw("Updating absent value");var h=u?oe(e,t,p):Ge(o>2?arguments[2]:void 0)(p,t);return oe(i,t,p,l(h,p,t)),t}});var ex=TypeError,pS=function(p,l){var t,e=Pt(this),r=Ge(e.get),i=Ge(e.has),o=Ge(e.set),u=arguments.length>2?arguments[2]:void 0;if(!Z(l)&&!Z(u))throw ex("At least one callback required");return oe(i,e,p)?(t=oe(r,e,p),Z(l)&&(t=l(t),oe(o,e,p,t))):Z(u)&&(t=u(),oe(o,e,p,t)),t};je({target:"Map",proto:!0,real:!0,forced:!0},{upsert:pS}),je({target:"Map",proto:!0,real:!0,forced:!0},{updateOrInsert:pS});var Dr=Qw,tx=m(function(a){function p(l){var t;return a.exports=p=ps?et(t=wi).call(t):function(r){return r.__proto__||wi(r)},a.exports.__esModule=!0,a.exports.default=a.exports,p(l)}a.exports=p,a.exports.__esModule=!0,a.exports.default=a.exports}),rx=m(function(a){a.exports=function(l){var t;return wt(t=Function.toString.call(l)).call(t,"[native code]")!==-1},a.exports.__esModule=!0,a.exports.default=a.exports}),Hf=ue("Reflect","construct"),nx=Object.prototype,ix=[].push,hS=b(function(){function a(){}return!(Hf(function(){},[],a)instanceof a)}),fS=!b(function(){Hf(function(){})}),mS=hS||fS;je({target:"Reflect",stat:!0,forced:mS,sham:mS},{construct:function(p,l){fd(p),Pt(l);var t=arguments.length<3?p:fd(arguments[2]);if(fS&&!hS)return Hf(p,l,t);if(p==t){switch(l.length){case 0:return new p;case 1:return new p(l[0]);case 2:return new p(l[0],l[1]);case 3:return new p(l[0],l[1],l[2]);case 4:return new p(l[0],l[1],l[2],l[3])}var e=[null];return D(ix,e,l),new(D(wh,p,e))}var r=t.prototype,i=pi(Ce(r)?r:nx),o=D(p,i,l);return Ce(o)?o:i}});var ys=we.Reflect.construct,sx=m(function(a){a.exports=function(){if(typeof Reflect>"u"||!ys||ys.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(ys(Boolean,[],function(){})),!0}catch{return!1}},a.exports.__esModule=!0,a.exports.default=a.exports}),ox=m(function(a){function p(l,t,e){var r;return sx()?(a.exports=p=et(r=ys).call(r),a.exports.__esModule=!0,a.exports.default=a.exports):(a.exports=p=function(o,u,h){var g=[null];g.push.apply(g,u);var v=new(et(Function).apply(o,g));return h&&Ph(v,h.prototype),v},a.exports.__esModule=!0,a.exports.default=a.exports),p.apply(null,arguments)}a.exports=p,a.exports.__esModule=!0,a.exports.default=a.exports}),ax=m(function(a){function p(l){var t=typeof Dr=="function"?new Dr:void 0;return a.exports=p=function(r){if(r===null||!rx(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(r))return t.get(r);t.set(r,i)}function i(){return ox(r,arguments,tx(this).constructor)}return i.prototype=Ri(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Ph(i,r)},a.exports.__esModule=!0,a.exports.default=a.exports,p(l)}a.exports=p,a.exports.__esModule=!0,a.exports.default=a.exports}),gS=f(ax),cx=TypeError,lx=function(a){return function(p,l,t,e){Ge(l);var r=Er(p),i=Xe(r),o=di(r),u=a?o-1:0,h=a?-1:1;if(t<2)for(;;){if(u in i){e=i[u],u+=h;break}if(u+=h,a?u<0:o<=u)throw cx("Reduce of empty array with no initial value")}for(;a?u>=0:o>u;u+=h)u in i&&(e=l(e,i[u],u,r));return e}},ux={left:lx(!1)}.left,dx=ta("reduce");je({target:"Array",proto:!0,forced:!dx||!Yi&&de>79&&de<83},{reduce:function(p){var l=arguments.length;return ux(this,p,l,l>1?arguments[1]:void 0)}});var $f,Kf,Yf,Wf,Jf,Qf,zf,Xf,Zf,em,tm,rm,nm,im,sm,om,am,cm,lm,um,dm,pm,hm,fm,mm,gm,vm,ym,_m,Mm,Tm,Im,Sm,Em,Cm,bm,Am,Rm,Nm,km,Om,wm,xm,Pm,Lm,Vm,Dm,Um,Fm,Bm,qm,Gm,jm,px=Gr("Array").reduce,Hm=Array.prototype,Cr=function(a){var p=a.reduce;return a===Hm||ge(Hm,a)&&p===Hm.reduce?px:p};(function(a){a[a.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",a[a.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC"})($f||($f={})),function(a){a[a.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",a[a.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",a[a.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(Kf||(Kf={})),function(a){a[a.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",a[a.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",a[a.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(Yf||(Yf={})),function(a){a[a.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",a[a.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",a[a.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",a[a.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(Wf||(Wf={})),function(a){a[a.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",a[a.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",a[a.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(Jf||(Jf={})),function(a){a[a.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",a[a.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(Qf||(Qf={})),function(a){a[a.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",a[a.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(zf||(zf={})),function(a){a[a.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",a[a.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",a[a.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",a[a.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",a[a.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(Xf||(Xf={})),function(a){a[a.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",a[a.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(Zf||(Zf={})),function(a){a[a.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",a[a.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",a[a.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",a[a.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(em||(em={})),function(a){a[a.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",a[a.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",a[a.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(tm||(tm={})),function(a){a[a.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",a[a.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",a[a.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",a[a.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(rm||(rm={})),function(a){a[a.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",a[a.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",a[a.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",a[a.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",a[a.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",a[a.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",a[a.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",a[a.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",a[a.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(nm||(nm={})),function(a){a[a.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",a[a.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",a[a.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",a[a.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(im||(im={})),function(a){a[a.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",a[a.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",a[a.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(sm||(sm={})),function(a){a[a.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",a[a.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",a[a.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",a[a.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(om||(om={})),function(a){a[a.NIM_MESSAGE_AI_STREAM_STATUS_STREAMING=-1]="NIM_MESSAGE_AI_STREAM_STATUS_STREAMING",a[a.NIM_MESSAGE_AI_STREAM_STATUS_NONE=0]="NIM_MESSAGE_AI_STREAM_STATUS_NONE",a[a.NIM_MESSAGE_AI_STREAM_STATUS_PLACEHOLDER=1]="NIM_MESSAGE_AI_STREAM_STATUS_PLACEHOLDER",a[a.NIM_MESSAGE_AI_STREAM_STATUS_CANCEL=2]="NIM_MESSAGE_AI_STREAM_STATUS_CANCEL",a[a.NIM_MESSAGE_AI_STREAM_STATUS_UPDATE=3]="NIM_MESSAGE_AI_STREAM_STATUS_UPDATE",a[a.NIM_MESSAGE_AI_STREAM_STATUS_COMPLETE=4]="NIM_MESSAGE_AI_STREAM_STATUS_COMPLETE",a[a.NIM_MESSAGE_AI_STREAM_STATUS_EXCEPTION=5]="NIM_MESSAGE_AI_STREAM_STATUS_EXCEPTION"}(am||(am={})),function(a){a[a.V2NIM_MESSAGE_AI_STREAM_STOP_OP_DEFAULT=0]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_DEFAULT",a[a.V2NIM_MESSAGE_AI_STREAM_STOP_OP_REVOKE=1]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_REVOKE",a[a.V2NIM_MESSAGE_AI_STREAM_STOP_OP_UPDATE=2]="V2NIM_MESSAGE_AI_STREAM_STOP_OP_UPDATE"}(cm||(cm={})),function(a){a[a.V2NIM_MESSAGE_AI_REGEN_OP_UPDATE=1]="V2NIM_MESSAGE_AI_REGEN_OP_UPDATE",a[a.V2NIM_MESSAGE_AI_REGEN_OP_NEW=2]="V2NIM_MESSAGE_AI_REGEN_OP_NEW"}(lm||(lm={})),function(a){a[a.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",a[a.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",a[a.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}(um||(um={})),function(a){a[a.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",a[a.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",a[a.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",a[a.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",a[a.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",a[a.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",a[a.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",a[a.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",a[a.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",a[a.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",a[a.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",a[a.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",a[a.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(dm||(dm={})),function(a){a[a.V2NIM_SEARCH_KEYWORD_MATCH_TYPE_OR=0]="V2NIM_SEARCH_KEYWORD_MATCH_TYPE_OR",a[a.V2NIM_SEARCH_KEYWORD_MATCH_TYPE_AND=1]="V2NIM_SEARCH_KEYWORD_MATCH_TYPE_AND"}(pm||(pm={})),function(a){a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",a[a.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(hm||(hm={})),function(a){a[a.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",a[a.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",a[a.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",a[a.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(fm||(fm={})),function(a){a[a.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",a[a.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",a[a.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",a[a.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(mm||(mm={})),function(a){a[a.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",a[a.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(gm||(gm={})),function(a){a[a.V2NIM_CLEAR_HISTORY_MODE_ALL=0]="V2NIM_CLEAR_HISTORY_MODE_ALL",a[a.V2NIM_CLEAR_HISTORY_MODE_LOCAL=1]="V2NIM_CLEAR_HISTORY_MODE_LOCAL"}(vm||(vm={})),function(a){a[a.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",a[a.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",a[a.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",a[a.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",a[a.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",a[a.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(ym||(ym={})),function(a){a[a.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",a[a.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",a[a.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(_m||(_m={})),function(a){a[a.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",a[a.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(Mm||(Mm={})),function(a){a[a.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",a[a.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",a[a.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",a[a.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(Tm||(Tm={})),function(a){a[a.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",a[a.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(Im||(Im={})),function(a){a[a.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",a[a.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",a[a.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",a[a.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",a[a.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",a[a.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",a[a.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",a[a.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(Sm||(Sm={})),function(a){a[a.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",a[a.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",a[a.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(Em||(Em={})),function(a){a[a.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",a[a.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(Cm||(Cm={})),function(a){a[a.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",a[a.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",a[a.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(bm||(bm={})),function(a){a[a.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",a[a.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",a[a.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(Am||(Am={})),function(a){a[a.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",a[a.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",a[a.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(Rm||(Rm={})),function(a){a[a.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",a[a.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(Nm||(Nm={})),function(a){a[a.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",a[a.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(km||(km={})),function(a){a[a.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",a[a.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(Om||(Om={})),function(a){a[a.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",a[a.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",a[a.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=3]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(wm||(wm={})),function(a){a[a.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",a[a.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(xm||(xm={})),function(a){a[a.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",a[a.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",a[a.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(Pm||(Pm={})),function(a){a[a.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",a[a.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",a[a.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",a[a.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(Lm||(Lm={})),function(a){a[a.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",a[a.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",a[a.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",a[a.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(Vm||(Vm={})),function(a){a[a.teamApply=0]="teamApply",a[a.teamApplyReject=1]="teamApplyReject",a[a.teamInvite=2]="teamInvite",a[a.teamInviteReject=3]="teamInviteReject",a[a.tlistUpdate=4]="tlistUpdate",a[a.superTeamApply=15]="superTeamApply",a[a.superTeamApplyReject=16]="superTeamApplyReject",a[a.superTeamInvite=17]="superTeamInvite",a[a.superTeamInviteReject=18]="superTeamInviteReject"}(Dm||(Dm={})),function(a){a[a.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",a[a.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",a[a.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",a[a.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}(Um||(Um={})),function(a){a[a.V2NIM_AI_MODEL_STREAM_CALL_STATUS_NONE=0]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_NONE",a[a.V2NIM_AI_MODEL_STREAM_CALL_STATUS_CANCEL=2]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_CANCEL",a[a.V2NIM_AI_MODEL_STREAM_CALL_STATUS_COMPLETE=4]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_COMPLETE",a[a.V2NIM_AI_MODEL_STREAM_CALL_STATUS_EXCEPTION=5]="V2NIM_AI_MODEL_STREAM_CALL_STATUS_EXCEPTION"}(Fm||(Fm={})),function(a){a.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",a.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",a.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}(Bm||(Bm={})),function(a){a[a.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",a[a.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",a[a.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",a[a.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",a[a.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",a[a.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",a[a.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",a[a.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",a[a.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL"}(qm||(qm={})),function(a){a[a.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",a[a.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",a[a.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(Gm||(Gm={})),function(a){a[a.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",a[a.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",a[a.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",a[a.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(jm||(jm={}));var $m={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation faileduse open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_IS_NOT_STICK_TOP:{code:110305,message:"conversation is not stick top"},V2NIM_ERROR_CODE_STICK_TOP_DISABLED:{code:110306,message:"conversation stick top disabled"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"},V2NIM_ERROR_CODE_STREAM_OUTPUT_STOPPED:{code:189318,message:"Streaming text response stopped"},V2NIM_ERROR_CODE_STREAM_OUTPUT_GENERATED:{code:189319,message:"Streaming text response generated"},V2NIM_ERROR_CODE_STREAM_OUTPUT_ABORTED:{code:189320,message:"Streaming text response aborted due to exception"},V2NIM_ERROR_CODE_INTERRUPTION_REJECTED:{code:189321,message:"Non-streaming messages cannot be interrupted"}},Id=pt($m),ce=Cr(Id).call(Id,function(a,p){var l=$m[p];return a[p]=l.code,a},{}),Km=Cr(Id).call(Id,function(a,p){var l=$m[p];return a[l.code]=l.message,a},{}),hx=Object.freeze({__proto__:null,V2NIMErrorCode:ce,V2NIMErrorDesc:Km,get V2NIMDataSyncLevel(){return $f},get V2NIMDataSyncType(){return Kf},get V2NIMDataSyncState(){return Yf},get V2NIMConversationType(){return Wf},get V2NIMLastMessageState(){return Jf},get V2NIMFriendAddMode(){return Qf},get V2NIMFriendAddApplicationType(){return zf},get V2NIMFriendAddApplicationStatus(){return Xf},get V2NIMFriendDeletionType(){return Zf},get V2NIMFriendVerifyType(){return em},get V2NIMLoginAuthType(){return tm},get V2NIMLoginStatus(){return rm},get V2NIMLoginClientType(){return nm},get V2NIMKickedOfflineReason(){return im},get V2NIMLoginClientChange(){return sm},get V2NIMConnectStatus(){return om},get V2NIMMessageType(){return dm},get V2NIMMessageNotificationType(){return hm},get V2NIMMessageAttachmentUploadState(){return fm},get V2NIMMessageSendingState(){return mm},get V2NIMQueryDirection(){return gm},get V2NIMMessageRevokeType(){return ym},get V2NIMMessagePinState(){return _m},get V2NIMMessageQuickCommentType(){return Mm},get V2NIMClientAntispamOperateType(){return Tm},get V2NIMSortOrder(){return Im},get V2NIMSystemMessageType(){return Sm},get V2NIMMessageAIStreamStatus(){return am},get V2NIMMessageAIStreamStopOpType(){return cm},get V2NIMMessageAIRegenOpType(){return lm},get V2NIMMessageAIStatus(){return um},get V2NIMSearchKeywordMatchType(){return pm},get V2NIMClearHistoryMode(){return vm},get V2NIMTeamMessageMuteMode(){return Em},get V2NIMP2PMessageMuteMode(){return Cm},get V2NIMTeamMemberRoleQueryType(){return bm},get V2NIMTeamType(){return Am},get V2NIMTeamJoinMode(){return Rm},get V2NIMTeamAgreeMode(){return Nm},get V2NIMTeamInviteMode(){return km},get V2NIMTeamUpdateInfoMode(){return Om},get V2NIMTeamChatBannedMode(){return wm},get V2NIMTeamUpdateExtensionMode(){return xm},get V2NIMTeamJoinActionType(){return Lm},get V2NIMTeamJoinActionStatus(){return Vm},get V2NIMTeamNotificationType(){return Dm},get V2NIMTeamMemberRole(){return Pm},get V2NIMAIModelRoleType(){return Bm},get V2NIMAIModelType(){return Um},get V2NIMAIModelStreamCallStatus(){return Fm},get V2NIMSignallingChannelType(){return Gm},get V2NIMSignallingEventType(){return qm},get V2NIMUserStatusType(){return jm}}),Me=function(a){function p(l){var t;return(t=a.call(this,l.desc)||this).name="V2NIMError",t.code=l.code||0,t.desc=l.desc||Km[t.code]||vS[t.code]||"",t.message=t.desc,t.detail=l.detail||{},t}return bt(p,a),p.prototype.toString=function(){var t,e=this.name+`
 code: `+this.code+`
 message: "`+this.message+`"
 detail: `+(this.detail?xe(this.detail):"");return!((t=this==null?void 0:this.detail)===null||t===void 0)&&t.rawError&&(e+=`
 rawError: `+this.detail.rawError.message),e},p}(gS(Error)),_s=function(a){function p(l,t,e){var r;return t===void 0&&(t={}),(r=a.call(this,{code:ce.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:l,rules:e,data:t}})||this).name="validateError",r.message=r.message+`
`+xe(r.detail,null,2),r.data=t,r.rules=e,r}return bt(p,a),p}(Me),Qi=function(a){function p(l){var t,e,r,i;return(t=a.call(this,{code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:(e=l.detail)===null||e===void 0?void 0:e.reason,rules:(r=l.detail)===null||r===void 0?void 0:r.rules,data:(i=l.detail)===null||i===void 0?void 0:i.data}})||this).name="ValidateErrorV2",t}return bt(p,a),p}(Me),Ym=function(a){function p(l,t,e){var r;return(r=a.call(this,{code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:l,key:t,rules:e}})||this).name="formatError",r}return bt(p,a),p}(Me),Ms=function(a){function p(l){var t;return(t=a.call(this,O({code:400},l))||this).desc=t.desc||"upload file error",t.message=t.desc,t.name="uploadError",t}return bt(p,a),p}(Me),Ut=function(a){function p(l,t,e){var r;return t===void 0&&(t={}),e===void 0&&(e=400),(r=a.call(this,{code:e,desc:l,detail:t})||this).name="customError",r.data=t,r}return bt(p,a),p}(Me),vS={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"};function Wm(a,p){return p=p||[],at(a=a||[]).call(a,function(l){return wt(p).call(p,l)===-1})}function yS(a,p){return p instanceof RegExp?"__REGEXP "+p.toString():p}function P(a,p,l,t){var e;p===void 0&&(p={}),t===void 0&&(t=!1);var r={};return ae(e=pt(a)).call(e,function(i){var o=a[i].type,u=l?"In "+l+", ":"";if(p==null){var h=u+"param is null or undefined";throw t?new Qi({detail:{reason:h,data:{key:i},rules:"required"}}):new _s(h,{key:i},"required")}if(p[i]===void 0){if(a[i].required===!1)return void(r[i]=p[i]);var g=u+"param '"+i+"' is required";throw t?new Qi({detail:{reason:g,data:{key:i},rules:"required"}}):new _s(g,{key:i},"required")}var v=fx[o];if(v&&!v(p,i,a[i],t)){var _=u+"param '"+i+"' unexpected",I={key:i,value:p[i]};throw t?new Qi({detail:{reason:_,data:I,rules:xe(a[i],yS)}}):new _s(_,I,xe(a[i],yS))}r[i]=p[i]}),r}var fx={string:function(p,l,t){var e=t.allowEmpty,r=t.max,i=t.min,o=t.regExp,u=p[l];return typeof u=="string"&&(e!==!1||u!=="")&&!(typeof r=="number"&&u.length>r)&&!(typeof i=="number"&&u.length<i)&&!(function(g){return Object.prototype.toString.call(g)==="[object RegExp]"}(o)&&!o.test(u))},number:function(p,l,t){var e=t.min,r=t.max,i=p[l];return typeof i=="number"&&!(typeof e=="number"&&i<e)&&!(typeof r=="number"&&i>r)},boolean:function(p,l){return typeof p[l]=="boolean"},file:function(p,l){return!0},enum:function(p,l,t){var e=fi(t),r=p[l];return!e||wt(e).call(e,r)>-1},jsonstr:function(p,l){try{var t=JSON.parse(p[l]);return typeof t=="object"&&t!==null}catch{return!1}},func:function(p,l){return typeof p[l]=="function"},array:function(p,l,t,e){e===void 0&&(e=!1);var r=t.itemType,i=t.itemRules,o=t.rules,u=t.min,h=t.max,g=fi(t),v=p[l];if(!qt(v)||typeof h=="number"&&v.length>h||typeof u=="number"&&v.length<u)return!1;if(i)ae(v).call(v,function(_,I){var C,A;P(((C={})[I]=i,C),((A={})[I]=_,A),l+"["+I+"]",e)});else if(o)ae(v).call(v,function(_,I){return P(o,_,l+"["+I+"]",e)});else if(r==="enum"){if(g&&Wm(v,g).length)return!1}else if(r&&!Md(v).call(v,function(_){return typeof _===r}))return!1;return!0},object:function(p,l,t,e){e===void 0&&(e=!1);var r=t.rules,i=t.allowEmpty,o=p[l];if(typeof o!="object"||o===null)return!1;if(r){var u=pt(r),h=pt(o),g=at(h).call(h,function(v){return wt(u).call(u,v)>-1});if(i===!1&&g.length===0)return!1;P(r,o,l,e)}return!0}};function Nr(a,p){if(!a)throw new Me({code:ce.V2NIM_ERROR_CODE_ILLEGAL_STATE});P({conversationId:{type:"string",allowEmpty:!1,regExp:new RegExp("^"+a+"\\|[1-3]\\|")}},{conversationId:p},"",!0)}var mx=function(a,p,l,t){try{return t?p(Pt(l)[0],l[1]):p(l)}catch(e){Jh(a,"throw",e)}},_S=Array,gx=!SI(function(a){Array.from(a)});je({target:"Array",stat:!0,forced:gx},{from:function(p){var l=Er(p),t=cd(this),e=arguments.length,r=e>1?arguments[1]:void 0,i=r!==void 0;i&&(r=Yr(r,e>2?arguments[2]:void 0));var o,u,h,g,v,_,I=dd(l),C=0;if(!I||this===_S&&GT(I))for(o=di(l),u=t?new this(o):_S(o);o>C;C++)_=i?r(l[C],C):l[C],ra(u,C,_);else for(v=(g=Wa(l,I)).next,u=t?new this:[];!(h=oe(v,g)).done;C++)_=i?mx(g,r,[h.value,C],!0):h.value,ra(u,C,_);return u.length=C,u}});var vr=we.Array.from,Yn=dd;function MS(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return TS(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?TS(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TS(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}var IS=function(){function a(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}var p=a.prototype;return p.addTimer=function(t,e,r){e===void 0&&(e=0),r===void 0&&(r=1);var i=new Date().getTime(),o=this.id;return this.timerList.push({id:o,loop:r,count:0,timeout:i+e,interval:e,callback:t}),this.id++,this.checkTimer(i),o},p.checkTimer=function(t){if(t===void 0&&(t=new Date().getTime()),this.removeFinished(),this.timerList.length!==0||this.timer==null){for(var e,r,i=0,o=MS(this.timerList);!(e=o()).done;){var u=e.value;(i===0||i>u.timeout)&&(i=u.timeout)}this.timerList.length!==0&&(this.timer===null||i<this.timeout||this.timeout<t)&&(this.timer=or(et(r=this.nowTime).call(r,this),i-t),this.timeout=i)}},p.nowTime=function(){for(var t,e=new Date().getTime(),r=MS(this.timerList);!(t=r()).done;){var i=t.value;e>=i.timeout&&(i.callback(),i.count++,i.timeout=e+i.interval)}this.clerTime(),this.checkTimer(e)},p.clerTime=function(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)},p.deleteTimer=function(t){for(var e=this.timerList.length-1;e>=0;e--){var r;this.timerList[e].id===t&&wn(r=this.timerList).call(r,e,1)}},p.removeFinished=function(){for(var t=this.timerList.length-1;t>=0;t--){var e,r=this.timerList[t];r.loop>=0&&r.count>=r.loop&&wn(e=this.timerList).call(e,t,1)}},p.destroy=function(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null},a}(),vx=m(function(a){function p(l){return a.exports=p=typeof gr=="function"&&typeof xf=="symbol"?function(t){return typeof t}:function(t){return t&&typeof gr=="function"&&t.constructor===gr&&t!==gr.prototype?"symbol":typeof t},a.exports.__esModule=!0,a.exports.default=a.exports,p(l)}a.exports=p,a.exports.__esModule=!0,a.exports.default=a.exports}),yx=m(function(a){var p=vx.default;function l(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */a.exports=l=function(){return t},a.exports.__esModule=!0,a.exports.default=a.exports;var t={},e=Object.prototype,r=e.hasOwnProperty,i=typeof gr=="function"?gr:{},o=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",h=i.toStringTag||"@@toStringTag";function g(ee,pe,ye){return Zs(ee,pe,{value:ye,enumerable:!0,configurable:!0,writable:!0}),ee[pe]}try{g({},"")}catch{g=function(ye,Q,ze){return ye[Q]=ze}}function v(ee,pe,ye,Q){var ze=pe&&pe.prototype instanceof C?pe:C,nt=Ri(ze.prototype),Se=new w(Q||[]);return nt._invoke=function(vt,ar,At){var Ie="suspendedStart";return function(Oe,mt){if(Ie==="executing")throw new Error("Generator is already running");if(Ie==="completed"){if(Oe==="throw")throw mt;return re()}for(At.method=Oe,At.arg=mt;;){var Je=At.delegate;if(Je){var Lt=te(Je,At);if(Lt){if(Lt===I)continue;return Lt}}if(At.method==="next")At.sent=At._sent=At.arg;else if(At.method==="throw"){if(Ie==="suspendedStart")throw Ie="completed",At.arg;At.dispatchException(At.arg)}else At.method==="return"&&At.abrupt("return",At.arg);Ie="executing";var Et=_(vt,ar,At);if(Et.type==="normal"){if(Ie=At.done?"completed":"suspendedYield",Et.arg===I)continue;return{value:Et.arg,done:At.done}}Et.type==="throw"&&(Ie="completed",At.method="throw",At.arg=Et.arg)}}}(ee,ye,Se),nt}function _(ee,pe,ye){try{return{type:"normal",arg:ee.call(pe,ye)}}catch(Q){return{type:"throw",arg:Q}}}t.wrap=v;var I={};function C(){}function A(){}function N(){}var F={};g(F,o,function(){return this});var j=wi&&wi(wi(Y([])));j&&j!==e&&r.call(j,o)&&(F=j);var W=N.prototype=C.prototype=Ri(F);function U(ee){var pe;ae(pe=["next","throw","return"]).call(pe,function(ye){g(ee,ye,function(Q){return this._invoke(ye,Q)})})}function ie(ee,pe){function ye(ze,nt,Se,vt){var ar=_(ee[ze],ee,nt);if(ar.type!=="throw"){var At=ar.arg,Ie=At.value;return Ie&&p(Ie)=="object"&&r.call(Ie,"__await")?pe.resolve(Ie.__await).then(function(Oe){ye("next",Oe,Se,vt)},function(Oe){ye("throw",Oe,Se,vt)}):pe.resolve(Ie).then(function(Oe){At.value=Oe,Se(At)},function(Oe){return ye("throw",Oe,Se,vt)})}vt(ar.arg)}var Q;this._invoke=function(ze,nt){function Se(){return new pe(function(vt,ar){ye(ze,nt,vt,ar)})}return Q=Q?Q.then(Se,Se):Se()}}function te(ee,pe){var ye=ee.iterator[pe.method];if(ye===void 0){if(pe.delegate=null,pe.method==="throw"){if(ee.iterator.return&&(pe.method="return",pe.arg=void 0,te(ee,pe),pe.method==="throw"))return I;pe.method="throw",pe.arg=new TypeError("The iterator does not provide a 'throw' method")}return I}var Q=_(ye,ee.iterator,pe.arg);if(Q.type==="throw")return pe.method="throw",pe.arg=Q.arg,pe.delegate=null,I;var ze=Q.arg;return ze?ze.done?(pe[ee.resultName]=ze.value,pe.next=ee.nextLoc,pe.method!=="return"&&(pe.method="next",pe.arg=void 0),pe.delegate=null,I):ze:(pe.method="throw",pe.arg=new TypeError("iterator result is not an object"),pe.delegate=null,I)}function H(ee){var pe={tryLoc:ee[0]};1 in ee&&(pe.catchLoc=ee[1]),2 in ee&&(pe.finallyLoc=ee[2],pe.afterLoc=ee[3]),this.tryEntries.push(pe)}function V(ee){var pe=ee.completion||{};pe.type="normal",delete pe.arg,ee.completion=pe}function w(ee){this.tryEntries=[{tryLoc:"root"}],ae(ee).call(ee,H,this),this.reset(!0)}function Y(ee){if(ee){var pe=ee[o];if(pe)return pe.call(ee);if(typeof ee.next=="function")return ee;if(!isNaN(ee.length)){var ye=-1,Q=function ze(){for(;++ye<ee.length;)if(r.call(ee,ye))return ze.value=ee[ye],ze.done=!1,ze;return ze.value=void 0,ze.done=!0,ze};return Q.next=Q}}return{next:re}}function re(){return{value:void 0,done:!0}}return A.prototype=N,g(W,"constructor",N),g(N,"constructor",A),A.displayName=g(N,h,"GeneratorFunction"),t.isGeneratorFunction=function(ee){var pe=typeof ee=="function"&&ee.constructor;return!!pe&&(pe===A||(pe.displayName||pe.name)==="GeneratorFunction")},t.mark=function(ee){return ps?ps(ee,N):(ee.__proto__=N,g(ee,h,"GeneratorFunction")),ee.prototype=Ri(W),ee},t.awrap=function(ee){return{__await:ee}},U(ie.prototype),g(ie.prototype,u,function(){return this}),t.AsyncIterator=ie,t.async=function(ee,pe,ye,Q,ze){ze===void 0&&(ze=He);var nt=new ie(v(ee,pe,ye,Q),ze);return t.isGeneratorFunction(pe)?nt:nt.next().then(function(Se){return Se.done?Se.value:nt.next()})},U(W),g(W,h,"Generator"),g(W,o,function(){return this}),g(W,"toString",function(){return"[object Generator]"}),t.keys=function(ee){var pe=[];for(var ye in ee)pe.push(ye);return Wi(pe).call(pe),function Q(){for(;pe.length;){var ze=pe.pop();if(ze in ee)return Q.value=ze,Q.done=!1,Q}return Q.done=!0,Q}},t.values=Y,w.prototype={constructor:w,reset:function(pe){var ye;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,ae(ye=this.tryEntries).call(ye,V),!pe)for(var Q in this)Q.charAt(0)==="t"&&r.call(this,Q)&&!isNaN(+ht(Q).call(Q,1))&&(this[Q]=void 0)},stop:function(){this.done=!0;var pe=this.tryEntries[0].completion;if(pe.type==="throw")throw pe.arg;return this.rval},dispatchException:function(pe){if(this.done)throw pe;var ye=this;function Q(At,Ie){return Se.type="throw",Se.arg=pe,ye.next=At,Ie&&(ye.method="next",ye.arg=void 0),!!Ie}for(var ze=this.tryEntries.length-1;ze>=0;--ze){var nt=this.tryEntries[ze],Se=nt.completion;if(nt.tryLoc==="root")return Q("end");if(nt.tryLoc<=this.prev){var vt=r.call(nt,"catchLoc"),ar=r.call(nt,"finallyLoc");if(vt&&ar){if(this.prev<nt.catchLoc)return Q(nt.catchLoc,!0);if(this.prev<nt.finallyLoc)return Q(nt.finallyLoc)}else if(vt){if(this.prev<nt.catchLoc)return Q(nt.catchLoc,!0)}else{if(!ar)throw new Error("try statement without catch or finally");if(this.prev<nt.finallyLoc)return Q(nt.finallyLoc)}}}},abrupt:function(pe,ye){for(var Q=this.tryEntries.length-1;Q>=0;--Q){var ze=this.tryEntries[Q];if(ze.tryLoc<=this.prev&&r.call(ze,"finallyLoc")&&this.prev<ze.finallyLoc){var nt=ze;break}}nt&&(pe==="break"||pe==="continue")&&nt.tryLoc<=ye&&ye<=nt.finallyLoc&&(nt=null);var Se=nt?nt.completion:{};return Se.type=pe,Se.arg=ye,nt?(this.method="next",this.next=nt.finallyLoc,I):this.complete(Se)},complete:function(pe,ye){if(pe.type==="throw")throw pe.arg;return pe.type==="break"||pe.type==="continue"?this.next=pe.arg:pe.type==="return"?(this.rval=this.arg=pe.arg,this.method="return",this.next="end"):pe.type==="normal"&&ye&&(this.next=ye),I},finish:function(pe){for(var ye=this.tryEntries.length-1;ye>=0;--ye){var Q=this.tryEntries[ye];if(Q.finallyLoc===pe)return this.complete(Q.completion,Q.afterLoc),V(Q),I}},catch:function(pe){for(var ye=this.tryEntries.length-1;ye>=0;--ye){var Q=this.tryEntries[ye];if(Q.tryLoc===pe){var ze=Q.completion;if(ze.type==="throw"){var nt=ze.arg;V(Q)}return nt}}throw new Error("illegal catch attempt")},delegateYield:function(pe,ye,Q){return this.delegate={iterator:Y(pe),resultName:ye,nextLoc:Q},this.method==="next"&&(this.arg=void 0),I}},t}a.exports=l,a.exports.__esModule=!0,a.exports.default=a.exports}),Sd=yx(),T=Sd;try{regeneratorRuntime=Sd}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=Sd:Function("r","regeneratorRuntime = r")(Sd)}function br(a,p){var l={};for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&p.indexOf(t)<0&&(l[t]=a[t]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function"){var e=0;for(t=Object.getOwnPropertySymbols(a);e<t.length;e++)p.indexOf(t[e])<0&&Object.prototype.propertyIsEnumerable.call(a,t[e])&&(l[t[e]]=a[t[e]])}return l}function k(a,p,l,t){return new(l||(l=Promise))(function(e,r){function i(h){try{u(t.next(h))}catch(g){r(g)}}function o(h){try{u(t.throw(h))}catch(g){r(g)}}function u(h){h.done?e(h.value):function(v){return v instanceof l?v:new l(function(_){_(v)})}(h.value).then(i,o)}u((t=t.apply(a,[])).next())})}function oa(a){return a!=null&&typeof a=="object"&&wi(a)==Object.prototype}function SS(a,p){var l=oa(a)||qt(a),t=oa(p)||qt(p);if(l&&t){for(var e in p){var r=SS(a[e],p[e]);r!==void 0&&(a[e]=r)}return a}return p}var We={setLogger:function(p){throw new Error("setLogger not implemented.")},platform:"",WebSocket:function(){function a(l,t){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}var p=a.prototype;return p.close=function(t,e){throw new Error("Method not implemented.")},p.send=function(t){throw new Error("Method not implemented.")},p.onclose=function(t){throw new Error("Method not implemented.")},p.onerror=function(t){throw new Error("Method not implemented.")},p.onmessage=function(t){throw new Error("Method not implemented.")},p.onopen=function(t){throw new Error("Method not implemented.")},a}(),localStorage:{},request:function(p,l){throw new Error("request not implemented.")},uploadFile:function(p){throw new Error("uploadFile not implemented.")},getSystemInfo:function(){throw new Error("getSystemInfo not implemented.")},getFileUploadInformation:function(p){throw new Error("getFileUploadInformation not implemented.")},envPayload:{},net:{getNetworkStatus:function(){return He.resolve({net_type:0,net_connect:!0})},onNetworkStatusChange:function(p){},offNetworkStatusChange:function(){}},logStorage:function(){function a(l){}var p=a.prototype;return p.open=function(){return He.resolve()},p.close=function(){},p.addLogs=function(t){return He.resolve()},p.extractLogs=function(){return He.resolve()},a}()},tc=["error","warn","log","debug"],oo=function(){},Ed=["off","error","warn","log","debug"],_x=function(){function a(l,t){t===void 0&&(t={}),this.storageArr=[],this.debugLevel="off",this.timer=0,this.strategies={debug:{name:"debg",func:console.log},log:{name:"info",func:console.log},warn:{name:"warn",func:console.warn},error:{name:"erro",func:console.error}},this.debug=oo,this.log=oo,this.warn=oo,this.error=oo,this.iid=Math.round(1e3*Math.random()),this.debugLevel=_t(Ed).call(Ed,l)?l:"off",t.debugLevel&&(this.debugLevel=_t(Ed).call(Ed,t.debugLevel)?t.debugLevel:this.debugLevel),this.logStorage=t.storageEnable===!1?null:new We.logStorage(t==null?void 0:t.storageName),this.setOptions(t),this.setLogFunc(this.debugLevel),this.setTimer(),this.open()}var p=a.prototype;return p.getDebugMode=function(){return this.debugLevel==="debug"},p.open=function(t){var e=this;this.logStorage&&this.logStorage.open(t).then(function(){e.log("Logger::open success")}).catch(function(r){e.warn("Logger::open failed",r)})},p.setOptions=function(t){if(t&&t.logFunc){var e=t.logFunc;for(var r in e){var i=r,o=e[i];o&&(this.strategies[i].func=o)}}},p.setLogFunc=function(t,e){var r=this;e===void 0&&(e="log");var i=Ni(tc).call(tc,function(u){return u===t}),o=Ni(tc).call(tc,function(u){return u===e});ae(tc).call(tc,function(u,h){r[u]=function(){if(!(h>i&&h>o)){var g=ht(Array.prototype).call(arguments),v=this.strategies[u],_=this.formatArgs(g,v.name);h<=o&&this.logStorage&&this.prepareSaveLog(_,u),h<=i&&v.func(_)}}})},p.extractLogs=function(){var t;return this.logStorage?(t=this.logStorage)===null||t===void 0?void 0:t.extractLogs():He.resolve("")},p.prepareSaveLog=function(t,e){this.storageArr.push({text:t,level:e,time:Dt(),iid:this.iid}),this.timer||this.setTimer(),this.storageArr.length>=100&&(this.triggerTimer(),this.storageArr=[])},p.saveLogs=function(){return k(this,void 0,void 0,T.mark(function t(){var e;return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.logStorage){i.next=2;break}return i.abrupt("return");case 2:return e=this.storageArr,this.storageArr=[],i.prev=4,i.next=7,this.logStorage.addLogs(e);case 7:i.next=11;break;case 9:i.prev=9,i.t0=i.catch(4);case 11:case"end":return i.stop()}},t,this,[[4,9]])}))},p.clearTimer=function(){this.timer&&clearTimeout(this.timer),this.timer=0},p.setTimer=function(){var t;this.clearTimer(),this.timer=or(et(t=this.triggerTimer).call(t,this),5e3)},p.triggerTimer=function(){this.clearTimer(),this.saveLogs()},p.formatArgs=function(t,e){var r=new Date;return"[NIM "+this.iid+" "+e+" "+(r.getMonth()+1+"-"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+":"+r.getMilliseconds())+"] "+se(t).call(t,function(i){return i instanceof Me?i.toString():i instanceof Error?i&&i.message?i.message:i:typeof i=="object"?xe(i):i}).join(" ")},p.destroy=function(){this.debug=oo,this.log=oo,this.warn=oo,this.error=oo,this.saveLogs(),this.clearTimer(),this.storageArr=[],this.logStorage&&this.logStorage.close()},a}(),Mx=Math.min,Jm=[].lastIndexOf,ES=!!Jm&&1/[1].lastIndexOf(1,-0)<0,Tx=ta("lastIndexOf"),CS=ES||!Tx?function(p){if(ES)return D(Jm,this,arguments)||0;var l=Tt(this),t=di(l),e=t-1;for(arguments.length>1&&(e=Mx(e,sl(arguments[1]))),e<0&&(e=t+e);e>=0;e--)if(e in l&&l[e]===p)return e||0;return-1}:Jm;je({target:"Array",proto:!0,forced:CS!==[].lastIndexOf},{lastIndexOf:CS});var Ml,Ix=Gr("Array").lastIndexOf,Qm=Array.prototype,rc=function(a){var p=a.lastIndexOf;return a===Qm||ge(Qm,a)&&p===Qm.lastIndexOf?Ix:p},nc=`	
\v\f\r \u2028\u2029\uFEFF`,bS=$("".replace),Cd="["+nc+"]",Sx=RegExp("^"+Cd+Cd+"*"),Ex=RegExp(Cd+Cd+"*$"),Cx=function(a){return function(p){var l=xn(jt(p));return 1&a&&(l=bS(l,Sx,"")),2&a&&(l=bS(l,Ex,"")),l}},zm={trim:Cx(3)},bx=mT.PROPER,Ax=zm.trim;je({target:"String",proto:!0,forced:(Ml="trim",b(function(){return!!nc[Ml]()||""[Ml]()!==""||bx&&nc[Ml].name!==Ml}))},{trim:function(){return Ax(this)}});var Rx=Gr("String").trim,Xm=String.prototype,Nx=function(a){var p=a.trim;return typeof a=="string"||a===Xm||ge(Xm,a)&&p===Xm.trim?Rx:p},kx=zm.trim,Tl=E.parseInt,AS=E.Symbol,RS=AS&&AS.iterator,NS=/^[+-]?0x/i,Ox=$(NS.exec),kS=Tl(nc+"08")!==8||Tl(nc+"0x16")!==22||RS&&!b(function(){Tl(Object(RS))})?function(p,l){var t=kx(xn(p));return Tl(t,l>>>0||(Ox(NS,t)?16:10))}:Tl;je({global:!0,forced:parseInt!=kS},{parseInt:kS});var it=we.parseInt;function Pe(a,p){if(typeof a!="object"||a===null)return a;for(var l=(p=p||"").split("."),t=0;t<l.length;t++){var e=l[t],r=a[e],i=wt(e).call(e,"["),o=wt(e).call(e,"]");if(i!==-1&&o!==-1&&i<o){var u=ht(e).call(e,0,i),h=it(ht(e).call(e,i+1,o));r=a[u],r=qt(r)?r[h]:void 0}if(r==null)return r;a=r}return a}var Ts,jr=(Ts=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return Ts()+Ts()+Ts()+Ts()+Ts()+Ts()+Ts()+Ts()});function Qt(a){var p;return at(p=pt(a)).call(p,function(l){return!(+l>=0)})}function ic(a,p){var l,t=at(l=pt(a)).call(l,function(e){return a[e]==p});return t.length>0?t[0]:void 0}function Wn(a,p){if(p===void 0&&(p="-"),!a)throw new Ut("No sessionId",{},400);var l=wt(a).call(a,p);if(l===-1)throw new Ut("Can not find conjunctions",{},400);var t=ht(a).call(a,0,l);return{accid:ht(a).call(a,l+1),scene:t==="super_team"?"superTeam":t}}function Zm(){return typeof tt<"u"&&tt.getSystemInfo?"TT":typeof swan<"u"&&swan.getSystemInfo?"BAIDU":typeof my<"u"&&my.getSystemInfo?"ALI":typeof wx<"u"&&wx.getSystemInfo?"WX":"unknow environment"}function ao(a,p){return function(t,e,r,i){for(var o in t=t||{},r=r||{},i=i||function(){},e=e||{}){var u=i(t[o],e[o]);t[o]=u===void 0?e[o]:u}for(var h in r){var g=i(t[h],r[h]);t[h]=g===void 0?r[h]:g}return t}({},a,p,function(l,t){return t===void 0?l:t})}function bd(){return He.resolve()}function Il(){}function Ad(a){var p=rc(a).call(a,"."),l=p>-1?ht(a).call(a,p+1):"";return/^\d+$/.test(Nx(l).call(l))&&(l=""),l}function eg(a,p,l){return a.length===0||a[0][p]<=l?0:a[a.length-1][p]>l?a.length:Ni(a).call(a,function(t,e){if(a[e-1]&&a[e-1][p]>l&&l>=t[p])return!0})}function zi(a,p,l,t){var e=typeof Pe(a,"raw.r[0]")=="number"?""+a.raw.r[0]:void 0;return p[l]=p[l]||e||t,p}var xx=function(){function a(l){this.lastSuccUploadHost="",this.core=l}var p=a.prototype;return p.getFileUploadInformation=function(t){return We.getFileUploadInformation(t)},p.request=function(t,e,r){var i=this,o=new Date().getTime(),u=(r==null?void 0:r.exception_service)||0;return We.request(t,e).catch(function(h){var g,v,_,I,C=h;throw i.core.reporter.reportTraceStart("exceptions",{user_id:i.core.options.account||((v=(g=i.core)===null||g===void 0?void 0:g.auth)===null||v===void 0?void 0:v.account),trace_id:(I=(_=i.core.clientSocket)===null||_===void 0?void 0:_.socket)===null||I===void 0?void 0:I.sessionId,start_time:o,action:1,exception_service:u}),i.core.reporter.reportTraceUpdateV2("exceptions",{code:typeof C.code=="number"?C.code:0,description:C.message||""+C.code,operation_type:0,target:t,context:e?xe(e):""},{asyncParams:We.net.getNetworkStatus()}),i.core.reporter.reportTraceEnd("exceptions",1),h})},p.uploadFile=function(t){var e,r,i,o;return k(this,void 0,void 0,T.mark(function u(){var h,g,v,_,I,C,A,N,F,j,W,U,ie,te;return T.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:v=We.platform==="BROWSER",_=v?t.chunkUploadHostBackupList:t.commonUploadHostBackupList,I=v?t.chunkUploadHost:t.commonUploadHost,C=wt(_).call(_,I),A=C===-1?dt(h=[I]).call(h,_):dt(g=[I]).call(g,ht(_).call(_,0,C),ht(_).call(_,C+1)),N=Math.max(wt(A).call(A,this.lastSuccUploadHost),0),F=null,j=0;case 8:if(!(j<A.length)){V.next=32;break}return W=new Date().getTime(),U=A[(j+N)%A.length],V.prev=11,V.next=14,We.uploadFile(O(O({},t),v?{chunkUploadHost:U}:{commonUploadHost:U}));case 14:return ie=V.sent,this.lastSuccUploadHost=U,V.abrupt("return",ie);case 19:if(V.prev=19,V.t0=V.catch(11),this.core.cloudStorage.nos.nosErrorCount--,F=V.t0,te=V.t0,this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||((r=(e=this.core)===null||e===void 0?void 0:e.auth)===null||r===void 0?void 0:r.account),trace_id:(o=(i=this.core.clientSocket)===null||i===void 0?void 0:i.socket)===null||o===void 0?void 0:o.sessionId,start_time:W,action:1,exception_service:3}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:typeof te.code=="number"?te.code:0,description:te.message||""+te.code,operation_type:1,target:U},{asyncParams:We.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),!V.t0||V.t0.code!==ce.V2NIM_ERROR_CODE_CANCELLED&&V.t0.errCode!==10499){V.next=29;break}throw V.t0;case 29:j++,V.next=8;break;case 32:throw F;case 33:case"end":return V.stop()}},u,this,[[11,19]])}))},a}(),tg="weblink.netease.im:443",OS=["https://lbs.netease.im/lbs/webconf.jsp"],wS="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",xS="imElite_sdk_abtest_web",PS="https://statistic.live.126.net,https://statistic-overseas.yunxinfw.com",Px=function(){function a(l,t){this.abtInfo={},this.core=l,this.config=ao({isAbtestEnable:!0,abtestUrl:wS,abtestProjectKey:xS},t)}var p=a.prototype;return p.setOptions=function(t){this.config=ao(this.config,t)},p.abtRequest=function(){var t,e;return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.config.isAbtestEnable){u.next=2;break}return u.abrupt("return");case 2:if(!this.abtInfo.experiments){u.next=4;break}return u.abrupt("return");case 4:if(this.config.abtestUrl){u.next=6;break}return u.abrupt("return");case 6:return u.prev=6,u.next=9,this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.8.30",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7});case 9:i=u.sent,u.next=15;break;case 12:u.prev=12,u.t0=u.catch(6),this.core.logger.warn("ABTest request failed");case 15:this.abtInfo=((e=(t=i==null?void 0:i.data)===null||t===void 0?void 0:t.data)===null||e===void 0?void 0:e.abtInfo)||{};case 16:case"end":return u.stop()}},r,this,[[6,12]])}))},a}();function Lx(a){var p={},l=new He(function(t,e){p.abort=e});return p.promise=He.race([a,l]),p}He.reject;var Rd=function(){function a(){this.abortFns=[]}var p=a.prototype;return p.add=function(t){var e=Lx(t);return this.abortFns.push(e.abort),e.promise},p.clear=function(t){var e;ae(e=this.abortFns).call(e,function(r){return r(t||new Me({code:ce.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))}),this.abortFns=[]},p.destroy=function(){this.clear()},a}(),LS={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},VS={timestamp:0,rtt:0,baseClock:0,baseTime:0},DS=function(){function a(l,t,e){e===void 0&&(e="getServerTime"),this.serverOrigin=VS,this.config=LS,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=l,this.logger=l.logger,this.promiseManager=new Rd,this.cmdName=e,t&&this.setOptions(t)}var p=a.prototype;return p.setOptions=function(t){this.config=O({},LS,this.config,t)},p.reset=function(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=VS,this.currentChance=0},p.setOriginTimetick=function(){return k(this,void 0,void 0,T.mark(function t(){var e,r,i,o,u,h,g,v,_,I;return T.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.config.enable){A.next=2;break}return A.abrupt("return");case 2:if(!this.isSettingNTP){A.next=4;break}return A.abrupt("return");case 4:if(!(this.currentChance>=this.config.maxChances)){A.next=6;break}return A.abrupt("return");case 6:if(e=Pe(this.core,"auth.status"),r=Pe(this.core,"status"),i=Pe(this.core,"V2NIMLoginService.lifeCycle.loginStatus"),e==="logined"||r==="logined"||i===1){A.next=11;break}return A.abrupt("return");case 11:return this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0,o="TimeOrigin::setOriginTimetick:",u=Dt(),this.core.logger.debug(o+" getServerTime start, times "+this.currentChance),A.prev=18,A.next=21,this.promiseManager.add(this.core.sendCmd(this.cmdName));case 21:g=A.sent,h=Pe(g,"content.time"),this.isSettingNTP=!1,A.next=33;break;case 26:return A.prev=26,A.t0=A.catch(18),v=A.t0,this.isSettingNTP=!1,this.logger.warn(o+" Calculate Delay time, getServerTime error",v),v.code!==ce.V2NIM_ERROR_CODE_CANCELLED&&(clearTimeout(this.timer),this.timer=or(et(_=this.setOriginTimetick).call(_,this),this.failedDelay)),A.abrupt("return");case 33:if(h){A.next=37;break}return this.core.logger.warn(o+" Calculate Delay time incorrect format"),this.config.enable=!1,A.abrupt("return");case 37:I=Dt()-u,this.doSet(h,I);case 39:case"end":return A.stop()}},t,this,[[18,26]])}))},p.doSet=function(t,e){var r,i="TimeOrigin::setOriginTimetick:";if(e>this.config.tolerantRTT)this.logger.warn(i+" denied RTT:"+e),clearTimeout(this.timer),this.timer=or(et(r=this.setOriginTimetick).call(r,this),this.failedDelay);else if(e>this.config.bestRTT){var o;this.serverOrigin.rtt&&e>=this.serverOrigin.rtt?this.logger.warn(i+" ignore RTT:"+e):(this.setServerOrigin(e,t),this.logger.log(i+" accept reluctantly RTT:"+e)),clearTimeout(this.timer),this.timer=or(et(o=this.setOriginTimetick).call(o,this),this.failedDelay)}else{var u;this.setServerOrigin(e,t),this.logger.debug(i+" accept best RTT:"+e),this.currentChance=0,clearTimeout(this.timer),this.timer=or(et(u=this.setOriginTimetick).call(u,this),this.successDelay)}},p.getNTPTime=function(t){if(t===void 0&&(t=this.getTimeNode()),this.checkNodeReliable(t)){var e=Math.floor(t.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+e}return Dt()},p.checkNodeReliable=function(t){if(t===void 0&&(t=this.getTimeNode()),this.serverOrigin.timestamp){if(this.serverOrigin.baseClock===0)return!0;var e=t.clock-this.serverOrigin.baseClock,r=t.time-this.serverOrigin.baseTime;return Math.abs(r-e)<500}return!1},p.checkPerformance=function(){return We.platform==="BROWSER"&&!(typeof performance>"u"||!performance.now)},a.checkPerformance=function(){return We.platform==="BROWSER"&&!(typeof performance>"u"||!performance.now)},p.getTimeNode=function(){return{clock:this.checkPerformance()?performance.now():0,time:Dt()}},a.getTimeNode=function(){return{clock:a.checkPerformance()?performance.now():0,time:Dt()}},p.setServerOrigin=function(t,e){this.serverOrigin={timestamp:e+Math.floor(t/2),rtt:t,baseClock:this.checkPerformance()?performance.now():0,baseTime:Dt()}},a}(),rg={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]},Vx=function(){function a(l,t){this.traceData=rg,this.core=l,this.traceData=O({},rg,t),this.traceData.extension=[]}var p=a.prototype;return p.reset=function(){this.traceData=O({},rg),this.traceData.extension=[]},p.start=function(){var t,e;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=((e=(t=this.core.clientSocket)===null||t===void 0?void 0:t.socket)===null||e===void 0?void 0:e.sessionId)||"",this.traceData.start_time=new Date().getTime()},p.update=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,We.net.getNetworkStatus();case 2:r=h.sent,i=r.net_type,o=r.net_connect,this.traceData.extension.push(O({code:0,foreground:!0,foreg_backg_switch:!1,net_type:i,net_connect:o},t));case 6:case"end":return h.stop()}},e,this)}))},p.end=function(t){var e=this.traceData.extension[0],r=this.traceData.extension[1];if(e&&e.operation_type===0&&r&&r.operation_type===1){var i=e.net_type!==r.net_type||e.net_connect!==r.net_connect;if(t||!i)return this.traceData.duration=new Date().getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()},a}(),US={user_id:"",trace_id:"",net_connect:!0,net_type:0,duration:0,start_time:0,history:[],succeed:!1},Dx=function(){function a(l){this.traceData=US,this.core=l,this.reset()}var p=a.prototype;return p.reset=function(){this.traceData=O({},US),this.traceData.history=[]},p.start=function(t){this.reset(),this.traceData.user_id=t,this.traceData.start_time=Dt()},p.updateBegin=function(t){this.traceData.history.push(O({head:"",body:"",start_time:Dt(),httpdns:!1,index:0},t))},p.updateComplete=function(t){var e;ae(e=this.traceData.history).call(e,function(r){r.target===t.target&&(O(r,t),r.duration=Dt()-r.start_time)})},p.end=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.traceData.succeed=t,this.traceData.history=at(r=this.traceData.history).call(r,function(v){return v.code!==void 0}),this.traceData.history.length!==0){g.next=5;break}return this.reset(),g.abrupt("return");case 5:return this.traceData.duration=Dt()-this.traceData.start_time,g.next=8,We.net.getNetworkStatus();case 8:i=g.sent,o=i.net_type,u=i.net_connect,this.traceData.net_type=o,this.traceData.net_connect=u,this.core.reporter.report("nim_sdk_lbs_records",this.traceData),this.reset();case 15:case"end":return g.stop()}},e,this)}))},a}();function Ux(a){var p,l,t=!0;return typeof((p=a==null?void 0:a.reporterConfig)===null||p===void 0?void 0:p.enableCompass)=="boolean"?t=a.reporterConfig.enableCompass:typeof((l=a==null?void 0:a.reporterConfig)===null||l===void 0?void 0:l.isDataReportEnable)=="boolean"&&(t=a.reporterConfig.isDataReportEnable),t}var Nd={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},FS="ReporterHook::setMonitorForResources:",Fx=function(){function a(l,t){this.traceData=Nd,this.core=l,this.traceData=O({},Nd,t)}var p=a.prototype;return p.reset=function(){this.traceData=O({},Nd)},p.start=function(){var t,e;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=((e=(t=this.core.clientSocket)===null||t===void 0?void 0:t.socket)===null||e===void 0?void 0:e.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Dt()},p.update=function(t){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.traceData.user_id){i.next=2;break}return i.abrupt("return");case 2:this.core.logger.log(FS+" upload update",t),O(this.traceData,t);case 4:case"end":return i.stop()}},e,this)}))},p.end=function(t){this.traceData.user_id&&(this.core.logger.log(FS+" upload end cause of "+t),this.traceData.state=t,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Dt())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=Nd)},a}(),kd={},ng={},BS={},Bx={apiVersion:"v1",debugLevel:"off",needReconnect:!0,reconnectionAttempts:sT,lbsUrls:OS,linkUrl:tg,abtestUrl:wS,isAbtestEnable:!0},Vt=function(a){function p(t,e){var r,i,o;if(e===void 0&&(e={}),(o=a.call(this)||this).instanceName="NIM",o.pluginMap={},o.eventBus=new ia,o.options={},o.V2NIMConversationIdUtil={},o.V2NIMMessageCreator={},o.V2NIMMessageAttachmentCreator={},o.V2NIMClientAntispamUtil={},o.DataStructureConverter={},o.V2NIMMessageConverter={},o.V2NIMMessageLogUtil={},o.V2NIMMessageExtendUtil={},o.V2NIMStorageUtil={},o.V2NIMNotificationService={},o.V2NIMStorageService={},o.auth={},o.V1NIMLoginService={},o.V2NIMLoginService={},o.clientSocket={},o.V2NIMSyncService={},o.V2NIMLocalConversationService={},o.V2NIMConversationService={},o.V2NIMConversationGroupService={},o.V2NIMMessageService={},o.V2NIMTeamService={},o.V2NIMUserService={},o.V2NIMFriendService={},o.V2NIMSettingService={},o.V2NIMAIService={},o.V2NIMSignallingService={},o.V2NIMSubscriptionService={},o.V2NIMPassthroughService={},o.YSFService={},o.offlinePush={},o.sync={},o.msg={},o.msgLog={},o.session={},o.cloudSession={},o.misc={},o.user={},o.friend={},o.systemMessage={},o.team={},o.event={},o.msgExtend={},o.cloudStorage={},o.passThrough={},o.superTeam={},o.plugin={},o.signaling={},o.qchatChannel={},o.qchatMedia={},o.qchatMsg={},o.qchatRole={},o.qchatServer={},o.pluginMap=BS,o.logger=new _x(t.debugLevel,e.loggerConfig),e.privateConf){var u=o.getConfigFromPrivate(e.privateConf),h=u.authConfig,g=u.cloudStorageConfig,v=u.reporterConfig;O(t,h),o.setInitOptions(t),o.otherOptions=O(O({},e),{cloudStorageConfig:O(O({storageKeyPrefix:"NIM"},e.cloudStorageConfig),g),reporterConfig:O(O({},e.reporterConfig),v),V1NIMLoginServiceConfig:O(O(O({},t),e.V1NIMLoginServiceConfig),h),V2NIMLoginServiceConfig:O(O({},e.V2NIMLoginServiceConfig),h)})}else o.setInitOptions(t),o.otherOptions=O(O({},e),{V1NIMLoginServiceConfig:O(O({},t),e.V1NIMLoginServiceConfig),cloudStorageConfig:O({storageKeyPrefix:"NIM"},e.cloudStorageConfig)});o.timerManager=new IS,o.timeOrigin=new DS(Ot(o)),o.adapters=new xx(Ot(o)),o.abtest=new Px(Ot(o),O(O({isAbtestEnable:o.options.isAbtestEnable,abtestUrl:o.options.abtestUrl},o.otherOptions.abtestConfig),{abtestProjectKey:xS}));var _=We.getSystemInfo(),I=function(N,F){var j,W,U=(j=F==null?void 0:F.reporterConfig)===null||j===void 0?void 0:j.compassDataEndpoint,ie=(W=F==null?void 0:F.reporterConfig)===null||W===void 0?void 0:W.reportConfigUrl;if(U)return U;if(ie){var te=ie.match(/^https:\/\/([^/]+)\/*/);return qt(te)&&te.length>=1?"https://"+te[1]:(N.error("Invalid reportConfigUrl: "+ie),PS)}return PS}(o.logger,o.otherOptions);o.reporter=new Lw(O(O({},I?{compassDataEndpoint:I}:{}),{isDataReportEnable:Ux(o.otherOptions),common:{app_key:t.appkey,dev_id:"",platform:"Web",sdk_ver:"10.8.30",env:"online",os_name:_.os,os_ver:_.osVer,lib_env:_.libEnv,host_env:_.hostEnv,host_env_ver:_.hostEnvVer,manufactor:_.manufactor,model:_.model,v2:o.options.apiVersion!=="v1"},request:We.request,logger:o.logger,autoStart:!0})),o.reporterHookLinkKeep=new Vx(Ot(o)),o.reporterHookCloudStorage=new Fx(Ot(o)),o.reporterHookLBS=new Dx(Ot(o)),We.setLogger(o.logger);var C=o.getServiceKeys(pt(kd));return ae(C).call(C,function(A){if(!o[A]||!o[A].name){var N=kd[A];o[A]=new N(Ot(o))}}),ae(r=pt(kd)).call(r,function(A){o.callSetOptions(A)}),ae(i=pt(ng)).call(i,function(A){var N=ng[A];N!==void 0&&(o[A]=new N(Ot(o)))}),p.instance=Ot(o),o.logger.log("NIM init, version:10.8.30, sdk version:100830, appkey:"+t.appkey),o}bt(p,a);var l=p.prototype;return l.getServiceKeys=function(e){var r=Ni(e).call(e,function(I){return I==="V1NIMLoginService"});if(r>-1){var i=e[r];wn(e).call(e,r,1),this.options.apiVersion==="v1"&&e.unshift(i)}var o=Ni(e).call(e,function(I){return I==="V2NIMLoginService"});if(o>-1){var u=e[o];wn(e).call(e,o,1),this.options.apiVersion==="v2"&&e.unshift(u)}var h=Ni(e).call(e,function(I){return I==="sync"});if(h>-1){var g=e[h];wn(e).call(e,h,1),this.options.apiVersion==="v1"&&e.push(g)}var v=Ni(e).call(e,function(I){return I==="V2NIMSyncService"});if(v>-1){var _=e[v];wn(e).call(e,v,1),this.options.apiVersion==="v2"&&e.push(_)}return e},p.getInstance=function(e,r){if(!p.instance){if(e)return new p(e,r);throw new Error("Instance not exist, please input options")}if(e){if(p.instance.options.account===e.account&&p.instance.options.appkey===e.appkey)return p.instance.setOptions(e),p.instance;throw new Error("Unexpected login")}return p.instance},l.setInitOptions=function(e){P({appkey:{type:"string"},apiVersion:{type:"enum",values:["v1","v2"],required:!1},binaryWebsocket:{type:"boolean",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.options=O(O({},Bx),e)},l.getConfigFromPrivate=function(e){var r;return e?{authConfig:JSON.parse(xe({appkey:e.appkey||void 0,lbsUrls:e.weblbsUrl?[e.weblbsUrl]:void 0,linkUrl:e.link_web||void 0,linkSSL:(r=e.websdkSsl)!==null&&r!==void 0?r:void 0})),cloudStorageConfig:JSON.parse(xe({chunkUploadHost:e.nos_uploader||void 0,commonUploadHost:e.nos_uploader||void 0,commonUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,chunkUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,uploadReplaceFormat:e.nos_downloader_v2?(e.nosSsl?"https://":"http://")+e.nos_downloader_v2:void 0,downloadUrl:e.nos_accelerate!==void 0?e.nos_accelerate:void 0,downloadHostList:e.nos_accelerate_host===""?[]:typeof e.nos_accelerate_host=="string"?[e.nos_accelerate_host]:qt(e.nos_accelerate_host)?e.nos_accelerate_host:void 0})),reporterConfig:JSON.parse(xe({enableCompass:typeof e.enableCompass=="boolean"?e.enableCompass:void 0,compassDataEndpoint:e.compassDataEndpoint||void 0}))}:{authConfig:{},cloudStorageConfig:{},reporterConfig:{}}},l.connect=function(e){return e===void 0&&(e={}),this.V1NIMLoginService.login(e)},l.setOptions=function(e){if(typeof e=="object"&&e!==null){if(Object.prototype.hasOwnProperty.call(e,"account")&&e.account!==this.options.account||Object.prototype.hasOwnProperty.call(e,"appkey")&&e.appkey!==this.options.appkey)throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions account and appkey is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"apiVersion")&&e.apiVersion!==this.options.apiVersion)throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions apiVersion is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"binaryWebsocket")&&e.binaryWebsocket!==this.options.binaryWebsocket)throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions binaryWebsocket is not allowed to reset"}});P({token:{type:"string",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.logger.log("NIM::setOptions options is",e),this.options=O(O({},this.options),e),this.V1NIMLoginService.setOptions&&this.V1NIMLoginService.setOptions(this.options)}},l.getOptions=function(){return this.options},l.disconnect=function(){return this.V1NIMLoginService.logout()},l._disconnect=function(){return this.options.apiVersion==="v1"?this.V1NIMLoginService.logout():this.options.apiVersion==="v2"?Pe(this.V2NIMLoginService,"lifeCycle.connectStatus")===0&&Pe(this.V2NIMLoginService,"lifeCycle.loginStatus")===0?He.resolve():this.V2NIMLoginService.logout():He.resolve()},l.destroy=function(){var e=this;return p.instance=void 0,this._disconnect().then(function(){e.status="destroyed",e.removeAllListeners(),e.eventBus.removeAllListeners(),e.logger.destroy(),e.reporter.destroy(),e.timerManager.destroy(),e._clearModuleData("destroy"),e._removeAllModuleListeners(),e.connect=bd,e.disconnect=bd,e._disconnect=bd,e.destroy=bd})},l._clearModuleData=function(e){e===void 0&&(e="logout");var r=yf(this);ae(r).call(r,function(i){i&&typeof i.reset=="function"&&i.reset(e)})},l._removeAllModuleListeners=function(){var e=yf(this);ae(e).call(e,function(r){r&&typeof r.removeAllListeners=="function"&&r.removeAllListeners()})},l.kick=function(e){return this.V1NIMLoginService.kick(e)},l.sendCmd=function(e,r,i){return this.clientSocket.sendCmd(e,r,i)},l.emit=function(e){var r=this;try{for(var i,o,u=Dt(),h=arguments.length,g=new Array(h>1?h-1:0),v=1;v<h;v++)g[v-1]=arguments[v];var _=(i=a.prototype.emit).call.apply(i,dt(o=[this,e]).call(o,g)),I=Dt()-u;return I>=10&&this.logger.warn("Core::emit event: "+e+" process takes: "+I+"ms"),_}catch(C){return this.logger.error("Core::emit event: "+e+". Error: "+C),or(function(){throw r.logger.error("Core::emit throw error in setTimeout. event: "+e+". Error: "+C),C},0),!1}},l._registerDep=function(e,r){this[r]&&this[r].name||(this[r]=new e(this),this.callSetOptions(r))},l.callSetOptions=function(e){var r=e+"Config",i=e+"Options",o=this.otherOptions[r]||this.otherOptions[i]||{},u=Pe(this,e+".setOptions");typeof u=="function"&&(e==="cloudStorage"&&(o=this.otherOptions[r]||this.otherOptions.serverConfig||{}),u.call(this[e],o))},p.registerService=function(e,r){kd[r]=e},p.registerPrivateService=function(e,r){ng[r]=e},p.registerPlugin=function(e,r){BS[r]=e},Ai(p,[{key:"account",get:function(){return this.auth.account}},{key:"status",get:function(){return this.V1NIMLoginService.status},set:function(e){this.V1NIMLoginService.status=e}},{key:"config",get:function(){return{timeout:8e3,deviceId:this.auth.deviceId}}}]),p}(ia);Vt.sdkVersion=100830,Vt.sdkVersionFormat="10.8.30";var qx=m(function(a,p){a.exports=function(){function l(r){if(r){var i,o="";return ae(i=pt(r)).call(i,function(u,h){o+=h===0?"?":"&",o+=u+"="+r[u]}),o}return""}var t=function(r){function i(o,u,h,g){var v;return(v=r.call(this,h)||this).source=o,v.code=u,v.desc=h,v.detail=g||{},v}return bt(i,r),i}(gS(Error));function e(r,i){i===void 0&&(i={dataType:"json",method:"GET",timeout:5e3});var o=i.dataType==="text"?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",u=i.method==="GET"?l(i.params):"";return new He(function(h,g){if(window.XMLHttpRequest){var v,_=new XMLHttpRequest;if(_.onreadystatechange=function(){if(_.readyState===4)if(_.status===200){try{v=JSON.parse(_.response||"{}")}catch{v=_.response}h({status:_.status,data:v})}else or(function(){g(new t(1,_.status,"readyState: "+_.readyState+"; statusText: "+_.statusText))},0)},_.open(i.method,""+r+u),_.timeout=i.timeout||5e3,_.setRequestHeader("Content-Type",o),i.headers)for(var I in i.headers)_.setRequestHeader(I,i.headers[I]);_.ontimeout=function(C){g(new t(1,408,C&&C.message?C.message:"request timeout"))},_.send(xe(i.data))}else g(new t(2,10400,"request no suppout"))})}return e}()}),Gx=Math.floor,ig=function(a,p){var l=a.length,t=Gx(l/2);return l<8?jx(a,p):Hx(a,ig(Tf(a,0,t),p),ig(Tf(a,t),p),p)},jx=function(a,p){for(var l,t,e=a.length,r=1;r<e;){for(t=r,l=a[r];t&&p(a[t-1],l)>0;)a[t]=a[--t];t!==r++&&(a[t]=l)}return a},Hx=function(a,p,l,t){for(var e=p.length,r=l.length,i=0,o=0;i<e||o<r;)a[i+o]=i<e&&o<r?t(p[i],l[o])<=0?p[i++]:l[o++]:i<e?p[i++]:l[o++];return a},$x=ig,qS=be.match(/firefox\/(\d+)/i),GS=!!qS&&+qS[1],Kx=/MSIE|Trident/.test(be),jS=be.match(/AppleWebKit\/(\d+)\./),HS=!!jS&&+jS[1],co=[],$S=$(co.sort),Yx=$(co.push),Wx=b(function(){co.sort(void 0)}),Jx=b(function(){co.sort(null)}),Qx=ta("sort"),KS=!b(function(){if(de)return de<70;if(!(GS&&GS>3)){if(Kx)return!0;if(HS)return HS<603;var a,p,l,t,e="";for(a=65;a<76;a++){switch(p=String.fromCharCode(a),a){case 66:case 69:case 70:case 72:l=3;break;case 68:case 71:l=4;break;default:l=2}for(t=0;t<47;t++)co.push({k:p+t,v:l})}for(co.sort(function(r,i){return i.v-r.v}),t=0;t<co.length;t++)p=co[t].k.charAt(0),e.charAt(e.length-1)!==p&&(e+=p);return e!=="DGBEFHACIJK"}});je({target:"Array",proto:!0,forced:Wx||!Jx||!Qx||!KS},{sort:function(p){p!==void 0&&Ge(p);var l=Er(this);if(KS)return p===void 0?$S(l):$S(l,p);var t,e,r=[],i=di(l);for(e=0;e<i;e++)e in l&&Yx(r,l[e]);for($x(r,function(o){return function(u,h){return h===void 0?-1:u===void 0?1:o!==void 0?+o(u,h)||0:xn(u)>xn(h)?1:-1}}(p)),t=di(r),e=0;e<t;)l[e]=r[e++];for(;e<i;)ld(l,e++);return l}});var zx=Gr("Array").sort,sg=Array.prototype,Tr=function(a){var p=a.sort;return a===sg||ge(sg,a)&&p===sg.sort?zx:p},Sl=m(function(a,p){a.exports=function(){var l={d:function(w,Y){for(var re in Y)l.o(Y,re)&&!l.o(w,re)&&Zs(w,re,{enumerable:!0,get:Y[re]})},o:function(w,Y){return Object.prototype.hasOwnProperty.call(w,Y)}},t={};l.d(t,{default:function(){return H}});var e=function V(w){for(var Y in function(re,ee){if(!(re instanceof ee))throw new TypeError("Cannot call a class as a function")}(this,V),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(re){},this.onProgress=function(re){},this.onUploadProgress=function(re){},this.onComplete=function(re){},w)this[Y]=w[Y]};function r(V,w){var Y=gr!==void 0&&Yn(V)||V["@@iterator"];if(!Y){if(qt(V)||(Y=function(ze,nt){if(ze){var Se;if(typeof ze=="string")return i(ze,nt);var vt=ht(Se=Object.prototype.toString.call(ze)).call(Se,8,-1);return vt==="Object"&&ze.constructor&&(vt=ze.constructor.name),vt==="Map"||vt==="Set"?vr(ze):vt==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(vt)?i(ze,nt):void 0}}(V))||w){Y&&(V=Y);var re=0,ee=function(){};return{s:ee,n:function(){return re>=V.length?{done:!0}:{done:!1,value:V[re++]}},e:function(nt){throw nt},f:ee}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var pe,ye=!0,Q=!1;return{s:function(){Y=Y.call(V)},n:function(){var nt=Y.next();return ye=nt.done,nt},e:function(nt){Q=!0,pe=nt},f:function(){try{ye||Y.return==null||Y.return()}finally{if(Q)throw pe}}}}function i(V,w){(w==null||w>V.length)&&(w=V.length);for(var Y=0,re=new Array(w);Y<w;Y++)re[Y]=V[Y];return re}var o={privateObj:{},setItem:function(w,Y){o.privateObj[w]=Y},getItem:function(w){return o.privateObj[w]},removeItem:function(w){delete o.privateObj[w]},getKeys:function(){return pt(o.privateObj)}},u={getFileKey:function(w){var Y=w.size.toString(),re=w.lastModified.toString();return"_NosUploader_"+w.name+ht(Y).call(Y,Y.length-5)+ht(re).call(re,re.length-5)},getFileInfo:function(w){var Y=o.getItem(w);if(!Y)return null;try{return JSON.parse(Y)}catch{return null}},initFile:function(w,Y,re){u.clearExpiredInfo();var ee=this.getFileKey(Y),pe={ctx:w.ctx!==void 0?w.ctx:"",bucket:w.bucketName,obj:w.objectName,token:w.token,modifyAt:Dt(),end:!1};return w.payload&&(pe.payload=w.payload),re&&o.setItem(ee,xe(pe)),ee},setUploadContext:function(w,Y,re){var ee=this.getFileInfo(w);ee&&(ee.ctx=Y,re&&o.setItem(w,xe(ee)))},setComplete:function(w,Y){var re=this.getFileInfo(w);re&&(re.modifyAt=Dt(),re.end=!0,Y&&o.setItem(w,xe(re)))},getUploadContext:function(w){var Y=this.getFileInfo(w);return Y?Y.ctx:""},removeFileInfo:function(w){wt(w).call(w,"_NosUploader_")===0&&o.removeItem(w)},clearExpiredInfo:function(){var w,Y=typeof o.getKeys=="function"?o.getKeys():pt(o),re=Dt(),ee=[],pe=r(Y);try{for(pe.s();!(w=pe.n()).done;){var ye=w.value;if(wt(ye).call(ye,"_NosUploader_")===0){var Q=u.getFileInfo(ye);Q===null||re-Q.modifyAt>H.expireTime?o.removeItem(ye):ee.push({fileInfo:Q,key:ye})}}}catch(At){pe.e(At)}finally{pe.f()}if(ee.length>H.maxFileCache){var ze,nt,Se=r(ht(ze=Tr(ee).call(ee,function(At,Ie){return Ie.fileInfo.modifyAt-At.fileInfo.modifyAt})).call(ze,H.maxFileCache));try{for(Se.s();!(nt=Se.n()).done;){var vt,ar=nt.value;wt(vt=ar.key).call(vt,"_NosUploader_")===0&&o.removeItem(ar.key)}}catch(At){Se.e(At)}finally{Se.f()}}}},h=u;function g(V){return(g=typeof gr=="function"&&typeof xf=="symbol"?function(w){return typeof w}:function(w){return w&&typeof gr=="function"&&w.constructor===gr&&w!==gr.prototype?"symbol":typeof w})(V)}function v(V,w){return!w||g(w)!=="object"&&typeof w!="function"?function(Y){if(Y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}(V):w}function _(V){var w=typeof Dr=="function"?new Dr:void 0;return(_=function(re){var ee,pe;if(re===null||(pe=re,wt(ee=Function.toString.call(pe)).call(ee,"[native code]")===-1))return re;if(typeof re!="function")throw new TypeError("Super expression must either be null or a function");if(w!==void 0){if(w.has(re))return w.get(re);w.set(re,ye)}function ye(){return I(re,arguments,N(this).constructor)}return ye.prototype=Ri(re.prototype,{constructor:{value:ye,enumerable:!1,writable:!0,configurable:!0}}),A(ye,re)})(V)}function I(V,w,Y){return(I=C()?ys:function(re,ee,pe){var ye=[null];ye.push.apply(ye,ee);var Q=new(et(Function).apply(re,ye));return pe&&A(Q,pe.prototype),Q}).apply(null,arguments)}function C(){if(typeof Reflect>"u"||!ys||ys.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(ys(Boolean,[],function(){})),!0}catch{return!1}}function A(V,w){return(A=ps||function(Y,re){return Y.__proto__=re,Y})(V,w)}function N(V){return(N=ps?wi:function(w){return w.__proto__||wi(w)})(V)}var F=function(V){(function(pe,ye){if(typeof ye!="function"&&ye!==null)throw new TypeError("Super expression must either be null or a function");pe.prototype=Ri(ye&&ye.prototype,{constructor:{value:pe,writable:!0,configurable:!0}}),ye&&A(pe,ye)})(ee,V);var w,Y,re=(w=ee,Y=C(),function(){var pe,ye=N(w);if(Y){var Q=N(this).constructor;pe=ys(ye,arguments,Q)}else pe=ye.apply(this,arguments);return v(this,pe)});function ee(pe,ye){var Q;return function(ze,nt){if(!(ze instanceof nt))throw new TypeError("Cannot call a class as a function")}(this,ee),(Q=re.call(this,"NosUploadError:"+pe)).errCode=ye,Q.errMsg=pe,Q}return ee}(_(Error)),j=function V(w,Y,re){if(w.uploadState==="uploading"){var ee=w.config,pe=w.param,ye=h.getUploadContext(w.fileKey);if(!ye)return re(0);var Q=new XMLHttpRequest,ze=ee.directUploadAddr+"/".concat(pe.bucketName)+"/".concat(encodeURIComponent(pe.objectName))+"?uploadContext"+"&context=".concat(ye)+"&version=".concat(ee.version);Q.onreadystatechange=function(){var nt;if(w.uploadState!=="abort"&&Q.readyState===4){var Se,vt,ar,At;try{At=JSON.parse(Q.responseText)}catch{At={errMsg:"JsonParseError in getOffset. xhr.status = "+Q.status+". xhr.responseText: "+Q.responseText,errCode:500}}Q.status===200?At.errCode?w.config.onError(new F(At.errMsg,At.errCode)):re(At.offset):Q.status.toString().match(/^5/)?V(w,Y-1,re):Y>0?(typeof((nt=ee.logger)===null||nt===void 0?void 0:nt.error)=="function"&&ee.logger.error(dt(Se="getOffset(".concat(ze,") error. retry after 3 seconds. ")).call(Se,new Date().toTimeString())),or(function(){V(w,Y-1,re)},3500)):Q.status?(h.removeFileInfo(w.fileKey),ee.onError(new F(dt(vt=dt(ar="getOffset(".concat(ze,") error: ")).call(ar,Q.status," ")).call(vt,Q.statusText)))):ee.onError(new F("getOffset(".concat(ze,") error. no Error Code")))}},Q.open("get",ze),Q.setRequestHeader("x-nos-token",pe.token),Q.timeout=ee.getOffsetTimeout,Q.send()}},W=function V(w,Y,re,ee){if(w.uploadState==="uploading"){var pe=w.param,ye=w.config,Q=ht(File.prototype),ze=pe.ctx!==void 0?pe.ctx:"",nt=Y+ye.trunkSize>=w.file.size,Se=nt?w.file.size:Y+ye.trunkSize,vt=new XMLHttpRequest,ar=ye.directUploadAddr+"/".concat(pe.bucketName)+"/".concat(encodeURIComponent(pe.objectName));if(vt.upload.onprogress=function(Ie){if(w.uploadState!=="abort"){var Oe=0;Ie.lengthComputable?(Oe=(Y+Ie.loaded)/w.file.size,ye.onProgress(Oe),ye.onUploadProgress({loaded:Ie.loaded,total:w.file.size,percentage:Oe,percentageText:(100*Oe).toFixed(2)+"%"})):ye.onError(new F("browser does not support query upload progress"))}},vt.onreadystatechange=function(){var Ie,Oe;if(w.uploadState!=="abort"&&vt.readyState===4){var mt,Je,Lt,Et;try{Et=JSON.parse(vt.responseText)}catch(lt){typeof((Ie=ye.logger)===null||Ie===void 0?void 0:Ie.error)=="function"&&ye.logger.error("JsonParseError in uploadTrunk. xhr.status = "+vt.status+". xhr.responseText: "+vt.responseText,lt),Et={errMsg:"JsonParseError in uploadTrunk. xhr.status = "+vt.status+". xhr.responseText: "+vt.responseText}}vt.status===200?(w.setContext(Et.context),nt?(ee(),w.setComplete()):V(w,Et.offset,ye.retryCount,ee)):vt.status.toString().match(/^5/)?re>0?V(w,Y,re-1,ee):(h.removeFileInfo(w.fileKey),ye.onError(new F(Et.errMsg,Et.errCode))):re>0?(typeof((Oe=ye.logger)===null||Oe===void 0?void 0:Oe.error)=="function"&&ye.logger.error(dt(mt="uploadTrunk(".concat(ar,") error. retry after 3 seconds. ")).call(mt,new Date().toTimeString())),or(function(){V(w,Y,re-1,ee)},3500)):vt.status?(h.removeFileInfo(w.fileKey),ye.onError(new F(dt(Je=dt(Lt="uploadTrunk(".concat(ar,") error: ")).call(Lt,vt.status," ")).call(Je,vt.statusText)))):ye.onError(new F("uploadTrunk(".concat(ar,") error. no Error Code. Please check your network")))}},vt.open("post",ar+"?offset=".concat(Y)+"&complete=".concat(nt)+"&context=".concat(ze)+"&version=".concat(ye.version)),vt.setRequestHeader("x-nos-token",pe.token),pe.md5&&vt.setRequestHeader("content-md5",pe.md5),w.file.type&&vt.setRequestHeader("content-type",w.file.type),vt.timeout=ye.trunkUploadTimeout,typeof FileReader<"u"){var At=new FileReader;At.addEventListener("load",function(Ie){var Oe;((Oe=Ie==null?void 0:Ie.target)===null||Oe===void 0?void 0:Oe.result)instanceof ArrayBuffer&&Ie.target.result.byteLength>0?vt.send(Ie.target.result):ye.onError(new F("Read ArrayBuffer failed",194003))}),At.addEventListener("error",function(Ie){var Oe=Ie.target.error;ye.onError(new F("Read ArrayBuffer error. ".concat(Oe.toString()),194003))}),At.readAsArrayBuffer(Q.call(w.file,Y,Se))}else vt.send(Q.call(w.file,Y,Se))}};function U(V,w){for(var Y=0;Y<w.length;Y++){var re=w[Y];re.enumerable=re.enumerable||!1,re.configurable=!0,"value"in re&&(re.writable=!0),Zs(V,re.key,re)}}var ie=function(){function V(Y,re,ee){(function(pe,ye){if(!(pe instanceof ye))throw new TypeError("Cannot call a class as a function")})(this,V),this.uploadState="paused",this.config=ee,this.file=Y,this.param=re,this.fileKey=h.initFile(re,Y,this.config.enableCache),this.resume()}var w;return(w=[{key:"resume",value:function(){var re=this;if(this.uploadState!=="uploading"){this.setUploadState("uploading");var ee=this.config;j(this,ee.retryCount,function(pe){W(re,pe,ee.retryCount,function(){re.setUploadState("ended"),typeof ee.onComplete=="function"&&ee.onComplete(re.param)})})}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){this.uploadState!=="ended"&&this.uploadState!=="abort"&&(this.setUploadState("abort"),this.config.onError(new F("Upload Aborted",10499)))}},{key:"setUploadState",value:function(re){re!==this.uploadState&&(this.uploadState=re)}},{key:"setContext",value:function(re){h.setUploadContext(this.fileKey,re,this.config.enableCache),this.param.ctx=re}},{key:"setComplete",value:function(){h.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&U(V.prototype,w),V}(),te={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function(w){var Y=h.getFileKey(w),re=h.getFileInfo(Y);return re===null?null:Dt()-re.modifyAt>te.expireTime?(h.removeFileInfo(Y),null):{uploadInfo:O({bucketName:re.bucket,objectName:re.obj,token:re.token,ctx:re.ctx},re.payload?{payload:re.payload}:{}),complete:re.end}},setMaxFileCache:function(w){te.maxFileCache=w},setExpireTime:function(w){te.expireTime=w},printCaches:function(){if(typeof localStorage<"u")for(var w=0,Y=pt(localStorage);w<Y.length;w++){var re=Y[w],ee=h.getFileInfo(re);ee&&console.log(ee,"modifiedAt",new Date(ee.modifyAt).toTimeString())}},createConfig:function(w){return new e(w)},createTask:function(w,Y,re){return new ie(w,Y,re)}},H=te;return t.default}()}),Xx=ms.some,Zx=ta("some");je({target:"Array",proto:!0,forced:!Zx},{some:function(p){return Xx(this,p,arguments.length>1?arguments[1]:void 0)}});var eP=Gr("Array").some,og=Array.prototype,Ln=function(a){var p=a.some;return a===og||ge(og,a)&&p===og.some?eP:p},YS={debug:function(){},log:function(){},warn:function(){},error:function(){}};function tP(a){YS=a}function WS(){if(!navigator||!navigator.userAgent)return!1;var a=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i];return Ln(a).call(a,function(p){return navigator.userAgent.match(p)})}function ag(){var a;return!(!navigator||!navigator.userAgent)&&typeof navigator=="object"&&typeof navigator.userAgent=="string"&&wt(a=navigator.userAgent).call(a,"Electron")>=0}function JS(){return navigator&&navigator.userAgent}function rP(a){return k(this,void 0,void 0,T.mark(function p(){var l,t,e,r,i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(r=YS,a.fileInput||a.file){g.next=3;break}throw new Error("File not exist");case 3:if(!a.file){g.next=7;break}i=a.file,g.next=21;break;case 7:if(typeof a.fileInput!="string"){g.next=16;break}if(!((o=document.getElementById(a.fileInput))&&o.files&&o.files[0])){g.next=13;break}i=o.files[0],g.next=14;break;case 13:throw new Error("Can not get file from fileInput");case 14:g.next=21;break;case 16:if(!(a.fileInput&&a.fileInput.files&&a.fileInput.files[0])){g.next=20;break}i=a.fileInput.files[0],g.next=21;break;case 20:throw new Error("Can not get file from fileInput "+a.fileInput);case 21:if(!(a.maxSize&&i.size>a.maxSize)){g.next=23;break}throw new Error("The file exceeds maxSize limit. maxSize: "+a.maxSize+", get "+i.size);case 23:return g.next=25,new He(function(v,_){var I,C=Sl.getFileUploadInformation(i),A=Sl.createConfig({enableCache:!0,retryCount:0,directUploadAddr:a.chunkUploadHost,onError:function(F){_(F)},onUploadProgress:a.onUploadProgress||function(){},onComplete:function(F){v(F)}});if(C)if(C.complete)a.onUploadProgress&&a.onUploadProgress({total:i.size,loaded:i.size,percentage:1,percentageText:"100%"}),v(C.uploadInfo);else{I=Sl.createTask(i,C.uploadInfo,A);try{a.onUploadStart&&a.onUploadStart(I)}catch(N){r.error("Adapter uploadFile: options.onUploadStart error",N&&N.message),I.abort(),_(N)}}else{I=Sl.createTask(i,O(O({bucketName:a.nosToken.bucket,objectName:decodeURIComponent(a.nosToken.objectName),token:a.nosToken.token},a.md5?{md5:a.md5}:{}),a.payload?{payload:a.payload}:{}),A);try{a.onUploadStart&&a.onUploadStart(I)}catch(N){r.error("Adapter uploadFile: options.onUploadStart error",N&&N.message),I.abort(),_(N)}}});case 25:return(u=g.sent).name=i.name,u.size=i.size,u.type=i.type,u.ext=rc(l=u.name).call(l,".")>-1?ht(t=u.name).call(t,rc(e=u.name).call(e,".")+1).toLowerCase():"",g.abrupt("return",u);case 31:case"end":return g.stop()}},p)}))}function nP(a){var p;if(a.file)p=a.file;else if(typeof a.fileInput=="string"){var l=document.getElementById(a.fileInput);if(!(l&&l.files&&l.files[0]))throw new Error("Can not get file from fileInput");p=l.files[0]}else{if(!(a.fileInput&&a.fileInput.files&&a.fileInput.files[0]))throw new Error("Can not get file from fileInput "+a.fileInput);p=a.fileInput.files[0]}return Sl.getFileUploadInformation(p)}/*!
	 * Platform.js v1.3.6
	 * Copyright 2014-2020 Benjamin Tan
	 * Copyright 2011-2013 John-David Dalton
	 * Available under MIT license
	 */var sc=m(function(a,p){(function(){var l={function:!0,object:!0}[typeof window]&&window||this,t=p,e=a&&!a.nodeType&&a,r=t&&e&&typeof d=="object"&&d;!r||r.global!==r&&r.window!==r&&r.self!==r||(l=r);var i=Math.pow(2,53)-1,o=/\bOpera/,u=Object.prototype,h=u.hasOwnProperty,g=u.toString;function v(W){return(W=String(W)).charAt(0).toUpperCase()+W.slice(1)}function _(W){return W=F(W),/^(?:webOS|i(?:OS|P))/.test(W)?W:v(W)}function I(W,U){for(var ie in W)h.call(W,ie)&&U(W[ie],ie,W)}function C(W){return W==null?v(W):g.call(W).slice(8,-1)}function A(W){return String(W).replace(/([ -])(?!$)/g,"$1?")}function N(W,U){var ie=null;return function(H,V){var w=-1,Y=H?H.length:0;if(typeof Y=="number"&&Y>-1&&Y<=i)for(;++w<Y;)V(H[w],w,H);else I(H,V)}(W,function(te,H){ie=U(ie,te,H,W)}),ie}function F(W){return String(W).replace(/^ +| +$/g,"")}var j=function W(U){var ie=l,te=U&&typeof U=="object"&&C(U)!="String";te&&(ie=U,U=null);var H=ie.navigator||{},V=H.userAgent||"";U||(U=V);var w,Y,re=te?!!H.likeChrome:/\bChrome\b/.test(U)&&!/internal|\n/i.test(g.toString()),ee="Object",pe=te?ee:"ScriptBridgingProxyObject",ye=te?ee:"Environment",Q=te&&ie.java?"JavaPackage":C(ie.java),ze=te?ee:"RuntimeObject",nt=/\bJava/.test(Q)&&ie.java,Se=nt&&C(ie.environment)==ye,vt=nt?"a":"",ar=nt?"b":"",At=ie.document||{},Ie=ie.operamini||ie.opera,Oe=o.test(Oe=te&&Ie?Ie["[[Class]]"]:C(Ie))?Oe:Ie=null,mt=U,Je=[],Lt=null,Et=U==V,lt=Et&&Ie&&typeof Ie.version=="function"&&Ie.version(),$t=function(Br){return N(Br,function(Sr,kr){return Sr||RegExp("\\b"+(kr.pattern||A(kr))+"\\b","i").exec(U)&&(kr.label||kr)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),Ze=function(Br){return N(Br,function(Sr,kr){return Sr||RegExp("\\b"+(kr.pattern||A(kr))+"\\b","i").exec(U)&&(kr.label||kr)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),gt=nu([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),ir=function(Br){return N(Br,function(Sr,kr,su){return Sr||(kr[gt]||kr[/^[a-z]+(?: +[a-z]+\b)*/i.exec(gt)]||RegExp("\\b"+A(su)+"(?:\\b|\\w*\\d)","i").exec(U))&&su})}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),st=function(Br){return N(Br,function(Sr,kr){var su=kr.pattern||A(kr);return!Sr&&(Sr=RegExp("\\b"+su+"(?:/[\\d.]+|[ \\w.]*)","i").exec(U))&&(Sr=function(Vs,lv,uv){var dv={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return lv&&uv&&/^Win/i.test(Vs)&&!/^Windows Phone /i.test(Vs)&&(dv=dv[/[\d.]+$/.exec(Vs)])&&(Vs="Windows "+dv),Vs=String(Vs),lv&&uv&&(Vs=Vs.replace(RegExp(lv,"i"),uv)),_(Vs.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(Sr,su,kr.label||kr)),Sr})}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function nu(en){return N(en,function(Br,Sr){var kr=Sr.pattern||A(Sr);return!Br&&(Br=RegExp("\\b"+kr+" *\\d+[.\\w_]*","i").exec(U)||RegExp("\\b"+kr+" *\\w+-[\\w]*","i").exec(U)||RegExp("\\b"+kr+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(U))&&((Br=String(Sr.label&&!RegExp(kr,"i").test(Sr.label)?Sr.label:Br).split("/"))[1]&&!/[\d.]+/.test(Br[0])&&(Br[0]+=" "+Br[1]),Sr=Sr.label||Sr,Br=_(Br[0].replace(RegExp(kr,"i"),Sr).replace(RegExp("; *(?:"+Sr+"[_-])?","i")," ").replace(RegExp("("+Sr+")[-_.]?(\\w)","i"),"$1 $2"))),Br})}function iu(en){return N(en,function(Br,Sr){return Br||(RegExp(Sr+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(U)||0)[1]||null})}if($t&&($t=[$t]),/\bAndroid\b/.test(st)&&!gt&&(w=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(U))&&(gt=F(w[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),ir&&!gt?gt=nu([ir]):ir&&gt&&(gt=gt.replace(RegExp("^("+A(ir)+")[-_.\\s]","i"),ir+" ").replace(RegExp("^("+A(ir)+")[-_.]?(\\w)","i"),ir+" $2")),(w=/\bGoogle TV\b/.exec(gt))&&(gt=w[0]),/\bSimulator\b/i.test(U)&&(gt=(gt?gt+" ":"")+"Simulator"),Ze=="Opera Mini"&&/\bOPiOS\b/.test(U)&&Je.push("running in Turbo/Uncompressed mode"),Ze=="IE"&&/\blike iPhone OS\b/.test(U)?(ir=(w=W(U.replace(/like iPhone OS/,""))).manufacturer,gt=w.product):/^iP/.test(gt)?(Ze||(Ze="Safari"),st="iOS"+((w=/ OS ([\d_]+)/i.exec(U))?" "+w[1].replace(/_/g,"."):"")):Ze=="Konqueror"&&/^Linux\b/i.test(st)?st="Kubuntu":ir&&ir!="Google"&&(/Chrome/.test(Ze)&&!/\bMobile Safari\b/i.test(U)||/\bVita\b/.test(gt))||/\bAndroid\b/.test(st)&&/^Chrome/.test(Ze)&&/\bVersion\//i.test(U)?(Ze="Android Browser",st=/\bAndroid\b/.test(st)?st:"Android"):Ze=="Silk"?(/\bMobi/i.test(U)||(st="Android",Je.unshift("desktop mode")),/Accelerated *= *true/i.test(U)&&Je.unshift("accelerated")):Ze=="UC Browser"&&/\bUCWEB\b/.test(U)?Je.push("speed mode"):Ze=="PaleMoon"&&(w=/\bFirefox\/([\d.]+)\b/.exec(U))?Je.push("identifying as Firefox "+w[1]):Ze=="Firefox"&&(w=/\b(Mobile|Tablet|TV)\b/i.exec(U))?(st||(st="Firefox OS"),gt||(gt=w[1])):!Ze||(w=!/\bMinefield\b/i.test(U)&&/\b(?:Firefox|Safari)\b/.exec(Ze))?(Ze&&!gt&&/[\/,]|^[^(]+?\)/.test(U.slice(U.indexOf(w+"/")+8))&&(Ze=null),(w=gt||ir||st)&&(gt||ir||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(st))&&(Ze=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(st)?st:w)+" Browser")):Ze=="Electron"&&(w=(/\bChrome\/([\d.]+)\b/.exec(U)||0)[1])&&Je.push("Chromium "+w),lt||(lt=iu(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",A(Ze),"(?:Firefox|Minefield|NetFront)"])),(w=($t=="iCab"&&parseFloat(lt)>3?"WebKit":/\bOpera\b/.test(Ze)&&(/\bOPR\b/.test(U)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(U)&&!/^(?:Trident|EdgeHTML)$/.test($t)&&"WebKit"||!$t&&/\bMSIE\b/i.test(U)&&(st=="Mac OS"?"Tasman":"Trident")||$t=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(Ze)&&"NetFront")&&($t=[w]),Ze=="IE"&&(w=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(U)||0)[1])?(Ze+=" Mobile",st="Windows Phone "+(/\+$/.test(w)?w:w+".x"),Je.unshift("desktop mode")):/\bWPDesktop\b/i.test(U)?(Ze="IE Mobile",st="Windows Phone 8.x",Je.unshift("desktop mode"),lt||(lt=(/\brv:([\d.]+)/.exec(U)||0)[1])):Ze!="IE"&&$t=="Trident"&&(w=/\brv:([\d.]+)/.exec(U))&&(Ze&&Je.push("identifying as "+Ze+(lt?" "+lt:"")),Ze="IE",lt=w[1]),Et){if(function(Br,Sr){var kr=Br!=null?typeof Br[Sr]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(kr)||kr=="object"&&!Br[Sr])}(ie,"global"))if(nt&&(mt=(w=nt.lang.System).getProperty("os.arch"),st=st||w.getProperty("os.name")+" "+w.getProperty("os.version")),Se){try{lt=ie.require("ringo/engine").version.join("."),Ze="RingoJS"}catch{(w=ie.system)&&w.global.system==ie.system&&(Ze="Narwhal",st||(st=w[0].os||null))}Ze||(Ze="Rhino")}else typeof ie.process=="object"&&!ie.process.browser&&(w=ie.process)&&(typeof w.versions=="object"&&(typeof w.versions.electron=="string"?(Je.push("Node "+w.versions.node),Ze="Electron",lt=w.versions.electron):typeof w.versions.nw=="string"&&(Je.push("Chromium "+lt,"Node "+w.versions.node),Ze="NW.js",lt=w.versions.nw)),Ze||(Ze="Node.js",mt=w.arch,st=w.platform,lt=(lt=/[\d.]+/.exec(w.version))?lt[0]:null));else C(w=ie.runtime)==pe?(Ze="Adobe AIR",st=w.flash.system.Capabilities.os):C(w=ie.phantom)==ze?(Ze="PhantomJS",lt=(w=w.version||null)&&w.major+"."+w.minor+"."+w.patch):typeof At.documentMode=="number"&&(w=/\bTrident\/(\d+)/i.exec(U))?(lt=[lt,At.documentMode],(w=+w[1]+4)!=lt[1]&&(Je.push("IE "+lt[1]+" mode"),$t&&($t[1]=""),lt[1]=w),lt=Ze=="IE"?String(lt[1].toFixed(1)):lt[0]):typeof At.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(Ze)&&(Je.push("masking as "+Ze+" "+lt),Ze="IE",lt="11.0",$t=["Trident"],st="Windows");st=st&&_(st)}if(lt&&(w=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(lt)||/(?:alpha|beta)(?: ?\d)?/i.exec(U+";"+(Et&&H.appMinorVersion))||/\bMinefield\b/i.test(U)&&"a")&&(Lt=/b/i.test(w)?"beta":"alpha",lt=lt.replace(RegExp(w+"\\+?$"),"")+(Lt=="beta"?ar:vt)+(/\d+\+?/.exec(w)||"")),Ze=="Fennec"||Ze=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(st))Ze="Firefox Mobile";else if(Ze=="Maxthon"&&lt)lt=lt.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(gt))gt=="Xbox 360"&&(st=null),gt=="Xbox 360"&&/\bIEMobile\b/.test(U)&&Je.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(Ze)&&(!Ze||gt||/Browser|Mobi/.test(Ze))||st!="Windows CE"&&!/Mobi/i.test(U))if(Ze=="IE"&&Et)try{ie.external===null&&Je.unshift("platform preview")}catch{Je.unshift("embedded")}else(/\bBlackBerry\b/.test(gt)||/\bBB10\b/.test(U))&&(w=(RegExp(gt.replace(/ +/g," *")+"/([.\\d]+)","i").exec(U)||0)[1]||lt)?(st=((w=[w,/BB10/.test(U)])[1]?(gt=null,ir="BlackBerry"):"Device Software")+" "+w[0],lt=null):this!=I&&gt!="Wii"&&(Et&&Ie||/Opera/.test(Ze)&&/\b(?:MSIE|Firefox)\b/i.test(U)||Ze=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(st)||Ze=="IE"&&(st&&!/^Win/.test(st)&&lt>5.5||/\bWindows XP\b/.test(st)&&lt>8||lt==8&&!/\bTrident\b/.test(U)))&&!o.test(w=W.call(I,U.replace(o,"")+";"))&&w.name&&(w="ing as "+w.name+((w=w.version)?" "+w:""),o.test(Ze)?(/\bIE\b/.test(w)&&st=="Mac OS"&&(st=null),w="identify"+w):(w="mask"+w,Ze=Oe?_(Oe.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(w)&&(st=null),Et||(lt=null)),$t=["Presto"],Je.push(w));else Ze+=" Mobile";(w=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(U)||0)[1])&&(w=[parseFloat(w.replace(/\.(\d)$/,".0$1")),w],Ze=="Safari"&&w[1].slice(-1)=="+"?(Ze="WebKit Nightly",Lt="alpha",lt=w[1].slice(0,-1)):lt!=w[1]&&lt!=(w[2]=(/\bSafari\/([\d.]+\+?)/i.exec(U)||0)[1])||(lt=null),w[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(U)||0)[1],w[0]==537.36&&w[2]==537.36&&parseFloat(w[1])>=28&&$t=="WebKit"&&($t=["Blink"]),Et&&(re||w[1])?($t&&($t[1]="like Chrome"),w=w[1]||((w=w[0])<530?1:w<532?2:w<532.05?3:w<533?4:w<534.03?5:w<534.07?6:w<534.1?7:w<534.13?8:w<534.16?9:w<534.24?10:w<534.3?11:w<535.01?12:w<535.02?"13+":w<535.07?15:w<535.11?16:w<535.19?17:w<536.05?18:w<536.1?19:w<537.01?20:w<537.11?"21+":w<537.13?23:w<537.18?24:w<537.24?25:w<537.36?26:$t!="Blink"?"27":"28")):($t&&($t[1]="like Safari"),w=(w=w[0])<400?1:w<500?2:w<526?3:w<533?4:w<534?"4+":w<535?5:w<537?6:w<538?7:w<601?8:w<602?9:w<604?10:w<606?11:w<608?12:"12"),$t&&($t[1]+=" "+(w+=typeof w=="number"?".x":/[.+]/.test(w)?"":"+")),Ze=="Safari"&&(!lt||parseInt(lt)>45)?lt=w:Ze=="Chrome"&&/\bHeadlessChrome/i.test(U)&&Je.unshift("headless")),Ze=="Opera"&&(w=/\bzbov|zvav$/.exec(st))?(Ze+=" ",Je.unshift("desktop mode"),w=="zvav"?(Ze+="Mini",lt=null):Ze+="Mobile",st=st.replace(RegExp(" *"+w+"$"),"")):Ze=="Safari"&&/\bChrome\b/.exec($t&&$t[1])?(Je.unshift("desktop mode"),Ze="Chrome Mobile",lt=null,/\bOS X\b/.test(st)?(ir="Apple",st="iOS 4.3+"):st=null):/\bSRWare Iron\b/.test(Ze)&&!lt&&(lt=iu("Chrome")),lt&&lt.indexOf(w=/[\d.]+$/.exec(st))==0&&U.indexOf("/"+w+"-")>-1&&(st=F(st.replace(w,""))),st&&st.indexOf(Ze)!=-1&&!RegExp(Ze+" OS").test(st)&&(st=st.replace(RegExp(" *"+A(Ze)+" *"),"")),$t&&!/\b(?:Avant|Nook)\b/.test(Ze)&&(/Browser|Lunascape|Maxthon/.test(Ze)||Ze!="Safari"&&/^iOS/.test(st)&&/\bSafari\b/.test($t[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(Ze)&&$t[1])&&(w=$t[$t.length-1])&&Je.push(w),Je.length&&(Je=["("+Je.join("; ")+")"]),ir&&gt&&gt.indexOf(ir)<0&&Je.push("on "+ir),gt&&Je.push((/^on /.test(Je[Je.length-1])?"":"on ")+gt),st&&(w=/ ([\d.+]+)$/.exec(st),Y=w&&st.charAt(st.length-w[0].length-1)=="/",st={architecture:32,family:w&&!Y?st.replace(w[0],""):st,version:w?w[1]:null,toString:function(){var en=this.version;return this.family+(en&&!Y?" "+en:"")+(this.architecture==64?" 64-bit":"")}}),(w=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(mt))&&!/\bi686\b/i.test(mt)?(st&&(st.architecture=64,st.family=st.family.replace(RegExp(" *"+w),"")),Ze&&(/\bWOW64\b/i.test(U)||Et&&/\w(?:86|32)$/.test(H.cpuClass||H.platform)&&!/\bWin64; x64\b/i.test(U))&&Je.unshift("32-bit")):st&&/^OS X/.test(st.family)&&Ze=="Chrome"&&parseFloat(lt)>=39&&(st.architecture=64),U||(U=null);var an={};return an.description=U,an.layout=$t&&$t[0],an.manufacturer=ir,an.name=Ze,an.prerelease=Lt,an.product=gt,an.ua=U,an.version=Ze&&lt,an.os=st||{architecture:null,family:null,version:null,toString:function(){return"null"}},an.parse=W,an.toString=function(){return this.description||""},an.version&&Je.unshift(lt),an.name&&Je.unshift(Ze),st&&Ze&&(st!=String(st).split(" ")[0]||st!=Ze.split(" ")[0]&&!gt)&&Je.push(gt?"("+st+")":"on "+st),Je.length&&(an.description=Je.join(" ")),an}();t&&e?I(j,function(W,U){t[U]=W}):l.platform=j}).call(d)});function iP(){var a,p,l=sc.version||"";if(ag())try{var t=navigator.userAgent.match(/Electron\/([\d.]+\d+)/);t&&t[1]&&typeof t[1]=="string"&&(l=t[1])}catch{}return{os:((a=sc.os)===null||a===void 0?void 0:a.family)||"",osVer:((p=sc.os)===null||p===void 0?void 0:p.version)||"",browser:sc.name||"",browserVer:sc.version||"",libEnv:"BROWSER",hostEnv:ag()?"Electron":WS()?"H5":JS()?"BROWSER":"Unset",hostEnvEnum:ag()?5:WS()?101:JS()?100:0,hostEnvVer:l,userAgent:navigator&&navigator.userAgent,model:l,manufactor:sc.name||""}}var El=null,Cl=null,sP={getNetworkStatus:function(){return He.resolve({net_type:0,net_connect:typeof navigator>"u"||typeof navigator.onLine!="boolean"||navigator.onLine})},onNetworkStatusChange:function(p){El=function(){p({isConnected:!0,networkType:0})},Cl=function(){p({isConnected:!1,networkType:0})},window.addEventListener("online",El),window.addEventListener("offline",Cl)},offNetworkStatusChange:function(){El&&window.removeEventListener("online",El),Cl&&window.removeEventListener("offline",Cl),El=null,Cl=null}},oP=ms.find,aP="find",QS=!0;aP in[]&&Array(1).find(function(){QS=!1}),je({target:"Array",proto:!0,forced:QS},{find:function(p){return oP(this,p,arguments.length>1?arguments[1]:void 0)}});var cP=Gr("Array").find,cg=Array.prototype,bl=function(a){var p=a.find;return a===cg||ge(cg,a)&&p===cg.find?cP:p},aa="log",lP=function(){function a(l,t){this.db=null,this.stores=[],this.name=l,this.version=t}var p=a.prototype;return p.setName=function(t){this.name=t},p.getDB=function(){if(!this.db)throw new Error("DB not ready");return this.db},p.getStore=function(t){var e,r=bl(e=this.stores).call(e,function(i){return i.storeName===t});if(!r)throw new Error("LogStorage: store not found. "+t);return r},p.open=function(){var t=this,e=window.indexedDB.open(this.name,this.version);return new He(function(r,i){e.onerror=function(o){var u=o.target;i(u.error)},e.onsuccess=function(o){var u,h,g=o.target;t.db=g.result,t.db.removeEventListener("close",et(u=t.triggerDBCloseEvt).call(u,t)),t.db.addEventListener("close",et(h=t.triggerDBCloseEvt).call(h,t)),t.stores.push(new uP(aa,t)),r()},e.onupgradeneeded=function(o){var u=o.target;t.upgradeDBBySchema(u)}})},p.triggerDBCloseEvt=function(){try{this.db&&this.db.close(),this.db=null}catch{}this.open()},p.upgradeDBBySchema=function(t){var e=t.result,r=t.transaction&&e.objectStoreNames.contains(aa)?t.transaction.objectStore(aa):e.createObjectStore(aa,{keyPath:"id",autoIncrement:!0});try{r.index("time")}catch{r.createIndex("time","time",{unique:!1})}},p.close=function(){var t;this.db&&(this.db.removeEventListener("close",et(t=this.triggerDBCloseEvt).call(t,this)),this.db.close(),this.stores=[],this.db=null)},a}(),uP=function(){function a(l,t){this.idb=null,this.storeName=l,this.idb=t}var p=a.prototype;return p.getDB=function(){if(!this.idb)throw new Error("DB not ready");return this.idb.getDB()},p.getStoreName=function(){return this.storeName},p.bulkCreate=function(t){var e=this.getDB(),r=this.getStoreName(),i=e.transaction(r,"readwrite"),o=i.objectStore(r);return ae(t).call(t,function(u){o.add(u)}),new He(function(u,h){i.oncomplete=function(){u()},i.onerror=function(g){var v=g.target;h(v.error)},i.onabort=function(g){var v=g.target;v.error instanceof Error?h(v.error):h(new Error("TransactionAborted"))}})},p.bulkDelete=function(t){var e=t.keyName,r=t.lower,i=t.upper,o=t.lowerOpen,u=o!==void 0&&o,h=t.upperOpen,g=h!==void 0&&h,v=IDBKeyRange.bound(r,i,u,g),_=this.getDB(),I=this.getStoreName(),C=_.transaction(I,"readwrite"),A=C.objectStore(I).index(e).openCursor(v),N=0;return A.onsuccess=function(F){var j=F.target.result;j&&(j.delete(),N++,j.continue())},new He(function(F,j){C.oncomplete=function(){F(N)},C.onerror=function(W){var U=W.target;j(U.error)},C.onabort=function(W){var U=W.target;U.error instanceof Error?j(U.error):j(new Error("TransactionAborted"))}})},p.readAllAndClear=function(){var t=this.getDB(),e=this.getStoreName(),r=t.transaction(e,"readwrite").objectStore(e);if(!r.getAll)throw new Error("IDBExtract not support");var i=r.getAll();return new He(function(o,u){i.onsuccess=function(h){var g=h.target;r.clear(),o(g.result)},i.onerror=function(h){var g=h.target;u(g.error)}})},a}(),dP=function(){function a(l){l===void 0&&(l="nim-logs"),this.idb=new lP(l,1)}var p=a.prototype;return p.open=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t&&this.idb.setName(t),o.next=3,this.idb.open();case 3:return r=this.idb.getStore(aa),o.prev=4,o.next=7,r.bulkDelete({keyName:"time",lower:0,upper:Dt()-2592e5});case 7:o.next=11;break;case 9:o.prev=9,o.t0=o.catch(4);case 11:case"end":return o.stop()}},e,this,[[4,9]])}))},p.close=function(){this.idb.close()},p.addLogs=function(t){return this.idb.getStore(aa).bulkCreate(t)},p.extractLogs=function(){return k(this,void 0,void 0,T.mark(function t(){var e,r,i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return r=this.idb.getStore(aa),g.next=3,r.readAllAndClear();case 3:if((i=g.sent).length!==0){g.next=6;break}return g.abrupt("return","");case 6:return o=Cr(i).call(i,function(v,_){var I=_.iid;return v[I]||(v[I]=[]),v[I].push(_),v},{}),u=se(e=pt(o)).call(e,function(v){var _=o[v];return"==========iid:"+v+`==========
 `+se(_).call(_,function(I){return I.text}).join(`
`)}).join(`
`),g.abrupt("return",new File([u],"nim-logs.txt",{type:"text/plain"}));case 9:case"end":return g.stop()}},t,this)}))},a}();function lg(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return zS(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?zS(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zS(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}var ug={},oc={};function dg(a,p,l,t){var e=ug[a];if(!e)return l.error("createCmd:: can not find cmd config: ",a),null;var r,i={SER:p,SID:e.sid,CID:e.cid,Q:[]};return e.params&&t&&ae(r=e.params).call(r,function(o){var u=t[o.name];if(u!=null){var h=o.type,g=o.reflectMapper,v=o.select;switch(o.type){case"PropertyArray":h="ArrayMable",u=se(u).call(u,function(_){return{t:"Property",v:g?tn(_,g,v):_}});break;case"Property":u=g?tn(u,g,v):u;break;case"Bool":u=u?"true":"false"}i.Q.push({t:h,v:u})}}),{packet:i,hasPacketResponse:typeof e.hasPacketResponse!="boolean"||e.hasPacketResponse,hasPacketTimer:typeof e.hasPacketTimer!="boolean"||e.hasPacketTimer}}function pg(a,p){var l,t;try{t=JSON.parse(a)}catch{return void p.error('Parse command error:"'+a+'"')}var e=t.sid+"_"+t.cid,r=t.r;if(_t(l=["4_1","4_2","4_10","4_11"]).call(l,e)){var i=t.r[1].headerPacket;e=i.sid+"_"+i.cid,t.sid=i.sid,t.cid=i.cid,r=t.r[1].body}var o=oc[e],u=[];if(o){for(var h,g=lg(o);!(h=g()).done;){var v=h.value;u.push(pP(t,v.config,v.cmd,r,p))}return u}p.error("parseCmd:: mapper not exist",e,t.code)}function pP(a,p,l,t,e){var r,i={cmd:l,raw:a,error:null,service:p==null?void 0:p.service,content:{},__receiveTimeNode:DS.getTimeNode()};if(!l||!p)return i.notFound=!0,i;(p.sid===18||p.sid>=26&&p.sid<100)&&(a.code=function(g){if(typeof g!="number"||g!=g)throw new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:""+g}});if(g<0||g>=0&&g<1e3||g>=2e4&&g<=20099)return g;var v=(65535&g)>>9;return v-=v<=38?1:2,1e5+1e3*v+(511&g)}(a.code));var o,u=function(g,v){var _=Km[g],I=vS[g];return I===null?null:new Me({code:g,desc:_||I||g,detail:{cmd:v,timetag:Dt()}})}(a.code,l);if(i.error=u,i.error){if(i.error.detail.cmd=l,!(!((r=p==null?void 0:p.ignoreErrCodes)===null||r===void 0)&&_t(r).call(r,a.code)))return i;e.warn("parseCmd:: ignore error ",i.error),i.error.detail.ignore=!0}return p.response&&ae(o=p.response).call(o,function(h,g){var v=t[g],_=h.type,I=h.name,C=h.reflectMapper;if(v!==void 0)switch(_){case"Property":i.content[I]=C?xt(v,C):v;break;case"PropertyArray":i.content[I]=se(v).call(v,function(A){return C?xt(A,C):A});break;case"Int":case"Long":case"Byte":i.content[I]=+v;break;case"Bool":i.content[I]=v==="true"||v===!0||v===1;break;default:i.content[I]=v}}),i}function tn(a,p,l){var t={};for(var e in a=function(h,g){var v={};for(var _ in g){for(var I,C=g[_],A=typeof C=="number"?_:C.access?C.access:_,N=h,F=lg(A.split("."));!(I=F()).done;){var j=I.value;if(N[j]===void 0||N[j]===null){N=void 0;break}N=N[j]}N!==void 0&&(v[A]=N)}return v}(a,p),p){var r=p[e],i=typeof r=="number"?e:r.access?r.access:e;if(!l||_t(l).call(l,e))if(i in a){if(typeof r=="number")t[r]=a[i];else if(typeof r=="object")if(r.converter){var o=r.converter(a[i],a);o!==void 0&&(t[r.id]=o)}else t[r.id]=a[i]}else typeof r=="object"&&r.def&&(typeof r.def=="function"?t[r.id]=r.def(a):t[r.id]=r.def)}return t}function xt(a,p){var l={};for(var t in a){var e=p[t];if(typeof e=="string")l[e]=a[t];else if(typeof e=="object"&&"prop"in e){var r=e.access?e.access:e.prop;if(e.converter){var i=e.converter(a[t],a);i!==void 0&&(l[r]=i)}else e.type&&e.type==="number"?l[r]=+a[t]:e.type&&e.type==="boolean"?l[r]=!(a[t]==="0"||!a[t]):l[r]=a[t]}}for(var o in p){var u=p[o];if(u&&u.def!==void 0){var h=u.access?u.access:u.prop;h in l||(typeof u.def=="function"?l[h]=u.def(a):l[h]=u.def)}}return l=function(v){var _={},I=function(N){var F=N.split(".");Cr(F).call(F,function(j,W,U){return j[W]||(j[W]=isNaN(Number(F[U+1]))?F.length-1==U?v[N]:{}:[])},_)};for(var C in v)I(C);return _}(l),l}function Kt(a){for(var p in O(ug,a.cmdConfig),a.cmdMap){var l=a.cmdMap[p],t=a.cmdConfig[l];if(t)if(qt(oc[p])){for(var e,r=!1,i=lg(oc[p]);!(e=i()).done;){var o=e.value;if(o.cmd===l&&o.config.service===t.service){r=!0;break}}r||oc[p].push({config:t,cmd:l})}else oc[p]=[{config:t,cmd:l}]}}function rn(a){var p,l={};return ae(p=pt(a)).call(p,function(t){l[t]=Te(a[t])}),l}function Te(a){var p={};for(var l in a){var t=a[l];typeof t=="number"?p[t]=l:typeof t=="object"&&(p[t.id]={prop:l,type:t.retType,access:t.retAccess?t.retAccess:t.access?t.access:l,def:t.retDef,converter:t.retConverter})}return p}function Zt(a){return a?1:0}function XS(a){return it(a)===1}function xi(a){if(a&&typeof a=="object")try{return xe(a)}catch{return}}function lo(a){if(a&&typeof a=="string")try{return JSON.parse(a)}catch{return}}var uo,Qr,ac,Lr,mi,hP={"1_2":"heartbeat","2_3":"login","2_5":"kicked","2_6":"logout","2_7":"nimLoginClientChange","2_8":"kick"},ZS={login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,loginTime:109,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,connectionId:102,ip:103,port:104,time:109,pushType:110,hasTokenPreviously:111},aosPushInfo:{pushType:110,hasTokenPreviously:111}},Od=rn(ZS),fP={login:{sid:2,cid:3,service:"auth",params:[{type:"Property",name:"login",reflectMapper:ZS.login}],response:[{type:"Property",name:"loginRes",reflectMapper:Od.loginRes},{type:"PropertyArray",name:"loginPorts",reflectMapper:Od.loginPort},{type:"Property",name:"aosPushInfo",reflectMapper:Od.aosPushInfo}]},logout:{sid:2,cid:6,service:"auth"},heartbeat:{sid:1,cid:2,service:"auth"},kicked:{sid:2,cid:5,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"ext"},{type:"Int",name:"customClientType"}]},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Od.loginPort}]},kick:{sid:2,cid:8,service:"auth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]}};function Yt(a,p){if(!oa(p))return{};var l=JSON.parse(xe(p)),t=e0(a,l);return JSON.parse(xe(O(O({},l),t)))}function e0(a,p){if(!oa(p))return{};var l={},t=pt(a);return ae(t).call(t,function(e){var r=a[e].type;if(typeof r!="string"){var i=e0(a[e],p);pt(i).length>0&&(l[e]=i)}else{var o=a[e],u=o.rawKey||e,h=mP[r](p,u,o);h!==void 0&&(p[u]=void 0,l[e]=h)}}),l}(function(a){a[a.text=0]="text",a[a.image=1]="image",a[a.audio=2]="audio",a[a.video=3]="video",a[a.geo=4]="geo",a[a.notification=5]="notification",a[a.file=6]="file",a[a.tip=10]="tip",a[a.robot=11]="robot",a[a.g2=12]="g2",a[a.custom=100]="custom"})(uo||(uo={})),function(a){a[a.p2p=0]="p2p",a[a.team=1]="team",a[a.superTeam=5]="superTeam"}(Qr||(Qr={})),function(a){a[a.Android=1]="Android",a[a.iOS=2]="iOS",a[a.PC=4]="PC",a[a.WindowsPhone=8]="WindowsPhone",a[a.Web=16]="Web",a[a.Server=32]="Server",a[a.Mac=64]="Mac",a[a.HarmonyOS=65]="HarmonyOS"}(ac||(ac={})),function(a){a[a.unread=1]="unread",a[a.read=2]="read",a[a.deleted=3]="deleted",a[a.sending=4]="sending",a[a.sendFailed=5]="sendFailed",a[a.sent=6]="sent",a[a.receipt=7]="receipt",a[a.refused=10]="refused"}(Lr||(Lr={})),function(a){a[a.default=0]="default",a[a.leave=1]="leave",a[a.roam=2]="roam"}(mi||(mi={}));var mP={number:function(p,l){if(p[l]!==void 0)return+p[l]},string:function(p,l){if(p[l]!==void 0)return p[l]},boolean:function(p,l){return+p[l]>0||+p[l]!=0&&void 0},enum:function(p,l,t){return fi(t)[p[l]]},object:function(p,l){if(p[l]!==void 0)try{return JSON.parse(p[l])}catch{return{}}}};function Is(a,p){if(!oa(p))return{};var l=JSON.parse(xe(p)),t=t0(a,l);return JSON.parse(xe(O(O({},l),t)))}function t0(a,p){var l;if(!oa(p))return Cr(l=pt(a)).call(l,function(r,i){return r[a[i].rawKey||i]=void 0,r},{});var t={},e=pt(a);return ae(e).call(e,function(r){var i=a[r].type;if(typeof i!="string"){var o=t0(a[r],p[r]);return O(t,o),void(p[r]=void 0)}var u=a[r],h=u.rawKey||r,g=r0[i](p,r,u);p[h]=void 0,t[h]=g}),t}var r0={number:function(p,l){return p[l]},string:function(p,l){return p[l]},boolean:function(p,l){return p[l]===!0?1:p[l]===!1?0:void 0},enum:function(p,l,t){return fi(t)[p[l]]},object:function(p,l){if(p[l]!==void 0)try{return xe(p[l])}catch{return""}}},wd=r0;function n0(a,p){return a&&a.length>0?se(a).call(a,function(l){return O(O({},l),{account:l.account,connectionId:l.connectionId,deviceId:l.deviceId,ip:l.ip,mac:l.mac,os:l.os,type:ic(ac,l.type)||l.type,time:it(l.time),online:p!==3})}):[]}var gP={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}},xd=cc;function cc(a){a=a||{},this.ms=a.min||100,this.max=a.max||1e4,this.factor=a.factor||2,this.jitter=a.jitter>0&&a.jitter<=1?a.jitter:0,this.attempts=0}cc.prototype.duration=function(){var a=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var p=Math.random(),l=Math.floor(p*this.jitter*a);a=(1&Math.floor(10*p))==0?a-l:a+l}return 0|Math.min(a,this.max)},cc.prototype.reset=function(){this.attempts=0},cc.prototype.setMin=function(a){this.ms=a},cc.prototype.setMax=function(a){this.max=a},cc.prototype.setJitter=function(a){this.jitter=a};var nn,hg=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],fg=["transport not supported","client not handshaken","unauthorized"],i0=["reconnect"],s0=function(a){function p(t,e,r){var i;return(i=a.call(this)||this).websocket=null,i.socketConnectTimer=0,i.url="",i.linkSSL=!0,i.core=t,i.url=e,i.linkSSL=r,i.status="disconnected",i.logger=t.logger,i.connect(),i}bt(p,a);var l=p.prototype;return l.connect=function(){var e=this;this.status!=="connecting"&&this.status!=="connected"?(this.status="connecting",this.core.adapters.request((this.linkSSL?"https":"http")+"://"+this.url+"/socket.io/1/?t="+Dt(),{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then(function(r){if(e.status==="connecting"){var i=r.data.split(":"),o=i[0];return i[1],e.sessionId=o,e.logger.log("imsocket::XHR success. status "+e.status+", "+(e.status==="connecting"?"continue websocket connection":"stop websocket connection")),e._createWebsocket((e.linkSSL?"wss":"ws")+"://"+e.url+"/socket.io/1/websocket/"+o)}}).catch(function(r){if(e.status==="connecting"){var i='imsocket::XHR fail. raw message: "'+(r=r||{}).message+'", code: "'+r.code+'"',o=r.code;o=Pe(e.core,"options.apiVersion")==="v2"?r.code===ce.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?ce.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:ce.V2NIM_ERROR_CODE_CONNECT_FAILED:r.code===408?408:415;var u=new Me({code:o,detail:{reason:i,rawError:r}});e.logger.error(i),e.status="disconnected",e.emit("handshakeFailed",u)}})):this.logger.warn("imsocket::socket is connecting or connected",this.status)},l.close=function(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(e){this.logger.warn("imsocket::attempt to send encodePacket error",e)}try{this.websocket.close()}catch(e){this.logger.warn("imsocket::attempt to close websocket error",e)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}},l.clean=function(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},l.onConnect=function(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},l._createWebsocket=function(e){var r,i=this;this.socketConnectTimer=or(function(){i.logger.error("imsocket::Websocket connect timeout. url: ",i.socketUrl),i.emit("handshakeFailed",new Me({code:Pe(i.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+i.socketUrl}}))},this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new We.WebSocket(e),this.websocket.onmessage=et(r=this.onMessage).call(r,this),this.websocket.onclose=function(o){o=o||{},i.logger.log("imsocket::Websocket onclose done "+o.wasClean+"/"+o.code+"/"+o.reason),i.clean(),i.emit("disconnect",{code:o.code||0,reason:o.reason})},this.websocket.onerror=function(o){i.logger.error("imsocket::Websocket onerror",o),i.core.status==="logined"&&i.core.clientSocket.ping()}},l.onMessage=function(e){var r,i=this.decodePacket(e.data);if(i)switch(i.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",i.data);break;case"event":i.name&&this.emit(i.name,i.args);break;case"error":i.reason==="unauthorized"?this.emit("connect_failed",i.reason):this.emit("error",i.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new Me({code:Pe(this.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:"imsocket::Websocket connect failed, onMessage socket error. url: "+this.socketUrl}}));break;case"heartbeat":(r=this.websocket)===null||r===void 0||r.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",i.type)}},l.encodePacket=function(e){var r,i,o=e.type,u=e.id,h=u===void 0?"":u,g=e.endpoint,v=g===void 0?"":g,_=e.ack,I=null;if(!o)return"";switch(o){case"error":r=e.reason?wt(fg).call(fg,e.reason):"",i=e.advice?wt(i0).call(i0,e.advice):"",r===""&&i===""||(I=r+(i!==""?"+"+i:""));break;case"message":e.data!==""&&(I=e.data);break;case"event":r={name:e.name},r=e.args&&e.args.length?{name:e.name,args:e.args}:{name:e.name},I=xe(r);break;case"json":I=xe(e.data);break;case"connect":e.qs&&(I=e.qs);break;case"ack":I=e.ackId+(e.args&&e.args.length?"+"+xe(e.args):"")}var C=[wt(hg).call(hg,o),h+(_==="data"?"+":""),v];return I!=null&&C.push(I),C.join(":")},l.decodePacket=function(e){if(e)if(e.charAt(0)!=""){var r=e.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(r){var i,o=r[1],u=r[2],h=r[3],g=r[4],v=r[5],_={type:hg[+o],endpoint:g};switch(u&&(_.id=u,_.ack=!h||"data"),_.type){case"error":i=v.split("+"),_.reason=fg[+i[0]]||"";break;case"message":_.data=v||"";break;case"connect":_.qs=v||"";break;case"event":try{var I=JSON.parse(v);_.name=I.name,_.args=I.args}catch(C){this.logger.error("imsocket::parseData::type::event error",C)}_.args=_.args||[];break;case"json":try{_.data=JSON.parse(v)}catch(C){this.logger.error("imsocket::parseData::type::json error",C)}break;case"ack":if((i=v.match(/^([0-9]+)(\+)?(.*)/))&&(_.ackId=i[1],_.args=[],i[3]))try{_.args=i[3]?JSON.parse(i[3]):[]}catch(C){this.logger.error("imsocket::parseData::type::ack error",C)}}return _}}else this.logger.error("imsocket::unrecognize dataStr",ht(e).call(e,0,20))},l.send=function(e){var r,i={data:e,type:"message",endpoint:""};(r=this.websocket)===null||r===void 0||r.send(this.encodePacket(i))},p}(ia);function po(a){a=a||[];for(var p=[],l=0;l<a.length;l++)wt(p).call(p,a[l])===-1&&p.push(a[l]);return p}function vP(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return o0(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?o0(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o0(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}(function(a){a[a.ACTIVE=1]="ACTIVE",a[a.KICKED=2]="KICKED",a[a.OFFLINE=3]="OFFLINE"})(nn||(nn={}));var yP=function(){function a(l,t){this.linkUrls=[],this.isAutoReconnect=!1,this.packetTimeout=3e4,this.linkSSL=!0,this.packetSer=1,this.retryCount=0,this.reconnectTimer=0,this.backoff=new xd({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Dr,this.pingTimer=0,this.hasNetworkListener=!1,this.core=l,t&&(this.auth=t),this.logger=l.logger,this.reporter=l.reporter,this.timerManager=l.timerManager}var p=a.prototype;return p.setSessionId=function(t){},p.setLinkSSL=function(t){this.linkSSL=t},p.connect=function(t,e){return t===void 0&&(t={}),k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(P({linkUrls:{type:"array",itemType:"string",required:!1}},t),/^(unconnected|waitReconnect)$/.test(this.core.status)){I.next=5;break}return i="Core socket status is "+this.core.status+", and would not connect",this.logger.warn(i),I.abrupt("return",He.reject(i));case 5:this.core.status="connecting",t.linkUrls&&t.linkUrls.length>0&&(this.linkUrls=dt(o=t.linkUrls).call(o,this.linkUrls),this.linkUrls=po(this.linkUrls)),this.linkUrls.length===0&&this.linkUrls.push(tg),u=0;case 9:if(!(u<this.linkUrls.length)){I.next=31;break}return h=this.linkUrls[u],g=new Date().getTime(),I.prev=12,I.next=15,this.doConnect(h);case 15:return this.core.status="connected",this.logger.log("clientsocketV1::connect success with url: "+h),I.abrupt("return",h);case 20:I.prev=20,I.t0=I.catch(12),v=I.t0,e&&e(v,h),this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,start_time:g,action:0,exception_service:6}),this.reporter.reportTraceUpdateV2("exceptions",{code:typeof v.code=="number"?v.code:0,description:v.message||""+v.code,operation_type:0,target:h},{asyncParams:We.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn("clientsocketV1::connect failed with url: "+h,I.t0);case 28:u++,I.next=9;break;case 31:throw this.retryCount===0?this.doDisconnect(nn.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(nn.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("clientSocketV1::socket xhr or socket connect failed");case 33:case"end":return I.stop()}},r,this,[[12,20]])}))},p.doConnect=function(t){var e=this,r=!1;return new He(function(i,o){var u;e.socket=new s0(e.core,t,e.linkSSL),e.socket.on("connect",function(){e.logger.log("clientSocketV1::on connect",t),e.core.reporterHookLinkKeep&&(e.core.reporterHookLinkKeep.start(),e.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:t})),r=!0,i()}),e.socket.on("message",et(u=e.onMessage).call(u,e)),e.socket.on("disconnect",function(h){return k(e,void 0,void 0,T.mark(function g(){return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(this.logger.log("clientSocketV1::socket on disconnect",h),!this.core.reporterHookLinkKeep){_.next=5;break}return _.next=4,this.core.reporterHookLinkKeep.update({code:(h==null?void 0:h.code)||0,description:(h==null?void 0:h.reason)||"socket on disconnect",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1);case 5:r=!0,this.doDisconnect(nn.OFFLINE,"SocketOnDisconnect");case 7:case"end":return _.stop()}},g,this)}))}),e.socket.on("handshakeFailed",function(h){r?e.ping():(e.logger.error('clientsocketV1::handshake failed: "'+(h&&h.message)+'"'),e.cleanSocket()),r=!0,o(h)})})},p.cleanSocket=function(){this.socket&&(typeof this.socket.removeAllListeners=="function"&&this.socket.removeAllListeners(),typeof this.socket.close=="function"&&this.socket.close(),this.socket=void 0)},p.beforeConnect=function(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},p.resetConnectStatus=function(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},p.doDisconnect=function(t,e,r){var i,o,u,h,g;if(this.logger.log("doDisconnect: type "+t+", description "+e),this.core.status!=="unconnected"){var v={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new Me({code:415,desc:"Packet timeout due to instance disconnect",detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:v}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket();var _=!this.core.options.needReconnect||this.retryCount>=this.core.options.reconnectionAttempts;if(t===nn.ACTIVE||_)this.logger.log("doDisconnect: emit disconnect, type "+t,_),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),(i=this.auth)===null||i===void 0||i.emit("disconnect"),this.destroyOnlineListener();else if(t===nn.KICKED){this.logger.log("doDisconnect: kicked"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var I=typeof e=="string"?{reason:"unknow",message:e}:e;this.core.eventBus.emit("kicked",I),this.core.emit("kicked",I),(o=this.auth)===null||o===void 0||o.emit("kicked",I),this.destroyOnlineListener()}else t===nn.OFFLINE&&this.core.V1NIMLoginService.isManualLoginAttempt?(this.logger.log("doDisconnect: offline in manual login phase. no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener()):t===nn.OFFLINE&&(!((h=(u=this.auth)===null||u===void 0?void 0:u.authenticator)===null||h===void 0)&&h.checkLoginTerminalCode(r==null?void 0:r.code))?(this.logger.log("doDisconnect: login terminal code "+(r==null?void 0:r.code)+", no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener(),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),(g=this.auth)===null||g===void 0||g.emit("disconnect")):t===nn.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")},p.attempToReconnect=function(){var t,e,r=this;if(this.core.status!=="waitReconnect"){this.retryCount===0&&(this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),(t=this.auth)===null||t===void 0||t.emit("disconnect"));var i=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+i),this.core.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:i}),this.core.emit("willReconnect",{retryCount:this.retryCount,duration:i}),(e=this.auth)===null||e===void 0||e.emit("willReconnect",{retryCount:this.retryCount,duration:i}),this.core.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=or(function(){return k(r,void 0,void 0,T.mark(function o(){var u=this;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.core.status==="waitReconnect"){g.next=3;break}return this.logger.warn("doDisconnect: reconnectTimer status is "+this.core.status+", would not go on reconnecting"),g.abrupt("return");case 3:return g.next=5,We.net.getNetworkStatus();case 5:g.sent.net_connect===!1?(this.logger.log("doDisconnect: skip this reconnection attempt because network is offline"),this.core.status="connecting",this.retryCount>=this.core.options.reconnectionAttempts?this.doDisconnect(nn.OFFLINE,"MaxReconnectionAttemptExceed"):this.attempToReconnect()):this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch(function(){u.logger.error("clientsocketV1::attempToReconnect failed "+u.retryCount)});case 7:case"end":return g.stop()}},o,this)}))},i)}else this.logger.warn("doDisconnect: already is waiting reconnect")},p.sendCmd=function(t,e,r){var i=this;if(this.core.status!=="logined"&&t!=="login"&&t!=="chatroomLogin"&&t!=="qchatLogin")return this.logger.warn("instance status is "+this.core.status+", so can not sendCmd "+t),He.reject({cmd:t,error:{code:"No_connected",message:"Connection not established",timetag:new Date().getTime()}});if(!this.socket||!this.socket.send)return He.reject("No_socket");var o=t!=="heartbeat",u=o?this.packetSer++:0,h=dg(t,u,this.logger,e);if(!h){var g="SendCmd "+u+" "+t+" error";return this.logger.error(g),He.reject(new Error(g))}var v=h.packet,_=h.hasPacketResponse,I=h.hasPacketTimer,C=xe(v);o&&(this.logger.getDebugMode()?this.logger.debug("clientsocketV1::sendCmd",t,"ser:"+u,C):this.logger.log("clientsocketV1::sendCmd",t,"ser:"+u));var A=new Date().getTime();return new He(function(N,F){_&&i.sendingCmdMap.set(u,{cmd:t,params:e,callback:[N,F],timer:I?or(function(){var W=new Me({code:408,desc:"Packet Timeout",detail:{reason:"Packet Timeout",cmd:t,ser:u,timetag:Dt()}});i.markCmdInvalid(u,W,t)},r&&r.timeout?r.timeout:i.core.config.timeout):null});try{i.socket.send(C),_||N(v)}catch(W){var j=new Me({code:415,detail:{reason:W&&W.message||"Unable to send packet",cmd:t,ser:u,timetag:Dt(),rawError:W}});i.markCmdInvalid(u,j,t),F(W)}}).catch(function(N){var F,j=[408,415];if(!_t(j).call(j,N.code))return He.reject(N);i.reporter.reportTraceStart("exceptions",{user_id:i.core.options.account,trace_id:(F=i.socket)===null||F===void 0?void 0:F.sessionId,start_time:A,action:2,exception_service:6});var W=Pe(N,"data.disconnect_reason")||"",U=N.code===408?"Send failed due to timeout":"Send failed. Reason unknown";return U=N.code===415?xe({disconnect_reason:W}):U,i.reporter.reportTraceUpdateV2("exceptions",{code:N.code||415,description:U,operation_type:1,target:v.SID+"-"+v.CID,context:""+v.SER},{asyncParams:We.net.getNetworkStatus()}),i.reporter.reportTraceEnd("exceptions",1),He.reject(N)})},p.onMessage=function(t){var e=pg(t,this.logger);if(e)for(var r,i=vP(e);!(r=i()).done;){var o=r.value,u=o.raw.ser;if(o.error&&this.logger.error("core:onMessage packet error",o.raw.sid+"_"+o.raw.cid+", ser:"+u+",",o.error),o.notFound)return void this.logger.warn("clientsocketV1::onMessage packet not found",o.raw.sid+"_"+o.raw.cid+", ser:"+u);o.cmd!=="heartbeat"&&(this.logger.getDebugMode()?this.logger.debug("imsocket::recvCmd ser:"+u,o.cmd,o.content):this.logger.log("imsocket::recvCmd ser:"+u,o.cmd)),this.packetHandler(o)}},p.packetHandler=function(t){var e,r,i,o,u=this;if(t){var h=t.raw.ser,g=this.sendingCmdMap.get(h);if(g&&g.cmd===t.cmd){var v=g.callback,_=g.timer,I=g.params;if(clearTimeout(_),t.params=I,this.sendingCmdMap.delete(h),t.cmd==="heartbeat")return void v[0]();var C=(r=(e=this.core[t.service])===null||e===void 0?void 0:e.process)===null||r===void 0?void 0:r.call(e,t);C&&typeof C.then=="function"?C.then(function(N){v[0](N)}).catch(function(N){v[1](N)}):(this.logger.log("imsocket:: handlerFn without promise",t.service,t.cmd),v[0]())}else{var A=(o=(i=this.core[t.service])===null||i===void 0?void 0:i.process)===null||o===void 0?void 0:o.call(i,t);A&&typeof A.then=="function"&&A.catch(function(N){u.logger.error("imsocket::no obj cache, no process handler",N)})}}},p.markCmdInvalid=function(t,e,r){var i=this.sendingCmdMap.get(t);if(i){var o=i.callback,u=i.timer;u&&clearTimeout(u),this.sendingCmdMap.delete(t),this.logger.warn("packet "+t+", "+r+" is invalid:",e),o[1](e)}},p.markAllCmdInvaild=function(t){var e,r=this;this.logger.log("markAllCmdInvaild",t),ae(e=this.sendingCmdMap).call(e,function(i){var o=i.callback,u=i.timer,h=i.cmd;r.logger.log('markAllCmdInvaild:: cmd "'+h+'"'),u&&clearTimeout(u),o[1](t)}),this.sendingCmdMap.clear()},p.ping=function(){var t;return k(this,void 0,void 0,T.mark(function e(){var r=this;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return clearTimeout(this.pingTimer),o.prev=1,o.next=4,this.sendCmd("heartbeat");case 4:o.next=18;break;case 6:return o.prev=6,o.t0=o.catch(1),o.next=10,this.testHeartBeat5Timeout();case 10:if(!o.sent){o.next=18;break}if(!this.core.reporterHookLinkKeep){o.next=16;break}return o.next=15,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:(t=this.socket)===null||t===void 0?void 0:t.url});case 15:this.core.reporterHookLinkKeep.end(!0);case 16:return this.doDisconnect(nn.OFFLINE,"PingError"),o.abrupt("return");case 18:this.pingTimer=or(function(){r.ping()},3e4);case 19:case"end":return o.stop()}},e,this,[[1,6]])}))},p.testHeartBeat5Timeout=function(){return k(this,void 0,void 0,T.mark(function t(){var e;return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:clearTimeout(this.pingTimer),e=0;case 2:if(!(e<5)){i.next=15;break}return i.prev=3,i.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return i.abrupt("return",!1);case 9:i.prev=9,i.t0=i.catch(3),this.logger.log("clientsocketV1:: test heartbeat "+e+" Timeout");case 12:e++,i.next=2;break;case 15:return i.abrupt("return",!0);case 16:case"end":return i.stop()}},t,this,[[3,9]])}))},p.initOnlineListener=function(){var t=this;this.hasNetworkListener||(this.logger.log("clientsocketV1::onlineListener:init"),this.hasNetworkListener=!0,We.net.onNetworkStatusChange(function(e){t.logger.log("clientsocketV1::onlineListener:network change",e),e.isConnected&&t.core.status==="logined"?t.ping():e.isConnected&&t.core.status==="waitReconnect"?(t.reconnectTimer&&clearTimeout(t.reconnectTimer),t.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch(function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)})):e.isConnected||t.doDisconnect(nn.OFFLINE,"OfflineListener")}))},p.destroyOnlineListener=function(){this.logger.log("clientsocketV1::onlineListener:destroy"),We.net.offNetworkStatusChange(),this.hasNetworkListener=!1},p.disconnect=function(){switch(this.core.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(nn.ACTIVE,"UserActiveDisconnect"),He.resolve();default:return He.resolve()}},a}(),_P=function(){function a(l){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=l,this.auth=l.V1NIMLoginService,this.logger=this.core.logger}var p=a.prototype;return p.getLbsInfos=function(){return k(this,void 0,void 0,T.mark(function t(){var e,r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.socketLinkUrls.length>0)){h.next=5;break}return e=this.socketLinkUrls,this.socketLinkUrls=[],this.core.logger.log("V1NIMLoginService::getLbsInfos:use cache link",e),h.abrupt("return",He.resolve(e));case 5:return this.core.reporterHookLBS.start(this.core.account),r=po(this.auth.config.lbsUrls),h.prev=7,h.next=10,this.ladderLoad(r);case 10:if((i=h.sent).status===200&&i.data){h.next=14;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",i.status,i),new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V1NIMLoginService::getLbsInfos failed, status "+i.status}});case 14:this.success(i),h.next=25;break;case 17:if(h.prev=17,h.t0=h.catch(7),o=h.t0,this.core.logger.error("V1NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",h.t0),this.reportForFail(r[0],o.code,o.message),!this.checkTerminator(o.code)){h.next=24;break}throw h.t0;case 24:this.socketLinkUrls=[this.auth.config.linkUrl];case 25:return h.abrupt("return",this.socketLinkUrls);case 26:case"end":return h.stop()}},t,this,[[7,17]])}))},p.checkTerminator=function(t){return t===ce.V2NIM_ERROR_CODE_CANCELLED||t===ce.V2NIM_ERROR_CODE_TIMEOUT},p.generateUrl=function(t){return t+(wt(t).call(t,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},p.requstLbs=function(t){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(t),{method:"GET",dataType:"json",timeout:8e3}))},p.setLadderTimer=function(t,e,r,i){var o=this;this.timer&&clearTimeout(this.timer);var u=t[e];this.timer=or(function(){u&&(o.setLadderTimer(t,e+1,r,i),o.core.logger.log("V1NIMLoginService::getLbsInfos "+e+":",u),o.reportForLbsStart(u,e),o.requstLbs(u).then(function(h){o.reset(),r(O(O({},h),{url:u}))}).catch(function(h){var g;if(o.core.logger.warn("V1NIMLoginService::getLbsInfos "+e+" failed:",h),o.failedCount+=1,o.reportForFailOnce(u,h.code,((g=h.detail)===null||g===void 0?void 0:g.reason)||h.message),o.failedCount>=t.length||o.checkTerminator(h.code))return o.reset(),void i(h)}))},2e3)},p.ladderLoad=function(t){var e=this;return new He(function(r,i){t.length>1&&e.setLadderTimer(t,1,r,i);var o=t[0];e.core.logger.log("V1NIMLoginService::getLbsInfos 0:",o),e.reportForLbsStart(o,0),e.requstLbs(o).then(function(u){e.reset(),r(O(O({},u),{url:o}))}).catch(function(u){var h;e.failedCount+=1,e.core.logger.warn("V1NIMLoginService::getLbsInfos 0 failed:",u),e.reportForFailOnce(o,u.code,((h=u.detail)===null||h===void 0?void 0:h.reason)||u.message),(e.failedCount>=t.length||e.checkTerminator(u.code))&&(e.reset(),i(u))})})},p.success=function(t){var e,r,i,o,u=t.data,h=[this.auth.config.linkUrl];Pe(u,"common.link")&&(h=dt(o=Pe(u,"common.link")).call(o,h)),Pe(u,'common["link.default"]')&&(h=dt(h).call(h,Pe(u,'common["link.default"]'))),this.socketLinkUrls=h,u["nos-chunk"]&&(this.logger.log("getLbsInfos success. lbs.nos-chunk",u["nos-chunk"]),(r=this.core.cloudStorage)===null||r===void 0||r.setOptions({chunkUploadHost:u["nos-chunk"]})),qt(u.nosup)&&u.nosup.length>0&&(this.logger.log("getLbsInfos success. lbs.nosup",u.nosup),(i=this.core.cloudStorage)===null||i===void 0||i.setOptions({commonUploadHostBackupList:u.nosup,commonUploadHost:u.nosup[0]})),this.core.logger.log("V1NIMLoginService::getLbsInfos success, socket link:",ht(e=this.socketLinkUrls).call(e,0),"chunkUploadHost: ",t.data["nos-chunk"]),this.reportForLbsSuccess(t.url,t.data)},p.reportForLbsStart=function(t,e){this.core.reporterHookLBS.updateBegin({target:t,index:e})},p.reportForLbsSuccess=function(t,e){this.core.reporterHookLBS.updateComplete({target:t,code:200,body:xe(e)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,code:200,succeed:!0},{asyncParams:We.net.getNetworkStatus()})},p.reportForFailOnce=function(t,e,r){this.core.reporterHookLBS.updateComplete({target:t,code:e,body:r})},p.reportForFail=function(t,e,r){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,description:r,code:e,succeed:!1},{asyncParams:We.net.getNetworkStatus()})},p.reset=function(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},a}(),MP=function(){function a(l){this.core=l}var p=a.prototype;return p.verifyAuthentication=function(t){var e,r,i;return t===void 0&&(t=!1),k(this,void 0,void 0,T.mark(function o(){var u,h,g,v,_,I,C,A,N,F,j,W;return T.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return h=this.core.options,g=We.getSystemInfo(),v=O(O({},h),{appLogin:t?0:1,appkey:h.appkey,account:h.account,token:h.token,deviceId:this.core.auth.deviceId,clientSession:this.core.auth.clientSession,clientType:16,protocolVersion:1,sdkVersion:100830,sdkHumanVersion:"10.8.30",os:g.os,browser:g.browser,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.8.30":ht(u=g.userAgent.replace("{{appkey}}",h.appkey)).call(u,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:g.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:g.hostEnvEnum}),_=g.os.toLowerCase(),We.platform!=="UNIAPP"||_!=="ios"&&_!=="android"||(v.isReactNative=1,v.clientType=_==="ios"?2:1,I=!!(!((e=this.core.offlinePush.authConfig)===null||e===void 0)&&e.honorCertificateName),g.pushDeviceInfo&&g.pushDeviceInfo.MANUFACTURER&&(v.deviceInfo=xe(O({IS_SUPPORT_HONOR:I},g.pushDeviceInfo)))),this.core.logger.log("clientSocketV1::do login ",h.account,(i=(r=this.core.clientSocket)===null||r===void 0?void 0:r.socket)===null||i===void 0?void 0:i.sessionId),ie.next=8,this.core.clientSocket.sendCmd("login",{login:v});case 8:if(!(C=ie.sent).error){ie.next=11;break}throw C.error;case 11:return A=C.content,N=A.loginRes,F=A.loginPorts,j=A.aosPushInfo,W=n0(F,2),(W=at(W).call(W,function(te){return te.connectionId!==N.connectionId})).length>0&&this.core.emit("multiPortLogin",W),ie.abrupt("return",O(O({},N),{aosPushInfo:j}));case 16:case"end":return ie.stop()}},o,this)}))},p.checkLoginTerminalCode=function(t){if(t===void 0)return!1;var e=[201,302,317,403,404,417,422];return _t(e).call(e,t)},a}(),$r=function(a){function p(t,e){var r;return(r=a.call(this)||this).name=t,r.logger=e.logger,r.core=e,r}bt(p,a);var l=p.prototype;return l.checkV2=function(){var e=this.core.options.apiVersion;if(e==="v2")return!0;throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'The version "'+e+'" of client is not supported.'}})},l.checkLogin=function(){if(this.core.V2NIMLoginService.getLoginStatus()===0)throw new Me({code:ce.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Client logout."}})},l.emit=function(e){for(var r=this,i=arguments.length,o=new Array(i>1?i-1:0),u=1;u<i;u++)o[u-1]=arguments[u];this.logger.debug(this.name+"::emit event: '"+e.toString()+"',",o[0]!==void 0?o[0]:"",o[1]!==void 0?o[1]:"",o[2]!==void 0?o[2]:"");try{var h,g,v=(h=a.prototype.emit).call.apply(h,dt(g=[this,e]).call(g,o));return v}catch(_){return or(function(){throw r.logger.error(r.name+"::emit throw error in setTimeout. event: "+e.toString()+". Error",_),_},0),!1}},l.process=function(e){var r=this[e.cmd+"Handler"],i=this.handler&&this.handler[e.cmd+"Handler"];if(typeof r=="function"||typeof i=="function"){if(e.error)return this.logger.error(e.cmd+"::recvError",e.error),He.reject(e.error);try{var o=r?r.call(this,e):i.call(this.handler,e);return He.resolve(o)}catch(h){return He.reject(h)}}var u=Pe(e,"error.detail.ignore");return e.error&&!u?He.reject(e.error):He.resolve(e)},p}(ia),Vn=function(){function a(p,l){this.name=p,this.core=l,this.name=p,this.logger=l.logger,this.core=l}return a.prototype.process=function(l){var t=this[l.cmd+"Handler"];if(typeof t=="function")return t.call(this,l);var e=Pe(l,"error.detail.ignore");return l.error&&!e?He.reject(l.error):He.resolve(l)},a}(),TP={"6_3":"notifylog","6_4":"uploadLog","6_23":"getServerTime","6_31":"notifyDetect","6_32":"uploadDetect"},a0={type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},IP={notifylog:{sid:6,cid:3,service:"misc"},uploadLog:{sid:6,cid:4,service:"misc",hasPacketResponse:!1,params:[{type:"String",name:"url"},{type:"Property",name:"data",reflectMapper:{type:1,content:2}}]},getServerTime:{sid:6,cid:23,service:"misc",response:[{type:"Long",name:"time"}]},notifyDetect:{sid:6,cid:31,service:"misc",response:[{type:"Property",name:"data",reflectMapper:Te(a0)}]},uploadDetect:{sid:6,cid:32,service:"misc",hasPacketResponse:!1,params:[{type:"Property",name:"data",reflectMapper:a0}]}},SP={type:{type:"number"},t1:{type:"number"},t2:{type:"number"},t3:{type:"number"},t4:{type:"number"},t5:{type:"number"},t6:{type:"number"}},c0=function(a){function p(t){var e;return(e=a.call(this,"misc",t)||this).core=t,Kt({cmdMap:TP,cmdConfig:IP}),e.setListener(),e}bt(p,a);var l=p.prototype;return l.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",function(){e.core.timeOrigin.setOriginTimetick()}),this.core.eventBus.on("logined",function(){e.core.timeOrigin.setOriginTimetick()})},l.getServerTime=function(){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.clientSocket.sendCmd("getServerTime");case 2:return r=o.sent,o.abrupt("return",it(r.content.time));case 4:case"end":return o.stop()}},e,this)}))},l.notifyDetectHandler=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return h=e.content.data,(i=Yt(SP,h)).t3=e.__receiveTimeNode.time,i.t4=Dt(),u.prev=3,u.next=6,this.core.clientSocket.sendCmd("uploadDetect",{data:i});case 6:u.next=11;break;case 8:u.prev=8,u.t0=u.catch(3),this.core.logger.warn("misc::notifyDetectHandler:upload failed",u.t0);case 11:case"end":return u.stop()}var h},r,this,[[3,8]])}))},l.notifylogHandler=function(){return k(this,void 0,void 0,T.mark(function e(){var r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return r=void 0,h.prev=1,h.next=4,this.core.logger.extractLogs();case 4:r=h.sent,h.next=10;break;case 7:return h.prev=7,h.t0=h.catch(1),h.abrupt("return");case 10:if(r){h.next=12;break}return h.abrupt("return");case 12:if(typeof r!="string"){h.next=14;break}return h.abrupt("return");case 14:return i="",h.prev=15,h.next=18,this.core.cloudStorage.uploadFile({type:"file",file:r});case 18:o=h.sent,i=o.url,h.next=25;break;case 22:return h.prev=22,h.t1=h.catch(15),h.abrupt("return");case 25:if(i){h.next=27;break}return h.abrupt("return");case 27:return i+=(wt(i).call(i,"?")>0?"&":"?")+"download="+new Date().getTime()+"_web.log",h.prev=28,h.next=31,this.core.clientSocket.sendCmd("uploadLog",{url:i});case 31:h.next=36;break;case 33:return h.prev=33,h.t2=h.catch(28),h.abrupt("return");case 36:case"end":return h.stop()}},e,this,[[1,7],[15,22],[28,33]])}))},p}(Vn),EP={needReconnect:!0,reconnectionAttempts:sT,lbsUrls:OS,linkUrl:tg,xhrConnectTimeout:8e3,socketConnectTimeout:8e3,linkSSL:!0},CP=function(a){function p(t,e){var r;(r=a.call(this,"V1NIMLoginService",t)||this).account="",r.token="",r.deviceId="",r.processId="",r.clientSession="",r.status="unconnected",r.config=EP,r.isManualLoginAttempt=!1,r.core._registerDep(c0,"misc"),Kt({cmdMap:hP,cmdConfig:fP}),t.V1NIMLoginService=Ot(r),e&&r.setOptions(e);var i=new yP(r.core,Ot(r));return r.clientSocket=i,r.core.options.apiVersion==="v1"&&(r.core.clientSocket=i,r.core.auth=Ot(r)),r.lbs=new _P(t),r.authenticator=new MP(t),r.doLoginStepsManager=new Rd,r}bt(p,a);var l=p.prototype;return l.reset=function(){this.lbs.reset()},l.setOptions=function(e){var r,i,o;e&&pt(e).length>0?(this.config=ao(this.config,e),this.account=e.account||this.core.options.account,this.token=e.token||this.core.options.token,this.core.options=O(O({},this.core.options),this.config)):(this.config=ao(this.core.options,this.config),this.account=this.core.options.account,this.token=this.core.options.token),(i=(r=this.core.clientSocket)===null||r===void 0?void 0:r.setLinkSSL)===null||i===void 0||i.call(r,(o=this.config.linkSSL)===null||o===void 0||o);var u="",h="";this.config.isFixedDeviceId?(u=We.localStorage.getItem("__NIM_DEVC_ID__")||jr(),h=We.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||jr(),We.localStorage.setItem("__NIM_DEVC_ID__",u),We.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",h)):(u=jr(),h=jr()),this.deviceId=u,this.clientSession=h,this.core.reporter.setConfig({common:{dev_id:u}})},l.connect=function(e){return e===void 0&&(e={}),this.login(e)},l.login=function(e){return e===void 0&&(e={}),k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this._checkApiVersion(),e.isAutoReconnect||(this.isManualLoginAttempt=!0,this.processId=jr()),o.next=4,this._connect(e);case 4:return this.core.abtest.abtRequest(),o.prev=5,o.next=8,this.doLogin(e.isAutoReconnect);case 8:this.processId=jr(),this.isManualLoginAttempt=!1,o.next=16;break;case 12:throw o.prev=12,o.t0=o.catch(5),this.isManualLoginAttempt=!1,o.t0;case 16:case"end":return o.stop()}},r,this,[[5,12]])}))},l._connect=function(e){return e===void 0&&(e={}),k(this,void 0,void 0,T.mark(function r(){var i,o,u,h=this;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.core.status)){v.next=4;break}return i="NIM status is "+this.core.status+", and would not connect",this.logger.warn(i),v.abrupt("return",He.reject(i));case 4:return this.clientSocket.beforeConnect(),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",{user_id:this.core.options.account,action:e.isAutoReconnect?"auto_login":"manual_login",binary_websocket:!1,process_id:this.processId}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:xe(O(O({},this.core.options),{account:"***",token:"***"})),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:We.net.getNetworkStatus()}),v.next=10,this.lbs.getLbsInfos();case 10:return o=v.sent,v.prev=11,v.next=14,this.clientSocket.connect({linkUrls:o,isAutoReconnect:e.isAutoReconnect},function(_,I){h.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:I,code:_.code||408,description:"ws_handshake_failed:"+_.message,succeed:!1},{asyncParams:We.net.getNetworkStatus()})});case 14:(u=v.sent)&&this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:u,code:200,succeed:!0},{asyncParams:We.net.getNetworkStatus()}),v.next=22;break;case 18:throw v.prev=18,v.t0=v.catch(11),this.core.reporter.reportTraceEnd("login",!1),v.t0;case 22:case"end":return v.stop()}},r,this,[[11,18]])}))},l.doLogin=function(e){return e===void 0&&(e=!1),k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.prev=0,_.next=3,this.authenticator.verifyAuthentication(e);case 3:i=_.sent,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:200,succeed:!0},{asyncParams:We.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!0),this.core.status="logined",_.next=21;break;case 9:if(_.prev=9,_.t0=_.catch(0),o=_.t0,u=Pe(o,"data.disconnect_reason")||"",h=o.code===415?xe({disconnect_reason:u}):o.message,this.core.logger.warn("nim login:: login failed",_.t0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:o.code||0,succeed:!1,description:h},{asyncParams:We.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!1),this.clientSocket.doDisconnect(nn.OFFLINE,this.isManualLoginAttempt?"FailedToInitializeLogin":"ReconnectLoginFailed",_.t0),!this.isManualLoginAttempt){_.next=20;break}throw _.t0;case 20:return _.abrupt("return");case 21:return _.prev=21,g=i.loginTime?it(i.loginTime):Dt(),_.next=25,this.core.cloudStorage.init(g);case 25:_.next=30;break;case 27:_.prev=27,_.t1=_.catch(21),this.core.logger.error("NIM:login cloudStorage init failed ",_.t1);case 30:this.core.eventBus.emit("logined",i),this.core.emit("logined",i),this.emit("logined",i),this.core.logger.log("login done"),this.clientSocket.resetConnectStatus(),this.clientSocket.ping();case 36:case"end":return _.stop()}},r,this,[[0,9],[21,27]])}))},l.disconnect=function(){return this.logout()},l.logout=function(){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),i.t0=this.status,i.next=i.t0==="logined"?5:i.t0==="connected"||i.t0==="connecting"||i.t0==="waitReconnect"?18:i.t0==="unconnected"||i.t0==="destroyed"?21:22;break;case 5:return i.prev=5,i.next=8,this.clientSocket.sendCmd("logout",void 0,{timeout:1e3});case 8:this.clientSocket.doDisconnect(nn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),i.next=17;break;case 12:i.prev=12,i.t1=i.catch(5),this.logger.error("Instance::disconnect sendCmd:logout error",i.t1),this.clientSocket.doDisconnect(nn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData();case 17:return i.abrupt("break",22);case 18:return this.clientSocket.doDisconnect(nn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),i.abrupt("return",He.resolve());case 21:return i.abrupt("return",He.resolve());case 22:case"end":return i.stop()}},e,this,[[5,12]])}))},l.kick=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this._checkApiVersion(),h.next=3,this.clientSocket.sendCmd("kick",e);case 3:return o=h.sent,h.abrupt("return",(r=o.content)===null||r===void 0?void 0:r.deviceIds);case 5:case"end":return h.stop()}},i,this)}))},l._checkApiVersion=function(){if(this.core.options.apiVersion!=="v1")throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v1"'}})},l.nimLoginClientChangeHandler=function(e){if(e.error)this.logger.error("nimLoginClientChangeHandler:: error, ",e.error);else{var r=e.content,i=n0(r.datas,r.state);i.length>0&&(this.core.emit("multiPortLogin",i),this.emit("multiPortLogin",i))}},l.kickedHandler=function(e){if(e.error)this.logger.error("kickedHandler:: error, ",e.error);else{var r=function(o){var u=Yt({clientType:{type:"enum",values:ac},customClientType:{type:"number"}},o),h=gP[u.reason];return O(u,h=h||{reason:"unknow",message:"Unknown reason"})}(e.content);this.logger.warn("kicked::",r),this.clientSocket.doDisconnect(nn.KICKED,r),this.core._clearModuleData()}},l.getConnectStatus=function(){switch(this.core.status){case"unconnected":case"destroyed":default:return 0;case"connecting":return 2;case"connected":case"logined":return 1;case"waitReconnect":return 3}},l.getLoginStatus=function(){switch(this.core.status){case"unconnected":case"destroyed":case"waitReconnect":default:return 0;case"connecting":case"connected":return 2;case"logined":return 1}},l.getLoginUser=function(){return this.core.options.account},l.emit=function(e){for(var r,i,o,u,h=this.name+"::emit "+e.toString(),g=arguments.length,v=new Array(g>1?g-1:0),_=1;_<g;_++)v[_-1]=arguments[_];return(r=this.logger).log.apply(r,dt(i=[""+h]).call(i,v)),(o=a.prototype.emit).call.apply(o,dt(u=[this,e]).call(u,v))},p}($r);function l0(a){return Yt({type:{type:"number"},port:{type:"number"},customClientType:{type:"number"},timestamp:{type:"number"},loginType:{type:"number"}},a)}function Mt(a){a=a||{};var p={};for(var l in a)p[a[l]]=l;return p}var bP={"26_3":"v2Login","26_5":"v2Logout","26_8":"v2KickOffline","26_9":"v2BeKicked","26_10":"v2LoginClientChange","36_1":"v2GetChatroomLinkAddress"},AP={"1_2":"heartbeat","2_7":"nimLoginClientChange","24_8":"qchatLoginClientChange"},lc={webLoginReqTag:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,clientId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,thirdPartyExtension:116,token:1e3},mixAuthRepTag:{clientId:1,consid:2,clientIP:3,port:4,type:5,customClientType:6,timestamp:7,customTag:8,os:9,pushType:10,hasTokenPreviously:11,loginType:12},nimAuthRepTag:{type:3,os:4,mac:5,clientId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,consid:102,clientIP:103,port:104,timestamp:109,pushType:110,hasTokenPreviously:111},qchatAuthRepTag:{clientId:8,consid:102,clientIP:103,port:104,type:6,customClientType:13,timestamp:105,os:30,pushType:100,hasTokenPreviously:101}},RP={v2Login:{sid:26,cid:3,service:"auth",params:[{type:"Property",name:"tag",reflectMapper:lc.webLoginReqTag}],response:[{type:"Property",name:"data",reflectMapper:Mt(lc.mixAuthRepTag)},{type:"PropertyArray",name:"loginClients",reflectMapper:Mt(lc.mixAuthRepTag)}]},v2Logout:{sid:26,cid:5,service:"auth"},v2KickOffline:{sid:26,cid:8,service:"auth",params:[{type:"StrArray",name:"clientIds"}],response:[{type:"StrArray",name:"clientIds"}]},v2BeKicked:{sid:26,cid:9,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"reasonDesc"},{type:"Int",name:"customClientType"}]},v2LoginClientChange:{sid:26,cid:10,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Mt(lc.mixAuthRepTag)}]},v2GetChatroomLinkAddress:{sid:36,cid:1,service:"auth",params:[{type:"Long",name:"roomId"},{type:"Bool",name:"miniProgram"}],response:[{type:"StrArray",name:"linkAddress"}]}},NP={heartbeat:{sid:1,cid:2,service:"auth"},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Mt(lc.nimAuthRepTag)}]},qchatLoginClientChange:{sid:24,cid:8,service:"auth",response:[{type:"Byte",name:"state"},{type:"Property",name:"data",reflectMapper:Mt(lc.qchatAuthRepTag)}]}},kP=RI.codeAt;je({target:"String",proto:!0},{codePointAt:function(p){return kP(this,p)}});var OP=Gr("String").codePointAt,mg=String.prototype,wP=function(a){var p=a.codePointAt;return typeof a=="string"||a===mg||ge(mg,a)&&p===mg.codePointAt?OP:p},xP=RangeError,u0=String.fromCharCode,d0=String.fromCodePoint,PP=$([].join),LP=!!d0&&d0.length!=1;je({target:"String",stat:!0,forced:LP},{fromCodePoint:function(p){for(var l,t=[],e=arguments.length,r=0;e>r;){if(l=+arguments[r++],zo(l,1114111)!==l)throw xP(l+" is not a valid code point");t[r]=l<65536?u0(l):u0(55296+((l-=65536)>>10),l%1024+56320)}return PP(t,"")}});var VP=we.String.fromCodePoint,p0=function(p){var l;if(p!==void 0)return(l=lr(p)).sign=1,l},h0=function(p){return Object.prototype.toString.call(p)==="[object Array]"},f0=function(p){var l;return Ln(l=[typeof p=="number",typeof p=="string"&&p.length>0,h0(p)&&p.length>0,p instanceof lr]).call(l,function(t){return t===!0})},m0="Invalid Number",DP="Invalid Number - Division By Zero";function lr(a){var p;if(!(this instanceof lr))return new lr(a);if(this.number=[],this.sign=1,this.rest=0,f0(a)){if(h0(a)){for((a.length&&a[0]==="-"||a[0]==="+")&&(this.sign=a[0]==="+"?1:-1,a.shift(0)),p=a.length-1;p>=0;p--)if(!this.addDigit(a[p]))return}else for((a=a.toString()).charAt(0)!=="-"&&a.charAt(0)!=="+"||(this.sign=a.charAt(0)==="+"?1:-1,a=a.substring(1)),p=a.length-1;p>=0;p--)if(!this.addDigit(it(a.charAt(p),10)))return}else this.number=m0}lr.prototype.addDigit=function(a){return function(l){return/^\d$/.test(l)}(a)?(this.number.push(a),this):(this.number=m0,!1)},lr.prototype._compare=function(a){var p,l;if(!f0(a))return null;if(p=lr(a),this.sign!==p.sign)return this.sign;if(this.number.length>p.number.length)return this.sign;if(this.number.length<p.number.length)return-1*this.sign;for(l=this.number.length-1;l>=0;l--){if(this.number[l]>p.number[l])return this.sign;if(this.number[l]<p.number[l])return-1*this.sign}return 0},lr.prototype.gt=function(a){return this._compare(a)>0},lr.prototype.gte=function(a){return this._compare(a)>=0},lr.prototype.equals=function(a){return this._compare(a)===0},lr.prototype.lte=function(a){return this._compare(a)<=0},lr.prototype.lt=function(a){return this._compare(a)<0},lr.prototype.subtract=function(a){var p;return a===void 0?this:(p=lr(a),this.sign!==p.sign?(this.number=lr._add(this,p),this):(this.sign=this.lt(p)?-1:1,this.number=p0(this).lt(p0(p))?lr._subtract(p,this):lr._subtract(this,p),this))},lr._add=function(a,p){var l,t=0,e=Math.max(a.number.length,p.number.length);for(l=0;l<e||t>0;l++)a.number[l]=(t+=(a.number[l]||0)+(p.number[l]||0))%10,t=Math.floor(t/10);return a.number},lr._subtract=function(a,p){var l,t,e=0,r=a.number.length;for(l=0;l<r;l++)a.number[l]-=(p.number[l]||0)+e,a.number[l]+=10*(e=a.number[l]<0?1:0);for(l=0,r=a.number.length-1;a.number[r-l]===0&&r-l>0;)l++;return l>0&&wn(t=a.number).call(t,-l),a.number},lr.prototype.multiply=function(a){if(a===void 0)return this;var p,l,t=lr(a),e=0,r=[];if(this.isZero()||t.isZero())return lr(0);for(this.sign*=t.sign,p=0;p<this.number.length;p++)for(e=0,l=0;l<t.number.length||e>0;l++)r[p+l]=(e+=(r[p+l]||0)+this.number[p]*(t.number[l]||0))%10,e=Math.floor(e/10);return this.number=r,this},lr.prototype.divide=function(a){if(a===void 0)return this;var p,l,t=lr(a),e=[],r=lr(0);if(t.isZero())return this.number=DP,this;if(this.isZero())return this.rest=lr(0),this;if(this.sign*=t.sign,t.sign=1,t.number.length===1&&t.number[0]===1)return this.rest=lr(0),this;for(p=this.number.length-1;p>=0;p--)for(r.multiply(10),r.number[0]=this.number[p],e[p]=0;t.lte(r);)e[p]++,r.subtract(t);for(p=0,l=e.length-1;e[l-p]===0&&l-p>0;)p++;return p>0&&wn(e).call(e,-p),this.rest=r,this.number=e,this},lr.prototype.mod=function(a){return this.divide(a).rest},lr.prototype.isZero=function(){var a;for(a=0;a<this.number.length;a++)if(this.number[a]!==0)return!1;return!0},lr.prototype.toString=function(){var a,p="";if(typeof this.number=="string")return this.number;for(a=this.number.length-1;a>=0;a--)p+=this.number[a];return this.sign>0?p:"-"+p};var Al=Math.pow(2,32);function g0(a){for(var p=new Uint8Array(5),l=new DataView(p.buffer),t=0;(4294967168&a)!=0;)l.setUint8(t++,127&a|128),a>>>=7;return l.setUint8(t++,127&a),ht(p).call(p,0,t)}function UP(a){if(typeof TextEncoder=="function")return new TextEncoder().encode(a);var p=function(t){for(var e=[],r=t.length,i=0;i<r;){var o=wP(t).call(t,i),u=0,h=0;for(o<=127?(u=0,h=0):o<=2047?(u=6,h=192):o<=65535?(u=12,h=224):o<=2097151&&(u=18,h=240),e.push(h|o>>u),u-=6;u>=0;)e.push(128|o>>u&63),u-=6;i+=o>=65536?2:1}return e}(a);return new Uint8Array(p)}function FP(a){return typeof TextDecoder=="function"?new TextDecoder("utf-8").decode(a):function(l){for(var t="",e=0;e<l.length;){var r=l[e],i=0,o=0;if(r<=127?(i=0,o=255&r):r<=223?(i=1,o=31&r):r<=239?(i=2,o=15&r):r<=244&&(i=3,o=7&r),l.length-e-i>0)for(var u=0;u<i;)o=o<<6|63&(r=l[e+u+1]),u+=1;else o=65533,i=l.length-e;t+=VP(o),e+=i+1}return t}(a)}var BP=function(){function a(l){this.offset=0,this.buffer=new Uint8Array(l),this.view=new DataView(l)}var p=a.prototype;return p.checkBufferBoundaryAccess=function(){return this.offset>=this.buffer.byteLength},p.length=function(){var t;return((t=this.view)===null||t===void 0?void 0:t.byteLength)||0},p.getBuffer=function(){return this.view.buffer},p.getOffset=function(){return this.offset},p.popRaw=function(t){try{var e,r=ht(e=this.buffer).call(e,this.offset,this.offset+t);return this.offset+=t,r}catch(i){throw new Error("UnpackException raw "+(i&&i.message))}},p.popByte=function(){try{var t=this.view.getUint8(this.offset);return this.offset+=1,t}catch(e){throw new Error("UnpackException byte "+(e&&e.message))}},p.popVarbin=function(){return this.popRaw(this.popVarInt())},p.popString=function(){try{return FP(this.popVarbin())}catch(t){throw new Error("UnpackException string "+(t&&t.message))}},p.popInt=function(){try{var t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}catch(e){throw new Error("UnpackException int "+(e&&e.message))}},p.popVarInt=function(){var t=1,e=0,r=0,i=0;do if(e+=(127&(r=this.popByte()))*t,t*=128,(i+=1)>5)throw new Error("Variable length quantity is too long");while((128&r)!=0);return e},p.popLong=function(){try{var t,e=function(i,o){o===void 0&&(o=!1);var u=new DataView(i.buffer),h=o?[4,0]:[0,4],g=h[0],v=h[1],_=u.getUint32(g,o),I=u.getUint32(v,o);return _>0?_*Al+I:I}(ht(t=this.buffer).call(t,this.offset,this.offset+8),!0);return this.offset+=8,Number(e)}catch(r){throw new Error("UnpackException long "+(r&&r.message))}},p.popShort=function(){try{var t=this.view.getUint16(this.offset,!0);return this.offset+=2,t}catch(e){throw new Error("UnpackException short "+(e&&e.message))}},p.popBoolean=function(){return this.popByte()>0},p.toString=function(){return vr(new Uint8Array(this.buffer)).toString()},p.reset=function(){this.offset=0,this.buffer=null,this.view=null},a}(),v0=function(){function a(l){this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.resCode=200,this.innerHeader=null,this.msgId=0,this.bodyArr=[],this.unpack=new BP(l)}var p=a.prototype;return p.reset=function(){this.innerHeader=null,this.bodyArr=[],this.unpack.reset()},p.getBodyDetail=function(){return this.bodyArr.join("")},p.unmarshalHeader=function(){var t,e=this._unmarshalHeader();this.packetLength=e.packetLength,this.serviceId=e.serviceId,this.commandId=e.commandId,this.serialId=e.serialId,this.tag=e.tag,this.resCode=e.resCode,e.serviceId===4&&_t(t=[1,2,10,11]).call(t,e.commandId)&&(this.msgId=this.unmarshalLong(),this.innerHeader=this._unmarshalHeader())},p._unmarshalHeader=function(){var t=this.unpack.popVarInt(),e=this.unpack.popByte(),r=this.unpack.popByte(),i=this.unpack.popShort(),o=this.unpack.popByte(),u=200;return this.hasRescode(o)&&(u=this.unpack.popShort()),{packetLength:t,serviceId:e,commandId:r,serialId:i,tag:o,resCode:u}},p.hasRescode=function(t){return((t=t||this.tag)&a.RES_CODE)!=0},p.getHeader=function(){return{packetLength:this.packetLength,sid:this.serviceId,cid:this.commandId,ser:this.serialId,code:this.resCode}},p.getInnerHeader=function(){return this.innerHeader?{sid:this.innerHeader.serviceId,cid:this.innerHeader.commandId}:null},p.unmarshalProperty=function(){var t=this.unpack.popVarInt(),e={};this.bodyArr.push(`
Property(`+t+") {");for(var r=0;r<t;r++){var i=this.unpack.popVarInt();this.bodyArr.push(i+":");var o=this.unpack.popString();this.bodyArr.push('"'+o.length+" "+this.unpack.getOffset()+'",'),e[i]=o}return this.bodyArr.push("},"),e},p.unmarshalPropertyArray=function(){var t=this.unpack.popVarInt(),e=[];this.bodyArr.push(`
PropertyArray(`+t+") [");for(var r=0;r<t;r++)e.push(this.unmarshalProperty());return this.bodyArr.push("],"),e},p.unmarshalLong=function(){var t=this.unpack.popLong();return this.bodyArr.push(`
Long:`+t),t},p.unmarshalLongArray=function(){var t=this.unpack.popVarInt(),e=[];this.bodyArr.push(`
LongArray `+t+":");for(var r=0;r<t;r++){var i=this.unpack.popLong();this.bodyArr.push(i+","),e.push(i)}return e},p.unmarshalStrArray=function(){var t=this.unpack.popVarInt(),e=[];this.bodyArr.push(`
StrArray `+t+":");for(var r=0;r<t;r++){var i=this.unpack.popString();this.bodyArr.push(i+","),e.push(i)}return e},p.unmarshalStrLongMap=function(){var t=this.unpack.popVarInt(),e={};this.bodyArr.push(`
StrLongMap `+t+":");for(var r=0;r<t;r++){var i=this.unpack.popString();this.bodyArr.push(i+",");var o=this.unpack.popLong();this.bodyArr.push(o+";"),e[i]=o}return e},p.unmarshalStrStrMap=function(){var t=this.unpack.popVarInt(),e={};this.bodyArr.push(`
StrStrMap `+t+":");for(var r=0;r<t;r++){var i=this.unpack.popString();this.bodyArr.push(i+",");var o=this.unpack.popString();this.bodyArr.push(o+";"),e[i]=o}return e},p.unmarshalLongLongMap=function(){var t=this.unpack.popVarInt(),e={};this.bodyArr.push(`
StrLongLongMap `+t+":");for(var r=0;r<t;r++){var i=this.unpack.popLong();this.bodyArr.push(i+",");var o=this.unpack.popLong();this.bodyArr.push(o+";"),e[i]=o}return{m_map:e}},p.unmarshalKVArray=function(){var t=this.unpack.popVarInt(),e=[];this.bodyArr.push(`
KVArray `+t+":");for(var r=0;r<t;r++)e.push(this.unmarshalStrStrMap());return e},p.unmarshal=function(t){var e,r=this,i=O(O({},this.getHeader()),{r:[]});if(this.innerHeader&&(i.r[0]=this.msgId,i.r[1]={body:[],headerPacket:this.getInnerHeader()}),!_t(e=[200,406,808,810,7101]).call(e,i.code))return xe(i);if(this.packetLength>0&&this.packetLength>this.unpack.length())throw new Error("UnpackException packetLength("+this.packetLength+") greater than bufferLength("+this.unpack.length()+")");var o=[];return t&&ae(t).call(t,function(u){if(!r.unpack.checkBufferBoundaryAccess())switch(u.type){case"PropertyArray":o.push(r.unmarshalPropertyArray());break;case"Property":o.push(r.unmarshalProperty());break;case"Byte":o.push(r.unpack.popByte());break;case"Int":o.push(r.unpack.popInt());break;case"Bool":o.push(r.unpack.popBoolean());break;case"Long":o.push(r.unmarshalLong());break;case"LongArray":o.push(r.unmarshalLongArray());break;case"String":o.push(r.unpack.popString());break;case"StrArray":o.push(r.unmarshalStrArray());break;case"StrStrMap":o.push(r.unmarshalStrStrMap());break;case"StrLongMap":o.push(r.unmarshalStrLongMap());break;case"LongLongMap":o.push(r.unmarshalLongLongMap());break;case"KVArray":o.push(r.unmarshalKVArray())}}),this.innerHeader?i.r[1].body=o:i.r=o,xe(i)},a}();v0.RES_CODE=2;var qP=function(){function a(){this.offset=0,this.pageSize=1024,this.capacity=1048576,this.buffer=new Uint8Array(this.pageSize),this.view=new DataView(this.buffer.buffer)}var p=a.prototype;return p.reset=function(){this.offset=0,this.buffer=null,this.view=null},p.size=function(){return this.offset},p.getBuffer=function(){var t;return ht(t=this.buffer).call(t,0,this.offset).buffer},p.ensureCapacity=function(t){var e=this.offset+t;if(e>this.capacity)throw new Error("PackException over limit");if(e>this.buffer.byteLength){var r=Math.ceil(e/this.pageSize)*this.pageSize,i=new Uint8Array(r);i.set(this.buffer),this.buffer=i,this.view=new DataView(this.buffer.buffer)}},p.putRaw=function(t){this.ensureCapacity(t.length);try{this.buffer.set(t,this.offset),this.offset+=t.length}catch{throw new Error("PackException raw")}},p.putByte=function(t){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,t)}catch{throw new Error("PackException byte")}},p.putString=function(t){try{var e=UP(t);this.putVarbin(e)}catch{throw new Error("PackException string")}},p.putInt=function(t){this.ensureCapacity(4);try{this.view.setInt32(this.offset,t,!0),this.offset+=4}catch{throw new Error("PackException int")}},p.putVarInt=function(t){var e=g0(t);this.putRaw(e)},p.putBoolean=function(t){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,t?1:0)}catch{throw new Error("PackException boolean")}},p.putLong=function(t){this.ensureCapacity(8);try{var e=function(i,o){o===void 0&&(o=!1);var u=new Uint8Array(8),h=new DataView(u.buffer),g=Number(i>Al-1?i/Al:0),v=Number(4294967295&i),_=o?[4,0]:[0,4],I=_[0],C=_[1];return h.setUint32(I,g,o),h.setUint32(C,v,o),u}(t,!0);this.buffer.set(e,this.offset),this.offset+=8}catch{throw new Error("PackException long")}},p.putStringAsLong=function(t){this.ensureCapacity(8);try{var e=function(i,o){var u,h;o===void 0&&(o=!1);var g=new Uint8Array(8),v=new DataView(g.buffer),_=Wi(u=lr(i).divide(Al).number).call(u).join(""),I=Wi(h=lr(i).mod(Al).number).call(h).join(""),C=Number(_),A=Number(I),N=o?[4,0]:[0,4],F=N[0],j=N[1];return v.setUint32(F,C,o),v.setUint32(j,A,o),g}(t,!0);this.buffer.set(e,this.offset),this.offset+=8}catch{throw new Error("PackException stringAsLong")}},p.putShort=function(t){this.ensureCapacity(2);try{this.view.setInt16(this.offset,t,!0),this.offset+=2}catch{throw new Error("PackException short")}},p.putVarbin=function(t){if(!t)return this.ensureCapacity(1),this.putVarInt(0);if(t.byteLength>Math.pow(2,31)-2)throw new Error("PackException varbin. too long");var e=g0(t.length);this.ensureCapacity(e.length+t.length);try{this.buffer.set(e,this.offset),this.offset+=e.length,this.buffer.set(t,this.offset),this.offset+=t.length}catch{throw new Error("PackException varbin")}},a}();function ca(a){if(typeof a!="number"){if(a==null)return!1;a=Number(a)}if(isNaN(a))throw new Error("Number type conversion error");return!0}function uc(a){return a==null}var Tn,GP=function(){function a(l,t,e){this.pack=new qP,this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.serviceId=l,this.commandId=t,this.serialId=e}var p=a.prototype;return p.marshalHeader=function(){this.pack.putVarInt(this.packetLength),this.pack.putByte(this.serviceId),this.pack.putByte(this.commandId),this.pack.putShort(this.serialId),this.pack.putByte(this.tag)},p.marshalProperty=function(t){var e=this,r=pt(t),i=at(r).call(r,function(o){return!uc(o)});this.pack.putVarInt(i.length),ae(i).call(i,function(o){e.pack.putVarInt(Number(o)),qt(t[o])||Object.prototype.toString.call(t[o])==="[object Object]"?e.pack.putString(xe(t[o])):e.pack.putString(String(t[o]))})},p.marshalPropertyArray=function(t){var e=this,r=t.length;this.pack.putVarInt(r),ae(t).call(t,function(i){e.marshalProperty(i==null?void 0:i.v)})},p.marshalStrArray=function(t){var e=this,r=at(t).call(t,function(o){return!uc(o)}),i=r.length;this.pack.putVarInt(i),ae(r).call(r,function(o){e.pack.putString(String(o))})},p.marshalLongArray=function(t){var e=this,r=at(t).call(t,function(o){return ca(o)}),i=r.length;this.pack.putVarInt(i),ae(r).call(r,function(o){e.putLong(o)})},p.marshalStrStrMap=function(t){var e=this,r=pt(t),i=at(r).call(r,function(o){return!uc(t[o])&&!uc(o)});this.pack.putVarInt(i.length),ae(i).call(i,function(o){e.pack.putString(String(o)),e.pack.putString(String(t[o]))})},p.marshalStrLongMap=function(t){var e=this,r=pt(t),i=at(r).call(r,function(o){return ca(t[o])&&!uc(o)});this.pack.putVarInt(i.length),ae(i).call(i,function(o){e.pack.putString(String(o)),e.putLong(t[o])})},p.marshalLongLongMap=function(t){var e=this,r=pt(t),i=at(r).call(r,function(o){var u=Number(o);return ca(u)&&ca(t[u])});this.pack.putVarInt(i.length),ae(i).call(i,function(o){var u=Number(o);e.putLong(u),e.putLong(t[u])})},p.marshalKVArray=function(t){var e=this,r=t.length;this.pack.putVarInt(r),ae(t).call(t,function(i){e.marshalStrStrMap(i)})},p.putLong=function(t){typeof t=="string"&&t.length>15?this.pack.putStringAsLong(t):this.pack.putLong(Number(t))},p.marshal=function(t,e){var r=this;return this.marshalHeader(),e&&ae(e).call(e,function(i,o){var u,h=i.type,g=(u=t[o])===null||u===void 0?void 0:u.v;if(!uc(g))switch(h){case"PropertyArray":r.marshalPropertyArray(g);break;case"Property":r.marshalProperty(g);break;case"Byte":if(!ca(g))return;r.pack.putByte(Number(g));break;case"Int":if(!ca(g))return;r.pack.putInt(Number(g));break;case"Bool":g==="false"?g=!1:g==="true"&&(g=!0),r.pack.putBoolean(g);break;case"Long":if(!ca(g))return;r.putLong(g);break;case"LongArray":r.marshalLongArray(g);break;case"String":r.pack.putString(String(g));break;case"StrArray":r.marshalStrArray(g);break;case"StrStrMap":r.marshalStrStrMap(g);break;case"StrLongMap":r.marshalStrLongMap(g);break;case"LongLongMap":r.marshalLongLongMap(g);break;case"KVArray":r.marshalKVArray(g)}}),this.pack.getBuffer()},p.reset=function(){this.pack.reset()},a}(),jP=function(a){function p(t,e,r){var i;return(i=a.call(this)||this).websocket=null,i.socketConnectTimer=0,i.linkSSL=!0,i.url="",i.core=t,i.url=e,i.linkSSL=r,i.status="disconnected",i.logger=t.logger,i.connect(),i}bt(p,a);var l=p.prototype;return l.connect=function(){this.status!=="connecting"&&this.status!=="connected"?(this.status="connecting",this._createWebsocket((this.linkSSL?"wss":"ws")+"://"+this.url+"/websocket")):this.logger.warn("imsocket::socket is connecting or connected",this.status)},l.close=function(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.close()}catch(e){this.logger.warn("imsocket::attempt to close websocket error",e)}this.clean(),this.emit("disconnect")}},l.clean=function(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},l.onConnect=function(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},l._createWebsocket=function(e){var r,i=this;this.socketConnectTimer=or(function(){i.logger.error("imsocket::Websocket connect timeout. url: ",e),i.emit("connectFailed",new Me({code:Pe(i.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+e}}))},this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new We.WebSocket(e),this.websocket.binaryType="arraybuffer",this.websocket.onmessage=et(r=this.onMessage).call(r,this),this.websocket.onclose=function(o){o=o||{},i.logger.log("imsocket::Websocket onclose done "+o.wasClean+"/"+o.code+"/"+o.reason),i.status==="connected"?(i.clean(),i.emit("disconnect")):(i.clean(),i.emit("connectFailed",new Me({code:Pe(i.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onclose done"}})))},this.websocket.onerror=function(o){i.logger.error("imsocket::Websocket onerror",o),i.status==="connected"?(i.clean(),i.emit("disconnect")):(i.clean(),i.emit("connectFailed",new Me({code:Pe(i.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onerror."}})))},this.websocket.onopen=function(){i.onConnect()}},l.onMessage=function(e){if(e.data){var r=new v0(e.data),i={sid:-1,cid:-1,ser:-1,packetLength:-1},o=null;try{r.unmarshalHeader(),i=r.getHeader(),o=r.getInnerHeader()}catch(N){this.reportBinaryError({err:N,sid:o?o.sid:i==null?void 0:i.sid,cid:o?o.cid:i==null?void 0:i.cid,rawBuf:e.data,type:"decode"})}var u=o?o.sid:i.sid,h=o?o.cid:i.cid,g=u+"_"+h,v=oc[g];if(v&&v.length>0){var _,I=v[0].config;try{_=r.unmarshal(I.response)}catch(N){var C=r.getBodyDetail();this.reportBinaryError({err:N,rawBuf:e.data,sid:u,cid:h,parseDetail:C,type:"decode"}),r.reset();var A=O(O({},i),{sid:u,cid:h,code:ce.V2NIM_ERROR_CODE_UNPACK_ERROR});return this.logger.error('imsocket::onMessage "'+A.sid+"_"+A.cid+'", ser '+A.ser+", packetLength "+A.packetLength+" unmarshal error. "+C+` 
`,N),void this.emit("message",xe(A))}this.emit("message",_)}else this.core.logger.warn("imsocket::onMessage cmd not found",g);r.reset()}},l.send=function(e,r,i,o,u){var h,g,v=new GP(e,r,i),_=ug[o],I="";try{I=xe(u),g=v.marshal(JSON.parse(I),_.params)}catch(C){throw this.reportBinaryError({err:C,sid:e,cid:r,rawStr:I,type:"encode"}),v.reset(),new Me({code:ce.V2NIM_ERROR_CODE_PACK_ERROR,detail:{reason:e+"-"+r+", ser "+i+" marshal error",rawError:C}})}(h=this.websocket)===null||h===void 0||h.send(g),v.reset()},l.reportBinaryError=function(e){var r,i,o,u=e.err,h=e.rawStr,g=e.sid,v=e.cid,_=e.type,I=e.parseDetail,C=e.rawBuf;if(C){try{o=function(F){if(typeof btoa!="function")return"";for(var j="",W=new Uint8Array(F),U=W.byteLength,ie=0;ie<U;ie++)j+=String.fromCharCode(W[ie]);return W=null,btoa(j)}(C)}catch(N){o="reportBinaryError::arrayBufferToBase64 parsing failed, error: "+(N==null?void 0:N.message)+", sid: "+g+", cid: "+v,this.core.logger.error(o)}C=null}this.core.reporter.reportTraceStart("exceptions",{user_id:(r=this.core.auth)===null||r===void 0?void 0:r.account,trace_id:(i=this.core.clientSocket.socket)===null||i===void 0?void 0:i.sessionId,start_time:Dt(),action:2,exception_service:9});var A=u?(u.message+";;;"||u.code+";;;")+(I?"parseDetail: "+I+";;;":"")+(h?" rawStr: "+h:"")+(o?" rawBuf: "+o:""):"";this.core.reporter.reportTraceUpdateV2("exceptions",{code:_==="encode"?ce.V2NIM_ERROR_CODE_PACK_ERROR:ce.V2NIM_ERROR_CODE_UNPACK_ERROR,description:A,operation_type:_==="encode"?3:4,target:g+"-"+v},{asyncParams:We.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)},p}(ia);function HP(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return y0(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?y0(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function y0(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}(function(a){a[a.ACTIVE=1]="ACTIVE",a[a.KICKED=2]="KICKED",a[a.OFFLINE=3]="OFFLINE"})(Tn||(Tn={}));var ho,$P=function(){function a(l){this.isReconnect=!1,this.packetTimeout=8e3,this.linkSSL=!0,this.packetSer=1,this.backoff=new xd({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Dr,this.pingTimer=0,this.hasNetworkListener=!1,this.core=l,this.auth=l.auth,this.logger=l.logger,this.reporter=l.reporter,this.timerManager=l.timerManager,this.eventBus=l.eventBus,this.setListener()}var p=a.prototype;return p.setListener=function(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",function(){t.isReconnect=!0})},p.setSessionId=function(t){this.socket&&(this.socket.sessionId=t)},p.setLinkSSL=function(t){this.linkSSL=t},p.connect=function(t,e){var r,i;return e===void 0&&(e=!1),k(this,void 0,void 0,T.mark(function o(){var u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(this.isReconnect=e,(u=this.core.auth.getConnectStatus())!==1){I.next=7;break}return h="clientSocket::connect status is "+u+", and would not repeat connect",g=new Me({code:ce.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:h}}),this.logger.warn(h),I.abrupt("return",He.reject(g));case 7:return this.auth.lifeCycle.processEvent("connect"),I.prev=8,I.next=11,this.auth.doLoginStepsManager.add(this.doConnect(t));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+t+", isReconnect: "+e),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:200,mixlink:!0,succeed:!0},{asyncParams:We.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),I.next=28;break;case 16:if(I.prev=16,I.t0=I.catch(8),v=I.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:v.code||0,description:"connectFailed:"+v.message,mixlink:!0,succeed:!1},{asyncParams:We.net.getNetworkStatus()}),v.code!==ce.V2NIM_ERROR_CODE_CANCELLED&&v.code!==ce.V2NIM_ERROR_CODE_TIMEOUT){I.next=25;break}throw(r=this.socket)===null||r===void 0||r.close(),(i=this.socket)===null||i===void 0||i.removeAllListeners(),this.socket=void 0,I.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+t,v),this.auth.lifeCycle.processEvent("connectFail",v),I.t0;case 28:case"end":return I.stop()}},o,this,[[8,16]])}))},p.doConnect=function(t){var e=this,r=!1;return new He(function(i,o){var u;e.socket=new jP(e.core,t,e.linkSSL),e.socket.on("connect",function(){e.logger.log("clientSocketV2::socket on connect",t),e.core.reporterHookLinkKeep.start(),e.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:t}),r=!0,i()}),e.socket.on("message",et(u=e.onMessage).call(u,e)),e.socket.on("disconnect",function(h){return k(e,void 0,void 0,T.mark(function g(){return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return r=!0,this.logger.log("clientSocketV2::socket on disconnect "+t,h),_.next=4,this.core.reporterHookLinkKeep.update({code:(h==null?void 0:h.code)||0,description:(h==null?void 0:h.reason)||"socket on disconnect",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Tn.OFFLINE,"SocketOnDisconnect");case 6:case"end":return _.stop()}},g,this)}))}),e.socket.on("connectFailed",function(h){r?e.ping():(e.logger.error("clientSocketV2::connectFailed:"+t+", reason:"+(h&&h.message)),e.cleanSocket()),r=!0,o(h)})})},p.cleanSocket=function(){this.socket&&(typeof this.socket.removeAllListeners=="function"&&this.socket.removeAllListeners(),typeof this.socket.close=="function"&&this.socket.close(),this.socket=void 0)},p.resetSocketConfig=function(){this.backoff.reset(),this.initOnlineListener()},p.doDisconnect=function(t,e){if(this.logger.log("clientSocketV2::doDisconnect: type "+t+", reason ",e),this.core.auth.getConnectStatus()!==0){var r={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new Me({code:ce.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:r}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),t===Tn.ACTIVE||t===Tn.KICKED?this.destroyOnlineListener():t===Tn.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new Me({code:ce.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},p.sendCmd=function(t,e,r){var i=this,o=this.core.auth.getLoginStatus(),u=["v2Login","login","chatroomLogin","v2ChatroomLogin"],h={cmd:t};if(o!==1&&!_t(u).call(u,t))return this.logger.warn("clientSocketV2::NIM login status is "+o+", so can not sendCmd "+t),He.reject(new Me({code:ce.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:O({reason:"Can not sendCmd due to no logined"},h)}));var g=t!=="heartbeat",v=g?this.packetSer++:0,_=dg(t,v,this.logger,e);if(!_){var I=new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:O(O({},h),{reason:"SendCmd::createCmd error: "+v+" "+t})});return this.logger.error(I),He.reject(I)}var C=_.packet,A=_.hasPacketResponse,N=_.hasPacketTimer,F=xe(C);g&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::sendCmd: "+C.SID+"_"+C.CID+","+t+",ser:"+v,F):this.logger.log("clientSocketV2::sendCmd: "+C.SID+"_"+C.CID+","+t+",ser:"+v));var j=new Date().getTime();return new He(function(W,U){A&&i.sendingCmdMap.set(v,{cmd:t,params:e,callback:[W,U],timer:N?or(function(){var te=new Me({code:ce.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:O({ser:v,reason:"Packet Timeout: ser "+v+" cmd "+t,timetag:new Date().getTime()},h)});i.markCmdInvalid(v,te,t)},r&&r.timeout?r.timeout:i.packetTimeout):null});try{i.socket.send(C.SID,C.CID,v,t,C.Q),A||W(C)}catch(te){var ie=new Me({code:ce.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:O({ser:v,reason:"Unable to send packet"+(te&&te.message?": "+te.message:""),timetag:new Date().getTime(),rawError:te},h)});i.markCmdInvalid(v,ie,t),U(ie)}}).catch(function(W){return k(i,void 0,void 0,T.mark(function U(){var ie,te;return T.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(ie=W,te=[ce.V2NIM_ERROR_CODE_DISCONNECT,ce.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,ce.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],_t(te).call(te,ie.code)){V.next=4;break}return V.abrupt("return",He.reject(ie));case 4:return this.reportSendCmdFailed(ie,{sid:C.SID,cid:C.CID,ser:v},j),V.abrupt("return",He.reject(ie));case 6:case"end":return V.stop()}},U,this)}))})},p.reportSendCmdFailed=function(t,e,r){var i;this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:(i=this.socket)===null||i===void 0?void 0:i.sessionId,start_time:r,action:2,exception_service:6});var o=Pe(t,"detail.disconnect_reason")||"",u=t.code===ce.V2NIM_ERROR_CODE_DISCONNECT?xe({disconnect_reason:o}):t.detail.reason;this.reporter.reportTraceUpdateV2("exceptions",{code:t.code,description:u,operation_type:1,target:e.sid+"-"+e.cid,context:""+e.ser},{asyncParams:We.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1)},p.onMessage=function(t){var e=pg(t,this.logger);if(e){var r=e[0],i=r.raw.ser;r.cmd!=="heartbeat"&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::recvCmd "+r.raw.sid+"_"+r.raw.cid+","+r.cmd+",ser:"+i,t):this.logger.log("clientSocketV2::recvCmd "+r.raw.sid+"_"+r.raw.cid+","+r.cmd+",ser:"+i+",code:"+r.raw.code));for(var o,u=HP(e);!(o=u()).done;){var h=o.value;if(h.error&&this.logger.error("clientSocketV2::onMessage packet error",h.raw.sid+"_"+h.raw.cid+", ser:"+i+",",h.error),h.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",h.raw.sid+"_"+h.raw.cid+", ser:"+i);this.packetHandler(h)}}},p.packetHandler=function(t){var e,r,i,o,u=this;if(t){var h=t.raw.ser,g=this.sendingCmdMap.get(h);if(g&&g.cmd===t.cmd){var v=g.callback,_=g.timer,I=g.params;if(clearTimeout(_),t.params=I,this.sendingCmdMap.delete(h),t.cmd==="heartbeat")return void v[0]();var C=(r=(e=this.core[t.service])===null||e===void 0?void 0:e.process)===null||r===void 0?void 0:r.call(e,t);C&&typeof C.then=="function"?C.then(function(N){v[0](N)}).catch(function(N){v[1](N)}):(this.logger.log("clientSocketV2::handlerFn without promise",t.service,t.cmd),v[0](t))}else{var A=(o=(i=this.core[t.service])===null||i===void 0?void 0:i.process)===null||o===void 0?void 0:o.call(i,t);A&&typeof A.then=="function"&&A.catch(function(N){u.logger.error("clientSocketV2::no obj cache, no process handler",N)})}}},p.markCmdInvalid=function(t,e,r){var i=this.sendingCmdMap.get(t);if(i){var o=i.callback,u=i.timer;u&&clearTimeout(u),this.sendingCmdMap.delete(t),this.logger.warn("clientSocketV2::packet "+t+", "+r+" is invalid:",e),o[1](e)}},p.markAllCmdInvaild=function(t){var e,r=this;this.logger.log("markAllCmdInvaild",t),ae(e=this.sendingCmdMap).call(e,function(i){var o=i.callback,u=i.timer,h=i.cmd;r.logger.log("clientSocketV2::markAllCmdInvaild:cmd "+h),u&&clearTimeout(u),o[1](t)}),this.sendingCmdMap.clear()},p.ping=function(){var t;return k(this,void 0,void 0,T.mark(function e(){var r=this;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return clearTimeout(this.pingTimer),o.prev=1,o.next=4,this.sendCmd("heartbeat");case 4:o.next=20;break;case 6:if(o.prev=6,o.t0=o.catch(1),o.t0.code!==ce.V2NIM_ERROR_CODE_DISCONNECT){o.next=11;break}return o.abrupt("return");case 11:return o.next=13,this.testHeartBeat5Timeout();case 13:if(!o.sent){o.next=20;break}return o.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:(t=this.socket)===null||t===void 0?void 0:t.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(Tn.OFFLINE,"PingError"),o.abrupt("return");case 20:this.pingTimer=or(function(){r.ping()},3e4);case 21:case"end":return o.stop()}},e,this,[[1,6]])}))},p.testHeartBeat5Timeout=function(){return k(this,void 0,void 0,T.mark(function t(){var e;return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:clearTimeout(this.pingTimer),e=0;case 2:if(!(e<5)){i.next=15;break}return i.prev=3,i.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return i.abrupt("return",!1);case 9:i.prev=9,i.t0=i.catch(3),this.logger.log("clientSocketV2::test heartbeat "+e+" Timeout");case 12:e++,i.next=2;break;case 15:return i.abrupt("return",!0);case 16:case"end":return i.stop()}},t,this,[[3,9]])}))},p.initOnlineListener=function(){var t=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,We.net.onNetworkStatusChange(function(e){t.logger.log("clientSocketV2::onlineListener:network change",e);var r=t.auth.getConnectStatus(),i=t.auth.getLoginStatus();e.isConnected&&i===1?t.ping():e.isConnected&&r===3?(t.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),t.auth.reconnect.clearReconnectTimer(),t.auth.reconnect.doReLogin()):e.isConnected||t.doDisconnect(Tn.OFFLINE,"OfflineListener")}))},p.destroyOnlineListener=function(){this.logger.log("clientSocketV2::onlineListener:destroy"),We.net.offNetworkStatusChange(),this.hasNetworkListener=!1},a}();function KP(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return _0(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?_0(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _0(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}(function(a){a[a.ACTIVE=1]="ACTIVE",a[a.KICKED=2]="KICKED",a[a.OFFLINE=3]="OFFLINE"})(ho||(ho={}));var YP=function(){function a(l){this.isReconnect=!1,this.packetTimeout=8e3,this.linkSSL=!0,this.packetSer=1,this.backoff=new xd({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Dr,this.pingTimer=0,this.hasNetworkListener=!1,this.core=l,this.auth=l.auth,this.logger=l.logger,this.reporter=l.reporter,this.timerManager=l.timerManager,this.eventBus=l.eventBus,this.setListener()}var p=a.prototype;return p.setListener=function(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",function(){t.isReconnect=!0})},p.setSessionId=function(t){this.socket&&(this.socket.sessionId=t)},p.setLinkSSL=function(t){this.linkSSL=t},p.connect=function(t,e){var r,i;return e===void 0&&(e=!1),k(this,void 0,void 0,T.mark(function o(){var u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(this.isReconnect=e,(u=this.core.auth.getConnectStatus())!==1){I.next=7;break}return h="clientSocket::connect status is "+u+", and would not repeat connect",g=new Me({code:ce.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:h}}),this.logger.warn(h),I.abrupt("return",He.reject(g));case 7:return this.auth.lifeCycle.processEvent("connect"),I.prev=8,I.next=11,this.auth.doLoginStepsManager.add(this.doConnect(t));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+t+", isReconnect: "+e),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:200,mixlink:!0,succeed:!0},{asyncParams:We.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),I.next=28;break;case 16:if(I.prev=16,I.t0=I.catch(8),v=I.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:v.code||0,description:"connectFailed:"+v.message,mixlink:!0,succeed:!1},{asyncParams:We.net.getNetworkStatus()}),v.code!==ce.V2NIM_ERROR_CODE_CANCELLED&&v.code!==ce.V2NIM_ERROR_CODE_TIMEOUT){I.next=25;break}throw(r=this.socket)===null||r===void 0||r.close(),(i=this.socket)===null||i===void 0||i.removeAllListeners(),this.socket=void 0,I.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+t,v),this.auth.lifeCycle.processEvent("connectFail",v),I.t0;case 28:case"end":return I.stop()}},o,this,[[8,16]])}))},p.doConnect=function(t){var e=this,r=!1;return new He(function(i,o){var u;e.socket=new s0(e.core,t,e.linkSSL),e.socket.on("connect",function(){e.logger.log("clientSocketV2::socket on connect",t),e.core.reporterHookLinkKeep.start(),e.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:t}),r=!0,i()}),e.socket.on("message",et(u=e.onMessage).call(u,e)),e.socket.on("disconnect",function(h){return k(e,void 0,void 0,T.mark(function g(){return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return r=!0,this.logger.log("clientSocketV2::socket on disconnect",h),_.next=4,this.core.reporterHookLinkKeep.update({code:(h==null?void 0:h.code)||0,description:(h==null?void 0:h.reason)||"socket on disconnect",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(ho.OFFLINE,"SocketOnDisconnect");case 6:case"end":return _.stop()}},g,this)}))}),e.socket.on("handshakeFailed",function(h){r?e.ping():(e.logger.error('clientSocketV2::handshake failed: "'+(h&&h.message)+'"'),e.cleanSocket()),r=!0,o(h)})})},p.cleanSocket=function(){this.socket&&(typeof this.socket.removeAllListeners=="function"&&this.socket.removeAllListeners(),typeof this.socket.close=="function"&&this.socket.close(),this.socket=void 0)},p.resetSocketConfig=function(){this.backoff.reset(),this.initOnlineListener()},p.doDisconnect=function(t,e){if(this.logger.log("clientSocketV2::doDisconnect: type "+t+", reason ",e),this.core.auth.getConnectStatus()!==0){var r={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new Me({code:ce.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:r}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),t===ho.ACTIVE||t===ho.KICKED?this.destroyOnlineListener():t===ho.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new Me({code:ce.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},p.sendCmd=function(t,e,r){var i=this,o=this.core.auth.getLoginStatus(),u=["v2Login","login","chatroomLogin","v2ChatroomLogin"],h={cmd:t};if(o!==1&&!_t(u).call(u,t))return this.logger.warn("clientSocketV2::NIM login status is "+o+", so can not sendCmd "+t),He.reject(new Me({code:ce.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:O({reason:"Can not sendCmd due to no logined"},h)}));var g=t!=="heartbeat",v=g?this.packetSer++:0,_=dg(t,v,this.logger,e);if(!_){var I=new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:O(O({},h),{reason:"SendCmd::createCmd error: "+v+" "+t})});return this.logger.error(I),He.reject(I)}var C=_.packet,A=_.hasPacketResponse,N=_.hasPacketTimer,F=xe(C);g&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::sendCmd: "+C.SID+"_"+C.CID+","+t+",ser:"+v,F):this.logger.log("clientSocketV2::sendCmd: "+C.SID+"_"+C.CID+","+t+",ser:"+v));var j=new Date().getTime();return new He(function(W,U){A&&i.sendingCmdMap.set(v,{cmd:t,params:e,callback:[W,U],timer:N?or(function(){var te=new Me({code:ce.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:O({ser:v,reason:"Packet Timeout: ser "+v+" cmd "+t,timetag:new Date().getTime()},h)});i.markCmdInvalid(v,te,t)},r&&r.timeout?r.timeout:i.packetTimeout):null});try{i.socket.send(F),A||W(C)}catch(te){var ie=new Me({code:ce.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:O({ser:v,reason:"Unable to send packet"+(te&&te.message?": "+te.message:""),timetag:new Date().getTime(),rawError:te},h)});i.markCmdInvalid(v,ie,t),U(ie)}}).catch(function(W){return k(i,void 0,void 0,T.mark(function U(){var ie,te,H,V,w;return T.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(te=W,H=[ce.V2NIM_ERROR_CODE_DISCONNECT,ce.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,ce.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],_t(H).call(H,te.code)){re.next=4;break}return re.abrupt("return",He.reject(te));case 4:return this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:(ie=this.socket)===null||ie===void 0?void 0:ie.sessionId,start_time:j,action:2,exception_service:6}),V=Pe(te,"detail.disconnect_reason")||"",w=te.code===ce.V2NIM_ERROR_CODE_DISCONNECT?xe({disconnect_reason:V}):te.detail.reason,this.reporter.reportTraceUpdateV2("exceptions",{code:te.code,description:w,operation_type:1,target:C.SID+"-"+C.CID,context:""+C.SER},{asyncParams:We.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),re.abrupt("return",He.reject(te));case 10:case"end":return re.stop()}},U,this)}))})},p.onMessage=function(t){var e=pg(t,this.logger);if(e)for(var r,i=KP(e);!(r=i()).done;){var o=r.value,u=o.raw.ser;if(o.error&&this.logger.error("clientSocketV2::onMessage packet error",o.raw.sid+"_"+o.raw.cid+", ser:"+u+",",o.error),o.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",o.raw.sid+"_"+o.raw.cid+", ser:"+u);o.cmd!=="heartbeat"&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::recvCmd "+o.raw.sid+"_"+o.raw.cid+","+o.cmd+",ser:"+u,o.content):this.logger.log("clientSocketV2::recvCmd "+o.raw.sid+"_"+o.raw.cid+","+o.cmd+",ser:"+u+";code:"+o.raw.code)),this.packetHandler(o)}},p.packetHandler=function(t){var e,r,i,o,u=this;if(t){var h=t.raw.ser,g=this.sendingCmdMap.get(h);if(g&&g.cmd===t.cmd){var v=g.callback,_=g.timer,I=g.params;if(clearTimeout(_),t.params=I,this.sendingCmdMap.delete(h),t.cmd==="heartbeat")return void v[0]();var C=(r=(e=this.core[t.service])===null||e===void 0?void 0:e.process)===null||r===void 0?void 0:r.call(e,t);C&&typeof C.then=="function"?C.then(function(N){v[0](N)}).catch(function(N){v[1](N)}):(this.logger.log("clientSocketV2::handlerFn without promise",t.service,t.cmd),v[0](t))}else{var A=(o=(i=this.core[t.service])===null||i===void 0?void 0:i.process)===null||o===void 0?void 0:o.call(i,t);A&&typeof A.then=="function"&&A.catch(function(N){u.logger.error("clientSocketV2::no obj cache, no process handler",N)})}}},p.markCmdInvalid=function(t,e,r){var i=this.sendingCmdMap.get(t);if(i){var o=i.callback,u=i.timer;u&&clearTimeout(u),this.sendingCmdMap.delete(t),this.logger.warn("clientSocketV2::packet "+t+", "+r+" is invalid:",e),o[1](e)}},p.markAllCmdInvaild=function(t){var e,r=this;this.logger.log("markAllCmdInvaild",t),ae(e=this.sendingCmdMap).call(e,function(i){var o=i.callback,u=i.timer,h=i.cmd;r.logger.log("clientSocketV2::markAllCmdInvaild:cmd "+h),u&&clearTimeout(u),o[1](t)}),this.sendingCmdMap.clear()},p.ping=function(){var t;return k(this,void 0,void 0,T.mark(function e(){var r=this;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return clearTimeout(this.pingTimer),o.prev=1,o.next=4,this.sendCmd("heartbeat");case 4:o.next=20;break;case 6:if(o.prev=6,o.t0=o.catch(1),o.t0.code!==ce.V2NIM_ERROR_CODE_DISCONNECT){o.next=11;break}return o.abrupt("return");case 11:return o.next=13,this.testHeartBeat5Timeout();case 13:if(!o.sent){o.next=20;break}return o.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:(t=this.socket)===null||t===void 0?void 0:t.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(ho.OFFLINE,"PingError"),o.abrupt("return");case 20:this.pingTimer=or(function(){r.ping()},3e4);case 21:case"end":return o.stop()}},e,this,[[1,6]])}))},p.testHeartBeat5Timeout=function(){return k(this,void 0,void 0,T.mark(function t(){var e;return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:clearTimeout(this.pingTimer),e=0;case 2:if(!(e<5)){i.next=15;break}return i.prev=3,i.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return i.abrupt("return",!1);case 9:i.prev=9,i.t0=i.catch(3),this.logger.log("clientSocketV2::test heartbeat "+e+" Timeout");case 12:e++,i.next=2;break;case 15:return i.abrupt("return",!0);case 16:case"end":return i.stop()}},t,this,[[3,9]])}))},p.initOnlineListener=function(){var t=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,We.net.onNetworkStatusChange(function(e){t.logger.log("clientSocketV2::onlineListener:network change",e);var r=t.auth.getConnectStatus(),i=t.auth.getLoginStatus();e.isConnected&&i===1?t.ping():e.isConnected&&r===3?(t.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),t.auth.reconnect.clearReconnectTimer(),t.auth.reconnect.doReLogin()):e.isConnected||t.doDisconnect(ho.OFFLINE,"OfflineListener")}))},p.destroyOnlineListener=function(){this.logger.log("clientSocketV2::onlineListener:destroy"),We.net.offNetworkStatusChange(),this.hasNetworkListener=!1},a}(),WP=function(){function a(l){this.currenRetryCount=0,this.backoff=new xd({max:8e3,min:1600,jitter:.01}),this.reconnectTimer=0,this.core=l,this.auth=l.V2NIMLoginService}var p=a.prototype;return p.reset=function(){this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer)},p.clearReconnectTimer=function(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},p.attempToReLogin=function(){var t=this,e=this.backoff.duration();if(typeof this.reconnectDelayProvider=="function")try{var r=this.reconnectDelayProvider(e);typeof r=="number"&&r>=0&&(e=r>=1e3?r:r+200+Math.ceil(300*Math.random()))}catch(i){this.core.logger.error("reconnect::connectDelayProvider excute failed,",i)}return this.currenRetryCount++,this.core.logger.log("reconnect::reconnect timer is about to be set, delay "+e+" ms, current retry count is "+this.currenRetryCount),this.core.reporter.reportTraceStart("login",{user_id:this.auth.getLoginUser(),action:"auto_login",binary_websocket:this.auth.binaryWebsocket}),this.clearReconnectTimer(),this.reconnectTimer=or(function(){t.core.logger.log("reconnect::reconnect timer is now triggered");var i=t.auth.getConnectStatus();i===3?t.doReLogin():t.core.logger.warn("reconnect::reconnect timer is over because connect status now is "+i)},e),!0},p.doReLogin=function(){var t=this;this.auth.loginOption.forceMode=!1,this.auth.originLoginPromise=this.auth.doLogin(!0);var e=this.auth.previousLoginManager.add(this.auth.originLoginPromise);return e.then(function(){t.core.reporter.reportTraceEnd("login",!0)}).catch(function(r){var i=r;if(t.core.logger.warn("reconnect::try login but failed due to",i),t.core.reporter.reportTraceEnd("login",!1),t.auth.checkLoginTerminalCode(i&&i.code))return t.auth.clientSocket.doDisconnect(Tn.ACTIVE,"ReloginTerminated"),void t.auth.lifeCycle.processEvent("exited",i);i&&i.code===399&&t.auth.lbs.reset(),t.auth.lifeCycle.processEvent("waiting")}),e},p._setReconnectDelayProvider=function(t){this.reconnectDelayProvider=t},a}(),JP=function(){function a(l){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=l,this.auth=l.V2NIMLoginService}var p=a.prototype;return p.getLbsInfos=function(){return k(this,void 0,void 0,T.mark(function t(){var e,r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.socketLinkUrls.length>0)){h.next=5;break}return e=this.socketLinkUrls.shift(),this.socketLinkUrls=[],this.core.logger.log("V2NIMLoginService::getLbsInfos:use cache link",e),h.abrupt("return",He.resolve(e));case 5:return this.auth.lifeCycle.processEvent("addressing"),this.core.reporterHookLBS.start(this.core.account),r=po(this.auth.config.lbsUrls),h.prev=8,h.next=11,this.ladderLoad(r);case 11:if((i=h.sent).status===200&&i.data){h.next=15;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",i.status,i),new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V2NIMLoginService::getLbsInfos failed, status "+i.status}});case 15:this.success(i),h.next=26;break;case 18:if(h.prev=18,h.t0=h.catch(8),o=h.t0,this.core.logger.error("V2NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",h.t0),this.reportForFail(r[0],o.code,o.message),!this.checkTerminator(o.code)){h.next=25;break}throw h.t0;case 25:this.socketLinkUrls=[this.auth.config.linkUrl];case 26:return h.abrupt("return",this.socketLinkUrls.shift());case 27:case"end":return h.stop()}},t,this,[[8,18]])}))},p.checkTerminator=function(t){return t===ce.V2NIM_ERROR_CODE_CANCELLED||t===ce.V2NIM_ERROR_CODE_TIMEOUT},p.generateUrl=function(t){return t+(wt(t).call(t,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},p.requstLbs=function(t){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(t),{method:"GET",dataType:"json",timeout:8e3}))},p.setLadderTimer=function(t,e,r,i){var o=this;this.timer&&clearTimeout(this.timer);var u=t[e];this.timer=or(function(){u&&(o.setLadderTimer(t,e+1,r,i),o.core.logger.log("V2NIMLoginService::getLbsInfos "+e+":",u),o.reportForLbsStart(u,e),o.requstLbs(u).then(function(h){o.reset(),r(O(O({},h),{url:u}))}).catch(function(h){var g;if(o.core.logger.warn("V2NIMLoginService::getLbsInfos "+e+" failed:",h),o.failedCount+=1,o.reportForFailOnce(u,h.code,((g=h.detail)===null||g===void 0?void 0:g.reason)||h.message),o.failedCount>=t.length||o.checkTerminator(h.code))return o.reset(),void i(h)}))},2e3)},p.ladderLoad=function(t){var e=this;return new He(function(r,i){t.length>1&&e.setLadderTimer(t,1,r,i);var o=t[0];e.core.logger.log("V2NIMLoginService::getLbsInfos 0:",o),e.reportForLbsStart(o,0),e.requstLbs(o).then(function(u){e.reset(),r(O(O({},u),{url:o}))}).catch(function(u){var h;e.failedCount+=1,e.core.logger.warn("V2NIMLoginService::getLbsInfos 0 failed:",u),e.reportForFailOnce(o,u.code,((h=u.detail)===null||h===void 0?void 0:h.reason)||u.message),(e.failedCount>=t.length||e.checkTerminator(u.code))&&(e.reset(),i(u))})})},p.success=function(t){var e,r,i,o,u=t.data.common,h=u["mix.link"]||[],g=u["link.default"]||[];this.socketLinkUrls=dt(e=dt(h).call(h,g)).call(e,this.auth.config.linkUrl),t.data["nos-chunk"]&&(!((i=this.core.cloudStorage)===null||i===void 0)&&i.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nos-chunk",t.data["nos-chunk"]),this.core.cloudStorage.setOptions({chunkUploadHost:t.data["nos-chunk"]})),qt(t.data.nosup)&&t.data.nosup.length>0&&(!((o=this.core.cloudStorage)===null||o===void 0)&&o.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nosup",t.data.nosup),this.core.cloudStorage.setOptions({commonUploadHostBackupList:t.data.nosup,commonUploadHost:t.data.nosup[0]})),this.core.logger.log("V2NIMLoginService::getLbsInfos success, socket link:",ht(r=this.socketLinkUrls).call(r,0),"chunkUploadHost: ",t.data["nos-chunk"]),this.reportForLbsSuccess(t.url,t.data)},p.reportForLbsStart=function(t,e){this.core.reporterHookLBS.updateBegin({target:t,index:e})},p.reportForLbsSuccess=function(t,e){this.core.reporterHookLBS.updateComplete({target:t,code:200,body:xe(e)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,code:200,succeed:!0},{asyncParams:We.net.getNetworkStatus()})},p.reportForFailOnce=function(t,e,r){this.core.reporterHookLBS.updateComplete({target:t,code:e,body:r})},p.reportForFail=function(t,e,r){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,description:r,code:e,succeed:!1},{asyncParams:We.net.getNetworkStatus()})},p.reset=function(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},a}(),QP=function(){function a(l){this.lastLoginClientKey="__NIM_LAST_LOGIN_CLIENT__",this.loginClients=[],this.loginClientOfThisConnection={},this.core=l,this.auth=l.V2NIMLoginService}var p=a.prototype;return p.verifyAuthentication=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g,v,_,I,C,A;return T.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,this.auth.doLoginStepsManager.add(this.refreshLoginToken(this.auth.account));case 2:return i=F.sent,F.next=5,this.auth.doLoginStepsManager.add(this.refreshThirdPartyExt(this.auth.account));case 5:return o=F.sent,this.auth.token=i,u=We.getSystemInfo(),h={appkey:this.core.options.appkey,account:this.auth.account,token:i,authType:this.auth.loginOption.authType,appLogin:t?0:1,clientType:16,clientSession:this.auth.clientSession,clientId:this.auth.deviceId,sdkVersion:100830,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.8.30":ht(r=u.userAgent.replace("{{appkey}}",this.core.options.appkey)).call(r,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:u.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:u.hostEnvEnum,sdkHumanVersion:this.core.options.flutterSdkVersion||"10.8.30",os:u.os,browser:u.browser,protocolVersion:1,customClientType:this.auth.config.customClientType,customTag:this.auth.config.customTag,thirdPartyExtension:o},g=u.os.toLowerCase(),We.platform!=="UNIAPP"||g!=="ios"&&g!=="android"&&g!=="harmonyos"?We.platform==="React Native"&&(this.core.logger.log("V2NIMLoginService deviceInfo",this.core.V2NIMLoginService.deviceInfo,"os",g),h.isReactNative=1,h.clientType=g==="ios"?2:1,h.deviceInfo=xe(O({IS_SUPPORT_HONOR:!0},this.core.V2NIMLoginService.deviceInfo))):(h.isReactNative=1,h.clientType=g==="ios"?2:g==="android"?1:65,u.pushDeviceInfo&&u.pushDeviceInfo.MANUFACTURER&&(h.deviceInfo=xe(O({IS_SUPPORT_HONOR:!0},u.pushDeviceInfo)))),this.core.logger.log("V2NIMLoginService::do login ",h.account,h.clientSession,h.appLogin),F.prev=12,F.next=15,this.auth.doLoginStepsManager.add(this.auth.clientSocket.sendCmd("v2Login",{tag:h}));case 15:v=F.sent,F.next=26;break;case 18:if(F.prev=18,F.t0=F.catch(12),_=F.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:_.code||0,succeed:!1,description:_.message},{asyncParams:We.net.getNetworkStatus()}),_.code!==ce.V2NIM_ERROR_CODE_CANCELLED&&_.code!==ce.V2NIM_ERROR_CODE_TIMEOUT){F.next=24;break}throw _;case 24:throw this.processLoginFailed(_),_;case 26:return I=v.content,C=I.data,A=I.loginClients,this.changeLoginClient(1,A),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:200,succeed:!0},{asyncParams:We.net.getNetworkStatus()}),this.loginClientOfThisConnection=l0(C),this.core.clientSocket.setSessionId(C.consid),We.localStorage.setItem(this.lastLoginClientKey,xe(O({account:this.auth.account},this.loginClientOfThisConnection))),F.abrupt("return",this.loginClientOfThisConnection);case 33:case"end":return F.stop()}},e,this,[[12,18]])}))},p.refreshLoginToken=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.auth.loginOption.authType!==0){h.next=2;break}return h.abrupt("return",this.auth.token);case 2:if(typeof this.auth.loginOption.tokenProvider=="function"){h.next=4;break}return h.abrupt("return",this.auth.token);case 4:return h.prev=4,h.next=7,this.auth.loginOption.tokenProvider(t);case 7:if(typeof(r=h.sent)!="string"){h.next=12;break}return h.abrupt("return",r);case 12:throw this.core.logger.error("V2NIMLoginService::excute tokenProvider complete but got Unexpected value:",r),new Me({code:ce.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute tokenProvider complete but got Unexpected value",rawData:r}});case 14:h.next=23;break;case 16:throw h.prev=16,h.t0=h.catch(4),i=h.t0,o=i,i.code!==ce.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute tokenProvider error:",i),o=new Me({code:ce.V2NIM_ERROR_CODE_CALLBACK_FAILED,desc:"Excute tokenProvider error",detail:{rawError:h.t0}})),this.processLoginFailed(i),o;case 23:case"end":return h.stop()}},e,this,[[4,16]])}))},p.refreshThirdPartyExt=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(typeof this.auth.loginOption.loginExtensionProvider=="function"){h.next=2;break}return h.abrupt("return","");case 2:return h.prev=2,h.next=5,this.auth.loginOption.loginExtensionProvider(t);case 5:if(typeof(r=h.sent)!="string"){h.next=10;break}return h.abrupt("return",r);case 10:throw this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider complete but got Unexpected value:",r),new Me({code:ce.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider complete but got Unexpected value",rawData:r}});case 12:h.next=25;break;case 14:if(h.prev=14,h.t0=h.catch(2),i=h.t0,o=i,i.code!==ce.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider error:",i),o=new Me({code:ce.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider error",rawError:h.t0}})),this.auth.loginOption.authType!==2){h.next=24;break}throw this.processLoginFailed(i),o;case 24:return h.abrupt("return","");case 25:case"end":return h.stop()}},e,this,[[2,14]])}))},p.processLoginFailed=function(t){this.auth.clientSocket.doDisconnect(Tn.ACTIVE,t),this.checkLoginTerminalCode(t.code)&&(this.auth.authenticator.reset(),this.auth.authenticator.clearLastLoginClient()),this.auth.lifeCycle.processEvent("loginFail",t)},p.changeLoginClient=function(t,e){var r=this,i=se(e).call(e,function(h){return l0(h)});if(t===1)this.loginClients=i,this.auth.emit("onLoginClientChanged",t,this.loginClients);else if(t===2){var o=at(i).call(i,function(h){var g,v=at(g=r.loginClients).call(g,function(_){return _.clientId===h.clientId});return r.loginClients.push(h),v.length===0});o.length>0&&this.auth.emit("onLoginClientChanged",t,o)}else if(t===3){var u=at(i).call(i,function(h){var g;return function(_,I){I=I||function(){return!0};for(var C=[],A=(_=_||[]).length,N=0,F=0;F<A;F++)I(_[F-N])&&(C.push(wn(_).call(_,F-N,1)[0]),N+=1);return C}(r.loginClients,function(v){return v.clientId===h.clientId&&v.consid===h.consid}),at(g=r.loginClients).call(g,function(v){return v.clientId===h.clientId}).length===0});u.length>0&&this.auth.emit("onLoginClientChanged",t,u)}},p.checkAutoLogin=function(t){if(t)return!1;var e=We.localStorage.getItem(this.lastLoginClientKey);if(!e)return!1;var r="",i="";try{var o=JSON.parse(e);r=Pe(o,"clientId"),i=Pe(o,"account")}catch{return!1}return r===this.auth.deviceId&&i===this.auth.account},p.checkLoginTerminalCode=function(t){var e=[ce.V2NIM_ERROR_CODE_CANCELLED,ce.V2NIM_ERROR_CODE_TIMEOUT,ce.V2NIM_ERROR_CODE_HANDSHAKE,302,317,ce.V2NIM_ERROR_CODE_FORBIDDEN,ce.V2NIM_ERROR_CODE_NOT_FOUND,ce.V2NIM_ERROR_CODE_PARAMETER_ERROR,ce.V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN,422,ce.V2NIM_ERROR_CODE_IM_DISABLED,ce.V2NIM_ERROR_CODE_APPKEY_NOT_EXIST,ce.V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED,ce.V2NIM_ERROR_CODE_APPKEY_BLOCKED,ce.V2NIM_ERROR_CODE_INVALID_TOKEN,ce.V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED,ce.V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST,ce.V2NIM_ERROR_CODE_ACCOUNT_BANNED,ce.V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST];return _t(e).call(e,t)},p.reset=function(){this.loginClients=[],this.loginClientOfThisConnection={}},p.clearLastLoginClient=function(){We.localStorage.removeItem(this.lastLoginClientKey)},a}(),zP=function(){function a(l){this.name="V2NIMLoginLifeCycle",this.loginStatus=0,this.connectStatus=0,this.core=l,this.auth=l.V2NIMLoginService,this.logger=l.logger}var p=a.prototype;return p.processEvent=function(t,e,r){var i=this.getConnectStatus();switch(t){case"addressing":this.logger.log(this.name+"::addressing"),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connect":this.logger.log(this.name+"::connecting"),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connectSucc":this.logger.log(this.name+"::connect success"),this.setLoginStatus(2),this.setConnectStatus(1);break;case"connectFail":this.logger.log(this.name+"::connect fail",e),this.setLoginStatus(3),this.setConnectStatus(0,e);break;case"connectionBroken":this.logger.log(this.name+"::connectionBroken:",e),this.setLoginStatus(3),this.setConnectStatus(0,e),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleDisconnected",e);break;case"loginSucc":this.logger.log(this.name+"::login success, verify authentication success"),this.setLoginStatus(1),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLoginSucc",r);break;case"loginFail":if(this.logger.log(this.name+"::login fail due to verify authentication failed:",e),!e)return;this.setLoginStatus(this.auth.authenticator.checkLoginTerminalCode(e.code)?0:3),this.setConnectStatus(0,e),this.auth.emit("onLoginFailed",e);break;case"logout":this.logger.log(this.name+"::logout"),this.setLoginStatus(0),this.setConnectStatus(0),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"kicked":this.logger.log(this.name+"::kicked",r),this.setLoginStatus(0),this.setConnectStatus(0,e),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleKicked");break;case"exited":this.logger.log(this.name+"::exited",e),this.setLoginStatus(0),this.setConnectStatus(0,e);break;case"waiting":this.logger.log(this.name+"::waiting to reconnect"),this.setLoginStatus(3),this.setConnectStatus(3),i!==2&&this.auth.reconnect.attempToReLogin()}},p.getConnectStatus=function(){return this.connectStatus},p.getLoginStatus=function(){return this.loginStatus},p.setLoginStatus=function(t){t!==this.loginStatus&&(this.loginStatus=t,this.auth.emit("onLoginStatus",t))},p.setConnectStatus=function(t,e){if(t!==this.connectStatus){var r=this.connectStatus;this.connectStatus=t,this.auth.emit("onConnectStatus",t),this.delegateConnectEvent(r,t,e)}},p.delegateConnectEvent=function(t,e,r){t===1&&e===0&&r&&this.auth.emit("onDisconnected",r),t===2&&e===0&&r&&this.auth.emit("onConnectFailed",r)},a}(),XP=function(){function a(l){this.core=l,this.auth=l.V2NIMLoginService,this.datas=[]}var p=a.prototype;return p.switchDataSync=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:o=t.type,u=t.state,h=t.error,g=t.subType,v=at(r=this.datas).call(r,function(A){return A.type===o&&A.subType===g}),v.length>0?(v[0].state=u,v[0].error=h):this.datas.push({type:o,state:u,subType:g}),_=Md(i=this.datas).call(i,function(A){return A.state===3}),o===1&&(u===2&&g==="mainSync"?(this.core.eventBus.emit("V2NIMLoginService/syncing"),this.auth.emit("onDataSync",o,u)):u===3&&_&&(this.core.eventBus.emit("V2NIMLoginService/syncDone",h),this.auth.emit("onDataSync",o,u,h)));case 5:case"end":return C.stop()}},e,this)}))},p.checkSyncing=function(){var t;return Ln(t=this.datas).call(t,function(e){return e.subType==="mainSync"&&e.state===2})},p.reset=function(){this.datas=[]},a}();function Ss(a,p){a=a||{};var l={};return ae(p=p||[]).call(p,function(t){a[t]!==void 0&&(l[t]=a[t])}),l}var ZP=["https://lbs.netease.im/lbs/webconf.jsp"],M0={retryCount:3,timeout:6e4,forceMode:!1,authType:0,syncLevel:0},eL=function(a){function p(t,e){var r,i;return e===void 0&&(e={}),(r=a.call(this,"V2NIMLoginService",t)||this).account="",r.previousLoginAccount="",r.token="",r.deviceId="",r.clientSession="",r.processId="",r.kickedDetail=null,r.binaryWebsocket=!0,r.core._registerDep(c0,"misc"),Kt({cmdMap:bP,cmdConfig:RP}),t.options.apiVersion==="v2"&&(Kt({cmdMap:AP,cmdConfig:NP}),r.core.auth=Ot(r)),r.previousLoginManager=new Rd,r.doLoginStepsManager=new Rd,r.loginTimerManager=new IS,r.loginOption=O({},M0),r.config={lbsUrls:ZP,linkUrl:"weblink.netease.im:443",linkSSL:!0},r.setOptions(e),t.V2NIMLoginService=Ot(r),r.core.options.binaryWebsocket!==!1&&typeof Uint8Array=="function"?(r.binaryWebsocket=!0,i=new $P(r.core)):(r.binaryWebsocket=!1,i=new YP(r.core)),r.clientSocket=i,r.core.options.apiVersion==="v2"&&(r.core.clientSocket=i),r.lifeCycle=new zP(t),r.reconnect=new WP(t),r.lbs=new JP(t),r.authenticator=new QP(t),r.dataSync=new XP(t),r}bt(p,a);var l=p.prototype;return l.setOptions=function(e){var r,i,o;P({lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e,"",!0),this.config=ao(this.config,e),(i=(r=this.core.clientSocket)===null||r===void 0?void 0:r.setLinkSSL)===null||i===void 0||i.call(r,(o=this.config.linkSSL)===null||o===void 0||o);var u="",h="";this.config.isFixedDeviceId?(u=We.localStorage.getItem("__NIM_DEVC_ID__")||jr(),h=We.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||jr(),We.localStorage.setItem("__NIM_DEVC_ID__",u),We.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",h)):(u=jr(),h=jr()),this.deviceId=u,this.clientSession=h,this.core.reporter.setConfig({common:{dev_id:u}})},l.reset=function(){this.account="",this.token="",this.processId="",this.lbs.reset(),this.reconnect.reset(),this.authenticator.reset(),this.authenticator.clearLastLoginClient(),this.dataSync.reset()},l.login=function(e,r,i){return i===void 0&&(i={}),k(this,void 0,void 0,T.mark(function o(){var u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(this._checkApiVersion(),u=We.getSystemInfo()||{},h=u.os?u.os.toLowerCase():"",We.platform!=="React Native"||h!=="android"||!this.hasSettingService||!this.core.V2NIMSettingService.offlinePushPlugin){_.next=13;break}return _.prev=4,_.next=7,this.core.V2NIMSettingService.getRNDeviceInfo();case 7:this.deviceInfo=_.sent,_.next=13;break;case 10:_.prev=10,_.t0=_.catch(4),this.logger.error(_.t0);case 13:if(e){_.next=15;break}throw new Qi({detail:{reason:"Empty account"}});case 15:if(P({retryCount:{type:"number",min:0,required:!1},forceMode:{type:"boolean",required:!1},authType:{type:"enum",values:[0,1,2],required:!1},syncLevel:{type:"enum",values:[1,0],required:!1}},i,"",!0),i.authType!==0||r){_.next=18;break}throw new Qi({detail:{reason:"When authType is 0, token cannot be empty"}});case 18:if(this.previousLoginAccount!==""&&this.previousLoginAccount!==e&&this.core._clearModuleData(),this.getLoginStatus()!==0){_.next=23;break}this.logger.log("V2NIMLoginService::login:allowLogin:"+e,i),_.next=29;break;case 23:if(this.getLoginStatus()!==1){_.next=27;break}return _.abrupt("return",this.smoothForLogined(e,r,i));case 27:if(this.getLoginStatus()!==2){_.next=29;break}return _.abrupt("return",this.smoothForLogining(e,r,i));case 29:return this.account=e,this.previousLoginAccount=e,this.token=r,this.processId=jr(),this.loginOption=ao(M0,i),this.kickedDetail=null,this.loginTimerManager.destroy(),this.loginTimerManager.addTimer(function(){var I=new Me({code:ce.V2NIM_ERROR_CODE_TIMEOUT,detail:{reason:"Login API timeout"}});g.doLoginStepsManager.clear(I),g.previousLoginManager.clear(I),g.originLoginPromise=void 0,g.lifeCycle.processEvent("exited",I)},this.loginOption.timeout>0?this.loginOption.timeout:6e4,1),_.prev=37,_.next=40,this.multiTryDoLogin();case 40:this.loginTimerManager.destroy(),_.next=47;break;case 43:throw _.prev=43,_.t1=_.catch(37),this.loginTimerManager.destroy(),_.t1;case 47:case"end":return _.stop()}},o,this,[[4,10],[37,43]])}))},l.getChatroomLinkAddress=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({roomId:{type:"string",regExp:/^\d+$/,required:!0,allowEmpty:!1},miniProgram:{type:"boolean",required:!1}},{roomId:e,miniProgram:r},"",!0),o=Zm()!=="unknow environment",r=r===void 0?o:r,g.next=5,this.clientSocket.sendCmd("v2GetChatroomLinkAddress",{roomId:e,miniProgram:r});case 5:return u=g.sent,g.abrupt("return",u.content.linkAddress);case 7:case"end":return g.stop()}},i,this)}))},l.multiTryDoLogin=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:i=new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"loginFailed"}}),o=0;case 2:if(!(o<=this.loginOption.retryCount)){v.next=32;break}return u="V2NIMLoginService::times of login try: "+o,o>0?this.logger.warn(u):this.logger.log(u),v.prev=5,this.originLoginPromise=e||this.doLogin(!1),e=void 0,v.next=10,this.previousLoginManager.add(this.originLoginPromise);case 10:return h=v.sent,this.core.reporter.reportTraceEnd("login",!0),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.originLoginPromise=void 0,v.abrupt("return",h);case 18:if(v.prev=18,v.t0=v.catch(5),i=v.t0||i,this.logger.error("V2NIMLoginService::login failed, times of login try: "+o+", err.code: "+(i==null?void 0:i.code)+', err.message: "'+(i==null?void 0:i.message)+'"'),i.code!==ce.V2NIM_ERROR_CODE_CANCELLED&&this.core.reporter.reportTraceEnd("login",!1),this.reconnect.clearReconnectTimer(),!this.checkLoginTerminalCode(i&&i.code)){v.next=28;break}throw this.lifeCycle.processEvent("exited",i),i;case 28:i&&i.code===399&&this.lbs.reset();case 29:o++,v.next=2;break;case 32:throw this.lifeCycle.processEvent("exited",i),i;case 34:case"end":return v.stop()}},r,this,[[5,18]])}))},l.doLogin=function(e){var r,i;return k(this,void 0,void 0,T.mark(function o(){var u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return u=!!e||this.authenticator.checkAutoLogin(this.loginOption.forceMode),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",u?{user_id:this.account,action:"auto_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}:{user_id:this.account,action:"manual_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:xe(this.loginOption),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:We.net.getNetworkStatus()}),_.next=6,this.doLoginStepsManager.add(this.lbs.getLbsInfos());case 6:return h=_.sent,_.next=9,this.doLoginStepsManager.add(this.clientSocket.connect(h,e));case 9:return _.next=11,this.doLoginStepsManager.add(this.authenticator.verifyAuthentication(u));case 11:if(g=_.sent,this.processId=jr(),this.clientSocket.resetSocketConfig(),this.reconnect.reset(),this.dataSync.reset(),this.lifeCycle.processEvent("loginSucc",void 0,O(O({},g),{isReconnect:e})),this.clientSocket.ping(),this.core.abtest.abtRequest(),typeof((r=this.core.V2NIMClientAntispamUtil)===null||r===void 0?void 0:r.downloadLocalAntiSpamVocabs)=="function"&&this.core.V2NIMClientAntispamUtil.downloadLocalAntiSpamVocabs(),typeof((i=this.core.cloudStorage)===null||i===void 0?void 0:i.init)!="function"){_.next=29;break}return _.prev=21,_.next=24,this.core.cloudStorage.init(g.timestamp);case 24:_.next=29;break;case 26:_.prev=26,_.t0=_.catch(21),this.logger.warn("doLogin::cloudStorage init error",_.t0);case 29:return _.abrupt("return",g);case 30:case"end":return _.stop()}},o,this,[[21,26]])}))},l.smoothForLogined=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(u=this.checkIsSameLogin(e,r,i),this.logger.warn("V2NIMLoginService::smoothForLogined:Logined, isSameLogin "+u),!u){g.next=6;break}return g.abrupt("return");case 6:return g.next=8,this.logout();case 8:return g.abrupt("return",this.login(e,r,i));case 9:case"end":return g.stop()}},o,this)}))},l.smoothForLogining=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(u=this.checkIsSameLogin(e,r,i),this.logger.warn("V2NIMLoginService::smoothForLogining:Logining progress exists, abort the previous login attempt and start next attempt, isSameLogin "+u),this.previousLoginManager.clear(),this.reconnect.reset(),this.account=e,this.previousLoginAccount=e,this.token=r,this.loginOption=ao(this.loginOption,i),!u){g.next=18;break}if(this.originLoginPromise){g.next=11;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"NoPreviousLoginExists"}});case 11:return this.reconnect.reset(),g.next=14,He.resolve();case 14:return g.next=16,this.multiTryDoLogin(this.originLoginPromise);case 16:g.next=25;break;case 18:return this.doLoginStepsManager.clear(),this.clientSocket.doDisconnect(Tn.ACTIVE,"Aborted"),this.reset(),this.lifeCycle.processEvent("logout"),g.next=24,He.resolve();case 24:return g.abrupt("return",this.login(e,r,i));case 25:case"end":return g.stop()}},o,this)}))},l.checkIsSameLogin=function(e,r,i){return this.account===e&&this.loginOption.authType===i.authType&&(i.authType!==0||this.token===r)},l.logout=function(){return k(this,void 0,void 0,T.mark(function e(){var r,i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.loginTimerManager.destroy(),this.originLoginPromise=void 0,r=this.getConnectStatus(),i=this.getLoginStatus(),u.t0=i,u.next=u.t0===1?10:u.t0===2?25:u.t0===3?29:u.t0===0?33:35;break;case 10:return u.prev=10,u.next=13,this.clientSocket.sendCmd("v2Logout",void 0,{timeout:1e3});case 13:this.clientSocket.doDisconnect(Tn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),u.next=24;break;case 18:u.prev=18,u.t1=u.catch(10),this.logger.error("Instance::disconnect sendCmd:logout error",u.t1),this.clientSocket.doDisconnect(Tn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout");case 24:return u.abrupt("break",37);case 25:case 29:return this.clientSocket.doDisconnect(Tn.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),u.abrupt("break",37);case 33:throw this.core._clearModuleData(),new Me({code:ce.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. loginStatus "+i+". connectStatus "+r}});case 35:throw this.core._clearModuleData(),new Me({code:ce.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. illegal status: loginStatus "+i+". connectStatus "+r}});case 37:case"end":return u.stop()}},e,this,[[10,18]])}))},l.getConnectStatus=function(){return this.lifeCycle.getConnectStatus()},l.getLoginStatus=function(){return this.lifeCycle.getLoginStatus()},l.getLoginUser=function(){return this.account},l.getLoginClients=function(){var e;return se(e=function(i,o){i=i||[],o=o||"";for(var u=[],h=[],g=0;g<i.length;g++){var v=i[g][o];wt(h).call(h,v)===-1&&(h.push(v),u.push(i[g]))}return u}(this.authenticator.loginClients,"clientId")).call(e,function(r){return Ss(r,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])})},l.getCurrentLoginClient=function(){var e;if(!((e=this.authenticator.loginClientOfThisConnection)===null||e===void 0)&&e.clientId)return Ss(this.authenticator.loginClientOfThisConnection,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])},l.getDataSync=function(){var e=this.dataSync.datas;return e&&e.length>0?se(e).call(e,function(r){return{type:r.type,state:r.state}}):null},l.setReconnectDelayProvider=function(e){this.reconnect._setReconnectDelayProvider(e)},l.kickOffline=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this._checkApiVersion(),P({clientId:{type:"string",allowEmpty:!1}},e,"",!0),u.next=4,this.clientSocket.sendCmd("v2KickOffline",{clientIds:[e.clientId]});case 4:if(i=u.sent,Pe(i,"content.clientIds.length")!==0){u.next=8;break}throw new Me({code:ce.V2NIM_ERROR_CODE_REQUEST_FAILED});case 8:case"end":return u.stop()}},r,this)}))},l.getKickedOfflineDetail=function(){return this.kickedDetail},l.checkLoginTerminalCode=function(e){return this.authenticator.checkLoginTerminalCode(e)},l.checkIllegalState=function(){if(!this.getLoginUser())throw new Me({code:ce.V2NIM_ERROR_CODE_ILLEGAL_STATE})},l._checkApiVersion=function(){if(this.core.options.apiVersion!=="v2")throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v2"'}})},l.v2LoginHandler=function(e){if(e.error)throw this.clientSocket.doDisconnect(Tn.ACTIVE,e.error),e.error;return e},l.v2LoginClientChangeHandler=function(e){this.authenticator.changeLoginClient(it(e.content.state),e.content.datas)},l.nimLoginClientChangeHandler=function(e){this.authenticator.changeLoginClient(it(e.content.state),e.content.datas)},l.qchatLoginClientChangeHandler=function(e){var r=it(e.content.state);r=r===1?2:3,this.authenticator.changeLoginClient(r,[e.content.data])},l.v2BeKickedHandler=function(e){if(e.error)this.core.logger.error("v2BeKickedHandler error, ",e.error);else{var r=function(o){return Yt({reason:{type:"number"},clientType:{type:"number"},customClientType:{type:"number"}},o)}(e.content);this.core.logger.warn("v2Bekicked::",r),this.kickedDetail=r,this.clientSocket.doDisconnect(Tn.KICKED,r),this.core._clearModuleData(),this.lifeCycle.processEvent("kicked",new Me({code:ce.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to kicked"}}),r),this.emit("onKickedOffline",r)}},l.emit=function(e){for(var r,i,o=this.name+"::emit "+e.toString(),u=arguments.length,h=new Array(u>1?u-1:0),g=1;g<u;g++)h[g-1]=arguments[g];if(e==="onLoginFailed"||e==="onDisconnected"||e==="onConnectFailed"){var v=h[0];this.logger.log(""+o,v.toString())}else if(e==="onDataSync"){var _=h[2];this.logger.log(""+o,h[0],h[1],_&&_.toString())}else{var I,C;(I=this.logger).log.apply(I,dt(C=[""+o]).call(C,h))}return(r=a.prototype.emit).call.apply(r,dt(i=[this,e]).call(i,h))},Ai(p,[{key:"hasSettingService",get:function(){var e;return!!(!((e=this.core.V2NIMSettingService)===null||e===void 0)&&e.name)}}]),p}($r),T0=$("".startsWith),tL=$("".slice),rL=Math.min,nL=ZI("startsWith");je({target:"String",proto:!0,forced:!nL},{startsWith:function(p){var l=xn(jt(this));XI(p);var t=JM(rL(arguments.length>1?arguments[1]:void 0,l.length)),e=xn(p);return T0?T0(l,e,t):tL(l,t,t+e.length)===e}});var iL=Gr("String").startsWith,gg=String.prototype,I0=function(a){var p=a.startsWith;return typeof a=="string"||a===gg||ge(gg,a)&&p===gg.startsWith?iL:p},la=function(){function a(l){this.name="V2NIMConversationIdUtil",this.core=l}var p=a.prototype;return p.conversationId=function(t,e){return this.core.account+"|"+t+"|"+e},p.p2pConversationId=function(t){return this.core.account+"|1|"+t},p.teamConversationId=function(t){return this.core.account+"|2|"+t},p.superTeamConversationId=function(t){return this.core.account+"|3|"+t},p.messageConversationId=function(t){return t.conversationType===1?t.senderId===this.core.account?this.p2pConversationId(t.receiverId):this.p2pConversationId(t.senderId):t.conversationType===2?this.teamConversationId(t.receiverId):this.superTeamConversationId(t.receiverId)},p.parseConversationType=function(t){try{if(t&&I0(t).call(t,this.core.account+"|")){var e=t.replace(this.core.account+"|","");return Number(e[0])}return this.core.logger.warn("conversationId is not start with "+this.core.account),0}catch{return 0}},p.parseConversationTargetId=function(t){try{if(t&&I0(t).call(t,this.core.account+"|")){var e=t.replace(this.core.account+"|","");return ht(e).call(e,2)}return this.core.logger.warn("conversationId is not start with "+this.core.account),""}catch{return""}},p.convertToV1ConversationId=function(t){var e=this.parseConversationType(t);return(e===1?"p2p":e===2?"team":"superTeam")+"|"+this.parseConversationTargetId(t)},a}(),sL=Gr("Array").keys,vg=Array.prototype,oL={DOMTokenList:!0,NodeList:!0},Pd=function(a){var p=a.keys;return a===vg||ge(vg,a)&&p===vg.keys||Ct(oL,no(a))?sL:p},S0=function(){function a(){this.messages=new Dr,this.capacity=1e4}var p=a.prototype;return p.reset=function(){this.messages.clear()},p.getMessageById=function(t){if(t)return this.messages.get(t)},p.getMessagesByConversationId=function(t){var e,r=[];return ae(e=this.messages).call(e,function(i){i.conversationId===t&&r.push(i)}),r},p.getLastMessageOfConversation=function(t){var e=this.getMessagesByConversationId(t);if(e.length!==0)return Cr(e).call(e,function(r,i){return i.createTime>r.createTime?i:r},e[0])},p.upsertMessages=function(t){var e=this;ae(t).call(t,function(r){e.setLRU(r.messageClientId,r)})},p.setLRU=function(t,e){if(this.messages.has(t))this.messages.delete(t);else if(this.messages.size>=this.capacity){var r,i=Pd(r=this.messages).call(r).next().value;i&&this.messages.delete(i)}this.messages.set(t,e)},p.deleteMessage=function(t){this.messages.delete(t)},p.deleteMessages=function(t,e){var r,i=this;ae(r=this.messages).call(r,function(o){t===o.conversationId&&(!e||e&&o.createTime<e)&&i.messages.delete(o.messageClientId)})},a}(),yg={accountId:{type:"string",allowEmpty:!1},content:{type:"object",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number",allowEmpty:!1}}},messages:{type:"array",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number"},role:{type:"enum",values:["assistant","user","system"]}}},promptVariables:{type:"jsonstr",required:!1},modelConfigParams:{type:"object",required:!1,rules:{prompt:{type:"string",required:!1},maxTokens:{type:"number",required:!1},topP:{type:"number",required:!1},temperature:{type:"number",required:!1}}},aiStream:{type:"boolean",required:!1}},aL=O({requestId:{type:"string",allowEmpty:!1}},yg),cL={requestId:{type:"string",allowEmpty:!1},accountId:{type:"string",allowEmpty:!1}},Ld=[1,3,2,0],Rl=[2,7,12,100,6,1,-1,4,5,11,0,10,3],E0={routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}},C0={pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forceContent:{type:"string",required:!1},forcePushAccountIds:{type:"array",required:!1,itemType:"string"}},b0={antispamEnabled:{type:"boolean",required:!1},antispamBusinessId:{type:"string",required:!1},antispamCustomMessage:{type:"string",required:!1},antispamCheating:{type:"string",required:!1},antispamExtension:{type:"string",required:!1}},A0={messageConfig:{type:"object",required:!1,rules:{readReceiptEnabled:{type:"boolean",required:!1},lastMessageUpdateEnabled:{type:"boolean",required:!1},historyEnabled:{type:"boolean",required:!1},roamingEnabled:{type:"boolean",required:!1},onlineSyncEnabled:{type:"boolean",required:!1},offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},routeConfig:{type:"object",required:!1,rules:E0},pushConfig:{type:"object",required:!1,rules:C0},antiSpamConfig:{type:"object",required:!1,rules:b0},robotConfig:{type:"object",required:!1,rules:{accountId:{type:"string",required:!1},topic:{type:"string",required:!1},function:{type:"string",required:!1},customContent:{type:"string",required:!1}}},aiConfig:{type:"object",required:!1,rules:yg},targetConfig:{type:"object",required:!1,rules:{receiverIds:{type:"array",itemType:"string"},inclusive:{type:"boolean"},newMemberVisible:{type:"boolean",required:!1}}},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},lL={message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:Rl},messageClientId:{type:"string",allowEmpty:!1}}},params:{type:"object",rules:A0,required:!1},replyMessage:{type:"object",rules:{conversationType:{type:"enum",values:[1,3,2,0]},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},R0={conversationId:{type:"string",allowEmpty:!1},message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:Rl},messageClientId:{type:"string",allowEmpty:!1},attachment:{type:"object",required:!1,rules:{file:{type:"file",required:!1}}}}},params:{type:"object",required:!1,rules:A0}},uL={message:{type:"object",rules:{messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:Ld},createTime:{type:"number"}}},params:{type:"object",rules:{postscript:{type:"string",required:!1},serverExtension:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},env:{type:"string",required:!1}},required:!1}},dL={conversationId:{type:"string",allowEmpty:!1},messageTypes:{type:"array",required:!1,itemType:"enum",values:Rl},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[1,0],required:!1},anchorMessage:{type:"object",required:!1,rules:{messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},dc={conversationType:{type:"enum",values:Ld},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1}},pL={messageRefers:{type:"array",required:!0,rules:dc}},N0={conversationId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:Ld},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},hL={messages:{type:"array",rules:N0}},fL={conversationId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},onlineSync:{type:"boolean",required:!1},deleteRoam:{type:"boolean",required:!1},clearMode:{type:"enum",values:[0],required:!1}},_g={serverExtension:{type:"string",required:!1}},mL={messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[1]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},gL={messages:{type:"array",rules:{messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},min:1}},vL={voiceUrl:{type:"string",required:!1,allowEmpty:!1},file:{type:"file",required:!1},voicePath:{type:"string",required:!1,allowEmpty:!1},mimeType:{type:"string",required:!1,allowEmpty:!1},sampleRate:{type:"string",required:!1,allowEmpty:!1},duration:{type:"number",required:!0,min:0},sceneName:{type:"string",required:!1}},yL={message:{type:"object",rules:{conversationType:{type:"enum",values:Ld},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}},index:{type:"number",min:1},serverExtension:{type:"string",required:!1},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},needBadge:{type:"boolean",required:!1},title:{type:"string",required:!1,allowEmpty:!1},content:{type:"string",required:!1,allowEmpty:!1},pushPayload:{type:"string",required:!1,allowEmpty:!1}}}},_L={messages:{type:"array",rules:{conversationType:{type:"enum",values:[1,3,2,0]},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},ML={params:{type:"object",rules:{collectionType:{type:"number",min:1},collectionData:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},uniqueId:{type:"string",required:!1}}}},TL={collections:{type:"array",min:1,rules:{collectionId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},IL={serverExtension:{type:"string",required:!1},collection:{type:"object",rules:{collectionId:{type:"string",allowEmpty:!1},collectionType:{type:"number"},createTime:{type:"number"}}}},k0={beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",required:!1,values:[1,0]},collectionType:{type:"number",required:!1},anchorCollection:{type:"object",required:!1,rules:{collectionId:{type:"string",allowEmpty:!1,required:!1},createTime:{type:"number",required:!1}}}},SL={keyword:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},sortOrder:{type:"enum",values:[1,0],required:!1},conversationLimit:{type:"number",min:0,required:!1},messageLimit:{type:"number",min:1,required:!1},p2pAccountIds:{type:"array",required:!1,itemType:"string"},teamIds:{type:"array",required:!1,itemType:"string"},senderAccountIds:{type:"array",required:!1,itemType:"string"},messageTypes:{type:"array",required:!1,itemType:"enum",values:Rl},messageSubtypes:{type:"array",required:!1,itemType:"number"}},EL={conversationId:{type:"string",required:!1,allowEmpty:!1},keywordList:{type:"array",required:!1,itemType:"string"},keywordMatchType:{type:"enum",values:[1,0],required:!1},senderAccountIds:{type:"array",required:!1,itemType:"string"},messageTypes:{type:"array",required:!1,itemType:"enum",values:Rl},messageSubtypes:{type:"array",required:!1,itemType:"number"},searchStartTime:{type:"number",required:!1},searchTimePeriod:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},pageToken:{type:"string",required:!1}},CL={message:{type:"object",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]}}}},bL={messages:{type:"array",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]}},min:1}},Mg={sceneName:{type:"string",required:!1},name:{type:"string",required:!1}},O0=O(O({},Mg),{duration:{type:"number",required:!1}}),AL=O(O({},O0),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),RL=O(O({},Mg),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),NL={messageRefer:{type:"object",required:!0,rules:dc},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[1,0],required:!1},excludeMessageServerId:{type:"string",required:!1,allowEmpty:!1}},kL={senderId:{type:"string",allowEmpty:!1},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1}},OL={subType:{type:"number",min:0,required:!1},text:{type:"string",required:!1},attachment:{type:"object",required:!1},serverExtension:{type:"string",required:!1},routeConfig:{type:"object",required:!1,rules:E0},pushConfig:{type:"object",required:!1,rules:C0},antiSpamConfig:{type:"object",required:!1,rules:b0},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},w0={messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"},aiConfig:{type:"object",rules:yg}},wL={operationType:{type:"enum",values:[0,1,2]},updateContent:{type:"string",allowEmpty:!0,required:!1}},xL={operationType:{type:"enum",values:[2,1],required:!0}},PL=function(){function a(l,t){this.p2pMessageReceipts={},this.core=l,this.service=t}var p=a.prototype;return p.reset=function(){this.p2pMessageReceipts={}},p.sendP2PMessageReceipt=function(t){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(P(mL,t,"",!0),t.senderId!==this.core.account){i.next=3;break}throw new Qi({detail:{reason:"sendP2PMessageReceipt. sender: "+t.senderId+" is not allowed to send msg receipt"}});case 3:return i.next=5,this.core.sendCmd("v2SendP2PMessageReceipt",{tag:{receiverId:t.senderId,messageClientId:t.messageClientId,createTime:t.createTime}});case 5:case"end":return i.stop()}},e,this)}))},p.isPeerRead=function(t){if(t.conversationType!==1||t.senderId!==this.core.account)return!1;if(t.senderId===this.core.account&&t.receiverId===this.core.account)return!0;var e=this.core.V2NIMConversationIdUtil.messageConversationId(t),r=this.p2pMessageReceipts[e]||0;return t.createTime<=r},p.getP2PMessageReceipt=function(t){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(Nr(this.core.account,t),this.core.V2NIMConversationIdUtil.parseConversationType(t)===1){i.next=4;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getP2PMessageReceipt: conversationId is not p2p conversationId"}});case 4:return i.abrupt("return",{conversationId:t,timestamp:this.p2pMessageReceipts[t]||0});case 5:case"end":return i.stop()}},e,this)}))},p.getTeamMessageReceipts=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o=this;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(P(bL,{messages:t},"",!0),!Ln(t).call(t,function(g){return g.senderId!==o.core.account})){h.next=3;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 3:if(!Ln(t).call(t,function(g){return g.receiverId!==t[0].receiverId})){h.next=5;break}throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: exist messages receiverId is not same"}});case 5:return h.next=7,this.core.sendCmd("v2GetTeamMessageReceipts",{tag:t});case 7:return i=h.sent,h.abrupt("return",se(r=i.content.data).call(r,function(g){return O(O({},g),{conversationId:o.core.V2NIMConversationIdUtil.teamConversationId(g.receiverId)})}));case 9:case"end":return h.stop()}},e,this)}))},p.getTeamMessageReceiptDetail=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(P(CL,{message:t},"",!0),t.senderId===this.core.account){o.next=3;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceiptDetail::senderId "+t.senderId+" incorrect"}});case 3:return o.next=5,this.core.sendCmd("v2GetTeamMessageReceiptDetail",{tag:t});case 5:return r=o.sent,o.abrupt("return",{readReceipt:{conversationId:this.core.V2NIMConversationIdUtil.teamConversationId(t.receiverId),messageClientId:t.messageClientId,messageServerId:t.messageServerId,readCount:r.content.readAccountList.length,unreadCount:r.content.unreadAccountList.length},readAccountList:r.content.readAccountList,unreadAccountList:r.content.unreadAccountList});case 7:case"end":return o.stop()}},e,this)}))},p.sendTeamMessageReceipts=function(t){return k(this,void 0,void 0,T.mark(function e(){var r=this;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!Ln(t).call(t,function(u){return u.conversationId!==t[0].conversationId})){o.next=2;break}throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: conversationId not same"}});case 2:if(P(gL,{messages:t},"",!0),!Ln(t).call(t,function(u){return u.senderId===r.core.account})){o.next=5;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 5:return o.next=7,this.core.sendCmd("v2SendTeamMessageReceipts",{tag:t});case 7:return o.abrupt("return");case 8:case"end":return o.stop()}},e,this)}))},p.syncP2PMessagReceiptsHandler=function(t){var e,r=this,i=se(e=t.content.data).call(e,function(o){var u=r.core.V2NIMConversationIdUtil.p2pConversationId(o.senderId),h=o.createTime;return r.p2pMessageReceipts[u]=h,{conversationId:u,timestamp:h}});this.service.emit("onReceiveP2PMessageReadReceipts",i)},p.onP2PMessageReceiptsHandler=function(t){var e=this.core.V2NIMConversationIdUtil.p2pConversationId(t.content.data.senderId),r=t.content.data.createTime;this.p2pMessageReceipts[e]=r,this.service.emit("onReceiveP2PMessageReadReceipts",[{conversationId:e,timestamp:r}])},p.onTeamMessageReceiptsHandler=function(t){var e,r=this,i=se(e=t.content.data).call(e,function(o){return{conversationId:r.core.V2NIMConversationIdUtil.teamConversationId(o.receiverId),messageServerId:o.messageServerId,messageClientId:o.messageClientId,readCount:o.readCount,unreadCount:o.unreadCount,latestReadAccount:o.latestReadAccount}});this.service.emit("onReceiveTeamMessageReadReceipts",i)},a}(),LL={"31_1":"v2TeamCreate","32_1":"v2SuperTeamCreate","31_5":"v2TeamInviteMembers","32_5":"v2SuperTeamInviteMembers","31_6":"v2TeamKickMembers","32_6":"v2SuperTeamKickMembers","31_8":"v2TeamLeave","32_7":"v2SuperTeamLeave","31_7":"v2TeamUpdateInfo","32_8":"v2SuperTeamUpdateInfo","31_9":"v2TeamGetInfo","32_9":"v2SuperTeamGetInfo","31_12":"v2TeamDismiss","32_4":"v2SuperTeamDismiss","31_13":"v2TeamApplyToJoin","32_20":"v2SuperTeamApplyToJoin","31_14":"v2TeamAcceptJoinApplication","32_21":"v2SuperTeamAcceptJoinApplication","31_15":"v2TeamRejectJoinApplication","32_22":"v2SuperTeamRejectJoinApplication","31_16":"v2TeamAddManagers","32_26":"v2SuperTeamAddManagers","31_17":"v2TeamRemoveManagers","32_27":"v2SuperTeamRemoveManagers","31_18":"v2TeamTransferOwner","32_31":"v2SuperTeamTransferOwner","31_19":"v2TeamUpdateSelfMemberInfo","32_10":"v2SuperTeamUpdateSelfMemberInfo","31_20":"v2TeamUpdateMember","32_30":"v2SuperTeamUpdateMember","31_21":"v2TeamAcceptInvitation","32_23":"v2SuperTeamAcceptInvitation","31_22":"v2TeamRejectInvite","32_24":"v2SuperTeamRejectInvite","31_33":"v2TeamGetMemberInvitor","32_35":"v2SuperTeamGetMemberInvitor","31_25":"v2TeamMemberSetChatBannedStatus","32_29":"v2SuperTeamMemberSetChatBannedStatus","31_32":"v2TeamSetChatBannedMode","32_28":"v2SuperTeamSetChatBannedMode","31_34":"v2TeamGetByIds","32_36":"v2SuperTeamGetByIds","31_35":"v2TeamMemberGetListByIds","32_37":"v2SuperTeamMemberGetListByIds","31_36":"v2TeamMemberGetList","8_101":"v2TeamCreateMultiSync","8_109":"v2TeamSync","8_119":"v2TeamMemberUpdateMultiSync","8_126":"v2TeamMembersOfSelfInSync","21_101":"v2SuperTeamCreateMultiSync","21_109":"v2SuperTeamSync","21_110":"v2SuperTeamMemberUpdateMultiSync","21_111":"v2SuperTeamMembersOfSelfInSync"},Vd={antispamBusinessId:1},Nt="V2NIMTeamService",zr={teamId:1,name:3,teamType:{id:4,retConverter:function(p){return+p==0?1:+p}},ownerAccountId:5,memberLimit:{id:6,retType:"number"},isValidTeam:{id:8,retConverter:function(p,l){return+p==1&&(l[13]===void 0||+l[13]==1)}},memberCount:{id:9,retType:"number"},memberUpdateTime:{id:10,retType:"number"},createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},intro:14,announcement:15,joinMode:{id:16,retType:"number"},serverExtension:18,customerExtension:19,avatar:20,agreeMode:{id:21,retType:"number"},inviteMode:{id:22,retType:"number"},updateInfoMode:{id:23,retType:"number"},updateExtensionMode:{id:24,retType:"number"},chatBannedMode:{id:101,retType:"number"}},Es={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},joinTime:{id:10,retType:"number"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,followAccountIds:{id:16,retConverter:function(p){try{return JSON.parse(p)}catch{return[]}}}},fo={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,joinTime:{id:15,retType:"number"},followAccountIds:{id:17,retConverter:function(p){try{return JSON.parse(p)}catch{return[]}}}},x0={accountIds:{id:1,converter:function(p){return xe(p)}},operation:2},VL={v2TeamCreate:{sid:31,cid:1,service:Nt,params:[{type:"Property",name:"team",reflectMapper:zr},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:Vd}],response:[{type:"Property",name:"team",reflectMapper:Te(zr)},{type:"StrArray",name:"failedList"}]},v2SuperTeamCreate:{sid:32,cid:1,service:Nt,params:[{type:"Property",name:"team",reflectMapper:zr},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:Vd}],response:[{type:"Property",name:"team",reflectMapper:Te(zr)},{type:"StrArray",name:"failedList"}]},v2TeamInviteMembers:{sid:31,cid:5,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},v2SuperTeamInviteMembers:{sid:32,cid:5,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},v2TeamUpdateInfo:{sid:31,cid:7,service:Nt,params:[{type:"Property",name:"team",reflectMapper:zr},{type:"Property",name:"antispamConfig",reflectMapper:Vd}],response:[{type:"Long",name:"teamId"},{type:"Long",name:"timestamp"}]},v2SuperTeamUpdateInfo:{sid:32,cid:8,service:Nt,params:[{type:"Property",name:"team",reflectMapper:zr},{type:"Property",name:"antispamConfig",reflectMapper:Vd}],response:[{type:"Long",name:"timestamp"}]},v2TeamLeave:{sid:31,cid:8,service:Nt,params:[{type:"Long",name:"teamId"}]},v2SuperTeamLeave:{sid:32,cid:7,service:Nt,params:[{type:"Long",name:"teamId"}]},v2TeamGetInfo:{sid:31,cid:9,service:Nt,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Te(zr)}]},v2SuperTeamGetInfo:{sid:32,cid:9,service:Nt,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Te(zr)}]},v2TeamGetByIds:{sid:31,cid:34,service:Nt,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Te(zr)},{type:"LongArray",name:"tids"}]},v2SuperTeamGetByIds:{sid:32,cid:36,service:Nt,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Te(zr)},{type:"LongArray",name:"tids"}]},v2TeamDismiss:{sid:31,cid:12,service:Nt,params:[{type:"Long",name:"teamId"}]},v2SuperTeamDismiss:{sid:32,cid:4,service:Nt,params:[{type:"Long",name:"teamId"}]},v2TeamAcceptInvitation:{sid:31,cid:21,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:Te(zr)}]},v2SuperTeamAcceptInvitation:{sid:32,cid:23,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:Te(zr)}]},v2TeamRejectInvite:{sid:31,cid:22,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectInvite:{sid:32,cid:24,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamKickMembers:{sid:31,cid:6,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamKickMembers:{sid:32,cid:6,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamApplyToJoin:{sid:31,cid:13,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Te(zr)},{type:"Int",name:"isInTeam"}]},v2SuperTeamApplyToJoin:{sid:32,cid:20,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Te(zr)},{type:"Int",name:"isInTeam"}]},v2TeamAcceptJoinApplication:{sid:31,cid:14,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2SuperTeamAcceptJoinApplication:{sid:32,cid:21,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2TeamRejectJoinApplication:{sid:31,cid:15,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectJoinApplication:{sid:32,cid:22,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamAddManagers:{sid:31,cid:16,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamAddManagers:{sid:32,cid:26,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamRemoveManagers:{sid:31,cid:17,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamRemoveManagers:{sid:32,cid:27,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamTransferOwner:{sid:31,cid:18,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2SuperTeamTransferOwner:{sid:32,cid:31,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2TeamUpdateSelfMemberInfo:{sid:31,cid:19,service:Nt,params:[{type:"Property",name:"teamMember",reflectMapper:Es},{type:"Property",name:"specialFollowUpdate",reflectMapper:x0}],response:[{type:"Property",name:"data",reflectMapper:Te(Es)}]},v2SuperTeamUpdateSelfMemberInfo:{sid:32,cid:10,service:Nt,params:[{type:"Property",name:"teamMember",reflectMapper:fo},{type:"Property",name:"specialFollowUpdate",reflectMapper:x0}],response:[{type:"Property",name:"data",reflectMapper:Te(fo)}]},v2TeamUpdateMember:{sid:31,cid:20,service:Nt,params:[{type:"Property",name:"teamMember",reflectMapper:Es}]},v2SuperTeamUpdateMember:{sid:32,cid:30,service:Nt,params:[{type:"Property",name:"teamMember",reflectMapper:fo}]},v2TeamGetMemberInvitor:{sid:31,cid:33,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2SuperTeamGetMemberInvitor:{sid:32,cid:35,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2TeamMemberSetChatBannedStatus:{sid:31,cid:25,service:Nt,params:[{type:"Long",name:"teamId"},{type:"String",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2SuperTeamMemberSetChatBannedStatus:{sid:32,cid:29,service:Nt,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2TeamSetChatBannedMode:{sid:31,cid:32,service:Nt,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2SuperTeamSetChatBannedMode:{sid:32,cid:28,service:Nt,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2TeamMemberGetListByIds:{sid:31,cid:35,service:Nt,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(Es)}]},v2SuperTeamMemberGetListByIds:{sid:32,cid:37,service:Nt,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(fo)}]},v2TeamMemberGetList:{sid:31,cid:36,service:Nt,params:[{type:"Property",name:"tag",reflectMapper:{teamId:1,teamType:2,roleQueryType:3,onlyChatBanned:{id:4,converter:function(p){return+p}},nextToken:5,limit:6,direction:7}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(Es)},{type:"Property",name:"pageInfo",reflectMapper:{1:"hasMore",2:"nextToken"}}]},v2TeamSync:{sid:8,cid:109,service:Nt,response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"datas",reflectMapper:Te(zr)}]},v2TeamCreateMultiSync:{sid:8,cid:101,service:Nt,response:[{type:"Property",name:"data",reflectMapper:Te(zr)}]},v2TeamMemberUpdateMultiSync:{sid:8,cid:119,service:Nt,response:[{type:"Property",name:"data",reflectMapper:Te(Es)}]},v2TeamMembersOfSelfInSync:{sid:8,cid:126,service:Nt,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(Es)},{type:"Long",name:"timetag"}]},v2SuperTeamSync:{sid:21,cid:109,service:Nt,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(zr)},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},v2SuperTeamCreateMultiSync:{sid:21,cid:101,service:Nt,response:[{type:"Property",name:"data",reflectMapper:Te(zr)}]},v2SuperTeamMemberUpdateMultiSync:{sid:21,cid:110,service:Nt,response:[{type:"Property",name:"data",reflectMapper:Te(fo)}]},v2SuperTeamMembersOfSelfInSync:{sid:21,cid:111,service:Nt,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(fo)},{type:"Long",name:"timetag"}]}};function P0(a,p){if(!a)return{};var l=a;return l.tinfo&&(l.tinfo=function(e){return xt(e,Te(zr))}(l.tinfo),l.tinfo.teamType=p),l.uinfos,l.mute!==void 0&&(l.mute=it(l.mute)),l}function L0(a,p,l){return l===void 0&&(l={}),O({teamId:a,teamType:p,name:"",ownerAccountId:"",memberLimit:0,memberCount:0,createTime:0,updateTime:0,intro:"",announcement:"",avatar:"",joinMode:0,agreeMode:0,inviteMode:0,updateInfoMode:0,updateExtensionMode:0,chatBannedMode:0,isValidTeam:!0},l)}function ua(a,p,l,t){return t===void 0&&(t={}),O({teamId:a,teamType:p,accountId:l,joinTime:0,inTeam:!0,memberRole:0,chatBanned:!1},t)}function V0(a,p){return p===void 0&&(p=1),se(a).call(a,function(l){return function(e,r){return r===void 0&&(r=1),e.teamType=r,e.chatBanned=e.chatBanned!==void 0&&e.chatBanned,e}(l,p)})}function pn(a,p){var l,t=O(O({},p),{conversationId:a.V2NIMConversationIdUtil.messageConversationId(p),isSelf:p.senderId===a.account,sendingState:1,messageStatus:{errorCode:((l=p==null?void 0:p.messageStatus)===null||l===void 0?void 0:l.errorCode)||200}});return t.threadReply&&(t.threadReply=O(O({},t.threadReply),{conversationType:t.conversationType,conversationId:t.conversationId})),t.threadRoot&&(t.threadRoot=O(O({},t.threadRoot),{conversationType:t.conversationType,conversationId:t.conversationId})),t}function Nl(a,p){return O(O({},p),{conversationId:a.V2NIMConversationIdUtil.messageConversationId(p)})}function Cs(a,p){var l=p.createTime,t=p.senderId,e=p.receiverId,r=p.conversationType;return{conversationType:r,conversationId:a.V2NIMConversationIdUtil.messageConversationId({conversationType:r,senderId:t,receiverId:e}),senderId:p.senderId,receiverId:p.receiverId,messageServerId:p.messageServerId,createTime:l,messageClientId:p.messageClientId}}function D0(a,p){var l={7:1,8:2,12:3,13:1,14:2}[p.sysMsgType];return{postscript:p.postscript,revokeType:{7:1,8:2,12:3,13:4,14:5}[p.sysMsgType]||0,revokeAccountId:p.opeAccount||p.senderId,callbackExtension:p.callbackExtension,serverExtension:p.attach||"",messageRefer:{conversationType:l,conversationId:a.V2NIMConversationIdUtil.messageConversationId(O(O({},p),{conversationType:l,senderId:p.senderId,receiverId:p.receiverId})),senderId:p.senderId,receiverId:p.receiverId,messageServerId:p.messageServerId,createTime:p.deleteMsgCreatetime,messageClientId:p.messageClientId}}}function Tg(a,p){return{conversationId:p.conversationType===1?a.V2NIMConversationIdUtil.p2pConversationId(p.receiverId):p.conversationType===2?a.V2NIMConversationIdUtil.teamConversationId(p.teamId):a.V2NIMConversationIdUtil.superTeamConversationId(p.teamId),deleteTime:p.deleteTime,serverExtension:p.serverExtension}}function DL(a,p){var l={0:0,401:401,1:1,402:402,2:2,403:403,3:3,404:404,4:4,405:405,5:5,410:410,6:6,406:406,7:7,407:407,8:8,408:408,9:9,411:411,10:10,409:409};return l[p]===void 0&&a.logger.warn("[V2NIMMessageService] undefined notification type: "+p),typeof l[p]=="number"?l[p]:-1}function Xi(a,p){var l;if(a.attachment&&(!((l=a.aiConfig)===null||l===void 0)&&l.aiStream)){var t=a.attachment;return a.aiConfig.aiStreamLastChunk={content:t.msg,messageTime:a.createTime,chunkTime:t.timestamp,type:t.type,index:t.index},delete a.attachment,a}return a.messageType===5?function(r,i){var o,u,h,g,v,_=i.attachment||{};if(i.attachment&&"type"in i.attachment)return i;var I=void 0;if(!((o=_.data)===null||o===void 0)&&o.tinfo){var C=_.id,A=_.data,N=C>400?2:1,F=P0(O({},A),N).tinfo;I={},F.teamId,I=br(F,["teamId"])}var j=O(O(O(O({raw:_.raw,type:DL(r,_.id)},I?{updatedTeamInfo:I}:{}),{targetIds:((u=_.data)===null||u===void 0?void 0:u.ids)||(!((h=_.data)===null||h===void 0)&&h.id?[_.data.id]:[])}),typeof((g=_.data)===null||g===void 0?void 0:g.attach)=="string"?{serverExtension:_.data.attach}:{}),typeof((v=_.data)===null||v===void 0?void 0:v.mute)=="number"?{chatBanned:_.data.mute!==0}:{});return O(O({},i),{attachment:j})}(p,a):a.messageType===100?function(r,i){var o,u,h;if(typeof((o=i.attachment)===null||o===void 0?void 0:o.raw)=="string"&&((h=(u=r.V2NIMMessageService)===null||u===void 0?void 0:u.customAttachmentParsers)===null||h===void 0?void 0:h.length)>0){var g=i.subType||0,v=r.V2NIMMessageService.customAttachmentParsers,_=i.attachment.raw;Ln(v).call(v,function(I){try{var C=I(g,_);if(oa(C))return C.raw=_,i.attachment=C,!0}catch(A){return r.logger.warn("customAttachmentParser: subType "+g+", raw: "+_+". parse error with "+A),!1}return!1})}return i}(p,a):a}function UL(a,p){var l=[],t={};for(var e in ae(p).call(p,function(i){var o=pn(a,i),u=o.conversationId;t[u]||(t[u]={conversationId:u,messages:[],count:0}),t[u].messages.push(o),t[u].count++}),t){var r=t[e];l.push(r)}return l}function kl(a,p){if(!p)return"";switch(a){case 100:return p.raw||"";case 1:case 3:case 2:case 6:return function(t){var e=t,r=e.width,i=e.height,o=e.duration;e.path,e.file,e.raw,e.ctx,e.payload,e.bucketName,e.objectName,e.token;var u=e.ext,h=br(e,["width","height","duration","path","file","raw","ctx","payload","bucketName","objectName","token","ext"]),g=typeof u=="string"&&u[0]==="."?ht(u).call(u,1):u;return xe(O(O(O(O(O({},h),u===void 0?{}:{ext:g}),r===void 0?{}:{w:r}),i===void 0?{}:{h:i}),o===void 0?{}:{dur:o}))}(p);case 4:return function(t){return xe({lat:t.latitude,lng:t.longitude,title:t.address})}(p);case 12:return function(t){t.raw;var e=br(t,["raw"]);try{var r;return xe(O(O({},e),{durations:se(r=t.durations).call(r,function(i){return{accid:i.accountId,duration:i.duration}})}))}catch{return xe(t)}}(p);default:return p.raw||xe(p)}}function FL(a,p){var l;try{switch(l=JSON.parse(a),p){case 100:return{raw:a};case 4:return function(e,r){return{latitude:r.lat,longitude:r.lng,address:r.title,raw:e}}(a,l);case 2:case 3:case 1:case 6:return function(e,r){var i=r.w,o=r.h,u=r.dur,h=r.ext,g=br(r,["w","h","dur","ext"]),v=typeof h=="string"&&h[0]!=="."?"."+h:h;return O(O(O(O(O(O({},g),h===void 0?{}:{ext:v}),i===void 0?{}:{width:i}),o===void 0?{}:{height:o}),u===void 0?{}:{duration:u}),{raw:e})}(a,l);case 12:return function(e,r){var i;return O(O({},r),{durations:se(i=r.durations).call(i,function(o){return{accountId:o.accid,duration:o.duration}}),raw:e})}(a,l);default:return typeof l=="object"&&l?O(O({},l),{raw:a}):{raw:a}}}catch{return typeof l=="object"&&l?O(O({},l),{raw:a}):{raw:a}}}var U0=function(){function a(l){this.core=l}var p=a.prototype;return p.doSendFile=function(t,e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_,I;return T.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return i=t.attachment,A.prev=1,A.next=4,this.core.V2NIMStorageService._uploadFile({taskId:t.messageClientId,uploadParams:{fileObj:(i==null?void 0:i.file)||(i==null?void 0:i.path),sceneName:i==null?void 0:i.sceneName}},e,{fileType:t.messageType});case 4:for(_ in(u=A.sent)[0],h=u[1],g=O(O({},i),{uploadState:1}),h.w!==void 0&&(g.width=g.width||h.w),h.h!==void 0&&(g.height=g.height||h.h),h.dur!==void 0&&(g.duration=g.duration||h.dur),g.ext=g.ext&&wt(o=g.ext).call(o,".")===-1?"."+g.ext:g.ext,v=["w","h","dur","ext","name"],h)_t(v).call(v,_)||(g[_]=h[_]);g.raw,g.file,g.path,I=br(g,["raw","file","path"]),t.attachment=JSON.parse(xe(I)),t.attachment&&(t.attachment.raw=kl(t.messageType,t.attachment)),A.next=23;break;case 19:throw A.prev=19,A.t0=A.catch(1),t.attachment&&(t.attachment.uploadState=2),A.t0;case 23:case"end":return A.stop()}},r,this,[[1,19]])}))},p.cancelMessageAttachmentUpload=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(P({messageClientId:{type:"string",allowEmpty:!1}},t,"",!0),_t(r=[2,6,1,3]).call(r,t.messageType)){o.next=3;break}throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"cancelMessageAttachmentUpload: messageType "+t.messageType+" incorrect"}});case 3:if(t.sendingState!==2&&t.sendingState!==1){o.next=5;break}throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"cancelMessageAttachmentUpload: message is already failed or succeeded"}});case 5:return o.next=7,this.core.V2NIMStorageService._cancelUploadFile(t.messageClientId);case 7:case"end":return o.stop()}},e,this)}))},a}(),yr="V2NIMMessageService",BL={"30_1":"v2SendP2pMessage","31_2":"v2SendTeamMessage","30_31":"v2MessageP2pModify","31_37":"v2MessageTeamModify","32_38":"v2MessageSuperTeamModify","7_33":"v2MessageOnModified","4_27":"v2MessageSyncModified","4_28":"v2MessageSuperTeamSyncModified","4_5":"v2BatchMarkRead","4_12":"syncP2PMessagReceipts","30_11":"v2SendP2PMessageReceipt","31_28":"v2SendTeamMessageReceipts","32_2":"v2SendSuperTeamMessage","7_12":"onP2PMessageReceipts","8_31":"onTeamMessageReceipts","31_29":"v2GetTeamMessageReceipts","31_30":"v2GetTeamMessageReceiptDetail","7_2":"onMsg","8_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_3":"onMsg","21_102":"onMsg","4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","30_13":"v2RevokeMessage","32_17":"v2RevokeSuperTeamMessage","7_14":"onRevokeMessage","7_15":"syncRevokeMessage","21_18":"onRevokeMessage","21_117":"onRevokeMessage","30_23":"v2DeleteMessage","30_24":"v2DeleteMessages","4_21":"syncOnDeleteMessages","7_123":"onDeleteMessage","7_124":"onDeleteMessages","29_17":"v2DownloadLocalAntiSpamVocabs"},Rt={conversationType:{id:0,converter:Dd,retConverter:Sg},receiverId:1,senderId:2,fromClientType:4,fromDeviceId:5,fromNick:6,createTime:{id:7,retType:"number"},messageType:{id:8,retType:"number"},text:9,attachment:{id:10,converter:function(p,l){return kl(l.messageType,p)},retConverter:function(p,l){return FL(p,Number(l[8]))}},messageClientId:11,messageServerId:12,resend:{id:13,converter:Zt,retType:"boolean"},userUpdateTime:{id:14,retType:"number"},serverExtension:15,pushPayload:{id:16,access:"pushConfig.pushPayload"},pushContent:{id:17,access:"pushConfig.pushContent"},forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function(p){if(p["pushConfig.forcePush"])return"#%@all@%#"},converter:function(p,l){if(l["pushConfig.forcePush"])return p?xe(p):"#%@all@%#"},retConverter:function(p){if(p!=="#%@all@%#"&&p)try{return JSON.parse(p)}catch{return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,access:"pushConfig.forcePush",converter:Zt,retType:"boolean"},antispamCustomMessageEnabled:{id:21,def:function(p){return Pe(p,"antispamConfig.antispamCustomMessage")?1:void 0},retConverter:function(){}},antispamCustomMessage:{id:22,access:"antispamConfig.antispamCustomMessage"},antispamBusinessId:{id:23,access:"antispamConfig.antispamBusinessId"},clientAntispamHit:{id:24,access:"clientAntispamHit",converter:Zt,retType:"boolean"},antispamEnabled:{id:25,access:"antispamConfig.antispamEnabled",converter:Zt,retType:"boolean"},needAck:{id:26,access:"messageConfig.readReceiptEnabled",converter:Zt,retType:"boolean"},lastMessageUpdateEnabled:{id:28,access:"messageConfig.lastMessageUpdateEnabled",converter:Zt,retType:"boolean"},threadReplySenderId:{id:29,access:"threadReply.senderId"},threadReplyReceiverId:{id:30,access:"threadReply.receiverId"},threadReplyTime:{id:31,access:"threadReply.createTime",retType:"number"},threadReplyServerId:{id:32,access:"threadReply.messageServerId"},threadReplyClientId:{id:33,access:"threadReply.messageClientId"},threadRootSenderId:{id:34,access:"threadRoot.senderId"},threadRootReceiverId:{id:35,access:"threadRoot.receiverId"},threadRootTime:{id:36,access:"threadRoot.createTime",retType:"number"},threadRootServerId:{id:37,access:"threadRoot.messageServerId"},threadRootClientId:{id:38,access:"threadRoot.messageClientId"},isDeleted:{id:39,converter:Zt,retType:"boolean"},callbackExtension:40,subType:{id:41,retType:"number"},antispamCheating:{id:42,access:"antispamConfig.antispamCheating"},routeEnvironment:{id:43,access:"routeConfig.routeEnvironment"},antispamExtension:{id:44,access:"antispamConfig.antispamExtension"},antispamResult:45,__clientExt:{id:46,converter:xi,retConverter:lo},robotFunction:{id:47,access:"robotConfig.function"},robotTopic:{id:48,access:"robotConfig.topic"},robotCustomContent:{id:49,access:"robotConfig.customContent"},robotAccount:{id:50,access:"robotConfig.accountId"},_conversationOnlineSyncNotify:{id:51},_conversationOnlineSyncData:{id:52},aiAgentMsgDirection:{id:55,access:"aiConfig.aiStatus",retAccess:"aiConfig.aiStatus",retType:"number"},aiAgentAccount:{id:56,access:"aiConfig.accountId",retAccess:"aiConfig.accountId"},aiAgentContent:{id:57,access:"aiConfig.content",converter:xi,retConverter:Il},aiAgentMessages:{id:58,access:"aiConfig.messages",converter:xi,retConverter:Il},aiAgentPromptVariables:{id:59,access:"aiConfig.promptVariables",retConverter:Il},aiAgentModelConfigParams:{id:60,access:"aiConfig.modelConfigParams",converter:xi,retConverter:Il},errorCode:{id:61,access:"messageStatus.errorCode",converter:Il,retType:"number"},modifyTime:{id:62,retType:"number"},modifyAccountId:63,aiStream:{id:65,access:"aiConfig.aiStream",converter:Zt,retConverter:XS},aiRAGs:{id:66,access:"aiConfig.aiRAGs",retConverter:function(p){try{var l=JSON.parse(p);return l&&l.length>0?se(l).call(l,function(t){return t.description=t.desc,delete t.desc,t}):[]}catch{return[]}}},aiStreamStatus:{id:67,access:"aiConfig.aiStreamStatus",retType:"number"},historyEnabled:{id:100,access:"messageConfig.historyEnabled",converter:Zt,retType:"boolean"},roamingEnabled:{id:101,access:"messageConfig.roamingEnabled",converter:Zt,retType:"boolean"},onlineSyncEnabled:{id:102,access:"messageConfig.onlineSyncEnabled",converter:Zt,retType:"boolean"},routeEnabled:{id:105,access:"routeConfig.routeEnabled",converter:Zt,retType:"boolean"},pushEnable:{id:107,access:"pushConfig.pushEnabled",converter:Zt,retType:"boolean"},offlineEnabled:{id:108,access:"messageConfig.offlineEnabled",converter:Zt,retType:"boolean"},unreadEnabled:{id:109,access:"messageConfig.unreadEnabled",converter:Zt,retType:"boolean"},pushNickEnabled:{id:110,access:"pushConfig.pushNickEnabled",converter:Zt,retType:"boolean"},msgAckSnapshot:{id:112,retType:"number"},receiverIds:{id:154,access:"targetConfig.receiverIds",converter:xi,retConverter:function(){}},inclusive:{id:155,access:"targetConfig.inclusive",converter:function(p){return p?1:2},retConverter:function(){}},newMemberVisible:{id:156,access:"targetConfig.newMemberVisible",converter:function(p){return p?1:2},retConverter:function(){}}},Ig=Te(Rt),mo={conversationType:{id:1,access:"messageRefer.conversationType",retType:"number"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},messageServerId:{id:4,access:"messageRefer.messageServerId"},messageClientId:{id:5,access:"messageRefer.messageClientId"},createTime:{id:6,access:"messageRefer.createTime",retType:"number"},deleteTime:{id:7,retType:"number"},serverExtension:8};Te(mo);var F0={version:1,md5:2,nosurl:3,thesaurus:4},da={createTime:{id:0,retType:"number"},sysMsgType:1,receiverId:2,senderId:3,postscript:4,attach:5,pushContent:8,pushPayload:9,messageClientId:10,messageServerId:11,deleteMsgCreatetime:{id:14,retType:"number"},opeAccount:16,env:21,callbackExtension:22},pa={receiverId:0,messageServerId:1,readCount:{id:100,retType:"number"},unreadCount:{id:101,retType:"number"},messageClientId:102,latestReadAccount:103},qL={v2BatchMarkRead:{sid:4,cid:5,service:yr,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},v2SendP2pMessage:{sid:30,cid:1,service:yr,params:[{type:"Property",name:"tag",reflectMapper:Rt}],response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},onMsg:{sid:7,cid:2,service:yr,response:[{type:"Property",name:"msg",reflectMapper:Te(Rt)}]},syncOfflineMsgs:{sid:4,cid:4,service:yr,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(Rt)}]},syncRoamingMsgs:{sid:4,cid:9,service:yr,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(Rt)}]},v2SendP2PMessageReceipt:{sid:30,cid:11,service:yr,params:[{type:"Property",name:"tag",reflectMapper:Rt}],response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},v2RevokeMessage:{sid:30,cid:13,service:yr,params:[{type:"Property",name:"tag",reflectMapper:da}]},v2DeleteMessage:{sid:30,cid:23,service:yr,params:[{type:"Property",name:"tag",reflectMapper:mo}],response:[{type:"Long",name:"timetag"}]},v2DeleteMessages:{sid:30,cid:24,service:yr,params:[{type:"PropertyArray",name:"tag",reflectMapper:mo}],response:[{type:"Long",name:"timetag"}]},v2SendTeamMessage:{sid:31,cid:2,service:yr,params:[{type:"Property",name:"tag",reflectMapper:Rt}],response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},v2SendTeamMessageReceipts:{sid:31,cid:28,service:yr,params:[{type:"PropertyArray",name:"tag",reflectMapper:pa}],response:[{type:"PropertyArray",name:"tag",reflectMapper:Te(pa)}]},v2SendSuperTeamMessage:{sid:32,cid:2,service:yr,params:[{type:"Property",name:"tag",reflectMapper:Rt}],response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},v2RevokeSuperTeamMessage:{sid:32,cid:17,service:yr,params:[{type:"Property",name:"tag",reflectMapper:da}]},syncP2PMessagReceipts:{sid:4,cid:12,service:yr,response:[{type:"PropertyArray",name:"data",reflectMapper:Te(Rt)}]},onP2PMessageReceipts:{sid:7,cid:12,service:yr,response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},v2GetTeamMessageReceipts:{sid:31,cid:29,service:yr,params:[{type:"PropertyArray",name:"tag",reflectMapper:pa}],response:[{type:"PropertyArray",name:"data",reflectMapper:Te(pa)}]},v2GetTeamMessageReceiptDetail:{sid:31,cid:30,service:yr,params:[{type:"Property",name:"tag",reflectMapper:pa,select:["receiverId","messageServerId"]}],response:[{type:"Property",name:"data",reflectMapper:Te(pa)},{type:"StrArray",name:"readAccountList"},{type:"StrArray",name:"unreadAccountList"}]},onTeamMessageReceipts:{sid:8,cid:31,service:yr,response:[{type:"PropertyArray",name:"data",reflectMapper:Te(pa)}]},onRevokeMessage:{sid:7,cid:14,service:yr,response:[{type:"Property",name:"data",reflectMapper:Te(da)}]},syncRevokeMessage:{sid:7,cid:15,service:yr,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(da)}]},syncOnDeleteMessages:{sid:4,cid:21,service:yr,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(mo)}]},onDeleteMessage:{sid:7,cid:123,service:yr,response:[{type:"Property",name:"data",reflectMapper:Te(mo)}]},onDeleteMessages:{sid:7,cid:124,service:yr,response:[{type:"PropertyArray",name:"data",reflectMapper:Te(mo)}]},v2DownloadLocalAntiSpamVocabs:{sid:29,cid:17,service:yr,params:[{type:"Property",name:"tag",reflectMapper:F0}],response:[{type:"Property",name:"data",reflectMapper:Te(F0)}]},v2MessageP2pModify:{sid:30,cid:31,service:yr,params:[{type:"Property",name:"tag",reflectMapper:Rt}],response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},v2MessageTeamModify:{sid:31,cid:37,service:yr,params:[{type:"Property",name:"tag",reflectMapper:Rt}],response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},v2MessageSuperTeamModify:{sid:32,cid:38,service:yr,params:[{type:"Property",name:"tag",reflectMapper:Rt}],response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},v2MessageOnModified:{sid:7,cid:33,service:yr,response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},v2MessageSyncModified:{sid:4,cid:27,service:yr,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(Rt)},{type:"Long",name:"time"}]},v2MessageSuperTeamSyncModified:{sid:4,cid:28,service:yr,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(Rt)},{type:"Long",name:"time"}]}};function Dd(a){return a===1?0:a===2?1:a===3?5:void 0}function Sg(a){var p=it(a);return p===0?1:p===1?2:p===5?3:0}var go="V2NIMNotificationService",GL={"30_7":"v2SendCustomNotification","32_16":"v2SendCustomNotificationWithSuperTeam","7_3":"onSysNotification","21_19":"onSysNotification","4_6":"v2SyncOfflineSysNotifications","4_18":"v2SyncOfflineSysNotifications","7_14":"v2NotificationRevoke","21_18":"v2NotificationRevoke","21_117":"v2NotificationRevoke","4_19":"v2NotificationSyncRevoke","7_15":"v2NotificationSyncRevoke","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg"},bs={timestamp:{id:0,retType:"number"},type:{id:1,retType:"number"},receiverId:2,senderId:3,postscript:4,content:5,idServer:6,offlineEnabled:{id:7,converter:Zt,retConverter:function(p,l){return l[6]!=="0"&&!!it(p)},access:"notificationConfig.offlineEnabled"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"},deletedIdClient:10,deletedIdServer:11,antispamEnabled:{id:12,converter:Zt,retType:"boolean",access:"antispamConfig.antispamEnabled"},antispamCustomNotification:{id:13,access:"antispamConfig.antispamCustomNotification"},deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function(p){if(p.type===101&&p["pushConfig.forcePush"])return"#%@all@%#"},converter:function(p,l){if(l["pushConfig.forcePush"])return p?xe(p):"#%@all@%#"},retConverter:function(p){if(p!=="#%@all@%#"&&p)try{return JSON.parse(p)}catch{return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,converter:Zt,retType:"boolean",access:"pushConfig.forcePush"},routeEnvironment:{id:21,access:"routeConfig.routeEnvironment"},callbackExt:22,clientNotificationId:{id:23,access:"notificationConfig.clientNotificationId"},conversationOnlineSyncNotify:24,conversationOnlineSyncData:25,routeEnabled:{id:105,converter:Zt,retType:"boolean",access:"routeConfig.routeEnabled"},pushEnabled:{id:107,converter:Zt,retType:"boolean",access:"pushConfig.pushEnabled"},unreadEnabled:{id:109,converter:Zt,retType:"boolean",access:"notificationConfig.unreadEnabled"},pushNickEnabled:{id:110,converter:Zt,retType:"boolean",access:"pushConfig.pushNickEnabled"}},B0={id:1,senderId:2,timestamp:{id:4,retType:"number"},content:5},jL={v2SendCustomNotification:{sid:30,cid:7,service:go,params:[{type:"Property",name:"tag",reflectMapper:bs}]},v2SendCustomNotificationWithSuperTeam:{sid:32,cid:16,service:go,params:[{type:"Property",name:"tag",reflectMapper:bs}]},onSysNotification:{sid:7,cid:3,service:go,response:[{type:"Property",name:"data",reflectMapper:Te(bs)}]},syncBroadcastMsg:{sid:4,cid:16,service:go,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(B0)}]},onBroadcastMsg:{sid:7,cid:17,service:go,response:[{type:"Property",name:"data",reflectMapper:Te(B0)}]},v2SyncOfflineSysNotifications:{sid:4,cid:9,service:go,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(bs)}]},v2NotificationRevoke:{sid:7,cid:14,service:go,response:[{type:"Property",name:"data",reflectMapper:Te(bs)}]},v2NotificationSyncRevoke:{sid:7,cid:15,service:go,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(bs)},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]}},ha="YSFService",HL={"4_5":"ysfBatchMarkRead","101_1":"ysfSendMessage","101_2":"ysfOnMsg","4_100":"ysfSyncOfflineMsgs","101_3":"ysfOnSysNotification","101_7":"ysfSendCustomNotification","4_101":"ysfSyncSysNotification"},$L={ysfBatchMarkRead:{sid:4,cid:5,service:ha,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},ysfSendMessage:{sid:101,cid:1,service:ha,params:[{type:"Property",name:"tag",reflectMapper:Rt}],response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},ysfOnMsg:{sid:101,cid:2,service:ha,response:[{type:"Property",name:"data",reflectMapper:Te(Rt)}]},ysfSyncOfflineMsgs:{sid:4,cid:100,service:ha,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(Rt)}]},ysfOnSysNotification:{sid:101,cid:3,service:ha,response:[{type:"Property",name:"data",reflectMapper:Te(bs)}]},ysfSendCustomNotification:{sid:101,cid:7,service:ha,params:[{type:"Property",name:"tag",reflectMapper:bs}]},ysfSyncSysNotification:{sid:4,cid:101,service:ha,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(bs)}]}},q0={content:{type:"string",allowEmpty:!1},params:{type:"object",required:!1,rules:{notificationConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forcePushContent:{type:"string",required:!1},forcePushAccountIds:{type:"array",required:!1,itemType:"string"}}},antispamConfig:{type:"object",required:!1,rules:{antispamEnabled:{type:"boolean",required:!1},antispamCustomNotification:{type:"string",required:!1}}},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}}}}},G0=function(){function a(p){this.core=p}return a.prototype.generateNotificationTag=function(l,t,e){var r;e===void 0&&(e={});var i=this.core.V2NIMConversationIdUtil.parseConversationType(l),o=this.core.V2NIMConversationIdUtil.parseConversationTargetId(l),u=Dt(),h=((r={})[1]=100,r[2]=101,r[3]=103,r);return O(O({},e),{notificationConfig:O({unreadEnabled:!0,offlineEnabled:!0},e==null?void 0:e.notificationConfig),pushConfig:O({pushEnabled:!0,pushNickEnabled:!0},e==null?void 0:e.pushConfig),antispamConfig:O({antispamEnabled:!0},e==null?void 0:e.antispamConfig),routeConfig:O({routeEnabled:!0},e==null?void 0:e.routeConfig),timestamp:u,type:h[i],receiverId:o,content:t})},a}();function j0(a){var p=typeof a=="object"?a:void 0,l=typeof a=="string"?a:void 0;if(!p&&!l)throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect file and path"}});if(typeof l=="string"){if(wt(l).call(l,"nim-external")===0){var t=document.getElementById(l);if(!(t&&t.files&&t.files[0]))throw new Me({code:ce.V2NIM_ERROR_CODE_FILE_NOT_FOUND,detail:{reason:"getFileOrPath::file not exist: "+l}});p=t.files[0]}else if(We.platform==="BROWSER")throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect path: "+l}})}if(typeof p=="object"&&p.size===void 0)throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::file no size"}});return{file:p,path:l}}var H0,$0,K0={attachment:{type:"object",rules:{url:{type:"string",allowEmpty:!1}}},thumbSize:{type:"object",rules:{width:{type:"number",required:!1,min:0},height:{type:"number",required:!1,min:0}}}},Y0=function(a){function p(t){var e;return(e=a.call(this,"V2NIMStorageUtil",t)||this).core=t,e}bt(p,a);var l=p.prototype;return l.imageThumbUrl=function(e,r){return e+"?imageView&thumbnail="+r+"z"+r},l.videoCoverUrl=function(e,r){return e+"?vframe&offset="+r},l.getImageThumbUrl=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),P(K0,{attachment:o=e,thumbSize:r},"",!0),r.width=r.width||0,r.height=r.height||0,r.width===0&&r.height===0&&(r.width=150),u=o.url,g.prev=7,g.next=10,this.core.V2NIMStorageService.shortUrlToLong(o.url);case 10:u=g.sent,g.next=16;break;case 13:g.prev=13,g.t0=g.catch(7),this.core.logger.warn("shortUrlToLong error:",g.t0);case 16:return g.abrupt("return",{url:this.core.cloudStorage.getThumbUrl(u,r)});case 17:case"end":return g.stop()}},i,this,[[7,13]])}))},l.getVideoCoverUrl=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),P(K0,{attachment:o=e,thumbSize:r},"",!0),r.width=r.width||0,r.height=r.height||0,r.width===0&&r.height===0&&(r.width=150),u=o.url,g.prev=7,g.next=10,this.core.V2NIMStorageService.shortUrlToLong(o.url);case 10:u=g.sent,g.next=16;break;case 13:g.prev=13,g.t0=g.catch(7),this.core.logger.warn("shortUrlToLong error:",g.t0);case 16:return g.abrupt("return",{url:this.core.cloudStorage.getVideoCoverUrl(u,r)});case 17:case"end":return g.stop()}},i,this,[[7,13]])}))},p}($r),KL={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},YL={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function W0(a){return a===void 0&&(a="file"),xe(KL[a]||{}).replace(/"/gi,'\\"')}(function(a){a[a.nos=1]="nos",a[a.s3=2]="s3"})(H0||(H0={})),function(a){a[a.dontNeed=-1]="dontNeed",a[a.time=2]="time",a[a.urls=3]="urls"}($0||($0={}));var WL={chunkUploadHost:"https://wannos-web.127.net",chunkUploadHostBackupList:["https://fileup.chatnos.com","https://oss.chatnos.com"],commonUploadHost:"https://fileup.chatnos.com",commonUploadHostBackupList:["https://oss.chatnos.com"],chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0};function J0(a,p){a=a||{},p=p||function(){return!0};var l={};for(var t in a)p(a[t])&&(l[t]=a[t]);return l}var JL=function(){function a(l,t){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=l,this.cloudStorage=t}var p=a.prototype;return p.reset=function(){this.nosErrorCount=0},p.getNosAccessToken=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("getNosAccessToken",{tag:t});case 2:return r=h.sent,i=Pe(r,"content.nosAccessTokenTag.token"),o=t.url,h.abrupt("return",{token:i,url:wt(o).call(o,"?")!==-1?o+"&token="+i:o+"?token="+i});case 6:case"end":return h.stop()}},e,this)}))},p.deleteNosAccessToken=function(t){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.core.sendCmd("deleteNosAccessToken",{tag:t});case 2:case"end":return i.stop()}},e,this)}))},p.nosUpload=function(t,e){var r,i,o,u,h,g,v,_;return k(this,void 0,void 0,T.mark(function I(){var C,A,N,F,j,W,U,ie,te,H,V,w,Y,re,ee,pe,ye,Q,ze;return T.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(C=Pe(this.core,"config.cdn.bucket"),A={tag:t.nosScenes||C||"nim"},t.nosSurvivalTime&&(A.expireSec=t.nosSurvivalTime),N=this.core.adapters.getFileUploadInformation(t),!(!e&&!N)){Se.next=18;break}return Se.prev=6,Se.next=9,this.core.sendCmd("getNosToken",{responseBody:W0(t.type),nosToken:A});case 9:F=Se.sent,Se.next=18;break;case 12:if(Se.prev=12,Se.t0=Se.catch(6),this.core.logger.error("uploadFile:: getNosToken error",Se.t0),!(Se.t0 instanceof Me)){Se.next=17;break}throw Se.t0;case 17:throw new Ms({code:Pe(this.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:Se.t0,curProvider:1}});case 18:return j=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",N?(r=N.uploadInfo)===null||r===void 0?void 0:r.objectName:e?e==null?void 0:e.objectName:F.content.nosToken.objectName),W="",e&&e.shortUrl&&(W=e.shortUrl),!((u=(o=(i=N==null?void 0:N.uploadInfo)===null||i===void 0?void 0:i.payload)===null||o===void 0?void 0:o.mixStoreToken)===null||u===void 0)&&u.shortUrl&&(W=N.uploadInfo.payload.mixStoreToken.shortUrl),U=W||j,Se.prev=23,te=N?{token:(h=N==null?void 0:N.uploadInfo)===null||h===void 0?void 0:h.token,bucket:(g=N==null?void 0:N.uploadInfo)===null||g===void 0?void 0:g.bucketName,objectName:(v=N==null?void 0:N.uploadInfo)===null||v===void 0?void 0:v.objectName}:e||F.content.nosToken,this.core.logger.log("uploadFile:: uploadFile params",{nosToken:te,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,platform:We.platform}),H=We.platform==="BROWSER"?this.config.chunkUploadHost:this.config.commonUploadHost+"/"+(te&&te.bucket),this.core.reporterHookCloudStorage.update({remote_addr:H,operation_type:e?2:0}),Se.next=30,this.core.adapters.uploadFile(O(O(O({},t),{nosToken:te,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,maxSize:t.maxSize||this.config.chunkMaxSize}),e?{payload:{mixStoreToken:e}}:{}));case 30:ie=Se.sent,Se.next=65;break;case 33:if(Se.prev=33,Se.t1=Se.catch(23),this.core.logger.error("uploadFile::nos uploadFile error:",Se.t1),V=Pe(this.core,"options.apiVersion")==="v2",Se.t1.code!==ce.V2NIM_ERROR_CODE_CANCELLED&&Se.t1.errCode!==10499){Se.next=39;break}throw new Ms({code:V?ce.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:Pe(Se.t1,"message")||"Request abort",rawError:Se.t1,curProvider:1}});case 39:if(!V||Se.t1.errCode!==ce.V2NIM_ERROR_CODE_FILE_OPEN_FAILED){Se.next=41;break}throw new Me({code:ce.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:Pe(Se.t1,"message")||"Read file failed",rawError:Se.t1,curProvider:1}});case 41:return Se.next=43,We.net.getNetworkStatus();case 43:if(w=Se.sent,w.net_connect!==!1){Se.next=47;break}throw new Ms({code:Pe(this.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:Se.t1,curProvider:1}});case 47:if(!e){Se.next=64;break}if(!(this.nosErrorCount<=0)){Se.next=60;break}Se.prev=49,this.cloudStorage.mixStorage._addCircuitTimer(),Se.next=56;break;case 53:throw Se.prev=53,Se.t2=Se.catch(49),new Ms({code:Pe(this.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:Se.t2,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:t.file||t.filePath}});case 56:return this.nosErrorCount=Pe(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),Se.abrupt("return",this.cloudStorage._uploadFile(t));case 60:return this.nosErrorCount--,Se.abrupt("return",this.nosUpload(t,e));case 62:Se.next=65;break;case 64:throw new Ms({code:Pe(this.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:Se.t1,curProvider:1}});case 65:if(Y=ie==null?void 0:ie.type,(re=Y&&wt(Y).call(Y,"/")>-1?ht(Y).call(Y,0,wt(Y).call(Y,"/")):"")||(re=t.type||""),(ee={image:"imageInfo",video:"vinfo",audio:"vinfo"})[re]){Se.next=71;break}return Se.abrupt("return",O({url:U},ie));case 71:return Se.prev=71,Se.next=74,this.core.adapters.request(j+"?"+ee[re],{method:"GET",dataType:"json",timeout:5e3},{exception_service:3});case 74:pe=Se.sent,Se.next=81;break;case 77:return Se.prev=77,Se.t3=Se.catch(71),this.core.logger.error("uploadFile:: fetch file info error",Se.t3),Se.abrupt("return",O({url:U},ie));case 81:if(!pe){Se.next=88;break}return ye=pe.data,Q=ee[re]==="imageInfo"?ye:(_=ye==null?void 0:ye.GetVideoInfo)===null||_===void 0?void 0:_.VideoInfo,ze={url:U,name:ie.name,size:ie.size,ext:ie.ext,w:Q==null?void 0:Q.Width,h:Q==null?void 0:Q.Height,orientation:Q==null?void 0:Q.Orientation,dur:Q==null?void 0:Q.Duration,audioCodec:Q==null?void 0:Q.AudioCodec,videoCodec:Q==null?void 0:Q.VideoCodec,container:Q==null?void 0:Q.Container},Se.abrupt("return",J0(ze,function(vt){return vt!==void 0}));case 88:return Se.abrupt("return",O({url:U},ie));case 89:case"end":return Se.stop()}},I,this,[[6,12],[23,33],[49,53],[71,77]])}))},p._getNosCdnHost=function(){var t;return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u=this;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,this.core.sendCmd("getNosCdnHost");case 3:r=g.sent,g.next=10;break;case 6:return g.prev=6,g.t0=g.catch(0),this.core.logger.error("getNosCdnHost::error",g.t0),g.abrupt("return");case 10:if(r){g.next=12;break}return g.abrupt("return");case 12:i=(t=r==null?void 0:r.content)===null||t===void 0?void 0:t.nosConfigTag,(o=it(i==null?void 0:i.expire))!==0&&i.cdnDomain?o===-1?(this.config.cdn.bucket=i.bucket,this.config.cdn.cdnDomain=i.cdnDomain,this.config.cdn.objectNamePrefix=i.objectNamePrefix):(this.config.cdn.bucket=i.bucket,this.config.cdn.cdnDomain=i.cdnDomain,this.config.cdn.objectNamePrefix=i.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer(function(){u._getNosCdnHost()},1e3*o)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return g.stop()}},e,this,[[0,6]])}))},Ai(a,[{key:"config",get:function(){return this.cloudStorage.config}}]),a}(),QL={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},Jn={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4,policyVersion:5},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4,policyVersion:5},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},zL={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:Jn.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:Mt(Jn.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Jn.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Mt(Jn.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:Mt(Jn.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:Mt(Jn.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:Mt(Jn.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:Jn.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:Mt(Jn.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:Jn.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:Mt(Jn.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Jn.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:Mt(Jn.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Jn.nosAccessTokenTag}]}},XL=function(){function a(l,t){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=l,this.cloudStorage=t,this.logger=l.logger}var p=a.prototype;return p.reset=function(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10},p.getGrayscaleConfig=function(t,e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(We.localStorage)try{We.localStorage.getItem&&We.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(We.localStorage.getItem(this.GRAYKEY))[t])}catch(v){We.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",v)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<e)){g.next=17;break}return g.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(o=g.sent).content||!o.content.grayConfigTag){g.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(o.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(o.content.grayConfigTag.ttl)}catch(v){this.logger.error("getGrayscaleConfig error",v)}if(this.grayConfig){g.next=10;break}return g.abrupt("return");case 10:u=We.localStorage.getItem(this.GRAYKEY)?JSON.parse(We.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=new Date().getTime(),u[t]=this.grayConfig,We.localStorage.setItem(this.GRAYKEY,xe(u)),g.next=17;break;case 16:this.logger.log("uploadFile:: result grayConfig:",o.content);case 17:if(!(!((r=this.grayConfig)===null||r===void 0)&&r.mixStoreEnable)){g.next=20;break}return g.next=20,this._getMixStorePolicy(t);case 20:case"end":return g.stop()}},i,this)}))},p._getMixStorePolicy=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(r=new Date().getTime(),We.localStorage)try{this.mixStorePolicy=JSON.parse(We.localStorage.getItem(this.MIXSTOREKEY))[t],this.curProvider=it(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>r&&(o=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-r,this.core.timerManager.addTimer(et(i=this._getMixStorePolicy).call(i,this,t),o))}catch(C){We.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(We.localStorage.getItem(this.MIXSTOREKEY))[t]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",C)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=r)){I.next=31;break}return I.prev=3,I.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]});case 6:h=I.sent,g=h.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.mixStorePolicy.policyVersion=g.policyVersion,this.mixStorePolicy.ttl=Number(g.ttl),this.mixStorePolicy.providers=g.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=it(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=g.nosPolicy?JSON.parse(g.nosPolicy):null,this.mixStorePolicy.s3Policy=g.s3Policy?JSON.parse(g.s3Policy):null,this.mixStorePolicy.s3Policy===null?this.mixStorePolicy.providers=["1"]:this.mixStorePolicy.nosPolicy===null?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(et(u=this._getMixStorePolicy).call(u,this,t),1e3*this.mixStorePolicy.ttl),v=We.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(We.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=new Date().getTime(),v[t]=this.mixStorePolicy,We.localStorage.setItem(this.MIXSTOREKEY,xe(v)),I.next=31;break;case 24:if(I.prev=24,I.t0=I.catch(3),this.logger.error("getMixStorePolicy error",I.t0),this.mixStoreErrorCount!==0){I.next=29;break}throw new Error("getMixStorePolicy all count error");case 29:this._getMixStorePolicy(t),this.mixStoreErrorCount--;case 31:this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 32:case"end":return I.stop()}},e,this,[[3,24]])}))},p._addCircuitTimer=function(){var t=this,e=this.mixStorePolicy.providers,r=e[(wt(e).call(e,String(this.curProvider))+1)%e.length];if(!r)throw new Error("uploadFile nextProvider error");if(r===e[0])throw new Error("uploadFile all policy fail");if(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+r),this.curProvider=it(r),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy){var i=this.mixStorePolicy[this.curProvider===1?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!i||i===0)throw new Error("uploadFile circuit error");this.circuitTimer=this.core.timerManager.addTimer(function(){t.logger.log("uploadFile:: upload policy will change,now policy:"+t.curProvider+" nextProvider:"+it(t.mixStorePolicy.providers[0])),t.curProvider=it(t.mixStorePolicy.providers[0]),t.core.timerManager.deleteTimer(t.circuitTimer)},1e3*i)}throw new Error("uploadFile will not retry again")},p.getFileAuthToken=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:t});case 2:return r=o.sent,o.abrupt("return",r.content.mixStoreAuthTokenResTag);case 4:case"end":return o.stop()}},e,this)}))},a}(),ZL=zm.trim,eV=$("".charAt),Ud=E.parseFloat,Q0=E.Symbol,z0=Q0&&Q0.iterator,X0=1/Ud(nc+"-0")!=-1/0||z0&&!b(function(){Ud(Object(z0))})?function(p){var l=ZL(xn(p)),t=Ud(l);return t===0&&eV(l,0)=="-"?-0:t}:Ud;je({global:!0,forced:parseFloat!=X0},{parseFloat:X0});var tV=we.parseFloat,Eg=-1,rV=function(){function a(l,t){this.s3=null,this.core=l,this.cloudStorage=t,this.logger=l.logger}var p=a.prototype;return p.s3Upload=function(t,e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_,I,C,A,N,F,j,W,U=this;return T.wrap(function(te){for(;;)switch(te.prev=te.next){case 0:if(Eg+=1,!t.file){te.next=5;break}i=t.file,te.next=20;break;case 5:if(typeof t.fileInput!="string"){te.next=15;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((o=document.getElementById(t.fileInput))&&o.files&&o.files[0])){te.next=12;break}i=o.files[0],te.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:te.next=20;break;case 15:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){te.next=19;break}i=t.fileInput.files[0],te.next=20;break;case 19:throw new Error("Can not get file from fileInput "+t.fileInput);case 20:if(this.mixStorePolicy.s3Policy){te.next=22;break}throw new Error("dont get s3 policy");case 22:return u={accessKeyId:e.accessKeyId,secretAccessKey:e.secretAccessKey,sessionToken:e.sessionToken,region:e.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},h=this.s3,g=decodeURIComponent(e.bucket),v=decodeURIComponent(e.objectName),_=i,I="https://"+g+".s3.amazonaws.com/"+v,C={},(A=this.mixStorePolicy.s3Policy)&&A.uploadConfig&&qt(A.uploadConfig.uploadUrl)&&A.uploadConfig.uploadUrl.length>0&&(N=A.uploadConfig.uploadUrl.length,Eg%=N,C.endpoint=A.uploadConfig.uploadUrl[Eg],C.s3ForcePathStyle=!0,I=C.endpoint+"/"+g+"/"+v),this.core.reporterHookCloudStorage.update({remote_addr:I,operation_type:1}),(F=new h(C)).config.update(u),j={Bucket:g,Key:v,Body:_,Metadata:{token:e.token},ContentType:_.type||"application/octet-stream"},this.core.logger.log("uploadFile:: s3 upload params:",j),(W=F.upload(j)).on("httpUploadProgress",function(H){var V=tV((H.loaded/H.total).toFixed(2));t.onUploadProgress&&t.onUploadProgress({total:H.total,loaded:H.loaded,percentage:V,percentageText:Math.round(100*V)+"%"})}),te.abrupt("return",new He(function(H,V){var w=new Date().getTime();W.send(function(Y,re){return k(U,void 0,void 0,T.mark(function ee(){var pe,ye,Q,ze,nt,Se,vt,ar;return T.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(!Y||Y.code!=="RequestAbortedError"){Ie.next=5;break}this.logger.error("uploadFile:","api::s3:upload file abort.",Y),V(new Ms({code:Pe(this.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:Y,curProvider:2}})),Ie.next=41;break;case 5:if(!Y){Ie.next=26;break}return this.logger.error("uploadFile:","api::s3:upload file failed.",Y),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||((ye=(pe=this.core)===null||pe===void 0?void 0:pe.auth)===null||ye===void 0?void 0:ye.account),trace_id:(Q=this.core.clientSocket.socket)===null||Q===void 0?void 0:Q.sessionId,start_time:w,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:typeof Y.status=="number"?Y.status:typeof Y.code=="number"?Y.code:0,description:Y.message||""+Y.code,operation_type:1,target:xe({bucket:g,object:v})},{asyncParams:We.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),Ie.next=12,We.net.getNetworkStatus();case 12:if(ze=Ie.sent,ze.net_connect!==!1){Ie.next=16;break}return Ie.abrupt("return",V(new Ms({code:Pe(this.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:Y,curProvider:this.cloudStorage.mixStorage.curProvider}})));case 16:Ie.prev=16,this.cloudStorage.mixStorage._addCircuitTimer(),Ie.next=23;break;case 20:return Ie.prev=20,Ie.t0=Ie.catch(16),Ie.abrupt("return",V(new Ms({code:Pe(this.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:Ie.t0,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:t.file||t.filePath}})));case 23:H(this.cloudStorage._uploadFile(t)),Ie.next=41;break;case 26:if(nt=(nt=(nt=this.mixStorePolicy.s3Policy.cdnSchema).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn)).replace("{objectName}",re.Key),Se={size:_.size,name:_.name,url:e.shortUrl?e.shortUrl:nt,ext:_.name.split(".")[1]||"unknown"},vt=t.type||"",(ar={image:"imageInfo"})[vt]){Ie.next=36;break}return Ie.abrupt("return",H(Se));case 36:return Ie.t1=H,Ie.next=39,this.getS3FileInfo({url:nt,infoSuffix:ar[vt],s3Result:Se});case 39:return Ie.t2=Ie.sent,Ie.abrupt("return",(0,Ie.t1)(Ie.t2));case 41:case"end":return Ie.stop()}},ee,this,[[16,20]])}))}),t.onUploadStart&&t.onUploadStart(W)}));case 39:case"end":return te.stop()}},r,this)}))},p.getS3FileInfo=function(t){var e;return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return i=t.url,o=t.infoSuffix,u=t.s3Result,C.prev=1,C.next=4,this.core.adapters.request(i+"?"+o,{method:"GET",dataType:"text",timeout:5e3},{exception_service:3});case 4:h=C.sent,C.next=11;break;case 7:return C.prev=7,C.t0=C.catch(1),this.core.logger.error("uploadFile:: fetch file info error",C.t0),C.abrupt("return",u);case 11:if(!h){C.next=18;break}return g=h.data,v=o==="imageInfo"?g:(e=g==null?void 0:g.GetVideoInfo)===null||e===void 0?void 0:e.VideoInfo,_=O(O({},u),{w:v==null?void 0:v.Width,h:v==null?void 0:v.Height,orientation:v==null?void 0:v.Orientation,dur:v==null?void 0:v.Duration,audioCodec:v==null?void 0:v.AudioCodec,videoCodec:v==null?void 0:v.VideoCodec,container:v==null?void 0:v.Container}),C.abrupt("return",J0(_,function(A){return A!==void 0}));case 18:return this.core.logger.error("uploadFile:: fetch s3 file info no result",i+"?"+o),C.abrupt("return",u);case 20:case"end":return C.stop()}},r,this,[[1,7]])}))},Ai(a,[{key:"mixStorePolicy",get:function(){return this.cloudStorage.mixStorage.mixStorePolicy}}]),a}(),Z0=function(){function a(l,t){t===void 0&&(t={}),this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=l.logger,this.core=l,this.nos=new JL(l,this),this.mixStorage=new XL(l,this),this.aws=new rV(l,this),Kt({cmdMap:QL,cmdConfig:zL}),this.setOptions(t),this.setListeners()}var p=a.prototype;return p.setOptions=function(t){t===void 0&&(t={});var e=t.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=e+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=e+"-AllMixStorePolicy";var r=t.s3,i=br(t,["s3"]),o=O({},WL,this.config);if(i&&Object.prototype.hasOwnProperty.call(i,"cdn")){var u=O(O({},o.cdn),i.cdn);this.config=O({},o,i),this.config.cdn=u}else this.config=O({},o,i);r&&(this.aws.s3=r)},p.setListeners=function(){var t,e,r,i;this.core.eventBus.on("kicked",et(t=this._clearUnCompleteTask).call(t,this)),this.core.eventBus.on("disconnect",et(e=this._clearUnCompleteTask).call(e,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",et(r=this._clearUnCompleteTask).call(r,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",et(i=this._clearUnCompleteTask).call(i,this))},p._clearUnCompleteTask=function(){var t,e=this;ae(t=pt(this.uploadTaskMap)).call(t,function(r){var i=e.uploadTaskMap[r];i&&i.abort&&i.abort()}),this.uploadTaskMap={}},p.init=function(t){return t===void 0&&(t=Dt()),k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.mixStorage.reset(),this.nos.reset(),!this.config.isNeedToGetUploadPolicyFromServer){i.next=5;break}return i.next=5,this.mixStorage.getGrayscaleConfig(this.core.options.appkey,t);case 5:return i.next=7,this.nos._getNosCdnHost();case 7:case"end":return i.stop()}},e,this)}))},p.processCallback=function(t,e){var r=this,i=t.onUploadProgress,o=t.onUploadDone,u=t.onUploadStart;return{onUploadStart:typeof u=="function"?function(h){r.uploadTaskMap[e]=h;try{u(h)}catch(g){r.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",g)}}:function(h){r.uploadTaskMap[e]=h},onUploadProgress:typeof i=="function"?function(h){r.core.reporterHookCloudStorage.update({transferred_size:h.loaded,full_size:h.total});try{i(h)}catch(g){r.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",g)}}:function(h){r.core.reporterHookCloudStorage.update({transferred_size:h.loaded,full_size:h.total})},onUploadDone:typeof o=="function"?function(h){r.core.reporterHookCloudStorage.end(0);try{o(h)}catch(g){r.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",g)}}:function(){r.core.reporterHookCloudStorage.end(0)},taskKey:e}},p.uploadFile=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(P({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},t),t.fileInput||t.file||t.filePath){C.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!t.type||t.type==="file"){C.next=7;break}if(!(r=Pe(t,"file.type"))||typeof r!="string"||wt(r).call(r,t.type)!==-1){C.next=7;break}throw new Error('The meta type "'+r+'" does not match "'+t.type+'"');case 7:return this.core.reporterHookCloudStorage.start(),t.file?this.core.reporterHookCloudStorage.update({full_size:t.file.size}):typeof t.fileInput=="string"?(i=document.getElementById(t.fileInput))&&i.files&&i.files[0]&&this.core.reporterHookCloudStorage.update({full_size:i.files[0].size}):t.fileInput&&t.fileInput.files&&t.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:t.fileInput.files[0].size}),o=jr(),u=this.processCallback(t,o),h=u.onUploadStart,g=u.onUploadProgress,v=u.onUploadDone,t.onUploadStart=h,t.onUploadProgress=g,t.onUploadDone=v,_=null,C.prev=15,C.next=18,this._uploadFile(t);case 18:_=C.sent,t.md5&&(_.md5=t.md5),delete this.uploadTaskMap[o],C.next=28;break;case 23:throw C.prev=23,C.t0=C.catch(15),delete this.uploadTaskMap[o],this.core.reporterHookCloudStorage.end((C.t0&&C.t0.code)===ce.V2NIM_ERROR_CODE_CANCELLED?3:1),C.t0;case 28:return _&&(_.size=_.size===void 0?void 0:Number(_.size),_.w=_.w===void 0?void 0:Number(_.w),_.h=_.h===void 0?void 0:Number(_.h),_.dur=_.dur===void 0?void 0:Number(_.dur)),_.url=decodeURIComponent(_.url),t.onUploadDone({size:_.size,name:_.name,url:_.url,ext:_.name.split(".")[1]||"unknown"}),C.abrupt("return",_);case 32:case"end":return C.stop()}},e,this,[[15,23]])}))},p._uploadFile=function(t){var e,r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(Pe(this.mixStorage,"grayConfig.mixStoreEnable")&&Pe(this.mixStorage,"mixStorePolicy.providers.length")){_.next=3;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),_.abrupt("return",this.nos.nosUpload(t));case 3:if(this.logger.log("uploadFile::_uploadFile, grayConfig enable:"+Pe(this.mixStorage,"grayConfig.mixStoreEnable")+" curProvider:"+Pe(this.mixStorage,"curProvider")),o=this.core.adapters.getFileUploadInformation(t),u=!0,o?o.complete===!1&&this.mixStorage.curProvider===2&&(u=!1):u=!1,this.aws.s3||(this.mixStorage.curProvider=1),h=YL,u){_.next=23;break}return _.prev=10,_.next=13,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:t.nosSurvivalTime,returnBody:W0(t.type),policyVersion:this.mixStorage.mixStorePolicy.policyVersion}});case 13:g=_.sent,h=g.content.mixStoreTokenResTag,_.next=23;break;case 17:if(_.prev=17,_.t0=_.catch(10),this.core.logger.error("uploadFile:: getMixStoreToken error",_.t0),!(_.t0 instanceof Me)){_.next=22;break}throw _.t0;case 22:throw new Ms({code:Pe(this.core,"options.apiVersion")==="v2"?ce.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:_.t0,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}});case 23:if(u){_.next=27;break}return _.abrupt("return",this.mixStorage.curProvider===2?this.aws.s3Upload(t,h):this.nos.nosUpload(t,h));case 27:return _.abrupt("return",this.nos.nosUpload(t,(r=(e=o==null?void 0:o.uploadInfo)===null||e===void 0?void 0:e.payload)===null||r===void 0?void 0:r.mixStoreToken));case 28:case"end":return _.stop()}},i,this,[[10,17]])}))},p.getThumbUrl=function(t,e){var r,i,o,u,h;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),t;var g=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);g[0],g[1],g[2],g[3],g[4];var v=g[5];if(g[6],g[7],(r=this.grayConfig)===null||r===void 0?void 0:r.mixStoreEnable){var _=this._getUrlType(t);if(_===2&&this.mixStorePolicy.s3Policy&&Pe(this.mixStorePolicy,"s3Policy.thumbPolicy.imagethumb"))return((o=(i=this.mixStorePolicy.s3Policy)===null||i===void 0?void 0:i.thumbPolicy)===null||o===void 0?void 0:o.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",v).replace("{x}",e.width.toString()).replace("{y}",e.height.toString());if(_===1&&this.mixStorePolicy.nosPolicy&&Pe(this.mixStorePolicy,"nosPolicy.thumbPolicy.imagethumb"))return((h=(u=this.mixStorePolicy.nosPolicy)===null||u===void 0?void 0:u.thumbPolicy)===null||h===void 0?void 0:h.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",v).replace("{x}",e.width.toString()).replace("{y}",e.height.toString())}return _t(t).call(t,"?")?t+"&imageView&thumbnail="+e.width+"x"+e.height:t+"?imageView&thumbnail="+e.width+"x"+e.height},p.getVideoCoverUrl=function(t,e){var r,i,o,u,h;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),t;var g=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);g[0],g[1],g[2],g[3],g[4];var v=g[5];if(g[6],g[7],(r=this.grayConfig)===null||r===void 0?void 0:r.mixStoreEnable){var _=this._getUrlType(t);if(_===2&&this.mixStorePolicy.s3Policy&&Pe(this.mixStorePolicy,"s3Policy.thumbPolicy.vframe"))return((o=(i=this.mixStorePolicy.s3Policy)===null||i===void 0?void 0:i.thumbPolicy)===null||o===void 0?void 0:o.vframe).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",v).replace("{x}",e.width.toString()).replace("{y}",e.height.toString()).replace("{offset}","0").replace("{type}","png");if(_===1&&this.mixStorePolicy.nosPolicy&&Pe(this.mixStorePolicy,"nosPolicy.thumbPolicy.vframe"))return((h=(u=this.mixStorePolicy.nosPolicy)===null||u===void 0?void 0:u.thumbPolicy)===null||h===void 0?void 0:h.vframe).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",v).replace("{x}",e.width.toString()).replace("{y}",e.height.toString()).replace("{offset}","0").replace("{type}","png")}return _t(t).call(t,"?")?t+"&vframe&offset=0&resize="+e.width+"x"+e.height+"&type=png":t+"?vframe&offset=0&resize="+e.width+"x"+e.height+"&type=png"},p.getPrivateUrl=function(t){var e;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),"";var r=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);r[0];var i=r[1];r[2];var o=r[3];r[4];var u=r[5];if(r[6],r[7],(e=this.grayConfig)===null||e===void 0?void 0:e.mixStoreEnable){var h=this._getUrlType(t);return h===2&&this.mixStorePolicy.s3Policy&&(t=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",u)),h===1&&this.mixStorePolicy.nosPolicy&&(t=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",u)),t}var g=this.config,v=g.downloadUrl,_=g.downloadHostList,I=g.nosCdnEnable,C=this.config.cdn.cdnDomain,A=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",N=decodeURIComponent(u),F=wt(N).call(N,A);if(C&&F>-1&&I)return""+i+C+"/"+ht(N).call(N,F);if(_t(_).call(_,o)&&_t(u).call(u,"/")){var j=wt(u).call(u,"/"),W=u.substring(0,j),U=u.substring(j+1);return v.replace("{bucket}",W).replace("{object}",U)}var ie=at(_).call(_,function(H){return typeof o=="string"&&_t(o).call(o,H)})[0],te=ie?o.replace(ie,"").replace(/\W/g,""):null;return te?v.replace("{bucket}",te).replace("{object}",u):t},p.getOriginUrl=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(typeof t=="string"&&_t(t).call(t,"_im_url=1")){o.next=2;break}return o.abrupt("return",t);case 2:return o.next=4,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:t}});case 4:return r=o.sent,o.abrupt("return",r.content.nosSafeUrlTag.originUrl);case 6:case"end":return o.stop()}},e,this)}))},p.getFileToken=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(P({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},t),r=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,i=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,r!==String(-1)||i!==String(-1)){_.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(t.type!==2){_.next=17;break}if(!(r&&wt(r).call(r,String(2))>=0||i&&wt(i).call(i,String(2))>0)){_.next=13;break}return _.abrupt("return",this.mixStorage.getFileAuthToken(t));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:_.next=33;break;case 17:if(t.urls&&t.urls.length){_.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(u=[],h=[],ae(o=t.urls).call(o,function(I){var C=g._getUrlType(I);C===1&&h.push(I),C===2&&u.push(I)}),(!i||u.length!==0&&wt(i).call(i,String(3))<0)&&(this.logger.warn("s3 url don't support url token"),u=[]),(!r||h.length!==0&&wt(r).call(r,String(3))<0)&&(this.logger.warn("nos url don't support url token"),h=[]),u.length!==0||h.length!==0){_.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(u.length!==0&&h.length!==0){_.next=33;break}return t.urls=xe(t.urls),_.abrupt("return",this.mixStorage.getFileAuthToken(t));case 33:case"end":return _.stop()}},e,this)}))},p._getUrlType=function(t){var e,r;return this.mixStorePolicy.nosPolicy&&Ln(e=this.mixStorePolicy.nosPolicy.dlcdns).call(e,function(i){return wt(t).call(t,i)>=0})?1:this.mixStorePolicy.s3Policy&&Ln(r=this.mixStorePolicy.s3Policy.dlcdns).call(r,function(i){return wt(t).call(t,i)>=0})?2:null},p.getNosAccessToken=function(t){return P({url:{type:"string",allowEmpty:!1}},t),this.nos.getNosAccessToken(t)},p.deleteNosAccessToken=function(t){return P({token:{type:"string",allowEmpty:!1}},t),this.nos.deleteNosAccessToken(t)},p.process=function(t){var e=Pe(t,"error.detail.ignore");return t.error&&!e?He.reject(t.error):He.resolve(t)},Ai(a,[{key:"grayConfig",get:function(){return this.mixStorage.grayConfig}},{key:"mixStorePolicy",get:function(){return this.mixStorage.mixStorePolicy}}]),a}(),Ol,eE=function(a){function p(t){var e;return(e=a.call(this,"V2NIMStorageService",t)||this).sceneMap={nim_default_profile_icon:{sceneName:"nim_default_profile_icon",expireTime:0},nim_default_im:{sceneName:"nim_default_im",expireTime:0},nim_system_nos_scene:{sceneName:"nim_system_nos_scene",expireTime:0},nim_security:{sceneName:"nim_security",expireTime:0}},e.uploadingMessageInfo={},e.core=t,e.core._registerDep(Z0,"cloudStorage"),e.core._registerDep(Y0,"V2NIMStorageUtil"),e}bt(p,a);var l=p.prototype;return l.addCustomStorageScene=function(e,r){return this.checkV2(),P({sceneName:{type:"string",allowEmpty:!1},expireTime:{type:"number",min:0}},{sceneName:e,expireTime:r},"",!0),this.sceneMap[e]={sceneName:e,expireTime:r},{sceneName:e,expireTime:r}},l.getStorageSceneList=function(){return this.checkV2(),yf(this.sceneMap)},l.getStorageScene=function(e){return e&&this.sceneMap[e]||this.sceneMap.nim_default_im},l.hasStorageScene=function(e){return this.sceneMap[e]!==void 0},l.createUploadFileTask=function(e){var r;if(this.checkV2(),typeof e.fileObj=="string"&&wt(r=e.fileObj).call(r,"nim-external")===0){var i=document.getElementById(e.fileObj);i&&i.files&&i.files[0]&&(e.fileObj=i.files[0])}return{taskId:jr(),uploadParams:e}},l.uploadFile=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P({taskId:{type:"string",allowEmpty:!1}},e,"fileTask",!0),h.next=4,this._uploadFile(e,r);case 4:return o=h.sent,h.abrupt("return",o[0]);case 6:case"end":return h.stop()}},i,this)}))},l.uploadFileWithMetaInfo=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P({taskId:{type:"string",allowEmpty:!1}},e,"fileTask",!0),h.next=4,this._uploadFile(e,r);case 4:return o=h.sent,h.abrupt("return",(g=o[1],v=void 0,_=void 0,I=void 0,C=void 0,A=void 0,N=void 0,F=void 0,j=void 0,W=void 0,U=void 0,ie=void 0,te=void 0,v=g.url,_=g.name,I=g.size,C=g.ext,A=g.md5,N=g.h,F=g.w,j=g.orientation,W=g.dur,U=g.audioCodec,ie=g.videoCodec,te=g.container,JSON.parse(xe({url:v,name:_,size:I,ext:C,md5:A,height:N,width:F,orientation:j,duration:W,audioCodec:U,videoCodec:ie,container:te}))));case 6:case"end":return h.stop()}var g,v,_,I,C,A,N,F,j,W,U,ie,te},i,this)}))},l._uploadFile=function(e,r,i){var o;return k(this,void 0,void 0,T.mark(function u(){var h,g,v,_,I,C,A,N,F,j,W=this;return T.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){ie.next=2;break}throw new Error('Service "cloudStorage" does not exist');case 2:if(h=e.uploadParams,g=e.taskId,v=j0(h.fileObj),_=v.file,I=v.path,C=(i||{}).fileType,!this.uploadingMessageInfo[g]){ie.next=7;break}throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST,detail:{reason:"V2NIMStorageService.uploadFile: repeat upload"}});case 7:if(ie.prev=7,A={},_?A.file=_:I&&((I==null?void 0:wt(I).call(I,"nim-external"))===0?A.fileInput=I:A.filePath=I),N=this.getStorageScene(h.sceneName),A.nosScenes=N.sceneName,A.nosSurvivalTime=N.expireTime,A.type=C===1?"image":C===2?"audio":C===3?"video":"file",!A.file||!this.core.pluginMap["browser-md5-file"]){ie.next=19;break}return ie.next=17,this.getFileMd5(this.core.pluginMap["browser-md5-file"],g,A.file);case 17:F=ie.sent,A.md5=F;case 19:return A.onUploadProgress=function(te){typeof r=="function"&&r(Math.round(100*te.percentage))},A.onUploadStart=function(te){var H;if(!((H=W.uploadingMessageInfo[g])===null||H===void 0)&&H.abort)return te.abort(),void delete W.uploadingMessageInfo[g];W.uploadingMessageInfo[g]={abort:!1,task:te}},this.uploadingMessageInfo[g]={abort:!1},ie.next=24,this.core.cloudStorage.uploadFile(A);case 24:if(j=ie.sent,!(!((o=this.uploadingMessageInfo[g])===null||o===void 0)&&o.abort)){ie.next=27;break}throw new Me({code:ce.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}});case 27:return delete this.uploadingMessageInfo[g],ie.abrupt("return",[j.url,j]);case 31:throw ie.prev=31,ie.t0=ie.catch(7),delete this.uploadingMessageInfo[g],this.core.logger.error("sendFile:: upload File error or abort.",ie.t0),ie.t0;case 36:case"end":return ie.stop()}},u,this,[[7,31]])}))},l.cancelUploadFile=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),o.next=3,this._cancelUploadFile(e.taskId);case 3:case"end":return o.stop()}},r,this)}))},l._cancelUploadFile=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.checkV2(),!((i=this.uploadingMessageInfo[e])!=null&&i.task)){u.next=16;break}return u.prev=3,this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task exist"),u.next=7,i.task.abort();case 7:delete this.uploadingMessageInfo[e],u.next=14;break;case 10:u.prev=10,u.t0=u.catch(3),delete this.uploadingMessageInfo[e],this.core.logger.error("cancelMessageAttachmentUpload::abort error.",u.t0);case 14:u.next=22;break;case 16:if(!i){u.next=21;break}this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task not exist"),i.abort=!0,u.next=22;break;case 21:throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"V2NIMStorageService.cancelUploadFile: uploadInfo not exist"}});case 22:case"end":return u.stop()}},r,this,[[3,10]])}))},l.getFileMd5=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u=this;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",new He(function(v,_){var I,C=new e;!((I=u.uploadingMessageInfo[r])===null||I===void 0)&&I.abort?_(new Me({code:ce.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}})):u.uploadingMessageInfo[r]={abort:!1,task:C};try{C.md5(i,function(A,N){A==="aborted"?_(new Me({code:ce.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:A}})):A?_(new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error in callback",rawError:A}})):v(N)})}catch(A){_(new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error",rawError:A}}))}}));case 1:case"end":return g.stop()}},o)}))},l.shortUrlToLong=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),o.abrupt("return",this.core.cloudStorage.getOriginUrl(e));case 2:case"end":return o.stop()}},r,this)}))},l.getImageThumbUrl=function(e,r){return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.core.V2NIMStorageUtil.getImageThumbUrl(e,r));case 1:case"end":return u.stop()}},i,this)}))},l.getVideoCoverUrl=function(e,r){return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.core.V2NIMStorageUtil.getVideoCoverUrl(e,r));case 1:case"end":return u.stop()}},i,this)}))},p}($r),tE=function(a){function p(t){var e;return(e=a.call(this,"V2NIMMessageCreator",t)||this).name="V2NIMMessageCreator",e.defaultNosSceneName="nim_default_im",e.core=t,e}bt(p,a);var l=p.prototype;return l.createMessage=function(e,r){return O(O(O({messageClientId:jr(),messageType:e,createTime:this.core.timeOrigin.getNTPTime(),sendingState:0,messageStatus:{errorCode:200},isSelf:!0},r),r.attachment?{attachment:O(O({},r.attachment),{raw:kl(e,r.attachment)})}:{}),{senderId:"",receiverId:"",conversationType:0,conversationId:"",messageServerId:"",messageConfig:O({unreadEnabled:!0,roamingEnabled:!0,readReceiptEnabled:!1,lastMessageUpdateEnabled:!0,historyEnabled:!0,onlineSyncEnabled:!0,offlineEnabled:!0},r.messageConfig),pushConfig:O({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},r.pushConfig),routeConfig:O({routeEnabled:!0},r.routeConfig),antispamConfig:O({antispamEnabled:!0},r.antispamConfig)})},l.createTextMessage=function(e){return this.checkV2(),P({text:{type:"string",allowEmpty:!1}},{text:e},"",!0),this.createMessage(0,{text:e})},l.createImageMessage=function(e,r,i,o,u){this.checkV2(),P(RL,{name:r,sceneName:i,width:o,height:u},"",!0);var h=this.createGenericFileMessageAttachment(e,r,i,void 0,o,u,"jpeg");return this.createMessage(1,{attachment:h,attachmentUploadState:0})},l.createAudioMessage=function(e,r,i,o){this.checkV2(),P(O0,{name:r,sceneName:i,duration:o},"",!0);var u=this.createGenericFileMessageAttachment(e,r,i,o,void 0,void 0,"aac");return this.createMessage(2,{attachment:u,attachmentUploadState:0})},l.createVideoMessage=function(e,r,i,o,u,h){this.checkV2(),P(AL,{name:r,sceneName:i,duration:o,width:u,height:h},"",!0);var g=this.createGenericFileMessageAttachment(e,r,i,o,u,h,"mp4");return this.createMessage(3,{attachment:g,attachmentUploadState:0})},l.createFileMessage=function(e,r,i){this.checkV2(),P(Mg,{name:r,sceneName:i},"",!0);var o=this.createGenericFileMessageAttachment(e,r,i,void 0,void 0,void 0,"txt");return this.createMessage(6,{attachment:o,attachmentUploadState:0})},l.createGenericFileMessageAttachment=function(e,r,i,o,u,h,g){if(i=i||this.defaultNosSceneName,!this.core.V2NIMStorageService.hasStorageScene)throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMStorageService not exist"}});if(!this.core.V2NIMStorageService.hasStorageScene(i))throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sceneName: "+i+" has not been added"}});var v=j0(e),_=v.file,I=v.path,C=O(O(O({name:r,uploadState:0,sceneName:i||this.defaultNosSceneName},o?{duration:o}:{}),u?{width:u}:{}),h?{height:h}:{});if(_){var A,N=rc(A=_.name).call(A,"."),F=N===-1?_.name:_.name.substring(0,N);C.name=C.name||F,C.size=_.size,C.ext="."+(Ad(_.name)||Ad(r||"")||g)}else if(I){var j=rc(I).call(I,"/"),W=rc(I).call(I,"."),U=W===-1?I.substring(j+1):I.substring(j+1,W);C.name=C.name||U,C.ext="."+(Ad(I)||Ad(r||"")||g)}return C=JSON.parse(xe(C)),I?C.path=I:_&&(C.file=_),C},l.createLocationMessage=function(e,r,i){return this.checkV2(),P({latitude:{type:"number",allowEmpty:!1},longitude:{type:"number",allowEmpty:!1},address:{type:"string",allowEmpty:!1}},{latitude:e,longitude:r,address:i},"",!0),this.createMessage(4,{attachment:{latitude:e,longitude:r,address:i}})},l.createCustomMessage=function(e,r){return this.checkV2(),P({text:{type:"string"}},{text:e},"",!0),P({rawAttachment:{type:"string"}},{rawAttachment:r},"",!0),this.createMessage(100,{text:e,attachment:{raw:r}})},l.createCustomMessageWithAttachment=function(e,r){return this.checkV2(),P({raw:{type:"string"}},e,"attachment",!0),P({subType:{type:"number",min:0,required:!1}},{subType:r},"",!0),this.createMessage(100,r?{attachment:e,subType:r}:{attachment:e})},l.createCallMessage=function(e,r,i,o,u){return this.checkV2(),P({type:{type:"number",allowEmpty:!1}},{type:e},"",!0),P({channelId:{type:"string",allowEmpty:!1}},{channelId:r},"",!0),P({status:{type:"number",allowEmpty:!1}},{status:i},"",!0),P({durations:{type:"array",allowEmpty:!1}},{durations:o},"",!0),this.createMessage(12,{text:u||"",attachment:{type:e,channelId:r,durations:o,status:i}})},l.createForwardMessage=function(e){this.checkV2();var r=[11,5,7,10];if(!e||_t(r).call(r,e.messageType))return null;var i={messageClientId:jr(),messageType:e.messageType};return e.text&&(i.text=e.text),e.attachment&&(i.attachment=e.attachment),e.attachment&&"uploadState"in e.attachment&&(i.attachmentUploadState=e.attachment.uploadState),this.createMessage(e.messageType,i)},l.createTipsMessage=function(e){return this.checkV2(),P({text:{type:"string",allowEmpty:!1}},{text:e},"",!0),this.createMessage(10,{text:e})},p}($r),rE=function(){function a(){this.name="V2NIMMessageAttachmentCreator"}var p=a.prototype;return p.createLocationMessageAttachment=function(t,e,r){return{latitude:typeof t=="number"?t:0,longitude:typeof e=="number"?e:0,address:typeof r=="string"?r:""}},p.createCustomMessageAttachment=function(t){return{raw:typeof t=="string"?t:""}},a}(),nE=function(){function a(l){this.config={enable:!1},this.name="V2NIMClientAntispamUtil",this.core=l}var p=a.prototype;return p.setOptions=function(t){this.config=O(this.config,t)},p.reset=function(t){t==="destroy"&&(this.vocabInfo=void 0)},p.downloadLocalAntiSpamVocabs=function(){return k(this,void 0,void 0,T.mark(function t(){var e;return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.config.enable){i.next=2;break}return i.abrupt("return");case 2:if(!this.vocabInfo){i.next=4;break}return i.abrupt("return");case 4:return i.prev=4,i.next=7,this.core.sendCmd("v2DownloadLocalAntiSpamVocabs",{tag:{version:0,md5:""}});case 7:e=i.sent,this.vocabInfo=O(O({},e.content.data),{thesaurus:JSON.parse(e.content.data.thesaurus).thesaurus}),i.next=14;break;case 11:i.prev=11,i.t0=i.catch(4),this.core.logger.warn("V2NIMLocalAntispamUtil::downloadLocalAntiSpamVocabs error",i.t0);case 14:case"end":return i.stop()}},t,this,[[4,11]])}))},p.checkTextAntispam=function(t,e){if(e===void 0&&(e="**"),!this.config.enable)return{operateType:0,replacedText:t};if(P({text:{type:"string",required:!0,allowEmpty:!1},replace:{type:"string"}},{text:t,replace:e},"",!0),!this.vocabInfo)return{operateType:0,replacedText:t};for(var r=t,i=0;i<this.vocabInfo.thesaurus.length;i++){var o=this.filterContent(r,this.vocabInfo.thesaurus[i],e);if(r=o.replacedText,o.operateType===2||o.operateType===3)return o}return{operateType:r===t?0:1,replacedText:r}},p.filterContent=function(t,e,r){for(var i=0;i<Pd(e).length;i++){var o=Pd(e)[i],u=o.match||e.match,h=o.operate||e.operate,g=void 0;try{g=this.matchContent(t,o.key,u,h,r)}catch{}if(g&&(t=g.replacedText,g.operateType===2||g.operateType===3))return g}return{operateType:1,replacedText:t}},p.matchContent=function(t,e,r,i,o){var u=!1,h=null;if(r===1){if(wt(t).call(t,e)>=0){u=!0;var g=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");h=new RegExp(g,"g")}}else r===2&&(h=new RegExp(e,"g")).test(t)&&(u=!0);if(u&&h)switch(i){case 1:return{operateType:1,replacedText:t.replace(h,o)};case 2:return{operateType:2,replacedText:t};case 3:return{operateType:3,replacedText:t}}return{operateType:0,replacedText:t}},a}(),iE=function(a){function p(t){var e;return(e=a.call(this,"YSFService",t)||this).core._registerDep(la,"V2NIMConversationIdUtil"),e.core._registerDep(tE,"V2NIMMessageCreator"),e.core._registerDep(rE,"V2NIMMessageAttachmentCreator"),e.core._registerDep(nE,"V2NIMClientAntispamUtil"),e.core._registerDep(eE,"V2NIMStorageService"),e.sendUtil=new sE(e.core,Ot(e)),e.fileUtil=new U0(e.core),e.model=new S0,e.notificationUtil=new G0(e.core),Kt({cmdMap:HL,cmdConfig:$L}),e}bt(p,a);var l=p.prototype;return l.emit=function(e){for(var r,i,o,u=this.name+"::emit "+e.toString(),h=arguments.length,g=new Array(h>1?h-1:0),v=1;v<h;v++)g[v-1]=arguments[v];if(e==="onSendMessage"){var _=g[0];this.logger.log(""+u,_.messageClientId+"/"+_.messageServerId+";createTime:"+_.createTime+";","sendingState:"+_.sendingState+";attachmentUploadState:"+(_.attachmentUploadState||0)+";messageStatus:"+((o=_.messageStatus)===null||o===void 0?void 0:o.errorCode))}else if(e==="onReceiveMessages"){var I=g[0];this.logger.log(""+u,se(I).call(I,function(F){return F.messageClientId+"/"+F.messageServerId+";createTime:"+F.createTime}))}else if(e==="onReceiveCustomNotifications"){var C=g[0];this.logger.log(""+u,se(C).call(C,function(F){return"sender:"+F.senderId+";receiver:"+F.receiverId+";ctype:"+F.conversationType+";time:"+F.timestamp}))}else{var A,N;(A=this.logger).log.apply(A,dt(N=[""+u]).call(N,g))}return(r=a.prototype.emit).call.apply(r,dt(i=[this,e]).call(i,g))},l.sendMessage=function(e,r,i,o){return i===void 0&&(i={}),k(this,void 0,void 0,T.mark(function u(){var h,g,v,_,I,C;return T.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return P({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||jr(),P(R0,{conversationId:r,message:e,params:i},"",!0),Nr(this.core.account,r),h=this.core.timeOrigin.getTimeNode(),g=this.sendUtil.prepareMessage(e,r,i),v=g.messageBeforeSend,_=g.clientAntispamResult,I=g.hiddenParams,N.next=8,this.sendUtil.doSendMessage({apiCallingTimeNode:h,messageBeforeSend:v,clientAntispamResult:_,hiddenParams:I,progress:o});case 8:return(C=N.sent).message.senderId===C.message.receiverId&&this.markMsgsAck([C.message]),N.abrupt("return",C);case 11:case"end":return N.stop()}},u,this)}))},l.sendCustomNotification=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),Nr(this.core.account,e),P(q0,{content:r,params:i},"",!0),(u=this.notificationUtil.generateNotificationTag(e,r,i)).type=100,g.next=7,this.core.sendCmd("ysfSendCustomNotification",{tag:u});case 7:case"end":return g.stop()}},o,this)}))},l.sendMessageFn=function(e){},l.cancelMessageAttachmentUpload=function(e){return this.fileUtil.cancelMessageAttachmentUpload(e)},l.markMsgsAck=function(e){var r;if(e&&e.length>0){var i=at(r=se(e).call(e,function(o){return o.messageServerId})).call(r,function(o){return o&&o!=="0"});i.length!==0&&this.core.sendCmd("ysfBatchMarkRead",{sid:101,cid:2,ids:i})}},l.markNotificationAck=function(e){var r;if(e&&e.length>0){var i=at(r=se(e).call(e,function(o){return o.idServer})).call(r,function(o){return o&&o!=="0"});i.length!==0&&this.core.sendCmd("ysfBatchMarkRead",{sid:101,cid:3,ids:i})}},l.ysfOnMsgHandler=function(e){var r=zi(e,e.content.data,"messageServerId"),i=Xi(pn(this.core,r),this.core);delete i.__clientExt,this.emit("onReceiveMessages",[i]),this.model.upsertMessages([i]),this.markMsgsAck([i])},l.ysfSyncOfflineMsgsHandler=function(e){var r=this,i=e.content.datas;i=se(i).call(i,function(o){return Xi(pn(r.core,o),r.core)}),this.markMsgsAck(i),this.emit("onReceiveMessages",i),this.model.upsertMessages(i)},l.ysfOnSysNotificationHandler=function(e){var r=zi(e,e.content.data,"idServer");this.markNotificationAck([r]);var i=this.processSystemNotification(r);i&&this.emit("onReceiveCustomNotifications",[i])},l.processSystemNotification=function(e){var r=O(O({},e),{conversationType:1});return delete r.type,r},l.ysfSyncSysNotificationHandler=function(e){var r,i,o,u=this;this.markNotificationAck(e.content.datas);var h=at(r=se(i=Tr(o=e.content.datas).call(o,function(g,v){return g.timestamp-v.timestamp})).call(i,function(g){return u.processSystemNotification(g)})).call(r,function(g){return g});h&&this.emit("onReceiveCustomNotifications",h)},p}($r),sE=function(){function a(l,t){this.uploadingMessageInfo={},this.core=l,this.service=t}var p=a.prototype;return p.prepareMessage=function(t,e,r,i){var o=this.checkIfResend(t),u=this.generateSendMessage({message:t,params:r,resend:o,conversationId:e,replyMessage:i}),h=O({},r.targetConfig?{targetConfig:r.targetConfig}:{}),g=this.checkIfAntispam(r,u),v=g.clientAntispamResult,_=g.text;return u.text=_,u.clientAntispamHit=!!v&&v.operateType===3,{messageBeforeSend:u,clientAntispamResult:v,hiddenParams:h}},p.checkIfAntispam=function(t,e){var r,i=e.text;if(t.clientAntispamEnabled&&(e.messageType===0||e.messageType===10)){if((r=this.core.V2NIMClientAntispamUtil.checkTextAntispam?this.core.V2NIMClientAntispamUtil.checkTextAntispam(e.text||"",t.clientAntispamReplace):{operateType:0,replacedText:""}).operateType===1)i=r.replacedText;else if(r.operateType===2)throw this.service.emit("onSendMessage",O(O({},e),{sendingState:2,messageStatus:{errorCode:ce.V2NIM_ERROR_CODE_CLIENT_ANTISPAM}})),new Me({code:ce.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}})}return{clientAntispamResult:r,text:i}},p.doMsgReceiveReport=function(t,e){if(t.senderId!==this.core.account){var r=Pe(t,"__clientExt.statistics.apiCallingTime")||0,i=Pe(t,"__clientExt.statistics.sendTime")||0,o=Pe(t,"__clientExt.statistics.attachUploadDuration")||0,u=this.core.timeOrigin.getNTPTime(),h=t.createTime,g=this.core.timeOrigin.checkNodeReliable(e.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(e.__receiveTimeNode):u;this.core.reporter.report("msgReceive",{msgId:t.messageServerId,clientId:t.messageClientId,serverTime:t.createTime,receiveTime:g,fromAccid:t.conversationType===1?t.senderId:"",toAccid:t.receiverId,type:Dd(t.conversationType),tid:t.conversationType===1?"":t.receiverId,apiCallingTime:r,sendTime:i,attachUploadDuration:o,callbackTime:u,preHandleTime:u,result:200,failReason:"",rt:u-h})}},p.checkIfResend=function(t){var e=this.service.model.getMessageById(t.messageClientId),r=!1;if(t.messageServerId||t.sendingState===1)throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});if((e==null?void 0:e.sendingState)===1)throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});return e&&(r=!0),r},p.doSendMessage=function(t){var e;return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_,I,C,A,N,F,j;return T.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(i=t.apiCallingTimeNode,o=t.messageBeforeSend,u=t.clientAntispamResult,h=t.hiddenParams,g=t.progress,v={},!(_=this.service instanceof iE)){U.next=7;break}I="ysfSendMessage",U.next=20;break;case 7:if(o.conversationType!==1){U.next=11;break}I="v2SendP2pMessage",U.next=20;break;case 11:if(o.conversationType!==2){U.next=15;break}I="v2SendTeamMessage",U.next=20;break;case 15:if(o.conversationType!==3){U.next=19;break}I="v2SendSuperTeamMessage",U.next=20;break;case 19:throw new Qi({detail:{reason:"conversationType: "+o.conversationType+" is not supported"}});case 20:if(this.service.sendMessageFn(o),!_&&this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",o),!o.attachment||!("uploadState"in o.attachment)||o.attachment.url||o.attachment.uploadState!==0&&o.attachment.uploadState!==2){U.next=48;break}return C=Dt(),U.prev=24,o.attachmentUploadState=3,o.attachment.uploadState=3,this.service.emit("onSendMessage",o),U.next=30,this.service.fileUtil.doSendFile(o,g);case 30:o.attachmentUploadState=1,o.attachment.uploadState=1,this.service.emit("onSendMessage",o),U.next=45;break;case 35:throw U.prev=35,U.t0=U.catch(24),o.attachmentUploadState=2,o.attachment.uploadState=2,o.sendingState=2,o.messageStatus={errorCode:U.t0.code||ce.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",o),v.attachUploadDuration=Dt()-C,this.doSendMessageFailed(i,v,o,U.t0),U.t0;case 45:v.attachUploadDuration=Dt()-C,U.next=49;break;case 48:this.service.emit("onSendMessage",o);case 49:return this.core.timeOrigin.checkNodeReliable(i)&&(v.apiCallingTime=this.core.timeOrigin.getNTPTime(i),v.sendTime=this.core.timeOrigin.getNTPTime(),o.__clientExt={statistics:v}),U.prev=50,U.next=53,this.core.sendCmd(I,{tag:O({},o,h)});case 53:A=U.sent,U.next=63;break;case 56:throw U.prev=56,U.t1=U.catch(50),this.doSendMessageFailed(i,v,o,U.t1),o.sendingState=2,o.messageStatus={errorCode:U.t1.code||ce.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",o),U.t1;case 63:return N=Pe(A,"content.data.errorCode"),F=O(O(O(O({},o),A.content.data),o.aiConfig?{aiConfig:O(O({},o.aiConfig),((e=A.content.data)===null||e===void 0?void 0:e.aiConfig)||{})}:{}),{sendingState:1,messageStatus:{errorCode:N&&N!==200?N:200}}),this.service.sendMessageFn(F),!_&&this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",F),this.doMsgSendReport(i,v,o),(j=F.antispamResult)&&(F.messageStatus.errorCode=ce.V2NIM_ERROR_CODE_SERVER_ANTISPAM),delete F.antispamResult,this.service.emit("onSendMessage",F),U.abrupt("return",O(O({message:F},j?{antispamResult:j}:{}),u?{clientAntispamResult:u}:{}));case 73:case"end":return U.stop()}},r,this,[[24,35],[50,56]])}))},p.doSendMessageFailed=function(t,e,r,i){var o=O(O({},r),{sendingState:2});this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",o),this.service.sendMessageFn(o),this.doMsgSendReport(t,e,r,i)},p.doMsgSendReport=function(t,e,r,i){e.apiCallingTime=this.core.timeOrigin.getNTPTime(t),e.sendTime=this.core.timeOrigin.getNTPTime();var o=this.core.timeOrigin.getNTPTime(),u=Pe(i,"detail.reason");this.core.reporter.report("msgSend",{msgId:r.messageServerId,clientId:r.messageClientId,msgTime:r.createTime,fromAccid:r.conversationType===1?r.senderId:"",toAccid:r.receiverId,type:Dd(r.conversationType),tid:r.conversationType===1?"":r.receiverId,result:i?i.code:200,failReason:u||(i==null?void 0:i.message)||"",rt:o-e.apiCallingTime,apiCallingTime:e.apiCallingTime,sendTime:e.sendTime,attachUploadDuration:e.attachUploadDuration,apiCallbackTime:o})},p.generateSendMessage=function(t){var e,r,i=t.conversationId,o=t.replyMessage,u=t.resend,h=t.message,g=t.params,v={};if(o){var _=o.threadRoot;v={threadReply:{senderId:o.senderId,receiverId:o.receiverId,messageServerId:o.messageServerId,createTime:o.createTime,messageClientId:o.messageClientId,conversationType:o.conversationType,conversationId:o.conversationId},threadRoot:{senderId:_?_.senderId:o.senderId,receiverId:_?_.receiverId:o.receiverId,messageServerId:_?_.messageServerId:o.messageServerId,createTime:_?_.createTime:o.createTime,messageClientId:_?_.messageClientId:o.messageClientId,conversationType:_?_.conversationType:o.conversationType,conversationId:_?_.conversationId:o.conversationId}}}var I=this.core.V2NIMConversationIdUtil.parseConversationType(i),C=this.core.V2NIMConversationIdUtil.parseConversationTargetId(i);g.pushConfig&&g.pushConfig.forcePush!==!0&&(delete g.pushConfig.forcePushContent,delete g.pushConfig.forcePushAccountIds);var A={},N={};if(g.aiConfig){var F=Pe(g,"aiConfig.content.msg"),j=Pe(g,"aiConfig.content.type")||0;F?N={msg:F,type:j}:F===void 0&&h.messageType===0&&(N={msg:h.text||"",type:j}),(A=O({aiStreamStatus:0,aiStream:!1},g.aiConfig)).aiStatus=1,N.msg!==void 0&&(A.content=N)}var W=(r=(e=this.core.V2NIMUserService)===null||e===void 0?void 0:e.model)===null||r===void 0?void 0:r.getUser(this.core.account),U=(W==null?void 0:W.updateTime)||0;return O(O(O(O(O(O(O(O({},h),v),{messageConfig:O(O({},h.messageConfig),g.messageConfig),routeConfig:O(O({},h.routeConfig),g.routeConfig),pushConfig:O(O({},h.pushConfig),g.pushConfig),antispamConfig:O(O({},h.antispamConfig),g.antispamConfig),robotConfig:O(O({},h.robotConfig),g.robotConfig)}),A&&A.accountId?{aiConfig:A}:{}),h.attachment?{attachment:O({},h.attachment)}:{}),{resend:u,senderId:this.core.account,conversationType:I,receiverId:C,conversationId:this.core.V2NIMConversationIdUtil.messageConversationId({conversationType:I,senderId:this.core.account,receiverId:C})}),U?{userUpdateTime:U}:{}),{sendingState:3})},a}(),nV=function(){function a(l,t){this.core=l,this.service=t}var p=a.prototype;return p.checkIfModify=function(t,e){var r,i;if(t.messageServerId==="0")throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageServerId cannot be empty"}});if(!_t(r=[0,1,2,3,4,6,10,12,100]).call(r,t.messageType))throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageType "+t.messageType+" not correct"}});if(_t(i=[0,1,2,3,6,10,12]).call(i,t.messageType)&&e.attachment)throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageType "+t.messageType+" can not modify attachment"}});var o=["subType","text","serverExtension","attachment"];if(!Ln(o).call(o,function(u){return Pe(e,u)!==void 0}))throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: missing modified params"}});if(Md(o).call(o,function(u){return u==="attachment"?t.attachment&&e.attachment?kl(t.messageType,t.attachment)===kl(t.messageType,e.attachment):!e.attachment:Pe(t,u)===Pe(e,u)}))throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: no change"}})},p.prepareMessage=function(t,e){var r=this.generateSendMessage(t,e),i=this.checkIfAntispam(e,r),o=i.clientAntispamResult,u=i.text;return r.text=u,r.clientAntispamHit=!!o&&o.operateType===3,{messageBeforeSend:r,clientAntispamResult:o}},p.modifyMessage=function(t,e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(t.conversationType!==1){_.next=4;break}i="v2MessageP2pModify",_.next=13;break;case 4:if(t.conversationType!==2){_.next=8;break}i="v2MessageTeamModify",_.next=13;break;case 8:if(t.conversationType!==3){_.next=12;break}i="v2MessageSuperTeamModify",_.next=13;break;case 12:throw new Qi({detail:{reason:"conversationType: "+t.conversationType+" is not supported"}});case 13:return _.next=15,this.core.sendCmd(i,{tag:t});case 15:if(o=_.sent,!e||e.operateType!==3){_.next=18;break}return _.abrupt("return",{errorCode:ce.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,clientAntispamResult:e});case 18:if(u=O(O({},t),o.content.data),!(h=u.antispamResult)){_.next=22;break}return _.abrupt("return",O({errorCode:ce.V2NIM_ERROR_CODE_SERVER_ANTISPAM,antispamResult:h},e?{clientAntispamResult:e}:{}));case 22:return delete u.antispamResult,g=pn(this.core,u),this.service.model.upsertMessages([g]),this.core.eventBus.emit("V2NIMMessageService/modifyMsg",g),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",g),_.abrupt("return",O(O({errorCode:200,message:g},h?{antispamResult:h}:{}),e?{clientAntispamResult:e}:{}));case 28:case"end":return _.stop()}},r,this)}))},p.checkIfAntispam=function(t,e){var r,i=e.text;if(t.clientAntispamEnabled&&(e.messageType===0||e.messageType===10)){if((r=this.core.V2NIMClientAntispamUtil.checkTextAntispam?this.core.V2NIMClientAntispamUtil.checkTextAntispam(e.text||"",t.clientAntispamReplace):{operateType:0,replacedText:""}).operateType===1)i=r.replacedText;else if(r.operateType===2)throw new Me({code:ce.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}})}return{clientAntispamResult:r,text:i}},p.generateSendMessage=function(t,e){var r;return O(O({messageConfig:{lastMessageUpdateEnabled:(r=t.messageConfig)===null||r===void 0?void 0:r.lastMessageUpdateEnabled},routeConfig:O({routeEnabled:!0},e.routeConfig),pushConfig:O({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},e.pushConfig),antispamConfig:O({antispamEnabled:!0},e.antispamConfig)},e.attachment?{attachment:e.attachment}:{}),{conversationType:t.conversationType,senderId:t.senderId,receiverId:t.receiverId,createTime:t.createTime,messageClientId:t.messageClientId,messageServerId:t.messageServerId,messageType:t.messageType,subType:e.subType,text:e.text,serverExtension:e.serverExtension})},a}(),iV=function(){function a(l,t){var e=this;this.emitRevokeMessage=function(r){var i=se(r).call(r,function(o){return D0(e.core,o)});ae(i).call(i,function(o){e.service.model.deleteMessage(o.messageRefer.messageClientId)}),e.service.emit("onMessageRevokeNotifications",i),e.core.eventBus.emit("V2NIMMessageService/revokeMessages",i)},this.core=l,this.service=t,this.logger=l.logger}var p=a.prototype;return p.revokeMessage=function(t,e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(P(uL,{message:t,params:e},"",!0),Nr(this.core.account,t.conversationId),t.conversationType!==1||t.senderId===this.core.account){C.next=6;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: p2p message senderId is not current user"}});case 6:if(t.messageServerId&&t.messageServerId!=="0"){C.next=8;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: cannot revoke message with invalid messageServerId: "+t.messageServerId}});case 8:return u=t.conversationType===3?"v2RevokeSuperTeamMessage":"v2RevokeMessage",(i={})[1]=7,i[2]=8,i[3]=12,h=i,g=O(O(O({},t),e),{attach:e&&e.serverExtension,sysMsgType:h[t.conversationType],opeAccount:this.core.account}),C.next=13,this.core.sendCmd(u,{tag:g});case 13:(o={})[1]=1,o[2]=2,o[3]=3,v=o,_=[JSON.parse(xe({postscript:e&&e.postscript,revokeType:v[t.conversationType],revokeAccountId:this.core.account,serverExtension:e&&e.serverExtension,messageRefer:Cs(this.core,t)}))],this.revokeMessagesFn(_),this.core.eventBus.emit("forwardSend/V2NIMMessageService/revokeMessage",g);case 17:case"end":return C.stop()}},r,this)}))},p.deleteMessage=function(t,e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(P(N0,t,"",!0),t.sendingState!==3){v.next=5;break}this.service.fileUtil.cancelMessageAttachmentUpload(t),v.next=7;break;case 5:if(!t.sendingState||t.sendingState===1){v.next=7;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: cannot delete unsent message"}});case 7:if(i={messageRefer:Cs(this.core,t),serverExtension:e},o=Dt(),!t.messageServerId||t.messageServerId==="0"){v.next=14;break}return v.next=12,this.core.sendCmd("v2DeleteMessage",{tag:i});case 12:u=v.sent,o=u.content.timetag;case 14:h=[{serverExtension:e,messageRefer:Cs(this.core,t),deleteTime:o}],this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",[O(O({},i),{deleteTime:o})]),this.deleteMessagesFn(h);case 17:case"end":return v.stop()}},r,this)}))},p.deleteMessages=function(t,e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_,I,C,A,N=this;return T.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(P(hL,{messages:t},"",!0),o=[],u=[],t.length!==0){j.next=7;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: message array length is 0"}});case 7:h=t[0].conversationId,g=0;case 9:if(!(g<t.length)){j.next=22;break}if(t[g].sendingState!==3){j.next=14;break}this.service.fileUtil.cancelMessageAttachmentUpload(t[g]),j.next=16;break;case 14:if(!t[g].sendingState||t[g].sendingState===1){j.next=16;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: sendingState should be succeeded, please check message at index: "+g}});case 16:if(!(g>=1&&t[g].conversationId!==h)){j.next=18;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: only allow to delete messages from same conversation"}});case 18:t[g].messageServerId&&t[g].messageServerId!=="0"?o.push(t[g]):u.push(t[g]);case 19:g++,j.next=9;break;case 22:if(v=Dt(),_=dt(i=[]).call(i,u),j.prev=24,!(o.length>0)){j.next=31;break}return j.next=28,this.core.sendCmd("v2DeleteMessages",{tag:se(o).call(o,function(W){return{messageRefer:W,serverExtension:e}})});case 28:C=j.sent,v=C.content.timetag,_=dt(I=[]).call(I,_,o);case 31:j.next=40;break;case 33:if(j.prev=33,j.t0=j.catch(24),u.length!==0){j.next=39;break}throw j.t0;case 39:this.logger.warn("V2NIMMessageService:deleteMessages: delete messages with serverId failed");case 40:A=se(_).call(_,function(W){return{serverExtension:e,messageRefer:Cs(N.core,W),deleteTime:v}}),this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",se(_).call(_,function(W){return{messageRefer:W,serverExtension:e,deleteTime:v}})),this.deleteMessagesFn(A);case 43:case"end":return j.stop()}},r,this,[[24,33]])}))},p.revokeMessagesFn=function(t){var e=this;ae(t).call(t,function(r){e.service.model.deleteMessage(r.messageRefer.messageClientId)}),this.service.emit("onMessageRevokeNotifications",t),this.core.eventBus.emit("V2NIMMessageService/revokeMessages",t)},p.deleteMessagesFn=function(t){var e=this;ae(t).call(t,function(r){e.service.model.deleteMessage(r.messageRefer.messageClientId)}),this.service.emit("onMessageDeletedNotifications",t),this.core.eventBus.emit("V2NIMMessageService/deleteMessages",t)},a}(),sV=function(){function a(l,t){this.core=l,this.service=t,this.logger=l.logger}var p=a.prototype;return p.stopAIStreamMessage=function(t,e){var r;return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkAI(),u.next=3,this.core.sendCmd("v2AIStopModelStreamCall",{tag:{serverId:t.messageServerId,clientId:t.messageClientId,type:t.conversationType,from:t.senderId,to:t.receiverId,aiAccount:(r=t.aiConfig)===null||r===void 0?void 0:r.accountId,opeType:e.operationType,updateContent:e.updateContent,messageTime:t.createTime}});case 3:this.logger.log("V2AIUtil::streamMessageStop,clientId:"+t.messageClientId),this.core.V2NIMAIService.model.completeAiStream(t.messageClientId);case 5:case"end":return u.stop()}},i,this)}))},p.regenAIMessage=function(t,e){var r,i,o,u,h,g,v,_;return k(this,void 0,void 0,T.mark(function I(){var C;return T.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(this.checkAI(),!(C=this.core.V2NIMAIService.model.getAiStream(t.messageClientId))){N.next=7;break}if(C!=null&&C.isComplete){N.next=5;break}throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"msg::regenAIMessage streamCache is not complete, msgId:"+t.messageClientId}});case 5:N.next=9;break;case 7:if(((r=t.aiConfig)===null||r===void 0?void 0:r.aiStreamStatus)!==-1&&((i=t.aiConfig)===null||i===void 0?void 0:i.aiStreamStatus)!==1){N.next=9;break}throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"msg::regenAIMessage message aiStreamStatus forbidden "+t.aiConfig.aiStreamStatus}});case 9:return N.next=11,this.core.sendCmd("v2AIRegenMessage",{tag:{fromAccount:t.senderId,to:t.receiverId,aiAccount:(o=t.aiConfig)===null||o===void 0?void 0:o.accountId,serverId:t.messageServerId,clientId:t.messageClientId,time:t.createTime,type:t.conversationType,opeType:e.operationType,replyMsgFromAccount:(u=t.threadReply)===null||u===void 0?void 0:u.senderId,replyMsgToAccount:(h=t.threadReply)===null||h===void 0?void 0:h.receiverId,replyMsgTime:(g=t.threadReply)===null||g===void 0?void 0:g.createTime,replyMsgIdServer:(v=t.threadReply)===null||v===void 0?void 0:v.messageServerId,replyMsgIdClient:(_=t.threadReply)===null||_===void 0?void 0:_.messageClientId}});case 11:e.operationType===1&&this.core.V2NIMAIService.model.setAiStream(t.messageClientId,{isComplete:!1,queryStatus:0,chunks:[]});case 12:case"end":return N.stop()}},I,this)}))},p.checkAI=function(){if(!this.hasAI())throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMAIService is not registered"}})},p.hasAI=function(){var t;return!!(!((t=this.core.V2NIMAIService)===null||t===void 0)&&t.name)},a}(),oV=function(){function a(l,t){this.core=l,this.service=t,this.model=t.model,this.receiptUtil=t.receiptUtil,this.logger=this.core.logger}var p=a.prototype;return p.setAIStreamPlaceholder=function(t){var e=this;this.service.aiUtil.hasAI()&&ae(t).call(t,function(r){var i;((i=r.aiConfig)===null||i===void 0?void 0:i.aiStreamStatus)===1&&e.core.V2NIMAIService.model.setAiStream(r.messageClientId,{isComplete:!1,queryStatus:0,chunks:[],msg:r},!0)})},p.onMsgHandler=function(t){var e=zi(t,t.content.msg,"messageServerId"),r=e._conversationOnlineSyncNotify,i=e._conversationOnlineSyncData,o=br(e,["_conversationOnlineSyncNotify","_conversationOnlineSyncData"]),u=pn(this.core,o),h=Xi(u,this.core);this.logger.log("v2OnMsgHandler::recvMsg "+h.messageClientId+" "+h.messageServerId),h.messageType!==5&&this.core.V2NIMUserService.checkUserUpdate&&this.core.V2NIMUserService.checkUserUpdate(h,h.userUpdateTime),!this.service.config.compatibleWithV1&&this.service.sendUtil.doMsgReceiveReport(h,t),delete h.__clientExt,this.service.emit("onReceiveMessages",[h]),this.model.upsertMessages([h]),this.setAIStreamPlaceholder([h]),!this.service.config.compatibleWithV1&&this.service.markMsgsAck([h]),r&&this.core.eventBus.emit("V2NIMConversationService/conversationOnlineSyncNotify",{content:{info:JSON.parse(r),data:JSON.parse(i)}},h),h.messageType===5&&this.core.eventBus.emit("V2NIMTeamService/notification",u),this.core.eventBus.emit("V2NIMMessageService/onMsg",h)},p.syncOfflineMsgsHandler=function(t){var e=this,r=t.content.datas,i=se(r).call(r,function(o){return Xi(pn(e.core,o),e.core)});!this.service.config.compatibleWithV1&&this.service.markMsgsAck(i),this.service.emit("onReceiveMessages",i),this.model.upsertMessages(i),this.core.eventBus.emit("V2NIMMessageService/offlineMsgs",i)},p.syncRoamingMsgsHandler=function(t){var e=this,r=t.content.datas;r=se(r).call(r,function(i){return Xi(pn(e.core,i),e.core)}),this.setAIStreamPlaceholder(r),this.service.emit("onReceiveMessages",r),this.model.upsertMessages(r),this.core.eventBus.emit("V2NIMMessageService/roamingMsgs",r)},p.onP2PMessageReceiptsHandler=function(t){this.receiptUtil.onP2PMessageReceiptsHandler(t)},p.onTeamMessageReceiptsHandler=function(t){this.receiptUtil.onTeamMessageReceiptsHandler(t)},p.syncP2PMessagReceiptsHandler=function(t){this.receiptUtil.syncP2PMessagReceiptsHandler(t)},p.syncRevokeMessageHandler=function(t){this.service.deleteUtil.emitRevokeMessage(t.content.datas)},p.onRevokeMessageHandler=function(t){var e=t.content.data;this.service.deleteUtil.emitRevokeMessage([e])},p.onDeleteMessageHandler=function(t){var e=t.content.data,r={serverExtension:e.serverExtension,deleteTime:e.deleteTime,messageRefer:Nl(this.core,e.messageRefer)};this.service.deleteUtil.deleteMessagesFn([r])},p.onDeleteMessagesHandler=function(t){var e,r=this,i=se(e=t.content.data).call(e,function(o){return{serverExtension:o.serverExtension,deleteTime:o.deleteTime,messageRefer:Nl(r.core,o.messageRefer)}});this.service.deleteUtil.deleteMessagesFn(i)},p.syncOnDeleteMessagesHandler=function(t){var e=this,r=t.content.datas,i=se(r).call(r,function(o){return{serverExtension:o.serverExtension,deleteTime:o.deleteTime,messageRefer:Nl(e.core,o.messageRefer)}});this.service.emit("onMessageDeletedNotifications",i)},p.v2MessageOnModifiedHandler=function(t){var e=pn(this.core,t.content.data);this.model.upsertMessages([e]),this.service.aiUtil.hasAI()&&this.core.V2NIMAIService.model.completeAiStream(e.messageClientId),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",e),this.core.eventBus.emit("V2NIMMessageService/modifyMsg",e),this.service.emit("onReceiveMessagesModified",[e])},p.v2MessageSyncModifiedHandler=function(t){var e,r,i=this,o=at(e=se(r=t.content.datas).call(r,function(u){return pn(i.core,u)})).call(e,function(u){var h,g=((h=i.model.getMessageById(u.messageClientId))===null||h===void 0?void 0:h.modifyTime)||0;return(u.modifyTime||0)>g});o.length>0&&(this.model.upsertMessages(o),ae(o).call(o,function(u){i.service.aiUtil.hasAI()&&i.core.V2NIMAIService.model.completeAiStream(u.messageClientId),i.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",u)}),this.service.emit("onReceiveMessagesModified",o))},p.v2MessageSyncSuperTeamModifiedHandler=function(t){this.v2MessageSyncModifiedHandler(t)},a}(),aV=function(){function a(l,t){this.core=l,this.service=t,this.logger=this.core.logger}var p=a.prototype;return p.setListener=function(){var t,e,r,i=this;this.core.eventBus.on("forwardReceive/V2NIMMessageService/sendMsg",et(t=this.service.sendMessageFn).call(t,this.service)),this.core.eventBus.on("forwardReceive/V2NIMMessageService/revokeMessages",et(e=this.service.deleteUtil.emitRevokeMessage).call(e,this.service.deleteUtil)),this.core.eventBus.on("forwardReceive/V2NIMMessageService/deleteMessages",et(r=this.service.deleteUtil.deleteMessagesFn).call(r,this.service.deleteUtil)),this.core.eventBus.on("V2NIMConversationService/deleteConversation",function(o){ae(o).call(o,function(u){return i.service.model.deleteMessages(u)})}),this.core.eventBus.on("V2NIMAIService/receiveMessagesModified",function(o){return i.service.emit("onReceiveMessagesModified",o)})},p.beforeEmit=function(t){for(var e,r,i,o=this.service.name+"::emit "+t.toString(),u=arguments.length,h=new Array(u>1?u-1:0),g=1;g<u;g++)h[g-1]=arguments[g];if(t==="onSendMessage"){var v=h[0];this.logger.log(""+o,v.messageClientId+"/"+v.messageServerId+"/"+v.createTime+";","sendingState:"+v.sendingState+";attachmentUploadState:"+(v.attachmentUploadState||0)+";messageStatus:"+((e=v.messageStatus)===null||e===void 0?void 0:e.errorCode)+";config.lastMsg:"+((r=v.messageConfig)===null||r===void 0?void 0:r.lastMessageUpdateEnabled)+";config.unread:"+((i=v.messageConfig)===null||i===void 0?void 0:i.unreadEnabled))}else if(t==="onReceiveMessages"||t==="onReceiveMessagesModified"){var _=h[0];this.logger.log(""+o,se(_).call(_,function(F){var j,W;return F.messageClientId+"/"+F.messageServerId+"/"+F.createTime+";config.lastMsg:"+((j=F.messageConfig)===null||j===void 0?void 0:j.lastMessageUpdateEnabled)+";config.unread:"+((W=F.messageConfig)===null||W===void 0?void 0:W.unreadEnabled)}))}else if(t==="onMessageRevokeNotifications"){var I=h[0];this.logger.log(""+o,se(I).call(I,function(F){return"msg:"+F.messageRefer.messageClientId+"/"+F.messageRefer.messageServerId+";revokeAccountId:"+F.revokeAccountId}))}else if(t==="onMessageDeletedNotifications"){var C=h[0];this.logger.log(""+o,se(C).call(C,function(F){return"msg:"+F.messageRefer.messageClientId+"/"+F.messageRefer.messageServerId+";deleteTime:"+F.deleteTime}))}else{var A,N;(A=this.logger).log.apply(A,dt(N=[""+o]).call(N,h))}},a}(),oE=function(a){function p(t,e){var r;return e===void 0&&(e={}),(r=a.call(this,"V2NIMMessageService",t)||this).customAttachmentParsers=[],r.config={compatibleWithV1:!0},r.core._registerDep(la,"V2NIMConversationIdUtil"),r.core._registerDep(tE,"V2NIMMessageCreator"),r.core._registerDep(rE,"V2NIMMessageAttachmentCreator"),r.core._registerDep(nE,"V2NIMClientAntispamUtil"),r.receiptUtil=new PL(r.core,Ot(r)),r.fileUtil=new U0(r.core),r.sendUtil=new sE(r.core,Ot(r)),r.modifyUtil=new nV(r.core,Ot(r)),r.deleteUtil=new iV(r.core,Ot(r)),r.aiUtil=new sV(r.core,Ot(r)),r.model=new S0,r.event=new aV(r.core,Ot(r)),r.handler=new oV(r.core,Ot(r)),r.core.options.apiVersion!=="v2"?Ot(r):(Kt({cmdMap:BL,cmdConfig:qL}),r.setOptions(e),r.setListener(),r)}bt(p,a);var l=p.prototype;return l.setOptions=function(e){var r;!((r=this.core.msg)===null||r===void 0)&&r.name?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=O(this.config,e)},l.setListener=function(){this.event.setListener()},l.reset=function(){this.model.reset(),this.receiptUtil.reset()},l.emit=function(e){for(var r,i,o,u,h=arguments.length,g=new Array(h>1?h-1:0),v=1;v<h;v++)g[v-1]=arguments[v];return(r=this.event).beforeEmit.apply(r,dt(i=[e]).call(i,g)),(o=a.prototype.emit).call.apply(o,dt(u=[this,e]).call(u,g))},l.checkExtendUtil=function(){var e;if(!(!((e=this.core.V2NIMMessageExtendUtil)===null||e===void 0)&&e.name))throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMMessageLogUtil is not registered"}})},l.checkLogUtil=function(){var e;if(!(!((e=this.core.V2NIMMessageLogUtil)===null||e===void 0)&&e.name))throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMMessageExtendUtil is not registered"}})},l.getMessageList=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.getMessageList(e)},l.getMessageListByRefers=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.getMessageListByRefers(e)},l.clearHistoryMessage=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.clearHistoryMessage(e)},l.pinMessage=function(e,r){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.pinMessage(e,r)},l.unpinMessage=function(e,r){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.unpinMessage(e,r)},l.updatePinMessage=function(e,r){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.updatePinMessage(e,r)},l.voiceToText=function(e){return this.checkV2(),this.checkExtendUtil(),typeof e.duration=="string"&&(e.duration=Number(e.duration)),this.core.V2NIMMessageExtendUtil.voiceToText(e)},l.getPinnedMessageList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getPinnedMessageList(e)},l.addQuickComment=function(e,r,i,o){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.addQuickComment(e,r,i,o)},l.removeQuickComment=function(e,r,i){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.removeQuickComment(e,r,i)},l.getQuickCommentList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getQuickCommentList(e)},l.addCollection=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.addCollection(e)},l.removeCollections=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.removeCollections(e)},l.updateCollectionExtension=function(e,r){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.updateCollectionExtension(e,r)},l.getCollectionListByOption=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getCollectionListByOption(e)},l.getCollectionListExByOption=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getCollectionListExByOption(e)},l.searchCloudMessages=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.searchCloudMessages(e)},l.searchCloudMessagesEx=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.searchCloudMessagesEx(e)},l.getThreadMessageList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getThreadMessageList(e)},l.registerCustomAttachmentParser=function(e){var r;typeof e=="function"&&wt(r=this.customAttachmentParsers).call(r,e)===-1&&this.customAttachmentParsers.unshift(e)},l.unregisterCustomAttachmentParser=function(e){var r,i,o=wt(r=this.customAttachmentParsers).call(r,e);o>-1&&wn(i=this.customAttachmentParsers).call(i,o,1)},l.sendP2PMessageReceipt=function(e){return this.checkV2(),this.receiptUtil.sendP2PMessageReceipt(e)},l.isPeerRead=function(e){return this.checkV2(),this.receiptUtil.isPeerRead(e)},l.getP2PMessageReceipt=function(e){return this.checkV2(),this.receiptUtil.getP2PMessageReceipt(e)},l.getTeamMessageReceipts=function(e){return this.checkV2(),this.receiptUtil.getTeamMessageReceipts(e)},l.getTeamMessageReceiptDetail=function(e){return this.checkV2(),this.receiptUtil.getTeamMessageReceiptDetail(e)},l.sendTeamMessageReceipts=function(e){return this.checkV2(),this.receiptUtil.sendTeamMessageReceipts(e)},l.revokeMessage=function(e,r){return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkV2(),u.abrupt("return",this.deleteUtil.revokeMessage(e,r));case 2:case"end":return u.stop()}},i,this)}))},l.deleteMessage=function(e,r){return this.checkV2(),this.deleteUtil.deleteMessage(e,r)},l.deleteMessages=function(e,r){return this.checkV2(),this.deleteUtil.deleteMessages(e,r)},l.cancelMessageAttachmentUpload=function(e){return this.checkV2(),this.fileUtil.cancelMessageAttachmentUpload(e)},l.markMsgsAck=function(e){var r=this;if(e&&e.length>0){var i=[],o=[];ae(e).call(e,function(u){u.senderId===r.core.account&&u.senderId!==u.receiverId||(u.conversationType===1?i.push(u):u.conversationType===2&&o.push(u))}),i.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:2,ids:se(i).call(i,function(u){return u.messageServerId})}),o.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:8,cid:3,ids:se(o).call(o,function(u){return u.messageServerId})})}},l.sendMessage=function(e,r,i,o){var u;return i===void 0&&(i={}),k(this,void 0,void 0,T.mark(function h(){var g,v,_,I,C,A,N,F,j=this;return T.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(this.checkV2(),P({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||jr(),!e.conversationId||e.conversationId===r){U.next=5;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message.conversationId is not equal to conversationId"}});case 5:if(P(R0,{conversationId:r,message:e,params:i},"",!0),Nr(this.core.account,r),(g=this.core.V2NIMConversationIdUtil.parseConversationType(r))!==2&&g!==3||!i.robotConfig||i.robotConfig.accountId){U.next=10;break}throw new Qi({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});case 10:if(g!==2&&g!==3||!i.targetConfig){U.next=20;break}if(v=i.targetConfig.receiverIds,g!==3||i.targetConfig.inclusive!==!1){U.next=14;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"setting inclusive to false for super teams is not allowed"}});case 14:if(v=at(v).call(v,function(ie){return ie&&ie!==j.core.account}),v.length!==0){U.next=17;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"receiverIds cannot be empty or only contain yourself"}});case 17:i.targetConfig.receiverIds=v,U.next=21;break;case 20:i.targetConfig=void 0;case 21:return!((u=i.aiConfig)===null||u===void 0)&&u.aiStream&&this.aiUtil.checkAI(),_=this.core.timeOrigin.getTimeNode(),I=this.sendUtil.prepareMessage(e,r,i),C=I.messageBeforeSend,A=I.clientAntispamResult,N=I.hiddenParams,this.logger.log("V2SendMessage start:"+C.messageClientId+"/"+C.createTime+";conversation:"+r+";","NTPTime:"+this.core.timeOrigin.getNTPTime(_)),U.prev=25,U.next=28,this.sendUtil.doSendMessage({apiCallingTimeNode:_,messageBeforeSend:C,clientAntispamResult:A,hiddenParams:N,progress:o});case 28:F=U.sent,U.next=35;break;case 31:throw U.prev=31,U.t0=U.catch(25),this.logger.warn("V2SendMessage end:"+C.messageClientId+".",U.t0 instanceof Me?"failed:"+U.t0.code:"failed"),U.t0;case 35:return F.message.senderId===F.message.receiverId&&this.markMsgsAck([F.message]),this.logger.log("V2SendMessage end:"+F.message.messageClientId+"/"+F.message.messageServerId+"/"+F.message.createTime),U.abrupt("return",F);case 38:case"end":return U.stop()}},h,this,[[25,31]])}))},l.replyMessage=function(e,r,i,o){return i===void 0&&(i={}),k(this,void 0,void 0,T.mark(function u(){var h,g,v,_,I,C;return T.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(this.checkV2(),P({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||jr(),P(lL,{message:e,replyMessage:r,params:i},"",!0),Nr(this.core.account,r.conversationId),e.conversationType!==2&&e.conversationType!==3||!i.robotConfig||i.robotConfig.accountId){N.next=7;break}throw new Qi({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});case 7:return h=this.core.timeOrigin.getTimeNode(),g=this.sendUtil.prepareMessage(e,r.conversationId,i,r),v=g.messageBeforeSend,_=g.clientAntispamResult,I=g.hiddenParams,N.next=11,this.sendUtil.doSendMessage({apiCallingTimeNode:h,messageBeforeSend:v,clientAntispamResult:_,hiddenParams:I,progress:o});case 11:return(C=N.sent).message.senderId===C.message.receiverId&&this.markMsgsAck([C.message]),N.abrupt("return",C);case 14:case"end":return N.stop()}},u,this)}))},l.modifyMessage=function(e,r){this.checkV2(),this.checkLogin(),P(kL,e,"message",!0),P(OL,r,"params",!0),this.modifyUtil.checkIfModify(e,r);var i=this.modifyUtil.prepareMessage(e,r),o=i.messageBeforeSend,u=i.clientAntispamResult;return this.modifyUtil.modifyMessage(o,u)},l.stopAIStreamMessage=function(e,r){if(this.checkV2(),this.aiUtil.checkAI(),P(w0,e,"message",!0),P(wL,r,"params",!0),r.operationType===2&&!r.updateContent)throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"V2NIMMessage::stopAIStreamMessage updateContent empty"}});return this.aiUtil.stopAIStreamMessage(e,r)},l.regenAIMessage=function(e,r){return this.checkV2(),this.aiUtil.checkAI(),P(w0,e,"message",!0),P(xL,r,"params",!0),this.aiUtil.regenAIMessage(e,r)},l.sendMessageFn=function(e){if(e.msgAckSnapshot){var r=e.msgAckSnapshot,i={conversationId:e.conversationId,messageServerId:e.messageServerId,messageClientId:e.messageClientId,readCount:0,unreadCount:Number(r)};delete e.msgAckSnapshot,this.emit("onReceiveTeamMessageReadReceipts",[i])}e=Xi(e,this.core),this.model.upsertMessages([e]),this.core.eventBus.emit("V2NIMMessageService/sendMessage",e,e.sendingState)},p}($r),cV={super_team:3,p2p:1,team:2},lV=((Ol={})[3]="super_team",Ol[1]="p2p",Ol[0]="p2p",Ol[2]="team",Ol);function Fd(a,p){p===void 0&&(p="|");var l=wt(a).call(a,p);if(l===-1)return{target:"",type:0};var t=ht(a).call(a,0,l);return{target:ht(a).call(a,l+1),type:cV[t]||0}}function uV(a,p){return lV[a]+"|"+p}var dV=function(){function a(){this.map=new Dr,this.capacity=1e4,this.readTimeMap=new Dr,this.stickTopMap=new Dr}var p=a.prototype;return p.reset=function(){se(this).clear(),this.readTimeMap.clear(),this.stickTopMap.clear()},p.count=function(){return se(this).size},p.sort=function(){var t,e=this,r=vr(fi(t=se(this)).call(t));Tr(r).call(r,function(i,o){return o.sortOrder-i.sortOrder}),se(this).clear(),ae(r).call(r,function(i){se(e).set(i.conversationId,i)})},p.processConversation=function(t){return typeof t.lastMessage=="string"&&delete t.lastMessage,t.localExtension===void 0&&(t.localExtension=""),t},p.getById=function(t){return se(this).get(t)},p.getAll=function(){var t,e=vr(fi(t=se(this)).call(t));return Tr(e).call(e,function(r,i){return i.sortOrder-r.sortOrder})},p.getByOption=function(t,e,r){var i,o=r.conversationTypes,u=r.onlyUnread,h=[];ae(i=se(this)).call(i,function(_){o&&o.length>0&&!_t(o).call(o,_.type)||u&&!_.unreadCount||r.ignoreMuted&&_.mute||h.push(_)}),h=Tr(h).call(h,function(_,I){return I.sortOrder-_.sortOrder});var g=0;t>0&&(g=eg(h,"sortOrder",t),h[g]&&h[g].sortOrder===t&&(g+=1));var v=ht(h).call(h,g).length;return(h=ht(h).call(h,g,g+e)).length>0?{offset:v>e?h[h.length-1].sortOrder:0,finished:!(v>e),conversationList:h}:{offset:0,finished:!0,conversationList:h}},p.upsert=function(t){var e=t.conversationId,r=se(this).get(e);if(!r){var i=this.processConversation(O({stickTop:this.getStickTop(e),localExtension:"",lastMessage:null,unreadCount:0,sortOrder:0,createTime:0,updateTime:0},t));return this.setLRU(e,i),i.unreadCount>0}var o=t.unreadCount!==r.unreadCount,u=O({},r,t);return u=this.processConversation(u),this.setLRU(e,u),o},p.setLRU=function(t,e){if(se(this).has(t))se(this).delete(t);else if(se(this).size>=this.capacity){var r,i=Pd(r=se(this)).call(r).next().value;i&&se(this).delete(i)}se(this).set(t,e)},p.bulkUpsert=function(t){var e=this,r=!1;return ae(t).call(t,function(i){e.upsert(i)&&(r=!0)}),r},p.deleteById=function(t){var e=this.getById(t);if(e)return se(this).delete(t),e},p.updateReadTime=function(t,e){this.readTimeMap.set(t,e)},p.getReadTime=function(t){return this.readTimeMap.get(t)||0},p.updateStickTop=function(t,e){e?this.stickTopMap.set(t,!0):this.stickTopMap.delete(t)},p.getStickTop=function(t){return this.stickTopMap.get(t)||!1},a}(),pV={"4_14":"v2LocalConvSyncReadTime","4_20":"v2LocalConvSyncSuperTeamReadTime","4_22":"v2LocalConvSyncMoreRoaming","4_23":"v2LocalConvSyncStickTop","4_25":"v2LocalConvSyncReliableInfo","7_16":"v2LocalConvMarkReadTime","7_25":"v2LocalConvMultiMarkReadTime","7_116":"v2LocalConvMultiSyncReadTime","21_25":"v2LocalConvSuperTeamMarkReadTime","21_32":"v2LocalConvSuperTeamMultiMarkReadTime","21_125":"v2LocalConvSuperTeamMultiSyncReadTime","33_12":"v2LocalConvStickTopAdd","33_13":"v2LocalConvStickTopDelete","23_112":"v2LocalConvStickTopMultiSyncAdd","23_113":"v2LocalConvStickTopMultiSyncDelete","23_114":"v2LocalConvStickTopMultiSyncUpdate"},In="V2NIMLocalConversationService",fa={id:1,ext:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},aE={scene:1,to:2,timetag:3},hV={v2LocalConvSyncReadTime:{sid:4,cid:14,service:In,response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},v2LocalConvSyncSuperTeamReadTime:{sid:4,cid:20,service:In,response:[{type:"LongLongMap",name:"superTeam"}]},v2LocalConvSyncMoreRoaming:{sid:4,cid:22,service:In,response:[]},v2LocalConvSyncStickTop:{sid:4,cid:23,service:In,response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:Te(fa)}]},v2LocalConvSyncReliableInfo:{sid:4,cid:25,service:In,response:[]},v2LocalConvMarkReadTime:{sid:7,cid:16,service:In,params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvMultiMarkReadTime:{sid:7,cid:25,service:In,ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"tags",reflectMapper:aE}]},v2LocalConvMultiSyncReadTime:{sid:7,cid:116,service:In,response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvSuperTeamMarkReadTime:{sid:21,cid:25,service:In,params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvSuperTeamMultiMarkReadTime:{sid:21,cid:32,service:In,ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"tags",reflectMapper:aE}]},v2LocalConvSuperTeamMultiSyncReadTime:{sid:21,cid:125,service:In,response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvStickTopAdd:{sid:33,cid:12,service:In,params:[{type:"Property",name:"tag",reflectMapper:fa}],response:[{type:"Property",name:"data",reflectMapper:Te(fa)}]},v2LocalConvStickTopDelete:{sid:33,cid:13,service:In,params:[{type:"Property",name:"tag",reflectMapper:fa}],response:[{type:"Long",name:"timetag"}]},v2LocalConvStickTopMultiSyncAdd:{sid:23,cid:112,service:In,response:[{type:"Property",name:"data",reflectMapper:Te(fa)}]},v2LocalConvStickTopMultiSyncDelete:{sid:23,cid:113,service:In,response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:Te(fa)}]},v2LocalConvStickTopMultiSyncUpdate:{sid:23,cid:114,service:In,response:[{type:"Property",name:"data",reflectMapper:Te(fa)}]}};function Zi(a,p){a=a||[],p=p||1,p=Math.max(Math.floor(p),1);for(var l=[],t=0;t<a.length;t+=p)l.push(ht(a).call(a,t,t+p));return l}function cE(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return lE(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?lE(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lE(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}var fV=function(){function a(l,t){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.core=l,this.service=t,this.model=t.model,this.logger=t.logger}var p=a.prototype;return p.reset=function(){this.totalUnreadCount=void 0,this.unreadCountByFilter={}},p.getTotalUnreadCount=function(){return this.totalUnreadCount},p.resetTotalAfterSyncDone=function(){var t,e=Cr(t=this.service.model.getAll()).call(t,function(i,o){return i+(o.unreadCount||0)},0),r=this.totalUnreadCount;return r!==void 0&&r===e||(this.totalUnreadCount=e,this.service.emit("onTotalUnreadCountChanged",e)),e},p.digestUnreadCountChange=function(){this._digest()},p._digest=function(){var t,e=this,r=this.totalUnreadCount,i=Cr(t=this.service.model.getAll()).call(t,function(u,h){return u+(h.unreadCount||0)},0);this.core.logger.log("V2NIMConversation::digestUnreadCountChange:oldUnreadCount "+r+", newUnreadCount "+i),r!==i&&(this.totalUnreadCount=i,this.service.emit("onTotalUnreadCountChanged",i));var o=pt(this.unreadCountByFilter);ae(o).call(o,function(u){var h=JSON.parse(u),g=e.getUnreadCountByFilter(h),v=e.unreadCountByFilter[u];e.unreadCountByFilter[u]=g,h.equals=et(uE).call(uE,h),v!==g&&e.service.emit("onUnreadCountChangedByFilter",h,g)})},p.clearUnreadCount=function(t){var e=this,r=Cr(t).call(t,function(o,u){return e.service.model.upsert({conversationId:u.conversationId,type:u.type,unreadCount:0})&&o.push(u.conversationId),o},[]);if(r.length>0){var i=se(r).call(r,function(o){return e.service.model.getById(o)});this.service.triggerConversationChanged(i),this.digestUnreadCountChange()}},p.getUnreadCountByIds=function(t){var e=this;return t=po(t),Cr(t).call(t,function(r,i){var o=e.service.model.getById(i);return r+(o&&o.unreadCount||0)},0)},p.getUnreadCountByFilter=function(t){var e,r=this.service.model.count(),i=this.service.model.getByOption(0,r,{conversationTypes:t.conversationTypes,ignoreMuted:t.ignoreMuted});return Cr(e=i.conversationList).call(e,function(o,u){return o+(u.unreadCount||0)},0)},p.isMessageUnread=function(t,e){var r;return e===void 0&&(e=0),t.createTime>e&&t.senderId!==this.core.account&&t.messageStatus.errorCode===200&&((r=t.messageConfig)===null||r===void 0?void 0:r.unreadEnabled)!==!1},p.isMessageReferUnread=function(t,e){e===void 0&&(e=0);var r=this.core.V2NIMMessageService.model.getMessageById(t.messageClientId);return r?this.isMessageUnread(r,e):t.createTime>e&&t.senderId!==this.core.account},p.countUnreadByMessageInMemory=function(t,e){var r=this;e===void 0&&(e=0);var i=0,o=this.core.V2NIMMessageService.model.getMessagesByConversationId(t);return ae(o).call(o,function(u){r.isMessageUnread(u,e)&&i++}),i},p.addFilter=function(t){var e=Cg(t);if(this.unreadCountByFilter[e]!==void 0)throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST});var r=JSON.parse(e),i=this.getUnreadCountByFilter(r);this.unreadCountByFilter[e]=i,this.service.emit("onUnreadCountChangedByFilter",r,i)},p.deleteFilter=function(t){var e=Cg(t);if(this.unreadCountByFilter[e]===void 0)throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});delete this.unreadCountByFilter[e]},p.markConversationRead=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(r=this.model.getById(t),i=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t),o=this.core.V2NIMConversationIdUtil.parseConversationType(t),u=this.model.getReadTime(t),r){v.next=6;break}return v.abrupt("return",u||this.core.timeOrigin.getNTPTime());case 6:if(h=this.service.compute.computeReadTimeForMark(r),!(u>=h)){v.next=10;break}return this.logger.log("V2LocalConv::markConversationRead currentReadTime >= readTime "+t+","+u+","+h),v.abrupt("return",u);case 10:if(o!==3){v.next=15;break}return v.next=13,this.core.sendCmd("v2LocalConvSuperTeamMarkReadTime",{timetag:h,to:i});case 13:v.next=17;break;case 15:return v.next=17,this.core.sendCmd("v2LocalConvMarkReadTime",{scene:o===1?0:o===2?1:2,timetag:h,to:i});case 17:return this.model.updateReadTime(t,h),v.abrupt("return",h);case 19:case"end":return v.stop()}},e,this)}))},p.markMultiConversationRead=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g,v,_,I,C,A=this;return T.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:r={cmd:"v2LocalConvSuperTeamMultiMarkReadTime",params:[]},i={cmd:"v2LocalConvMultiMarkReadTime",params:[]},ae(t).call(t,function(j){var W=A.model.getById(j);if(W){var U=A.core.V2NIMConversationIdUtil.parseConversationTargetId(j),ie=A.core.V2NIMConversationIdUtil.parseConversationType(j),te=A.model.getReadTime(j),H=A.service.compute.computeReadTimeForMark(W);if(!(te>=H)){var V={conversationId:j,scene:ie===1?0:ie===2?1:2,timetag:H,to:U};ie===3?r.params.push(V):i.params.push(V)}}}),o=Zi(r.params,50),u=Zi(i.params,50),h=cE(o);case 6:if((g=h()).done){F.next=19;break}return v=g.value,F.prev=8,F.next=11,this.core.sendCmd(r.cmd,{tags:v});case 11:F.next=16;break;case 13:F.prev=13,F.t0=F.catch(8),this.logger.warn("markMultiConversationRead::error:",se(v).call(v,function(j){return j.conversationId}),F.t0);case 16:ae(v).call(v,function(j){A.model.updateReadTime(j.conversationId,j.timetag)});case 17:F.next=6;break;case 19:_=cE(u);case 20:if((I=_()).done){F.next=33;break}return C=I.value,F.prev=22,F.next=25,this.core.sendCmd(i.cmd,{tags:C});case 25:F.next=30;break;case 27:F.prev=27,F.t1=F.catch(22),this.logger.warn("markMultiConversationRead::error:",se(C).call(C,function(j){return j.conversationId}),F.t1);case 30:ae(C).call(C,function(j){A.model.updateReadTime(j.conversationId,j.timetag)});case 31:F.next=20;break;case 33:case"end":return F.stop()}},e,this,[[8,13],[22,27]])}))},a}();function Cg(a){var p=a.conversationTypes;return p&&(p=Tr(p).call(p)),xe({conversationGroupId:a.conversationGroupId,conversationTypes:p,ignoreMuted:a.ignoreMuted})}function uE(a){return xe(this)===Cg(a)}var dE,mV={type:{type:"number"},lastMessageState:{type:"number"},unreadCount:{type:"number"},stickTop:{type:"boolean"},sortOrder:{type:"number"},version:{type:"number"},deleteFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function pc(a,p){return p&&p.length>0?se(p).call(p,function(l){return Bd(a,l)}):[]}function As(a,p,l,t){var e,r;l===void 0&&(l=0);var i=p=Xi(p,a),o=i.messageType,u=i.subType,h=i.text,g=i.attachment,v=i.serverExtension,_="";if(p.senderId!==a.account&&o!==5){_=Pe(p,"fromNick");var I=(r=(e=a.V2NIMFriendService)===null||e===void 0?void 0:e.model)===null||r===void 0?void 0:r.getFriend(p.senderId);I&&I.alias&&(_=I.alias)}return JSON.parse(xe({lastMessageState:l,messageRefer:Cs(a,p),messageType:o,subType:u,text:h,attachment:g,serverExtension:v,callbackExtension:p.callbackExtension,sendingState:t,senderName:_}))}function Bd(a,p){var l=Yt(mV,p);if(l.groupIds?l.groupIds=JSON.parse(l.groupIds):delete l.groupIds,typeof l.lastMessage=="string"&&l.lastMessage!=="")if(l.lastMessageState===1){var t=D0(a,xt(JSON.parse(l.lastMessage),Te(da)));l.lastMessage=function(i,o){var u=o.messageRefer,h=o.revokeAccountId,g=o.revokeType,v=o.callbackExtension,_=o.serverExtension,I=o.postscript,C=function(N,F,j,W){var U,ie,te,H,V,w,Y,re;if(F!==N.account){var ee=(ie=(U=N.V2NIMFriendService)===null||U===void 0?void 0:U.model)===null||ie===void 0?void 0:ie.getFriend(F);if(ee&&ee.alias)return ee.alias;if(j===2){var pe=(H=(te=N.V2NIMTeamService)===null||te===void 0?void 0:te.memberModel)===null||H===void 0?void 0:H.getById(W,1,F);if(pe&&pe.teamNick)return pe.teamNick}else if(j===3){var ye=(w=(V=N.V2NIMTeamService)===null||V===void 0?void 0:V.memberModel)===null||w===void 0?void 0:w.getById(W,1,F);if(ye&&ye.teamNick)return ye.teamNick}var Q=(re=(Y=N.V2NIMUserService)===null||Y===void 0?void 0:Y.model)===null||re===void 0?void 0:re.getUser(F);return Q&&Q.name?Q.name:void 0}}(i,o.revokeAccountId,o.messageRefer.conversationType,o.messageRefer.receiverId)||"";return JSON.parse(xe({lastMessageState:1,messageRefer:u,revokeAccountId:h,revokeType:g,callbackExtension:v,serverExtension:_,text:I||"",senderName:C}))}(a,t)}else if(l.lastMessageState===0){var e=xt(JSON.parse(l.lastMessage),Te(Rt));l.lastMessage=As(a,e,l.lastMessageState,e.senderId===a.account?1:void 0)}else l.lastMessageState===2&&delete l.lastMessage;return l}function pE(a){var p=a.version,l=a.deleteFlag;return{conversation:br(a,["version","deleteFlag"]),version:p,deleteFlag:l}}(function(a){a[a.createConversation=1]="createConversation",a[a.deleteConversation=2]="deleteConversation",a[a.updateConversation=3]="updateConversation",a[a.setConversationTop=4]="setConversationTop",a[a.clearConversationUnread=5]="clearConversationUnread",a[a.addConversationToGroup=6]="addConversationToGroup",a[a.removeConversationFromGroup=7]="removeConversationFromGroup",a[a.modifyConversationOnSendMessage=8]="modifyConversationOnSendMessage",a[a.modifyConversationOnDeleteMessage=9]="modifyConversationOnDeleteMessage",a[a.modifyConversationOnRecallMessage=10]="modifyConversationOnRecallMessage",a[a.modifyConversationOnClearMessage=11]="modifyConversationOnClearMessage",a[a.oneClickClearConversationUnread=12]="oneClickClearConversationUnread",a[a.modifyConversationOnUpdateMessage=13]="modifyConversationOnUpdateMessage"})(dE||(dE={}));var gV={type:{type:"number"},oneClickClearUnreadType:{type:"number"},oneClickClearUnreadConversationType:{type:"object"},oneClickClearUnreadVersion:{type:"number"},deleteConversationClearMessage:{type:"boolean"}};function bg(a){return Yt(gV,a)}var vV=function(){function a(l,t){this.core=l,this.service=t}var p=a.prototype;return p.computeFromExternal=function(t){var e,r,i;if(t.type===0)return t;var o=this.core.V2NIMConversationIdUtil.parseConversationType(t.conversationId),u=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t.conversationId),h={};if(!((e=this.core.V2NIMSettingService)===null||e===void 0)&&e.name&&(h.mute=this.core.V2NIMSettingService.getConversationMuteStatus(t.conversationId)),o===1&&this.hasUserService){var g,v=this.core.V2NIMUserService.model.getUser(u),_=this.hasFriendService?this.core.V2NIMFriendService.model.getFriend(u):void 0;t.conversationId===((r=t.lastMessage)===null||r===void 0?void 0:r.messageRefer.conversationId)&&(g=(i=t.lastMessage)===null||i===void 0?void 0:i.senderName),h.name=(_==null?void 0:_.alias)||(v==null?void 0:v.name)||g||u,h.avatar=(v==null?void 0:v.avatar)||""}else if(o===2&&this.hasTeamService){var I=this.core.V2NIMTeamService.model.getById(u,1);h.name=(I==null?void 0:I.name)||u,h.avatar=(I==null?void 0:I.avatar)||""}else if(o===3&&this.hasTeamService){var C=this.core.V2NIMTeamService.model.getById(u,2);h.name=(C==null?void 0:C.name)||u,h.avatar=(C==null?void 0:C.avatar)||""}return O(t,h),t},p.computeSortOrder=function(t,e){return e?t?e+1e15:e:t?1e15:0},p.computeReadTimeForMark=function(t){var e,r,i,o=t.conversationId,u=this.service.model.getReadTime(o);if(!((r=(e=t==null?void 0:t.lastMessage)===null||e===void 0?void 0:e.messageRefer)===null||r===void 0)&&r.createTime)i=t.lastMessage.messageRefer.createTime;else{if(t.unreadCount===0&&u>0)return u;if(!this.core.timeOrigin.checkNodeReliable())return u||0;i=this.core.timeOrigin.getNTPTime()}return i},p.computeConvWithLastMsg=function(t,e){var r,i=e||this.core.V2NIMMessageService.model.getLastMessageOfConversation(t.conversationId);if(i){if(((r=i.messageConfig)===null||r===void 0?void 0:r.lastMessageUpdateEnabled)!==!1){var o=As(this.core,i,0,i.sendingState);t.lastMessage=o}t.createTime=t.createTime||i.createTime,t.updateTime=i.createTime,t.sortOrder=this.computeSortOrder(t.stickTop,i.createTime)}return t},p.computeConvWithUnread=function(t,e){var r=this.service.model.getReadTime(t.conversationId),i=t.unreadCount||0;return e?e&&this.service.unread.isMessageUnread(e)&&(i+=1):i=this.service.unread.countUnreadByMessageInMemory(t.conversationId,r),t.unreadCount=i,t},p.computeConvByMsgsCache=function(t,e){var r,i=this.service.model.getById(t),o=this.core.V2NIMConversationIdUtil.parseConversationType(t),u=this.core.V2NIMMessageService.model.getLastMessageOfConversation(t),h=e==null?void 0:e.updateTime,g=0;g=h||(u&&u.createTime?u.createTime:i&&i.updateTime?i.updateTime:this.core.timeOrigin.getNTPTime());var v=this.service.model.getStickTop(t),_=O(O({conversationId:t,type:o,stickTop:v,localExtension:(i==null?void 0:i.localExtension)||"",lastMessage:null,unreadCount:0},e),{createTime:(i==null?void 0:i.createTime)||g,updateTime:g,sortOrder:this.computeSortOrder(v,g)});if(u&&((r=u.messageConfig)===null||r===void 0?void 0:r.lastMessageUpdateEnabled)!==!1){var I=As(this.core,u,0,u.sendingState);_.lastMessage=I}return _},Ai(a,[{key:"hasUserService",get:function(){var t;return!!(!((t=this.core.V2NIMUserService)===null||t===void 0)&&t.name)}},{key:"hasFriendService",get:function(){var t;return!!(!((t=this.core.V2NIMFriendService)===null||t===void 0)&&t.name)}},{key:"hasTeamService",get:function(){var t;return!!(!((t=this.core.V2NIMTeamService)===null||t===void 0)&&t.name)}},{key:"hasMessageService",get:function(){var t;return!!(!((t=this.core.V2NIMMessageService)===null||t===void 0)&&t.name)}}]),a}(),yV=function(){function a(l,t){this.core=l,this.service=t,this.model=this.service.model,this.logger=this.core.logger}var p=a.prototype;return p.v2LocalConvSyncStickTopHandler=function(t){var e=this,r=t.content,i=r.timetag,o=r.isThereAnyChange,u=r.datas;if(o){var h=this.model.getAll(),g=se(u).call(u,function(v){var _=Fd(v.id),I=_.target,C=_.type,A=e.core.V2NIMConversationIdUtil.conversationId(C,I);return e.model.updateStickTop(A,!0),A});ae(h).call(h,function(v){_t(g).call(g,v.conversationId)?(v.stickTop=!0,v.updateTime=v.updateTime>i?v.updateTime:i):v.stickTop=!1,e.model.updateStickTop(v.conversationId,v.stickTop)}),this.model.bulkUpsert(h)}},p.v2LocalConvSyncReadTimeHandler=function(t){var e,r,i=this,o=t.content.p2p||{},u=t.content.team.m_map||{};this.logger.log("v2SyncLocalConvAck::",o,u),ae(e=pt(o)).call(e,function(h){var g=i.core.V2NIMConversationIdUtil.p2pConversationId(h),v=i.model.getReadTime(g);o[h]>v&&(i.model.updateReadTime(g,o[h]),i.service.emit("onConversationReadTimeUpdated",g,o[h]))}),ae(r=pt(u)).call(r,function(h){var g=i.core.V2NIMConversationIdUtil.teamConversationId(h),v=i.model.getReadTime(g);u[h]>v&&(i.model.updateReadTime(g,u[h]),i.service.emit("onConversationReadTimeUpdated",g,u[h]))})},p.v2LocalConvSyncSuperTeamReadTimeHandler=function(t){var e,r=this,i=t.content.superTeam.m_map;this.logger.log("v2SyncLocalSuperTeamConvAck::",i),ae(e=pt(i)).call(e,function(o){var u=r.core.V2NIMConversationIdUtil.superTeamConversationId(o),h=r.model.getReadTime(u);i[o]>h&&(r.model.updateReadTime(u,i[o]),r.service.emit("onConversationReadTimeUpdated",u,i[o]))})},p.v2LocalConvMultiSyncReadTimeHandler=function(t){var e=t.content,r=Fd((e.scene===0?"p2p":e.scene===1?"team":"super_team")+"-"+e.to,"-"),i=r.type,o=r.target,u=this.core.V2NIMConversationIdUtil.conversationId(i,o),h=this.model.getById(u),g=h==null?void 0:h.unreadCount,v=this.model.getReadTime(u);e.timetag<=v?this.logger.warn("v2LocalConvMultiSyncReadTimeHandler: "+u+" do not need update ack "+e.timetag+"/"+v):(this.model.updateReadTime(u,e.timetag),this.service.emit("onConversationReadTimeUpdated",u,e.timetag),h?(h=this.service.compute.computeConvWithUnread(h),this.model.upsert(h),this.service.unread.digestUnreadCountChange(),g===void 0&&h.unreadCount>0?this.service.triggerConversationCreated(h):typeof g=="number"&&h.unreadCount!==g&&this.service.triggerConversationChanged([h])):this.logger.log("v2LocalConvMultiSyncReadTimeHandler: "+u+" not exist"))},p.v2LocalConvSuperTeamMultiSyncReadTimeHandler=function(t){this.v2LocalConvMultiSyncReadTimeHandler(t)},p.v2LocalConvStickTopMultiSyncAddHandler=function(t){var e=t.content.data,r=Fd(e.id),i=r.target,o=r.type,u=this.core.V2NIMConversationIdUtil.conversationId(o,i);this.model.updateStickTop(u,!0);var h=this.model.getById(u);h&&(h.stickTop=!0,h.updateTime=h.updateTime>e.updateTime?h.updateTime:e.updateTime,h.sortOrder=this.service.compute.computeSortOrder(!0,e.updateTime),this.model.upsert(h),this.service.triggerConversationChanged([h]))},p.v2LocalConvStickTopMultiSyncDeleteHandler=function(t){var e=t.content,r=e.data,i=e.timetag,o=Fd(r.id),u=o.target,h=o.type,g=this.core.V2NIMConversationIdUtil.conversationId(h,u);this.model.updateStickTop(g,!1);var v=this.model.getById(g);v&&(v.stickTop=!1,v.updateTime=v.updateTime>i?v.updateTime:i,v.sortOrder=this.service.compute.computeSortOrder(!1,i),this.model.upsert(v),this.service.triggerConversationChanged([v]))},a}();nS("Set",function(a){return function(){return a(this,arguments.length?arguments[0]:void 0)}},aS);var _V=we.Set;je({target:"Set",stat:!0,forced:!0},{from:lS}),je({target:"Set",stat:!0,forced:!0},{of:uS}),je({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function(){for(var p=Pt(this),l=Ge(p.add),t=0,e=arguments.length;t<e;t++)oe(l,p,arguments[t]);return p}}),je({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:dS});var ma=Wa;je({target:"Set",proto:!0,real:!0,forced:!0},{every:function(p){var l=Pt(this),t=ma(l),e=Yr(p,arguments.length>1?arguments[1]:void 0);return!rr(t,function(r,i){if(!e(r,r,l))return i()},{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),je({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(p){var l=Pt(this),t=new(ki(l,ue("Set")))(l),e=Ge(t.delete);return rr(p,function(r){oe(e,t,r)}),t}}),je({target:"Set",proto:!0,real:!0,forced:!0},{filter:function(p){var l=Pt(this),t=ma(l),e=Yr(p,arguments.length>1?arguments[1]:void 0),r=new(ki(l,ue("Set"))),i=Ge(r.add);return rr(t,function(o){e(o,o,l)&&oe(i,r,o)},{IS_ITERATOR:!0}),r}}),je({target:"Set",proto:!0,real:!0,forced:!0},{find:function(p){var l=Pt(this),t=ma(l),e=Yr(p,arguments.length>1?arguments[1]:void 0);return rr(t,function(r,i){if(e(r,r,l))return i(r)},{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),je({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(p){var l=Pt(this),t=new(ki(l,ue("Set"))),e=Ge(l.has),r=Ge(t.add);return rr(p,function(i){oe(e,l,i)&&oe(r,t,i)}),t}}),je({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(p){var l=Pt(this),t=Ge(l.has);return!rr(p,function(e,r){if(oe(t,l,e)===!0)return r()},{INTERRUPTED:!0}).stopped}}),je({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(p){var l=Wa(this),t=Pt(p),e=t.has;return Z(e)||(t=new(ue("Set"))(p),e=Ge(t.has)),!rr(l,function(r,i){if(oe(e,t,r)===!1)return i()},{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),je({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(p){var l=Pt(this),t=Ge(l.has);return!rr(p,function(e,r){if(oe(t,l,e)===!1)return r()},{INTERRUPTED:!0}).stopped}});var MV=$([].join),TV=[].push;je({target:"Set",proto:!0,real:!0,forced:!0},{join:function(p){var l=Pt(this),t=ma(l),e=p===void 0?",":xn(p),r=[];return rr(t,TV,{that:r,IS_ITERATOR:!0}),MV(r,e)}}),je({target:"Set",proto:!0,real:!0,forced:!0},{map:function(p){var l=Pt(this),t=ma(l),e=Yr(p,arguments.length>1?arguments[1]:void 0),r=new(ki(l,ue("Set"))),i=Ge(r.add);return rr(t,function(o){oe(i,r,e(o,o,l))},{IS_ITERATOR:!0}),r}});var IV=TypeError;je({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function(p){var l=Pt(this),t=ma(l),e=arguments.length<2,r=e?void 0:arguments[1];if(Ge(p),rr(t,function(i){e?(e=!1,r=i):r=p(r,i,i,l)},{IS_ITERATOR:!0}),e)throw IV("Reduce of empty set with no initial value");return r}}),je({target:"Set",proto:!0,real:!0,forced:!0},{some:function(p){var l=Pt(this),t=ma(l),e=Yr(p,arguments.length>1?arguments[1]:void 0);return rr(t,function(r,i){if(e(r,r,l))return i()},{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),je({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(p){var l=Pt(this),t=new(ki(l,ue("Set")))(l),e=Ge(t.delete),r=Ge(t.add);return rr(p,function(i){oe(e,t,i)||oe(r,t,i)}),t}}),je({target:"Set",proto:!0,real:!0,forced:!0},{union:function(p){var l=Pt(this),t=new(ki(l,ue("Set")))(l);return rr(p,Ge(t.add),{that:t}),t}});var es=_V,SV=function(){function a(l,t){this.core=l,this.service=t,this.model=this.service.model,this.compute=this.service.compute,this.logger=this.core.logger}var p=a.prototype;return p.setListener=function(){var t,e,r,i,o,u,h,g,v,_,I=this;this.core.eventBus.on("V2NIMLoginService/syncing",function(){return I.service.emit("onSyncStarted")}),this.core.eventBus.on("V2NIMLoginService/syncDone",et(t=this.onSyncDone).call(t,this)),this.core.eventBus.on("V2NIMMessageService/sendMessage",et(e=this.sendMsg).call(e,this)),this.core.eventBus.on("V2NIMMessageService/onMsg",et(r=this.recvMsg).call(r,this)),this.core.eventBus.on("V2NIMMessageService/modifyMsg",et(i=this.modifyMsg).call(i,this)),this.core.eventBus.on("V2NIMMessageService/deleteMessages",et(o=this.deleteMessages).call(o,this)),this.core.eventBus.on("V2NIMMessageService/revokeMessages",et(u=this.deleteMessages).call(u,this)),this.core.eventBus.on("V2NIMMessageLogUtil/onClearHistoryNotifications",et(h=this.clearMessages).call(h,this)),this.core.eventBus.on("V2NIMMessageService/roamingMsgs",et(g=this.generateConv).call(g,this)),this.core.eventBus.on("V2NIMMessageService/offlineMsgs",et(v=this.generateConv).call(v,this)),this.core.eventBus.on("V2NIMSettingService/setMute",et(_=this.setMute).call(_,this))},p.beforeEmit=function(t){for(var e,r=this.service.name+"::emit "+t.toString(),i=arguments.length,o=new Array(i>1?i-1:0),u=1;u<i;u++)o[u-1]=arguments[u];if(t==="onConversationCreated"){var h=o[0],g=(e=h.lastMessage)===null||e===void 0?void 0:e.messageRefer;this.logger.log(""+r,"id:"+h.conversationId+";unread:"+h.unreadCount+";lastMsg:"+((g==null?void 0:g.messageClientId)||"")+"/"+((g==null?void 0:g.messageServerId)||""))}else if(t==="onConversationChanged"){var v=o[0];this.logger.log(""+r,se(v).call(v,function(C){var A,N=(A=C.lastMessage)===null||A===void 0?void 0:A.messageRefer;return"id:"+C.conversationId+";unread:"+C.unreadCount+";lastMsg:"+((N==null?void 0:N.messageClientId)||"")+"/"+((N==null?void 0:N.messageServerId)||"")}))}else{var _,I;(_=this.logger).log.apply(_,dt(I=[""+r]).call(I,o))}},p.onSyncDone=function(t){var e=this;if(t)this.service.emit("onSyncFailed",t);else{var r=this.model.getAll();r=se(r).call(r,function(i){var o=i.conversationId,u=e.compute.computeConvByMsgsCache(o);return u=e.compute.computeConvWithUnread(u),u=e.compute.computeFromExternal(u),e.model.upsert(u),e.model.getById(o)}),r.length>0&&(this.service.triggerConversationChanged(r),this.service.unread.resetTotalAfterSyncDone()),this.service.emit("onSyncFinished")}},p.generateConv=function(t){var e=this,r=po(se(t).call(t,function(i){return i.conversationId}));ae(r).call(r,function(i){var o=e.compute.computeConvByMsgsCache(i);e.model.upsert(o)})},p.setMute=function(t,e){var r=this.model.getById(t);r&&r.mute!==e&&(r.mute=e,this.model.upsert(r),this.service.triggerConversationChanged([r]))},p.deleteMessages=function(t){var e=this,r=new es;ae(t).call(t,function(o){var u,h=o.messageRefer.conversationId,g=e.model.getById(h);if(g){if(o.messageRefer.messageClientId===((u=g.lastMessage)===null||u===void 0?void 0:u.messageRefer.messageClientId)){r.add(h);var v=e.core.V2NIMMessageService.model.getLastMessageOfConversation(h);g.lastMessage=v?As(e.core,v,0,v.sendingState):void 0}var _=e.model.getReadTime(h);if(g.unreadCount>0&&e.service.unread.isMessageReferUnread(o.messageRefer,_)&&(r.add(h),g.unreadCount--),"deleteTime"in o)o.deleteTime>g.updateTime&&(g.updateTime=o.deleteTime,g.sortOrder=e.compute.computeSortOrder(g.stickTop,g.updateTime));else{var I=e.core.timeOrigin.getNTPTime();g.updateTime=I,g.sortOrder=e.compute.computeSortOrder(g.stickTop,I)}e.model.upsert(g)}});var i=vr(r);!this.core.V2NIMLoginService.dataSync.checkSyncing()&&i.length>0&&(this.service.triggerConversationChanged(se(i).call(i,function(o){return e.model.getById(o)})),this.service.unread.digestUnreadCountChange())},p.sendMsg=function(t){var e=t.conversationId,r=this.model.getById(e);if(r){var i=this.updateCauseMessage(r,t);this.service.triggerConversationChanged([i])}else{var o=this.createCauseMessage(e,t);this.service.triggerConversationCreated(o)}},p.recvMsg=function(t){var e=t.conversationId,r=this.model.getById(e);if(r){var i=this.updateCauseMessage(r,t);i=this.compute.computeConvWithUnread(i,t),i=this.compute.computeFromExternal(i),this.model.upsert(i),this.service.triggerConversationChanged([i])}else{var o=this.createCauseMessage(e,t);o=this.compute.computeConvWithUnread(o,t),o=this.compute.computeFromExternal(o),this.model.upsert(o),this.service.triggerConversationCreated(o)}this.service.unread.digestUnreadCountChange()},p.updateCauseMessage=function(t,e){return t=this.compute.computeConvWithLastMsg(t,e),this.model.upsert(t),this.model.getById(t.conversationId)},p.createCauseMessage=function(t,e){var r,i=this.core.V2NIMConversationIdUtil.parseConversationType(t),o=this.model.getStickTop(t),u=((r=e.messageConfig)===null||r===void 0?void 0:r.lastMessageUpdateEnabled)===!1?void 0:As(this.core,e,0,e.sendingState),h={conversationId:t,type:i,createTime:e.createTime,updateTime:e.createTime,sortOrder:this.compute.computeSortOrder(!1,e.createTime),stickTop:o,localExtension:"",lastMessage:u,unreadCount:0};return this.model.upsert(h),h},p.clearMessages=function(t){var e=this,r=new es;ae(t).call(t,function(o){var u=o.conversationId,h=o.deleteTime,g=e.model.getById(u);g&&(g.unreadCount>0&&(g.unreadCount=0,r.add(u)),g.lastMessage&&g.lastMessage.messageRefer.createTime<=o.deleteTime&&(g.lastMessage=void 0,r.add(u)),h>g.updateTime&&(g.updateTime=h,g.sortOrder=e.compute.computeSortOrder(g.stickTop,g.updateTime)),e.model.upsert(g))});var i=vr(r);!this.core.V2NIMLoginService.dataSync.checkSyncing()&&i.length>0&&(this.service.triggerConversationChanged(se(i).call(i,function(o){return e.model.getById(o)})),this.service.unread.digestUnreadCountChange())},p.modifyMsg=function(t){var e,r=t.conversationId,i=t.messageClientId,o=this.model.getById(r),u=this.core.V2NIMMessageService.model.getMessageById(i);if(o||u)if(o)t.messageClientId===((e=o.lastMessage)===null||e===void 0?void 0:e.messageRefer.messageClientId)&&(o.lastMessage=As(this.core,t,0,t.sendingState),this.service.triggerConversationChanged([o]));else{var h=this.createCauseMessage(r,t);this.service.triggerConversationCreated(h)}},a}(),hE={type:"array",itemRules:{type:"enum",values:[1,2,3]},min:1},EV=function(a){function p(t,e){var r;return e===void 0&&(e={}),(r=a.call(this,"V2NIMLocalConversationService",t)||this).config={},r.model=new dV,r.unread=new fV(r.core,Ot(r)),r.compute=new vV(r.core,Ot(r)),r.event=new SV(r.core,Ot(r)),r.handler=new yV(r.core,Ot(r)),r.core._registerDep(la,"V2NIMConversationIdUtil"),r.core._registerDep(oE,"V2NIMMessageService"),r.core.options.apiVersion!=="v2"?Ot(r):(Kt({cmdMap:pV,cmdConfig:hV}),r.setOptions(e),r.setListener(),r)}bt(p,a);var l=p.prototype;return l.setOptions=function(e){this.config=O(this.config,e)},l.setListener=function(){this.event.setListener()},l.reset=function(){this.model.reset(),this.unread.reset()},l.emit=function(e){for(var r,i,o,u,h=arguments.length,g=new Array(h>1?h-1:0),v=1;v<h;v++)g[v-1]=arguments[v];return(r=this.event).beforeEmit.apply(r,dt(i=[e]).call(i,g)),(o=a.prototype.emit).call.apply(o,dt(u=[this,e]).call(u,g))},l.getConversationList=function(e,r){var i,o=this;this.checkV2(),P({offset:{type:"number",min:0}},{offset:e},"",!0),P({limit:{type:"number",min:1}},{limit:r},"",!0),this.core.V2NIMLoginService.checkIllegalState();var u=this.model.getByOption(e,r,{});return u.conversationList=se(i=u.conversationList).call(i,function(h){return o.compute.computeFromExternal(h)}),He.resolve(u)},l.getConversationListByOption=function(e,r,i){var o,u=this;this.checkV2(),P({offset:{type:"number",min:0}},{offset:e},"",!0),P({limit:{type:"number",min:1}},{limit:r},"",!0),P({conversationTypes:{type:"array",itemType:"number",required:!1},onlyUnread:{type:"boolean",required:!1}},i,"option",!0),this.core.V2NIMLoginService.checkIllegalState();var h=this.model.getByOption(e,r,i);return h.conversationList=se(o=h.conversationList).call(o,function(g){return u.compute.computeFromExternal(g)}),He.resolve(h)},l.getConversation=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.checkV2(),Nr(this.core.account,e),!(i=this.model.getById(e))){u.next=7;break}return u.abrupt("return",this.compute.computeFromExternal(i));case 7:throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 8:case"end":return u.stop()}},r,this)}))},l.getConversationListByIds=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u=this;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),P({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),o=at(i=se(e).call(e,function(v){return u.model.getById(v)})).call(i,function(v){return!!v}),o=se(o).call(o,function(v){return u.compute.computeFromExternal(v)}),g.abrupt("return",o);case 6:case"end":return g.stop()}},r,this)}))},l.createConversation=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.checkV2(),Nr(this.core.account,e),!(i=this.model.getById(e))){g.next=5;break}return g.abrupt("return",this.compute.computeFromExternal(i));case 5:return o=this.compute.computeConvByMsgsCache(e,{updateTime:this.core.timeOrigin.getNTPTime()}),o=this.compute.computeConvWithUnread(o),o=this.compute.computeFromExternal(o),this.model.upsert(o),u=this.model.getById(e),this.triggerConversationCreated(u),g.abrupt("return",u);case 12:case"end":return g.stop()}},r,this)}))},l.deleteConversation=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),Nr(this.core.account,e),P({clearMessage:{type:"boolean",required:!1}},{clearMessage:r},"",!0),h.next=5,this.unread.markConversationRead(e);case 5:if(o=this.model.deleteById(e)){h.next=8;break}throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 8:r&&this.core.V2NIMMessageService.model.deleteMessages(e),o&&o.unreadCount>0&&this.unread.digestUnreadCountChange(),this.emit("onConversationDeleted",[e]);case 12:case"end":return h.stop()}},i,this)}))},l.deleteConversationListByIds=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u=this;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),P({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),P({clearMessage:{type:"boolean",required:!1}},{clearMessage:r},"",!0),g.next=5,this.unread.markMultiConversationRead(e);case 5:return o=!1,ae(e).call(e,function(v){r&&u.core.V2NIMMessageService.model.deleteMessages(v),u.model.deleteById(v)&&(o=!0)}),o&&this.unread.digestUnreadCountChange(),this.emit("onConversationDeleted",e),g.abrupt("return",[]);case 10:case"end":return g.stop()}},i,this)}))},l.stickTopConversation=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(this.checkV2(),Nr(this.core.account,e),P({stickTop:{type:"boolean"}},{stickTop:r},"",!0),((o=this.model.getById(e))==null?void 0:o.stickTop)!==r){C.next=6;break}return C.abrupt("return");case 6:return u=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),h=this.core.V2NIMConversationIdUtil.parseConversationType(e),C.next=10,this.core.sendCmd(r?"v2LocalConvStickTopAdd":"v2LocalConvStickTopDelete",{tag:{id:uV(h,u)}});case 10:g=C.sent,this.model.updateStickTop(e,r),v=g.content.timetag||g.content.data.updateTime,this.model.upsert({conversationId:e,type:h,stickTop:r,updateTime:v,sortOrder:this.compute.computeSortOrder(r,v)}),_=[this.model.getById(e)],this.triggerConversationChanged(_);case 16:case"end":return C.stop()}},i,this)}))},l.updateConversationLocalExtension=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.checkV2(),Nr(this.core.account,e),P({localExtension:{type:"string"}},{localExtension:r},"",!0),o=this.model.getById(e)){g.next=6;break}throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 6:if(o.localExtension!==r){g.next=8;break}return g.abrupt("return");case 8:u=O(O({},o),{localExtension:r}),this.model.upsert(u),this.triggerConversationChanged([u]);case 11:case"end":return g.stop()}},i,this)}))},l.getTotalUnreadCount=function(){return this.checkV2(),this.unread.getTotalUnreadCount()||0},l.getUnreadCountByIds=function(e){this.checkV2(),P({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0);var r=this.unread.getUnreadCountByIds(e);return He.resolve(r)},l.getUnreadCountByFilter=function(e){this.checkV2(),this.valiteFilter(e);var r=this.unread.getUnreadCountByFilter(e);return He.resolve(r)},l.clearTotalUnreadCount=function(){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),this.checkLogin(),r=this.model.getAll(),o.next=5,this.unread.markMultiConversationRead(se(r).call(r,function(u){return u.conversationId}));case 5:this.unread.clearUnreadCount(r);case 6:case"end":return o.stop()}},e,this)}))},l.clearUnreadCountByIds=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v=this;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(this.checkV2(),this.checkLogin(),P({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),i=[],o=[],u=new RegExp("^"+this.core.account+"\\|[1-3]\\|"),ae(e).call(e,function(C){u.test(C)?i.push(C):o.push(C)}),!(i.length>0)){I.next=12;break}return g=at(h=se(i).call(i,function(C){return v.model.getById(C)})).call(h,function(C){return!!C}),I.next=11,this.unread.markMultiConversationRead(i);case 11:this.unread.clearUnreadCount(g);case 12:return I.abrupt("return",se(o).call(o,function(C){return{conversationId:C,error:new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST})}}));case 13:case"end":return I.stop()}},r,this)}))},l.clearUnreadCountByTypes=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),this.checkLogin(),P({types:hE},{types:e},"",!0),o=this.model.getByOption(0,1e3,{conversationTypes:e}),h.next=6,this.unread.markMultiConversationRead(se(i=o.conversationList).call(i,function(g){return g.conversationId}));case 6:this.unread.clearUnreadCount(o.conversationList);case 7:case"end":return h.stop()}},r,this)}))},l.subscribeUnreadCountByFilter=function(e){var r;this.checkV2(),this.checkLogin(),this.valiteFilter(e),((r=e.conversationTypes)===null||r===void 0?void 0:r.length)===0&&delete e.conversationTypes,this.unread.addFilter(e)},l.unsubscribeUnreadCountByFilter=function(e){var r;this.checkV2(),this.checkLogin(),this.valiteFilter(e),((r=e.conversationTypes)===null||r===void 0?void 0:r.length)===0&&delete e.conversationTypes,this.unread.deleteFilter(e)},l.getConversationReadTime=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),Nr(this.core.account,e),o.abrupt("return",this.model.getReadTime(e));case 3:case"end":return o.stop()}},r,this)}))},l.markConversationRead=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),this.checkLogin(),Nr(this.core.account,e),o.abrupt("return",this.unread.markConversationRead(e));case 4:case"end":return o.stop()}},r,this)}))},l.valiteFilter=function(e){if(P({filter:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},ignoreMuted:{type:"boolean",required:!1}}}},{filter:e},"",!0),e.conversationTypes===void 0&&e.ignoreMuted!==!0)throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Filter cannot be empty"}})},l.triggerConversationChanged=function(e){var r=this;e=se(e).call(e,function(i){return r.compute.computeFromExternal(i)}),e=JSON.parse(xe(e)),ae(e).call(e,function(i){i.lastMessage||(i.lastMessage=void 0),delete i.lastMessageState}),this.emit("onConversationChanged",e)},l.triggerConversationCreated=function(e){e=this.compute.computeFromExternal(e),delete(e=JSON.parse(xe(e))).lastMessageState,this.emit("onConversationCreated",e)},p}($r),CV=function(){function a(){this.map=new Dr,this.readTimeMap=new Dr}var p=a.prototype;return p.set=function(t){var e=this;ae(t).call(t,function(r){r=e.processConversation(r),se(e).set(r.conversationId,r)})},p.reset=function(){se(this).clear(),this.readTimeMap.clear()},p.count=function(){return se(this).size},p.sort=function(){var t,e=this,r=vr(fi(t=se(this)).call(t));Tr(r).call(r,function(i,o){return o.sortOrder-i.sortOrder}),se(this).clear(),ae(r).call(r,function(i){se(e).set(i.conversationId,i)})},p.processConversation=function(t){return typeof t.lastMessage=="string"&&delete t.lastMessage,t.localExtension===void 0&&(t.localExtension=""),t},p.getById=function(t){return se(this).get(t)},p.getAll=function(){var t,e=vr(fi(t=se(this)).call(t));return Tr(e).call(e,function(r,i){return i.sortOrder-r.sortOrder})},p.getByOption=function(t,e,r){var i,o=r.conversationTypes,u=r.onlyUnread,h=r.conversationGroupIds,g=[];ae(i=se(this)).call(i,function(I){if((!(o&&o.length>0)||_t(o).call(o,I.type))&&(!u||I.unreadCount)&&(!r.ignoreMuted||!I.mute)){if(h){var C=I.groupIds,A=(C==null?void 0:C.length)||0;if(h.length===0&&A>0||h.length>0&&A===0||h.length>0&&A>0&&!Ln(h).call(h,function(N){return C&&_t(C).call(C,N)}))return}g.push(I)}}),g=Tr(g).call(g,function(I,C){return C.sortOrder-I.sortOrder});var v=0;t>0&&(v=eg(g,"sortOrder",t),g[v]&&g[v].sortOrder===t&&(v+=1));var _=ht(g).call(g,v).length;return(g=ht(g).call(g,v,v+e)).length>0?{offset:_>e?g[g.length-1].sortOrder:0,finished:!(_>e),conversationList:g}:{offset:0,finished:!0,conversationList:g}},p.upsert=function(t){var e=t.conversationId,r=se(this).get(e);if(!r)return t=this.processConversation(O({},t)),se(this).set(e,t),t.unreadCount>0;var i=t.unreadCount!==r.unreadCount,o=O({},r,t);return o=this.processConversation(o),se(this).set(e,o),i},p.bulkUpsert=function(t){var e=this,r=!1;return ae(t).call(t,function(i){e.upsert(i)&&(r=!0)}),r},p.deleteById=function(t){var e=this.getById(t);if(e)return se(this).delete(t),e},p.updateReadTime=function(t,e){this.readTimeMap.set(t,e)},p.getReadTime=function(t){return this.readTimeMap.get(t)||0},a}();function Ag(a,p){var l=typeof a;if(l!==typeof p)return!1;if(l==="object"){if(Object.prototype.toString.call(a)!==Object.prototype.toString.call(p))return!1;if(qt(a)){if(a.length!==p.length)return!1;for(var t=0;t<a.length;t++)if(!Ag(a[t],p[t]))return!1;return!0}if(a instanceof RegExp&&p instanceof RegExp)return a.toString()===p.toString();if(a instanceof Date&&p instanceof Date)return a.getTime()===p.getTime();if(a===null&&p===null)return!0;if(pt(a).length!==pt(p).length)return!1;for(var e in a)if(!Ag(a[e],p[e]))return!1;return!0}return a===p}var bV=function(){function a(l,t){this.fieldVersion={},this.conversationIdsForBackFill={},this.tempPacket=[],this.isSyncing=!1,this.nextCursor=0,this.core=l,this.service=t}var p=a.prototype;return p.reset=function(){this.tempPacket=[],this.fieldVersion={},this.conversationIdsForBackFill={},this.isSyncing=!1,this.nextCursor=0},p.doSync=function(){return k(this,void 0,void 0,T.mark(function t(){var e,r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.isSyncing=!0,this.service.emit("onSyncStarted"),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:2,subType:"conversationSync"}),h.prev=3,h.next=6,this.core.sendCmd("v2ConversationSync",{tag:{cursor:this.nextCursor}});case 6:e=h.sent,h.next=19;break;case 9:if(h.prev=9,h.t0=h.catch(3),(r=h.t0).code!==ce.V2NIM_ERROR_CODE_CANCELLED){h.next=14;break}return h.abrupt("return");case 14:return this.isSyncing=!1,this.service.emit("onSyncFailed",r),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:r,subType:"conversationSync"}),this.processTempPacket(),h.abrupt("return");case 19:i=it(Pe(e,"content.info.syncType"))===0,o=Pe(e,"content.info.nextCursor"),this.doSyncAndSuccess(i,o);case 22:case"end":return h.stop()}},t,this,[[3,9]])}))},p.doSyncAndSuccess=function(t,e){var r;t&&Tr(r=this.service.model).call(r),this.isSyncing=!1,this.nextCursor=it(e)||0,this.service.unread.resetTotalAfterSyncDone(),this.service.unread.digestUnreadCountChange(),this.service.emit("onSyncFinished"),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,subType:"conversationSync"}),this.processTempPacket()},p.setBackFillIds=function(t){var e=this;return ae(t).call(t,function(r){if(r.lastMessageState===2&&e.service.compute.hasMessageService){e.conversationIdsForBackFill[r.conversationId]=!0;var i=e.core.V2NIMMessageService.model.getLastMessageOfConversation(r.conversationId);r.lastMessage=i?As(e.core,i,r.lastMessageState,i.sendingState):""}else e.conversationIdsForBackFill[r.conversationId]=!1;delete r.lastMessageState}),t},p.recvConversationFromSyncAction=function(t){var e=this,r=Pe(t,"content.info").syncType,i=pc(this.core,Pe(t,"content.datas"));(r=it(r))===0?(ae(i).call(i,function(o){e.initFieldVersion(o.conversationId,o.version)}),i=this.setBackFillIds(i),this.setModel(i)):(i=this.setBackFillIds(i),this.recvConversationForCreated(i)<i.length&&this.recvConversationForChanged(i))},p.recvConversation=function(t){var e=this;if(this.isSyncing)this.tempPacket.push(t);else{var r=pc(this.core,Pe(t,"content.datas")),i=at(r).call(r,function(g){return!!g.conversationId}),o=bg(Pe(t,"content.info")),u=se(i).call(i,function(g){return"id:"+g.conversationId+", ver:"+g.version}).join(";");if(this.core.logger.getDebugMode()?this.core.logger.debug("V2NIMConversation::recvConversation: "+u+".",o,i):this.core.logger.log("V2NIMConversation::recvConversation: "+u+".",o),o.type===2){var h=se(i).call(i,function(g){return delete e.fieldVersion[g.conversationId],e.service.model.deleteById(g.conversationId),g.conversationId});return this.service.emit("onConversationDeleted",h),void this.service.unread.digestUnreadCountChange()}o.type!==12?(o.type,i=this.setBackFillIds(i),this.recvConversationForCreated(i)<i.length&&this.recvConversationForChanged(i)):this.compareAndClearUnreadInModel(o.oneClickClearUnreadVersion,o.oneClickClearUnreadType,{conversationGroupIds:o.oneClickClearUnreadGroupId?[o.oneClickClearUnreadGroupId]:void 0,conversationTypes:o.oneClickClearUnreadConversationType})}},p.recvConversationForCreated=function(t){var e=this,r=at(t).call(t,function(o){return!e.fieldVersion[o.conversationId]}),i=Cr(r).call(r,function(o,u){if(!e.fieldVersion[u.conversationId]){e.initFieldVersion(u.conversationId,u.version),o=!!e.updateModel(u)||o;var h=e.service.model.getById(u.conversationId);return h&&e.service.triggerConversationCreated(h),o}return o},!1);return i&&this.service.unread.digestUnreadCountChange(),r.length},p.recvConversationForChanged=function(t){var e,r=this,i=this.bulkCompare(t);if(i.length!==0){this.bulkUpdateModel(i);var o=at(e=se(i).call(i,function(u){return r.service.model.getById(u.conversationId)})).call(e,function(u){return!!u});this.service.triggerConversationChanged(o)}},p.processTempPacket=function(){var t,e=this;ae(t=this.tempPacket).call(t,function(r){e.recvConversation(r)}),this.tempPacket=[]},p.bulkCompare=function(t){var e,r=this;return at(e=se(t).call(t,function(i){return r.compare(i)})).call(e,function(i){return!!i})},p.compare=function(t){var e=this,r=t.version,i=t.conversationId,o=t.deleteFlag,u=t.type,h=["stickTop","groupIds","serverExtension","localExtension","lastMessage","lastMessageState","unreadCount","sortOrder","createTime","updateTime"],g={},v=0;return ae(h).call(h,function(_){var I=_;if(t[I]!==void 0){var C=e.fieldVersion[i];C&&typeof C[I]=="number"&&C[I]>=r||(e.fieldVersion[i]=e.fieldVersion[i]||{},e.fieldVersion[i][I]=r,g[I]=t[I],v+=1)}}),v?O(O({},g),{conversationId:i,deleteFlag:o,version:r,type:u}):void 0},p.bulkUpdateModel=function(t){var e=this,r=!1;ae(t).call(t,function(i){e.updateModel(i)&&(r=!0)}),r&&this.service.unread.digestUnreadCountChange()},p.initFieldVersion=function(t,e){this.fieldVersion[t]={stickTop:e,groupIds:e,serverExtension:e,lastMessage:e,lastMessageState:e,unreadCount:e,sortOrder:e,createTime:e,updateTime:e}},p.initConversation=function(t,e){var r=Dt();return O({conversationId:t,type:this.core.V2NIMConversationIdUtil.parseConversationType(t),stickTop:!1,localExtension:"",serverExtension:"",unreadCount:0,createTime:r,updateTime:r,sortOrder:r},e)},p.updateModel=function(t){var e=pE(t),r=e.deleteFlag,i=e.conversation;if(r){var o=this.service.model.deleteById(i.conversationId);return!!(o&&o.unreadCount>0)}return this.service.model.upsert(i)},p.setModel=function(t){var e,r=se(e=at(t).call(t,function(i){return!i.deleteFlag})).call(e,function(i){return pE(i).conversation});this.service.model.set(r)},p.updateModelWithLastMessage=function(t,e,r,i){var o=this.service.model.getById(t),u=e?As(this.core,e,r,i):void 0;if(!Ag(o==null?void 0:o.lastMessage,u))if(o){var h=O(O({},o),{sortOrder:u?o.stickTop?u.messageRefer.createTime+1e15:u.messageRefer.createTime:o.sortOrder,lastMessage:u});this.service.model.upsert(h),this.service.triggerConversationChanged([h])}else{this.initFieldVersion(t,-1);var g=this.initConversation(t,{lastMessage:u});this.service.model.upsert(g),this.service.triggerConversationCreated(g)}},p.updateModelByRevoke=function(t){var e=this,r=[];ae(t).call(t,function(i){var o=i.postscript,u=i.messageRefer,h=br(i,["postscript","messageRefer"]),g=u.conversationId,v=e.service.model.getById(g);v&&v.lastMessage&&v.lastMessage.messageRefer.messageClientId===u.messageClientId&&v.lastMessage.lastMessageState!==1&&(v.lastMessage.lastMessageState=1,o&&(v.lastMessage.text=o),O(v.lastMessage,h),e.service.model.upsert(v),r.push(v))}),r.length>0&&this.service.triggerConversationChanged(r)},p.compareAndUpdateModel=function(t){var e=this;this.core.logger.log("V2NIMConversation::compareAndUpdateModel",se(t).call(t,function(o){return o.conversationId}));var r=!1,i=[];ae(t).call(t,function(o){var u=e.compare(o);if(u){var h=e.service.model.getById(o.conversationId);e.updateModel(u)&&(r=!0);var g=e.service.model.getById(o.conversationId);g&&(h?i.push(g):e.service.triggerConversationCreated(g))}}),i.length>0&&this.service.triggerConversationChanged(i),r&&this.service.unread.digestUnreadCountChange()},p.compareAndDeleteModel=function(t){var e=this;this.core.logger.log("V2NIMConversation::compareAndDeleteModel",t);var r=Cr(t).call(t,function(i,o){delete e.fieldVersion[o];var u=e.service.model.deleteById(o);return!!(u&&u.unreadCount>0)||i},!1);this.service.emit("onConversationDeleted",t),r&&this.service.unread.digestUnreadCountChange()},p.compareAndDeleteGroupInModel=function(t,e){var r,i=this;this.core.logger.log("V2NIMConversation::compareAndDeleteGroupInModel",t,e);var o=[];ae(r=pt(this.fieldVersion)).call(r,function(u){var h=i.fieldVersion[u];if(h.groupIds===void 0||t>h.groupIds){h.groupIds=t;var g=i.service.model.getById(u);if(g&&g.groupIds&&g.groupIds.length>0){var v,_=at(v=g.groupIds).call(v,function(C){return C!==e});if(_.length!==g.groupIds.length){var I=O(O({},g),{groupIds:_});i.service.model.upsert(I),I&&o.push(I)}}}}),o.length>0&&this.service.triggerConversationChanged(o)},p.compareAndClearUnreadInModel=function(t,e,r){var i=this;this.core.logger.log("V2NIMConversation::compareAndClearUnreadInModel",t,e,r);var o=[],u=[];if(e===1)u=this.service.model.getAll();else if(r){var h=this.service.model.count();u=this.service.model.getByOption(0,h,r).conversationList}ae(u).call(u,function(g){var v=g.conversationId,_=i.fieldVersion[v];if(_.unreadCount===void 0||t>_.unreadCount){_.unreadCount=t;var I=g.unreadCount,C=O(O({},g),{unreadCount:0});i.service.model.upsert(C),I>0&&o.push(C)}}),o.length>0&&this.service.triggerConversationChanged(o),this.service.unread.digestUnreadCountChange()},p.backfillLastMsg=function(t,e){var r=this,i=t=po(t);(e||(i=at(t).call(t,function(o){return r.conversationIdsForBackFill[o]}),i.length!==0))&&ae(i).call(i,function(o){var u=Pe(r.service.model.getById(o),"lastMessage.messageRefer.messageClientId"),h=r.service.compute.hasMessageService?r.core.V2NIMMessageService.model.getLastMessageOfConversation(o):void 0;(h&&h.messageClientId)!==u&&(r.conversationIdsForBackFill[o]=!1,h?r.updateModelWithLastMessage(o,h,2,h.sendingState):r.updateModelWithLastMessage(o,void 0,2,0))})},a}(),AV={"28_1":"v2ConversationCreate","28_2":"v2ConversationDelete","28_3":"v2ConversationUpdate","28_4":"v2ConversationSetTop","28_5":"v2ConversationUnreadClear","28_6":"v2ConversationGet","28_7":"v2ConversationGetByIds","28_8":"v2ConversationGetList","28_17":"v2ConversationsDelete","28_18":"v2ConversationsUnreadClear","28_19":"v2ConversationSync","28_20":"v2ConversationNotifySync","28_21":"v2ConversationNotifySyncOnline","28_23":"v2ConversationClearTotalUnread","28_24":"v2ConversationClearTypeUnread","28_25":"v2ConversationClearGroupUnread","4_14":"syncConversationReadTime","4_20":"syncSuperTeamReadTime","4_22":"v2SyncSessionsWithMoreRoaming","4_25":"v2SyncSessionReliableInfo","30_16":"v2MarkConversationReadTime","32_25":"v2MarkSuperTeamReadTime","7_116":"v2MultiDeviceConversationReadTime","21_125":"v2MultiDeviceSuperTeamReadTime"},Ur="V2NIMConversationService",Sn={conversationId:1,type:2,serverExtension:3,groupIds:4,lastMessage:5,lastMessageState:6,unreadCount:7,stickTop:8,sortOrder:9,version:10,deleteFlag:11,createTime:12,updateTime:13},wl={type:1,oneClickClearUnreadType:2,oneClickClearUnreadConversationType:3,oneClickClearUnreadGroupId:4,oneClickClearUnreadVersion:5,deleteConversationClearMessage:6},RV={v2ConversationCreate:{sid:28,cid:1,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Mt(Sn)}]},v2ConversationDelete:{sid:28,cid:2,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,clearMessage:2}}],response:[{type:"Property",name:"data",reflectMapper:Mt(Sn)}]},v2ConversationUpdate:{sid:28,cid:3,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,serverExtension:2}}],response:[{type:"Property",name:"data",reflectMapper:Mt(Sn)}]},v2ConversationSetTop:{sid:28,cid:4,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,stickTop:2}}],response:[{type:"Property",name:"data",reflectMapper:Mt(Sn)}]},v2ConversationUnreadClear:{sid:28,cid:5,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Mt(Sn)}]},v2ConversationGet:{sid:28,cid:6,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Mt(Sn)}]},v2ConversationGetByIds:{sid:28,cid:7,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Mt(Sn)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGetList:{sid:28,cid:8,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Mt(Sn)},{type:"Property",name:"info",reflectMapper:{1:"hasMore",2:"offset"}}]},v2ConversationsDelete:{sid:28,cid:17,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,clearMessage:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Mt(Sn)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationsUnreadClear:{sid:28,cid:18,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Mt(Sn)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationSync:{sid:28,cid:19,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}}]},v2ConversationNotifySync:{sid:28,cid:20,service:Ur,response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}},{type:"PropertyArray",name:"datas",reflectMapper:Mt(Sn)}]},v2ConversationNotifySyncOnline:{sid:28,cid:21,service:Ur,response:[{type:"Property",name:"info",reflectMapper:Mt(wl)},{type:"PropertyArray",name:"datas",reflectMapper:Mt(Sn)}]},v2ConversationClearTotalUnread:{sid:28,cid:23,service:Ur,response:[{type:"Property",name:"info",reflectMapper:Mt(wl)}]},v2ConversationClearTypeUnread:{sid:28,cid:24,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{conversationType:1}}],response:[{type:"Property",name:"info",reflectMapper:Mt(wl)}]},v2ConversationClearGroupUnread:{sid:28,cid:25,service:Ur,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:Mt(wl)}]},syncConversationReadTime:{sid:4,cid:14,service:Ur,response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamReadTime:{sid:4,cid:20,service:Ur,response:[{type:"LongLongMap",name:"superTeam"}]},v2SyncSessionsWithMoreRoaming:{sid:4,cid:22,service:Ur,response:[]},v2SyncSessionReliableInfo:{sid:4,cid:25,service:Ur,response:[]},v2MarkConversationReadTime:{sid:30,cid:16,service:Ur,params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MarkSuperTeamReadTime:{sid:32,cid:25,service:Ur,params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceConversationReadTime:{sid:30,cid:116,service:Ur,response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceSuperTeamReadTime:{sid:21,cid:125,service:Ur,response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]}},NV=function(){function a(l,t){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.core=l,this.service=t}var p=a.prototype;return p.reset=function(){this.totalUnreadCount=void 0,this.unreadCountByFilter={}},p.getTotalUnreadCount=function(){return this.totalUnreadCount},p.resetTotalAfterSyncDone=function(){var t,e=Cr(t=this.service.model.getAll()).call(t,function(i,o){return i+(o.unreadCount||0)},0),r=this.totalUnreadCount;return r!==void 0&&r===e||(this.totalUnreadCount=e,this.service.emit("onTotalUnreadCountChanged",e)),e},p.digestUnreadCountChange=function(){this._digest()},p._digest=function(){var t,e=this,r=this.totalUnreadCount,i=Cr(t=this.service.model.getAll()).call(t,function(u,h){return u+(h.unreadCount||0)},0);this.core.logger.log("V2NIMConversation::digestUnreadCountChange:oldUnreadCount "+r+", newUnreadCount "+i),r!==i&&(this.totalUnreadCount=i,this.service.emit("onTotalUnreadCountChanged",i));var o=pt(this.unreadCountByFilter);ae(o).call(o,function(u){var h=JSON.parse(u),g=e.getUnreadCountByFilter(h),v=e.unreadCountByFilter[u];e.unreadCountByFilter[u]=g,h.equals=et(fE).call(fE,h),v!==g&&e.service.emit("onUnreadCountChangedByFilter",h,g)})},p.getUnreadCountByIds=function(t){var e=this;return Cr(t).call(t,function(r,i){var o=e.service.model.getById(i);return r+(o&&o.unreadCount||0)},0)},p.getUnreadCountByFilter=function(t){var e,r=this.service.model.count(),i=this.service.model.getByOption(0,r,{conversationTypes:t.conversationTypes,conversationGroupIds:t.conversationGroupId?[t.conversationGroupId]:void 0,ignoreMuted:t.ignoreMuted});return Cr(e=i.conversationList).call(e,function(o,u){return o+(u.unreadCount||0)},0)},p.addFilter=function(t){var e=Rg(t);if(this.unreadCountByFilter[e]!==void 0)throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST});var r=JSON.parse(e),i=this.getUnreadCountByFilter(r);this.unreadCountByFilter[e]=i,this.service.emit("onUnreadCountChangedByFilter",r,i)},p.deleteFilter=function(t){var e=Rg(t);if(this.unreadCountByFilter[e]===void 0)throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});delete this.unreadCountByFilter[e]},a}();function Rg(a){var p=a.conversationTypes;return p&&(p=Tr(p).call(p)),xe({conversationGroupId:a.conversationGroupId,conversationTypes:p,ignoreMuted:a.ignoreMuted})}function fE(a){return xe(this)===Rg(a)}var kV={createTime:{type:"number"},updateTime:{type:"number"}};function mE(a){return a&&a.length>0?se(a).call(a,function(p){return xl(p)}):[]}function xl(a){return Yt(kV,a)}function Pl(a){var p,l=JSON.parse(a);return se(p=pt(l)).call(p,function(t){return{conversationId:t,error:new Me({code:l[t]})}})}var gE,OV={type:{type:"number"},deleteVersion:{type:"number"},conversationIds:{type:"object"}};function vE(a){return Yt(OV,a)}(function(a){a[a.createConversationGroup=1]="createConversationGroup",a[a.deleteConversationGroup=2]="deleteConversationGroup",a[a.updateConversationGroup=3]="updateConversationGroup",a[a.addConversationToGroup=4]="addConversationToGroup",a[a.removeConversationFromGroup=5]="removeConversationFromGroup"})(gE||(gE={}));var wV=function(){function a(l,t){this.core=l,this.service=t}var p=a.prototype;return p.computeConvs=function(t){var e=this;return se(t).call(t,function(r){return e.computeConv(r)})},p.computeConv=function(t){var e,r,i,o,u;if(t.type===0)return t;var h=this.core.V2NIMConversationIdUtil.parseConversationType(t.conversationId),g=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t.conversationId),v={};if(!((e=this.core.V2NIMSettingService)===null||e===void 0)&&e.name&&(v.mute=this.core.V2NIMSettingService.getConversationMuteStatus(t.conversationId)),h===1&&this.hasUserService){var _,I=this.core.V2NIMUserService.model.getUser(g),C=this.hasFriendService?this.core.V2NIMFriendService.model.getFriend(g):void 0;t.conversationId!==((r=t.lastMessage)===null||r===void 0?void 0:r.messageRefer.conversationId)||((i=t.lastMessage)===null||i===void 0?void 0:i.lastMessageState)!==0&&((o=t.lastMessage)===null||o===void 0?void 0:o.lastMessageState)!==2||(_=(u=t.lastMessage)===null||u===void 0?void 0:u.senderName),v.name=(C==null?void 0:C.alias)||(I==null?void 0:I.name)||_||g,v.avatar=(I==null?void 0:I.avatar)||""}else if(h===2&&this.hasTeamService){var A=this.core.V2NIMTeamService.model.getById(g,1);v.name=(A==null?void 0:A.name)||g,v.avatar=(A==null?void 0:A.avatar)||""}else if(h===3&&this.hasTeamService){var N=this.core.V2NIMTeamService.model.getById(g,2);v.name=(N==null?void 0:N.name)||g,v.avatar=(N==null?void 0:N.avatar)||""}return O(t,v),t},p.computeReadTimeForMark=function(t){var e,r,i,o=t.conversationId,u=this.service.model.getReadTime(o);if(!((r=(e=t==null?void 0:t.lastMessage)===null||e===void 0?void 0:e.messageRefer)===null||r===void 0)&&r.createTime)i=t.lastMessage.messageRefer.createTime;else{if(!this.core.timeOrigin.checkNodeReliable())return u||0;i=this.core.timeOrigin.getNTPTime()}return i},Ai(a,[{key:"hasUserService",get:function(){var t;return!!(!((t=this.core.V2NIMUserService)===null||t===void 0)&&t.name)}},{key:"hasFriendService",get:function(){var t;return!!(!((t=this.core.V2NIMFriendService)===null||t===void 0)&&t.name)}},{key:"hasTeamService",get:function(){var t;return!!(!((t=this.core.V2NIMTeamService)===null||t===void 0)&&t.name)}},{key:"hasMessageService",get:function(){var t;return!!(!((t=this.core.V2NIMMessageService)===null||t===void 0)&&t.name)}}]),a}(),xV=OI.entries;je({target:"Object",stat:!0},{entries:function(p){return xV(p)}});var yE,_E,ME,Fr,Ng=we.Object.entries,PV=function(){function a(l,t){this.core=l,this.service=t,this.model=this.service.model,this.logger=this.core.logger}var p=a.prototype;return p.v2ConversationNotifySyncHandler=function(t){this.ifEnabled&&this.service.versionCache.recvConversationFromSyncAction(t)},p.v2ConversationNotifySyncOnlineHandler=function(t){this.ifEnabled&&this.service.versionCache.recvConversation(t)},p.syncConversationReadTimeHandler=function(t){var e,r,i;if(this.ifEnabled){if(!((e=t==null?void 0:t.content)===null||e===void 0)&&e.p2p)for(var o=0,u=Ng(t.content.p2p);o<u.length;o++){var h=u[o],g=h[0],v=h[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(g),v),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(g),v)}if(!((i=(r=t==null?void 0:t.content)===null||r===void 0?void 0:r.team)===null||i===void 0)&&i.m_map)for(var _=0,I=Ng(t.content.team.m_map);_<I.length;_++){var C=I[_],A=C[0],N=C[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(A),N),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(A),N)}}},p.syncSuperTeamReadTimeHandler=function(t){var e,r;if(this.ifEnabled&&(!((r=(e=t==null?void 0:t.content)===null||e===void 0?void 0:e.superTeam)===null||r===void 0)&&r.m_map))for(var i=0,o=Ng(t.content.superTeam.m_map);i<o.length;i++){var u=o[i],h=u[0],g=u[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(h),g),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(h),g)}},p.v2MultiDeviceConversationReadTimeHandler=function(t){var e;this.ifEnabled&&(!((e=t==null?void 0:t.content)===null||e===void 0)&&e.to)&&(t.content.scene===0?(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(t.content.to),t.content.timetag),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(t.content.to),t.content.timetag)):(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(t.content.to),t.content.timetag),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(t.content.to),t.content.timetag)))},p.v2MultiDeviceSuperTeamReadTimeHandler=function(t){var e;this.ifEnabled&&(!((e=t==null?void 0:t.content)===null||e===void 0)&&e.to)&&(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(t.content.to),t.content.timetag),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(t.content.to),t.content.timetag))},Ai(a,[{key:"ifEnabled",get:function(){return this.core.options.enableV2CloudConversation===!0}}]),a}(),LV=function(){function a(l,t){this.core=l,this.service=t,this.model=this.service.model,this.versionCache=this.service.versionCache,this.logger=this.core.logger}var p=a.prototype;return p.setListener=function(){var t,e,r,i,o,u,h,g=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",function(){return g.versionCache.doSync()}),this.core.eventBus.on("V2NIMConversationService/conversationOnlineSyncNotify",et(t=this.conversationOnlineSyncNotify).call(t,this)),this.core.eventBus.on("V2NIMMessageService/sendMessage",et(e=this.sendMessage).call(e,this)),this.core.eventBus.on("V2NIMMessageService/deleteMessages",et(r=this.deleteMessages).call(r,this)),this.core.eventBus.on("V2NIMMessageService/revokeMessages",et(i=this.revokeMessages).call(i,this)),this.core.eventBus.on("V2NIMMessageService/roamingMsgs",et(o=this.roamingOrOfflineMsgs).call(o,this)),this.core.eventBus.on("V2NIMMessageService/offlineMsgs",et(u=this.roamingOrOfflineMsgs).call(u,this)),this.core.eventBus.on("V2NIMSettingService/setMute",et(h=this.setMute).call(h,this))},p.beforeEmit=function(t){for(var e,r,i=this.service.name+"::emit "+t.toString(),o=arguments.length,u=new Array(o>1?o-1:0),h=1;h<o;h++)u[h-1]=arguments[h];if(t==="onConversationCreated"){var g=u[0];this.logger.log(""+i,"id:"+g.conversationId+";unread:"+g.unreadCount+";lastMsg:"+((e=g.lastMessage)===null||e===void 0?void 0:e.messageRefer.messageClientId)+"/"+((r=g.lastMessage)===null||r===void 0?void 0:r.messageRefer.messageServerId))}else if(t==="onConversationChanged"){var v=u[0];this.logger.log(""+i,se(v).call(v,function(C){var A,N;return"id:"+C.conversationId+";unread:"+C.unreadCount+";lastMsg:"+((A=C.lastMessage)===null||A===void 0?void 0:A.messageRefer.messageClientId)+"/"+((N=C.lastMessage)===null||N===void 0?void 0:N.messageRefer.messageServerId)}))}else{var _,I;(_=this.logger).log.apply(_,dt(I=[""+i]).call(I,u))}},p.conversationOnlineSyncNotify=function(t,e){var r;((r=e==null?void 0:e.messageConfig)===null||r===void 0?void 0:r.lastMessageUpdateEnabled)!==!1&&(t.content.info=xt(t.content.info,Mt(wl)),t.content.data=xt(t.content.data,Mt(Sn)),e&&(t.content.data.lastMessage=As(this.core,e,0)),t.content.datas=[t.content.data],this.service.handler.v2ConversationNotifySyncOnlineHandler.call(this,t))},p.sendMessage=function(t,e){var r,i;e===1&&((r=t.messageConfig)===null||r===void 0?void 0:r.historyEnabled)===!0||((i=t==null?void 0:t.messageConfig)===null||i===void 0?void 0:i.lastMessageUpdateEnabled)!==!1&&this.versionCache.updateModelWithLastMessage(t.conversationId,t,2,e)},p.deleteMessages=function(t){var e=se(t).call(t,function(r){return r.messageRefer.conversationId});this.versionCache.backfillLastMsg(e,!0)},p.revokeMessages=function(t){this.versionCache.updateModelByRevoke(t)},p.roamingOrOfflineMsgs=function(t){var e=po(se(t).call(t,function(r){return r.conversationId}));this.versionCache.backfillLastMsg(e,!1)},p.setMute=function(t,e){var r=this.model.getById(t);r&&r.mute!==e&&(r.mute=e,this.model.upsert(r),this.service.triggerConversationChanged([r]))},a}(),TE=function(a){function p(t,e){var r;return e===void 0&&(e={}),(r=a.call(this,"V2NIMConversationService",t)||this).config={},r.model=new CV,r.versionCache=new bV(r.core,Ot(r)),r.unread=new NV(r.core,Ot(r)),r.compute=new wV(r.core,Ot(r)),r.event=new LV(r.core,Ot(r)),r.handler=new PV(r.core,Ot(r)),r.core._registerDep(la,"V2NIMConversationIdUtil"),r.core.options.apiVersion!=="v2"||r.core.options.enableV2CloudConversation!==!0?Ot(r):(Kt({cmdMap:AV,cmdConfig:RV}),r.setOptions(e),r.setListener(),r)}bt(p,a);var l=p.prototype;return l.setOptions=function(e){this.config=O(this.config,e)},l.setListener=function(){this.event.setListener()},l.reset=function(){this.versionCache.reset(),this.model.reset(),this.unread.reset()},l.emit=function(e){for(var r,i,o,u,h=arguments.length,g=new Array(h>1?h-1:0),v=1;v<h;v++)g[v-1]=arguments[v];return(r=this.event).beforeEmit.apply(r,dt(i=[e]).call(i,g)),(o=a.prototype.emit).call.apply(o,dt(u=[this,e]).call(u,g))},l.checkEnable=function(){if(this.core.options.enableV2CloudConversation!==!0)throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2CloudConversation is not enabled"}})},l.getConversationList=function(e,r){this.checkEnable(),this.checkV2(),P({offset:{type:"number",min:0}},{offset:e},"",!0),P({limit:{type:"number",min:1}},{limit:r},"",!0),this.core.V2NIMLoginService.checkIllegalState();var i=this.model.getByOption(e,r,{});return i.conversationList=this.compute.computeConvs(i.conversationList),He.resolve(i)},l.getConversationListByOption=function(e,r,i){this.checkEnable(),this.checkV2(),P({offset:{type:"number",min:0}},{offset:e},"",!0),P({limit:{type:"number",min:1}},{limit:r},"",!0),P({option:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},onlyUnread:{type:"boolean",required:!1},conversationGroupIds:{type:"array",itemType:"string",required:!1}}}},{option:i},"",!0),this.core.V2NIMLoginService.checkIllegalState();var o=this.model.getByOption(e,r,i);return o.conversationList=this.compute.computeConvs(o.conversationList),He.resolve(o)},l.getConversation=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.checkEnable(),this.checkV2(),Nr(this.core.account,e),!(i=this.model.getById(e))){u.next=8;break}return u.abrupt("return",this.compute.computeConv(i));case 8:throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 9:case"end":return u.stop()}},r,this)}))},l.getConversationListByIds=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u=this;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkEnable(),this.checkV2(),P({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),o=at(i=se(e).call(e,function(v){return u.model.getById(v)})).call(i,function(v){return!!v}),o=this.compute.computeConvs(o),g.abrupt("return",o);case 7:case"end":return g.stop()}},r,this)}))},l.createConversation=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.checkEnable(),this.checkV2(),Nr(this.core.account,e),v.next=5,this.core.sendCmd("v2ConversationCreate",{tag:{conversationId:e}});case 5:if(i=v.sent,o=Pe(i,"content.data"),u=Bd(this.core,o),this.versionCache.compareAndUpdateModel([u]),!(h=this.model.getById(e))){v.next=14;break}return v.abrupt("return",this.compute.computeConv(h));case 14:throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 15:case"end":return v.stop()}},r,this)}))},l.deleteConversation=function(e,r){return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkEnable(),this.checkV2(),Nr(this.core.account,e),P({clearMessage:{type:"boolean",required:!1}},{clearMessage:r},"",!0),u.prev=4,u.next=7,this.core.sendCmd("v2ConversationDelete",{tag:{conversationId:e,clearMessage:Number(r||!1)}});case 7:u.next=12;break;case 9:u.prev=9,u.t0=u.catch(4),this.logger.warn("V2NIMConversationService:deleteConversation: delete conversation failed: "+e);case 12:this.model.getById(e)&&(r&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",[e]),this.versionCache.compareAndDeleteModel([e]));case 13:case"end":return u.stop()}},i,this,[[4,9]])}))},l.deleteConversationListByIds=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.checkEnable(),this.checkV2(),P({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),P({clearMessage:{type:"boolean",required:!1}},{clearMessage:r},"",!0),_.next=6,this.core.sendCmd("v2ConversationsDelete",{tag:{conversationIds:xe(e),clearMessage:Number(r||!1)}});case 6:return o=_.sent,u=Pl(Pe(o,"content.info.failedMap")),(h=at(u).call(u,function(I){return I.error.code!==ce.V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST||!g.model.getById(I.conversationId)})).length<e.length&&(r&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",e),this.versionCache.compareAndDeleteModel(e)),_.abrupt("return",h);case 11:case"end":return _.stop()}},i,this)}))},l.stickTopConversation=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.checkEnable(),this.checkV2(),Nr(this.core.account,e),P({stickTop:{type:"boolean"}},{stickTop:r},"",!0),v.next=6,this.core.sendCmd("v2ConversationSetTop",{tag:{conversationId:e,stickTop:Number(r)}});case 6:o=v.sent,u=Pe(o,"content.data"),h=Bd(this.core,u),this.versionCache.compareAndUpdateModel([h]);case 10:case"end":return v.stop()}},i,this)}))},l.updateConversation=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.checkEnable(),this.checkV2(),Nr(this.core.account,e),P({updateInfo:{type:"object",required:!0,rules:{serverExtension:{type:"string"}}}},{updateInfo:r},"",!0),v.next=6,this.core.sendCmd("v2ConversationUpdate",{tag:O({conversationId:e},r)});case 6:o=v.sent,u=Pe(o,"content.data"),h=Bd(this.core,u),this.versionCache.compareAndUpdateModel([h]);case 10:case"end":return v.stop()}},i,this)}))},l.updateConversationLocalExtension=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.checkEnable(),this.checkV2(),Nr(this.core.account,e),P({localExtension:{type:"string"}},{localExtension:r},"",!0),o=this.model.getById(e)){g.next=7;break}throw new Me({code:ce.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 7:if(o.localExtension!==r){g.next=9;break}return g.abrupt("return");case 9:u=O(O({},o),{localExtension:r}),this.model.upsert(u),this.triggerConversationChanged([u]);case 12:case"end":return g.stop()}},i,this)}))},l.getTotalUnreadCount=function(){return this.checkEnable(),this.checkV2(),this.unread.getTotalUnreadCount()||0},l.getUnreadCountByIds=function(e){this.checkEnable(),this.checkV2(),P({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0);var r=this.unread.getUnreadCountByIds(e);return He.resolve(r)},l.getUnreadCountByFilter=function(e){this.checkEnable(),this.checkV2(),this.valiteFilter(e);var r=this.unread.getUnreadCountByFilter(e);return He.resolve(r)},l.clearTotalUnreadCount=function(){return k(this,void 0,void 0,T.mark(function e(){var r,i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkEnable(),this.checkV2(),u.next=4,this.core.sendCmd("v2ConversationClearTotalUnread");case 4:r=u.sent,i=bg(Pe(r,"content.info")),this.versionCache.compareAndClearUnreadInModel(i.oneClickClearUnreadVersion,i.oneClickClearUnreadType);case 7:case"end":return u.stop()}},e,this)}))},l.clearUnreadCountByIds=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkEnable(),this.checkV2(),P({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),g.next=5,this.core.sendCmd("v2ConversationsUnreadClear",{tag:{conversationIds:xe(e)}});case 5:return i=g.sent,o=pc(this.core,Pe(i,"content.datas")),u=Pl(Pe(i,"content.info.failedMap")),this.versionCache.compareAndUpdateModel(o),g.abrupt("return",u);case 10:case"end":return g.stop()}},r,this)}))},l.clearUnreadCountByGroupId=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkEnable(),this.checkV2(),P({groupId:{type:"string"}},{groupId:e},"",!0),o.next=5,this.core.sendCmd("v2ConversationClearGroupUnread",{tag:{groupId:e}});case 5:case"end":return o.stop()}},r,this)}))},l.clearUnreadCountByTypes=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkEnable(),this.checkV2(),P({types:hE},{types:e},"",!0),h.next=5,this.core.sendCmd("v2ConversationClearTypeUnread",{tag:{conversationType:xe(e)}});case 5:i=h.sent,o=bg(Pe(i,"content.info")),this.versionCache.compareAndClearUnreadInModel(o.oneClickClearUnreadVersion,o.oneClickClearUnreadType,{conversationTypes:o.oneClickClearUnreadConversationType});case 8:case"end":return h.stop()}},r,this)}))},l.markConversationRead=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(this.checkEnable(),this.checkV2(),this.checkLogin(),Nr(this.core.account,e),i=this.model.getById(e)){_.next=7;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Conversation not exist"}});case 7:if(o=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),u=this.core.V2NIMConversationIdUtil.parseConversationType(e),h=this.model.getReadTime(e),g=this.compute.computeReadTimeForMark(i),!(h>=g)){_.next=14;break}return this.logger.log("V2Conv::markConversationRead currentReadTime >= readTime "+e+","+h+","+g),_.abrupt("return",h);case 14:if(u!==3){_.next=19;break}return _.next=17,this.core.sendCmd("v2MarkSuperTeamReadTime",{timetag:g,to:o});case 17:_.next=21;break;case 19:return _.next=21,this.core.sendCmd("v2MarkConversationReadTime",{scene:u===1?0:u===2?1:2,timetag:g,to:o});case 21:return this.model.updateReadTime(e,g),_.abrupt("return",g);case 23:case"end":return _.stop()}},r,this)}))},l.getConversationReadTime=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkEnable(),this.checkV2(),Nr(this.core.account,e),o.abrupt("return",this.model.getReadTime(e));case 4:case"end":return o.stop()}},r,this)}))},l.subscribeUnreadCountByFilter=function(e){var r;this.checkEnable(),this.checkV2(),this.checkLogin(),this.valiteFilter(e),((r=e.conversationTypes)===null||r===void 0?void 0:r.length)===0&&delete e.conversationTypes,this.unread.addFilter(e)},l.unsubscribeUnreadCountByFilter=function(e){var r;this.checkEnable(),this.checkV2(),this.checkLogin(),this.valiteFilter(e),((r=e.conversationTypes)===null||r===void 0?void 0:r.length)===0&&delete e.conversationTypes,this.unread.deleteFilter(e)},l.valiteFilter=function(e){if(P({filter:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},conversationGroupId:{type:"string",allowEmpty:!1,required:!1},ignoreMuted:{type:"boolean",required:!1}}}},{filter:e},"",!0),e.conversationTypes===void 0&&e.conversationGroupId===void 0&&e.ignoreMuted!==!0)throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Filter cannot be empty"}})},l.triggerConversationChanged=function(e){e=this.compute.computeConvs(e),e=JSON.parse(xe(e)),ae(e).call(e,function(r){r.lastMessage||(r.lastMessage=void 0),delete r.lastMessageState}),this.emit("onConversationChanged",e)},l.triggerConversationCreated=function(e){e=this.compute.computeConv(e),delete(e=JSON.parse(xe(e))).lastMessageState,this.emit("onConversationCreated",e)},p}($r),VV={"28_9":"v2ConversationGroupCreate","28_10":"v2ConversationGroupDelete","28_11":"v2ConversationGroupUpdate","28_12":"v2ConversationGroupGet","28_13":"v2ConversationGroupsGet","28_14":"v2ConversationGroupListGet","28_15":"v2ConversationGroupAddTo","28_16":"v2ConversationGroupRemoveFrom","28_22":"v2ConversationGroupNotifySyncOnline"},Rs="V2NIMConversationGroupService",hc={groupId:1,name:2,serverExtension:3,createTime:4,updateTime:5},DV={v2ConversationGroupCreate:{sid:28,cid:9,service:Rs,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:Mt(hc)},{type:"PropertyArray",name:"conversations",reflectMapper:Mt(Sn)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupDelete:{sid:28,cid:10,service:Rs,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"groupList"}}]},v2ConversationGroupUpdate:{sid:28,cid:11,service:Rs,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:Mt(hc)}]},v2ConversationGroupGet:{sid:28,cid:12,service:Rs,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"data",reflectMapper:Mt(hc)}]},v2ConversationGroupsGet:{sid:28,cid:13,service:Rs,params:[{type:"Property",name:"tag",reflectMapper:{groupIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Mt(hc)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupListGet:{sid:28,cid:14,service:Rs,response:[{type:"PropertyArray",name:"datas",reflectMapper:Mt(hc)}]},v2ConversationGroupAddTo:{sid:28,cid:15,service:Rs,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Mt(Sn)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupRemoveFrom:{sid:28,cid:16,service:Rs,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Mt(Sn)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupNotifySyncOnline:{sid:28,cid:22,service:Rs,response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"conversationIds"}},{type:"Property",name:"data",reflectMapper:Mt(hc)}]}},UV=function(a){function p(t,e){var r;return e===void 0&&(e={}),(r=a.call(this,"V2NIMConversationGroupService",t)||this).config={},r.core._registerDep(TE,"V2NIMConversationService"),r.core.options.apiVersion!=="v2"||r.core.options.enableV2CloudConversation!==!0?Ot(r):(Kt({cmdMap:VV,cmdConfig:DV}),r.setOptions(e),r)}bt(p,a);var l=p.prototype;return l.setOptions=function(e){this.config=O(this.config,e)},l.emit=function(e){for(var r,i,o=this.name+"::emit "+e.toString(),u=arguments.length,h=new Array(u>1?u-1:0),g=1;g<u;g++)h[g-1]=arguments[g];if(e==="onConversationsAddedToGroup"){var v=h[0],_=h[1];this.logger.log(""+o,"groupId:"+v,"conversations:"+se(_).call(_,function(A){return A.conversationId}).join(","))}else{var I,C;(I=this.logger).log.apply(I,dt(C=[""+o]).call(C,h))}return(r=a.prototype.emit).call.apply(r,dt(i=[this,e]).call(i,h))},l.checkEnable=function(){if(this.core.options.enableV2CloudConversation!==!0)throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2CloudConversation is not enabled"}})},l.createConversationGroup=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v,_,I=this;return T.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return this.checkEnable(),this.checkV2(),P({name:{type:"string",allowEmpty:!1}},{name:e},"",!0),P({serverExtension:{type:"string",required:!1}},{serverExtension:r},"",!0),P({conversationIds:{type:"array",itemType:"string",required:!1}},{conversationIds:i},"",!0),A.next=7,this.core.sendCmd("v2ConversationGroupCreate",{tag:{name:e,serverExtension:r||"",conversationIds:i&&xe(i)}});case 7:return u=A.sent,h=xl(Pe(u,"content.data")),g=pc(this.core,Pe(u,"content.conversations")),v=Pl(Pe(u,"content.info.failedMap")),this.emit("onConversationGroupCreated",h),g.length>0&&(this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(g),this.emit("onConversationsAddedToGroup",h.groupId,at(_=se(g).call(g,function(N){return I.core.V2NIMConversationService.model.getById(N.conversationId)})).call(_,function(N){return!!N}))),A.abrupt("return",{group:h,failedList:v});case 14:case"end":return A.stop()}},o,this)}))},l.deleteConversationGroup=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkEnable(),this.checkV2(),P({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),h.next=5,this.core.sendCmd("v2ConversationGroupDelete",{tag:{groupId:e}});case 5:i=h.sent,o=vE(Pe(i,"content.info")),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(o.deleteVersion,e),this.emit("onConversationGroupDeleted",e);case 9:case"end":return h.stop()}},r,this)}))},l.updateConversationGroup=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.checkEnable(),this.checkV2(),P({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),P({name:{type:"string",required:!1}},{name:r},"",!0),P({serverExtension:{type:"string",required:!1}},{serverExtension:i},"",!0),r!==void 0||i!==void 0){v.next=7;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 7:return v.next=9,this.core.sendCmd("v2ConversationGroupUpdate",{tag:{groupId:e,name:r,serverExtension:i}});case 9:u=v.sent,h=xl(Pe(u,"content.data")),this.emit("onConversationGroupChanged",h);case 12:case"end":return v.stop()}},o,this)}))},l.addConversationsToGroup=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v,_,I=this;return T.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return this.checkEnable(),this.checkV2(),P({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),P({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:r},"",!0),A.next=6,this.core.sendCmd("v2ConversationGroupAddTo",{tag:{groupId:e,conversationIds:xe(r)}});case 6:return u=A.sent,h=Pe(u,"content.info.failedMap")||"",g=[],h&&(g=Pl(h)),v=pc(this.core,Pe(u,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(v),(_=at(o=se(v).call(v,function(N){return I.core.V2NIMConversationService.model.getById(N.conversationId)})).call(o,function(N){return!!N})).length>0&&this.emit("onConversationsAddedToGroup",e,_),A.abrupt("return",g);case 15:case"end":return A.stop()}},i,this)}))},l.removeConversationsFromGroup=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.checkEnable(),this.checkV2(),P({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),P({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:r},"",!0),_.next=6,this.core.sendCmd("v2ConversationGroupRemoveFrom",{tag:{groupId:e,conversationIds:xe(r)}});case 6:return o=_.sent,u=Pe(o,"content.info.failedMap")||"",h=[],u&&(h=Pl(u)),g=pc(this.core,Pe(o,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(g),this.emit("onConversationsRemovedFromGroup",e,se(g).call(g,function(I){return I.conversationId})),_.abrupt("return",h);case 14:case"end":return _.stop()}},i,this)}))},l.getConversationGroup=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkEnable(),this.checkV2(),P({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),u.next=5,this.core.sendCmd("v2ConversationGroupGet",{tag:{groupId:e}});case 5:return i=u.sent,u.abrupt("return",xl(Pe(i,"content.data")));case 7:case"end":return u.stop()}},r,this)}))},l.getConversationGroupList=function(){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkEnable(),this.checkV2(),o.next=4,this.core.sendCmd("v2ConversationGroupListGet");case 4:return r=o.sent,o.abrupt("return",mE(Pe(r,"content.datas")));case 6:case"end":return o.stop()}},e,this)}))},l.getConversationGroupListByIds=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkEnable(),this.checkV2(),P({groupIds:{type:"array",itemType:"string",min:1}},{groupIds:e},"",!0),g.next=5,this.core.sendCmd("v2ConversationGroupsGet",{tag:{groupIds:e&&xe(e)}});case 5:return o=g.sent,u=mE(Pe(o,"content.datas")),g.abrupt("return",at(i=se(e).call(e,function(v){return at(u).call(u,function(_){return _.groupId===v})[0]})).call(i,function(v){return!!v}));case 8:case"end":return g.stop()}},r,this)}))},l.v2ConversationGroupNotifySyncOnlineHandler=function(e){var r=this;if(this.ifEnabled){var i,o=vE(Pe(e,"content.info")),u=o.type,h=o.deleteVersion,g=o.conversationIds,v=xl(Pe(e,"content.data"));if(this.core.logger.log("v2ConversationGroupNotifySyncOnlineHandler",o,v),u===1)this.emit("onConversationGroupCreated",v),g&&g.length>0&&this.emit("onConversationsAddedToGroup",v.groupId,at(i=se(g).call(g,function(C){return r.core.V2NIMConversationService.model.getById(C)})).call(i,function(C){return!!C}));else if(u===2)this.emit("onConversationGroupDeleted",v.groupId),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(h,v.groupId);else if(u===3)this.emit("onConversationGroupChanged",v);else if(u===4){var _,I=at(_=se(g).call(g,function(C){return r.core.V2NIMConversationService.model.getById(C)})).call(_,function(C){return!!C});this.emit("onConversationsAddedToGroup",v.groupId,I)}else u===5&&this.emit("onConversationsRemovedFromGroup",v.groupId,g)}},Ai(p,[{key:"ifEnabled",get:function(){return this.core.options.enableV2CloudConversation===!0}}]),p}($r),ga="V2NIMMessageLogUtil",FV={"30_6":"v2GetMessageList","33_2":"v2GetMessageListByRefers","30_18":"v2ClearHistoryMessage","7_118":"onClearHistoryMessage","4_24":"syncClearHistoryMessage","31_23":"v2GetTeamMessageList","32_14":"v2GetSuperTeamMessageList"},Ll={conversationType:{id:0,retType:"number"},receiverId:1,deleteRoam:{id:2,converter:Zt},teamId:3,onlineSync:{id:4,converter:Zt},deleteTime:{id:6,retType:"number"},serverExtension:7},kg=[{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"direction"},{type:"LongArray",name:"msgTypes"}],BV={v2GetMessageList:{sid:30,cid:6,service:ga,params:dt(yE=[{type:"String",name:"to"}]).call(yE,kg),response:[{type:"PropertyArray",name:"msgs",reflectMapper:Te(Rt)}]},v2GetMessageListByRefers:{sid:33,cid:2,service:ga,params:[{type:"PropertyArray",name:"tag",reflectMapper:Rt,select:["conversationType","senderId","receiverId","createTime","messageServerId"]}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Te(Rt)}]},v2ClearHistoryMessage:{sid:30,cid:18,service:ga,params:[{type:"Property",name:"tag",reflectMapper:Ll}],response:[{type:"Long",name:"timetag"}]},v2GetTeamMessageList:{sid:31,cid:23,service:ga,params:dt(_E=[{type:"Long",name:"to"}]).call(_E,kg),response:[{type:"PropertyArray",name:"msgs",reflectMapper:Te(Rt)}]},v2GetSuperTeamMessageList:{sid:32,cid:14,service:ga,params:dt(ME=[{type:"Long",name:"to"}]).call(ME,kg),response:[{type:"PropertyArray",name:"msgs",reflectMapper:Te(Rt)}]},onClearHistoryMessage:{sid:7,cid:118,service:ga,response:[{type:"Property",name:"data",reflectMapper:Te(Ll)}]},syncClearHistoryMessage:{sid:4,cid:24,service:ga,response:[{type:"PropertyArray",name:"data",reflectMapper:Te(Ll)}]}},qV=function(a){function p(t){var e;return(e=a.call(this,"V2NIMMessageLogUtil",t)||this).clearHistoryMessageFn=function(r){var i=Tg(e.core,r);e.emitClearHistoryMessage([i])},e.core=t,e.service=e.core.V2NIMMessageService,e.core.options.apiVersion!=="v2"?Ot(e):(Kt({cmdMap:FV,cmdConfig:BV}),e.setListener(),e)}bt(p,a);var l=p.prototype;return l.setListener=function(){this.core.eventBus.on("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",this.clearHistoryMessageFn)},l.getMessageListByRefers=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_=this;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(this.checkV2(),P(pL,{messageRefers:e},"",!0),e.length!==0){C.next=4;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageListByRefers: messageRefers cannot be an empty array"}});case 4:if(u=[],h=se(e).call(e,function(A){var N=_.service.model.getMessageById(A.messageClientId);return!N&&A.messageServerId&&A.messageServerId!=="0"&&u.push(A),N}),g=[],!(u.length>0)){C.next=12;break}return C.next=10,this.core.sendCmd("v2GetMessageListByRefers",{tag:u});case 10:v=C.sent,g=v.content.msgs;case 12:return C.abrupt("return",se(i=at(o=se(h).call(h,function(A,N){if(A)return A;var F=e[N],j=bl(g).call(g,function(W){return W.messageServerId===F.messageServerId});return j?pn(_.core,j):void 0})).call(o,function(A){return A!==void 0})).call(i,function(A){return Xi(A,_.core)}));case 13:case"end":return C.stop()}},r,this)}))},l.getMessageList=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v,_,I,C,A,N,F,j,W,U=this;return T.wrap(function(te){for(;;)switch(te.prev=te.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){te.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:if(P(dL,e,"",!0),Nr(this.core.account,e.conversationId),g=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),v=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),_=g===1?"v2GetMessageList":g===2?"v2GetTeamMessageList":"v2GetSuperTeamMessageList",I=e.beginTime||0,C=e.endTime||0,!(I!==0&&C!==0&&I>C)){te.next=12;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: beginTime cannot be greater than endTime"}});case 12:if(A=e.direction===void 0?0:e.direction,!e.anchorMessage){te.next=29;break}if(e.direction!==0){te.next=23;break}if(C!==0){te.next=19;break}C=e.anchorMessage.createTime,te.next=21;break;case 19:if(C===e.anchorMessage.createTime){te.next=21;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorMessage.createTime"}});case 21:te.next=29;break;case 23:if(I!==0){te.next=27;break}I=e.anchorMessage.createTime,te.next=29;break;case 27:if(I===e.anchorMessage.createTime){te.next=29;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorMessage.createTime"}});case 29:return N=(r=e.anchorMessage)===null||r===void 0?void 0:r.messageServerId,te.next=32,this.core.sendCmd(_,{beginTime:I,endTime:C,lastMsgId:N||0,limit:e.limit||50,direction:A,msgTypes:e.messageTypes?ht(o=e.messageTypes).call(o):[],to:v});case 32:return F=te.sent,j=F.content,W=[],W=se(u=j.msgs).call(u,function(H){return pn(U.core,H)}),N&&(W=at(W).call(W,function(H){return H.messageServerId!==N})),te.abrupt("return",se(h=this.getMessageListMonkeyPatch(W,e)).call(h,function(H){return Xi(H,U.core)}));case 38:case"end":return te.stop()}},i,this)}))},l.getMessageListMonkeyPatch=function(e,r){var i=r.conversationId,o=e,u=Cr(o).call(o,function(ie,te){return ie[te.messageClientId]=!0,ie},{}),h=this.service.model.getMessagesByConversationId(i);h=Tr(h).call(h,function(ie,te){return r.direction===1?ie.createTime-te.createTime:te.createTime-ie.createTime});var g=0,v=r.beginTime||0,_=r.endTime||0;r.anchorMessage&&(r.direction===0?_=r.anchorMessage.createTime:v=r.anchorMessage.createTime,g=Ni(h).call(h,function(ie){var te;return ie.messageClientId===((te=r.anchorMessage)===null||te===void 0?void 0:te.messageClientId)}),g+=1);for(var I=g;I<h.length;I++){var C,A=h[I],N=!u[A.messageClientId],F=A.sendingState===void 0||A.sendingState===1,j=A.conversationId===i,W=A.createTime>v&&(A.createTime<_||_===0),U=!r.messageTypes||_t(C=r.messageTypes).call(C,A.messageType);N&&F&&j&&W&&U&&o.push(h[I])}return o=Tr(o).call(o,function(ie,te){return r.direction===1?ie.createTime-te.createTime:te.createTime-ie.createTime}),ht(o).call(o,0,r.limit||50)},l.clearHistoryMessage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_,I,C;return T.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return this.checkV2(),P(fL,e,"",!0),Nr(this.core.account,e.conversationId),i=e.conversationId,o=e.deleteRoam,u=e.onlineSync,h=e.serverExtension,g=this.core.V2NIMConversationIdUtil.parseConversationType(i),v=this.core.V2NIMConversationIdUtil.parseConversationTargetId(i),_={deleteRoam:o,onlineSync:u,serverExtension:h,conversationType:g},g===1?_.receiverId=v:_.teamId=v,I=this.core.timeOrigin.getNTPTime(),N.next=11,this.core.sendCmd("v2ClearHistoryMessage",{tag:_});case 11:C=N.sent,I=C.content.timetag,this.core.eventBus.emit("forwardSend/V2NIMMessageLogService/clearHistoryMessage",O(O({},_),{deleteTime:I})),this.emitClearHistoryMessage([{deleteTime:I,serverExtension:h,conversationId:i}]);case 15:case"end":return N.stop()}},r,this)}))},l.syncClearHistoryMessageHandler=function(e){var r,i=this,o=se(r=e.content.data).call(r,function(u){return Tg(i.core,u)});this.emitClearHistoryMessage(o)},l.onClearHistoryMessageHandler=function(e){var r=Tg(this.core,e.content.data);this.emitClearHistoryMessage([r])},l.emitClearHistoryMessage=function(e){var r=this;ae(e).call(e,function(i){r.service.model.deleteMessages(i.conversationId,i.deleteTime)}),this.core.eventBus.emit("V2NIMMessageLogUtil/onClearHistoryNotifications",e),this.service.emit("onClearHistoryNotifications",e)},p}($r),Wr="V2NIMMessageExtendUtil",GV={"29_5":"v2VoiceToText","33_15":"v2PinMessage","33_16":"v2UpdatePinMessage","33_17":"v2UnpinMessage","23_18":"onPinMessage","23_19":"onUpdatePinMessage","23_20":"onUnpinMessage","23_115":"onPinMessage","23_116":"onUpdatePinMessage","23_117":"onUnpinMessage","33_21":"v2GetPinMessageList","33_3":"v2AddQuickComment","33_4":"v2RemoveQuickComment","33_7":"v2GetQuickComment","23_5":"onAddQuickComment","23_6":"onRemoveQuickComment","23_103":"onAddQuickComment","23_104":"onRemoveQuickComment","33_8":"v2AddCollection","33_9":"v2RemoveCollections","33_10":"v2UpdateCollectionExtension","33_11":"v2GetCollectionListByOption","30_26":"v2SearchCloudMessagesGroupByConversation","30_27":"v2SearchCloudMessages","30_34":"v2SearchCloudMessagesEx","33_1":"v2GetThreadMessageList"},IE={conversationType:{id:1,converter:Dd,retConverter:Sg,access:"messageRefer.conversationType"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},createTime:{id:4,retType:"number",access:"messageRefer.createTime"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},detail:7,modify:{id:8,retType:"number"}},jV={conversationType:{id:1,access:"messageRefer.conversationType",retConverter:Sg},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},time:{id:4,access:"messageRefer.createTime",converter:Zt,retType:"number"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},operatorId:7,serverExtension:8,createTime:{id:9,converter:Zt,retType:"number"},updateTime:{id:10,converter:Zt,retType:"number"}},qd={operatorId:1,index:{id:2,retType:"number"},createTime:{id:3,retType:"number"},serverExtension:4,pushEnabled:{id:5,access:"pushConfig.pushEnabled",converter:Zt},needBadge:{id:6,access:"pushConfig.needBadge",converter:Zt},title:{id:7,access:"pushConfig.title"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"}},fc={accid:1,serverExtension:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},mc={collectionId:1,collectionType:{id:2,retType:"number"},collectionData:3,serverExtension:4,uniqueId:5,createTime:{id:6,retType:"number"},updateTime:{id:7,retType:"number"}},SE={keyword:1,beginTime:2,endTime:3,messageLimit:5,sortOrder:{id:6,converter:function(p){return p===0?2:1}},p2pAccountIds:{id:7,converter:function(p){return p.join(",")}},teamIds:{id:8,converter:function(p){return p.join(",")}},senderAccountIds:{id:9,converter:function(p){return p.join(",")}},messageTypes:{id:10,converter:function(p){return p.join(",")}},messageSubtypes:{id:11,converter:function(p){return p.join(",")}}},HV={keywordList:{id:1,converter:function(p){return xi(p)}},keywordMatchType:2,searchStartTime:3,searchTimePeriod:4,pageToken:5,limit:7,conversationId:9,senderAccountIds:{id:12,converter:function(p){return p.join(",")}},messageTypes:{id:13,converter:function(p){return p.join(",")}},messageSubtypes:{id:14,converter:function(p){return p.join(",")}}},$V=O(O({},SE),{conversationLimit:4}),KV={v2PinMessage:{sid:33,cid:15,service:Wr,params:[{type:"Property",name:"msg",reflectMapper:Rt,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:fc}],response:[{type:"Long",name:"timetag"}]},v2UnpinMessage:{sid:33,cid:17,service:Wr,params:[{type:"Property",name:"msg",reflectMapper:Rt,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:fc}],response:[{type:"Long",name:"timetag"}]},v2UpdatePinMessage:{sid:33,cid:16,service:Wr,params:[{type:"Property",name:"msg",reflectMapper:Rt,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:fc}],response:[{type:"Long",name:"timetag"}]},v2GetPinMessageList:{sid:33,cid:21,service:Wr,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,timetag:2}}],response:[{type:"Long",name:"timetag"},{type:"Bool",name:"changed"},{type:"PropertyArray",name:"data",reflectMapper:Te(jV)}]},v2VoiceToText:{sid:29,cid:5,service:Wr,params:[{type:"Property",name:"tag",reflectMapper:{mimeType:0,sampleRate:1,voiceUrl:2,duration:3}}],response:[{type:"String",name:"data"}]},v2AddQuickComment:{sid:33,cid:3,service:Wr,params:[{type:"Property",name:"message",reflectMapper:Rt,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:qd}],response:[{type:"Long",name:"timetag"}]},v2RemoveQuickComment:{sid:33,cid:4,service:Wr,params:[{type:"Property",name:"message",reflectMapper:Rt,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:qd}],response:[{type:"Long",name:"timetag"}]},onAddQuickComment:{sid:23,cid:5,service:Wr,response:[{type:"Property",name:"message",reflectMapper:Te(Rt)},{type:"Property",name:"quickComment",reflectMapper:Te(qd)}]},onRemoveQuickComment:{sid:23,cid:6,service:Wr,response:[{type:"Property",name:"message",reflectMapper:Te(Rt)},{type:"Property",name:"quickComment",reflectMapper:Te(qd)}]},v2GetQuickComment:{sid:33,cid:7,service:Wr,params:[{type:"PropertyArray",name:"tag",reflectMapper:IE}],response:[{type:"PropertyArray",name:"data",reflectMapper:Te(IE)}]},onPinMessage:{sid:23,cid:18,service:Wr,response:[{type:"Property",name:"msg",reflectMapper:Te(Rt)},{type:"Property",name:"pinInfo",reflectMapper:Te(fc)}]},onUpdatePinMessage:{sid:23,cid:19,service:Wr,response:[{type:"Property",name:"msg",reflectMapper:Te(Rt)},{type:"Property",name:"pinInfo",reflectMapper:Te(fc)}]},onUnpinMessage:{sid:23,cid:20,service:Wr,response:[{type:"Property",name:"msg",reflectMapper:Te(Rt)},{type:"Property",name:"pinInfo",reflectMapper:Te(fc)}]},v2AddCollection:{sid:33,cid:8,service:Wr,params:[{type:"Property",name:"tag",reflectMapper:mc}],response:[{type:"Property",name:"data",reflectMapper:Te(mc)}]},v2RemoveCollections:{sid:33,cid:9,service:Wr,params:[{type:"PropertyArray",name:"tag",reflectMapper:mc,select:["collectionId","createTime"]}],response:[{type:"Int",name:"data"}]},v2UpdateCollectionExtension:{sid:33,cid:10,service:Wr,params:[{type:"Property",name:"tag",reflectMapper:mc}],response:[{type:"Property",name:"data",reflectMapper:Te(mc)}]},v2GetCollectionListByOption:{sid:33,cid:11,service:Wr,params:[{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeId:3,limit:4,direction:5,collectionType:6}}],response:[{type:"Long",name:"total"},{type:"PropertyArray",name:"data",reflectMapper:Te(mc)}]},v2SearchCloudMessagesGroupByConversation:{sid:30,cid:26,service:Wr,params:[{type:"Property",name:"tag",reflectMapper:$V}],response:[{type:"PropertyArray",name:"data",reflectMapper:Te(Rt)}]},v2SearchCloudMessages:{sid:30,cid:27,service:Wr,params:[{type:"Property",name:"tag",reflectMapper:SE}],response:[{type:"PropertyArray",name:"data",reflectMapper:Te(Rt)}]},v2SearchCloudMessagesEx:{sid:30,cid:34,service:Wr,params:[{type:"Property",name:"tag",reflectMapper:HV}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Te(Rt)},{type:"Int",name:"hasMore"},{type:"String",name:"nextPageToken"}]},v2GetThreadMessageList:{sid:33,cid:1,service:Wr,params:[{type:"Property",name:"messageRefer",reflectMapper:Rt},{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeMessageServerId:3,limit:4,reverse:5}}],response:[{type:"Property",name:"message",reflectMapper:Te(Rt)},{type:"Property",name:"replyResult",reflectMapper:Te({total:{id:1,retType:"number"},timestamp:{id:2,retType:"number"}})},{type:"PropertyArray",name:"replyList",reflectMapper:Te(Rt)}]}},YV=function(a){function p(t){var e;return(e=a.call(this,"V2NIMMessageExtendUtil",t)||this).core=t,e.core.options.apiVersion!=="v2"?Ot(e):(Kt({cmdMap:GV,cmdConfig:KV}),e)}bt(p,a);var l=p.prototype;return l.pinMessage=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P(dc,e,"message",!0),P(_g,{serverExtension:r},"",!0),h.next=5,this.core.sendCmd("v2PinMessage",{msg:e,msgPin:{serverExtension:r}});case 5:o=h.sent,this.emitPinNotification({pinState:1,message:e,serverExtension:r,createTime:o.content.timetag,updateTime:o.content.timetag,operatorId:this.core.account});case 7:case"end":return h.stop()}},i,this)}))},l.unpinMessage=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P(dc,e,"messageRefer",!0),P(_g,{serverExtension:r},"",!0),h.next=5,this.core.sendCmd("v2UnpinMessage",{msg:e,msgPin:{serverExtension:r}});case 5:o=h.sent,this.emitPinNotification({pinState:0,message:e,serverExtension:r,updateTime:o.content.timetag,operatorId:this.core.account});case 7:case"end":return h.stop()}},i,this)}))},l.updatePinMessage=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P(dc,e,"message",!0),P(_g,{serverExtension:r},"",!0),h.next=5,this.core.sendCmd("v2UpdatePinMessage",{msg:e,msgPin:{serverExtension:r}});case 5:o=h.sent,this.emitPinNotification({pinState:2,message:e,serverExtension:r,updateTime:o.content.timetag,operatorId:this.core.account});case 7:case"end":return h.stop()}},i,this)}))},l.getPinnedMessageList=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){_.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:return Nr(this.core.account,e),u=(u=this.core.V2NIMConversationIdUtil.convertToV1ConversationId(e)).replace("superTeam","super_team"),_.next=8,this.core.sendCmd("v2GetPinMessageList",{tag:{conversationId:u,timetag:0}});case 8:return h=_.sent,_.abrupt("return",Tr(i=se(o=h.content.data).call(o,function(I){return O(O({},I),{messageRefer:O(O({},I.messageRefer),{conversationId:g.core.V2NIMConversationIdUtil.messageConversationId(I.messageRefer)})})})).call(i,function(I,C){return C.updateTime-I.updateTime}));case 10:case"end":return _.stop()}},r,this)}))},l.addQuickComment=function(e,r,i,o){return k(this,void 0,void 0,T.mark(function u(){var h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.checkV2(),P(yL,{message:e,index:r,serverExtension:i,pushConfig:o},"",!0),_.next=4,this.core.sendCmd("v2AddQuickComment",{message:e,quickComment:{index:r,serverExtension:i,pushConfig:o}});case 4:h=_.sent,g={operationType:1,quickComment:{messageRefer:Cs(this.core,e),createTime:h.content.timetag,index:r,serverExtension:i||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",g);case 7:case"end":return _.stop()}},u,this)}))},l.removeQuickComment=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.checkV2(),P(dc,e,"messageRefer",!0),P({index:{type:"number",min:1}},{index:r},"",!0),P({serverExtension:{type:"string",required:!1}},{serverExtension:i},"",!0),v.next=6,this.core.sendCmd("v2RemoveQuickComment",{message:e,quickComment:{index:r,serverExtension:i}});case 6:u=v.sent,h={operationType:2,quickComment:{messageRefer:Cs(this.core,e),createTime:u.content.timetag,index:r,serverExtension:i||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",h);case 9:case"end":return v.stop()}},o,this)}))},l.getQuickCommentList=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h=this;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.checkV2(),P(_L,{messages:e},"",!0),o={},v.next=5,this.core.sendCmd("v2GetQuickComment",{tag:se(e).call(e,function(_){return{messageRefer:_}})});case 5:return u=v.sent,ae(i=u.content.data).call(i,function(_){var I,C;try{if(!_.detail)return void(o[I=_.messageRefer.messageClientId]||(o[I]=[]));var A=JSON.parse(_.detail);o[C=_.messageRefer.messageClientId]||(o[C]=[]),ae(A).call(A,function(N){o[_.messageRefer.messageClientId].push({messageRefer:O(O({},_.messageRefer),{conversationId:h.core.V2NIMConversationIdUtil.messageConversationId(_.messageRefer)}),operatorId:N[1],index:it(N[2]),createTime:it(N[3]),serverExtension:N[4]})})}catch(N){h.logger.error("getQuickCommentList JSON Parse Error",_.detail,N)}}),v.abrupt("return",o);case 8:case"end":return v.stop()}},r,this)}))},l.voiceToText=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_,I,C,A,N;return T.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(this.checkV2(),P(vL,e,"",!0),e.voicePath||e.voiceUrl||e.file){j.next=4;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"voiceToText: voicePathvoiceUrlfile cannot be empty at the same time"}});case 4:if(i=e.voicePath,o=e.file,u=e.mimeType,h=e.sampleRate,g=e.duration,v=e.sceneName,_=v?this.core.V2NIMStorageService.getStorageScene(v):null,I=e.voiceUrl){j.next=14;break}return C={},o?C.file=o:(i==null?void 0:wt(i).call(i,"nim-external"))===0?C.fileInput=i:C.filePath=i,j.next=12,this.core.cloudStorage.uploadFile(O({type:"audio",nosScenes:_?_.sceneName:void 0,nosSurvivalTime:_?_.expireTime:void 0},C));case 12:A=j.sent,I=A.url;case 14:return j.next=16,this.core.sendCmd("v2VoiceToText",{tag:{voiceUrl:I,mimeType:u,sampleRate:h,duration:g}},{timeout:3e4});case 16:return N=j.sent,j.abrupt("return",N.content.data);case 18:case"end":return j.stop()}},r,this)}))},l.onPinMessageHandler=function(e){return this.pinMessageChangeHandler(e,1)},l.onUnpinMessageHandler=function(e){return this.pinMessageChangeHandler(e,0)},l.onUpdatePinMessageHandler=function(e){return this.pinMessageChangeHandler(e,2)},l.pinMessageChangeHandler=function(e,r){var i=e.content.msg,o=e.content.pinInfo;i.conversationId=this.core.V2NIMConversationIdUtil.messageConversationId(i),this.emitPinNotification({pinState:r,message:i,serverExtension:o.serverExtension,createTime:o.createTime,updateTime:o.updateTime,operatorId:o.accid})},l.emitPinNotification=function(e){var r={pinState:e.pinState,pin:O(O({serverExtension:e.serverExtension||"",operatorId:e.operatorId},e.createTime?{createTime:e.createTime}:{}),{updateTime:e.updateTime,messageRefer:Cs(this.core,e.message)})};this.core.V2NIMMessageService.emit("onMessagePinNotification",r)},l.onAddQuickCommentHandler=function(e){return this.onQuickCommentNotificationHandler(e,1)},l.onRemoveQuickCommentHandler=function(e){return this.onQuickCommentNotificationHandler(e,2)},l.onQuickCommentNotificationHandler=function(e,r){var i={operationType:r,quickComment:O({messageRefer:O(O({},e.content.message),{conversationId:this.core.V2NIMConversationIdUtil.messageConversationId(e.content.message)})},e.content.quickComment)};this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",i)},l.addCollection=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkV2(),P(ML,{params:e},"",!0),u.next=4,this.core.sendCmd("v2AddCollection",{tag:e});case 4:return i=u.sent,u.abrupt("return",i.content.data);case 6:case"end":return u.stop()}},r,this)}))},l.removeCollections=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkV2(),P(TL,{collections:e},"",!0),u.next=4,this.core.sendCmd("v2RemoveCollections",{tag:e});case 4:return i=u.sent,u.abrupt("return",i.content.data);case 6:case"end":return u.stop()}},r,this)}))},l.updateCollectionExtension=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P(IL,{collection:e,serverExtension:r},"",!0),h.next=4,this.core.sendCmd("v2UpdateCollectionExtension",{tag:O(O({},e),{serverExtension:r})});case 4:return o=h.sent,h.abrupt("return",o.content.data);case 6:case"end":return h.stop()}},i,this)}))},l.getCollectionListByOption=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkV2(),P(k0,e,"",!0),u.next=4,this.getCollectionListExByOption(e);case 4:return i=u.sent,u.abrupt("return",i.collectionList);case 6:case"end":return u.stop()}},r,this)}))},l.getCollectionListExByOption=function(e){var r,i;return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(this.checkV2(),P(k0,e,"",!0),u=e.beginTime||0,h=e.endTime||0,g=e.direction===void 0?0:e.direction,((r=e.anchorCollection)===null||r===void 0?void 0:r.collectionId)===void 0){C.next=21;break}if(e.direction!==0){C.next=15;break}if(h!==0){C.next=11;break}h=e.anchorCollection.createTime,C.next=13;break;case 11:if(h===e.anchorCollection.createTime){C.next=13;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: When providing anchorCollection, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorCollection.createTime"}});case 13:C.next=21;break;case 15:if(u!==0){C.next=19;break}u=e.anchorCollection.createTime,C.next=21;break;case 19:if(u===e.anchorCollection.createTime){C.next=21;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: When providing anchorCollection, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorCollection.createTime"}});case 21:if(!(u!==0&&h!==0&&u>=h)){C.next=23;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: beginTime cannot be greater than endTime"}});case 23:return(v={beginTime:u,endTime:h,direction:g,limit:e.limit,collectionType:e.collectionType,excludeId:!((i=e.anchorCollection)===null||i===void 0)&&i.collectionId?e.anchorCollection.collectionId:0}).collectionType||delete v.collectionType,C.next=27,this.core.sendCmd("v2GetCollectionListByOption",{tag:v});case 27:return _=C.sent,C.abrupt("return",{totalCount:_.content.total,collectionList:_.content.data});case 29:case"end":return C.stop()}},o,this)}))},l.searchCloudMessages=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_,I,C=this;return T.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(this.checkV2(),P(SL,e,"",!0),o=e.beginTime||0,u=e.endTime||0,!(o!==0&&u!==0&&o>u)){N.next=6;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchCloudMessages: beginTime cannot be greater than endTime"}});case 6:return h=e.sortOrder===void 0?0:e.sortOrder,g=e.conversationLimit||0,v=e.messageLimit||10,_=g>0?"v2SearchCloudMessagesGroupByConversation":"v2SearchCloudMessages",N.next=12,this.core.sendCmd(_,{tag:O(O({},e),{beginTime:o,endTime:u,sortOrder:h,conversationLimit:g,messageLimit:v})});case 12:return I=N.sent,N.abrupt("return",se(i=I.content.data).call(i,function(F){return pn(C.core,F)}));case 14:case"end":return N.stop()}},r,this)}))},l.searchCloudMessagesEx=function(e){var r,i,o;return k(this,void 0,void 0,T.mark(function u(){var h,g,v,_,I;return T.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.checkV2(),P(EL,e,"",!0),e.conversationId&&Nr(this.core.account,e.conversationId),((r=e.keywordList)===null||r===void 0?void 0:r.length)||((i=e.senderAccountIds)===null||i===void 0?void 0:i.length)||((o=e.messageTypes)===null||o===void 0?void 0:o.length)){A.next=5;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchCloudMessagesEx: keywordList senderAccountIds messageTypes cannot be empty at the same time"}});case 5:return e.searchTimePeriod===0&&delete e.searchTimePeriod,A.next=8,this.core.sendCmd("v2SearchCloudMessagesEx",{tag:O({},e)});case 8:return h=A.sent,g=h.content,v=g.msgs,_=g.hasMore,I=g.nextPageToken,A.abrupt("return",{count:v.length,items:UL(this.core,v),hasMore:XS(_),nextPageToken:I});case 11:case"end":return A.stop()}},u,this)}))},l.getThreadMessageList=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v=this;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(P(NL,e,"getThreadMessageList",!0),e.beginTime=e.beginTime||0,!(e.endTime&&e.beginTime>e.endTime)){I.next=4;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getThreadMessageList: beginTime cannot be greater than endTime"}});case 4:return I.next=6,this.core.sendCmd("v2GetThreadMessageList",{messageRefer:e.messageRefer,tag:{beginTime:e.beginTime,endTime:e.endTime,limit:e.limit,reverse:e.direction===1?1:0,excludeMessageServerId:e.excludeMessageServerId}});case 6:return i=I.sent,o=i.content,u=o.message,h=o.replyResult,g=o.replyList,I.abrupt("return",{message:pn(this.core,u),timestamp:h.timestamp,replyCount:h.total,replyList:se(g).call(g,function(C){return pn(v.core,C)})});case 9:case"end":return I.stop()}},r,this)}))},p}($r),EE={joinMode:{type:"enum",values:[1,0,2],required:!1},agreeMode:{type:"enum",values:[0,1],required:!1},inviteMode:{type:"enum",values:[1,0],required:!1},updateInfoMode:{type:"enum",values:[1,0],required:!1},updateExtensionMode:{type:"enum",values:[1,0],required:!1},chatBannedMode:{type:"enum",values:[0,1],required:!1}},WV={type:"object",required:!0,rules:O({name:{type:"string",allowEmpty:!1},teamType:{type:"enum",values:[1,2]},memberLimit:{type:"number",min:1,required:!1}},EE)},Ns={type:"array",min:1,itemType:"string"},JV={type:"boolean"},gc={type:"string"},Gd={type:"string",allowEmpty:!1},CE={type:"object",rules:{antispamBusinessId:{type:"string",required:!1}},required:!1},Xr={teamId:{type:"string",regExp:/^[1-9]\d*$/,allowEmpty:!1}},QV={teamIds:{type:"array",itemRules:{type:"string",allowEmpty:!1,regExp:/^[1-9]\d*$/},min:1}},Zr={teamType:{type:"enum",values:[1,2]}},bE={teamTypes:{type:"array",itemType:"enum",values:[1,2],required:!1}},zV={inviteeParams:{type:"object",required:!0,rules:{inviteeAccountIds:Ns,postscript:O(O({},gc),{required:!1}),serverExtension:O(O({},gc),{required:!1})}}},XV={updateTeamInfoParams:{type:"object",required:!0,rules:O({name:{type:"string",allowEmpty:!1,required:!1},memberLimit:{type:"number",min:1,required:!1}},EE)}},ZV={type:"enum",values:[0,2]},eD={memberInfoParams:{type:"object",rules:{teamNick:{type:"string",required:!1},serverExtension:{type:"string",required:!1}}}},tD={chatBannedMode:{type:"enum",values:[0,1]}},rD={queryOption:{type:"object",rules:{roleQueryType:{type:"enum",values:[0,2,1]},onlyChatBanned:{type:"boolean",required:!1},direction:{type:"enum",values:[1,0],required:!1},limit:{type:"number",min:1,required:!1},nextToken:{type:"string",required:!1}}}},Vl={teamId:Xr.teamId,teamType:{type:"enum",values:[1,2]},operatorAccountId:{type:"string",allowEmpty:!1}},nD={actionType:{type:"enum",values:[2,0,1,3]}},AE={actionType:{type:"enum",values:[2]}},RE={actionType:{type:"enum",values:[0]}},iD={types:{type:"array",itemType:"enum",values:[0,2,1,3],required:!1},status:{type:"array",itemType:"enum",values:[1,3,0,2],required:!1},offset:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},NE={teamId:Xr.teamId,teamType:Zr.teamType,accountIds:Ns},sD=function(){function a(){this.teamMap=new Dr,this.superTeamMap=new Dr}var p=a.prototype;return p.set=function(t){var e=this;ae(t).call(t,function(r){e.chooseMap(r.teamType).set(r.teamId,r)})},p.reset=function(){this.teamMap.clear(),this.superTeamMap.clear()},p.count=function(t,e){e===void 0&&(e=!0);var r=this.chooseMap(t),i=0;return ae(r).call(r,function(o){e&&o.isValidTeam&&i++,e||i++}),i},p.chooseMap=function(t){return t===2?this.superTeamMap:t===1?this.teamMap:new Dr},p.getById=function(t,e,r){r===void 0&&(r=!0);var i=this.chooseMap(e).get(t);if(i&&(r&&i.isValidTeam||!r))return i},p.getAll=function(t,e){e===void 0&&(e=!0);var r=this.chooseMap(t),i=vr(fi(r).call(r)),o=at(i).call(i,function(u){return!(!e||!u.isValidTeam)||!e||void 0});return Tr(o).call(o,function(u,h){return h.updateTime-u.updateTime})},p.upsert=function(t){var e=t.teamId,r=t.teamType,i=this.chooseMap(r),o=i.get(e)||{},u=O({},o,t);return i.set(e,u),u},p.deleteById=function(t,e){var r=this.getById(t,e);if(r)return r.isValidTeam=!1,r},p.searchTeamByKeyword=function(t){var e,r,i=[];return ae(e=this.teamMap).call(e,function(o){var u;_t(u=o.name).call(u,t)&&i.push(o)}),ae(r=this.superTeamMap).call(r,function(o){var u;_t(u=o.name).call(u,t)&&i.push(o)}),i},a}(),oD=function(){function a(){this.teamMembers=[],this.superTeamMembers=[],this.maxSize=2e3}var p=a.prototype;return p.reset=function(){this.teamMembers=[],this.superTeamMembers=[]},p.setData=function(t){var e=this;ae(t).call(t,function(r){e.chooseList(r.teamType).push(r)})},p.chooseList=function(t){return t===2?this.superTeamMembers:t===1?this.teamMembers:[]},p.getById=function(t,e,r){var i=this.chooseList(e);return bl(i).call(i,function(o){return o.teamId===t&&o.accountId===r})},p.upsert=function(t){var e=t.teamType,r=t.teamId,i=this.chooseList(e),o=Ni(i).call(i,function(u){return u.teamId===r&&u.accountId===t.accountId});o===-1?i.push(t):i[o]=O(O({},i[o]),t),i.length>this.maxSize&&i.shift()},p.deleteByAccount=function(t,e,r){var i=this.chooseList(e),o=Ni(i).call(i,function(h){return h.teamId===t&&h.accountId===r});if(o!==-1){var u=i[o];return u.inTeam=!1,wn(i).call(i,o,1),u}},p.deleteByTeamId=function(t,e){var r=this.chooseList(e),i=at(r).call(r,function(o){return o.teamId!==t});e===2?this.superTeamMembers=i:this.teamMembers=i},a}(),aD=function(){function a(l,t){this.core=l,this.service=t}var p=a.prototype;return p.processNotification=function(t){var e=this,r=t.attachment,i=t.senderId,o=t.receiverId,u=t.createTime,h=r.id,g=r.data,v=h>400?2:1,_=P0(g,v),I=_.id,C=_.ids,A=_.tinfo,N=_.mute,F=this.service.model.getById(o,v);switch(this.core.logger.log("v2Team::processNotification, notificationType:"+h+", teamId:"+o,g),h){case Fr.SUPER_TEAM_INVITATION:case Fr.TEAM_INVITATION:_t(C).call(C,this.core.account)&&this.onTeamJoined(A),this.onTeamMembersJoined(A,at(C).call(C,function(j){return j!==e.core.account}));break;case Fr.SUPER_TEAM_INVITE_ACCEPT:case Fr.TEAM_INVITE_ACCEPT:i===this.core.account?this.onTeamJoined(A):this.onTeamMemberJoined(A,i);break;case Fr.SUPER_TEAM_APPLY_ACCEPT:case Fr.TEAM_APPLY_ACCEPT:I===this.core.account?this.onTeamJoined(A):this.onTeamMemberJoined(A,I);break;case Fr.SUPER_TEAM_ADD_MANAGER:case Fr.TEAM_ADD_MANAGER:this.updateTeamMemberRole(o,v,C,{memberRole:2,updateTime:u});break;case Fr.SUPER_TEAM_REMOVE_MANAGER:case Fr.TEAM_REMOVE_MANAGER:this.updateTeamMemberRole(o,v,C,{memberRole:0,updateTime:u});break;case Fr.SUPER_TEAM_KICK:case Fr.TEAM_KICK:this.onTeamInfoUpdated(A),ae(C).call(C,function(j){j===e.core.account?e.onTeamLeft(o,v,!0):e.onTeamMemberKicked(i,A.teamId,A.teamType,j)});break;case Fr.SUPER_TEAM_LEAVE:case Fr.TEAM_LEAVE:A?this.onTeamInfoUpdated(A):F&&i===this.core.account&&(F.isValidTeam=!1,this.onTeamInfoUpdated(F)),i===this.core.account?this.onTeamLeft(o,v,!1):this.onTeamMemberLeft(o,v,i);break;case Fr.SUPER_TEAM_DISMISS:case Fr.TEAM_DISMISS:this.onTeamDismissed(o,v);break;case Fr.SUPER_TEAM_UPDATE:case Fr.TEAM_UPDATED:this.onTeamInfoUpdated(A);break;case Fr.SUPER_TEAM_TRANSFER_OWNER:case Fr.TEAM_TRANSFER_OWNER:this.onTeamInfoUpdated(A),this.updateTeamMemberRole(o,v,[i,A.ownerAccountId],[{memberRole:0,updateTime:u},{memberRole:1,updateTime:u}]);break;case Fr.SUPER_TEAM_MEMBER_MUTE:case Fr.TEAM_MEMBER_MUTE:this.service.model.upsert(A),this.updateTeamMemberRole(o,v,I?[I]:C,{chatBanned:N!==0,updateTime:u})}},p.onTeamJoined=function(t){var e=this;this.service.model.upsert(t),this.service.emit("onTeamJoined",t),this.service.getTeamMemberListByIds(t.teamId,t.teamType,[this.core.account]).catch(function(r){e.core.logger.error("Get Member error after onTeamJoined",r)})},p.onTeamLeft=function(t,e,r){var i=this.service.model.deleteById(t,e)||L0(t,e,{isValidTeam:!1});this.service.memberModel.deleteByAccount(t,e,this.core.account),this.service.emit("onTeamLeft",i,r)},p.onTeamDismissed=function(t,e){var r=this.service.model.deleteById(t,e);r||(r=L0(t,e,{isValidTeam:!1})),this.service.memberModel.deleteByTeamId(t,e),this.service.emit("onTeamDismissed",r)},p.onTeamInfoUpdated=function(t){var e=this.service.model.upsert(t);this.service.emit("onTeamInfoUpdated",e)},p.onTeamMemberJoined=function(t,e){this.service.model.upsert(t),this.service.emit("onTeamInfoUpdated",t);var r=t.updateTime||t.createTime,i=ua(t.teamId,t.teamType,e,{joinTime:r,updateTime:r});this.service.emit("onTeamMemberJoined",[i])},p.onTeamMembersJoined=function(t,e){var r=t.updateTime||t.createTime,i=se(e).call(e,function(o){return ua(t.teamId,t.teamType,o,{joinTime:r,updateTime:r})});i.length!==0&&(this.service.model.upsert(t),this.service.emit("onTeamInfoUpdated",t),this.service.emit("onTeamMemberJoined",i))},p.onTeamMemberLeft=function(t,e,r){var i=this.service.memberModel.deleteByAccount(t,e,r);i||(i=ua(t,e,r,{inTeam:!1})),this.service.emit("onTeamMemberLeft",[i])},p.onTeamMemberKicked=function(t,e,r,i){var o=this.service.memberModel.deleteByAccount(e,r,i);o||(o=ua(e,r,i,{inTeam:!1})),this.service.emit("onTeamMemberKicked",t,[o])},p.onTeamMemberInfoUpdated=function(t){var e=this;ae(t).call(t,function(r){if(r.accountId===e.core.account&&e.core.V2NIMSettingService.name&&e.core.V2NIMConversationIdUtil.name){var i=r.teamType===1?e.core.V2NIMConversationIdUtil.teamConversationId(r.teamId):e.core.V2NIMConversationIdUtil.superTeamConversationId(r.teamId),o=e.core.V2NIMSettingService.getConversationMuteStatus(i);e.core.eventBus.emit("V2NIMSettingService/setMute",i,o)}}),this.service.emit("onTeamMemberInfoUpdated",t)},p.updateTeamMemberRole=function(t,e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v,_=this;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!((h=at(r).call(r,function(A,N){var F=_.service.memberModel.getById(t,e,A);return F&&_.service.memberModel.upsert(O(O({},F),qt(i)?i[N]:i)),!F})).length>0)){C.next=12;break}return C.prev=2,C.next=5,this.service.getTeamMemberListByIds(t,e,h);case 5:g=C.sent,ae(g).call(g,function(A){return _.service.memberModel.upsert(A)}),C.next=12;break;case 9:C.prev=9,C.t0=C.catch(2),this.core.logger.warn("v2Team::processNotification, getTeamMemberListByIds failed",C.t0);case 12:(v=at(u=se(r).call(r,function(A){return _.service.memberModel.getById(t,e,A)})).call(u,function(A){return!!A})).length>0&&this.onTeamMemberInfoUpdated(v);case 14:case"end":return C.stop()}},o,this,[[2,9]])}))},p.processSysNotification=function(t){var e=t.receiverId,r=t.postscript,i=t.senderId,o=t.timestamp,u=t.content,h={};try{h=JSON.parse(u)}catch{this.core.logger.warn("v2Team::processSysNotification, parse content failed",u)}var g={actionType:{0:0,1:1,2:2,3:3,15:0,16:1,17:2,18:3}[t.type],teamId:e,teamType:t.type>=15?2:1,operatorAccountId:i,postscript:r,timestamp:o,actionStatus:0};h.attach&&(g.serverExtension=h.attach),this.core.logger.log("v2Team::processSysNotification, type:",t.type,g),this.service.notificationModel.create(g),this.service.emit("onReceiveTeamJoinActionInfo",g)},p.updateTeamActionStatus=function(t,e){this.service.notificationModel.update({teamId:t.teamId,teamType:t.teamType,operatorAccountId:t.operatorAccountId,actionType:t.actionType,actionStatus:e})},p.checkIfExpired=function(t){return!!t&&(t===509||!(t>=500&&t<=599)&&!(t>=19e4))},a}();(function(a){a[a.TEAM_INVITATION=0]="TEAM_INVITATION",a[a.TEAM_KICK=1]="TEAM_KICK",a[a.TEAM_LEAVE=2]="TEAM_LEAVE",a[a.TEAM_UPDATED=3]="TEAM_UPDATED",a[a.TEAM_DISMISS=4]="TEAM_DISMISS",a[a.TEAM_APPLY_ACCEPT=5]="TEAM_APPLY_ACCEPT",a[a.TEAM_TRANSFER_OWNER=6]="TEAM_TRANSFER_OWNER",a[a.TEAM_ADD_MANAGER=7]="TEAM_ADD_MANAGER",a[a.TEAM_REMOVE_MANAGER=8]="TEAM_REMOVE_MANAGER",a[a.TEAM_INVITE_ACCEPT=9]="TEAM_INVITE_ACCEPT",a[a.TEAM_MEMBER_MUTE=10]="TEAM_MEMBER_MUTE",a[a.SUPER_TEAM_INVITATION=401]="SUPER_TEAM_INVITATION",a[a.SUPER_TEAM_KICK=402]="SUPER_TEAM_KICK",a[a.SUPER_TEAM_LEAVE=403]="SUPER_TEAM_LEAVE",a[a.SUPER_TEAM_UPDATE=404]="SUPER_TEAM_UPDATE",a[a.SUPER_TEAM_DISMISS=405]="SUPER_TEAM_DISMISS",a[a.SUPER_TEAM_TRANSFER_OWNER=406]="SUPER_TEAM_TRANSFER_OWNER",a[a.SUPER_TEAM_ADD_MANAGER=407]="SUPER_TEAM_ADD_MANAGER",a[a.SUPER_TEAM_REMOVE_MANAGER=408]="SUPER_TEAM_REMOVE_MANAGER",a[a.SUPER_TEAM_MEMBER_MUTE=409]="SUPER_TEAM_MEMBER_MUTE",a[a.SUPER_TEAM_APPLY_ACCEPT=410]="SUPER_TEAM_APPLY_ACCEPT",a[a.SUPER_TEAM_INVITE_ACCEPT=411]="SUPER_TEAM_INVITE_ACCEPT"})(Fr||(Fr={}));var cD=function(){function a(){this.list=[],this.maxCount=1e3}var p=a.prototype;return p.reset=function(){this.list=[]},p.create=function(t){this.list.push(t),this.list.length>this.maxCount&&this.list.shift()},p.update=function(t){var e;ae(e=this.list).call(e,function(r){r.teamId===t.teamId&&r.teamType===t.teamType&&r.actionType===t.actionType&&r.operatorAccountId===t.operatorAccountId&&r.actionStatus===0&&O(r,t)})},p.delete=function(t){var e,r;this.list=at(e=se(r=this.list).call(r,function(i){if(i.teamId!==t.teamId||i.teamType!==t.teamType||i.operatorAccountId!==t.operatorAccountId||i.actionType!==t.actionType||i.timestamp!==t.timestamp)return i})).call(e,function(i){return i})},p.getByOption=function(t){var e,r=t.types,i=t.status,o=t.offset,u=o===void 0?0:o,h=t.limit,g=h===void 0?50:h,v=[];ae(e=this.list).call(e,function(C){r&&r.length>0&&!_t(r).call(r,C.actionType)||i&&i.length>0&&!_t(i).call(i,C.actionStatus)||v.push(C)}),v=Tr(v).call(v,function(C,A){return A.timestamp-C.timestamp});var _=0;u>0&&(_=eg(v,"timestamp",u),v[_]&&v[_].timestamp===u&&(_+=1));var I=ht(v).call(v,_).length;return(v=ht(v).call(v,_,_+g)).length>0?{offset:I>g?v[v.length-1].timestamp:0,finished:!(I>g),infos:v}:{offset:0,finished:!0,infos:v}},a}(),lD=function(){function a(l,t){this.core=l,this.service=t,this.model=t.model,this.memberModel=t.memberModel,this.notification=t.notification,this.logger=this.core.logger}var p=a.prototype;return p.setListener=function(){var t,e,r,i=this;this.core.eventBus.on("V2NIMTeamService/onSyncStarted",function(){i.service.emit("onSyncStarted")}),this.core.eventBus.on("V2NIMTeamService/onSyncFinished",function(){i.service.emit("onSyncFinished")}),this.core.eventBus.on("V2NIMTeamService/onSyncFailed",function(o){i.service.emit("onSyncFailed",o)}),this.core.eventBus.on("forwardReceive/V2NIMTeamService/created",function(o){i.model.upsert(o);var u=ua(o.teamId,o.teamType,i.core.account,{memberRole:1});i.memberModel.upsert(u),i.service.emit("onTeamCreated",o)}),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",function(o){i.memberModel.upsert(o),i.service.emit("onTeamInfoUpdated",[o])}),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateTeamActionStatus",et(t=this.notification.updateTeamActionStatus).call(t,this.notification)),this.core.eventBus.on("V2NIMTeamService/sysNotification",et(e=this.notification.processSysNotification).call(e,this.notification)),this.core.eventBus.on("V2NIMTeamService/notification",et(r=this.notification.processNotification).call(r,this.notification))},p.beforeEmit=function(t){for(var e=this.service.name+"::emit "+t.toString(),r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];if(t==="onTeamCreated"||t==="onTeamDismissed"||t==="onTeamJoined"||t==="onTeamLeft"||t==="onTeamInfoUpdated"){var u=i[0];this.logger.log(""+e,"team:"+u.teamId+"_"+u.teamType+";updateTime:"+u.updateTime)}else if(t==="onTeamMemberJoined"||t==="onTeamMemberLeft"||t==="onTeamMemberInfoUpdated"){var h=i[0];this.logger.log(""+e,se(h).call(h,function(C){return"team:"+C.teamId+"_"+C.teamType+";account:"+C.accountId}))}else if(t==="onTeamMemberKicked"){var g=i[0],v=i[1];this.logger.log(""+e,"operator"+g,se(v).call(v,function(C){return"team:"+C.teamId+"_"+C.teamType+";account:"+C.accountId}))}else{var _,I;(_=this.logger).log.apply(_,dt(I=[""+e]).call(I,i))}},p.onSyncDone=function(t){t?this.service.emit("onSyncFailed",t):this.service.emit("onSyncFinished")},a}(),uD=function(){function a(l,t){this.core=l,this.service=t,this.model=t.model,this.memberModel=t.memberModel,this.logger=this.core.logger}var p=a.prototype;return p.v2TeamSyncHandler=function(t){this.model.set(t.content.datas)},p.v2SuperTeamSyncHandler=function(t){this.model.set(t.content.datas)},p.v2TeamCreateMultiSyncHandler=function(t){var e=t.content.data;this.model.upsert(e);var r=ua(e.teamId,e.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(r),this.service.emit("onTeamCreated",e)},p.v2SuperTeamCreateMultiSyncHandler=function(t){var e=t.content.data;this.model.upsert(e);var r=ua(e.teamId,e.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(r),this.service.emit("onTeamCreated",e)},p.v2TeamMemberUpdateMultiSyncHandler=function(t){var e=t.content.data;e.teamType=1;var r=this.memberModel.getById(e.teamId,e.teamType,e.accountId);this.service.notification.updateTeamMemberRole(e.teamId,e.teamType,[e.accountId],e),e.accountId===this.core.account&&r&&r.bits!==e.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",e.teamId,e.teamType,e.bits)},p.v2SuperTeamMemberUpdateMultiSyncHandler=function(t){var e=t.content.data;e.teamType=2;var r=this.memberModel.getById(e.teamId,e.teamType,e.accountId);this.service.notification.updateTeamMemberRole(e.teamId,e.teamType,[e.accountId],e),e.accountId===this.core.account&&r&&r.bits!==e.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",e.teamId,e.teamType,e.bits)},p.v2TeamMembersOfSelfInSyncHandler=function(t){var e=this,r=t.content.datas;ae(r).call(r,function(i){i.teamType=1,e.memberModel.upsert(i)})},p.v2SuperTeamMembersOfSelfInSyncHandler=function(t){var e=this,r=t.content.datas;ae(r).call(r,function(i){i.teamType=2,e.memberModel.upsert(i)})},a}(),dD=function(a){function p(t){var e;return(e=a.call(this,"V2NIMTeamService",t)||this).core._registerDep(la,"V2NIMConversationIdUtil"),e.model=new sD,e.memberModel=new oD,e.notificationModel=new cD,e.notification=new aD(t,Ot(e)),e.event=new lD(t,Ot(e)),e.handler=new uD(t,Ot(e)),e.core.options.apiVersion!=="v2"?Ot(e):(Kt({cmdMap:LL,cmdConfig:VL}),e.setListener(),e)}bt(p,a);var l=p.prototype;return l.setListener=function(){this.event.setListener()},l.reset=function(){this.model.reset(),this.memberModel.reset(),this.notificationModel.reset()},l.emit=function(e){for(var r,i,o,u,h=arguments.length,g=new Array(h>1?h-1:0),v=1;v<h;v++)g[v-1]=arguments[v];return(r=this.event).beforeEmit.apply(r,dt(i=[e]).call(i,g)),(o=a.prototype.emit).call.apply(o,dt(u=[this,e]).call(u,g))},l.createTeam=function(e,r,i,o){return k(this,void 0,void 0,T.mark(function u(){var h,g,v,_=this;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return this.checkV2(),P({createTeamParams:WV},{createTeamParams:e},"",!0),P({inviteeAccountIds:O(O({},Ns),{min:0,required:!1})},{inviteeAccountIds:r},"",!0),P({antispamConfig:CE},{antispamConfig:o},"",!0),h=e.teamType===2?"v2SuperTeamCreate":"v2TeamCreate",C.next=7,this.core.sendCmd(h,{team:e,inviteeAccountIds:r||[],postscript:i||"",antispamConfig:o});case 7:return g=C.sent,v=g.content.team,this.model.upsert(v),this.getTeamMemberListByIds(v.teamId,v.teamType,[this.core.account]).catch(function(A){_.core.logger.error("Get Member error after createTeam",A)}),this.emit("onTeamCreated",v),C.abrupt("return",{team:v,failedList:g.content.failedList});case 13:case"end":return C.stop()}},u,this)}))},l.updateTeamInfo=function(e,r,i,o){return k(this,void 0,void 0,T.mark(function u(){var h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P(XV,{updateTeamInfoParams:i},"",!0),P({antispamConfig:CE},{antispamConfig:o},"",!0),h=O({teamId:e,teamType:r},i),g=r===2?"v2SuperTeamUpdateInfo":"v2TeamUpdateInfo",_.next=9,this.core.sendCmd(g,{team:h,antispamConfig:o});case 9:this.model.upsert(h);case 10:case"end":return _.stop()}},u,this)}))},l.leaveTeam=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),o=r===2?"v2SuperTeamLeave":"v2TeamLeave",h.next=6,this.core.sendCmd(o,{teamId:e});case 6:this.model.deleteById(e,r);case 7:case"end":return h.stop()}},i,this)}))},l.getTeamInfo=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),o=r===2?"v2SuperTeamGetInfo":"v2TeamGetInfo",!(u=this.model.getById(e,r,!1))){_.next=7;break}return _.abrupt("return",u);case 7:return _.next=9,this.core.sendCmd(o,{teamId:e});case 9:return h=_.sent,g=h.content.team,this.model.upsert(g),_.abrupt("return",g);case 13:case"end":return _.stop()}},i,this)}))},l.getJoinedTeamList=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o=this;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P(bE,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&e.length!==0||(e=[1,2]),i=[],ae(e).call(e,function(g){i=dt(i).call(i,o.model.getAll(g))}),h.abrupt("return",Tr(i).call(i,function(g,v){return g.createTime-v.createTime}));case 7:case"end":return h.stop()}},r,this)}))},l.getJoinedTeamCount=function(e){var r=this;this.checkV2(),P(bE,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&e.length!==0||(e=[1,2]);var i=0;return ae(e).call(e,function(o){i+=r.model.count(o)}),i},l.getTeamInfoByIds=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v,_,I=this;return T.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.checkV2(),P(QV,{teamIds:e},"",!0),P(Zr,{teamType:r},"",!0),u=r===2?"v2SuperTeamGetByIds":"v2TeamGetByIds",h=se(e).call(e,function(N){return I.model.getById(N,r,!1)}),(g=at(e).call(e,function(N,F){return!h[F]})).length!==0){A.next=8;break}return A.abrupt("return",h);case 8:return A.next=10,this.core.sendCmd(u,{teamIds:g});case 10:return v=A.sent,_=v.content.teams,A.abrupt("return",at(o=se(h).call(h,function(N,F){if(N)return N;var j=e[F],W=bl(_).call(_,function(U){return U.teamId===j});return W&&I.model.upsert(W),W})).call(o,function(N){return!!N}));case 13:case"end":return A.stop()}},i,this)}))},l.dismissTeam=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),o=r===2?"v2SuperTeamDismiss":"v2TeamDismiss",h.next=6,this.core.sendCmd(o,{teamId:e});case 6:case"end":return h.stop()}},i,this)}))},l.inviteMember=function(e,r,i,o){return k(this,void 0,void 0,T.mark(function u(){var h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P({inviteeAccountIds:Ns},{inviteeAccountIds:i},"",!0),P({postscript:O(O({},gc),{required:!1})},{postscript:o},"",!0),h=r===2?"v2SuperTeamInviteMembers":"v2TeamInviteMembers",_.next=8,this.core.sendCmd(h,{teamId:e,accounts:i,ps:o||""});case 8:return g=_.sent,_.abrupt("return",g.content.abortedAccidList);case 10:case"end":return _.stop()}},u,this)}))},l.inviteMemberEx=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P(zV,{inviteeParams:i},"",!0),u=r===2?"v2SuperTeamInviteMembers":"v2TeamInviteMembers",v.next=7,this.core.sendCmd(u,{teamId:e,accounts:i.inviteeAccountIds,ps:i.postscript||"",attach:i.serverExtension});case 7:return h=v.sent,v.abrupt("return",h.content.abortedAccidList);case 9:case"end":return v.stop()}},o,this)}))},l.acceptInvitation=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),P(Vl,e,"invitationInfo",!0),P(AE,e,"invitationInfo",!0),i=e.teamType,o=e.teamId,u=e.operatorAccountId,h=i===2?"v2SuperTeamAcceptInvitation":"v2TeamAcceptInvitation",I.prev=5,I.next=8,this.core.sendCmd(h,{teamId:o,from:u});case 8:return g=I.sent,this.notification.updateTeamActionStatus(e,1),I.abrupt("return",g.content.team);case 13:throw I.prev=13,I.t0=I.catch(5),v=I.t0,this.notification.checkIfExpired(v.code)&&this.notification.updateTeamActionStatus(e,3),I.t0;case 18:case"end":return I.stop()}},r,this,[[5,13]])}))},l.rejectInvitation=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),P(Vl,e,"invitationInfo",!0),P(AE,e,"invitationInfo",!0),P({postscript:O(O({},gc),{required:!1})},{postscript:r},"",!0),o=e.teamType,u=e.teamId,h=e.operatorAccountId,g=o===2?"v2SuperTeamRejectInvite":"v2TeamRejectInvite",I.prev=6,I.next=9,this.core.sendCmd(g,{teamId:u,from:h,ps:r||""});case 9:this.notification.updateTeamActionStatus(e,2),I.next=17;break;case 12:throw I.prev=12,I.t0=I.catch(6),v=I.t0,this.notification.checkIfExpired(v.code)&&this.notification.updateTeamActionStatus(e,3),I.t0;case 17:case"end":return I.stop()}},i,this,[[6,12]])}))},l.kickMember=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P({memberAccountIds:Ns},{memberAccountIds:i},"",!0),u=r===2?"v2SuperTeamKickMembers":"v2TeamKickMembers",g.next=7,this.core.sendCmd(u,{teamId:e,accounts:i});case 7:case"end":return g.stop()}},o,this)}))},l.applyJoinTeam=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),u=r===2?"v2SuperTeamApplyToJoin":"v2TeamApplyToJoin",I.next=6,this.core.sendCmd(u,{teamId:e,ps:i||""});case 6:return h=I.sent,g=h.content.team,v=h.content.isInTeam,g.isValidTeam=!!g.isValidTeam&&!!v,I.abrupt("return",g);case 11:case"end":return I.stop()}},o,this)}))},l.acceptJoinApplication=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.checkV2(),P(Vl,e,"applicationInfo",!0),P(RE,e,"applicationInfo",!0),i=e.teamType,o=e.teamId,u=e.operatorAccountId,h=i===2?"v2SuperTeamAcceptJoinApplication":"v2TeamAcceptJoinApplication",_.prev=5,_.next=8,this.core.sendCmd(h,{teamId:o,from:u});case 8:this.notification.updateTeamActionStatus(e,1),_.next=16;break;case 11:throw _.prev=11,_.t0=_.catch(5),g=_.t0,this.notification.checkIfExpired(g.code)&&this.notification.updateTeamActionStatus(e,3),_.t0;case 16:case"end":return _.stop()}},r,this,[[5,11]])}))},l.rejectJoinApplication=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),P(Vl,e,"applicationInfo",!0),P(RE,e,"applicationInfo",!0),P({postscript:O(O({},gc),{required:!1})},{postscript:r},"",!0),o=e.teamType,u=e.teamId,h=e.operatorAccountId,g=o===2?"v2SuperTeamRejectJoinApplication":"v2TeamRejectJoinApplication",I.prev=6,I.next=9,this.core.sendCmd(g,{teamId:u,from:h,ps:r||""});case 9:this.notification.updateTeamActionStatus(e,2),I.next=17;break;case 12:throw I.prev=12,I.t0=I.catch(6),v=I.t0,this.notification.checkIfExpired(v.code)&&this.notification.updateTeamActionStatus(e,3),I.t0;case 17:case"end":return I.stop()}},i,this,[[6,12]])}))},l.updateTeamMemberRole=function(e,r,i,o){return k(this,void 0,void 0,T.mark(function u(){var h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P({memberAccountIds:Ns},{memberAccountIds:i},"",!0),P({memberRole:ZV},{memberRole:o},"",!0),h=o===2?"AddManagers":"RemoveManagers",h=r===2?"v2SuperTeam"+h:"v2Team"+h,v.next=9,this.core.sendCmd(h,{teamId:e,accounts:po(i)});case 9:case"end":return v.stop()}},u,this)}))},l.transferTeamOwner=function(e,r,i,o){return k(this,void 0,void 0,T.mark(function u(){var h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P({accountId:Gd},{accountId:i},"",!0),P({leave:{type:"boolean",required:!1}},{leave:o},"",!0),!(h=this.model.getById(e,r))||h.ownerAccountId!==i){_.next=8;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Transfer to self is not allowed"}});case 8:return g=r===2?"v2SuperTeamTransferOwner":"v2TeamTransferOwner",_.next=11,this.core.sendCmd(g,{teamId:e,account:i,leave:o||!1});case 11:case"end":return _.stop()}},u,this)}))},l.updateSelfTeamMemberInfo=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P(eD,{memberInfoParams:i},"",!0),i.teamNick!==void 0||i.serverExtension!==void 0){C.next=6;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 6:return u=r===2?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",h=O(O({},i),{teamId:e,accountId:this.core.account}),C.next=10,this.core.sendCmd(u,{teamMember:h});case 10:return C.next=12,this.notification.updateTeamMemberRole(e,r,[this.core.account],h);case 12:g=this.memberModel.getById(e,r,this.core.account),this.core.V2NIMSettingService.name&&this.core.V2NIMConversationIdUtil.name&&(v=r===1?this.core.V2NIMConversationIdUtil.teamConversationId(e):this.core.V2NIMConversationIdUtil.superTeamConversationId(e),_=this.core.V2NIMSettingService.getConversationMuteStatus(v),this.core.eventBus.emit("V2NIMSettingService/setMute",v,_)),this.core.eventBus.emit("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",g);case 15:case"end":return C.stop()}},o,this)}))},l.updateTeamMemberNick=function(e,r,i,o){return k(this,void 0,void 0,T.mark(function u(){var h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P({accountId:Gd},{accountId:i},"",!0),P({nick:gc},{nick:o},"",!0),i!==this.core.account){v.next=7;break}return v.abrupt("return",this.updateSelfTeamMemberInfo(e,r,{teamNick:o}));case 7:return h=r===2?"v2SuperTeamUpdateMember":"v2TeamUpdateMember",v.next=10,this.core.sendCmd(h,{teamMember:{teamNick:o,teamId:e,accountId:i}});case 10:case"end":return v.stop()}},u,this)}))},l.setTeamChatBannedMode=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P(tD,{chatBannedMode:i},"",!0),u=r===2?"v2SuperTeamSetChatBannedMode":"v2TeamSetChatBannedMode",g.next=7,this.core.sendCmd(u,{teamId:e,chatBannedMode:i});case 7:this.model.upsert({teamId:e,teamType:r,chatBannedMode:i});case 8:case"end":return g.stop()}},o,this)}))},l.setTeamMemberChatBannedStatus=function(e,r,i,o){return k(this,void 0,void 0,T.mark(function u(){var h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P({accountId:Gd},{accountId:i},"",!0),P({chatBanned:JV},{chatBanned:o},"",!0),h=r===2?"v2SuperTeamMemberSetChatBannedStatus":"v2TeamMemberSetChatBannedStatus",v.next=8,this.core.sendCmd(h,{teamId:e,accountId:r===2?[i]:i,chatBanned:o?1:0});case 8:case"end":return v.stop()}},u,this)}))},l.getTeamMemberList=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P(rD,{queryOption:i},"",!0),u=(u=i.direction===void 0?0:i.direction)===0?1:0,I.next=8,this.core.sendCmd("v2TeamMemberGetList",{tag:O(O({teamId:e,teamType:r,onlyChatBanned:!1,nextToken:"",limit:100},i),{direction:u})});case 8:return h=I.sent,g=h.content.datas,v=Pe(h,"raw.r.0"),r===2&&v&&se(v)&&(g=se(v).call(v,function(C){return xt(C,Te(fo))})),I.abrupt("return",{nextToken:h.content.pageInfo.nextToken||"",finished:!+h.content.pageInfo.hasMore,memberList:V0(g,r)});case 13:case"end":return I.stop()}},o,this)}))},l.getTeamMemberListByIds=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v,_,I,C=this;return T.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P({accountIds:Ns},{accountIds:i},"",!0),u=r===2?"v2SuperTeamMemberGetListByIds":"v2TeamMemberGetListByIds",h=se(i).call(i,function(F){return e+"|"+F}),g=[],v=0;case 8:if(!(v<h.length)){N.next=18;break}return N.next=11,this.core.sendCmd(u,{tag:ht(h).call(h,v,v+20)});case 11:_=N.sent,I=V0(_.content.datas,r),g=dt(g).call(g,I),ae(I).call(I,function(F){return C.memberModel.upsert(F)});case 15:v+=20,N.next=8;break;case 18:return N.abrupt("return",g);case 19:case"end":return N.stop()}},o,this)}))},l.getTeamMemberInvitor=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P({accountIds:Ns},{accountIds:i},"",!0),u=r===2?"v2SuperTeamGetMemberInvitor":"v2TeamGetMemberInvitor",v.next=7,this.core.sendCmd(u,{teamId:e,accounts:i});case 7:return h=v.sent,v.abrupt("return",h.content.accountsMap);case 9:case"end":return v.stop()}},o,this)}))},l.searchTeamByKeyword=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),this.checkLogin(),P({keyword:Gd},{keyword:e},"",!0),o.abrupt("return",this.model.searchTeamByKeyword(e));case 4:case"end":return o.stop()}},r,this)}))},l.addTeamMembersFollow=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return this.checkV2(),P(NE,{teamId:e,teamType:r,accountIds:i},"",!0),u=r===2?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",C.next=5,this.getTeamMemberListByIds(e,r,[this.core.account]);case 5:return h=C.sent,g=h[0],C.next=9,this.core.sendCmd(u,{teamMember:{teamId:e},specialFollowUpdate:{accountIds:i,operation:1}});case 9:v=C.sent,_=v.content.data,pt(_).length>0&&(O(g,_),this.emit("onTeamMemberInfoUpdated",[g]),this.memberModel.upsert(g));case 12:case"end":return C.stop()}},o,this)}))},l.removeTeamMembersFollow=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return this.checkV2(),P(NE,{teamId:e,teamType:r,accountIds:i},"",!0),C.next=4,this.getTeamMemberListByIds(e,r,[this.core.account]);case 4:return u=C.sent,h=u[0],g=r===2?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",C.next=9,this.core.sendCmd(g,{teamMember:{teamId:e},specialFollowUpdate:{accountIds:i,operation:0}});case 9:v=C.sent,_=v.content.data,pt(_).length>0&&(O(h,_),this.emit("onTeamMemberInfoUpdated",[h]),this.memberModel.upsert(h));case 12:case"end":return C.stop()}},o,this)}))},l.getTeamJoinActionInfoList=function(e){return this.checkV2(),P(iD,e,"option",!0),this.core.V2NIMLoginService.checkIllegalState(),He.resolve(this.notificationModel.getByOption(e))},l.clearAllTeamJoinActionInfo=function(){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.notificationModel.reset();case 3:case"end":return i.stop()}},e,this)}))},l.deleteTeamJoinActionInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),P(Vl,e,"",!0),P(nD,e,"",!0),P({timestamp:{type:"number",min:1}},e,"",!0),this.notificationModel.delete(e);case 6:case"end":return o.stop()}},r,this)}))},p}($r),ks="V2NIMUserService",pD={"34_3":"v2UpdateBlockList","34_7":"v2GetUserList","34_10":"v2UpdateSelfUserProfile","3_109":"v2SyncSelfUserInfo","3_110":"onUpdateUserProfile","3_103":"onUpdateBlockList","3_8":"syncBlockAndMuteList","34_5":"v2SetP2PMessageMuteMode","3_105":"v2OnUpdateMuteList"},vc={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"}},hD={v2UpdateBlockList:{sid:34,cid:3,service:ks,params:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},v2GetUserList:{sid:34,cid:7,service:ks,params:[{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:Te(vc)}]},v2UpdateSelfUserProfile:{sid:34,cid:10,service:ks,params:[{type:"Property",name:"tag",reflectMapper:vc}],response:[{type:"Long",name:"updateTime"}]},onUpdateUserProfile:{sid:3,cid:110,service:ks,response:[{type:"Property",name:"data",reflectMapper:Te(vc)}]},onUpdateBlockList:{sid:3,cid:103,service:ks,response:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},syncBlockAndMuteList:{sid:3,cid:8,service:ks,response:[{type:"PropertyArray",name:"data",reflectMapper:Te({accountId:0,isMute:{id:1,retType:"boolean"},isBlock:{id:2,retType:"boolean"}})},{type:"Long",name:"timetag"}]},v2SyncSelfUserInfo:{sid:3,cid:109,service:ks,response:[{type:"Property",name:"user",reflectMapper:Te(vc)}]},v2SetP2PMessageMuteMode:{sid:34,cid:5,service:ks,params:[{type:"String",name:"accountId"},{type:"Bool",name:"muteMode"}]},v2OnUpdateMuteList:{sid:3,cid:105,service:ks,response:[{type:"String",name:"accountId"},{type:"Bool",name:"mute"}]}},fD=function(){function a(){this.muteList=new es,this.userMap=new Dr,this.blockList=[]}var p=a.prototype;return p.reset=function(){this.muteList.clear(),this.userMap.clear(),this.blockList=[]},p.setAccountMuteMode=function(t,e){e===1?this.muteList.add(t):this.muteList.delete(t)},p.setUser=function(t){this.userMap.set(t.accountId,t)},p.getUser=function(t){return this.userMap.get(t)},p.getUserListBySearchOption=function(t){var e,r;return at(e=vr(fi(r=this.userMap).call(r))).call(e,function(i){var o,u,h;return!(t.searchName!==void 0&&!t.searchName||!_t(o=i.name).call(o,t.keyword))||!(!t.searchAccountId||!_t(u=i.accountId).call(u,t.keyword))||!!(i.mobile&&t.searchMobile&&_t(h=i.mobile).call(h,t.keyword))})},p.addToBlockList=function(t){var e=this;ae(t).call(t,function(r){var i;_t(i=e.blockList).call(i,r)||e.blockList.push(r)})},p.removeFromBlockList=function(t){var e=this;ae(t).call(t,function(r){var i,o,u=wt(i=e.blockList).call(i,r);u!==-1&&wn(o=e.blockList).call(o,u,1)})},a}(),kE={type:"string",required:!0,allowEmpty:!1},yc={type:"string",required:!1,allowEmpty:!0},mD={name:{type:"string",required:!1,allowEmpty:!0},avatar:yc,sign:yc,email:yc,birthday:yc,mobile:yc,gender:{type:"number",required:!1},serverExtension:yc};function gD(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return OE(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?OE(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OE(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}var wE=function(a){function p(t){var e;return e=a.call(this,"V2NIMUserService",t)||this,Kt({cmdMap:pD,cmdConfig:hD}),e.model=new fD,e.core.options.apiVersion!=="v2"?Ot(e):(e.setListener(),e)}bt(p,a);var l=p.prototype;return l.reset=function(){this.model.reset()},l.setListener=function(){var e=this;this.core.eventBus.on("forwardReceive/V2NIMUserService/updateBlockList",function(r,i){i?e.model.addToBlockList([r]):e.model.removeFromBlockList([r]),i?e.emitBlockListAdded(r):e.emit("onBlockListRemoved",r)}),this.core.eventBus.on("forwardReceive/V2NIMUserService/updateUserProfile",function(r){e.updateUserProfileInMemory(r)})},l.emit=function(e){for(var r,i,o=this.name+"::emit "+e.toString(),u=arguments.length,h=new Array(u>1?u-1:0),g=1;g<u;g++)h[g-1]=arguments[g];if(e==="onUserProfileChanged"){var v=h[0];this.logger.log(""+o,se(v).call(v,function(A){return"id:"+A.accountId+";name:"+A.name+";updateTime:"+A.updateTime}))}else if(e==="onBlockListAdded"){var _=h[0];this.logger.log(""+o,"id:"+_.accountId+";name:"+_.name+";updateTime:"+_.updateTime)}else{var I,C;(I=this.logger).log.apply(I,dt(C=[""+o]).call(C,h))}return(r=a.prototype.emit).call.apply(r,dt(i=[this,e]).call(i,h))},l.getUserList=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),o.abrupt("return",this._getUserList(e));case 2:case"end":return o.stop()}},r,this)}))},l._getUserList=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v=this;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(P({accountIds:Ns},{accountIds:e},"",!0),o=[],ae(e).call(e,function(C){v.model.getUser(C)||o.push(C)}),u=null,!(o.length>0)){I.next=8;break}return I.next=7,this.core.sendCmd("v2GetUserList",{accountIds:o});case 7:u=I.sent;case 8:return h=((r=u==null?void 0:u.content)===null||r===void 0?void 0:r.data)||[],ae(h).call(h,function(C){v.model.setUser(C)}),g=[],ae(e).call(e,function(C){var A=v.model.getUser(C);A&&g.push(A)}),I.abrupt("return",g);case 13:case"end":return I.stop()}},i,this)}))},l.getUserListFromCloud=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.checkV2(),P({accountIds:{type:"array",min:1,max:500,itemType:"string"}},{accountIds:e},"",!0),_.next=4,this.core.sendCmd("v2GetUserList",{accountIds:e});case 4:return i=_.sent,o=i.content.data||[],u=[],ae(o).call(o,function(I){var C=g.model.getUser(I.accountId);g.compareUserForUpdate(C,I)&&u.push(I),g.model.setUser(I)}),h=Cr(e).call(e,function(I,C){var A=g.model.getUser(C);return A&&I.push(A),I},[]),u.length>0&&this.emit("onUserProfileChanged",u),_.abrupt("return",h);case 11:case"end":return _.stop()}},r,this)}))},l.compareUserForUpdate=function(e,r){return!e||!(typeof e.updateTime=="number"&&typeof r.updateTime=="number"&&e.updateTime>=r.updateTime)},l.updateSelfUserProfile=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkV2(),P(mD,e,"",!0),u.next=4,this.core.sendCmd("v2UpdateSelfUserProfile",{tag:O(O({},e),{accountId:this.core.account})});case 4:return i=u.sent,u.next=7,this.updateUserProfileInMemory(O(O({},e),{updateTime:i.content.updateTime}));case 7:case"end":return u.stop()}},r,this)}))},l.addUserToBlockList=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.checkV2(),e!==this.core.account){o.next=3;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot block yourself"}});case 3:return P({accountId:kE},{accountId:e},"",!0),o.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:e,addToBlockList:!0});case 6:this.model.addToBlockList([e]),this.emitBlockListAdded(e);case 8:case"end":return o.stop()}},r,this)}))},l.removeUserFromBlockList=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.checkV2(),e!==this.core.account){o.next=3;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot unblock yourself"}});case 3:return P({accountId:kE},{accountId:e},"",!0),o.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:e,addToBlockList:!1});case 6:this.model.removeFromBlockList([e]),this.emit("onBlockListRemoved",e);case 8:case"end":return o.stop()}},r,this)}))},l.searchUserByOption=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),P({keyword:{type:"string",allowEmpty:!1},searchName:{type:"boolean",required:!1},searchAccountId:{type:"boolean",required:!1},searchMobile:{type:"boolean",required:!1}},e,"",!0),(e.searchName===void 0||e.searchName)!==!1||e.searchAccountId||e.searchMobile){o.next=6;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"one of searchName, searchAccountId, searchMobile must be true"}});case 6:return o.abrupt("return",this.model.getUserListBySearchOption(e));case 7:case"end":return o.stop()}},r,this)}))},l.getBlockList=function(){return this.checkV2(),He.resolve(this.model.blockList)},l.updateUserProfileInMemory=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(i=this.model.getUser(this.core.account))){h.next=6;break}O(i,e),this.model.setUser(i),h.next=10;break;case 6:return h.next=8,this._getUserList([this.core.account]);case 8:o=h.sent,i=o[0];case 10:i&&this.emit("onUserProfileChanged",[i]);case 11:case"end":return h.stop()}},r,this)}))},l.onUpdateUserProfileHandler=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=e.content.data,u.next=3,this.updateUserProfileInMemory(i);case 3:case"end":return u.stop()}},r,this)}))},l.onUpdateBlockListHandler=function(e){var r=e.content.accountId;e.content.addToBlockList?(this.model.addToBlockList([r]),this.emitBlockListAdded(r)):(this.model.removeFromBlockList([r]),this.emit("onBlockListRemoved",r))},l.syncBlockAndMuteListHandler=function(e){var r=this,i=e.content.data;ae(i).call(i,function(o){o.isBlock?r.model.addToBlockList([o.accountId]):r.model.setAccountMuteMode(o.accountId,o.isMute?1:0)})},l.v2SyncSelfUserInfoHandler=function(e){var r=e.content.user;this.model.setUser(r)},l.checkUserUpdate=function(e,r){var i=e.senderId;i!==this.core.account&&this.refreshUserInfo(i,r)},l.refreshUserInfo=function(e,r){return r===void 0&&(r=0),k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(e&&typeof e=="string"){C.next=2;break}return C.abrupt("return");case 2:if(o=this.model.getUser(e),u=[],!(!o||o&&typeof o.updateTime=="number"&&typeof r=="number"&&!isNaN(o.updateTime)&&!isNaN(r)&&o.updateTime<r)){C.next=16;break}return C.prev=5,C.next=8,this.core.sendCmd("v2GetUserList",{accountIds:[e]});case 8:h=C.sent,u=h.content.data,C.next=16;break;case 12:return C.prev=12,C.t0=C.catch(5),this.logger.warn("V2NIMUserService:refreshUserInfo: failed for "+e),C.abrupt("return");case 16:for(g=gD(u);!(v=g()).done;)_=v.value,this.model.setUser(_),this.emit("onUserProfileChanged",[_]);case 17:case"end":return C.stop()}},i,this,[[5,12]])}))},l.emitBlockListAdded=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this._getUserList([e]);case 2:(i=u.sent).length===1&&this.emit("onBlockListAdded",i[0]);case 4:case"end":return u.stop()}},r,this)}))},l.v2OnUpdateMuteListHandler=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:i=e.content,o=i.accountId,u=i.mute,h=u?1:0,this.core.eventBus.emit("v2NIMUserService/updateMuteList",o,h);case 3:case"end":return v.stop()}},r,this)}))},p}($r),Os="V2NIMFriendService",vD={"35_1":"v2AddFriend","35_2":"v2DeleteFriend","35_3":"v2SetFriendInfo","35_4":"v2IncFriendInfo","12_101":"v2OnAddFriend","12_102":"v2OnDeleteFriend","12_103":"v2OnUpdateFriendInfo","12_5":"v2SyncFriendList","12_6":"v2SyncFriendUserList"},jd={accountId:4,relationShip:{id:5,retType:"number"},source:{id:7,retType:"number"},alias:8,serverExtension:10,createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},customerExtension:13},yD={v2AddFriend:{sid:35,cid:1,service:Os,params:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"}],response:[]},v2DeleteFriend:{sid:35,cid:2,service:Os,params:[{type:"String",name:"accountId"},{type:"Property",name:"params",reflectMapper:{deleteAlias:{id:1,converter:Zt}}}]},v2SetFriendInfo:{sid:35,cid:3,service:Os,params:[{type:"Property",name:"tag",reflectMapper:jd}]},v2OnAddFriend:{sid:12,cid:101,service:Os,response:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"},{type:"Property",name:"ext",reflectMapper:Te({serverExt:1})}]},v2OnDeleteFriend:{sid:12,cid:102,service:Os,response:[{type:"String",name:"accountId"}]},v2OnUpdateFriendInfo:{sid:12,cid:103,service:Os,response:[{type:"Property",name:"data",reflectMapper:Te(jd)}]},v2SyncFriendList:{sid:12,cid:5,service:Os,response:[{type:"PropertyArray",name:"friends",reflectMapper:Te(jd)},{type:"Long",name:"timetag"}]},v2SyncFriendUserList:{sid:12,cid:6,service:Os,response:[{type:"PropertyArray",name:"users",reflectMapper:Te(vc)}]},v2IncFriendInfo:{sid:35,cid:4,service:Os,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:Te(jd)},{type:"Long",name:"timetag"}]}},_D={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!0,rules:{addMode:{type:"enum",required:!0,values:[1,2]},postscript:{type:"string",required:!1,allowEmpty:!0}}}},MD={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{deleteAlias:{type:"boolean",required:!1}}}},TD={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{alias:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0}}}},Og={applicantAccountId:{type:"string",required:!0,allowEmpty:!1},recipientAccountId:{type:"string",required:!0,allowEmpty:!1},operatorAccountId:{type:"string",required:!1,allowEmpty:!1},postscript:{type:"string",required:!1,allowEmpty:!0},status:{type:"enum",required:!0,values:[1,4,3,0,2]},timestamp:{type:"number",min:1}},ID={offset:{type:"number",required:!1},limit:{type:"number",required:!1},status:{type:"array",itemType:"enum",required:!1,values:[1,4,3,0,2]}},SD=function(){function a(p,l){this.core=p,this.service=l}return a.prototype.processSysNotification=function(l){if(l.type===6){var t=l.senderId;this.core.V2NIMFriendService.handleDeleteFriend(t,2)}else if(l.type===5)try{var e=JSON.parse(l.content);if((e==null?void 0:e.vt)===1){this.core.V2NIMFriendService.handleAddFriend(l.senderId,l.timestamp);var r={applicantAccountId:l.senderId,recipientAccountId:l.receiverId,operatorAccountId:l.senderId,postscript:l.postscript,timestamp:l.timestamp,status:4,read:!0};this.service.model.appendFriendAddApplication(r),this.service.model.updateFriendAddApplicationStatus(r.applicantAccountId,4,r.applicantAccountId)}else if((e==null?void 0:e.vt)===2){var i={applicantAccountId:l.senderId,recipientAccountId:l.receiverId,operatorAccountId:l.senderId,postscript:l.postscript,timestamp:l.timestamp,status:0,read:!1};this.service.handleApplyFriend(i),this.service.model.appendFriendAddApplication(i)}else if((e==null?void 0:e.vt)===3){this.core.V2NIMFriendService.handleAddFriend(l.senderId,l.timestamp);var o={applicantAccountId:l.receiverId,recipientAccountId:l.senderId,operatorAccountId:l.senderId,timestamp:l.timestamp,postscript:l.postscript,status:1,read:!0};this.service.model.appendFriendAddApplication(o)}else if((e==null?void 0:e.vt)===4){var u={applicantAccountId:l.receiverId,recipientAccountId:l.senderId,operatorAccountId:l.senderId,timestamp:l.timestamp,postscript:l.postscript,status:2,read:!0};this.service.model.appendFriendAddApplication(u),this.service.emit("onFriendAddRejected",u)}}catch(h){this.core.logger.warn("V2NIMFriendNotificationImpl::processSysNotification, parse content error:",h)}},a}();function wg(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return xE(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?xE(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xE(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}var ED=function(){function a(){this.validFriendIds=new es,this.friendMap=new Dr,this.applicationInfoList=[],this.friendTimetag=0}var p=a.prototype;return p.getAddApplicationList=function(t){var e,r,i=t.offset===void 0?0:t.offset,o=Wi(e=at(r=this.applicationInfoList).call(r,function(v){var _=t.status||[];return _.length===0||!!_t(_).call(_,v.status)})).call(e),u=t.limit||50,h=ht(o).call(o,i,i+u),g=i+u>=o.length;return{infos:h,finished:g,offset:g?0:i+u}},p.reset=function(){this.friendMap.clear(),this.validFriendIds.clear(),this.applicationInfoList=[]},p.setAddApplicationRead=function(){for(var t,e=wg(this.applicationInfoList);!(t=e()).done;)t.value.read=!0},p.getAddApplicationUnreadCount=function(){for(var t,e=new es,r=wg(this.applicationInfoList);!(t=r()).done;){var i=t.value;i.read||i.status!==0||e.add(i.applicantAccountId)}return e.size},p.appendFriendAddApplication=function(t){this.applicationInfoList.push(t)},p.clearApplicationList=function(){this.applicationInfoList=[]},p.deleteApplication=function(t){var e,r;this.applicationInfoList=at(e=se(r=this.applicationInfoList).call(r,function(i){if(i.applicantAccountId!==t.applicantAccountId||i.recipientAccountId!==t.recipientAccountId||i.timestamp!==t.timestamp)return i})).call(e,function(i){return i})},p.updateFriendAddApplicationStatus=function(t,e,r){if(e!==0)for(var i,o=wg(this.applicationInfoList);!(i=o()).done;){var u=i.value;u.applicantAccountId===t&&u.status===0&&(u.status=e,u.operatorAccountId=r,u.read=!0)}},p.upsertFriend=function(t,e){delete e.relationShip;var r=this.friendMap.get(t)||{},i=O({accountId:t},r,e);return this.friendMap.set(t,i),this.validFriendIds.add(t),i},p.addFriend=function(t){this.validFriendIds.add(t)},p.deleteFriend=function(t){this.validFriendIds.delete(t)},p.getFriend=function(t){return this.validFriendIds.has(t)?this.friendMap.get(t):void 0},p.getFriendList=function(){var t,e,r,i=this;return at(t=se(e=vr(fi(r=this.validFriendIds).call(r))).call(e,function(o){return i.getFriend(o)})).call(t,function(o){return!!o})},p.getFriendListBySearchOption=function(t){var e,r,i,o=this;return at(e=se(r=vr(fi(i=this.validFriendIds).call(i))).call(r,function(u){return o.getFriend(u)})).call(e,function(u){var h,g,v=t.searchAlias===void 0||t.searchAlias;return u!==void 0&&(!!(v&&u.alias&&_t(h=u.alias).call(h,t.keyword))||!(!t.searchAccountId||!_t(g=u.accountId).call(g,t.keyword)))})},p.getFriendByIds=function(t){var e,r=this;return at(e=se(t).call(t,function(i){return r.getFriend(i)})).call(e,function(i){return!!i})},p.setFriendTimetag=function(t){this.friendTimetag=t},p.getFriendTimetag=function(){return this.friendTimetag},a}(),CD=function(a){function p(t){var e;return(e=a.call(this,"V2NIMFriendService",t)||this).notification=new SD(e.core,Ot(e)),e.model=new ED,e.core._registerDep(wE,"V2NIMUserService"),e.core.options.apiVersion!=="v2"?Ot(e):(Kt({cmdMap:vD,cmdConfig:yD}),e.setListener(),e)}bt(p,a);var l=p.prototype;return l.reset=function(){this.model.reset()},l.setListener=function(){var e,r,i,o,u,h;this.core.eventBus.on("V2NIMFriendService/sysNotification",et(e=this.notification.processSysNotification).call(e,this.notification)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/addFriend",et(r=this.handleAddFriend).call(r,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/deleteFriend",et(i=this.handleDeleteFriend).call(i,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/setFriendInfo",et(o=this.handleSetFriendInfo).call(o,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/acceptAddApplication",et(u=this.handlePassFriendApply).call(u,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/rejectAddApplication",et(h=this.handleRejectFriendApply).call(h,this))},l.emit=function(e){for(var r,i,o=this.name+"::emit "+e.toString(),u=arguments.length,h=new Array(u>1?u-1:0),g=1;g<u;g++)h[g-1]=arguments[g];if(e==="onFriendAdded"||e==="onFriendInfoChanged"){var v=h[0];this.logger.log(""+o,v.accountId+";updateTime:"+v.updateTime)}else{var _,I;(_=this.logger).log.apply(_,dt(I=[""+o]).call(I,h))}return(r=a.prototype.emit).call.apply(r,dt(i=[this,e]).call(i,h))},l.addFriend=function(e,r){return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.checkV2(),e!==this.core.account){u.next=3;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot add yourself"}});case 3:return P(_D,{accountId:e,params:r},"",!0),u.next=6,this.core.sendCmd("v2AddFriend",{accountId:e,verifyType:r.addMode,postscript:r.postscript||""});case 6:if(r.addMode!==1){u.next=9;break}return u.next=9,this.handleAddFriend(e);case 9:case"end":return u.stop()}},i,this)}))},l.deleteFriend=function(e,r){return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.checkV2(),e!==this.core.account){u.next=3;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot delete yourself"}});case 3:return P(MD,{accountId:e,params:r},"",!0),u.next=6,this.core.sendCmd("v2DeleteFriend",{accountId:e,params:r});case 6:r.deleteAlias&&this.model.upsertFriend(e,{alias:""}),this.handleDeleteFriend(e);case 8:case"end":return u.stop()}},i,this)}))},l.acceptAddApplication=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),P(Og,e,"",!0),o.prev=2,o.next=5,this.core.sendCmd("v2AddFriend",{accountId:e.applicantAccountId,verifyType:3,postscript:""});case 5:this.handlePassFriendApply(e.applicantAccountId),o.next=12;break;case 8:throw o.prev=8,o.t0=o.catch(2),this.handlePassFriendApply(e.applicantAccountId,o.t0),o.t0;case 12:case"end":return o.stop()}},r,this,[[2,8]])}))},l.rejectAddApplication=function(e,r){return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkV2(),P(Og,e,"",!0),u.prev=2,u.next=5,this.core.sendCmd("v2AddFriend",{accountId:e.applicantAccountId,verifyType:4,postscript:r||""});case 5:this.handleRejectFriendApply({applicantAccountId:e.applicantAccountId,recipientAccountId:e.recipientAccountId,operatorAccountId:this.core.account,postscript:r||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:2}),u.next=12;break;case 8:throw u.prev=8,u.t0=u.catch(2),this.handleRejectFriendApply({applicantAccountId:e.applicantAccountId,recipientAccountId:e.recipientAccountId,operatorAccountId:this.core.account,postscript:r||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:3},u.t0),u.t0;case 12:case"end":return u.stop()}},i,this,[[2,8]])}))},l.setFriendInfo=function(e,r){return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.checkV2(),P(TD,{accountId:e,params:r},"",!0),e!==this.core.account){u.next=4;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot set yourself"}});case 4:return u.next=6,this.core.sendCmd("v2SetFriendInfo",{tag:O({accountId:e},r)});case 6:this.handleSetFriendInfo(e,r);case 7:case"end":return u.stop()}},i,this)}))},l.getFriendList=function(){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),i.abrupt("return",this.computedFields(this.model.getFriendList()));case 3:case"end":return i.stop()}},e,this)}))},l.getFriendByIds=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),P({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:e},"",!0),o.abrupt("return",this.computedFields(this.model.getFriendByIds(e)));case 4:case"end":return o.stop()}},r,this)}))},l.checkFriend=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o=this;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),P({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:e},"",!0),i={},ae(e).call(e,function(g){i[g]=!!o.model.getFriend(g)}),h.abrupt("return",i);case 6:case"end":return h.stop()}},r,this)}))},l.getAddApplicationList=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),P(ID,e,"",!0),o.abrupt("return",this.model.getAddApplicationList(e));case 4:case"end":return o.stop()}},r,this)}))},l.setAddApplicationRead=function(){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.setAddApplicationRead();case 3:case"end":return i.stop()}},e,this)}))},l.getAddApplicationUnreadCount=function(){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),i.abrupt("return",this.model.getAddApplicationUnreadCount());case 3:case"end":return i.stop()}},e,this)}))},l.clearAllAddApplication=function(){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.clearApplicationList();case 3:case"end":return i.stop()}},e,this)}))},l.deleteAddApplication=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),P(Og,e,"",!0),e.applicantAccountId===this.core.account||e.recipientAccountId===this.core.account){o.next=5;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"The applicant and recipient are not youself"}});case 5:this.model.deleteApplication(e);case 6:case"end":return o.stop()}},r,this)}))},l.searchFriendByOption=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),P({keyword:{type:"string",allowEmpty:!1},searchAccountId:{type:"boolean",required:!1}},e,"",!0),e.searchAlias===void 0||e.searchAlias||e.searchAccountId){o.next=6;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchAlias and searchAccountId cannot be false at the same time"}});case 6:return o.abrupt("return",this.computedFields(this.model.getFriendListBySearchOption(e)));case 7:case"end":return o.stop()}},r,this)}))},l.v2OnAddFriendHandler=function(e){var r=e.content,i=r.accountId,o=r.verifyType,u=r.postscript;if(o===1)this.handleAddFriend(i);else if(o===2){var h={applicantAccountId:this.core.account,recipientAccountId:i,operatorAccountId:this.core.account,postscript:u,timestamp:this.core.timeOrigin.getNTPTime(),status:0,read:!1};this.handleApplyFriend(h)}else if(o===3)this.handlePassFriendApply(i);else if(o===4){var g={applicantAccountId:i,recipientAccountId:this.core.account,operatorAccountId:this.core.account,postscript:u,timestamp:this.core.timeOrigin.getNTPTime(),status:2,read:!0};this.handleRejectFriendApply(g)}},l.v2OnDeleteFriendHandler=function(e){var r=e.content.accountId;this.handleDeleteFriend(r)},l.v2OnUpdateFriendInfoHandler=function(e){var r=e.content.data,i=this.model.upsertFriend(r.accountId,r);this.emit("onFriendInfoChanged",this.computedField(i))},l.v2SyncFriendListHandler=function(e){var r=this,i=e.content,o=i.friends,u=i.timetag;this.model.setFriendTimetag(u),ae(o).call(o,function(h){h.serverExtension||(h.serverExtension=""),h.customerExtension||(h.customerExtension=""),h.relationShip===0?r.model.deleteFriend(h.accountId):r.model.upsertFriend(h.accountId,h)})},l.v2SyncFriendUserListHandler=function(e){var r=this,i=e.content.users;this.hasUserService&&ae(i).call(i,function(o){r.core.V2NIMUserService.model.setUser(o)})},l.handleApplyFriend=function(e){this.emit("onFriendAddApplication",e)},l.handleAddFriend=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.model.addFriend(e),h.next=3,this.incrementSyncFriend();case 3:return h.next=5,this.core.V2NIMUserService.refreshUserInfo(e);case 5:(o=this.model.getFriend(e))&&this.emit("onFriendAdded",this.computedField(o));case 7:case"end":return h.stop()}},i,this)}))},l.handleDeleteFriend=function(e,r){r=r===void 0?1:r,this.emit("onFriendDeleted",e,r),this.model.deleteFriend(e)},l.handleSetFriendInfo=function(e,r){var i=this.model.upsertFriend(e,r);this.emit("onFriendInfoChanged",this.computedField(i))},l.handlePassFriendApply=function(e,r){var i=r?r==null?void 0:r.code:200;if(!(i>=19e4||i===ce.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(i===200||i===ce.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(e,1,this.core.account),this.handleAddFriend(e);else{if(i>=500&&i<=599&&i!==509)return;this.model.updateFriendAddApplicationStatus(e,3,this.core.account)}},l.handleRejectFriendApply=function(e,r){var i=r?r==null?void 0:r.code:200;if(!(i>=19e4||i===ce.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(i===200)this.emit("onFriendAddRejected",e),this.model.updateFriendAddApplicationStatus(e.applicantAccountId,2,this.core.account);else if(i===ce.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(e.applicantAccountId,1,this.core.account);else{if(i>=500&&i<=599&&i!==509)return;this.model.updateFriendAddApplicationStatus(e.applicantAccountId,3,this.core.account)}},l.incrementSyncFriend=function(){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h=this;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.core.sendCmd("v2IncFriendInfo",{timetag:this.model.getFriendTimetag()});case 2:r=v.sent,i=r.content,o=i.friends,u=i.timetag,this.model.setFriendTimetag(u),ae(o).call(o,function(_){h.model.upsertFriend(_.accountId,_)});case 6:case"end":return v.stop()}},e,this)}))},l.computedFields=function(e){var r=this;return se(e).call(e,function(i){return r.computedField(i)})},l.computedField=function(e){var r,i,o=(i=(r=this.core.V2NIMUserService)===null||r===void 0?void 0:r.model)===null||i===void 0?void 0:i.getUser(e.accountId);return o?O({},e,{userProfile:o}):e},Ai(p,[{key:"hasUserService",get:function(){var e;return!!(!((e=this.core.V2NIMUserService)===null||e===void 0)&&e.name)}}]),p}($r),bD={muteMode:{type:"enum",values:[2,0,1]}},AD={accountId:{type:"string",required:!0,allowEmpty:!1},muteMode:{type:"enum",required:!0,values:[2,0,1]}},vo={type:"object",required:!1,rules:{certificateName:{type:"string",required:!0,allowEmpty:!1},appId:{type:"string",required:!1,allowEmpty:!1},appKey:{type:"string",required:!1,allowEmpty:!1},secret:{type:"string",required:!1,allowEmpty:!1}}},RD={config:{type:"object",required:!0,rules:{apns:vo,hwPush:vo,miPush:vo,vivoPush:vo,oppoPush:vo,honorPush:vo,fcmPush:vo,mzPush:vo}}},xg="V2NIMSettingService",ND={"34_1":"v2SetDeviceToken","34_2":"v2SetAppBackground","34_15":"v2SetPushMobileOnDesktopOnline"},kD={v2SetDeviceToken:{sid:34,cid:1,service:xg,params:[{type:"String",name:"certificateName"},{type:"String",name:"pushDeviceToken"},{type:"Int",name:"pushkit"}]},v2SetAppBackground:{sid:34,cid:2,service:xg,params:[{type:"Bool",name:"isBackground"},{type:"Int",name:"badge"}]},v2SetPushMobileOnDesktopOnline:{sid:34,cid:15,service:xg,params:[{type:"Property",name:"tag",reflectMapper:{need:{id:1,converter:function(p){return p?2:1}}}}]}},ws=ws||function(a){var p;typeof window<"u"&&window.crypto&&(p=window.crypto),typeof self<"u"&&self.crypto&&(p=self.crypto),Mf!==void 0&&Mf.crypto&&(p=Mf.crypto),!p&&typeof window<"u"&&window.msCrypto&&(p=window.msCrypto),!p&&typeof fu<"u"&&fu.crypto&&(p=fu.crypto);var l=function(){if(p){if(typeof p.getRandomValues=="function")try{return p.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof p.randomBytes=="function")try{return p.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},t=Ri||function(){function C(){}return function(A){var N;return C.prototype=A,N=new C,C.prototype=null,N}}(),e={},r=e.lib={},i=r.Base={extend:function(A){var N=t(this);return A&&N.mixIn(A),N.hasOwnProperty("init")&&this.init!==N.init||(N.init=function(){N.$super.init.apply(this,arguments)}),N.init.prototype=N,N.$super=this,N},create:function(){var A=this.extend();return A.init.apply(A,arguments),A},init:function(){},mixIn:function(A){for(var N in A)A.hasOwnProperty(N)&&(this[N]=A[N]);A.hasOwnProperty("toString")&&(this.toString=A.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=i.extend({init:function(A,N){A=this.words=A||[],this.sigBytes=N??4*A.length},toString:function(A){return(A||h).stringify(this)},concat:function(A){var N=this.words,F=A.words,j=this.sigBytes,W=A.sigBytes;if(this.clamp(),j%4)for(var U=0;U<W;U++){var ie=F[U>>>2]>>>24-U%4*8&255;N[j+U>>>2]|=ie<<24-(j+U)%4*8}else for(var te=0;te<W;te+=4)N[j+te>>>2]=F[te>>>2];return this.sigBytes+=W,this},clamp:function(){var A=this.words,N=this.sigBytes;A[N>>>2]&=4294967295<<32-N%4*8,A.length=a.ceil(N/4)},clone:function(){var A,N=i.clone.call(this);return N.words=ht(A=this.words).call(A,0),N},random:function(A){for(var N=[],F=0;F<A;F+=4)N.push(l());return new o.init(N,A)}}),u=e.enc={},h=u.Hex={stringify:function(A){for(var N=A.words,F=A.sigBytes,j=[],W=0;W<F;W++){var U=N[W>>>2]>>>24-W%4*8&255;j.push((U>>>4).toString(16)),j.push((15&U).toString(16))}return j.join("")},parse:function(A){for(var N=A.length,F=[],j=0;j<N;j+=2)F[j>>>3]|=it(A.substr(j,2),16)<<24-j%8*4;return new o.init(F,N/2)}},g=u.Latin1={stringify:function(A){for(var N=A.words,F=A.sigBytes,j=[],W=0;W<F;W++){var U=N[W>>>2]>>>24-W%4*8&255;j.push(String.fromCharCode(U))}return j.join("")},parse:function(A){for(var N=A.length,F=[],j=0;j<N;j++)F[j>>>2]|=(255&A.charCodeAt(j))<<24-j%4*8;return new o.init(F,N)}},v=u.Utf8={stringify:function(A){try{return decodeURIComponent(escape(g.stringify(A)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(A){return g.parse(unescape(encodeURIComponent(A)))}},_=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(A){var N;typeof A=="string"&&(A=v.parse(A)),dt(N=this._data).call(N,A),this._nDataBytes+=A.sigBytes},_process:function(A){var N,F=this._data,j=F.words,W=F.sigBytes,U=this.blockSize,ie=W/(4*U),te=(ie=A?a.ceil(ie):a.max((0|ie)-this._minBufferSize,0))*U,H=a.min(4*te,W);if(te){for(var V=0;V<te;V+=U)this._doProcessBlock(j,V);N=wn(j).call(j,0,te),F.sigBytes-=H}return new o.init(N,H)},clone:function(){var A=i.clone.call(this);return A._data=this._data.clone(),A},_minBufferSize:0});r.Hasher=_.extend({cfg:i.extend(),init:function(A){this.cfg=this.cfg.extend(A),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(A){return this._append(A),this._process(),this},finalize:function(A){return A&&this._append(A),this._doFinalize()},blockSize:16,_createHelper:function(A){return function(N,F){return new A.init(F).finalize(N)}},_createHmacHelper:function(A){return function(N,F){return new I.HMAC.init(A,F).finalize(N)}}});var I=e.algo={};return e}(Math),PE=ws.enc.Utf8,Pg=ws,LE=Pg.lib,VE=LE.Base,OD=LE.WordArray,DE=Pg.algo,wD=DE.MD5,xD=DE.EvpKDF=VE.extend({cfg:VE.extend({keySize:4,hasher:wD,iterations:1}),init:function(p){this.cfg=this.cfg.extend(p)},compute:function(p,l){for(var t,e=this.cfg,r=e.hasher.create(),i=OD.create(),o=i.words,u=e.keySize,h=e.iterations;o.length<u;){t&&r.update(t),t=r.update(p).finalize(l),r.reset();for(var g=1;g<h;g++)t=r.finalize(t),r.reset();dt(i).call(i,t)}return i.sigBytes=4*u,i}});Pg.EvpKDF=function(a,p,l){return xD.create(l).compute(a,p)},ws.EvpKDF;var UE=ws,PD=UE.lib.WordArray;UE.enc.Base64={stringify:function(p){var l=p.words,t=p.sigBytes,e=this._map;p.clamp();for(var r=[],i=0;i<t;i+=3)for(var o=(l[i>>>2]>>>24-i%4*8&255)<<16|(l[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|l[i+2>>>2]>>>24-(i+2)%4*8&255,u=0;u<4&&i+.75*u<t;u++)r.push(e.charAt(o>>>6*(3-u)&63));var h=e.charAt(64);if(h)for(;r.length%4;)r.push(h);return r.join("")},parse:function(p){var l=p.length,t=this._map,e=this._reverseMap;if(!e){e=this._reverseMap=[];for(var r=0;r<t.length;r++)e[t.charCodeAt(r)]=r}var i=t.charAt(64);if(i){var o=wt(p).call(p,i);o!==-1&&(l=o)}return function(h,g,v){for(var _=[],I=0,C=0;C<g;C++)if(C%4){var A=v[h.charCodeAt(C-1)]<<C%4*2|v[h.charCodeAt(C)]>>>6-C%4*2;_[I>>>2]|=A<<24-I%4*8,I++}return PD.create(_,I)}(p,l,e)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},ws.enc.Base64,function(a){a.lib.Cipher||function(){var p=a,l=p.lib,t=l.Base,e=l.WordArray,r=l.BufferedBlockAlgorithm,i=p.enc;i.Utf8;var o=i.Base64,u=p.algo.EvpKDF,h=l.Cipher=r.extend({cfg:t.extend(),createEncryptor:function(U,ie){return this.create(this._ENC_XFORM_MODE,U,ie)},createDecryptor:function(U,ie){return this.create(this._DEC_XFORM_MODE,U,ie)},init:function(U,ie,te){this.cfg=this.cfg.extend(te),this._xformMode=U,this._key=ie,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(U){return this._append(U),this._process()},finalize:function(U){return U&&this._append(U),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function W(U){return typeof U=="string"?j:N}return function(U){return{encrypt:function(te,H,V){return W(H).encrypt(U,te,H,V)},decrypt:function(te,H,V){return W(H).decrypt(U,te,H,V)}}}}()});l.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var g=p.mode={},v=l.BlockCipherMode=t.extend({createEncryptor:function(U,ie){return this.Encryptor.create(U,ie)},createDecryptor:function(U,ie){return this.Decryptor.create(U,ie)},init:function(U,ie){this._cipher=U,this._iv=ie}}),_=g.CBC=function(){var W=v.extend();function U(ie,te,H){var V,w=this._iv;w?(V=w,this._iv=void 0):V=this._prevBlock;for(var Y=0;Y<H;Y++)ie[te+Y]^=V[Y]}return W.Encryptor=W.extend({processBlock:function(te,H){var V=this._cipher,w=V.blockSize;U.call(this,te,H,w),V.encryptBlock(te,H),this._prevBlock=ht(te).call(te,H,H+w)}}),W.Decryptor=W.extend({processBlock:function(te,H){var V=this._cipher,w=V.blockSize,Y=ht(te).call(te,H,H+w);V.decryptBlock(te,H),U.call(this,te,H,w),this._prevBlock=Y}}),W}(),I=(p.pad={}).Pkcs7={pad:function(U,ie){for(var te=4*ie,H=te-U.sigBytes%te,V=H<<24|H<<16|H<<8|H,w=[],Y=0;Y<H;Y+=4)w.push(V);var re=e.create(w,H);dt(U).call(U,re)},unpad:function(U){var ie=255&U.words[U.sigBytes-1>>>2];U.sigBytes-=ie}};l.BlockCipher=h.extend({cfg:h.cfg.extend({mode:_,padding:I}),reset:function(){var U;h.reset.call(this);var ie=this.cfg,te=ie.iv,H=ie.mode;this._xformMode==this._ENC_XFORM_MODE?U=H.createEncryptor:(U=H.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==U?this._mode.init(this,te&&te.words):(this._mode=U.call(H,this,te&&te.words),this._mode.__creator=U)},_doProcessBlock:function(U,ie){this._mode.processBlock(U,ie)},_doFinalize:function(){var U,ie=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(ie.pad(this._data,this.blockSize),U=this._process(!0)):(U=this._process(!0),ie.unpad(U)),U},blockSize:4});var C=l.CipherParams=t.extend({init:function(U){this.mixIn(U)},toString:function(U){return(U||this.formatter).stringify(this)}}),A=(p.format={}).OpenSSL={stringify:function(U){var ie,te,H,V=U.ciphertext,w=U.salt;return w?ie=dt(te=dt(H=e.create([1398893684,1701076831])).call(H,w)).call(te,V):ie=V,ie.toString(o)},parse:function(U){var ie,te=o.parse(U),H=te.words;return H[0]==1398893684&&H[1]==1701076831&&(ie=e.create(ht(H).call(H,2,4)),wn(H).call(H,0,4),te.sigBytes-=16),C.create({ciphertext:te,salt:ie})}},N=l.SerializableCipher=t.extend({cfg:t.extend({format:A}),encrypt:function(U,ie,te,H){H=this.cfg.extend(H);var V=U.createEncryptor(te,H),w=V.finalize(ie),Y=V.cfg;return C.create({ciphertext:w,key:te,iv:Y.iv,algorithm:U,mode:Y.mode,padding:Y.padding,blockSize:U.blockSize,formatter:H.format})},decrypt:function(U,ie,te,H){return H=this.cfg.extend(H),ie=this._parse(ie,H.format),U.createDecryptor(te,H).finalize(ie.ciphertext)},_parse:function(U,ie){return typeof U=="string"?ie.parse(U,this):U}}),F=(p.kdf={}).OpenSSL={execute:function(U,ie,te,H){var V;H||(H=e.random(8));var w=u.create({keySize:ie+te}).compute(U,H),Y=e.create(ht(V=w.words).call(V,ie),4*te);return w.sigBytes=4*ie,C.create({key:w,iv:Y,salt:H})}},j=l.PasswordBasedCipher=N.extend({cfg:N.cfg.extend({kdf:F}),encrypt:function(U,ie,te,H){var V=(H=this.cfg.extend(H)).kdf.execute(te,U.keySize,U.ivSize);H.iv=V.iv;var w=N.encrypt.call(this,U,ie,V.key,H);return w.mixIn(V),w},decrypt:function(U,ie,te,H){H=this.cfg.extend(H),ie=this._parse(ie,H.format);var V=H.kdf.execute(te,U.keySize,U.ivSize,ie.salt);return H.iv=V.iv,N.decrypt.call(this,U,ie,V.key,H)}})}()}(ws);var Hd=ws,Lg=Hd.lib.StreamCipher,FE=Hd.algo,$d=FE.RC4=Lg.extend({_doReset:function(){for(var p=this._key,l=p.words,t=p.sigBytes,e=this._S=[],r=0;r<256;r++)e[r]=r;r=0;for(var i=0;r<256;r++){var o=r%t,u=l[o>>>2]>>>24-o%4*8&255;i=(i+e[r]+u)%256;var h=e[r];e[r]=e[i],e[i]=h}this._i=this._j=0},_doProcessBlock:function(p,l){p[l]^=BE.call(this)},keySize:8,ivSize:0});function BE(){for(var a=this._S,p=this._i,l=this._j,t=0,e=0;e<4;e++){l=(l+a[p=(p+1)%256])%256;var r=a[p];a[p]=a[l],a[l]=r,t|=a[(a[p]+a[l])%256]<<24-8*e}return this._i=p,this._j=l,t}Hd.RC4=Lg._createHelper($d);var LD=FE.RC4Drop=$d.extend({cfg:$d.cfg.extend({drop:192}),_doReset:function(){$d._doReset.call(this);for(var p=this.cfg.drop;p>0;p--)BE.call(this)}});Hd.RC4Drop=Lg._createHelper(LD);var VD=ws.RC4,DD=function(a){function p(t){var e;return(e=a.call(this,"V2NIMSettingService",t)||this).offlinePushPlugin=void 0,e.offlinePushConfig=void 0,e.authConfig=void 0,e.aosPushInfo=void 0,e.appBackgroundOptions={badge:0,isBackground:!1},e.p2pMessageMuteModeChangeHandler=function(r,i){e.emit("onP2PMessageMuteModeChanged",r,i),e.hasUserService&&e.core.V2NIMUserService.model.setAccountMuteMode(r,i);var o=e.core.V2NIMConversationIdUtil.p2pConversationId(r),u=i===1;e.core.eventBus.emit("V2NIMSettingService/setMute",o,u)},e.setTokenAndBackgroundStateAfterLogin=function(r){e.aosPushInfo=r,e.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin"),e.offlinePushPlugin&&(e.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin plugin is provided"),e.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin pushType is: ",r&&r.pushType),e.regToken(),e.core.sendCmd("v2SetAppBackground",{isBackground:e.appBackgroundOptions.isBackground,badge:e.appBackgroundOptions.badge||0}))},e.core._registerDep(la,"V2NIMConversationIdUtil"),e.core.options.apiVersion!=="v2"?Ot(e):(e.setListener(),Kt({cmdMap:ND,cmdConfig:kD}),e)}bt(p,a);var l=p.prototype;return l.setListener=function(){var e=this;this.core.eventBus.on("V2NIMSettingService/updateBits",function(r,i,o){e.emit("onTeamMessageMuteModeChanged",r,i,o)}),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",this.setTokenAndBackgroundStateAfterLogin),this.core.eventBus.on("v2NIMUserService/updateMuteList",this.p2pMessageMuteModeChangeHandler),this.core.eventBus.on("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",this.p2pMessageMuteModeChangeHandler)},l.emit=function(e){for(var r,i,o,u,h=this.name+"::emit "+e.toString(),g=arguments.length,v=new Array(g>1?g-1:0),_=1;_<g;_++)v[_-1]=arguments[_];return(r=this.logger).log.apply(r,dt(i=[""+h]).call(i,v)),(o=a.prototype.emit).call.apply(o,dt(u=[this,e]).call(u,v))},l.getConversationMuteStatus=function(e){if(typeof e!="string")return!1;var r=this.core.V2NIMConversationIdUtil.parseConversationType(e),i=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e);return r===3?this.getTeamMessageMuteMode(i,2)!==0:r===2?this.getTeamMessageMuteMode(i,1)!==0:!(r!==1||!this.hasUserService)&&!!this.core.V2NIMUserService.model.muteList.has(i)},l.setTeamMessageMuteMode=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(this.hasTeamService){I.next=2;break}throw new Me({code:ce.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"setTeamMessageMuteMode: no team service"}});case 2:return this.checkV2(),P(Xr,{teamId:e},"",!0),P(Zr,{teamType:r},"",!0),P(bD,{muteMode:i},"",!0),u=r===2?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",h={teamId:e,teamType:r,accountId:this.core.account,bits:i},I.next=10,this.core.sendCmd(u,{teamMember:h});case 10:this.core.V2NIMTeamService.memberModel.upsert(h),this.emit("onTeamMessageMuteModeChanged",e,r,i),g=r===1?this.core.V2NIMConversationIdUtil.teamConversationId(e):this.core.V2NIMConversationIdUtil.superTeamConversationId(e),v=this.getConversationMuteStatus(g),this.core.eventBus.emit("V2NIMSettingService/setMute",g,v);case 15:case"end":return I.stop()}},o,this)}))},l.getTeamMessageMuteMode=function(e,r){var i;return typeof e!="string"||typeof r!="number"?0:this.hasTeamService?3&(((i=this.core.V2NIMTeamService.memberModel.getById(e,r,this.core.account))===null||i===void 0?void 0:i.bits)||0):0},l.setP2PMessageMuteMode=function(e,r){return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.checkV2(),P(AD,{accountId:e,muteMode:r},"",!0),e!==this.core.account){u.next=4;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"can not set mute mode for self"}});case 4:return u.next=6,this.core.sendCmd("v2SetP2PMessageMuteMode",{accountId:e,muteMode:r===1});case 6:this.p2pMessageMuteModeChangeHandler(e,r);case 7:case"end":return u.stop()}},i,this)}))},l.getP2PMessageMuteMode=function(e){return P({accountId:{type:"string",required:!0,allowEmpty:!1}},{accountId:e},"",!0),this.hasUserService&&this.core.V2NIMUserService.model.muteList.has(e)?1:0},l.getRNDeviceInfo=function(){var e;return k(this,void 0,void 0,T.mark(function r(){var i=this;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.logger.log("OfflinePushService:getDeviceInfo start"),(e=this.offlinePushPlugin)===null||e===void 0||e.init(xe(this.authConfig),function(h,g,v){if(i.logger.log("OfflinePushService:: type: "+h+", tokenName: "+g+", token: "+v),v){var _="",I=We.getSystemInfo()||{},C=I.os?I.os.toLowerCase():"";i.aosPushInfo&&i.aosPushInfo.pushType?_=i.aosPushInfo.pushType:C==="ios"?_="":C==="android"&&(_="8"),i.pushTokenToServer(_,v)}else i.logger.warn("OfflinePushService:: token is empty. Please check your parameters")}),u.abrupt("return",new He(function(h,g){var v;(v=i.offlinePushPlugin)===null||v===void 0||v.getDeviceInfo(function(_){try{i.logger.log("OfflinePushService:getDeviceInfo result "+(_?xe(_):"")),h(JSON.parse(_))}catch{g(new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"OfflinePushService:getDeviceInfo error"}}))}}),or(function(){g(new Me({code:ce.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"OfflinePushService:getDeviceInfo timeout"}}))},2e3)}));case 3:case"end":return u.stop()}},r,this)}))},l.getP2PMessageMuteList=function(){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this.hasUserService){i.next=4;break}return i.abrupt("return",He.resolve(vr(this.core.V2NIMUserService.model.muteList)));case 4:return i.abrupt("return",He.resolve([]));case 5:case"end":return i.stop()}},e,this)}))},l.setAppBackground=function(e,r){return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkV2(),P({isBackground:{type:"boolean"},badge:{type:"number",required:!1}},{isBackground:e,badge:r},"",!0),this.appBackgroundOptions={isBackground:e,badge:r||0},u.next=5,this.core.sendCmd("v2SetAppBackground",{isBackground:e,badge:r||0});case 5:case"end":return u.stop()}},i,this)}))},l.setPushMobileOnDesktopOnline=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),P({need:{type:"boolean",required:!1}},{need:e},"",!0),e=e===void 0||e,o.next=5,this.core.sendCmd("v2SetPushMobileOnDesktopOnline",{tag:{need:e}});case 5:case"end":return o.stop()}},r,this)}))},l.setOfflinePushConfig=function(e,r){var i,o,u,h,g,v,_,I,C,A,N,F,j,W,U,ie,te,H,V,w,Y,re,ee,pe,ye,Q,ze,nt,Se,vt,ar,At,Ie,Oe,mt,Je;P(RD,{config:r},"",!0),this.logger.log("setOfflinePushConfig","plugin",e,"config",r),this.offlinePushPlugin=e,this.offlinePushConfig=r,this.authConfig={xmAppId:(o=(i=this.offlinePushConfig)===null||i===void 0?void 0:i.miPush)===null||o===void 0?void 0:o.appId,xmAppKey:(h=(u=this.offlinePushConfig)===null||u===void 0?void 0:u.miPush)===null||h===void 0?void 0:h.appKey,xmCertificateName:(v=(g=this.offlinePushConfig)===null||g===void 0?void 0:g.miPush)===null||v===void 0?void 0:v.certificateName,hwAppId:(I=(_=this.offlinePushConfig)===null||_===void 0?void 0:_.hwPush)===null||I===void 0?void 0:I.appId,hwCertificateName:(A=(C=this.offlinePushConfig)===null||C===void 0?void 0:C.hwPush)===null||A===void 0?void 0:A.certificateName,oppoAppId:(F=(N=this.offlinePushConfig)===null||N===void 0?void 0:N.oppoPush)===null||F===void 0?void 0:F.appId,oppoAppKey:(W=(j=this.offlinePushConfig)===null||j===void 0?void 0:j.oppoPush)===null||W===void 0?void 0:W.appKey,oppoAppSecret:(ie=(U=this.offlinePushConfig)===null||U===void 0?void 0:U.oppoPush)===null||ie===void 0?void 0:ie.secret,oppoCertificateName:(H=(te=this.offlinePushConfig)===null||te===void 0?void 0:te.oppoPush)===null||H===void 0?void 0:H.certificateName,vivoAppId:(w=(V=this.offlinePushConfig)===null||V===void 0?void 0:V.vivoPush)===null||w===void 0?void 0:w.appId,vivoAppKey:(re=(Y=this.offlinePushConfig)===null||Y===void 0?void 0:Y.vivoPush)===null||re===void 0?void 0:re.appKey,vivoCertificateName:(pe=(ee=this.offlinePushConfig)===null||ee===void 0?void 0:ee.vivoPush)===null||pe===void 0?void 0:pe.certificateName,fcmCertificateName:(Q=(ye=this.offlinePushConfig)===null||ye===void 0?void 0:ye.fcmPush)===null||Q===void 0?void 0:Q.certificateName,mzAppId:(nt=(ze=this.offlinePushConfig)===null||ze===void 0?void 0:ze.mzPush)===null||nt===void 0?void 0:nt.appId,mzAppKey:(vt=(Se=this.offlinePushConfig)===null||Se===void 0?void 0:Se.mzPush)===null||vt===void 0?void 0:vt.appKey,mzCertificateName:(At=(ar=this.offlinePushConfig)===null||ar===void 0?void 0:ar.mzPush)===null||At===void 0?void 0:At.certificateName,apnsCertificateName:(Oe=(Ie=this.offlinePushConfig)===null||Ie===void 0?void 0:Ie.apns)===null||Oe===void 0?void 0:Oe.certificateName,honorCertificateName:(Je=(mt=this.offlinePushConfig)===null||mt===void 0?void 0:mt.honorPush)===null||Je===void 0?void 0:Je.certificateName}},l.regToken=function(){var e=this,r=We.getSystemInfo()||{},i=r.os?r.os.toLowerCase():"";if(this.logger.log("OfflinePushService: os",i),i==="ios"||i==="android")if(!this.offlinePushPlugin||We.platform==="UNIAPP"&&typeof this.offlinePushPlugin.getDeviceToken!="function"||We.platform==="React Native"&&i==="android"&&typeof this.offlinePushPlugin.init!="function"||We.platform==="React Native"&&i==="ios"&&typeof this.offlinePushPlugin.checkPermissions!="function")this.logger.warn("OfflinePushService: plugin is not correct, please check your plugin according to Yunxin Official Documentation");else{var o;We.platform==="React Native"&&We.envPayload.AppState&&We.envPayload.AppState.addEventListener("change",et(o=this.handleRNAppStateChange).call(o,this));var u="";this.aosPushInfo&&this.aosPushInfo.pushType?u=this.aosPushInfo.pushType:i==="ios"?u="":i==="android"&&(u="8"),this.logger.log("OfflinePushService:: prepare to get device token. suggestPushType: "+u),this.logger.log("OfflinePushService push config",xe(this.authConfig,null,2),"platform",We.platform),We.platform==="UNIAPP"?this.offlinePushPlugin.getDeviceToken({suggestPushType:u,config:this.authConfig},function(h){h?(e.logger.log("OfflinePushService:: token is :"+h),e.pushTokenToServer(u,h)):e.logger.warn("OfflinePushService:: token is empty. Please check your parameters")}):We.platform==="React Native"&&i==="android"?(this.logger.log("OfflinePushService:: onLogin",this.core.account,typeof u,u),this.offlinePushPlugin.onLogin(this.core.account,it(u),!1,"")):We.platform==="React Native"&&i==="ios"?this.offlinePushPlugin.checkPermissions(function(){e.logger.log("OfflinePushService addEventListener requestPermissions");try{e.offlinePushPlugin.requestPermissions()}catch(h){e.logger.log("OfflinePushService:: requestPermissions error",h)}e.offlinePushPlugin.addEventListener("register",function(h){e.logger.log("OfflinePushService:: ios token: "+h),e.pushTokenToServer(u,h)}),e.offlinePushPlugin.addEventListener("registrationError",function(h){e.logger.log("OfflinePushService:: ios registerError",h)})}):this.logger.error("OfflinePushService:: platform is not supported. Please check your parameters. Platform: "+We.platform+". os: "+i)}else this.logger.warn("OfflinePushService: only Android or IOS support offline push")},l.pushTokenToServer=function(e,r){var i,o,u,h,g,v,_,I,C="",A=this.offlinePushConfig;switch(e){case"5":C=(i=A==null?void 0:A.miPush)===null||i===void 0?void 0:i.certificateName;break;case"6":C=(o=A==null?void 0:A.hwPush)===null||o===void 0?void 0:o.certificateName;break;case"7":C=(u=A==null?void 0:A.mzPush)===null||u===void 0?void 0:u.certificateName;break;case"8":C=(h=A==null?void 0:A.fcmPush)===null||h===void 0?void 0:h.certificateName;break;case"9":C=(g=A==null?void 0:A.vivoPush)===null||g===void 0?void 0:g.certificateName;break;case"10":C=(v=A==null?void 0:A.oppoPush)===null||v===void 0?void 0:v.certificateName;break;case"11":C=(_=A==null?void 0:A.honorPush)===null||_===void 0?void 0:_.certificateName;break;default:C=(I=A==null?void 0:A.apns)===null||I===void 0?void 0:I.certificateName}if(C===""||C===void 0)this.logger.warn("OfflinePushService:: certificate name is empty for push type: ",e);else try{if(We.platform==="UNIAPP"){var N=PE.parse("557d1e3cafa43e2589a588270c53d56f"),F=PE.stringify(VD.decrypt(r,N));this.logger.log("OfflinePushService:: token",F),this.core.sendCmd("v2SetDeviceToken",{certificateName:C,pushDeviceToken:F,pushkit:0})}else this.core.sendCmd("v2SetDeviceToken",{certificateName:C,pushDeviceToken:r,pushkit:0})}catch(j){return this.logger.log("OfflinePushService:: decrypt error",j),void this.logger.warn("OfflinePushService:: token before decrypt",r)}},l.handleRNAppStateChange=function(e){this.logger.log("push::handleAppStateChange: pushConfig ios/aos; state: "+e),this.appBackgroundOptions={badge:this.core.V2NIMConversationService.getTotalUnreadCount(),isBackground:e==="background"||e==="inactive"},this.setAppBackground(this.appBackgroundOptions.isBackground,this.appBackgroundOptions.badge)},Ai(p,[{key:"hasUserService",get:function(){var e;return!!(!((e=this.core.V2NIMUserService)===null||e===void 0)&&e.name)}},{key:"hasTeamService",get:function(){var e;return!!(!((e=this.core.V2NIMTeamService)===null||e===void 0)&&e.name)}}]),p}($r);je({target:"Number",stat:!0},{isNaN:function(p){return p!=p}});var Dl,UD=we.Number.isNaN,FD=Mt({none:0,normal:1,all:3}),qE={normal:0,advanced:1},BD=Mt(qE),qD=Mt({normal:0,owner:1,manager:2}),GE={noVerify:0,needVerify:1,rejectAll:2},GD=Mt(GE),jE={needVerify:0,noVerify:1},jD=Mt(jE),HE={manager:0,all:1},HD=Mt(HE),$E={manager:0,all:1},$D=Mt($E),KE={manager:0,all:1},KD=Mt(KE);function yo(a){var p,l=["teamId"],t=["level","memberNum","memberUpdateTime","createTime","updateTime"],e=["valid","validToCurrentUser","mute"],r={type:BD,muteType:FD,joinMode:GD,beInviteMode:jD,inviteMode:HD,updateTeamMode:$D,updateExtMode:KD};a.bits;var i=br(a,["bits"]);return ae(l).call(l,function(o){i[o]&&(i[o]=i[o].toString())}),ae(t).call(t,function(o){i[o]!==void 0&&(i[o]=it(i[o]))}),ae(e).call(e,function(o){i[o]!==void 0&&(i[o]=it(i[o])===1)}),ae(p=pt(r)).call(p,function(o){i[o]!==void 0&&(i[o]=r[o][i[o]]||i[o])}),i}function Vg(a){return a&&a.length>0?se(a).call(a,function(p){return yo(p)}):[]}function Dg(a){var p,l=O({},a),t=["avatar","name","intro","announcement","ext"],e={type:qE,joinMode:GE,beInviteMode:jE,inviteMode:HE,updateTeamMode:$E,updateExtMode:KE};return ae(t).call(t,function(r){l[r]!==void 0&&(l[r]=l[r].toString())}),ae(p=pt(e)).call(p,function(r){l[r]!==void 0&&(l[r]=e[r][l[r]])}),l}function YE(a){var p=["teamId","ext","account","nickInTeam"],l={};return a.bitConfigMask!==void 0&&(l.bits=it(a.bitConfigMask)),ae(p).call(p,function(t){a[t]&&(l[t]=a[t].toString())}),Object.prototype.hasOwnProperty.call(a,"nickInTeam")&&(l.nickInTeam=a.nickInTeam),l}function _c(a){var p,l=["teamId"],t=["joinTime","updateTime","bitConfigMask"],e=["active","valid","mute"],r={type:qD},i=a.bits,o=br(a,["bits"]);return i!==void 0&&(o.muteTeam=it(i)===1,o.bitConfigMask=i),o.id=o.teamId+"-"+o.account,ae(l).call(l,function(u){o[u]&&(o[u]=o[u].toString())}),ae(t).call(t,function(u){o[u]!==void 0&&(o[u]=it(o[u]))}),ae(e).call(e,function(u){o[u]!==void 0&&(o[u]=it(o[u])===1)}),ae(p=pt(r)).call(p,function(u){o[u]!==void 0&&(o[u]=r[u][o[u]]||o[u])}),o}function WE(a){return a&&a.length>0?se(a).call(a,function(p){return _c(p)}):[]}function JE(a,p,l){return l===void 0&&(l="normal"),{id:a.teamId+"-"+p,teamId:a.teamId,account:p,type:l,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:a.memberUpdateTime,updateTime:a.memberUpdateTime,active:!0,valid:!0}}function YD(a,p,l){return l===void 0&&(l="normal"),p&&p.length>0?se(p).call(p,function(t){return JE(a,t,l)}):[]}function Mc(a){var p=O({},a);return p.createTime&&(p.createTime=+p.createTime),p.updateTime&&(p.updateTime=+p.updateTime),p.gender&&(p.gender=Dl[+p.gender]),p}(function(a){a[a.unknown=0]="unknown",a[a.male=1]="male",a[a.female=2]="female"})(Dl||(Dl={}));var WD={"8_1":"createTeam","8_5":"addTeamMembers","8_6":"removeTeamMembers","8_7":"updateTeamInfo","8_8":"leaveTeam","8_9":"getTeamInfo","8_10":"getTeams","8_11":"getTeamMembers","8_12":"dismissTeam","8_13":"applyTeam","8_14":"passTeamApply","8_15":"rejectTeamApply","8_16":"addTeamManagers","8_17":"removeTeamManagers","8_18":"transferTeam","8_19":"updateMyMemberInfo","8_20":"updateNickInTeam","8_21":"acceptTeamInvite","8_22":"rejectTeamInvite","8_25":"muteTeamMember","8_27":"getMutedTeamMembers","8_28":"sendTeamMsgReceipt","8_29":"getTeamMsgReads","8_30":"getTeamMsgReadAccounts","8_31":"notifyTeamMsgReceipts","8_32":"muteTeam","8_33":"getTeamMemberInvitorAccid","8_34":"getTeamsById","8_101":"syncCreateTeam","8_109":"syncTeams","8_119":"syncUpdateTeamMember","8_126":"syncMyTeamMembers"},Pi={team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},teamMsgReceiptTag:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,ext:12,mute:13,invitorAccid:14}},hn=rn(Pi),JD={getTeamInfo:{sid:8,cid:9,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:hn.team}]},getTeams:{sid:8,cid:10,service:"team",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:hn.team},{type:"Long",name:"timetag"}],ignoreErrCodes:[803]},createTeam:{sid:8,cid:1,service:"team",params:[{type:"Property",name:"team",reflectMapper:Pi.team},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:hn.team},{type:"StrArray",name:"abortedAccidList"}]},sendTeamMsgReceipt:{sid:8,cid:28,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Pi.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:hn.teamMsgReceiptTag}]},getTeamMsgReads:{sid:8,cid:29,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Pi.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:hn.teamMsgReceiptTag}]},getTeamMsgReadAccounts:{sid:8,cid:30,service:"team",params:[{type:"Property",name:"teamMsgReceiptTag",reflectMapper:Pi.teamMsgReceiptTag}],response:[{type:"Property",name:"teamMsgReceipt",reflectMapper:hn.teamMsgReceiptTag},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},notifyTeamMsgReceipts:{sid:8,cid:31,service:"team",response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:hn.teamMsgReceiptTag}]},dismissTeam:{sid:8,cid:12,service:"team",params:[{type:"Long",name:"teamId"}]},leaveTeam:{sid:8,cid:8,service:"team",params:[{type:"Long",name:"teamId"}]},transferTeam:{sid:8,cid:18,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},updateTeamInfo:{sid:8,cid:7,service:"team",params:[{type:"Property",name:"team",reflectMapper:Pi.team}],response:[{type:"Long",name:"id"},{type:"Long",name:"time"}]},getTeamsById:{sid:8,cid:34,service:"team",params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:hn.team},{type:"LongArray",name:"tids"}],ignoreErrCodes:[816]},getTeamMembers:{sid:8,cid:11,service:"team",params:[{type:"Long",name:"teamId"},{type:"Long",name:"timetag"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:hn.teamMember},{type:"Long",name:"timetag"}]},getMutedTeamMembers:{sid:8,cid:27,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:hn.teamMember}]},addTeamMembers:{sid:8,cid:5,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},removeTeamMembers:{sid:8,cid:6,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applyTeam:{sid:8,cid:13,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:hn.team}]},addTeamManagers:{sid:8,cid:16,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:8,cid:17,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateMyMemberInfo:{sid:8,cid:19,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:Pi.teamMember}]},updateNickInTeam:{sid:8,cid:20,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:Pi.teamMember}]},muteTeamMember:{sid:8,cid:25,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:8,cid:33,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},muteTeam:{sid:8,cid:32,service:"team",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},passTeamApply:{sid:8,cid:14,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:8,cid:15,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptTeamInvite:{sid:8,cid:21,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:8,cid:22,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncTeams:{sid:8,cid:109,service:"team",response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"teams",reflectMapper:hn.team}]},syncCreateTeam:{sid:8,cid:101,service:"team",response:[{type:"Property",name:"team",reflectMapper:hn.team}]},syncUpdateTeamMember:{sid:8,cid:119,service:"team",response:[{type:"Property",name:"teamMember",reflectMapper:hn.teamMember}]},syncMyTeamMembers:{sid:8,cid:126,ext:"sync",service:"team",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember",reflectMapper:hn.teamMember},{type:"Long",name:"timetag"}]}},QD={"3_7":"getUsersNameCardFromServer","3_10":"updateMyNameCard","3_109":"syncMyNameCard","3_110":"onUpdateMyNameCard","3_3":"setBlack","3_103":"onUpdateBlackList","3_5":"setMute","3_105":"onUpdateMuteList","3_8":"syncRelations"},Ug={user:{account:1,nick:3,avatar:4,signature:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13},relationMember:{account:0,isMuted:1,isBlack:2,createTime:3,updateTime:4}},Ul=rn(Ug),zD={syncMyNameCard:{sid:3,cid:109,service:"user",response:[{type:"Property",name:"user",reflectMapper:Ul.user},{type:"Long",name:"timetag"}]},setBlack:{service:"user",sid:3,cid:3,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateBlackList:{service:"user",sid:3,cid:103,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},setMute:{service:"user",sid:3,cid:5,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateMuteList:{service:"user",sid:3,cid:105,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},syncRelations:{service:"user",sid:3,cid:8,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"list",reflectMapper:Ul.relationMember},{type:"Long",name:"timetag"}]},getUsersNameCardFromServer:{service:"user",sid:3,cid:7,params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"users",reflectMapper:Ul.user}]},updateMyNameCard:{service:"user",sid:3,cid:10,params:[{type:"Property",name:"user",reflectMapper:Ug.user}],response:[{type:"Long",name:"timetag"}]},onUpdateMyNameCard:{service:"user",sid:3,cid:110,response:[{type:"Property",name:"user",reflectMapper:Ul.user}]}},QE={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needForcePush:{type:"boolean",required:!1},forcePushIDsList:{type:"string",allowEmpty:!1,required:!1},forcePushContent:{type:"string",allowEmpty:!1,required:!1}},zE={function:{type:"string",required:!1},topic:{type:"string",required:!1},customContent:{type:"string",required:!1},account:{type:"string",required:!1}};function XD(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return XE(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?XE(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XE(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}var ZE={subType:{type:"string"},setting:{resendFlag:{type:"boolean"},envConfig:{type:"string"},needSaveHistory:{type:"boolean"},needRoaming:{type:"boolean"},needOffline:{type:"boolean"},needSelfSync:{type:"boolean"},needRouted:{type:"boolean"},needUpdateSession:{type:"boolean"},isMuted:{type:"boolean"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBIZID:{type:"string"},clientAntispamHitting:{type:"boolean"},antiSpamUsingYidun:{type:"boolean"},yidunCallbackURL:{type:"string"},yidunAntiCheating:{type:"string"},yidunAntiSpamExtension:{type:"string"},yidunAntiSpamResult:{type:"string"}},pushInfo:QE,robotInfo:zE,teamSpecializationInfo:{needACK:{type:"boolean"},isACKSent:{type:"boolean"},ackSnapshot:{type:"number"}},threadMessageInfo:{replyMsgFromAccount:{type:"string"},replyMsgToAccount:{type:"string"},replyMsgTime:{type:"number"},replyMsgIdServer:{type:"string"},replyMsgIdClient:{type:"string"},threadMsgFromAccount:{type:"string"},threadMsgToAccount:{type:"string"},threadMsgTime:{type:"number"},threadMsgIdServer:{type:"string"},threadMsgIdClient:{type:"string"}}},ZD={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMemberMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function _o(a,p){return Qr[a.scene]+"-"+(a.to===p?a.from:a.to)}function eU(a,p){return a.from===p?a.to===p?"in":"out":"in"}function ei(a,p){var l=p.account,t=p.featureValue,e=p.statusValue,r=p.sessionAck,i=p.msgReceiptTime,o=Qr[a.scene],u=a.to===l?a.from:a.to,h=mi.default,g=Lr.unread;it(a.isInBlackList)>0?(g=Lr.refused,delete a.isInBlackList):g=a.from===l?i&&i>=+a.time?Lr.receipt:Lr.sent:r&&r>=+a.time?Lr.read:Lr.unread;var v=O(O({},Yt(ZE,a)),{scene:o,type:uo[a.type],fromClientType:ac[a.fromClientType],flow:eU(a,l),target:u,to:a.to,from:a.from,time:a.time?+a.time:void 0,userUpdateTime:a.userUpdateTime?+a.userUpdateTime:void 0,idClient:a.idClient,sessionId:o+"-"+u,status:Lr[e||g],feature:mi[t||h]});if(typeof v.attach=="string")try{v.attach=JSON.parse(v.attach)}catch{}return v.type==="notification"&&(v.attach=v.attach?function(I){var C,A={};if(A.type=ZD[I.id]||I.id,!I.data)return A;var N,F={ids:"accounts",id:"account",attach:"custom",channel:"channelId",calltype:"netcallType",mute:"mute",duration:"duration",time:"time",from:"from",ext:"ext"},j=I.data;return ae(C=pt(F)).call(C,function(W){j[W]!==void 0&&(A[F[W]]=j[W])}),j.tinfo&&(A.team=yo(xt(j.tinfo,hn.team))),j.uinfos&&(A.users=se(N=j.uinfos).call(N,function(W){return Mc(xt(W,Ul.user))})),j.mute!==void 0&&(A.mute=it(j.mute)===1),A}(v.attach):{}),v}function Fg(a,p){return a&&a.length>0?eC(se(a).call(a,function(l){return ei(l,p)})):[]}function eC(a){for(var p,l,t={},e=XD(a);!(l=e()).done;){var r=l.value,i=t[r.idClient];i&&i.time>r.time||(t[r.idClient]=r)}return se(p=pt(t)).call(p,function(o){return t[o]})}function tC(a,p){p===void 0&&(p=!0);var l=O({},a);if(l.pushInfo&&p){for(var t in l.pushInfo)typeof l.pushInfo[t]=="boolean"?l[t]=l.pushInfo[t]?1:0:l[t]=l.pushInfo[t];delete l.pushInfo}return l.scene===Qr.team&&l.needForcePush&&(l.forcePushContent=l.forcePushContent||l.pushContent,l.forcePushIDsList=l.forcePushIDsList?l.forcePushIDsList:"#%@all@%#"),l}function Kd(a,p,l,t){a.onSendBefore,a.onUploadStart,a.onUploadDone;var e=a.replyMsg,r=br(a,["onSendBefore","onUploadStart","onUploadDone","replyMsg"]),i=O(O({},Is(ZE,r)),{scene:Qr[a.scene],type:uo[a.type],from:p,fromClientType:16,fromDeviceId:l,fromNick:t==null?void 0:t.nick,userUpdateTime:t==null?void 0:t.updateTime,status:Lr[Lr.sending]});if(i.idClient=i.resendFlag?a.idClient:jr(),!i.idClient)throw new Ym("idClient is required to resend a message","idClient","required");return i=tC(i,!1),e&&(i.replyMsgFromAccount=e.from,i.replyMsgToAccount=e.to,i.replyMsgTime=+e.time,i.replyMsgIdServer=e.idServer,i.replyMsgIdClient=e.idClient,i.threadMsgFromAccount=e.from,i.threadMsgToAccount=e.to,i.threadMsgTime=+e.time,i.threadMsgIdServer=e.idServer,i.threadMsgIdClient=e.idClient,e.threadMessageInfo&&e.threadMessageInfo.threadMsgIdServer&&(i.threadMsgFromAccount=e.threadMessageInfo.threadMsgFromAccount,i.threadMsgToAccount=e.threadMessageInfo.threadMsgToAccount,i.threadMsgTime=e.threadMessageInfo.threadMsgTime,i.threadMsgIdServer=e.threadMessageInfo.threadMsgIdServer,i.threadMsgIdClient=e.threadMessageInfo.threadMsgIdClient)),i}function va(a,p){return se(a).call(a,function(l){var t;return t=p||(UD(it(l.scene))?l.scene:it(l.scene)===1?"p2p":"team"),{deletedTime:it(l.time),from:l.from,idClient:l.deletedIdClient||l.idClient,idServer:l.deletedIdServer||l.idServer,scene:t,time:it(l.deletedMsgCreateTime),to:l.to,ext:typeof l.ext=="string"?l.ext:null}})}function tU(a){for(var p=[],l=(a=a||[]).length-1;l>=0;l--)p.push(a[l]);return p}var Mo,xs,ya,rU=function(){function a(p){this.core=p}return a.prototype.processBroadcastMsg=function(l){var t=se(l).call(l,function(e){return O(O({},e),{time:it(e.time)})});return this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:se(t).call(t,function(e){return e.id})}),t},a}(),Bg={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",allowEmpty:!1,required:!1},pushPayload:{type:"string",allowEmpty:!1,required:!1}},rC={pushContent:8,pushPayload:9,needPush:107,needPushBadge:109,needPushNick:110},nU={"4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","4_21":"syncDeleteSelfMsgs","7_1":"sendMsg","8_23":"getHistoryTeamMsgs","21_14":"getHistorySuperTeamMsgs","8_2":"sendTeamMsg","21_2":"sendSuperTeamMsg","7_11":"sendMsgReceipt","7_13":"recallMsg","7_24":"deleteSelfMsgs","21_17":"recallSuperTeamMsg","7_2":"onMsg","8_3":"onMsg","21_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_102":"onMsg","8_4":"nimOnTeamMsgs","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg","7_123":"onDeleteSelfMsg","7_124":"onDeleteSelfMsgs"},To=O(O({scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resendFlag:13,userUpdateTime:14,ext:15,needAntiSpam:21,antiSpamContent:22,antiSpamBIZID:23,clientAntispamHitting:24,antiSpamUsingYidun:25,needACK:26,yidunCallbackURL:27,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,isDeleted:39,callbackExt:40,subType:41,yidunAntiCheating:42,envConfig:43,yidunAntiSpamExtension:44,yidunAntiSpamResult:45,__clientExt:{id:46,converter:xi,retConverter:lo},needSaveHistory:100,needRoaming:101,needSelfSync:102,isMuted:104,needRouted:105,isInBlackList:106,needOffline:108,isReplyMsg:111,ackSnapshot:112},{pushContent:17,pushPayload:16,forcePushIDsList:18,forcePushContent:19,needForcePush:20,needPush:107,needPushBadge:109,needPushNick:110}),{function:47,topic:48,customContent:49,account:50}),ts={msg:To,recallMsgTag:O({time:0,type:1,to:2,from:3,ps:4,attach:5,deletedIdClient:10,deletedIdServer:11,deleteMsgCreatetime:14,opeAccount:16,env:21},rC),deleteSelfMsgTag:{scene:1,from:2,to:3,idServer:4,idClient:5,deletedMsgCreateTime:6,time:7,ext:8},msgReceiptTag:{to:1,from:2,time:7,idClient:11},broadcastMsg:{id:1,fromAccid:2,time:4,body:5}},sn=rn(ts),iU={sendMsg:{sid:7,cid:1,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:ts.msg}],response:[{type:"Property",name:"msg",reflectMapper:sn.msg}],ignoreErrCodes:[7101]},sendTeamMsg:{sid:8,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:ts.msg}],response:[{type:"Property",name:"msg",reflectMapper:sn.msg}]},sendSuperTeamMsg:{sid:21,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:ts.msg}],response:[{type:"Property",name:"msg",reflectMapper:sn.msg}]},onMsg:{sid:7,cid:2,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:sn.msg}]},nimOnTeamMsgs:{sid:8,cid:4,service:"msg",response:[{type:"PropertyArray",name:"datas",reflectMapper:sn.msg}]},getHistoryTeamMsgs:{sid:8,cid:23,service:"msg",params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:sn.msg}]},getHistorySuperTeamMsgs:{sid:21,cid:14,params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:sn.msg}],service:"msg"},recallMsg:{sid:7,cid:13,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:ts.recallMsgTag}]},deleteSelfMsgs:{sid:7,cid:24,service:"msg",params:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:ts.deleteSelfMsgTag}],response:[{type:"Long",name:"timetag"}]},recallSuperTeamMsg:{sid:21,cid:17,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:ts.recallMsgTag}]},sendMsgReceipt:{sid:7,cid:11,service:"msg",params:[{type:"Property",name:"msgReceiptTag",reflectMapper:ts.msgReceiptTag}],response:[{type:"Property",name:"msgReceiptTag",reflectMapper:sn.msgReceiptTag}]},batchMarkRead:{sid:4,cid:5,service:"msg",hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},syncMsgReceipts:{sid:4,cid:12,service:"msg",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:sn.msgReceiptTag},{type:"Long",name:"timetag"}]},syncOfflineMsgs:{sid:4,cid:4,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:sn.msg}]},syncRoamingMsgs:{sid:4,cid:9,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:sn.msg}]},syncBroadcastMsg:{sid:4,cid:16,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:sn.broadcastMsg}]},onBroadcastMsg:{sid:7,cid:17,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:sn.broadcastMsg}]},onDeleteSelfMsg:{sid:7,cid:123,service:"msg",response:[{type:"Property",name:"deletedMsg",reflectMapper:sn.deleteSelfMsgTag}]},onDeleteSelfMsgs:{sid:7,cid:124,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:sn.deleteSelfMsgTag}]},syncDeleteSelfMsgs:{sid:4,cid:21,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:sn.deleteSelfMsgTag}]}};(function(a){a[a.none=0]="none",a[a.pass=1]="pass",a[a.decline=2]="decline",a[a.read=3]="read",a[a.deleted=4]="deleted",a[a.invalid=5]="invalid"})(Mo||(Mo={})),function(a){a[a.default=0]="default",a[a.leave=1]="leave",a[a.roam=2]="roam"}(xs||(xs={})),function(a){a[a.applyTeam=0]="applyTeam",a[a.rejectTeamApply=1]="rejectTeamApply",a[a.teamInvite=2]="teamInvite",a[a.rejectTeamInvite=3]="rejectTeamInvite",a[a.friendRequest=5]="friendRequest",a[a.deleteFriend=6]="deleteFriend",a[a.recallMsgP2p=7]="recallMsgP2p",a[a.recallMsgTeam=8]="recallMsgTeam",a[a.recallMsgSuperTeam=12]="recallMsgSuperTeam",a[a.deleteMsgP2pOneWay=13]="deleteMsgP2pOneWay",a[a.deleteMsgTeamOneWay=14]="deleteMsgTeamOneWay",a[a.applySuperTeam=15]="applySuperTeam",a[a.rejectSuperTeamApply=16]="rejectSuperTeamApply",a[a.superTeamInvite=17]="superTeamInvite",a[a.rejectSuperTeamInvite=18]="rejectSuperTeamInvite",a[a.customP2p=100]="customP2p",a[a.customTeam=101]="customTeam",a[a.customSuperTeam=103]="customSuperTeam"}(ya||(ya={}));var sU={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},nC={setting:{needSaveOffline:{type:"boolean"},isRoutable:{type:"boolean"},envConfig:{type:"string"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"boolean"}},pushInfo:Bg,recallMessageInfo:{idClient:{type:"string",rawKey:"deletedIdClient"},idServer:{type:"string",rawKey:"deletedIdServer"},createTime:{type:"number",rawKey:"deletedMsgCreateTime"},fromNick:{type:"string",rawKey:"deletedMsgFromNick"},opeAccount:{type:"string"}}};function Fl(a,p,l){var t=+a.type,e=ic(ya,t);l=l||xs.default;var r=O(O({},Yt(nC,a)),{type:e,time:+a.time,to:a.to,from:a.from,idServer:a.idServer,state:Mo[Mo.none],feature:xs[l]});if(r.idServer==="0"&&r.setting&&(r.setting.needSaveOffline=!1),typeof r.attach=="string")try{r.attach=JSON.parse(r.attach)}catch(i){p.error("formatSystemMessage: "+r.idServer+" parse attach error",i&&i.message)}return t===5&&r.attach?(r.attach.type=sU[+r.attach.vt],r.attach.type==="passFriendApply"?r.state=Mo[Mo.pass]:r.attach.type==="rejectFriendApply"&&(r.state=Mo[Mo.decline])):t<=3&&r.attach&&(r.attach=function(o){var u=o.attach,h=o.tinfo,g=br(o,["attach","tinfo"]);return g.ext=u,h!==void 0&&(g.team=yo(xt(o.tinfo,hn.team))),g}(r.attach)),r}function oU(a){var p=O({},a);return O(O({},Is(nC,p)),{type:ya[p.type],to:p.to,attach:p.attach})}function iC(a){return a===ya.recallMsgP2p?"p2p":a===ya.recallMsgTeam?"team":a===ya.recallMsgSuperTeam?"superTeam":""}var aU=function(a){function p(t){var e;return(e=a.call(this,"msg",t)||this).onV2SendMessage=function(r){var i=ei(r,{account:e.core.account,featureValue:mi.default});i.status=r.status,e.core.eventBus.emit("session/updateForNewMsg",i)},e.onV2ModifyMessage=function(r){var i,o=Qr[r.scene]+"-"+(r.to===e.core.account?r.from:r.to),u=(i=e.core.session)===null||i===void 0?void 0:i.getSessionWithUncomplete({id:o}),h=ei(r,u?{account:e.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:e.core.account});e.core.eventBus.emit("session/updateForModifyMsg",h)},e.onV2RecallMsg=function(r){var i=va([r],iC(+r.type));e.core.eventBus.emit("session/updateForDeletedMsg",i)},e.onV2DeleteSelfMsgs=function(r){var i=va(r);e.core.eventBus.emit("session/updateForDeletedMsg",i)},e.service=new rU(t),Kt({cmdMap:nU,cmdConfig:iU}),e.registerListener(),e}bt(p,a);var l=p.prototype;return l.registerListener=function(){this.core.eventBus.on("forwardReceive/msg/sendMsg",this.onV2SendMessage),this.core.eventBus.on("forwardReceive/msg/modifyMsg",this.onV2ModifyMessage),this.core.eventBus.on("forwardReceive/msg/recallMsg",this.onV2RecallMsg),this.core.eventBus.on("forwardReceive/msg/deleteSelfMsgs",this.onV2DeleteSelfMsgs)},l.sendTextMsg=function(e){return P({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(O(O({},e),{type:"text"}))},l.sendTipMsg=function(e){return P({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(O(O({},e),{type:"tip"}))},l.sendGeoLocationMsg=function(e){return P({attach:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},e),this.sendMsg(O(O({},e),{type:"geo",attach:xe(e.attach)}))},l.sendCustomMsg=function(e){return P({attach:{type:"string",allowEmpty:!1}},e),this.sendMsg(O(O({},e),{type:"custom"}))},l.sendMsg=function(e){var r,i=this;if(P({scene:{type:"enum",values:Qt(Qr)},type:{type:"enum",values:Qt(uo)},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},setting:{type:"object",rules:{resendFlag:{type:"boolean",required:!1},needSaveHistory:{type:"boolean",required:!1},needRoaming:{type:"boolean",required:!1},needOffline:{type:"boolean",required:!1},needSelfSync:{type:"boolean",required:!1},needRouted:{type:"boolean",required:!1},needUpdateSession:{type:"boolean",required:!1}},required:!1},antiSpamInfo:{type:"object",required:!1,rules:{clientAntispamHitting:{type:"boolean",required:!1},antiSpamUsingYidun:{type:"boolean",required:!1}}},pushInfo:{type:"object",required:!1,rules:QE},robotInfo:{type:"object",required:!1,rules:zE},teamSpecializationInfo:{type:"object",required:!1,rules:{needACK:{type:"boolean",required:!1}}}},e),e.scene==="team"&&e.robotInfo&&!e.robotInfo.account)throw new _s('When "scene" equals "team", account is required in robotInfo',{key:"account"},"required");var o,u=e.scene==="p2p"?"sendMsg":e.scene==="team"?"sendTeamMsg":"sendSuperTeamMsg",h=Kd(e,this.core.account,this.core.config.deviceId,(r=this.core.user)===null||r===void 0?void 0:r.myInfo),g=ei(O(O({},h),{time:new Date().getTime()}),{account:this.core.account,featureValue:mi.default,statusValue:Lr.sending});try{e.onSendBefore&&e.onSendBefore(g)}catch(v){this.logger.error("sendMsg: options.onSendBefore error",v)}return this.core.eventBus.emit("session/updateForNewMsg",g),this.core.eventBus.emit("forwardSend/msg/sendMsg",h),this.core.sendCmd(u,{msg:h}).then(function(v){var _=v.content,I=v.error;if(o=_.msg,I)throw I;var C=ei(O(O({},h),_.msg),{account:i.core.account,featureValue:mi.default,statusValue:Lr.sent});return C.from===C.to&&i.markMsgsAck([C]),i.core.eventBus.emit("session/updateForNewMsg",C),i.core.eventBus.emit("forwardSend/msg/sendMsg",O(O({},Kd(C,C.from,C.fromDeviceId)),{idClient:C.idClient,status:"sent"})),i.core.reporter.report("msgSend",{msgId:C.idServer,clientId:C.idClient,msgTime:C.time,fromAccid:e.scene==="p2p"?i.core.account:"",toAccid:C.to,type:Qr[C.scene],roomId:"",tid:e.scene==="p2p"?"":C.to,result:200,failReason:"",rt:Dt()-g.time}),C}).catch(function(v){var _=ei(O(O(O({},h),{time:new Date().getTime()}),o),{account:i.core.account,featureValue:mi.default,statusValue:v.code===7101?Lr.refused:Lr.sendFailed});throw v.msg=_,i.core.eventBus.emit("session/updateForNewMsg",_),i.core.eventBus.emit("forwardSend/msg/sendMsg",O(O({},Kd(_,_.from,_.fromDeviceId)),{status:"sendFailed"})),i.core.reporter.report("msgSend",{msgId:_.idServer,clientId:_.idClient,msgTime:_.time,fromAccid:e.scene==="p2p"?i.core.account:"",toAccid:_.to,type:Qr[_.scene],roomId:"",tid:e.scene==="p2p"?"":_.to,result:v==null?void 0:v.code,failReason:(v==null?void 0:v.message)||"",rt:Dt()-g.time}),v})},l.resendMsg=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(P({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}}},e),i=e.msg,o=O(O({},i),{attach:i.attach?xe(i.attach):void 0,setting:{resendFlag:!0}}),i.from===this.core.account){h.next=5;break}throw new Error("You can only resend messages that you sent: "+i.idClient);case 5:return h.abrupt("return",this.sendMsg(o));case 6:case"end":return h.stop()}},r,this)}))},l.forwardMsg=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}},scene:{type:"enum",values:Qt(Qr)},to:{type:"string",allowEmpty:!1}},e),i=e.msg,o=O(O({},i),{scene:e.scene,to:e.to,attach:i.attach?xe(i.attach):void 0}),h.abrupt("return",this.sendMsg(o));case 4:case"end":return h.stop()}},r,this)}))},l.sendImageMsg=function(e){return this.doSendFile(O(O({},e),{type:"image"}))},l.sendFileMsg=function(e){return this.doSendFile(O(O({},e),{type:"file"}))},l.sendAudioMsg=function(e){return this.doSendFile(O(O({},e),{type:"audio"}))},l.sendVideoMsg=function(e){return this.doSendFile(O(O({},e),{type:"video"}))},l.doSendFile=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(P({scene:{type:"enum",values:Qt(Qr)},to:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e),i=e.attach){u.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){u.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return u.prev=5,u.next=8,this.core.cloudStorage.uploadFile(e);case 8:i=u.sent,u.next=15;break;case 11:throw u.prev=11,u.t0=u.catch(5),this.logger.error("sendFile:: upload File error or abort.",u.t0),u.t0;case 15:return u.abrupt("return",this.sendMsg(O(O({},e),{attach:xe(i),type:e.type})));case 16:case"end":return u.stop()}},r,this,[[5,11]])}))},l.recallMsg=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return P({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},scene:{type:"enum",values:Qt(Qr)},time:{type:"number"}}},pushInfo:{type:"object",required:!1,rules:Bg},ps:{type:"string",allowEmpty:!1,required:!1}},e),i=e.msg,o={p2p:"recallMsg",team:"recallMsg",superTeam:"recallSuperTeamMsg"},u={p2p:7,team:8,superTeam:12},h=tC({time:i.time,type:u[i.scene],to:i.to,from:i.from,ps:e.ps,attach:e.attach,deletedIdClient:i.idClient,deletedIdServer:i.idServer,opeAccount:i.from,env:e.env,pushInfo:e.pushInfo}),I.next=7,this.core.sendCmd(o[i.scene],{recallMsgTag:h});case 7:return g=O({},i,{deletedMsgCreateTime:i.time}),v=va([g]),this.core.eventBus.emit("session/updateForDeletedMsg",v),this.core.eventBus.emit("forwardSend/msg/recallMsg",h),I.abrupt("return",i);case 12:case"end":return I.stop()}},r,this)}))},l.deleteSelfMsgs=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return P({msgs:{type:"array",rules:{scene:{type:"enum",values:["p2p","team"]},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},time:{type:"number",allowEmpty:!1}}},ext:{type:"string",allowEmpty:!1,required:!1}},e),i=e.msgs,o=se(i).call(i,function(I){return{scene:I.scene==="p2p"?1:2,from:I.from,to:I.to,idServer:I.idServer,idClient:I.idClient,deletedMsgCreateTime:I.time,ext:e.ext}}),_.next=5,this.core.sendCmd("deleteSelfMsgs",{deletedMsgs:o});case 5:return u=_.sent,h=se(o).call(o,function(I){var C;return O({},I,{time:(C=u==null?void 0:u.content)===null||C===void 0?void 0:C.timetag})}),g=va(h),this.core.eventBus.emit("session/updateForDeletedMsg",g),this.core.eventBus.emit("forwardSend/msg/deleteSelfMsgs",se(o).call(o,function(I){var C;return O(O({},I),{time:(C=u==null?void 0:u.content)===null||C===void 0?void 0:C.timetag})})),_.abrupt("return",g);case 11:case"end":return _.stop()}},r,this)}))},l.sendMsgReceipt=function(e){var r,i;return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(P({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},target:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),(u=e.msg).scene==="p2p"&&u.flow==="in"){I.next=5;break}return this.logger.warn("Msg scene: "+u.scene+", flow: "+u.flow+" is not allowed to send msg receipt"),I.abrupt("return",void 0);case 5:return h={to:u.target,idClient:u.idClient,time:u.time},I.next=8,this.core.sendCmd("sendMsgReceipt",{msgReceiptTag:h});case 8:return g=I.sent,v=it((i=(r=g.content)===null||r===void 0?void 0:r.msgReceiptTag)===null||i===void 0?void 0:i.time),I.abrupt("return",O(O({},h),{time:v?Math.min(v,h.time):h.time}));case 11:case"end":return I.stop()}},o,this)}))},l.sendTeamMsgReceipt=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}},max:50}},e),i=e.teamMsgReceipts,this.core.sendCmd("sendTeamMsgReceipt",{teamMsgReceipts:i}),u.abrupt("return",void 0);case 4:case"end":return u.stop()}},r,this)}))},l.getTeamMsgReads=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e),o=e.teamMsgReceipts,v.next=4,this.core.sendCmd("getTeamMsgReads",{teamMsgReceipts:o});case 4:return u=v.sent,h=(h=(r=u.content)===null||r===void 0?void 0:r.teamMsgReceipts)?se(h).call(h,function(_){return O(O({},_),{read:it(_.read),unread:it(_.unread)})}):[],v.abrupt("return",h);case 8:case"end":return v.stop()}},i,this)}))},l.getTeamMsgReadAccounts=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({teamMsgReceipt:{type:"object",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e),i=e.teamMsgReceipt,h.next=4,this.core.sendCmd("getTeamMsgReadAccounts",{teamMsgReceiptTag:i});case 4:return o=h.sent,h.abrupt("return",o.content);case 6:case"end":return h.stop()}},r,this)}))},l.markMsgsAck=function(e){if(e&&e.length>0){var r=[],i=[];ae(e).call(e,function(o){o.scene==="p2p"&&o.flow==="in"?r.push(o):o.scene==="team"&&o.flow==="in"&&i.push(o)}),r.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:se(r).call(r,function(o){return o.idServer})}),i.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:se(i).call(i,function(o){return o.idServer})})}},l.onMsgHandler=function(e){var r;if(e.error)this.logger.error("msgHandler::recvError",e.error);else{var i=zi(e,e.content.msg,"idServer"),o=_o(i,this.core.account),u=(r=this.core.session)===null||r===void 0?void 0:r.getSessionWithUncomplete({id:o}),h=ei(i,u?{account:this.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:this.core.account});this.logger.getDebugMode()?this.logger.debug("msgHandler::recvMsg",h.idClient,h.idServer,h):this.logger.log("msgHandler::recvMsg",h.idClient,h.idServer),this.markMsgsAck([h]),this.core.eventBus.emit("session/updateForNewMsg",h),h.scene==="superTeam"?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:h.time}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:h.time}),this.core.emit("msg",h),h.type==="notification"?this.core.eventBus.emit("team/onNotification",h):h.flow!=="out"&&this.doMsgReceiveReport(h,e),h.type!=="notification"&&this.core.user.checkUserUpdate(h)}},l.doMsgReceiveReport=function(e,r){if(e.from!==this.core.account){var i=e.scene==="p2p",o=Pe(e,"__clientExt.statistics.apiCallingTime")||0,u=Pe(e,"__clientExt.statistics.sendTime")||0,h=Pe(e,"__clientExt.statistics.attachUploadDuration")||0,g=this.core.timeOrigin.getNTPTime(),v=e.time,_=this.core.timeOrigin.checkNodeReliable(r.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(r.__receiveTimeNode):g;this.core.reporter.report("msgReceive",{msgId:e.idServer,clientId:e.idClient,serverTime:v,receiveTime:_,fromAccid:i?e.from:"",toAccid:e.to,type:Qr[e.scene],tid:i?"":e.to,apiCallingTime:o,sendTime:u,attachUploadDuration:h,callbackTime:g,preHandleTime:g,result:200,failReason:"",rt:g-v})}},l.nimOnTeamMsgsHandler=function(e){var r,i=this;ae(r=e.content.datas).call(r,function(o){i.onMsgHandler(O({},e,{content:{msg:o}}))})},l.syncRoamingMsgsHandler=function(e){var r,i,o=e.content.msgs||[];if(o.length!==0){var u=_o(o[0],this.core.account),h=(r=this.core.session)===null||r===void 0?void 0:r.getSessionWithUncomplete({id:u}),g=(o=Fg(o,h?{account:this.core.account,featureValue:mi.roam,sessionAck:h.ack,msgReceiptTime:h.msgReceiptTime}:{account:this.core.account,featureValue:mi.roam}))[0].time,v={timetag:g,sessionId:u,msgs:tU(o)};typeof((i=this.core.sync)===null||i===void 0?void 0:i.getSyncDoneFlag)!="function"||this.core.sync.getSyncDoneFlag()||this.core.eventBus.emit("session/syncMsgs",v),this.core.emit("syncRoamingMsgs",v),o[0].scene==="superTeam"?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:g}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:g})}},l.syncOfflineMsgsHandler=function(e){var r,i=this,o=e.content.msgs||[];if(o.length!==0){var u={},h=[];ae(o).call(o,function(v){var _=_o(v,i.core.account),I=i.core.session.getSessionWithUncomplete({id:_}),C=ei(v,I?{account:i.core.account,featureValue:mi.leave,sessionAck:I.ack,msgReceiptTime:I.msgReceiptTime}:{account:i.core.account,featureValue:mi.leave});h.push(C),u[C.sessionId]?u[C.sessionId].push(C):u[C.sessionId]=[C]}),this.markMsgsAck(h);var g=0;ae(r=pt(u)).call(r,function(v){var _,I=Tr(_=u[v]).call(_,function(A,N){return N.time-A.time});(I=eC(I))[0].time>g&&(g=I[0].time);var C={timetag:I[0].time,sessionId:v,msgs:I};i.core.eventBus.emit("session/syncMsgs",C),i.core.emit("syncOfflineMsgs",C)}),this.core.eventBus.emit("sync/updateTimetag",{offlineMsgs:g})}},l.syncDeleteSelfMsgsHandler=function(e){var r,i=(r=e.content)===null||r===void 0?void 0:r.deletedMsgs;i&&i.length>0||this.logger.warn("syncDeleteSelfMsgs:: no msgs");var o=i[i.length-1].time;this.core.eventBus.emit("sync/updateTimetag",{deleteSelfMsgs:o})},l.onDeleteSelfMsgHandler=function(e){var r=va([e.content.deletedMsg]);this.core.eventBus.emit("session/updateForDeletedMsg",r),this.core.emit("deleteSelfMsgs",r)},l.onDeleteSelfMsgsHandler=function(e){var r=va(e.content.deletedMsgs);this.core.eventBus.emit("session/updateForDeletedMsg",r),this.core.emit("deleteSelfMsgs",r)},l.onBroadcastMsgHandler=function(e){var r=e.content.msg,i=this.service.processBroadcastMsg([r]);this.core.emit("broadcastMsgs",i)},l.syncBroadcastMsgHandler=function(e){var r=e.content.msgs,i=this.service.processBroadcastMsg(r);this.core.emit("broadcastMsgs",i)},p}(Vn),cU={"5_1":"sync"},lU={sync:{sid:5,cid:1,service:"sync",hasPacketTimer:!1,params:[{type:"Property",name:"sync",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Long",name:"timetag"}]}},uU=function(a){function p(t,e){var r;return e===void 0&&(e={}),(r=a.call(this,"sync",t)||this).syncDoneFlag=!1,r.config={myInfo:!!t.user.name,offlineMsgs:!!t.msg.name,teams:!!t.team.name,myTeamMembers:!!t.team.name,roamingMsgs:!!t.msg.name,relations:!!t.user.name,friends:!!t.friend.name,friendUsers:!!t.user.name,msgReceipts:!!t.msg.name,broadcastMsgs:!!t.msg.name,recallMsg:!!t.msg.name,sessionAck:!!t.session.name,superTeamSessionAck:!!t.session.name,superTeams:!!t.superTeam.name,mySuperTeamMembers:!!t.superTeam.name,superTeamRoamingMsgs:!!t.superTeam.name,deleteSuperTeamMsg:!!t.superTeam.name,deleteSelfMsgs:!!t.msg.name,sessionHistoryMsgsDelete:!!t.msgLog.name,avSignal:!!t.signaling.name},r.setOptions(e),r.timetags={},r.initEventListeners(),Kt({cmdMap:cU,cmdConfig:lU}),r}bt(p,a);var l=p.prototype;return l.setOptions=function(e){O(this.config,e)},l.reset=function(){this.timetags={},this.syncDoneFlag=!1},l.getSyncDoneFlag=function(){return this.syncDoneFlag},l.doSync=function(){var e;return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return i=this.genSyncParams(),this.logger.log("sync::doSyncV1: ",i),h.prev=2,h.next=5,this.core.clientSocket.sendCmd("sync",{sync:i});case 5:o=h.sent,this.core.logger.log("sync::doSyncV1 done in",(e=o.content)===null||e===void 0?void 0:e.timetag),this.syncDoneFlag=!0,this.core.emit("syncdone"),h.next=17;break;case 11:return h.prev=11,h.t0=h.catch(2),this.core.logger.error("sync::doSyncV1 error",h.t0),this.syncDoneFlag=!0,this.core.emit("syncdone"),h.abrupt("return");case 17:case"end":return h.stop()}},r,this,[[2,11]])}))},l.initEventListeners=function(){var e=this;this.core.eventBus.on("logined",function(){e.syncDoneFlag=!1,e.doSync()}),this.core.eventBus.on("sync/updateTimetag",function(r){var i;ae(i=pt(r)).call(i,function(o){r[o]>(e.timetags[o]||0)&&(e.timetags[o]=r[o])})})},l.genSyncParams=function(){var e,r,i=this;return Cr(e=at(r=pt(this.config)).call(r,function(o){var u=o;return i.config[u]})).call(e,function(o,u){var h=u;return o[h]=i.timetags[h]||0,o},{})},l.handleImmediate=function(e){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),He.resolve(e)},l.delaySyncDone=function(e){var r=this;return Zm()==="ALI"?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new He(function(i){or(function(){r.handleImmediate(e).then(function(){i(e)})},100)})):this.handleImmediate(e)},l.syncHandler=function(e){return this.delaySyncDone(e)},p}(Vn);function dU(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return sC(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?sC(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sC(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}var pU=function(a){function p(t){var e;return(e=a.call(this,"user",t)||this).userInfoMap=new Dr,e.myInfo=Mc({}),Kt({cmdMap:QD,cmdConfig:zD}),e}bt(p,a);var l=p.prototype;return l.setBlack=function(e){var r=this;return P({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),this.core.sendCmd("setBlack",e).then(function(){r.core.eventBus.emit("forwardSend/user/updateBlackList",e.account,e.isAdd)})},l.setMute=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),o.next=3,this.core.sendCmd("setMute",e).then(function(){});case 3:this.core.eventBus.emit("forwardSend/user/setMute",e.account,e.isAdd);case 4:case"end":return o.stop()}},r,this)}))},l.getRelations=function(){return this.core.sendCmd("syncRelations",{timetag:0})},l.getBlackList=function(){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return r=o.sent,o.abrupt("return",r.blackList||[]);case 4:case"end":return o.stop()}},e,this)}))},l.getMuteList=function(){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return r=o.sent,o.abrupt("return",r.muteList||[]);case 4:case"end":return o.stop()}},e,this)}))},l.updatePushToken=function(){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return i.stop()}},e,this)}))},l.updateAppBackground=function(){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return i.stop()}},e,this)}))},l.getUsersNameCardFromServer=function(e){var r=this;return P({accounts:{type:"array",max:150,itemType:"string"}},e),this.core.sendCmd("getUsersNameCardFromServer",Ss(e,["accounts"])).then(function(i){var o,u=i.content;return r.logger.log("user:: getUsers done",e.accounts),u&&u.users?se(o=u.users).call(o,function(h){return Mc(h)}):[]})},l.updateMyNameCard=function(e){var r=this;if(P({nick:{type:"string",required:!1},avatar:{type:"string",required:!1},signature:{type:"string",required:!1},gender:{type:"enum",values:Qt(Dl),required:!1},email:{type:"string",required:!1},birth:{type:"string",required:!1},tel:{type:"string",required:!1},ext:{type:"string",required:!1}},e),pt(e).length===0)return He.resolve(this.myInfo);var i=Ss(e,["nick","avatar","signature","email","birth","tel","ext"]);return e.gender&&(i.gender=Dl[e.gender]),this.core.sendCmd("updateMyNameCard",{user:i}).then(function(o){var u=o.content;return u&&u.timetag&&r.core.eventBus.emit("sync/updateTimetag",{myInfo:+u.timetag}),e.gender&&(i.gender=e.gender),r.myInfo=O({},r.myInfo,i),r.core.eventBus.emit("forwardSend/user/updateUserInfo",i),r.myInfo})},l.checkUserUpdate=function(e){var r=e.from;if(r!==this.core.account){var i=this.userInfoMap.get(r);if(i){var o=i.updateTime,u=e.userUpdateTime;!isNaN(o)&&!isNaN(u)&&typeof o=="number"&&typeof u=="number"&&o<u&&this.refreshUserInfo(r)}else this.refreshUserInfo(r)}},l.refreshUserInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.getUsersNameCardFromServer({accounts:[e]});case 2:for(i=v.sent,o=dU(i);!(u=o()).done;)h=u.value,this.userInfoMap.set(h.account,h),this.core.emit("updateUserInfo",h);case 4:case"end":return v.stop()}},r,this)}))},l.onUpdateBlackListHandler=function(e){var r=e.content;r.account?this.core.emit("updateBlackList",r):this.logger.warn("onUpdateBlackListHandler: no account")},l.onUpdateMuteListHandler=function(e){var r=e.content;r.account?this.core.emit("updateMuteList",r):this.logger.warn("onUpdateBlackListHandler: no account")},l.syncRelationsHandler=function(e){var r=e.content,i=r.list,o=r.timetag,u={blackList:[],muteList:[]};return o&&this.core.eventBus.emit("sync/updateTimetag",{relations:o}),i&&i.length&&ae(i).call(i,function(h){var g=function(_){var I={account:_.account,updateTime:+_.updateTime,createTime:+_.createTime};return _.isMuted==="1"&&(I.isMuted=!0),_.isBlack==="1"&&(I.isBlack=!0),I}(h);g.isBlack&&u.blackList.push(g),g.isMuted&&u.muteList.push(g)}),this.core.emit("relations",u),He.resolve(u)},l.syncMyNameCardHandler=function(e){e.content.user&&(this.myInfo=Mc(e.content.user),this.core.emit("syncMyNameCard",this.myInfo),this.core.eventBus.emit("sync/updateTimetag",{myInfo:e.content.timetag}))},l.onUpdateMyNameCardHandler=function(e){var r=e.content.user;r?(O(this.myInfo,Mc(r)),this.core.emit("updateMyNameCard",this.myInfo)):this.logger.warn("onUpdateMyNameCardHandler no user info")},p}(Vn),hU={"4_12":"syncMsgReceipts","4_14":"syncSessionAck","4_20":"syncSuperTeamSessionAck","4_22":"nimSyncSessionsWithMoreRoaming","4_25":"syncSessionReliableInfo","7_12":"multiSyncMsgReceipt","7_16":"markSessionAck","7_25":"markMultSessionsAck","7_116":"syncMarkSessionAck","21_25":"markSuperTeamSessionAck","21_32":"markMultSuperTeamSessionsAck","21_125":"syncMarkSuperTeamSessionAck","4_23":"nimSyncStickTopSessions","23_12":"nimAddStickTopSession","23_13":"nimDeleteStickTopSession","23_14":"nimUpdateStickTopSession","23_112":"nimMultiSyncAddStickTopSession","23_113":"nimMultiSyncDeleteStickTopSession","23_114":"nimMultiSyncUpdateStickTopSession"},Tc={msgReceiptTag:{to:1,from:2,time:7,idClient:11},stickTopSessionTag:{id:1,ext:2,createTime:3,updateTime:4},sessionAckTag:{scene:1,to:2,timetag:3},sessionReliableSyncTag:{scene:1,sessionId:2,syncStatus:3,syncEndMsgId:4,syncEndMsgidClient:5,syncEndMsgTime:6,syncStartMsgid:7,syncStartMsgidClient:8,syncStartMsgTime:9,nextMsgid:10,nextMsgidClient:11,nextMsgTime:12,roamMsgSync:13,offlineMsgSync:14,netCallOfflineMsgSync:15}},Io=rn(Tc),fU={syncMsgReceipts:{sid:4,cid:12,service:"session",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:Io.msgReceiptTag},{type:"Long",name:"timetag"}]},syncSessionAck:{sid:4,cid:14,service:"session",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamSessionAck:{sid:4,cid:20,service:"session",response:[{type:"LongLongMap",name:"superTeam"},{type:"Long",name:"timetag"}]},multiSyncMsgReceipt:{sid:7,cid:12,service:"session",response:[{type:"Property",name:"msgReceiptTag",reflectMapper:Io.msgReceiptTag}]},markSessionAck:{sid:7,cid:16,service:"session",params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSessionAck:{sid:7,cid:116,service:"session",response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSuperTeamSessionAck:{sid:21,cid:125,service:"session",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},markMultSessionsAck:{sid:7,cid:25,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:Tc.sessionAckTag}]},markSuperTeamSessionAck:{sid:21,cid:25,service:"session",params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},nimAddStickTopSession:{sid:23,cid:12,service:"session",params:[{type:"Property",name:"tag",reflectMapper:Tc.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:Io.stickTopSessionTag}]},nimDeleteStickTopSession:{sid:23,cid:13,service:"session",params:[{type:"Property",name:"tag",reflectMapper:Tc.stickTopSessionTag}],response:[{type:"Long",name:"timetag"}]},nimUpdateStickTopSession:{sid:23,cid:14,service:"session",params:[{type:"Property",name:"tag",reflectMapper:Tc.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:Io.stickTopSessionTag}]},nimMultiSyncAddStickTopSession:{sid:23,cid:112,service:"session",response:[{type:"Property",name:"data",reflectMapper:Io.stickTopSessionTag}]},nimMultiSyncDeleteStickTopSession:{sid:23,cid:113,service:"session",response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:Io.stickTopSessionTag}]},nimMultiSyncUpdateStickTopSession:{sid:23,cid:114,service:"session",response:[{type:"Property",name:"data",reflectMapper:Io.stickTopSessionTag}]},nimSyncStickTopSessions:{sid:4,cid:23,service:"session",response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:Io.stickTopSessionTag}]},markMultSuperTeamSessionsAck:{sid:21,cid:32,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:Tc.sessionAckTag}]},nimSyncSessionsWithMoreRoaming:{sid:4,cid:22,service:"session",response:[]},syncSessionReliableInfo:{sid:4,cid:25,service:"session",response:[]}},mU={id:{type:"string"},ext:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function Yd(a,p,l){l===void 0&&(l=!0);var t=Yt(mU,a);t.isStickOnTop=l,t.id=p.id,l||(t.ext="");var e=O(O({},p),{stickTopInfo:p.stickTopInfo?O({},p.stickTopInfo,t):t});return e.lastMsg===void 0&&(e.lastMsg=null),e}var gU=function(){function a(l){this.core=l}var p=a.prototype;return p.getSession=function(t){return this.core.session.getSessionWithUncomplete({id:t})||this.core.session.createSession(t)},p.addStickTopSession=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return P({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),r=Wn(t.id),i=r.scene,o=r.accid,_.next=4,this.core.sendCmd("nimAddStickTopSession",{tag:{id:(i==="superTeam"?"super_team":i)+"|"+o,ext:t.ext||""}});case 4:return u=_.sent,h=this.getSession(t.id),g=Yd(u.content.data,h),_.abrupt("return",g);case 8:case"end":return _.stop()}},e,this)}))},p.deleteStickTopSession=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return P({id:{type:"string",allowEmpty:!1}},t),r=Wn(t.id),i=r.scene,o=r.accid,_.next=4,this.core.sendCmd("nimDeleteStickTopSession",{tag:{id:(i==="superTeam"?"super_team":i)+"|"+o}});case 4:return u=_.sent,h=this.getSession(t.id),g=Yd({updateTime:u.content.timetag,ext:""},h,!1),_.abrupt("return",g);case 8:case"end":return _.stop()}},e,this)}))},p.updateStickTopSession=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return P({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),r=Wn(t.id),i=r.scene,o=r.accid,_.next=4,this.core.sendCmd("nimUpdateStickTopSession",{tag:{id:(i==="superTeam"?"super_team":i)+"|"+o,ext:t.ext||""}});case 4:return u=_.sent,h=this.getSession(t.id),g=Yd(u.content.data,h),_.abrupt("return",g);case 8:case"end":return _.stop()}},e,this)}))},p.stickTopSessionHandler=function(t,e){e===void 0&&(e=!0);var r=Wn(t.id,"|"),i=r.scene+"-"+r.accid;return Yd(t,this.getSession(i),e)},a}(),vU=function(){function a(l){this.core=l,this.logger=l.logger}var p=a.prototype;return p.canSessionResetUnreadCount=function(t){var e=t.id;if(t.lastMsg===void 0)throw new Error("Session::canSessionResetUnreadCount: session "+e+" is not completly, lastMsg undefined");return t.lastMsg!==null||t.unread>0?!(t.ack&&t.lastMsg&&t.ack>=t.lastMsg.time)||(this.logger.log("Session::canSessionResetUnreadCount: session "+e+" reset failed, ack time is greater than last message time"),!1):(this.logger.log("Session::canSessionResetUnreadCount: session "+e+" doesn't need to be updated, lastMsg null and unread 0"),!1)},p.filterSessionForResetUnreadCount=function(t){var e=this,r={cmd:"markMultSuperTeamSessionsAck",params:[]},i={cmd:"markMultSessionsAck",params:[]};return ae(t).call(t,function(o){var u;try{if(!e.canSessionResetUnreadCount(o))return;var h=Wn(o.id),g=h.accid,v=h.scene,_={to:g,sessionId:o.id,timetag:((u=o==null?void 0:o.lastMsg)===null||u===void 0?void 0:u.time)||o.updateTime||0},I=function(A){return Is({scene:{type:"enum",values:Qr}},A)}({scene:v});v==="superTeam"?r.params.push(_):i.params.push(O(O({},_),I))}catch(C){e.logger.warn(C)}}),{superTeam:r,p2pOrTeam:i}},a}();function Bl(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return oC(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?oC(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oC(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}var yU=function(a){function p(t,e){var r;return(r=a.call(this,"session",t)||this).list=new Dr,r.unreadCountFilterFn=function(i){return!0},r.lastMessageFilterFn=function(i){return!0},r.initEventListeners(),Kt({cmdMap:hU,cmdConfig:fU}),r.stickTopService=new gU(t),r.unreadModule=new vU(t),e&&r.setOptions(e),r}bt(p,a);var l=p.prototype;return l.setOptions=function(e){typeof(e==null?void 0:e.unreadCountFilterFn)=="function"&&(this.unreadCountFilterFn=e.unreadCountFilterFn),typeof(e==null?void 0:e.lastMessageFilterFn)=="function"&&(this.lastMessageFilterFn=e.lastMessageFilterFn)},l.reset=function(){var e;ae(e=this.list).call(e,function(r){r.unreadMsgs=[]}),this.list.clear()},l.initEventListeners=function(){var e,r,i,o,u=this;this.core.eventBus.on("session/syncMsgs",et(e=this.onSyncMsgs).call(e,this)),this.core.eventBus.on("session/updateForNewMsg",et(r=this.updateSessionWithMsg).call(r,this)),this.core.eventBus.on("session/updateForModifyMsg",et(i=this.updateSessionByModifyMsg).call(i,this)),this.core.eventBus.on("session/updateForClearMsg",function(h,g){g===void 0&&(g=!0),h&&h.length>0&&ae(h).call(h,function(v){u.updateSession({id:v.sessionId,lastMsg:null,unread:0,unreadMsgs:[]},g)})}),this.core.eventBus.on("session/updateForDeletedMsg",et(o=this.updateSessionForDeletedMsg).call(o,this))},l.createSession=function(e,r){try{var i=Wn(e);return{id:e,scene:i.scene,to:i.accid,lastMsg:r,updateTime:r?r.time:0,unread:0,unreadMsgs:[],ack:0}}catch(o){throw this.logger.error("Failed to create session with "+e,o),new Error("Failed to create session with "+e)}},l.getSession=function(e){P({id:{type:"string",allowEmpty:!1}},e);var r=this.list.get(e.id);if(this.isSessionComplete(r))return r},l.getSessionWithUncomplete=function(e){return this.list.get(e.id)},l.getAllSessions=function(){for(var e,r=[],i=Bl(this.list);!(e=i()).done;){var o=e.value;o[0];var u=o[1];this.isSessionComplete(u)&&r.push(u)}return r},l.getSessions=function(e){P({limit:{type:"number",required:!1},lastSessionId:{type:"string",allowEmpty:!1,required:!1},desc:{type:"boolean",required:!1}},e);var r=[],i=e.limit,o=i===void 0?100:i,u=e.desc,h=u===void 0||u,g=e.lastSessionId,v=0;if(h){for(var _,I,C=Bl(this.list);!(I=C()).done;){var A=I.value,N=A[0],F=A[1];if(g===N)break;this.isSessionComplete(F)&&r.push(F)}return Wi(_=ht(r).call(r,-o)).call(_)}for(var j,W=Bl(this.list);!(j=W()).done;){var U=j.value,ie=U[0],te=U[1];if(g)ie===g&&(g=void 0);else if(this.isSessionComplete(te)){if(++v>o)break;r.push(te)}}return r},l.resetSessionUnreadCount=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v,_,I,C,A=this;return T.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(P({id:{type:"string",allowEmpty:!1}},e),P({id:{type:"string",allowEmpty:!1}},e),o=e.id,u=this.list.get(o)){F.next=7;break}throw this.logger.warn("resetSessionUnreadCount: can not find session "+o),new Error("Session::canSessionResetUnreadCount: can not find session "+o);case 7:h=!1;try{h=this.unreadModule.canSessionResetUnreadCount(u)}catch(j){this.logger.warn(j)}if(h!==!1){F.next=11;break}return F.abrupt("return");case 11:return g=Wn(o),v=g.accid,_=g.scene,I={to:v,timetag:((r=u==null?void 0:u.lastMsg)===null||r===void 0?void 0:r.time)||u.updateTime||0},C="markSuperTeamSessionAck",_!=="superTeam"&&(I.scene=_==="p2p"?0:1,C="markSessionAck"),F.abrupt("return",this.core.sendCmd(C,I).then(function(){var j=A.storeUnreadByAck(o,I.timetag);j&&A.core.emit("updateSession",j)}));case 16:case"end":return F.stop()}},i,this)}))},l.resetMultiSessionUnreadCount=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_,I,C,A,N,F,j,W,U=this;return T.wrap(function(te){for(;;)switch(te.prev=te.next){case 0:P({ids:{type:"array",itemType:"string",min:1}},e),u=at(i=se(o=e.ids).call(o,function(H){return U.list.get(H)})).call(i,function(H,V){return!!H||(U.logger.warn("Session::canSessionResetUnreadCount: can not find session "+e.ids[V]),!1)}),h=this.unreadModule.filterSessionForResetUnreadCount(u),g=h.superTeam,v=h.p2pOrTeam,_=Zi(g.params,50),I=Zi(v.params,50),C=Bl(_);case 6:if((A=C()).done){te.next=13;break}return N=A.value,te.next=10,this.core.sendCmd(g.cmd,{datas:N});case 10:ae(N).call(N,function(H){var V=U.storeUnreadByAck(H.sessionId,H.timetag);V&&U.core.emit("updateSession",V)});case 11:te.next=6;break;case 13:F=Bl(I);case 14:if((j=F()).done){te.next=21;break}return W=j.value,te.next=18,this.core.sendCmd(v.cmd,{datas:W});case 18:ae(W).call(W,function(H){var V=U.storeUnreadByAck(H.sessionId,H.timetag);V&&U.core.emit("updateSession",V)});case 19:te.next=14;break;case 21:case"end":return te.stop()}},r,this)}))},l.resetAllSessionsUnreadCount=function(){var e,r=[];return ae(e=this.list).call(e,function(i){r.push(i.id)}),r.length===0?He.resolve():this.resetMultiSessionUnreadCount({ids:r})},l.deleteSession=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(P({id:{type:"string",allowEmpty:!1},isSyncToServer:{type:"boolean",required:!1}},e),this.list.delete(e.id),!this.core.msgLog||!e.isSyncToServer){o.next=5;break}return o.next=5,this.core.msgLog.deleteRoamingMsgs({ids:[e.id]});case 5:case"end":return o.stop()}},r,this)}))},l.deleteAllSessionsFromLocal=function(){this.list.clear()},l.addStickTopSession=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.stickTopService.addStickTopSession(e);case 2:return i=u.sent,this.list.set(i.id,i),u.abrupt("return",i);case 5:case"end":return u.stop()}},r,this)}))},l.deleteStickTopSession=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.stickTopService.deleteStickTopSession(e);case 2:return i=u.sent,this.list.set(i.id,i),u.abrupt("return",i);case 5:case"end":return u.stop()}},r,this)}))},l.updateStickTopSession=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.stickTopService.updateStickTopSession(e);case 2:return i=u.sent,this.list.set(i.id,i),u.abrupt("return",i);case 5:case"end":return u.stop()}},r,this)}))},l.nimMultiSyncAddStickTopSessionHandler=function(e){var r=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(r.id,r),this.core.emit("updateSession",r)},l.nimMultiSyncDeleteStickTopSessionHandler=function(e){var r=this.stickTopService.stickTopSessionHandler({id:e.content.data.id,updateTime:e.content.timetag,ext:""},!1);this.list.set(r.id,r),this.core.emit("updateSession",r)},l.nimMultiSyncUpdateStickTopSessionHandler=function(e){var r=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(r.id,r),this.core.emit("updateSession",r)},l.nimSyncStickTopSessionsHandler=function(e){var r,i=this;if(this.core.eventBus.emit("sync/updateTimetag",{stickTopSessions:e.content.timetag}),e.content.isThereAnyChange){var o=e.content.datas,u=[];ae(r=this.list).call(r,function(h){var g;h&&(!((g=h==null?void 0:h.stickTopInfo)===null||g===void 0)&&g.isStickOnTop)&&u.push(h)}),ae(u).call(u,function(h){var g=h.id;if(!bl(o).call(o,function(A){var N=Wn(A.id,"|");return N.scene+"-"+N.accid===g})){var v={},_=Wn(g,"-"),I=_.scene,C=_.accid;v.id=I+"|"+C,v.ext="",v.isTop=!1,o.push(v)}}),ae(o).call(o,function(h){var g;h.isTop===!1?(delete h.isTop,g=i.stickTopService.stickTopSessionHandler(h,!1)):g=i.stickTopService.stickTopSessionHandler(h),i.list.set(g.id,g)})}},l.updateSessionWithMsg=function(e){var r,i,o=!0,u=!0,h=typeof((r=e.pushInfo)===null||r===void 0?void 0:r.needPushBadge)!="boolean"||((i=e.pushInfo)===null||i===void 0?void 0:i.needPushBadge);try{o=!!this.unreadCountFilterFn(e)}catch(I){this.logger.error("session:updateSessionWithMsg, unreadCountFilterFn error",I)}try{u=!!this.lastMessageFilterFn(e)}catch(I){this.logger.error("session:updateSessionWithMsg, lastMessageFilterFn error",I)}var g=this.list.get(e.sessionId)||this.createSession(e.sessionId),v=!1;if(this.logger.log("session:updateSessionWithMsg, pending ",e.sessionId,e.idClient,e.idServer,u,o),u&&(!g.lastMsg||g.lastMsg.time<e.time||e.status===Lr[Lr.sending]||g.lastMsg.status===Lr[Lr.sending])&&(g.lastMsg=e,g.updateTime=e.time,v=!0),o&&h&&e.status===Lr[Lr.unread]&&e.time>(g.ack||0)){g.unread++;var _=g.unreadMsgs||[];_.unshift(e),Tr(_).call(_,function(I,C){return C.time-I.time}),g.unreadMsgs=_,v=!0}v&&(this.logger.log("session:updateSessionWithMsg updating ",g.id,g.unread,g.lastMsg&&g.lastMsg.idClient),this.list.set(g.id,g),this.core.emit("updateSession",g))},l.updateSessionByModifyMsg=function(e){var r=this.list.get(e.sessionId)||this.createSession(e.sessionId),i=r.unreadMsgs||[],o=Ni(i).call(i,function(h){return h.idClient===e.idClient});o>-1&&(i[o]=e),r.unreadMsgs=i,this.list.set(r.id,r);var u=!0;try{u=!!this.lastMessageFilterFn(e)}catch(h){this.logger.error("session:updateSessionByModifyMsg, lastMessageFilterFn error",h)}u&&(r.lastMsg&&r.lastMsg.idClient!==e.idClient||(r.lastMsg=e,r.updateTime=e.time,this.logger.log("session:updateSessionByModifyMsg updating ",r.id,r.unread,r.lastMsg&&r.lastMsg.idClient),this.list.set(r.id,r),this.core.emit("updateSession",r)))},l.storeUnreadByAck=function(e,r){var i=this.list.get(e)||this.createSession(e);if(!(i.ack&&r<i.ack)){var o=i.unreadMsgs||[],u=[],h=[],g=0;return i.unreadMsgs=[],o.length>0&&(ae(o).call(o,function(v){_t(h).call(h,v.idClient)||v.time>r&&(g++,h.push(v.idClient),u.push(v))}),i.unreadMsgs=Tr(u).call(u,function(v,_){return _.time-v.time})),i.ack=r,i.unread=g,i.lastMsg&&i.lastMsg.status==="unread"&&r>=i.lastMsg.time&&(i.lastMsg.status="read"),this.list.set(e,i),i}this.logger.warn("storeUnreadByAck: not need update ack",e,r,i.ack)},l.updateSession=function(e,r){r===void 0&&(r=!0);var i=e.id,o=this.list.get(i)||this.createSession(e.id),u=O(o,e);return this.list.set(i,u),this.logger.log("updateSession: update",r,Ss(e,["id","ack","unread"]),u.lastMsg&&u.lastMsg.idClient),r&&this.core.emit("updateSession",u),u},l.isSessionComplete=function(e){return!!e&&!!(e.id&&e.scene&&e.to)&&e.lastMsg!==void 0},l.syncSessionAckHandler=function(e){var r,i,o=this,u=e.content.p2p||{},h=e.content.team.m_map||{};this.logger.log("syncSessionAck::",u,h),ae(r=pt(u)).call(r,function(g){o.updateSession({id:"p2p-"+g,ack:u[g]},!1)}),ae(i=pt(h)).call(i,function(g){o.updateSession({id:"team-"+g,ack:h[g]},!1)})},l.syncSuperTeamSessionAckHandler=function(e){var r,i=this,o=e.content.superTeam.m_map;this.logger.log("syncSuperTeamSessionAck::",o),ae(r=pt(o)).call(r,function(u){i.updateSession({id:"superTeam-"+u,ack:o[u]},!1)})},l.syncMarkSessionAckHandler=function(e){var r=e.content,i=(r.scene===0?"p2p":r.scene===1?"team":"superTeam")+"-"+r.to,o=this.list.get(i);if(o&&o.ack&&r.timetag<o.ack)this.logger.warn("syncMarkSessionAckHandler: "+i+" do not need update ack",o.ack,r.timetag);else{var u=this.storeUnreadByAck(i,r.timetag);u&&this.core.emit("updateSession",u)}},l.syncMarkSuperTeamSessionAckHandler=function(e){e.content.scene=5,this.syncMarkSessionAckHandler(e)},l.onSyncDone=function(){var e,r,i,o=this,u=[];ae(e=this.list).call(e,function(h,g){u.push(o.storeUnreadByAck(g,h.ack||0))}),this.list.clear(),ae(r=Tr(u).call(u,function(h,g){return h.updateTime-g.updateTime})).call(r,function(h){o.list.set(h.id,h)}),(u=Tr(i=at(u).call(u,function(h){return o.isSessionComplete(h)})).call(i,function(h,g){return g.updateTime-h.updateTime})).length>0&&this.core.emit("sessions",u)},l.onSyncMsgs=function(e){var r,i=this,o=this.list.get(e.sessionId),u=[];try{var h;u=at(h=e.msgs).call(h,function(C){var A,N,F=typeof((A=C.pushInfo)===null||A===void 0?void 0:A.needPushBadge)!="boolean"||((N=C.pushInfo)===null||N===void 0?void 0:N.needPushBadge);return i.unreadCountFilterFn(JSON.parse(xe(C)))&&F})}catch(C){this.logger.error("session:onSyncMsgs, unreadCountFilterFn error ",C)}var g,v=[];try{var _;v=at(_=e.msgs).call(_,function(C){return i.lastMessageFilterFn(JSON.parse(xe(C)))})}catch(C){this.logger.error("session:onSyncMsgs, lastMessageFilterFn error ",C)}v&&v.length>0&&(g=v[v.length-1],g=v[0].time>g.time?v[0]:g);var I=g?g.time:0;o||(o=g?this.createSession(e.sessionId,g):this.createSession(e.sessionId)),o.unreadMsgs=o.unreadMsgs?at(r=dt(u).call(u,o.unreadMsgs)).call(r,function(C){return C.status===Lr[Lr.unread]}):at(u).call(u,function(C){return C.status===Lr[Lr.unread]}),o.updateTime&&o.updateTime>=I||(o.updateTime=I),o.lastMsg&&o.lastMsg.time>=I||(o.lastMsg=g),this.list.set(o.id,o)},l.updateSessionForDeletedMsg=function(e){var r,i=this,o={};ae(e).call(e,function(u){var h,g=u.to===i.core.account?u.from:u.to,v=u.scene+"-"+g,_=i.list.get(v);if(_){var I=Ln(h=_.unreadMsgs).call(h,function(j){return j.idClient===u.idClient}),C=!0;try{C=!!i.unreadCountFilterFn(u)}catch(j){i.logger.error("session:updateSessionForDeletedMsg, unreadCountFilterFn error",j)}var A=_.ack||0;if(C&&I&&A<u.time&&u.from!==i.core.account&&_.unread>0&&(_.unread=_.unread-1,_.unreadMsgs&&_.unreadMsgs.length>0)){var N,F=function(W,U){W=W||[],U=U||{};for(var ie=0;ie<W.length;ie++){var te=!0;for(var H in U)if(W[ie][H]!==U[H]){te=!1;break}if(te)return ie}return-1}(_.unreadMsgs,{idClient:u.idClient});F>=0&&wn(N=_.unreadMsgs).call(N,F,1)}_.lastMsg&&_.lastMsg.idClient===u.idClient&&(_.lastMsg=null),o[_.id]=!0}}),ae(r=pt(o)).call(r,function(u){var h=i.list.get(u);h&&i.core.emit("updateSession",h)})},l.multiSyncMsgReceiptHandler=function(e){var r,i=(r=e.content)===null||r===void 0?void 0:r.msgReceiptTag;if(i){this.updateSessionMsgReceiptTime([i],!0),i.msgReceiptTime=i.time,i.sessionId="p2p-"+i.from,i.time,i.from;var o=br(i,["time","from"]);this.core.emit("msgReceipts",[o])}},l.syncMsgReceiptsHandler=function(e){var r,i=(r=e.content)===null||r===void 0?void 0:r.msgReceipts;i&&this.updateSessionMsgReceiptTime(i,!1)},l.updateSessionMsgReceiptTime=function(e,r){var i=this;r===void 0&&(r=!0),e&&e.length>0&&ae(e).call(e,function(o){var u=i.list.get("p2p-"+o.from);u||(u=i.createSession("p2p-"+o.from));var h=it(o.time);u.msgReceiptTime&&u.msgReceiptTime>=h||(u.msgReceiptTime=h,u.lastMsg&&u.lastMsg.status==="sent"&&h>=u.lastMsg.time&&(u.lastMsg.status="receipt"),i.logger.log("session: update session "+u.id+" msgReceiptTime: "+u.msgReceiptTime),i.list.set(u.id,u),r&&i.core.emit("updateSession",u))})},p}(Vn),_U=function(){function a(l){this.core=l}var p=a.prototype;return p.notifyAddTeamMembers=function(t,e){this.core.emit("addTeamMembers",{team:t,accounts:e,members:YD(t,e)})},p.notifyUpdateTeamManagers=function(t,e,r,i){this.core.emit("updateTeamManagers",{team:{teamId:t,memberUpdateTime:i},accounts:e,isManager:r,members:se(e).call(e,function(o){return{id:t+"-"+o,account:o,type:r?"manager":"normal",updateTime:i}})})},p.notifyRemoveTeamMembers=function(t,e){this.core.emit("removeTeamMembers",{team:t,accounts:e})},p.notifyTransferTeam=function(t,e,r){this.core.emit("transferTeam",{team:t,from:{id:t.teamId+"-"+e,type:"normal",account:e,updateTime:t.memberUpdateTime},to:{id:t.teamId+"-"+r,type:"owner",account:r,updateTime:t.memberUpdateTime}})},p.notifyUpdateTeamMembersMute=function(t,e,r){this.core.emit("updateTeamMembersMute",{team:t,accounts:e,members:se(e).call(e,function(i){return{id:t.teamId+"-"+i,account:i,teamId:t.teamId,mute:r,updateTime:t.memberUpdateTime}}),mute:r})},a}();function En(a,p){if((p=new Dr).get(a))return a;if(a instanceof RegExp)return new RegExp(a);if(a instanceof Date)return new Date(a.getTime());if(qt(a))return p.set(a,!0),se(a).call(a,function(e){return En(e,p)});if(typeof a=="object"&&a!==null){var l;p.set(a,!0);var t={};return ae(l=pt(a)).call(l,function(e){t[e]=En(a[e],p)}),t}return a}var MU=function(a){function p(t){var e;return(e=a.call(this,"team",t)||this).myTeamMembersMap=new Dr,e.service=new _U(t),e.setListeners(),Kt({cmdMap:WD,cmdConfig:JD}),e}bt(p,a);var l=p.prototype;return l.setListeners=function(){var e=this;this.core.eventBus.on("forwardReceive/team/updateMyMemberInfo",function(r){e.emitMemberUpdate(r)}),this.core.eventBus.on("team/onNotification",function(r){return e.notificationHandler(r)})},l.reset=function(){this.myTeamMembersMap.clear()},l.mergeMyTeamMembers=function(e){var r=this;ae(e).call(e,function(i){var o=i.teamId,u=r.myTeamMembersMap.get(o),h=O({},u,i);r.myTeamMembersMap.set(o,h)})},l.getTeamInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),h.next=3,this.core.sendCmd("getTeamInfo",{teamId:e.teamId});case 3:return i=h.sent,o=i.content.team,h.abrupt("return",yo(o));case 6:case"end":return h.stop()}},r,this)}))},l.getTeams=function(){return k(this,void 0,void 0,T.mark(function e(){var r,i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.core.sendCmd("getTeams",{timetag:0});case 2:return r=u.sent,i=r.content.teams,u.abrupt("return",Vg(i));case 5:case"end":return u.stop()}},e,this)}))},l.getTeamsById=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({teamIds:{type:"array",itemType:"string"}},e),h.next=3,this.core.sendCmd("getTeamsById",{teamIds:e.teamIds});case 3:return i=h.sent,o=Vg(i.content.teams),h.abrupt("return",{teams:o,tids:i.content.tids});case 6:case"end":return h.stop()}},r,this)}))},l.createTeam=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({type:{type:"enum",values:["advanced","normal"]},name:{type:"string",allowEmpty:!1},level:{type:"number",required:!1},accounts:{type:"array",itemType:"string",required:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),i=Dg(e),g.next=4,this.core.sendCmd("createTeam",{team:i,accounts:e.accounts||[],ps:e.ps||""});case 4:return o=g.sent,u=yo(o.content.team),this.core.eventBus.emit("forwardSend/team/created",u),g.abrupt("return",u);case 8:case"end":return g.stop()}},r,this)}))},l.dismissTeam=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),o.next=3,this.core.sendCmd("dismissTeam",{teamId:e.teamId});case 3:case"end":return o.stop()}},r,this)}))},l.leaveTeam=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),o.next=3,this.core.sendCmd("leaveTeam",{teamId:e.teamId});case 3:case"end":return o.stop()}},r,this)}))},l.transferTeam=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),o.next=3,this.core.sendCmd("transferTeam",e);case 3:case"end":return o.stop()}},r,this)}))},l.updateTeamInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),i=Dg(e),u.next=4,this.core.sendCmd("updateTeamInfo",{team:i});case 4:return u.abrupt("return",yo(i));case 5:case"end":return u.stop()}},r,this)}))},l.getTeamMembers=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",required:!1}},e),g.next=3,this.core.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0});case 3:if(o=g.sent,u=WE((r=o.content)===null||r===void 0?void 0:r.teamMembers),e.accounts&&e.accounts.length>0){g.next=7;break}return g.abrupt("return",u);case 7:return g.abrupt("return",at(u).call(u,function(v){var _;return(_=e.accounts)===null||_===void 0?void 0:_t(_).call(_,v.account)}));case 8:case"end":return g.stop()}},i,this)}))},l.getMutedTeamMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),h.next=3,this.core.sendCmd("getMutedTeamMembers",{teamId:e.teamId});case 3:return i=h.sent,o=i.content,h.abrupt("return",WE(o.teamMembers));case 6:case"end":return h.stop()}},r,this)}))},l.addTeamMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),o.next=3,this.core.sendCmd("addTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""});case 3:case"end":return o.stop()}},r,this)}))},l.removeTeamMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),o.next=3,this.core.sendCmd("removeTeamMembers",{teamId:e.teamId,accounts:e.accounts});case 3:case"end":return o.stop()}},r,this)}))},l.applyTeam=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),u.next=3,this.core.sendCmd("applyTeam",{teamId:e.teamId,ps:e.ps||""});case 3:return i=u.sent,u.abrupt("return",yo(i.content.team));case 5:case"end":return u.stop()}},r,this)}))},l.addTeamManagers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),o.next=3,this.core.sendCmd("addTeamManagers",e);case 3:case"end":return o.stop()}},r,this)}))},l.removeTeamManagers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),o.next=3,this.core.sendCmd("removeTeamManagers",e);case 3:case"end":return o.stop()}},r,this)}))},l.updateMyMemberInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e),i=YE({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext}),g.next=4,this.core.sendCmd("updateMyMemberInfo",{teamMember:i});case 4:return o=_c(O({updateTime:new Date().getTime(),account:this.core.account},i)),u=this.emitMemberUpdate(o),this.core.eventBus.emit("forwardSend/team/updateMyMemberInfo",u),g.abrupt("return",o);case 8:case"end":return g.stop()}},r,this)}))},l.emitMemberUpdate=function(e){e=_c(e),this.mergeMyTeamMembers([e]),this.core.emit("updateTeamMember",e);var r=En(this.myTeamMembersMap.get(e.teamId));return this.core.emit("myTeamMembers",[r]),r},l.updateMemberNick=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},e),i=YE({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account}),h.next=4,this.core.sendCmd("updateNickInTeam",{teamMember:i});case 4:return o=_c(O({updateTime:new Date().getTime()},i)),h.abrupt("return",o);case 6:case"end":return h.stop()}},r,this)}))},l.muteTeamMember=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},mute:{type:"boolean"}},e),o.next=3,this.core.sendCmd("muteTeamMember",{teamId:e.teamId,account:e.account,mute:e.mute?1:0});case 3:case"end":return o.stop()}},r,this)}))},l.getTeamMemberInvitorAccid=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:200}},e),o={teamId:e.teamId},e.accounts&&e.accounts.length>0&&(o.accounts=e.accounts),g.next=5,this.core.sendCmd("getTeamMemberInvitorAccid",o);case 5:return u=g.sent,g.abrupt("return",((r=u.content)===null||r===void 0?void 0:r.accountsMap)||{});case 7:case"end":return g.stop()}},i,this)}))},l.muteTeam=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),o.next=3,this.core.sendCmd("muteTeam",{teamId:e.teamId,mute:e.mute?1:0});case 3:case"end":return o.stop()}},r,this)}))},l.passTeamApply=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),u.prev=1,u.next=4,this.core.sendCmd("passTeamApply",e);case 4:this.core.eventBus.emit("forwardSend/team/passTeamApply",e),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),i=u.t0,this.core.eventBus.emit("forwardSend/team/passTeamApply",e,i==null?void 0:i.code),u.t0;case 12:case"end":return u.stop()}},r,this,[[1,7]])}))},l.rejectTeamApply=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),u.prev=1,u.next=4,this.core.sendCmd("rejectTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamApply",e),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),i=u.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamApply",e,i==null?void 0:i.code),u.t0;case 12:case"end":return u.stop()}},r,this,[[1,7]])}))},l.acceptTeamInvite=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),u.prev=1,u.next=4,this.core.sendCmd("acceptTeamInvite",e);case 4:this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",e),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),i=u.t0,this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",e,i==null?void 0:i.code),u.t0;case 12:case"end":return u.stop()}},r,this,[[1,7]])}))},l.rejectTeamInvite=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),u.prev=1,u.next=4,this.core.sendCmd("rejectTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",e),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),i=u.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",e,i==null?void 0:i.code),u.t0;case 12:case"end":return u.stop()}},r,this,[[1,7]])}))},l.notifyTeamMsgReceiptsHandler=function(e){var r,i=(r=e.content)===null||r===void 0?void 0:r.teamMsgReceipts;i&&i.length>0&&(this.core.emit("teamMsgReceipts",i),this.core.emit("msgReceipts",i))},l.syncTeamsHandler=function(e){var r=e.content;this.core.eventBus.emit("sync/updateTimetag",{teams:it(r.timetag)});var i=r==null?void 0:r.teams;if(i&&i.length){var o=Vg(i);this.core.emit("teams",o)}},l.syncCreateTeamHandler=function(e){var r=e.content,i=yo(r==null?void 0:r.team),o=JE(i,i.owner,"owner");this.core.emit("createTeam",i,o)},l.syncUpdateTeamMemberHandler=function(e){var r=e.content,i=_c(r==null?void 0:r.teamMember);i.updateTime||(i.updateTime=new Date().getTime()),this.mergeMyTeamMembers([i]),this.core.emit("updateTeamMember",i);var o=En(this.myTeamMembersMap.get(i.teamId));this.core.emit("myTeamMembers",[o])},l.syncMyTeamMembersHandler=function(e){var r,i=e.content;this.core.eventBus.emit("sync/updateTimetag",{myTeamMembers:it(i.timetag)});var o=i==null?void 0:se(r=i.teamMembers).call(r,function(u){return _c(u)});this.mergeMyTeamMembers(o),this.core.emit("myTeamMembers",En(o))},l.notificationHandler=function(e){var r=e.attach,i=e.scene,o=e.from,u=e.to,h=e.time,g=e.idServer,v=e.idClient,_=r.team,I=r.account,C=r.accounts,A=r.type;if(i==="team")switch(this.logger.getDebugMode()?this.logger.debug("team::recvNotification",g,v,r):this.logger.log("team::recvNotification",g,v,u,A,I,C),A){case"updateTeam":_.updateTime=h,this.core.emit("updateTeam",_);break;case"addTeamMembers":this.service.notifyAddTeamMembers(_,C);break;case"acceptTeamInvite":this.service.notifyAddTeamMembers(_,[o]);break;case"passTeamApply":this.service.notifyAddTeamMembers(_,[I]);break;case"addTeamManagers":this.service.notifyUpdateTeamManagers(u,C,!0,h);break;case"removeTeamManagers":this.service.notifyUpdateTeamManagers(u,C,!1,h);break;case"removeTeamMembers":this.service.notifyRemoveTeamMembers(_,C);break;case"leaveTeam":this.service.notifyRemoveTeamMembers(_,[o]);break;case"dismissTeam":this.core.emit("dismissTeam",{teamId:u});break;case"transferTeam":this.service.notifyTransferTeam(_,o,I);break;case"updateTeamMemberMute":this.service.notifyUpdateTeamMembersMute(_,[I],r.mute)}},p}(Vn),TU={"4_6":"syncOfflineSysMsgs","4_18":"syncOfflineSysMsgs","4_19":"syncRecallMsgOfflineAndRoaming","7_3":"onSysMsg","7_7":"sendCustomSysMsg","7_14":"onRecallMsg","21_18":"onRecallMsg","21_117":"onRecallMsg","7_15":"syncRecallMsgOfflineAndRoaming","21_19":"onSysMsg","21_16":"sendSuperTeamCustomSysMsg"},Wd={sysMsg:O({time:0,type:1,to:2,from:3,content:4,attach:5,idServer:6,needSaveOffline:7,deletedIdClient:10,deletedIdServer:11,needcAntiSpam:12,antiSpamContent:13,deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,envConfig:21,callbackExt:22,isRoutable:105},rC)},ql=rn(Wd),IU={onSysMsg:{service:"systemMessage",sid:7,cid:3,response:[{type:"Property",name:"sysMsg",reflectMapper:ql.sysMsg}]},sendCustomSysMsg:{service:"systemMessage",sid:7,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:Wd.sysMsg}]},sendSuperTeamCustomSysMsg:{service:"systemMessage",sid:21,cid:16,params:[{type:"Property",name:"sysMsg",reflectMapper:Wd.sysMsg}]},sendFilterCustomSysMsg:{service:"systemMessage",sid:101,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:Wd.sysMsg}]},batchMarkRead:{service:"systemMessage",sid:4,cid:5,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},onRecallMsg:{sid:7,cid:14,service:"systemMessage",response:[{type:"Property",name:"sysMsg",reflectMapper:ql.sysMsg}]},syncRecallMsgOfflineAndRoaming:{sid:7,cid:15,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:ql.sysMsg},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]},syncOfflineSysMsgs:{sid:4,cid:9,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:ql.sysMsg}]}},SU=function(a){function p(t){var e;return(e=a.call(this,"systemMessage",t)||this).sysMsgUnread={total:0,friend:0,msg:0,team:0,superTeam:0},e.core.eventBus.on("logined",function(){e.initEventListeners()}),Kt({cmdMap:TU,cmdConfig:IU}),e}bt(p,a);var l=p.prototype;return l.initEventListeners=function(){var e=this;this.core.eventBus.on("systemMessage/passFriendApply",function(r){e.core.emit("updateSystemMessages",[{idServer:r.idServer,from:r.account,state:"pass",type:"friendRequest"}])}),this.core.eventBus.on("systemMessage/rejectFriendApply",function(r){e.core.emit("updateSystemMessages",[{idServer:r.idServer,from:r.account,state:"decline",type:"friendRequest"}])})},l.doMarkSysMsgAck=function(e){var r=[],i=[],o=["customSuperTeam"];ae(e).call(e,function(u){u.idServer&&(_t(o).call(o,u.type)?i.push(u.idServer):r.push(u.idServer))}),r.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:r}),i.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:i})},l.sendCustomSysMsg=function(e){var r=this;P({to:{type:"string",allowEmpty:!1},type:{type:"enum",values:["customP2p","customTeam","customSuperTeam"]},attach:{type:"string",allowEmpty:!1},setting:{type:"object",rules:{needSaveOffline:{type:"boolean",required:!1},env:{type:"string",allowEmpty:!1,required:!1}},required:!1},pushInfo:{type:"object",required:!1,rules:Bg}},e);var i=e.type==="customSuperTeam"?"sendSuperTeamCustomSysMsg":"sendCustomSysMsg";return this.core.sendCmd(i,{sysMsg:oU(e)}).then(function(){r.logger.log("sendCustomSysMsg success")}).catch(function(o){throw r.logger.error("sendCustomSysMsg failed",o.message),o})},l.onSysMsgHandler=function(e){var r,i=(r=e.content)===null||r===void 0?void 0:r.sysMsg;if(i){var o=Fl(i=zi(e,e.content.sysMsg,"idServer"),this.logger,xs.default);this.core.emit("sysMsg",o),this.doMarkSysMsgAck([o])}else this.logger.warn("onSysMsg no content.sysMsg")},l.syncOfflineSysMsgsHandler=function(e){var r,i=this;if(e.content.sysMsgs&&e.content.sysMsgs.length>0){var o=se(r=e.content.sysMsgs).call(r,function(u){return Fl(u,i.logger,xs.leave)});this.core.emit("syncSysMsgs",o),this.doMarkSysMsgAck(o)}},l.onRecallMsgHandler=function(e){var r,i=(r=e.content)===null||r===void 0?void 0:r.sysMsg;if(i){var o=va([i=zi(e,e.content.sysMsg,"idServer")],iC(+i.type));this.core.eventBus.emit("session/updateForDeletedMsg",o);var u=Fl(i,this.logger,xs.default);this.core.emit("sysMsg",u),this.doMarkSysMsgAck([u])}else this.logger.warn("onSysMsg no content.sysMsg")},l.syncRecallMsgOfflineAndRoamingHandler=function(e){var r=this,i=e.content,o=i.timetag,u=i.type,h=i.sysMsgs,g=it(u),v=g===1?xs.leave:xs.roam,_=se(h).call(h,function(I){return Fl(I,r.logger,v)});g===1&&this.doMarkSysMsgAck(_),this.core.eventBus.emit("sync/updateTimetag",{recallMsg:o}),this.core.emit("syncSysMsgs",_)},p}(Vn);function qg(a){var p=["bitsExtension","createTime","updateTime","passRelationShip","relationShip","source"],l=O({},a);return ae(p).call(p,function(t){l[t]!==void 0&&(l[t]=it(l[t]))}),l.relationShip!==void 0&&(l.valid=l.relationShip===1),l}var EU={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},CU={"12_4":"getFriends","12_1":"friendReuqest","12_2":"deleteFriend","12_3":"updateFriend","12_5":"syncFriends","12_6":"syncFriendUsers","12_101":"syncFriendRequest","12_102":"syncDeleteFriend","12_103":"syncUpdateFriend"},Gg={updateFriendTag:{account:4,alias:8,ext:10},delFriendParams:{delAlias:1},friendTag:{account:4,relationShip:5,passRelationShip:6,source:7,alias:8,bitsExtension:9,ext:10,createTime:11,updateTime:12,serverex:13},userTag:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13}},Jd=rn(Gg),bU={getFriends:{sid:12,cid:4,service:"friend",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:Jd.friendTag},{type:"Long",name:"timetag"}]},friendReuqest:{sid:12,cid:1,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:12,cid:2,service:"friend",params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams",reflectMapper:Gg.delFriendParams}]},updateFriend:{sid:12,cid:3,service:"friend",params:[{type:"Property",name:"updateFriendTag",reflectMapper:Gg.updateFriendTag}]},syncFriends:{sid:12,cid:5,service:"friend",response:[{type:"PropertyArray",name:"friends",entity:"friendTag",reflectMapper:Jd.friendTag},{type:"Long",name:"timetag"}]},syncFriendUsers:{sid:12,cid:6,service:"friend",response:[{type:"PropertyArray",name:"users",entity:"userTag",reflectMapper:Jd.userTag},{type:"Long",name:"timetag"}]},syncFriendRequest:{sid:12,cid:101,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}],response:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},syncDeleteFriend:{sid:12,cid:102,service:"friend",response:[{type:"String",name:"account"}]},syncUpdateFriend:{sid:12,cid:103,service:"friend",response:[{type:"Property",name:"friend",reflectMapper:Jd.friendTag}]}},AU=function(a){function p(t){var e;return e=a.call(this,"friend",t)||this,Kt({cmdMap:CU,cmdConfig:bU}),e}bt(p,a);var l=p.prototype;return l.getFriends=function(){var e;return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("getFriends",{timetag:0});case 2:return i=h.sent,o=((e=i.content)===null||e===void 0?void 0:e.friends)||[],o=se(o).call(o,function(g){return qg(g)}),h.abrupt("return",o);case 6:case"end":return h.stop()}},r,this)}))},l.addFriend=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({account:{type:"string",allowEmpty:!1},ps:{type:"string",allowEmpty:!1,required:!1}},e),u.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:1,ps:e.ps||""});case 3:return i=new Date().getTime(),this.core.eventBus.emit("forwardSend/friend/addFriend",e.account),u.abrupt("return",{account:e.account,createTime:i,updateTime:i,valid:!0,source:0,passRelationShip:1,relationShip:1,bitsExtension:0});case 6:case"end":return u.stop()}},r,this)}))},l.applyFriend=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({account:{type:"string",allowEmpty:!1}},e),o.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:2,ps:e.ps||""});case 3:case"end":return o.stop()}},r,this)}))},l.passFriendApply=function(e){return k(this,void 0,void 0,T.mark(function r(){var i=this;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({account:{type:"string",allowEmpty:!1}},e),u.prev=1,u.next=4,this.core.sendCmd("friendReuqest",{account:e.account,type:3,ps:e.ps||""}).then(function(h){return i.core.eventBus.emit("systemMessage/passFriendApply",e),h});case 4:this.core.eventBus.emit("forwardSend/friend/passFriendApply",e.account),u.next=11;break;case 7:throw u.prev=7,u.t0=u.catch(1),this.core.eventBus.emit("forwardSend/friend/passFriendApply",e.account,u.t0),u.t0;case 11:case"end":return u.stop()}},r,this,[[1,7]])}))},l.rejectFriendApply=function(e){return k(this,void 0,void 0,T.mark(function r(){var i=this;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({account:{type:"string",allowEmpty:!1}},e),u.prev=1,u.next=4,this.core.sendCmd("friendReuqest",{account:e.account,type:4,ps:e.ps||""}).then(function(h){return i.core.eventBus.emit("systemMessage/rejectFriendApply",e),h});case 4:this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",e.account,e.ps),u.next=11;break;case 7:throw u.prev=7,u.t0=u.catch(1),this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",e.account,e.ps,u.t0),u.t0;case 11:case"end":return u.stop()}},r,this,[[1,7]])}))},l.deleteFriend=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({account:{type:"string",allowEmpty:!1},delAlias:{type:"boolean"}},e),o.next=3,this.core.sendCmd("deleteFriend",{account:e.account,delFriendParams:{delAlias:e.delAlias===!0?1:0}});case 3:this.core.eventBus.emit("forwardSend/friend/deleteFriend",e.account);case 4:case"end":return o.stop()}},r,this)}))},l.updateFriend=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({account:{type:"string",allowEmpty:!1},alias:{type:"string"},ext:{type:"string",required:!1}},e),o.next=3,this.core.sendCmd("updateFriend",{updateFriendTag:e});case 3:this.core.eventBus.emit("forwardSend/friend/updateFriend",e);case 4:case"end":return o.stop()}},r,this)}))},l.syncFriendRequestHandler=function(e){var r=function(o){var u=O({},o);try{u.ps=u.ps&&JSON.parse(u.ps)}catch{}if(u.type=EU[u.type],u.type==="addFriend"||u.type==="passFriendApply"){var h=new Date().getTime();u.friend={account:o.account,alias:"",createTime:h,ext:"",updateTime:h,valid:!0}}return u}(e.content);this.core.emit("syncFriend",r)},l.syncDeleteFriendHandler=function(e){var r=e.content.account;this.logger.log("friend::emit syncFriendAction: deleteFriend "+r),this.core.emit("syncFriend",{type:"deleteFriend",account:r})},l.syncUpdateFriendHandler=function(e){var r=qg(e.content.friend);this.logger.log("friend::emit syncFriendAction: updateFriend, ",r==null?void 0:r.account),this.core.emit("syncFriend",{type:"updateFriend",friend:r})},l.syncFriendsHandler=function(e){var r=e.content;this.core.eventBus.emit("sync/updateTimetag",{friends:it(r.timetag)});var i=r==null?void 0:r.friends;if(i&&i.length){var o=se(i).call(i,function(u){return qg(u)});this.core.emit("friends",o)}},l.syncFriendUsersHandler=function(e){var r=e.content;this.core.eventBus.emit("sync/updateTimetag",{friendUsers:it(r.timetag)});var i=r==null?void 0:r.users;if(i&&i.length){var o=se(i).call(i,function(u){return Mc(u)});this.core.emit("users",o)}},p}(Vn);function RU(a){return a&&a.length>0?se(a).call(a,function(p){return function(t){var e=O({},t),r=["subscribeTime","time"];return ae(r).call(r,function(i){e[i]&&(e[i]=it(e[i]))}),e}(p)}):[]}function jg(a){if(!a)return a;var p=a.serverExt,l=br(a,["serverExt"]),t=["time","type","value"];if(ae(t).call(t,function(e){l[e]&&(l[e]=it(l[e]))}),l.clientType&&(l.clientType=ic(ac,l.clientType)||""),p)try{l.ext=JSON.parse(p),typeof l.ext[0]=="string"&&(l.ext=l.ext[0])}catch{}return l}var NU={"14_1":"publishEvent","14_2":"pushEvent","14_3":"subscribeEvent","14_4":"unSubscribeEventsByAccounts","14_5":"unSubscribeEventsByType","14_6":"querySubscribeEventsByAccounts","14_7":"querySubscribeEventsByType","14_9":"pushEvents"},_a={msgEvent:{type:1,value:2,idClient:3,ext:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverExt:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105}},Gl=rn(_a),kU={publishEvent:{sid:14,cid:1,service:"event",params:[{type:"Property",name:"msgEvent",reflectMapper:_a.msgEvent}],response:[{type:"Property",name:"msgEvent",reflectMapper:Gl.msgEvent}]},pushEvent:{sid:14,cid:2,service:"event",response:[{type:"Property",name:"msgEvent",reflectMapper:Gl.msgEvent}]},subscribeEvent:{sid:14,cid:3,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:_a.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:14,cid:4,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:_a.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:14,cid:5,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:_a.msgEventSubscribe}]},querySubscribeEventsByAccounts:{sid:14,cid:6,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:_a.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Gl.msgEventSubscribe}]},querySubscribeEventsByType:{sid:14,cid:7,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:_a.msgEventSubscribe}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Gl.msgEventSubscribe}]},pushEvents:{sid:14,cid:9,service:"event",response:[{type:"PropertyArray",name:"msgEvents",reflectMapper:Gl.msgEvent}]}},OU=function(a){function p(t){var e;return e=a.call(this,"event",t)||this,Kt({cmdMap:NU,cmdConfig:kU}),e}bt(p,a);var l=p.prototype;return l.publishEvent=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({type:{type:"number"},value:{type:"number"},ext:{type:"string",required:!1},validTime:{type:"number",min:60,max:2592e3,required:!1},broadcastType:{type:"number",required:!1},sync:{type:"boolean",required:!1}},e),o=O(O({validTime:e.validTime||604800,broadcastType:e.broadcastType||2},e),{idClient:jr(),sync:e.sync===!0?1:0}),v.next=4,this.core.sendCmd("publishEvent",{msgEvent:o});case 4:return u=v.sent,h=((r=u.content)===null||r===void 0?void 0:r.msgEvent)||{},v.abrupt("return",jg(h));case 7:case"end":return v.stop()}},i,this)}))},l.subscribeEvent=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100},subscribeTime:{type:"number",min:60,max:2592e3,required:!1}},e),o=O(O({subscribeTime:2592e3},e),{sync:e.sync===!0?1:0}),v.next=4,this.core.sendCmd("subscribeEvent",{msgEventSubscribe:o,accounts:e.accounts});case 4:return u=v.sent,h=((r=u.content)===null||r===void 0?void 0:r.accounts)||[],v.abrupt("return",{failedAccounts:h});case 7:case"end":return v.stop()}},i,this)}))},l.unSubscribeEvents=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(P({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),o={type:e.type},!(e.accounts&&e.accounts.length>0)){v.next=9;break}return v.next=5,this.core.sendCmd("unSubscribeEventsByAccounts",{msgEventSubscribe:o,accounts:e.accounts});case 5:h=v.sent,u=((r=h.content)===null||r===void 0?void 0:r.accounts)||[],v.next=12;break;case 9:return v.next=11,this.core.sendCmd("unSubscribeEventsByType",{msgEventSubscribe:o});case 11:u=[];case 12:return v.abrupt("return",{failedAccounts:u});case 13:case"end":return v.stop()}},i,this)}))},l.querySubscribeEvents=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(P({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),!(e.accounts&&e.accounts.length>0)){h.next=7;break}return h.next=4,this.core.sendCmd("querySubscribeEventsByAccounts",{msgEventSubscribe:{type:e.type},accounts:e.accounts});case 4:o=h.sent,h.next=10;break;case 7:return h.next=9,this.core.sendCmd("querySubscribeEventsByType",{msgEventSubscribe:{type:e.type}});case 9:o=h.sent;case 10:return h.abrupt("return",RU((r=o.content)===null||r===void 0?void 0:r.msgEventSubscribes));case 11:case"end":return h.stop()}},i,this)}))},l.pushEventHandler=function(e){var r,i=((r=e.content)===null||r===void 0?void 0:r.msgEvent)||{};this.core.emit("pushEvents",[jg(i)])},l.pushEventsHandler=function(e){var r,i=((r=e.content)===null||r===void 0?void 0:r.msgEvents)||{};this.core.emit("pushEvents",function(u){return qt(u)&&u.length>0?se(u).call(u,function(h){return jg(h)}):[]}(i))},p}(Vn);function wU(a){var p={scene:Qr[a.scene],from:a.threadMsgFromAccount,to:a.threadMsgToAccount,time:a.threadMsgTime,idServer:a.threadMsgIdServer},l={limit:a.limit<100?a.limit:100,beginTime:typeof a.beginTime=="number"?a.beginTime:0,reverse:Wi(a)===!0?1:0};return a.lastMsgId&&(l.lastMsgId=a.lastMsgId),{msg:p,threadMsgReq:l}}var Qd,xU={"23_1":"getThreadMsgs","23_2":"getMsgsByIdServer"},zd={msg:To,threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2}},Xd=rn(zd),PU={getThreadMsgs:{sid:23,cid:1,service:"msgExtend",params:[{type:"Property",name:"msg",reflectMapper:zd.msg},{type:"Property",name:"threadMsgReq",reflectMapper:zd.threadMsgReq}],response:[{type:"Property",name:"threadMsg",reflectMapper:Xd.msg},{type:"Property",name:"threadMsgsMeta",reflectMapper:Xd.threadMsgsMeta},{type:"PropertyArray",name:"msgs",reflectMapper:Xd.msg}]},getMsgsByIdServer:{sid:23,cid:2,service:"msgExtend",params:[{type:"PropertyArray",name:"reqMsgs",reflectMapper:zd.msg}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Xd.msg}]}},LU=function(a){function p(t){var e;return e=a.call(this,"msgExtend",t)||this,Kt({cmdMap:xU,cmdConfig:PU}),e}bt(p,a);var l=p.prototype;return l.getThreadMsgs=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v,_,I;return T.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return P({scene:{type:"enum",values:Qt(Qr)},threadMsgFromAccount:{type:"string",allowEmpty:!1},threadMsgIdServer:{type:"string",allowEmpty:!1},threadMsgTime:{type:"number"},threadMsgToAccount:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},lastMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1}},e),A.next=3,this.core.sendCmd("getThreadMsgs",wU(e));case 3:return o=A.sent,u=o.content,h=u.msgs,g=u.threadMsg,v=o.content.threadMsgsMeta,_=_o(g,this.core.account),I=(r=this.core.session)===null||r===void 0?void 0:r.getSessionWithUncomplete({id:_}),h=Fg(h,I?{account:this.core.account,sessionAck:I.ack,msgReceiptTime:I.msgReceiptTime}:{account:this.core.account}),g=ei(g,I?{account:this.core.account,sessionAck:I.ack,msgReceiptTime:I.msgReceiptTime}:{account:this.core.account}),A.abrupt("return",{msgs:h,threadMsg:g,total:it(v.total),timetag:it(v.lastMsgTime)});case 11:case"end":return A.stop()}},i,this)}))},l.getMsgsByIdServer=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return P({reqMsgs:{type:"array",rules:{scene:{type:"enum",values:Qt(Qr)},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},time:{type:"number"}},min:1,max:100}},e),_.next=3,this.core.sendCmd("getMsgsByIdServer",{reqMsgs:se(i=e.reqMsgs).call(i,function(I){return O(O({},I),{scene:ic(Qr,I.scene)})})});case 3:return u=_.sent,h=se(o=u.content.msgs).call(o,function(I){var C,A=_o(I,g.core.account),N=(C=g.core.session)===null||C===void 0?void 0:C.getSessionWithUncomplete({id:A});return ei(I,N?{account:g.core.account,sessionAck:N.ack,msgReceiptTime:N.msgReceiptTime}:{account:g.core.account})}),_.abrupt("return",h);case 6:case"end":return _.stop()}},r,this)}))},p}(Vn);(function(a){a[a.ASC=1]="ASC",a[a.DESC=2]="DESC"})(Qd||(Qd={}));var Hg,VU={"7_6":"getHistoryMsgs","7_9":"deleteRoamingMsgs","4_24":"syncClearServerHistoryMsgs","7_18":"clearHistoryMsgsFromServer","7_118":"multiSyncClearServerHistoryMsgs","7_26":"nimFtsCloudMsgLogsAggWithSession","7_27":"nimFtsCloudMsgLogs"},jl={msg:To,clearHistoryMsgsFromServerReqTag:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,time:6,ext:7},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},ftsReqTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msglogsLimit:5,orderRule:6,p2pSessionList:7,teamSessionList:8,senderList:9,msgTypeList:10,msgSubTypeList:11}},Ic=rn(jl),DU={deleteRoamingMsgs:{sid:7,cid:9,service:"msgLog",params:[{type:"StrArray",name:"ids"}]},getHistoryMsgs:{sid:7,cid:6,params:[{type:"String",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Ic.msg}],service:"msgLog"},clearHistoryMsgsFromServer:{sid:7,cid:18,params:[{type:"Property",name:"clearHistoryMsgsFromServerReqTag",reflectMapper:jl.clearHistoryMsgsFromServerReqTag}],response:[{type:"Long",name:"timetag"}],service:"msgLog"},multiSyncClearServerHistoryMsgs:{sid:7,cid:118,response:[{type:"Property",name:"data",reflectMapper:Ic.clearMsgsParamsWithSync}],service:"msgLog"},syncClearServerHistoryMsgs:{sid:4,cid:24,service:"msgLog",response:[{type:"PropertyArray",name:"datas",reflectMapper:Ic.clearMsgsParamsWithSync}]},nimFtsCloudMsgLogsAggWithSession:{sid:7,cid:26,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:jl.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ic.msg}]},nimFtsCloudMsgLogs:{sid:7,cid:27,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:jl.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ic.msg}]}};(function(a){a[a.p2p=1]="p2p",a[a.team=2]="team"})(Hg||(Hg={}));var UU={type:{type:"enum",values:Hg},isDeleteRoam:{type:"boolean"},isSyncSelf:{type:"boolean"},time:{type:"number"}};function $g(a){var p=Yt(UU,a);return{sessionId:p.type==="p2p"?"p2p-"+p.otherAccid:"team-"+p.toTid,time:p.time}}var FU={orderRule:{type:"enum",values:Qd}};function BU(a){var p,l=Yt(FU,a);qt(l.msgTypeList)&&(l.msgTypeList=se(p=l.msgTypeList).call(p,function(e){return uo[e]}).join(","));var t=["p2pSessionList","teamSessionList","senderList","msgSubTypeList"];return ae(t).call(t,function(e){qt(l[e])&&(l[e]=l[e].join(","))}),l}var qU=function(a){function p(t){var e;return(e=a.call(this,"msgLog",t)||this).onV2ClearHistoryMessage=function(r){var i=$g(r);e.core.eventBus.emit("session/updateForClearMsg",[i],!0)},Kt({cmdMap:VU,cmdConfig:DU}),e.registerListener(),e}bt(p,a);var l=p.prototype;return l.registerListener=function(){this.core.eventBus.on("forwardReceive/msgLog/clearHistoryMsgsFromServer",this.onV2ClearHistoryMessage)},l.deleteRoamingMsgs=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:P({ids:{type:"array",itemType:"string"}},e),i=[],h.prev=2,i=se(o=e.ids).call(o,function(g){var v=Wn(g);return v.scene+"|"+v.accid}),h.next=10;break;case 6:throw h.prev=6,h.t0=h.catch(2),this.logger.error("Failed to delete roaming msgs with "+e.ids,h.t0),new Error("Failed to create session with "+e.ids);case 10:return h.next=12,this.core.sendCmd("deleteRoamingMsgs",{ids:i});case 12:case"end":return h.stop()}},r,this,[[2,6]])}))},l.getHistoryMsgs=function(e){var r,i;return k(this,void 0,void 0,T.mark(function o(){var u,h,g,v,_,I,C;return T.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return typeof((r=this.core.sync)===null||r===void 0?void 0:r.getSyncDoneFlag)!="function"||this.core.sync.getSyncDoneFlag()||this.logger.warn("Please call getHistoryMsgs after syncdone event"),P({scene:{type:"enum",values:Qt(Qr)},to:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},lastMsgId:{type:"string",required:!1,allowEmpty:!1},asc:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},e),h=e.scene==="p2p"?"getHistoryMsgs":e.scene==="team"?"getHistoryTeamMsgs":"getHistorySuperTeamMsgs",N.next=5,this.core.sendCmd(h,ao({beginTime:0,endTime:0,lastMsgId:0,limit:100,reverse:!1},O(O({},e),{msgTypes:e.msgTypes?se(u=e.msgTypes).call(u,function(F){return uo[F]}):[]})));case 5:if(g=N.sent,(v=g.content).msgs&&v.msgs.length>0){N.next=9;break}return N.abrupt("return",[]);case 9:if(_=_o(v.msgs[0],this.core.account),I=(i=this.core.session)===null||i===void 0?void 0:i.getSessionWithUncomplete({id:_}),C=Fg(v.msgs,I?{account:this.core.account,sessionAck:I.ack,msgReceiptTime:I.msgReceiptTime}:{account:this.core.account}),e.asc!==!0){N.next=14;break}return N.abrupt("return",Tr(C).call(C,function(F,j){return F.time-j.time}));case 14:return N.abrupt("return",C);case 15:case"end":return N.stop()}},o,this)}))},l.clearHistoryMsgsFromServer=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({scene:{type:"enum",values:["p2p","team"]},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},isSyncSelf:{type:"boolean",required:!1}},e),(i=O(O({isDeleteRoam:1},e),{type:e.scene==="team"?2:1,isSyncSelf:e.isSyncSelf===!0?1:0}))[i.type===2?"toTid":"otherAccid"]=e.to,g.next=5,this.core.sendCmd("clearHistoryMsgsFromServer",{clearHistoryMsgsFromServerReqTag:i});case 5:return o=g.sent,u=o.content,this.core.eventBus.emit("session/updateForClearMsg",[{sessionId:e.scene+"-"+e.to}],!0),this.core.eventBus.emit("forwardSend/msgLog/clearHistoryMsgsFromServer",O(O({},i),{time:u.timetag})),g.abrupt("return",u);case 10:case"end":return g.stop()}},r,this)}))},l.multiSyncClearServerHistoryMsgsHandler=function(e){var r=$g(e.content.data);this.core.eventBus.emit("session/updateForClearMsg",[r],!0),this.core.emit("clearServerHistoryMsgs",[r])},l.ftsCloudMsgLogs=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogs"));case 1:case"end":return o.stop()}},r,this)}))},l.ftsCloudMsgLogsAggWithSession=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogsAggWithSession"));case 1:case"end":return o.stop()}},r,this)}))},l.baseFtsCloudMsgLogs=function(e,r){return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(P({keyword:{type:"string",allowEmpty:!1},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",required:!1},msglogsLimit:{type:"number",required:!1},orderRule:{type:"enum",values:Qt(Qd),required:!1},p2pSessionList:{type:"array",itemType:"string",required:!1},teamSessionList:{type:"array",itemType:"string",required:!1},senderList:{type:"array",itemType:"string",required:!1},msgTypeList:{type:"array",itemType:"enum",values:Qt(uo),required:!1},msgSubTypeList:{type:"array",itemType:"number",required:!1}},e),!(e.fromTime&&e.toTime&&e.toTime<e.fromTime)){_.next=3;break}throw new _s("Request parameter error: toTime should be greater than fromTime",e,"");case 3:return u=BU(e),_.next=6,this.core.sendCmd(r,{tag:u});case 6:return h=_.sent,_.abrupt("return",se(o=h.content.datas).call(o,function(I){var C,A=_o(I,g.core.account),N=(C=g.core.session)===null||C===void 0?void 0:C.getSessionWithUncomplete({id:A});return ei(I,N?{account:g.core.account,sessionAck:N.ack,msgReceiptTime:N.msgReceiptTime}:{account:g.core.account})}));case 8:case"end":return _.stop()}},i,this)}))},l.syncClearServerHistoryMsgsHandler=function(e){var r=function(o){return qt(o)&&o.length>0?se(o).call(o,function(u){return $g(u)}):[]}(e.content.datas);this.core.emit("clearServerHistoryMsgs",r)},p}(Vn),GU={"22_1":"requestProxy","22_2":"onRequestProxy"},aC={requestProxyTag:{zone:1,path:2,method:3,header:4,body:5},requestProxyMsgTag:{from:1,body:2,time:3}},cC=rn(aC),jU={requestProxy:{sid:22,cid:1,service:"passThrough",params:[{type:"Property",name:"requestProxyTag",reflectMapper:aC.requestProxyTag}],response:[{type:"Property",name:"requestProxyTag",reflectMapper:cC.requestProxyTag}]},onRequestProxy:{sid:22,cid:2,service:"passThrough",response:[{type:"Property",name:"proxyMsg",reflectMapper:cC.requestProxyMsgTag}]}},HU=function(a){function p(t){var e;return(e=a.call(this,"passThrough",t)||this).core=t,Kt({cmdMap:GU,cmdConfig:jU}),e}bt(p,a);var l=p.prototype;return l.request=function(e){return P({path:{type:"string",allowEmpty:!1}},e),this.core.sendCmd("requestProxy",{requestProxyTag:e}).then(function(r){return r.content.requestProxyTag})},l.onRequestProxyHandler=function(e){var r=e.content.proxyMsg;r&&r.time&&(r.time=+r.time),this.core.emit("proxyMsg",r)},p}(Vn),$U=Mt({none:0,normal:1,all:3}),KU=Mt({normal:0,advanced:1}),YU=Mt({normal:0,owner:1,manager:2}),lC={noVerify:0,needVerify:1,rejectAll:2},WU=Mt(lC),uC={needVerify:0,noVerify:1},JU=Mt(uC),dC={manager:0,all:1},QU=Mt(dC),pC={manager:0,all:1},zU=Mt(pC),hC={manager:0,all:1},XU=Mt(hC);function Hl(a){var p,l=["teamId"],t=["level","memberNum","memberUpdateTime","createTime","updateTime"],e=["valid","validToCurrentUser","mute"],r={type:KU,muteType:$U,joinMode:WU,beInviteMode:JU,inviteMode:QU,updateTeamMode:zU,updateExtMode:XU};a.bits;var i=br(a,["bits"]);return ae(l).call(l,function(o){i[o]&&(i[o]=i[o].toString())}),ae(t).call(t,function(o){i[o]!==void 0&&(i[o]=it(i[o]))}),ae(e).call(e,function(o){i[o]!==void 0&&(i[o]=it(i[o])===1)}),ae(p=pt(r)).call(p,function(o){i[o]!==void 0&&(i[o]=r[o][i[o]]||i[o])}),i}function fC(a){return a&&a.length>0?se(a).call(a,function(p){return Hl(p)}):[]}function ZU(a){var p,l=O({},a),t=["avatar","name","intro","announcement","ext"],e={joinMode:lC,beInviteMode:uC,inviteMode:dC,updateTeamMode:pC,updateExtMode:hC};return ae(t).call(t,function(r){l[r]!==void 0&&(l[r]=l[r].toString())}),ae(p=pt(e)).call(p,function(r){l[r]!==void 0&&(l[r]=e[r][l[r]])}),l}function mC(a){var p=["teamId","ext","account","nickInTeam"],l={};return a.bitConfigMask!==void 0&&(l.bits=it(a.bitConfigMask)),ae(p).call(p,function(t){a[t]&&(l[t]=a[t].toString())}),Object.prototype.hasOwnProperty.call(a,"nickInTeam")&&(l.nickInTeam=a.nickInTeam),l}function Sc(a){var p,l=["teamId"],t=["joinTime","updateTime","bitConfigMask"],e=["active","valid","mute"],r={type:YU},i=a.bits,o=br(a,["bits"]);return i!==void 0&&(o.muteTeam=it(i)===1,o.bitConfigMask=i),o.id=o.teamId+"-"+o.account,ae(l).call(l,function(u){o[u]&&(o[u]=o[u].toString())}),ae(t).call(t,function(u){o[u]!==void 0&&(o[u]=it(o[u]))}),ae(e).call(e,function(u){o[u]!==void 0&&(o[u]=it(o[u])===1)}),ae(p=pt(r)).call(p,function(u){o[u]!==void 0&&(o[u]=r[u][o[u]]||o[u])}),o}function Kg(a){return a&&a.length>0?se(a).call(a,function(p){return Sc(p)}):[]}function gC(a,p,l){return l===void 0&&(l="normal"),{id:a.teamId+"-"+p,teamId:a.teamId,account:p,type:l,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:a.memberUpdateTime,updateTime:a.memberUpdateTime,active:!0,valid:!0}}function e3(a,p,l){return l===void 0&&(l="normal"),p&&p.length>0?se(p).call(p,function(t){return gC(a,t,l)}):[]}var t3=function(){function a(l){this.core=l}var p=a.prototype;return p.notifyAddSuperTeamMembers=function(t,e){this.core.emit("addSuperTeamMembers",{team:t,accounts:e,members:e3(t,e)})},p.notifyUpdateSuperTeamManagers=function(t,e,r,i){this.core.emit("updateSuperTeamManagers",{team:{teamId:t,memberUpdateTime:i},accounts:e,isManager:r,members:se(e).call(e,function(o){return{id:t+"-"+o,type:r?"manager":"normal",account:o,updateTime:i}})})},p.notifyRemoveSuperTeamMembers=function(t,e){this.core.emit("removeSuperTeamMembers",{team:t,accounts:e})},p.notifyTransferSuperTeam=function(t,e,r){this.core.emit("transferSuperTeam",{team:t,from:{id:t.teamId+"-"+e,account:e,type:"normal",updateTime:t.memberUpdateTime},to:{id:t.teamId+"-"+r,account:r,type:"owner",updateTime:t.memberUpdateTime}})},p.notifyUpdateSuperTeamMembersMute=function(t,e,r){this.core.emit("updateSuperTeamMembersMute",{team:t,accounts:e,members:se(e).call(e,function(i){return{id:t.teamId+"-"+i,account:i,teamId:t.teamId,mute:r,updateTime:t.memberUpdateTime}}),mute:r})},a}(),r3={"21_5":"addSuperTeamMembers","21_6":"removeSuperTeamMembers","21_7":"leaveSuperTeam","21_8":"updateSuperTeamInfo","21_9":"getSuperTeamInfo","21_12":"getSuperTeams","21_15":"getSuperTeamMembers","21_10":"updateMySuperTeamMemberInfo","21_20":"applySuperTeam","21_21":"passSuperTeamApply","21_22":"rejectSuperTeamApply","21_23":"acceptSuperTeamInvite","21_24":"rejectSuperTeamInvite","21_26":"addSuperTeamManagers","21_27":"removeSuperTeamManagers","21_28":"muteSuperTeam","21_29":"muteSuperTeamMembers","21_30":"updateSuperTeamMemberNick","21_31":"transferSuperTeam","21_33":"getSuperTeamMembersByAccounts","21_34":"queryMuteSuperTeamMembers","21_101":"syncCreateSuperTeam","21_109":"syncSuperTeams","21_110":"syncUpdateSuperTeamMember","21_111":"syncMySuperTeamMembers"},Ec={superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,updateTime:11,ext:12,mute:13,invitorAccid:14,joinTime:15}},rs=rn(Ec),n3={getSuperTeamInfo:{sid:21,cid:9,service:"superTeam",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"superTeam",reflectMapper:rs.superTeam}]},getSuperTeams:{sid:21,cid:12,service:"superTeam",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"superTeams",reflectMapper:rs.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},updateSuperTeamInfo:{sid:21,cid:8,service:"superTeam",params:[{type:"Property",name:"superTeam",reflectMapper:Ec.superTeam}],response:[{type:"Long",name:"time"}]},addSuperTeamMembers:{sid:21,cid:5,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},removeSuperTeamMembers:{sid:21,cid:6,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},addSuperTeamManagers:{sid:21,cid:26,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:21,cid:27,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applySuperTeam:{sid:21,cid:20,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"superTeam",reflectMapper:rs.superTeam}]},transferSuperTeam:{sid:21,cid:31,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},muteSuperTeam:{sid:21,cid:28,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},muteSuperTeamMembers:{sid:21,cid:29,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"Int",name:"mute"}]},updateSuperTeamMemberNick:{sid:21,cid:30,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:Ec.superTeamMember}]},updateMySuperTeamMemberInfo:{sid:21,cid:10,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:Ec.superTeamMember}]},getSuperTeamMembersByAccounts:{sid:21,cid:33,service:"superTeam",params:[{type:"StrArray",name:"memberIds"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:rs.superTeamMember}]},getSuperTeamMembers:{sid:21,cid:15,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:rs.superTeamMember}]},queryMuteSuperTeamMembers:{sid:21,cid:34,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:rs.superTeamMember}]},leaveSuperTeam:{sid:21,cid:7,service:"superTeam",params:[{type:"Long",name:"teamId"}]},passSuperTeamApply:{sid:21,cid:21,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:21,cid:22,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:21,cid:23,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:21,cid:24,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncSuperTeams:{sid:21,cid:109,service:"superTeam",response:[{type:"PropertyArray",name:"teams",reflectMapper:rs.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},syncCreateSuperTeam:{sid:21,cid:101,service:"superTeam",response:[{type:"Property",name:"superTeam",reflectMapper:rs.superTeam}]},syncUpdateSuperTeamMember:{sid:21,cid:110,service:"superTeam",response:[{type:"Property",name:"teamMember",reflectMapper:rs.superTeamMember}]},syncMySuperTeamMembers:{sid:21,cid:111,ext:"sync",service:"superTeam",response:[{type:"PropertyArray",name:"teamMembers",reflectMapper:rs.superTeamMember},{type:"Long",name:"timetag"}]}},i3=function(a){function p(t){var e;return(e=a.call(this,"superTeam",t)||this).mySuperTeamMembersMap=new Dr,e.service=new t3(t),Kt({cmdMap:r3,cmdConfig:n3}),e.setListeners(),e}bt(p,a);var l=p.prototype;return l.setListeners=function(){var e=this;this.core.eventBus.on("forwardReceive/superTeam/updateMyMemberInfo",function(r){e.emitMemberUpdate(r)}),this.core.eventBus.on("team/onNotification",function(r){return e.notificationHandler(r)})},l.reset=function(){this.mySuperTeamMembersMap.clear()},l.mergeMySuperTeamMembers=function(e){var r=this;ae(e).call(e,function(i){var o=i.teamId,u=r.mySuperTeamMembersMap.get(o),h=O({},u,i);r.mySuperTeamMembersMap.set(o,h)})},l.getSuperTeamInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),h.next=3,this.core.sendCmd("getSuperTeamInfo",{teamId:e.teamId});case 3:return i=h.sent,o=i.content.superTeam,h.abrupt("return",Hl(o));case 6:case"end":return h.stop()}},r,this)}))},l.getSuperTeams=function(){return k(this,void 0,void 0,T.mark(function e(){var r,i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.core.sendCmd("getSuperTeams",{timetag:0});case 2:return r=u.sent,i=r.content.superTeams,u.abrupt("return",fC(i));case 5:case"end":return u.stop()}},e,this)}))},l.updateSuperTeamInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),i=ZU(e),u.next=4,this.core.sendCmd("updateSuperTeamInfo",{superTeam:i});case 4:return u.abrupt("return",Hl(i));case 5:case"end":return u.stop()}},r,this)}))},l.addSuperTeamMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),o.next=3,this.core.sendCmd("addSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""});case 3:case"end":return o.stop()}},r,this)}))},l.removeSuperTeamMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),o.next=3,this.core.sendCmd("removeSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts});case 3:case"end":return o.stop()}},r,this)}))},l.addSuperTeamManagers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),o.next=3,this.core.sendCmd("addSuperTeamManagers",e);case 3:case"end":return o.stop()}},r,this)}))},l.removeSuperTeamManagers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),o.next=3,this.core.sendCmd("removeSuperTeamManagers",e);case 3:case"end":return o.stop()}},r,this)}))},l.applySuperTeam=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),u.next=3,this.core.sendCmd("applySuperTeam",{teamId:e.teamId,ps:e.ps||""});case 3:return i=u.sent,u.abrupt("return",Hl(i.content.superTeam));case 5:case"end":return u.stop()}},r,this)}))},l.transferSuperTeam=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),o.next=3,this.core.sendCmd("transferSuperTeam",e);case 3:case"end":return o.stop()}},r,this)}))},l.muteSuperTeam=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),o.next=3,this.core.sendCmd("muteSuperTeam",{teamId:e.teamId,mute:e.mute?1:0});case 3:case"end":return o.stop()}},r,this)}))},l.muteSuperTeamMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string"},mute:{type:"boolean"}},e),o.next=3,this.core.sendCmd("muteSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,mute:e.mute?1:0});case 3:case"end":return o.stop()}},r,this)}))},l.updateMemberNick=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},e),i=mC({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account}),h.next=4,this.core.sendCmd("updateSuperTeamMemberNick",{teamMember:i});case 4:return o=Sc(O({updateTime:new Date().getTime()},i)),h.abrupt("return",o);case 6:case"end":return h.stop()}},r,this)}))},l.updateMyMemberInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e),i=mC({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext}),g.next=4,this.core.sendCmd("updateMySuperTeamMemberInfo",{teamMember:i});case 4:return o=Sc(O({updateTime:new Date().getTime(),account:this.core.account},i)),u=this.emitMemberUpdate(o),this.core.eventBus.emit("forwardSend/superTeam/updateMyMemberInfo",u),g.abrupt("return",o);case 8:case"end":return g.stop()}},r,this)}))},l.getSuperTeamMembersByAccounts=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:20,min:1}},e),u=se(o=e.accounts).call(o,function(_){return e.teamId+"|"+_}),v.next=4,this.core.sendCmd("getSuperTeamMembersByAccounts",{memberIds:u});case 4:return h=v.sent,v.abrupt("return",Kg((r=h.content)===null||r===void 0?void 0:r.superTeamMembers));case 6:case"end":return v.stop()}},i,this)}))},l.getSuperTeamMembers=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,max:1e3,required:!1},reverse:{type:"boolean",required:!1}},e),h.next=3,this.core.sendCmd("getSuperTeamMembers",O({joinTime:0,limit:100,reverse:!1},e));case 3:return o=h.sent,h.abrupt("return",Kg((r=o.content)===null||r===void 0?void 0:r.superTeamMembers));case 5:case"end":return h.stop()}},i,this)}))},l.queryMuteMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),h.next=3,this.core.sendCmd("queryMuteSuperTeamMembers",O({limit:100,joinTime:0,reverse:!1},e));case 3:return i=h.sent,o=i.content,h.abrupt("return",Kg(o.superTeamMembers));case 6:case"end":return h.stop()}},r,this)}))},l.leaveSuperTeam=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),o.next=3,this.core.sendCmd("leaveSuperTeam",{teamId:e.teamId});case 3:case"end":return o.stop()}},r,this)}))},l.passSuperTeamApply=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),u.prev=1,u.next=4,this.core.sendCmd("passSuperTeamApply",e);case 4:this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",e),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),i=u.t0,this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",e,i==null?void 0:i.code),u.t0;case 12:case"end":return u.stop()}},r,this,[[1,7]])}))},l.rejectSuperTeamApply=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),u.prev=1,u.next=4,this.core.sendCmd("rejectSuperTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",e),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),i=u.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",e,i==null?void 0:i.code),u.t0;case 12:case"end":return u.stop()}},r,this,[[1,7]])}))},l.acceptSuperTeamInvite=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),u.prev=1,u.next=4,this.core.sendCmd("acceptSuperTeamInvite",e);case 4:this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",e),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),i=u.t0,this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",e,i==null?void 0:i.code),u.t0;case 12:case"end":return u.stop()}},r,this,[[1,7]])}))},l.rejectSuperTeamInvite=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),u.prev=1,u.next=4,this.core.sendCmd("rejectSuperTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",e),u.next=12;break;case 7:throw u.prev=7,u.t0=u.catch(1),i=u.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",e,i==null?void 0:i.code),u.t0;case 12:case"end":return u.stop()}},r,this,[[1,7]])}))},l.emitMemberUpdate=function(e){e=Sc(e),this.mergeMyTeamMembers([e]),this.core.emit("updateTeamMember",e);var r=En(this.mySuperTeamMembersMap.get(e.teamId));return this.core.emit("myTeamMembers",[r]),r},l.mergeMyTeamMembers=function(e){var r=this;ae(e).call(e,function(i){var o=i.teamId,u=r.mySuperTeamMembersMap.get(o),h=O({},u,i);r.mySuperTeamMembersMap.set(o,h)})},l.syncSuperTeamsHandler=function(e){var r=e.content;this.core.eventBus.emit("sync/updateTimetag",{superTeams:it(r.timetag)});var i=r==null?void 0:r.teams;if(i&&i.length){var o=fC(i);this.core.emit("superTeams",o)}},l.syncCreateSuperTeamHandler=function(e){var r=e.content,i=Hl(r==null?void 0:r.superTeam),o=gC(i,i.owner,"owner");this.core.emit("createSuperTeam",i,o)},l.syncUpdateSuperTeamMemberHandler=function(e){var r=e.content,i=Sc(r==null?void 0:r.teamMember);i.updateTime||(i.updateTime=new Date().getTime()),this.mergeMySuperTeamMembers([i]),this.core.emit("updateSuperTeamMember",i);var o=En(this.mySuperTeamMembersMap.get(i.teamId));this.core.emit("mySuperTeamMembers",[o])},l.syncMySuperTeamMembersHandler=function(e){var r,i=e.content;this.core.eventBus.emit("sync/updateTimetag",{mySuperTeamMembers:it(i.timetag)});var o=i==null?void 0:se(r=i.teamMembers).call(r,function(u){return Sc(u)});this.mergeMySuperTeamMembers(o),this.core.emit("mySuperTeamMembers",En(o))},l.notificationHandler=function(e){var r=e.attach,i=e.scene,o=e.from,u=e.to,h=e.time,g=e.idServer,v=e.idClient,_=r.team,I=r.account,C=r.accounts,A=r.type;if(i==="superTeam")switch(this.logger.getDebugMode()?this.logger.debug("superTeam::recvNotification",g,v,r):this.logger.log("superTeam::recvNotification",g,v,u,A,I,C),A){case"updateSuperTeam":_.updateTime=h,this.core.emit("updateSuperTeam",_);break;case"addSuperTeamMembers":this.service.notifyAddSuperTeamMembers(_,C);break;case"acceptSuperTeamInvite":this.service.notifyAddSuperTeamMembers(_,[o]);break;case"passSuperTeamApply":this.service.notifyAddSuperTeamMembers(_,[I]);break;case"addSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(u,C,!0,h);break;case"removeSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(u,C,!1,h);break;case"removeSuperTeamMembers":this.service.notifyRemoveSuperTeamMembers(_,C);break;case"leaveSuperTeam":this.service.notifyRemoveSuperTeamMembers(_,[o]);break;case"dismissSuperTeam":this.core.emit("dismissSuperTeam",{teamId:u});break;case"transferSuperTeam":this.service.notifyTransferSuperTeam(_,o,I);break;case"updateSuperTeamMembersMute":this.service.notifyUpdateSuperTeamMembersMute(_,C,r.mute)}},p}(Vn),s3={"13_1":"getChatroomAddress","24_1":"getQChatAddress"},o3={getChatroomAddress:{sid:13,cid:1,service:"plugin",params:[{type:"Long",name:"chatroomId"},{type:"Bool",name:"isWeixinApp"},{type:"Int",name:"ipType"}],response:[{type:"StrArray",name:"address"}]},getQChatAddress:{sid:24,cid:1,service:"plugin",params:[{type:"Property",name:"getQChatAddressTag",reflectMapper:{ipType:1}}],response:[{type:"StrArray",name:"address"}]}},a3=function(a){function p(t){var e;return(e=a.call(this,"plugin",t)||this).core=t,Kt({cmdMap:s3,cmdConfig:o3}),e}bt(p,a);var l=p.prototype;return l.getChatroomAddress=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({chatroomId:{type:"string",allowEmpty:!1},ipType:{type:"number",required:!1}},e),u.next=3,this.core.sendCmd("getChatroomAddress",{chatroomId:e.chatroomId,isWeixinApp:We.platform==="WXAPP",ipType:e.ipType||0});case 3:return i=u.sent,u.abrupt("return",i.content.address);case 5:case"end":return u.stop()}},r,this)}))},l.getQChatAddress=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({ipType:{type:"number",required:!1}},e),u.next=3,this.core.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:(e==null?void 0:e.ipType)||0}});case 3:return i=u.sent,u.abrupt("return",i.content.address);case 5:case"end":return u.stop()}},r,this)}))},p}(Vn),c3={"7_19":"nimQueryCloudSessionList","7_20":"nimQueryCloudSession","7_21":"nimUpdateCloudSession","7_22":"nimDeleteCloudSessionList","7_121":"nimMultiSyncUpdateCloudSession"},$l={sessionReqTag:{minTimestamp:1,maxTimestamp:2,includedLastMsg:3,limit:4,hasMore:5},sessionTag:{sessionId:1,updateTime:2,ext:3,lastMsg:4,lastMsgType:5}},Zd=rn($l),l3={nimQueryCloudSessionList:{sid:7,cid:19,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:$l.sessionReqTag}],response:[{type:"Property",name:"tag",reflectMapper:Zd.sessionReqTag},{type:"PropertyArray",name:"sessions",reflectMapper:Zd.sessionTag}]},nimQueryCloudSession:{sid:7,cid:20,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:$l.sessionTag}],response:[{type:"Property",name:"session",reflectMapper:Zd.sessionTag}]},nimUpdateCloudSession:{sid:7,cid:21,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:$l.sessionTag}]},nimDeleteCloudSessionList:{sid:7,cid:22,service:"cloudSession",params:[{type:"PropertyArray",name:"tags",reflectMapper:$l.sessionTag}]},nimMultiSyncUpdateCloudSession:{sid:7,cid:121,service:"cloudSession",response:[{type:"Property",name:"session",reflectMapper:Zd.sessionTag}]}},u3={sessionId:{type:"string"},updateTime:{type:"number"},ext:{type:"string"},lastMsg:{type:"object"},lastMsgType:{type:"number"}};function Yg(a,p,l){var t=Yt(u3,a),e=Wn(t.sessionId,"|"),r=e.accid,i=e.scene;if(t.sessionId=i+"-"+r,t.lastMsg){var o=t.lastMsgType===1;t.lastMsgInfo=o?{isLastMsgRecalled:o,revokedMsg:Fl(xt(t.lastMsg,ql.sysMsg),l)}:{isLastMsgRecalled:o,lastMsg:ei(xt(t.lastMsg,sn.msg),{account:p})}}return delete t.lastMsg,delete t.lastMsgType,t}function d3(a,p,l){return a&&a.length>0?se(a).call(a,function(t){return Yg(t,p,l)}):[]}var p3=function(a){function p(t){var e;return e=a.call(this,"cloudSession",t)||this,Kt({cmdMap:c3,cmdConfig:l3}),e}bt(p,a);var l=p.prototype;return l.queryCloudSessionList=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return P({minTimestamp:{type:"number",min:0,required:!1},maxTimestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},includedLastMsg:{type:"boolean",required:!1}},e),(o=O({limit:100,includedLastMsg:!0},e)).includedLastMsg=wd.boolean(e,"includedLastMsg"),_.next=5,this.core.sendCmd("nimQueryCloudSessionList",{tag:o});case 5:return u=_.sent,h=((r=u.content)===null||r===void 0?void 0:r.tag)||{},g=u.content.sessions,_.abrupt("return",{hasMore:+h.hasMore>0,sessionList:d3(g,this.core.account,this.logger)});case 9:case"end":return _.stop()}},i,this)}))},l.queryCloudSession=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({sessionId:{type:"string",allowEmpty:!1}},e),i=Wn(e.sessionId,"-"),o=i.accid,u=i.scene,v.next=4,this.core.sendCmd("nimQueryCloudSession",{tag:{sessionId:u==="superTeam"?"super_team|"+o:u+"|"+o}});case 4:return h=v.sent,v.abrupt("return",Yg(h.content.session,this.core.account,this.logger));case 6:case"end":return v.stop()}},r,this)}))},l.updateCloudSession=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({sessionId:{type:"string",allowEmpty:!1},ext:{type:"string",allowEmpty:!1,required:!1}},e),i=Wn(e.sessionId,"-"),o=i.accid,u=i.scene,g.next=4,this.core.sendCmd("nimUpdateCloudSession",{tag:{sessionId:u==="superTeam"?"super_team|"+o:u+"|"+o,ext:e.ext}});case 4:case"end":return g.stop()}},r,this)}))},l.deleteCloudSessionList=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({sessionIdList:{type:"array",itemType:"string"}},e),o=se(i=e.sessionIdList).call(i,function(g){var v=Wn(g,"-"),_=v.accid,I=v.scene;return{sessionId:I==="superTeam"?"super_team|"+_:I+"|"+_}}),h.next=4,this.core.sendCmd("nimDeleteCloudSessionList",{tags:o});case 4:case"end":return h.stop()}},r,this)}))},l.nimMultiSyncUpdateCloudSessionHandler=function(e){var r=Yg(e.content.session,this.core.account,this.logger);this.core.emit("multiSyncUpdateCloudSession",r)},p}(Vn),Wg={needPush:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needPushBadge:{type:"boolean",required:!1}},h3={"15_1":"signalingCreate","15_2":"signalingDelay","15_3":"signalingClose","15_4":"signalingJoin","15_5":"signalingLeave","15_6":"signalingInvite","15_7":"signalingCancelInvite","15_8":"signalingReject","15_9":"signalingAccept","15_10":"signalingSendCustomCommand","15_11":"signalingRecvNotification","15_12":"signalingMultiSyncNotification","15_13":"signalingSyncNotification","15_14":"singalingSyncChannels","15_15":"signalingQueryInfo","15_16":"signalingCallEx","15_17":"signalingJoinAndAccept"},Qn={avSignalTag:O({type:1,name:2,channelId:3,createTime:4,expireTime:5,creatorAccid:6,ext:7,invalid:8,fromAccid:10,toAccid:11,requestId:12,members:18,attach:19,attachExt:20,needOffline:21,msgId:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},{needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needPushBadge:17})},Li=rn(Qn),f3={signalingCreate:{sid:15,cid:1,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Li.avSignalTag}]},signalingDelay:{sid:15,cid:2,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Li.avSignalTag}]},signalingClose:{sid:15,cid:3,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Li.avSignalTag}]},signalingJoin:{sid:15,cid:4,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Li.avSignalTag}]},signalingLeave:{sid:15,cid:5,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}]},signalingInvite:{sid:15,cid:6,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}]},signalingCancelInvite:{sid:15,cid:7,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}]},signalingReject:{sid:15,cid:8,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}]},signalingAccept:{sid:15,cid:9,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}]},signalingSendCustomCommand:{sid:15,cid:10,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}]},signalingRecvNotification:{sid:15,cid:11,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:Li.avSignalTag}]},signalingMultiSyncNotification:{sid:15,cid:12,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:Li.avSignalTag}]},signalingSyncNotification:{sid:15,cid:13,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:Li.avSignalTag}]},singalingSyncChannels:{sid:15,cid:14,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:Li.avSignalTag}]},signalingQueryInfo:{sid:15,cid:15,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Li.avSignalTag}]},signalingCallEx:{sid:15,cid:16,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Li.avSignalTag}]},signalingJoinAndAccept:{sid:15,cid:17,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:Qn.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:Li.avSignalTag}]},signalingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:"signaling",params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},Kl={type:{type:"number"},createTime:{type:"number"},expireTime:{type:"number"},invalid:{type:"boolean"},pushInfo:Wg,pluginSetting:{nertcInfo:{nertcChannelName:{type:"string"},nertcTokenTtl:{type:"number"},nertcToken:{type:"string"},nertcJoinRoomQueryParamMap:{type:"string"},callStatus:{type:"number"}}},callStatus:{type:"number"},attach:{type:"object"},members:{type:"object"},needOffline:{type:"boolean"},uid:{type:"number"},time:{type:"number"}};function vC(a){return Yt(Kl,xt(a,{1:"accid",2:"uid",3:"createTime",4:"expireTime"}))}function Yl(a){var p,l=Yt(Kl,a),t=[];return l.members&&l.members.length>0&&(t=se(p=l.members).call(p,function(e){return vC(e)}),delete l.members),t.length>0?{channelInfo:l,memberList:t}:{channelInfo:l}}function yC(a){var p,l=Yt(Kl,a),t=[];l.members&&l.members.length>0&&(t=se(p=l.members).call(p,function(r){return vC(r)}),delete l.members);var e=200;return a.callStatus&&(e=Number(a.callStatus)),t.length>0?{channelInfo:l,memberList:t,callStatus:e}:{channelInfo:l,callStatus:e}}function Vi(a){return Is(Kl,a)}var ep,Ir,gi,Ma,So,tp,rp,m3=function(a){function p(t){var e;return(e=a.call(this)||this).timer=0,e.pollingInterval=12e4,e.name="signaling",e.logger=t.logger,e.core=t,e.channels={},Kt({cmdMap:h3,cmdConfig:f3}),e}bt(p,a);var l=p.prototype;return l.callEx=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return P({type:{type:"number"},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:Wg},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},e),_.next=3,this.core.sendCmd("signalingCallEx",{tag:Vi(e)});case 3:return o=_.sent,u=((r=o.content)===null||r===void 0?void 0:r.data)||{},h=yC(u),this.channels[h.channelInfo.channelId]=En(h.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(et(g=this.aotoDelay).call(g,this),this.pollingInterval,-1)),_.abrupt("return",h);case 9:case"end":return _.stop()}},i,this)}))},l.joinAndAccept=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return P({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},uid:{type:"number",required:!1},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},e),o=e.fromAccid,(u=br(e,["fromAccid"])).toAccid=o,C.next=5,this.core.sendCmd("signalingJoinAndAccept",{tag:Vi(u)});case 5:return h=C.sent,g=((r=h.content)===null||r===void 0?void 0:r.data)||{},v=yC(g),this.channels[v.channelInfo.channelId]=En(v.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(et(_=this.aotoDelay).call(_,this),this.pollingInterval,-1)),C.abrupt("return",v);case 11:case"end":return C.stop()}},i,this)}))},l.create=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({type:{type:"number"},ext:{type:"string",required:!1}},e),g.next=3,this.core.sendCmd("signalingCreate",{tag:Vi(e)});case 3:return o=g.sent,u=((r=o.content)===null||r===void 0?void 0:r.data)||{},g.abrupt("return",Yl(u));case 6:case"end":return g.stop()}},i,this)}))},l.close=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),o.next=3,this.core.sendCmd("signalingClose",{tag:Vi(e)});case 3:case"end":return o.stop()}},r,this)}))},l.queryInfo=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({name:{type:"string",allowEmpty:!1}},e),g.next=3,this.core.sendCmd("signalingQueryInfo",{tag:e});case 3:return o=g.sent,u=((r=o.content)===null||r===void 0?void 0:r.data)||{},g.abrupt("return",Yl(u));case 6:case"end":return g.stop()}},i,this)}))},l.join=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return P({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},uid:{type:"number",min:0,required:!1},needOffline:{type:"boolean",required:!1}},e),_.next=3,this.core.sendCmd("signalingJoin",{tag:Vi(e)});case 3:return o=_.sent,u=((r=o.content)===null||r===void 0?void 0:r.data)||{},h=Yl(u),this.channels[h.channelInfo.channelId]=En(h.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(et(g=this.aotoDelay).call(g,this),this.pollingInterval,-1)),_.abrupt("return",h);case 9:case"end":return _.stop()}},i,this)}))},l.aotoDelay=function(){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if((r=pt(this.channels)).length!==0){v.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,v.abrupt("return");case 5:this.logger.log("signling:autoDelay",r),i=0;case 7:if(!(i<r.length)){v.next=24;break}return o=r[i],v.prev=9,v.next=12,this.core.sendCmd("signalingDelay",{tag:{channelId:o}});case 12:u=v.sent,h=Yl(u.content.data),this.channels[o]=h.channelInfo,v.next=21;break;case 17:v.prev=17,v.t0=v.catch(9),this.logger.warn("signling:autoDelay "+o+" failed",v.t0),delete this.channels[o];case 21:i++,v.next=7;break;case 24:case"end":return v.stop()}},e,this,[[9,17]])}))},l.leave=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),o.next=3,this.core.sendCmd("signalingLeave",{tag:Vi(e)});case 3:delete this.channels[e.channelId];case 4:case"end":return o.stop()}},r,this)}))},l.invite=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:Wg}},e),o.next=3,this.core.sendCmd("signalingInvite",{tag:Vi(e)});case 3:case"end":return o.stop()}},r,this)}))},l.cancelInvite=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),o.next=3,this.core.sendCmd("signalingCancelInvite",{tag:Vi(e)});case 3:case"end":return o.stop()}},r,this)}))},l.reject=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),i=e.fromAccid,(o=br(e,["fromAccid"])).toAccid=i,h.next=5,this.core.sendCmd("signalingReject",{tag:Vi(o)});case 5:case"end":return h.stop()}},r,this)}))},l.accept=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return P({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},autoJoin:{type:"boolean",required:!1},uid:{type:"number",min:0,required:!1},joinAttachExt:{type:"string",required:!1}},e),i=e.autoJoin,o=e.joinAttachExt,u=e.fromAccid,(h=br(e,["autoJoin","joinAttachExt","fromAccid"])).toAccid=u,_.next=5,this.core.sendCmd("signalingAccept",{tag:Vi(h)});case 5:if(this.logger.log("Signaling:accept, accept success, autoJoin "+e.autoJoin),!i){_.next=10;break}return g={channelId:e.channelId,needOffline:e.needOffline,attachExt:o,uid:e.uid},_.next=10,this.join(g);case 10:case"end":return _.stop()}},r,this)}))},l.sendCustomCommand=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},attachExt:{type:"string",required:!1}},e),o.next=3,this.core.sendCmd("signalingSendCustomCommand",{tag:Vi(e)});case 3:case"end":return o.stop()}},r,this)}))},l.signalingRecvNotificationHandler=function(e){var r=zi(e,e.content.data,"msgId","0"),i=r.msgId;this.doNotify(r),i&&it(i)&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:[i]})},l.signalingMultiSyncNotificationHandler=function(e){this.doNotify(e.content.data,3)},l.doNotify=function(e,r){r===void 0&&(r=0);var i=function(N,F){F===void 0&&(F=0);var j=Yt(Kl,N),W=j.attach,U=j.attachExt,ie=j.time,te=j.msgId;j.fromAccid,j.toAccid,j.members,j.requestId,j.pushInfo;var H=br(j,["attach","attachExt","time","msgId","fromAccid","toAccid","members","requestId","pushInfo"]);if(W.type===2)try{j.member={accid:j.attach.member[1],uid:Number(j.attach.member[2]),createTime:Number(j.attach.member[3]),expireTime:Number(j.attach.member[4])}}catch{delete j.member}var V=W.type;return delete j.attach,{metaData:{eventType:V,channelInfo:H,feature:F,ext:U||"",time:ie,msgId:te},rawData:j}}(e,r),o=i.metaData,u=i.rawData,h=u.fromAccid,g=u.toAccid,v=u.requestId,_=u.pushInfo,I=u.msgId,C=u.member;switch(o.eventType){case 1:this.emit("signalingClose",{fromAccid:h,metaData:o});break;case 2:this.emit("signalingJoin",{fromAccid:h,metaData:o,member:C});break;case 3:this.emit("signalingInvite",{fromAccid:h,toAccid:g,requestId:v,pushInfo:_,metaData:o});break;case 4:this.emit("signalingCancelInvite",{fromAccid:h,toAccid:g,requestId:v,metaData:o});break;case 5:this.emit("signalingReject",{fromAccid:h,toAccid:g,requestId:v,metaData:o});break;case 6:this.emit("signalingAccept",{fromAccid:h,toAccid:g,requestId:v,metaData:o});break;case 7:this.emit("signalingLeave",{fromAccid:h,metaData:o});break;case 8:this.emit("signalingCustomCommand",{fromAccid:h,metaData:o});break;default:this.logger.warn("signaling:notification, no such a type "+o.eventType,u)}return I},l.signalingSyncNotificationHandler=function(e){var r,i,o=this;if(e.content.datas&&e.content.datas.length>0){var u=at(r=se(i=e.content.datas).call(i,function(h){return o.doNotify(h,1)})).call(r,function(h){return h});u.length>0&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:u})}},l.singalingSyncChannelsHandler=function(e){var r,i=this;if(this.timer=0,this.channels={},e.content.datas&&e.content.datas.length>0){var o=se(r=e.content.datas).call(r,function(u){return Yl(u)});ae(o).call(o,function(u){var h=u.channelInfo.channelId;i.channels[h]=En(u.channelInfo)}),this.emit("singalingSyncChannels",o)}},l.process=function(e){var r=this[e.cmd+"Handler"];if(typeof r=="function")return r.call(this,e),He.resolve(e);var i=Pe(e,"error.detail.ignore");return e.error&&!i?He.reject(e.error):He.resolve(e)},p}(ia.EventEmitter),Wl=function(a){function p(t,e){var r;return(r=a.call(this)||this).name=t,r.core=e,r.name=t,r.logger=e.logger,r.core=e,r}bt(p,a);var l=p.prototype;return l.emit=function(e){var r=this;try{for(var i,o,u=arguments.length,h=new Array(u>1?u-1:0),g=1;g<u;g++)h[g-1]=arguments[g];var v=(i=a.prototype.emit).call.apply(i,dt(o=[this,e]).call(o,h));return v}catch(_){return or(function(){throw r.logger.error(r.name+"::emit throw error in setTimeout. event: "+e.toString()+". Error",_),_},0),!1}},l.process=function(e){var r=this[e.cmd+"Handler"];if(typeof r=="function")return r.call(this,e);var i=Pe(e,"error.detail.ignore");return e.error&&!i?He.reject(e.error):He.resolve(e)},p}(ia),g3={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage","24_95":"qchatChannelMemberSearch","25_8":"qchatGetRoleIdsByServerId","25_9":"qchatSubscribeAsVisitor","25_12":"qchatAutoSubscribe","25_13":"qchatAutoSubscribeNotification"},Jg={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},hr={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15,visitorMode:16},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:Jg,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12,visitorMode:16},serverRoles:{serverId:1,roleIds:2,timeTag:3},qchatChannelMemberSearchTag:{serverId:1,channelId:2,keyword:3,limit:4},qchatChannelMemberInfo:{serverId:1,channelId:2,avatar:3,accid:4,nick:5,createTime:6,updateTime:7}},Eo=function(){return rn(hr)},v3=function(){var p=Eo();return{qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:hr.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:hr.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:p.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:hr.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:hr.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:p.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:p.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:hr.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:hr.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:hr.qchatUpdateWhiteBlackRoleTag}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:hr.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:hr.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:hr.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:hr.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:p.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:hr.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:p.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:hr.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:p.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:hr.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:p.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:hr.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:p.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:p.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:hr.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:hr.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:hr.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:hr.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:hr.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:p.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:hr.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:p.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:hr.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:hr.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:hr.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:hr.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:p.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:p.qchatChannelIdInfoTag}]},qchatAutoSubscribe:{sid:25,cid:12,service:"qchatChannel",hasPacketTimer:!1,params:[{type:"Property",name:"qchatAutoSubReqTag"}],response:[{type:"Property",name:"qchatAutoSubInfo",reflectMapper:{1:"time"}}]},qchatAutoSubscribeNotification:{service:"qchatChannel",sid:25,cid:13,response:[{type:"PropertyArray",name:"serverIds",reflectMapper:p.unreadInfo},{type:"PropertyArray",name:"unreadInfos",reflectMapper:p.unreadInfo}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:hr.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:p.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:hr.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:p.channelInfo}]},qchatGetRoleIdsByServerId:{sid:25,cid:8,service:"qchatChannel",params:[{type:"Property",name:"qchatGetRoleIdsByServerIdTag",reflectMapper:{serverIdTimeTags:1}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:p.serverRoles},{type:"String",name:"failServerIds"}]},qchatChannelMemberSearch:{sid:24,cid:95,service:"qchatChannel",params:[{type:"Property",name:"qchatChannelMemberSearchTag",reflectMapper:hr.qchatChannelMemberSearchTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:p.qchatChannelMemberInfo}]},qchatSubscribeAsVisitor:{sid:25,cid:9,service:"qchatChannel",params:[{type:"Property",name:"tag",reflectMapper:hr.qchatSubReqTag},{type:"PropertyArray",name:"datas",reflectMapper:hr.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"failedArr",reflectMapper:p.qchatChannelIdInfoTag}]}}};(function(a){a[a.reorderWeight=0]="reorderWeight",a[a.createTime=1]="createTime"})(ep||(ep={})),function(a){a[a.white=1]="white",a[a.black=2]="black"}(Ir||(Ir={})),function(a){a[a.add=1]="add",a[a.remove=2]="remove"}(gi||(gi={})),function(a){a[a.message=0]="message",a[a.media=1]="media",a[a.ext=100]="ext"}(Ma||(Ma={})),function(a){a[a.ASC=1]="ASC",a[a.DESC=2]="DESC"}(So||(So={})),function(a){a[a.reorderWeight=0]="reorderWeight",a[a.createTime=1]="createTime",a[a.totalMember=2]="totalMember"}(tp||(tp={})),function(a){a[a.square=1]="square",a[a.person=2]="person"}(rp||(rp={}));var y3={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:Ma},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},visitorMode:{type:"number"},reorderWeight:{type:"string"}},_3={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},M3={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Ir},opeType:{type:"enum",values:gi},toAccids:{type:"object"}},T3={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Ir},opeType:{type:"enum",values:gi},roleId:{type:"string"}},I3={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}},S3={serverId:{type:"string"},channelId:{type:"string"},accid:{type:"string"},avatar:{type:"string"},nick:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function Qg(a){return Yt(T3,a)}function Jl(a){return Yt(y3,a)}function np(a){return qt(a)&&a.length>0?se(a).call(a,function(p){return Jl(p)}):[]}function zg(a){return Yt(_3,a)}function Ql(a){return qt(a)&&a.length>0?se(a).call(a,function(p){return zg(p)}):[]}function zl(a){return Yt(I3,a)}function _C(a){return qt(a)&&a.length>0?se(a).call(a,function(p){return zl(p)}):[]}function E3(a){return qt(a)&&a.length>0?se(a).call(a,function(p){return function(t){return Yt(S3,t)}(p)}):[]}function Xg(a){try{return JSON.parse(a)}catch{return[]}}var C3={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},categoryNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},b3={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},A3={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function ip(a){return Yt(C3,a)}function Zg(a){return qt(a)&&a.length>0?se(a).call(a,function(p){return ip(p)}):[]}function sp(a){return Yt(b3,a)}function Co(a){return qt(a)&&a.length>0?se(a).call(a,function(p){return sp(p)}):[]}function R3(a){return qt(a)&&a.length>0?se(a).call(a,function(p){return function(t){return Yt(A3,t)}(p)}):[]}function bo(a){var p,l,t;if(!a.antispamTag)return{};var e=O({},a.antispamTag);return!((p=a.antispamTag)===null||p===void 0)&&p.antiSpamBusinessId&&typeof((l=a.antispamTag)===null||l===void 0?void 0:l.antiSpamBusinessId)!="string"&&(e.antiSpamBusinessId=xe((t=a.antispamTag)===null||t===void 0?void 0:t.antiSpamBusinessId)),e}var N3={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function ev(a){return Yt(N3,a)}function MC(a){return qt(a)&&a.length>0?se(a).call(a,function(p){return ev(p)}):[]}var Xl,op,Cc,bc,k3={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function TC(a){return Yt(k3,a)}(function(a){a[a.everyone=1]="everyone",a[a.custom=2]="custom"})(Xl||(Xl={})),function(a){a[a.normal=0]="normal",a[a.owner=1]="owner"}(op||(op={})),function(a){a[a.ignore=0]="ignore",a[a.deny=-1]="deny",a[a.allow=1]="allow"}(Cc||(Cc={})),function(a){a[a.manageServer=1]="manageServer",a[a.manageChannel=2]="manageChannel",a[a.manageRole=3]="manageRole",a[a.sendMsg=4]="sendMsg",a[a.accountInfoSelf=5]="accountInfoSelf",a[a.inviteServer=6]="inviteServer",a[a.kickServer=7]="kickServer",a[a.accountInfoOther=8]="accountInfoOther",a[a.recallMsg=9]="recallMsg",a[a.deleteMsg=10]="deleteMsg",a[a.remindOther=11]="remindOther",a[a.remindEveryone=12]="remindEveryone",a[a.manageBlackWhiteList=13]="manageBlackWhiteList",a[a.banServerMember=14]="banServerMember",a[a.RTCChannelConnect=15]="RTCChannelConnect",a[a.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",a[a.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",a[a.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",a[a.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",a[a.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",a[a.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",a[a.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",a[a.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",a[a.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",a[a.manageInviteApply=25]="manageInviteApply",a[a.manageInviteApplyHistory=26]="manageInviteApplyHistory",a[a.mentionedRole=27]="mentionedRole"}(bc||(bc={}));var IC,ap,cp,Di,Zl,SC,fr,Ps,EC={type:{type:"enum",values:Xl},memberType:{type:"enum",values:op},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},O3={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:Xl},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},w3={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:op},joinTime:{type:"number"},inviter:{type:"string"}};function Ao(a){var p=O({},a),l=Is(EC,p);return l.auths&&(l.auths=function(e){var r,i=Cr(r=pt(e)).call(r,function(o,u){var h=bc[u];return h?o[h]=Cc[e[u]]:o[u]=Cc[e[u]],o},{});return xe(i)}(l.auths)),l}function eu(a){var p;return Cr(p=pt(a)).call(p,function(l,t){var e=ic(bc,t);return e?l[e]=Cc[a[t]]:l[it(t)]=Cc[a[t]],l},{})}function vi(a){var p=Yt(EC,a);return a.auths&&(p.auths=eu(JSON.parse(p.auths))),p.isMember&&delete p.isMember,p}function yi(a){return qt(a)&&a.length>0?se(a).call(a,function(p){return vi(p)}):[]}function tv(a){return a.auths&&(a.auths=eu(JSON.parse(a.auths))),Yt(O3,a)}function rv(a){return a.auths&&(a.auths=eu(JSON.parse(a.auths))),Yt(w3,a)}function CC(a){var p=typeof a;return a!=null&&(p=="object"||p=="function")}(function(a){a[a.default=1]="default",a[a.sync=2]="sync"})(IC||(IC={})),function(a){a[a.sendTime=1]="sendTime"}(ap||(ap={})),function(a){a[a.text=0]="text",a[a.image=1]="image",a[a.audio=2]="audio",a[a.video=3]="video",a[a.geo=4]="geo",a[a.notification=5]="notification",a[a.file=6]="file",a[a.tip=10]="tip",a[a.robot=11]="robot",a[a.g2=12]="g2",a[a.custom=100]="custom"}(cp||(cp={})),function(a){a[a.sending=1]="sending",a[a.success=2]="success",a[a.failed=3]="failed"}(Di||(Di={})),function(a){a[a.notifyAll=1]="notifyAll",a[a.notifySubscribe=2]="notifySubscribe"}(Zl||(Zl={})),function(a){a[a.unknown=0]="unknown",a[a.server=1]="server",a[a.channel=2]="channel",a[a.serverAccids=3]="serverAccids",a[a.channelAccids=4]="channelAccids",a[a.accids=5]="accids"}(SC||(SC={})),function(a){a[a.serverMemberInvite=1]="serverMemberInvite",a[a.serverMemberInviteReject=2]="serverMemberInviteReject",a[a.serverMemberApply=3]="serverMemberApply",a[a.serverMemberApplyReject=4]="serverMemberApplyReject",a[a.serverCreate=5]="serverCreate",a[a.serverRemove=6]="serverRemove",a[a.serverUpdate=7]="serverUpdate",a[a.serverMemberInviteDone=8]="serverMemberInviteDone",a[a.serverMemberInviteAccept=9]="serverMemberInviteAccept",a[a.serverMemberApplyDone=10]="serverMemberApplyDone",a[a.serverMemberApplyAccept=11]="serverMemberApplyAccept",a[a.serverMemberKick=12]="serverMemberKick",a[a.serverMemberLeave=13]="serverMemberLeave",a[a.serverMemberUpdate=14]="serverMemberUpdate",a[a.channelCreate=15]="channelCreate",a[a.channelRemove=16]="channelRemove",a[a.channelUpdate=17]="channelUpdate",a[a.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",a[a.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",a[a.updateQuickComment=20]="updateQuickComment",a[a.channelCategoryCreate=21]="channelCategoryCreate",a[a.channelCategoryRemove=22]="channelCategoryRemove",a[a.channelCategoryUpdate=23]="channelCategoryUpdate",a[a.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",a[a.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",a[a.serverIdentifyAdd=26]="serverIdentifyAdd",a[a.serverIdentifyRemove=27]="serverIdentifyRemove",a[a.serverIdentifyUpdate=28]="serverIdentifyUpdate",a[a.channelIdentifyUpdate=29]="channelIdentifyUpdate",a[a.userIdentifyUpdate=30]="userIdentifyUpdate",a[a.channelVisibilityUpdate=31]="channelVisibilityUpdate",a[a.serverEnterLeave=32]="serverEnterLeave",a[a.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",a[a.channelVisibilityToVisitorUpdate=34]="channelVisibilityToVisitorUpdate",a[a.myMemberInfoUpdated=35]="myMemberInfoUpdated",a[a.custom=100]="custom",a[a.msgTyping=101]="msgTyping"}(fr||(fr={})),function(a){a[a.reply=1]="reply",a[a.thread=2]="thread",a[a.all=3]="all"}(Ps||(Ps={}));var x3=Math.max,P3=Math.min;function L3(a,p,l){var t,e,r,i,o,u,h=0,g=!1,v=!1,_=!0;if(typeof a!="function")throw new TypeError("Expected a function");function I(W){var U=t,ie=e;return t=e=void 0,h=W,i=a.apply(ie,U)}function C(W){return h=W,o=or(N,p),g?I(W):i}function A(W){var U=W-u;return u===void 0||U>=p||U<0||v&&W-h>=r}function N(){var W=Dt();if(A(W))return F(W);o=or(N,function(ie){var te=p-(ie-u);return v?P3(te,r-(ie-h)):te}(W))}function F(W){return o=void 0,_&&t?I(W):(t=e=void 0,i)}function j(){var W=Dt(),U=A(W);if(t=arguments,e=this,u=W,U){if(o===void 0)return C(u);if(v)return clearTimeout(o),o=or(N,p),I(u)}return o===void 0&&(o=or(N,p)),i}return p=Number(p)||0,CC(l)&&(g=!!l.leading,r=(v="maxWait"in l)?x3(Number(l.maxWait)||0,p):r,_="trailing"in l?!!l.trailing:_),j.cancel=function(){o!==void 0&&clearTimeout(o),h=0,t=u=e=o=void 0},j.flush=function(){return o===void 0?i:F(Dt())},j}var Ro;function nv(a,p,l){var t=!0,e=!0;if(typeof a!="function")throw new TypeError("Expected a function");return CC(l)&&(t="leading"in l?!!l.leading:t,e="trailing"in l?!!l.trailing:e),L3(a,p,{leading:t,maxWait:p,trailing:e})}(function(a){a[a.sub=1]="sub",a[a.unSub=2]="unSub"})(Ro||(Ro={}));var V3=function(){function a(l){var t=this;this.unreadCount={},this.manualSubscribeUnreadMap={},this.manualSubscribeServerMap={},this.manualSubscribeTypingMap={},this.unreadServerCount={},this.serverRoleIdsMap={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this._serverUnreadInfo=nv(function(e){t.core.emit("serverUnreadInfo",t.getServerUnreadInfo(e)),Pe(t.core,"qchatServer.emit")&&t.core.qchatServer.emit("serverUnreadInfo",t.getServerUnreadInfo(e))},100),this.core=l}var p=a.prototype;return p.changeCacheServerRoleIds=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g,v,_=this;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(i=t.attach.serverIdentifyInfo,o=i.serverId,u=i.roleId,this.serverRoleIdsMap[o]){C.next=4;break}return C.next=4,this.getRoleIdsByServerId([o]);case 4:if(h=this.serverRoleIdsMap[o],!(t.time<h.timeTag)){C.next=7;break}return C.abrupt("return");case 7:if(t.type===fr[fr.serverIdentifyAdd]?h.roleIds.add(u):h.roleIds.delete(u),this.core.logger.debug("QChatChannel::qchatChannel/serverIdentifyChange::now "+o+" roleIds is",dt(r=[]).call(r,h.roleIds)),g=this.unreadServerCount[o]){C.next=12;break}return C.abrupt("return");case 12:v=Zi(pt(g),100),ae(v).call(v,function(A){_.core.qchatChannel.getChannelUnreadInfos({channels:se(A).call(A,function(N){return{serverId:o,channelId:N}})})});case 14:case"end":return C.stop()}},e,this)}))},p.getRoleIdsByServerId=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h=this;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if((i=at(t).call(t,function(_){return!h.serverRoleIdsMap[_]})).length){v.next=3;break}return v.abrupt("return");case 3:return o={serverIdTimeTags:i},v.next=6,this.core.sendCmd("qchatGetRoleIdsByServerId",{qchatGetRoleIdsByServerIdTag:o});case 6:u=v.sent,this.core.logger.debug("QChatChannel:: getRoleIdsByServerId, params is ",o,"result is",u),ae(r=u.content.serverRoles).call(r,function(_){try{_.roleIds=JSON.parse(_.roleIds)}catch(I){h.core.logger.error("QChatChannel:: getRoleIdsByServerId JSON parse roleIds error",I)}h.serverRoleIdsMap[_.serverId]={roleIds:new es(_.roleIds),timeTag:_.timeTag}});case 9:case"end":return v.stop()}},e,this)}))},p._unSubscribeChannel=function(t,e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(i=t+"_"+e,o=[],this.manualSubscribeUnreadMap[i]?o.push(this.manualSubscribeUnreadMap[i]):this.autoSubscribeUnreadMap[i]&&o.push(this.autoSubscribeUnreadMap[i]),this.manualSubscribeTypingMap[i]&&o.push(this.manualSubscribeTypingMap[i]),o.length!==0){_.next=6;break}return _.abrupt("return");case 6:for(u=0,h=o;u<h.length;u++)g=h[u],this.subscribe({opeType:Ro.unSub,type:g,channels:[{serverId:t,channelId:e}]});this.manualSubscribeUnreadMap[i]?this.manualSubscribeUnreadMap[i]=void 0:this.autoSubscribeUnreadMap[i]&&(this.autoSubscribeUnreadMap[i]=void 0),this.manualSubscribeTypingMap[i]&&(this.manualSubscribeTypingMap[i]=void 0);case 9:case"end":return _.stop()}},r,this)}))},p._unSubscribeServer=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(r=t,i=this.manualSubscribeServerMap[r]||this.autoSubscribeServerMap[r]){u.next=4;break}return u.abrupt("return");case 4:this.subscribe({opeType:Ro.unSub,type:i,channels:[{serverId:t,channelId:""}]}),this.manualSubscribeServerMap[r]?this.manualSubscribeServerMap[r]=void 0:this.autoSubscribeServerMap[r]&&(this.autoSubscribeServerMap[r]=void 0);case 6:case"end":return u.stop()}},e,this)}))},p.subscribe=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h=this;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),v.next=3,this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:t.type,opeType:t.opeType},channels:t.channels});case 3:return i=v.sent,o=new es,ae(r=t.channels).call(r,function(_){return k(h,void 0,void 0,T.mark(function I(){return T.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:this.serverRoleIdsMap[_.serverId]||o.add(_.serverId);case 1:case"end":return A.stop()}},I,this)}))}),u=Zi(vr(o),10),ae(u).call(u,function(_){h.getRoleIdsByServerId(_)}),v.abrupt("return",i.content);case 9:case"end":return v.stop()}},e,this)}))},p.autoSubscribe=function(){return k(this,void 0,void 0,T.mark(function t(){return T.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.core.sendCmd("qchatAutoSubscribe",{qchatAutoSubReqTag:{}});case 2:case"end":return r.stop()}},t,this)}))},p.resumeSubscribe=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g,v,_=this;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(this.serverRoleIdsMap={},h=100,t){C.next=6;break}return this.unreadServerCount={},this.unreadCount={},C.abrupt("return");case 6:return g={},ae(r=pt(this.manualSubscribeUnreadMap)).call(r,function(A){var N=_.manualSubscribeUnreadMap[A];if(N){var F=A.split("_"),j={serverId:F[0],channelId:F[1]};g[N]=g[N]||[],g[N].push(j)}}),g[5]=[],ae(i=pt(this.manualSubscribeTypingMap)).call(i,function(A){return k(_,void 0,void 0,T.mark(function N(){var F,j,W,U;return T.wrap(function(te){for(;;)switch(te.prev=te.next){case 0:this.manualSubscribeTypingMap[A]&&(F=A.split("_"),j=F[0],W=F[1],U={serverId:j,channelId:W},g[5].push(U));case 2:case"end":return te.stop()}},N,this)}))}),g[4]=[],ae(o=pt(this.manualSubscribeServerMap)).call(o,function(A){return k(_,void 0,void 0,T.mark(function N(){var F;return T.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:this.manualSubscribeServerMap[A]&&(F={serverId:A},g[4].push(F));case 2:case"end":return W.stop()}},N,this)}))}),v=[],ae(u=pt(g)).call(u,function(A){var N=g[A];if(N&&N.length===0)return He.resolve();if(N.length>h){var F=Zi(N,100);return ae(F).call(F,function(j){v.push(_.createSubscribePromise(j,A))})}v.push(_.createSubscribePromise(N,A))}),C.next=16,He.all(v);case 16:case"end":return C.stop()}},e,this)}))},p.createSubscribePromise=function(t,e){var r=this,i={type:it(e),opeType:1,channels:t};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",i),this.subscribe(i).then(function(o){var u=o.unreadInfos;u&&u.length>0&&(u=Ql(u),r.updateUnreads(u))}).catch(function(o){r.core.logger.error("qchatChannel:: autoSubscribeUnread error ",o)})},p.cacheSubscribe=function(t){var e,r=this;ae(e=t.channels).call(e,function(i){var o=i.channelId?i.serverId+"_"+i.channelId:""+i.serverId,u=t.type===5?r.manualSubscribeTypingMap:t.type===4?r.manualSubscribeServerMap:r.manualSubscribeUnreadMap;t.opeType===Ro.sub?u[o]=t.type:t.opeType===Ro.unSub&&(u[o]=void 0)})},p.cacheAutoSubscribe=function(t){var e,r=this;ae(e=t.channels).call(e,function(i){var o=i.channelId?i.serverId+"_"+i.channelId:""+i.serverId,u=t.type===4?r.autoSubscribeServerMap:r.autoSubscribeUnreadMap;t.opeType===Ro.sub?u[o]=t.type:t.opeType===Ro.unSub&&(u[o]=void 0)})},p.cacheUnreadCount=function(t){var e=this;ae(t).call(t,function(r){var i=r.serverId+"_"+r.channelId;e.unreadCount[i]=O({},r),e.unreadServerCount[r.serverId]||(e.unreadServerCount[r.serverId]={}),e.unreadServerCount[r.serverId][r.channelId]=!0})},p.getServerUnreadInfo=function(t){var e,r=this,i={serverId:t,unreadCount:0,mentionedCount:0,maxCount:0},o=this.unreadServerCount[t];return o&&(ae(e=pt(o)).call(e,function(u){var h=t+"_"+u,g=r.unreadCount[h];i.unreadCount+=g.unreadCount,i.mentionedCount+=g.mentionedCount,g.maxCount!==void 0&&(i.maxCount=g.maxCount)}),i.unreadCount=i.unreadCount>i.maxCount?i.maxCount:i.unreadCount,i.mentionedCount=i.mentionedCount>i.maxCount?i.maxCount:i.mentionedCount),i},p.getUnreadInfo=function(t){P({serverId:{type:"string"},channelId:{type:"string"}},t);var e=t.serverId+"_"+t.channelId;return this.unreadCount[e]?this.unreadCount[e]:null},p.shouldChangeUnread=function(t,e){if(!t.serverId||!t.channelId||this.core.qchatChannel.subscribeForVisitorService.isInSubscribeChannels(t.serverId,t.channelId)||t.historyEnable===!1||t.needBadge===!1||t.fromAccount===this.core.account||e&&(t==null?void 0:t.status)!==2)return!1;if(t.notifyReason&&t.notifyReason===ic(Zl,Zl.notifySubscribe)){if(!t.serverId||!t.channelId)return!1;var r=this.getUnreadInfo({serverId:t.serverId,channelId:t.channelId}),i=e?"ackTimestamp":"lastMsgTime";if(!r||t.time&&r[i]&&r[i]>t.time)return!1}return!0},p.shouldChangeMentionedUnread=function(t,e){return e===void 0&&(e=!1),k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!t.accidsOfMentionedRoles||!_t(i=t.accidsOfMentionedRoles).call(i,this.core.account)){h.next=2;break}return h.abrupt("return",!0);case 2:if(!t.mentionRoleIds||!t.serverId){h.next=16;break}if(this.serverRoleIdsMap[t.serverId]){h.next=9;break}if(e){h.next=7;break}return this.handledRoleMsg(t),h.abrupt("return",!1);case 7:return h.next=9,this.getRoleIdsByServerId([t.serverId]);case 9:o=0;case 10:if(!(o<t.mentionRoleIds.length)){h.next=16;break}if(!this.serverRoleIdsMap[t.serverId].roleIds.has(t.mentionRoleIds[o])){h.next=13;break}return h.abrupt("return",!0);case 13:o++,h.next=10;break;case 16:return h.abrupt("return",!1);case 17:case"end":return h.stop()}},r,this)}))},p.handledRoleMsg=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(t.mentionRoleIds){_.next=2;break}return _.abrupt("return");case 2:if(this.serverRoleIdsMap[t.serverId]){_.next=5;break}return _.next=5,this.getRoleIdsByServerId([t.serverId]);case 5:if(this.serverRoleIdsMap[t.serverId]){_.next=8;break}return this.core.logger.warn("QChatChannel::handledRoleMsg::can not get serverRoleIds,server id",t.serverId),_.abrupt("return");case 8:if(i=!1,ae(r=t.mentionRoleIds).call(r,function(I){g.serverRoleIdsMap[t.serverId].roleIds.has(I)&&(i=!0,g.core.logger.debug("QChatChannel::handledRoleMsg::will update message mentionedCountmessage is ",t))}),i){_.next=12;break}return _.abrupt("return");case 12:if(o=this.unreadCount[t.serverId+"_"+t.channelId],u=(t==null?void 0:t.status)===2,o.mentionedCount=u?o.mentionedCount?o.mentionedCount-1:0:o.mentionedCount?o.mentionedCount+1:1,typeof o.maxCount!="number"){_.next=25;break}if(!((h=(h=o.mentionedCount)>o.maxCount?o.maxCount:h)>o.maxCount)){_.next=21;break}return this.core.logger.debug("QChatChannel::handledRoleMsg::tempUnreadCount more than maxCount"),_.abrupt("return");case 21:this.core.emit("unreadInfo",O(O({},o),{mentionedCount:h})),this.core.emit("unreadInfos",[O(O({},o),{mentionedCount:h})]),this.core.qchatChannel.emit("unreadInfos",[O(O({},o),{mentionedCount:h})]),this._serverUnreadInfo(t.serverId);case 25:case"end":return _.stop()}},e,this)}))},p.getMentionedFlag=function(t,e){return e===void 0&&(e=!1),k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!t.mentionAll){u.next=4;break}return u.abrupt("return",!0);case 4:if(!t.mentionRoleIds&&!t.accidsOfMentionedRoles){u.next=10;break}return u.next=7,this.shouldChangeMentionedUnread(t,e);case 7:return u.abrupt("return",u.sent);case 10:if(!t.mentionAccids||!_t(i=t.mentionAccids).call(i,this.core.account)){u.next=12;break}return u.abrupt("return",!0);case 12:return u.abrupt("return",!1);case 13:case"end":return u.stop()}},r,this)}))},p.changeUnread=function(t,e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(i=t.serverId,o=t.channelId,u=i+"_"+o,this.shouldChangeUnread(t,e)){C.next=6;break}return this.core.logger.debug("changeUnread: "+u+" does not need to update unreadInfo"),C.abrupt("return");case 6:if(this.unreadCount[u]){C.next=11;break}return C.next=9,this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:i,channelId:o}]});case 9:return!this.serverRoleIdsMap[i]&&t.mentionRoleIds&&this.getRoleIdsByServerId([i]),C.abrupt("return");case 11:return h=this.unreadCount[u],g=(t==null?void 0:t.status)===2,C.next=15,this.getMentionedFlag(t);case 15:if(v=C.sent,g?(h.unreadCount=h.unreadCount?h.unreadCount-1:0,v&&(h.mentionedCount=h.mentionedCount?h.mentionedCount-1:0),delete h.lastMsgTime,this.core.logger.debug("changeUnread: "+u+" unread reduce ",h)):(h.unreadCount=h.unreadCount?h.unreadCount+1:1,v&&(h.mentionedCount=h.mentionedCount?h.mentionedCount+1:1),t.time&&(h.lastMsgTime=t.time),this.core.logger.debug("changeUnread: "+u+" unread add ",h)),_=typeof h.maxCount=="number"?h.maxCount:100,!(h.unreadCount>_)){C.next=21;break}return this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"),C.abrupt("return");case 21:this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",O(O({},h),{mentionedCount:h.mentionedCount>_?_:h.mentionedCount,unreadCount:h.unreadCount>_?_:h.unreadCount})),this.core.emit("unreadInfos",[O(O({},h),{mentionedCount:h.mentionedCount>_?_:h.mentionedCount,unreadCount:h.unreadCount>_?_:h.unreadCount})]),this.core.qchatChannel.emit("unreadInfos",[O(O({},h),{mentionedCount:h.mentionedCount>_?_:h.mentionedCount,unreadCount:h.unreadCount>_?_:h.unreadCount})]),this._serverUnreadInfo(i);case 26:case"end":return C.stop()}},r,this)}))},p.updateUnreads=function(t){var e,r,i=this;if(t&&t.length>0){var o=[],u=[],h=se(e=at(t).call(t,function(v){var _=v.serverId+"_"+v.channelId,I=i.unreadCount[_],C=Pe(I,"ackTimestamp"),A=Pe(v,"ackTimestamp");return!(C&&A&&A<C)&&(Pe(I,"unreadCount")!==Pe(v,"unreadCount")||Pe(I,"mentionedCount")!==Pe(v,"mentionedCount"))})).call(e,function(v){o.push(i.getServerUnreadInfo(v.serverId)),u.push(i.unreadServerCount[v.serverId]);var _=v.serverId,I=v.channelId,C=_+"_"+I;return i.core.logger.debug("qchat channel updateUnread: ",v),i.unreadCount[C]=O({},v),i.unreadServerCount[_]||(i.unreadServerCount[_]={}),i.unreadServerCount[_][I]=!0,v});if(h.length!==0){this.core.emit("unreadInfos",h),this.core.qchatChannel.emit("unreadInfos",h);var g={};ae(h).call(h,function(v,_){i.core.emit("unreadInfo",v);var I=o[_],C=u[_],A=i.getServerUnreadInfo(v.serverId),N=i.unreadServerCount[v.serverId],F=I.unreadCount!==A.unreadCount,j=!C||pt(C).length===0,W=N&&pt(N).length>0,U=I.mentionedCount!==A.mentionedCount;(F||U||j&&W)&&(g[v.serverId]=!0)}),ae(r=pt(g)).call(r,function(v){i.core.emit("serverUnreadInfo",i.getServerUnreadInfo(v)),Pe(i.core,"qchatServer.emit")&&i.core.qchatServer.emit("serverUnreadInfo",i.getServerUnreadInfo(v))})}}},p.clearUnreadCountByServers=function(t,e){var r=this,i=[];ae(t).call(t,function(u){var h;r.unreadServerCount[u]&&ae(h=pt(r.unreadServerCount[u])).call(h,function(g){i.push(u+"_"+g)})});var o=[];ae(i).call(i,function(u){o.push(O(O({},r.unreadCount[u]),{unreadCount:0,mentionedCount:0,ackTimestamp:e}))}),this.updateUnreads(o)},a}(),D3=function(){function a(l){this.limitForBatchEnter=10,this.limitForBatchSubscribe=100,this.autoServers=new es,this.autoVisitorSubscribeServer=new es,this.autoVisitorSubscribeChannel=new es,this.core=l}var p=a.prototype;return p.subscribeChannelAsVisitor=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h=this;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||6,opeType:t.opeType},datas:t.channels});case 2:return i=v.sent,o=i.content.failedArr,u=at(r=t.channels).call(r,function(_){return!Ln(o).call(o,function(I){return I.channelId===_.channelId&&I.serverId===_.serverId})}),ae(u).call(u,function(_){t.opeType===1?h.autoVisitorSubscribeChannel.add(_.serverId+"&"+_.channelId):h.autoVisitorSubscribeChannel.delete(_.serverId+"&"+_.channelId)}),v.abrupt("return",{failedChannels:o});case 7:case"end":return v.stop()}},e,this)}))},p.subscribeServerAsVisitor=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g,v=this;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||7,opeType:t.opeType},datas:se(r=t.serverIds).call(r,function(C){return{serverId:C}})});case 2:return u=I.sent,h=u.content.failedArr,g=at(i=t.serverIds).call(i,function(C){return!Ln(h).call(h,function(A){return A.serverId===C})}),ae(g).call(g,function(C){t.opeType===1?v.autoVisitorSubscribeServer.add(C):v.autoVisitorSubscribeServer.delete(C)}),I.abrupt("return",{failedServers:se(o=u.content.failedArr).call(o,function(C){return C.serverId})});case 7:case"end":return I.stop()}},e,this)}))},p.deleteServer=function(t){var e;this.autoServers.delete(t),this.autoVisitorSubscribeServer.has(t)&&this.subscribeServerAsVisitor({opeType:2,serverIds:[t]});var r=[];ae(e=this.autoVisitorSubscribeChannel).call(e,function(i){if(wt(i).call(i,t)===0){var o=i.replace(t+"&","");r.push({serverId:t,channelId:o})}}),r.length>0&&this.subscribeChannelAsVisitor({opeType:2,channels:r})},p.deleteAutoSetInServerId=function(t){var e,r=this;this.autoServers.delete(t),this.autoVisitorSubscribeServer.delete(t),ae(e=this.autoVisitorSubscribeChannel).call(e,function(i){wt(i).call(i,t)===0&&r.autoVisitorSubscribeChannel.delete(i)})},p.deleteAutoSetInChannel=function(t,e){this.autoVisitorSubscribeChannel.delete(t+"&"+e)},p.unSubscribeChannel=function(t,e){this.subscribeChannelAsVisitor({opeType:2,channels:[{serverId:t,channelId:e}]})},p.isInSubscribeChannels=function(t,e){return this.autoVisitorSubscribeChannel.has(t+"&"+e)},p.isInAutoServers=function(t){return this.autoServers.has(t)},p.doAutoSubscribe=function(){var t=this,e=[],r=Zi(vr(this.autoVisitorSubscribeServer),this.limitForBatchSubscribe);ae(r).call(r,function(o){e.push(t.subscribeServerAsVisitor({opeType:1,serverIds:o}))});var i=Zi(vr(this.autoVisitorSubscribeChannel),this.limitForBatchSubscribe);return ae(i).call(i,function(o){e.push(t.subscribeChannelAsVisitor({opeType:1,channels:se(o).call(o,function(u){var h=wt(u).call(u,"&");return{serverId:ht(u).call(u,0,h),channelId:ht(u).call(u,h+1)}})}))}),He.all(e)},p.doAutoEnterServer=function(){return k(this,void 0,void 0,T.mark(function t(){var e,r,i,o=this;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return e=Zi(vr(this.autoServers),this.limitForBatchEnter),r=[],ae(e).call(e,function(g){r.push(o.core.qchatServer.enterAsVisitor({serverIds:g}))}),h.next=5,He.all(r);case 5:i=h.sent,ae(i).call(i,function(g){var v;ae(v=g.failedServers).call(v,function(_){o.deleteAutoSetInServerId(_)})});case 7:case"end":return h.stop()}},t,this)}))},p.resumeSubscribe=function(t){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!t){i.next=7;break}return i.next=3,this.doAutoEnterServer();case 3:return i.next=5,this.doAutoSubscribe();case 5:i.next=10;break;case 7:this.autoServers.clear(),this.autoVisitorSubscribeChannel.clear(),this.autoVisitorSubscribeServer.clear();case 10:case"end":return i.stop()}},e,this)}))},p.cacheServer=function(t){var e=this;ae(t).call(t,function(r){return e.autoServers.add(r)})},a}();function U3(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return bC(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?bC(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bC(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}var F3=function(a){function p(t,e){var r;return(r=a.call(this,"qchatChannel",t)||this).config={autoSubscribe:!1},r.core=t,Kt({cmdMap:g3,cmdConfig:v3()}),e&&r.setOptions(e),r.subscribeModuleService=new V3(t),r.subscribeForVisitorService=new D3(t),r.setListener(),r}bt(p,a);var l=p.prototype;return l.setOptions=function(e){e&&(this.config=O(this.config,e))},l.setListener=function(){var e,r,i,o,u,h=this;this.core.eventBus.on("logined",function(g){h.subscribeModuleService.resumeSubscribe(g.isAutoReconnect),h.subscribeForVisitorService.resumeSubscribe(g.isAutoReconnect),h.config.autoSubscribe&&(h.subscribeModuleService.autoSubscribeServerMap={},h.subscribeModuleService.autoSubscribeUnreadMap={},h.subscribeModuleService.autoSubscribe())}),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",function(g){h.subscribeModuleService.resumeSubscribe(g.isReconnect),h.subscribeForVisitorService.resumeSubscribe(g.isReconnect),h.config.autoSubscribe&&(h.subscribeModuleService.autoSubscribeServerMap={},h.subscribeModuleService.autoSubscribeUnreadMap={},h.subscribeModuleService.autoSubscribe())}),this.core.eventBus.on("qchatChannel/changeUnread",et(e=this.subscribeModuleService.changeUnread).call(e,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/updateUnreads",et(r=this.subscribeModuleService.updateUnreads).call(r,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/cacheSubscribe",et(i=this.subscribeModuleService.cacheSubscribe).call(i,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/clearUnreadCountByServers",et(o=this.subscribeModuleService.clearUnreadCountByServers).call(o,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/getRoleIdsByServerId",et(u=this.subscribeModuleService.getRoleIdsByServerId).call(u,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/autoUnSubscribe",function(g){if(h.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",g),g.type===fr[fr.channelVisibilityUpdate])h.logger.log("QChatChannel::begin autoUnSubscribe channel key is",g.serverId+"_"+g.channelId),h.subscribeModuleService._unSubscribeChannel(g.serverId,g.channelId),h.logger.log("QChatChannel::autoUnSubscribe channel done key is",g.serverId+"_"+g.channelId);else if(g.type===fr[fr.serverEnterLeave]){var v;(h.subscribeModuleService.manualSubscribeServerMap[g.serverId]||h.subscribeModuleService.autoSubscribeServerMap[g.serverId])&&(h.logger.log("QChatChannel::begin autoUnSubscribe server key is",g.serverId),h.subscribeModuleService._unSubscribeServer(g.serverId),h.logger.log("QChatChannel::autoUnSubscribe server done key is",g.serverId));var _=h.subscribeModuleService.unreadServerCount[g.serverId];if(!_)return;h.logger.log("QChatChannel::begin autoUnSubscribe channels key is",pt(_)),ae(v=pt(_)).call(v,function(I){h.subscribeModuleService._unSubscribeChannel(g.serverId,I)}),h.logger.log("QChatChannel::autoUnSubscribe channels done key is",pt(_))}}),this.core.eventBus.on("qchatChannel/serverIdentifyChange",function(g){h.subscribeModuleService.changeCacheServerRoleIds(g)})},l.createChannel=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",min:1},type:{type:"enum",values:Qt(Ma)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},e),u.next=3,this.core.sendCmd("qchatCreateChannel",{channelInfo:O(O({},e),{type:Ma[e.type]}),antispamTag:bo(e)});case 3:return i=u.sent,u.abrupt("return",Jl(i.content.channelInfo));case 5:case"end":return u.stop()}},r,this)}))},l.deleteChannel=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({channelId:{type:"string",allowEmpty:!1}},e),o.next=3,this.core.sendCmd("qchatDeleteChannel",e);case 3:case"end":return o.stop()}},r,this)}))},l.updateChannel=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:Qt(Ma),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},e),i=e,e.type&&(i.type=Ma[e.type]),h.next=5,this.core.sendCmd("qchatUpdateChannel",{channelInfo:i,antispamTag:bo(e)});case 5:return o=h.sent,h.abrupt("return",Jl(o.content.channelInfo));case 7:case"end":return h.stop()}},r,this)}))},l.getChannels=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({channelIds:{type:"array",itemType:"string",min:1}},e),u.next=3,this.core.sendCmd("qchatGetChannels",e);case 3:return i=u.sent,u.abrupt("return",np(i.content.channelList));case 5:case"end":return u.stop()}},r,this)}))},l.getChannelsByPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:O({limit:100},e)});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:np(u)});case 6:case"end":return v.stop()}},r,this)}))},l.getMembersByPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:e});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:Co(u)});case 6:case"end":return v.stop()}},r,this)}))},l.updateWhiteBlackRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:Qt(Ir)},opeType:{type:"enum",values:Qt(gi)}},e),o.next=3,this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:O(O({},e),{type:Ir[e.type],opeType:gi[e.opeType]})});case 3:case"end":return o.stop()}},r,this)}))},l.getWhiteBlackRolesPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Qt(Ir)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:O(O({},e),{type:Ir[e.type]})});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:yi(u)});case 6:case"end":return v.stop()}},r,this)}))},l.updateWhiteBlackMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Qt(Ir)},opeType:{type:"enum",values:Qt(gi)},toAccids:{type:"array",itemType:"string",min:1}},e),o.next=3,this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:O(O({},e),{type:Ir[e.type],opeType:gi[e.opeType],toAccids:xe(e.toAccids)})});case 3:case"end":return o.stop()}},r,this)}))},l.getWhiteBlackMembersPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Qt(Ir)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:O(O({limit:100},e),{type:Ir[e.type]})});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:Co(u)});case 6:case"end":return v.stop()}},r,this)}))},l.getExistingWhiteBlackRoles=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Qt(Ir)},roleIds:{type:"array",itemType:"string",min:1}},e),h.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:O(O({},e),{type:Ir[e.type],roleIds:xe(e.roleIds)})});case 3:return i=h.sent,o=i.content.datas,h.abrupt("return",{datas:yi(o)});case 6:case"end":return h.stop()}},r,this)}))},l.getExistingWhiteBlackMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Qt(Ir)},accids:{type:"array",itemType:"string",min:1}},e),h.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:O(O({},e),{type:Ir[e.type],accids:xe(e.accids)})});case 3:return i=h.sent,o=i.content.datas,h.abrupt("return",{datas:Co(o)});case 6:case"end":return h.stop()}},r,this)}))},l.updateCategoryInfoOfChannel=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:e});case 3:return i=u.sent,u.abrupt("return",Jl(i.content.channelInfo));case 5:case"end":return u.stop()}},r,this)}))},l.createChannelCategory=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:e});case 3:return i=u.sent,u.abrupt("return",zl(i.content.QChatChannelCategoryInfo));case 5:case"end":return u.stop()}},r,this)}))},l.removeChannelCategory=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({categoryId:{type:"string",allowEmpty:!1}},e),o.next=3,this.core.sendCmd("qchatRemoveChannelCategory",e);case 3:case"end":return o.stop()}},r,this)}))},l.updateChannelCategory=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:e});case 3:return i=u.sent,u.abrupt("return",zl(i.content.QChatChannelCategoryInfo));case 5:case"end":return u.stop()}},r,this)}))},l.getChannelCategoriesByID=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({categoryIds:{type:"array",itemType:"string",min:1}},e),u.next=3,this.core.sendCmd("qchatGetChannelCategoriesByID",e);case 3:return i=u.sent,u.abrupt("return",_C(i.content.channelCategoryList));case 5:case"end":return u.stop()}},r,this)}))},l.updateChannelCategoryWhiteBlackRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Qt(Ir)},opeType:{type:"enum",values:Qt(gi)},roleId:{type:"string",allowEmpty:!1}},e),o.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:O(O({},e),{type:Ir[e.type],opeType:gi[e.opeType]})});case 3:case"end":return o.stop()}},r,this)}))},l.getChannelCategoryWhiteBlackRolesPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Qt(Ir)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:O(O({},e),{type:Ir[e.type]})});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:yi(u)});case 6:case"end":return v.stop()}},r,this)}))},l.updateChannelCategoryWhiteBlackMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Qt(Ir)},opeType:{type:"enum",values:Qt(gi)},toAccids:{type:"array",itemType:"string",min:1}},e),o.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:O(O({},e),{type:Ir[e.type],opeType:gi[e.opeType],toAccids:xe(e.toAccids)})});case 3:case"end":return o.stop()}},r,this)}))},l.getChannelCategoryWhiteBlackMembersPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Qt(Ir)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:O(O({},e),{type:Ir[e.type]})});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:Co(u)});case 6:case"end":return v.stop()}},r,this)}))},l.getChannelCategoryWhiteBlackRoles=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Qt(Ir)},roleIds:{type:"array",itemType:"string",min:1}},e),h.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:O(O({},e),{type:Ir[e.type],roleIds:xe(e.roleIds)})});case 3:return i=h.sent,o=i.content.datas,h.abrupt("return",yi(o));case 6:case"end":return h.stop()}},r,this)}))},l.getChannelCategoryWhiteBlackMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Qt(Ir)},accids:{type:"array",itemType:"string",min:1}},e),h.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:O(O({},e),{type:Ir[e.type],accids:xe(e.accids)})});case 3:return i=h.sent,o=i.content.datas,h.abrupt("return",Co(o));case 6:case"end":return h.stop()}},r,this)}))},l.getChannelCategoriesPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:e});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:_C(u)});case 6:case"end":return v.stop()}},r,this)}))},l.getChannelCategoryChannelsPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:e});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:np(u)});case 6:case"end":return v.stop()}},r,this)}))},l.subscribeChannel=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(P({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},e),!this.config.autoSubscribe||e.isInternalTrigger||e.type===5){h.next=3;break}throw new Ut("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:return h.next=5,this.subscribeModuleService.subscribe(e);case 5:if((i=h.sent).unreadInfos=Ql(i.unreadInfos),e.type!==5){h.next=10;break}return this.subscribeModuleService.cacheSubscribe(e),h.abrupt("return");case 10:return e.opeType===1&&(e.channels=se(o=i.unreadInfos).call(o,function(g){return{serverId:g.serverId,channelId:g.channelId}})),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",e),this.config.autoSubscribe?this.subscribeModuleService.cacheAutoSubscribe(e):this.subscribeModuleService.cacheSubscribe(e),this.subscribeModuleService.updateUnreads(i.unreadInfos),h.abrupt("return",i);case 15:case"end":return h.stop()}},r,this)}))},l.getChannelUnreadInfos=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetUnreadInfo",e);case 2:return i=h.sent,o=Ql(i.content.unreadInfos),this.subscribeModuleService.updateUnreads(o),h.abrupt("return",o);case 6:case"end":return h.stop()}},r,this)}))},l.getChannelSearchByPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(P({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:Qt(So),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:Qt(ep),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),!(e.startTime&&e.endTime&&e.startTime>=e.endTime)){v.next=3;break}throw new _s("startTime more than endTime",e,"timeRule");case 3:return v.next=5,this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:O(O({},e),{order:e.order&&So[e.order],sort:Tr(e)&&ep[Tr(e)]})});case 5:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag),cursor:h.cursor},datas:np(u)});case 8:case"end":return v.stop()}},r,this)}))},l.channelMemberSearch=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatChannelMemberSearch",{qchatChannelMemberSearchTag:e});case 3:return i=u.sent,u.abrupt("return",E3(i.content.datas));case 5:case"end":return u.stop()}},r,this)}))},l.subscribeAsVisitor=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},channels:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},min:1}},e),o.next=3,this.subscribeForVisitorService.subscribeChannelAsVisitor(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.qchatAutoSubscribeNotificationHandler=function(e){var r=Ql(e.content.unreadInfos),i=e.content.serverIds;this.subscribeModuleService.updateUnreads(r);var o=[];if(i.length){var u={opeType:1};u.channels=se(i).call(i,function(I){return{serverId:I.serverId,channelId:""}}),u.type=4,o.push(u)}if(r.length){var h={opeType:1};h.channels=se(r).call(r,function(I){return{serverId:I.serverId,channelId:I.channelId}}),h.type=1,o.push(h)}if(o.length)for(var g,v=U3(o);!(g=v()).done;){var _=g.value;this.subscribeModuleService.cacheAutoSubscribe(_)}},p}(Wl),B3={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},q3={limit:{type:"number"}};function G3(a){return qt(a)&&a.length>0?se(a).call(a,function(p){return function(t){return Yt(B3,t)}(p)}):[]}function j3(a){try{a.audio&&(a.audio=JSON.parse(a.audio))}catch{throw new _s('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{a.video&&(a.video=JSON.parse(a.video))}catch{throw new _s('result "video" JSON parse error',{key:"video"},"JSON parse error")}return Yt(q3,a)}var Ta,H3={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},tu={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},$3=function(){var p=function(){return rn(tu)}();return{qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:tu.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:p.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:tu.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:tu.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:p.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:tu.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:p.memberInfo}]}}},K3=function(a){function p(t,e){var r;return(r=a.call(this,"qchatMedia",t)||this).config={},r.tokenExpireTime=24e4,r.getTokenState=!1,r.core=t,Kt({cmdMap:H3,cmdConfig:$3()}),e&&r.setOptions(e),r.setListener(),r.tokenExpireTime=24e4,r.channelId="",r.serverId="",r}bt(p,a);var l=p.prototype;return l.setOptions=function(e){e&&(this.config=O(this.config,e),e!=null&&e.neroom&&this.setNeroom(e.neroom))},l.setNeroom=function(e){this.neroom=new e},l.setListener=function(){var e,r,i,o,u=this;this.core.eventBus.on("disconnect",et(e=this._existRomm).call(e,this)),this.core.eventBus.on("kicked",et(r=this._existRomm).call(r,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",et(i=this._existRomm).call(i,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",et(o=this._existRomm).call(o,this)),this.core.eventBus.on("qchatMedia/serverOrChannelLeave",function(h){return k(u,void 0,void 0,T.mark(function g(){return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(h.type===fr[fr.channelVisibilityUpdate]&&h.channelId===this.channelId||h.type===fr[fr.serverEnterLeave]&&h.serverId===this.serverId)){_.next=4;break}if(!this.roomContext||!this.roomContext.roomUuid){_.next=4;break}return _.next=4,this.disconnectChannel();case 4:case"end":return _.stop()}},g,this)}))})},l._existRomm=function(){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this.roomContext){i.next=3;break}return i.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return i.stop()}},e,this)}))},l._checkPermission=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.core.qchatRole.checkPermission(e);case 2:return i=u.sent,u.abrupt("return",i);case 4:case"end":return u.stop()}},r,this)}))},l._checkConnectState=function(){if(this.state!=="connect")throw new Ut("QChatMedia::you should connect first")},l.kickMemberOut=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1}},e),u.prev=2,u.next=5,(r=this.roomContext)===null||r===void 0?void 0:r.kickMemberOut(e.accid);case 5:u.next=11;break;case 7:throw u.prev=7,u.t0=u.catch(2),this.logger.error("QChatMedia::kickMemberOut error params is "+xe(e),u.t0),new Ut("QChatMedia::kickMemberOut error",u.t0);case 11:case"end":return u.stop()}},i,this,[[2,7]])}))},l.disconnectChannel=function(){var e;return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.logger.debug("QChatMedia::disconnect begin disconnect"),o.prev=1,o.next=4,(e=this.roomContext)===null||e===void 0?void 0:e.leaveRoom();case 4:o.next=9;break;case 6:o.prev=6,o.t0=o.catch(1),this.logger.error("QChatMedia::disconnect error",o.t0);case 9:if(!this.authService){o.next=12;break}return o.next=12,this.authService.logout();case 12:this._setStateInit(),this.core.emit("qchatMediaDisconnect"),this.core.qchatMedia.emit("qchatMediaDisconnect");case 15:case"end":return o.stop()}},r,this,[[1,6]])}))},l._setStateInit=function(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""},l.muteAudio=function(e){var r,i,o,u,h;return k(this,void 0,void 0,T.mark(function g(){var v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1}},e),((r=this.roomContext)===null||r===void 0?void 0:r.localMember.uuid)!==e.accid){I.next=14;break}return I.prev=3,I.next=6,(i=this.rtcController)===null||i===void 0?void 0:i.muteMyAudio();case 6:I.next=12;break;case 8:throw I.prev=8,I.t0=I.catch(3),this.logger.error("QChatMedia::muteAudio error",I.t0),new Ut("QChatMedia::muteAudio error",I.t0);case 12:case 25:I.next=31;break;case 14:if(I.prev=14,!(v=(o=this.roomContext)===null||o===void 0?void 0:o.roomProperties.audioOff)||((u=v.value)===null||u===void 0?void 0:u.split("_")[0])!=="offNotAllowSelfOn"){I.next=23;break}return I.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 19:if(I.sent){I.next=23;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),I.abrupt("return");case 23:return I.next=25,(h=this.rtcController)===null||h===void 0?void 0:h.muteMemberAudio(e.accid);case 27:throw I.prev=27,I.t1=I.catch(14),this.logger.error("QChatMedia::muteAudio error params is "+xe(e),I.t1),new Ut("QChatMedia::muteAudio error",I.t1);case 31:case"end":return I.stop()}},g,this,[[3,8],[14,27]])}))},l.unMuteAudio=function(e){var r,i,o,u,h;return k(this,void 0,void 0,T.mark(function g(){var v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1}},e),!(v=(r=this.roomContext)===null||r===void 0?void 0:r.roomProperties.audioOff)||((i=v.value)===null||i===void 0?void 0:i.split("_")[0])!=="offNotAllowSelfOn"){I.next=10;break}return I.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 6:if(I.sent){I.next=10;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),I.abrupt("return");case 10:if(((o=this.roomContext)===null||o===void 0?void 0:o.localMember.uuid)!==e.accid){I.next=22;break}return I.prev=11,I.next=14,(u=this.rtcController)===null||u===void 0?void 0:u.unmuteMyAudio();case 14:I.next=20;break;case 16:throw I.prev=16,I.t0=I.catch(11),this.logger.error("QChatMedia::unMuteAudio error",I.t0),new Ut("QChatMedia::unMuteAudio error",I.t0);case 20:case 25:I.next=31;break;case 22:return I.prev=22,I.next=25,(h=this.rtcController)===null||h===void 0?void 0:h.unmuteMemberAudio(e.accid);case 27:throw I.prev=27,I.t1=I.catch(22),this.logger.error("QChatMedia::unMuteAudio error params is "+xe(e),I.t1),new Ut("QChatMedia::unMuteAudio error",I.t1);case 31:case"end":return I.stop()}},g,this,[[11,16],[22,27]])}))},l.muteVideo=function(e){var r,i,o,u,h;return k(this,void 0,void 0,T.mark(function g(){var v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1}},e),((r=this.roomContext)===null||r===void 0?void 0:r.localMember.uuid)!==e.accid){I.next=14;break}return I.prev=3,I.next=6,(i=this.rtcController)===null||i===void 0?void 0:i.muteMyVideo();case 6:I.next=12;break;case 8:throw I.prev=8,I.t0=I.catch(3),this.logger.error("QChatMedia::muteVideo error",I.t0),new Ut("QChatMedia::muteVideo error",I.t0);case 12:case 25:I.next=31;break;case 14:if(I.prev=14,!(v=(o=this.roomContext)===null||o===void 0?void 0:o.roomProperties.videoOff)||((u=v.value)===null||u===void 0?void 0:u.split("_")[0])!=="offNotAllowSelfOn"){I.next=23;break}return I.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 19:if(I.sent){I.next=23;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),I.abrupt("return");case 23:return I.next=25,(h=this.rtcController)===null||h===void 0?void 0:h.muteMemberVideo(e.accid);case 27:throw I.prev=27,I.t1=I.catch(14),this.logger.error("QChatMedia::muteVideo error params is "+xe(e),I.t1),new Ut("QChatMedia::muteVideo error",I.t1);case 31:case"end":return I.stop()}},g,this,[[3,8],[14,27]])}))},l.unMuteVideo=function(e){var r,i,o,u,h;return k(this,void 0,void 0,T.mark(function g(){var v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1}},e),!(v=(r=this.roomContext)===null||r===void 0?void 0:r.roomProperties.videoOff)||((i=v.value)===null||i===void 0?void 0:i.split("_")[0])!=="offNotAllowSelfOn"){I.next=10;break}return I.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 6:if(I.sent){I.next=10;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),I.abrupt("return");case 10:if(((o=this.roomContext)===null||o===void 0?void 0:o.localMember.uuid)!==e.accid){I.next=22;break}return I.prev=11,I.next=14,(u=this.rtcController)===null||u===void 0?void 0:u.unmuteMyVideo();case 14:I.next=20;break;case 16:throw I.prev=16,I.t0=I.catch(11),this.logger.error("QChatMedia::unMuteVideo error",I.t0),new Ut("QChatMedia::unMuteVideo error",I.t0);case 20:I.next=30;break;case 22:I.prev=22,(h=this.rtcController)===null||h===void 0||h.unmuteMemberVideo(e.accid),I.next=30;break;case 26:throw I.prev=26,I.t1=I.catch(22),this.logger.error("QChatMedia::unMuteVideo error",I.t1),new Ut("QChatMedia::unMuteVideo error",I.t1);case 30:case"end":return I.stop()}},g,this,[[11,16],[22,26]])}))},l.startScreenShare=function(){var e;return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),o.prev=1,(e=this.rtcController)===null||e===void 0||e.startScreenShare(),o.next=9;break;case 5:throw o.prev=5,o.t0=o.catch(1),this.logger.error("QChatMedia::startScreenShare error",o.t0),new Ut("QChatMedia::startScreenShare error",o.t0);case 9:case"end":return o.stop()}},r,this,[[1,5]])}))},l.stopScreenShare=function(){var e;return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),o.prev=1,(e=this.rtcController)===null||e===void 0||e.stopScreenShare(),o.next=9;break;case 5:throw o.prev=5,o.t0=o.catch(1),this.logger.error("QChatMedia::stopScreenShare error",o.t0),new Ut("QChatMedia::stopScreenShare error",o.t0);case 9:case"end":return o.stop()}},r,this,[[1,5]])}))},l.stopMemberScreenShare=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1}},e),u.prev=2,(r=this.rtcController)===null||r===void 0||r.stopMemberScreenShare(e.accid),u.next=10;break;case 6:throw u.prev=6,u.t0=u.catch(2),this.logger.error("QChatMedia::stopMemberScreenShare error",u.t0),new Ut("QChatMedia::stopMemberScreenShare error",u.t0);case 10:case"end":return u.stop()}},i,this,[[2,6]])}))},l.subscribeRemoteVideoStream=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},e),u.prev=2,(r=this.rtcController)===null||r===void 0||r.subscribeRemoteVideoStream(e.accid,e.streamType),u.next=10;break;case 6:throw u.prev=6,u.t0=u.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoStream error",u.t0),new Ut("QChatMedia::subscribeRemoteVideoStream error",u.t0);case 10:case"end":return u.stop()}},i,this,[[2,6]])}))},l.unSubscribeRemoteVideoStream=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},e),u.prev=2,(r=this.rtcController)===null||r===void 0||r.unsubscribeRemoteVideoStream(e.accid,e.streamType),u.next=10;break;case 6:throw u.prev=6,u.t0=u.catch(2),this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",u.t0),new Ut("QChatMedia::unSubscribeRemoteVideoStream error",u.t0);case 10:case"end":return u.stop()}},i,this,[[2,6]])}))},l.setupVideoCanvas=function(e){var r;if(this._checkConnectState(),((r=this.roomContext)===null||r===void 0?void 0:r.localMember.uuid)===e.accid)try{return this.rtcController.setupLocalVideoCanvas(e.videoView)}catch(i){throw this.logger.error("QChatMedia::setupVideoCanvas error",i),new Ut("QChatMedia::setupVideoCanvas error",i)}else try{return this.rtcController.setupRemoteVideoCanvas(e.videoView,e.accid)}catch(i){throw this.logger.error("QChatMedia::setupVideoCanvas error",i),new Ut("QChatMedia::setupVideoCanvas error",i)}},l.setupRemoteVideoSubStreamCanvas=function(e){this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1}},e);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(e.videoView,e.accid)}catch(r){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",r),new Ut("QChatMedia::setupRemoteVideoSubStreamCanvas error",r)}},l.getScreenSharingUserUuid=function(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(e){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",e),new Ut("QChatMedia::getScreenSharingUserUuid error",e)}},l.initQChatMedia=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.neroom){o.next=3;break}return this.logger.warn("QChatMedia::init::you should import neroom SDK"),o.abrupt("return");case 3:if(this.state===void 0){o.next=6;break}return this.logger.error("QChatMedia::init::you already init QChatMedia"),o.abrupt("return");case 6:o.prev=6,this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:e.serverConfig}),o.next=14;break;case 10:throw o.prev=10,o.t0=o.catch(6),this.logger.error("QChatMedia::initQChatMedia error",o.t0),new Ut("QChatMedia::initQChatMedia error",o.t0);case 14:this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init";case 18:case"end":return o.stop()}},r,this,[[6,10]])}))},l.loginByIM=function(){var e;return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.state==="init"){h.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),h.abrupt("return");case 3:return h.next=5,this._getToken();case 5:return i=h.sent,o=Pe(this.core,"options.token")||Pe(this.core,"V2NIMLoginService.token"),h.prev=7,h.next=10,(e=this.authService)===null||e===void 0?void 0:e.loginByIM(this.core.account,i,o);case 10:h.next=16;break;case 12:throw h.prev=12,h.t0=h.catch(7),this.logger.error("QChatMedia::loginByIM error",h.t0),new Ut("QChatMedia::loginByIM error",h.t0);case 16:this.state="login";case 17:case"end":return h.stop()}},r,this,[[7,12]])}))},l._getToken=function(){var e;return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.logger.log("QChatMedia::getToken begin getToken"),_.next=3,this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:(e=this.neroom)===null||e===void 0?void 0:e.deviceId}});case 3:return i=_.sent,o=i.content.neroomToken,u=o.token,h=o.expire,this.logger.log("QChatMedia::getToken success token is "+u+",expire is "+h+" "),this.tokenTimer||(this.logger.debug("QChatMedia::getToken set token timer,expire is "+(1e3*h-this.tokenExpireTime)+" "),this.tokenTimer=this.core.timerManager.addTimer(function(){return k(g,void 0,void 0,T.mark(function I(){var C;return T.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return this.tokenTimer&&this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0,N.next=4,this._getToken();case 4:C=N.sent,this.authService&&this.authService.renewToken(C);case 6:case"end":return N.stop()}},I,this)}))},1e3*h-this.tokenExpireTime)),_.abrupt("return",u);case 8:case"end":return _.stop()}},r,this)}))},l.connectChannel=function(e){var r,i;return k(this,void 0,void 0,T.mark(function o(){var u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.state!==void 0){g.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),g.abrupt("return");case 3:if(this.state!=="init"){g.next=6;break}return g.next=6,this.loginByIM();case 6:return this.serverId=e.serverId,this.channelId=e.channelId,g.prev=8,g.next=11,(r=this.roomService)===null||r===void 0?void 0:r.joinRoom({roomUuid:e.channelId,role:"qchatAudience",userName:this.core.account,initialProperties:{}},{});case 11:g.next=17;break;case 13:throw g.prev=13,g.t0=g.catch(8),this.logger.error("QChatMedia::connectChannel error",g.t0),new Ut("QChatMedia::connectChannel error",g.t0);case 17:if(!(u=(i=this.roomService)===null||i===void 0?void 0:i.getRoomContext(e.channelId))){g.next=28;break}return this.roomContext=u,this.rtcController=this.roomContext.rtcController,this.state="connect",g.next=24,this.rtcController.joinRtcChannel();case 24:this.core.emit("connectChannel"),this.core.qchatMedia.emit("connectChannel"),g.next=29;break;case 28:this.logger.error("QChatMedia::connect room not exited");case 29:case"end":return g.stop()}},o,this,[[8,13]])}))},l.updateRTCChannelInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},e),o.next=3,this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:O(O({},e),{audio:xe(e.audio),video:xe(e.video)})});case 3:case"end":return o.stop()}},r,this)}))},l.getRTCChannelInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},e),u.next=3,this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:e});case 3:return i=u.sent,u.abrupt("return",j3(i.content.RTCChannelConfig));case 5:case"end":return u.stop()}},r,this)}))},l.getRTCChannelOnlineMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},e),u.next=3,this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:e});case 3:return i=u.sent,u.abrupt("return",G3(i.content.memberList));case 5:case"end":return u.stop()}},r,this)}))},l.addRTCChannelListener=function(){var e,r,i=this;this._checkConnectState();try{(e=this.authService)===null||e===void 0||e.addAuthListener({onAuthEvent:function(u){return k(i,void 0,void 0,T.mark(function h(){var g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(u!==1026||this.getTokenState){_.next=10;break}return this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0,_.next=5,this._getToken();case 5:if(g=_.sent,!this.authService){_.next=9;break}return _.next=9,this.authService.renewToken(g);case 9:this.getTokenState=!1;case 10:case"end":return _.stop()}},h,this)}))}})}catch(o){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",o),new Ut("QChatMedia::loginByIM addAuthListener error",o)}(r=this.roomContext)===null||r===void 0||r.addRoomListener({onRoomPropertiesChanged:function(u){var h,g,v,_,I,C;if(i.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",u),u.audioOff){var A=(h=u.audioOff.value)===null||h===void 0?void 0:h.split("_")[0];A!=="offNotAllowSelfOn"&&A!=="offAllowSelfOn"||!((g=i.roomContext)===null||g===void 0)&&g.localMember.isAudioOn&&((v=i.rtcController)===null||v===void 0||v.muteMyAudio())}else if(u.videoOff){var N=(_=u.videoOff.value)===null||_===void 0?void 0:_.split("_")[0];N!=="offNotAllowSelfOn"&&N!=="offAllowSelfOn"||!((I=i.roomContext)===null||I===void 0)&&I.localMember.isVideoOn&&((C=i.rtcController)===null||C===void 0||C.muteMyVideo())}},onRoomPropertiesDeleted:function(u){i.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",u)},onMemberJoinRtcChannel:function(u){i.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",u);var h=se(u).call(u,function(g){return g.uuid});i.core.emit("memberJoinRTCChannel",h),i.core.qchatMedia.emit("memberJoinRTCChannel",h)},onMemberLeaveRoom:function(u){i.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",u);var h=se(u).call(u,function(g){return g.uuid});i.core.emit("memberLeaveRTCChannel",h),i.core.qchatMedia.emit("memberLeaveRTCChannel",h)},onRoomEnded:function(u){i.authService&&i.authService.logout(),i._setStateInit(),i.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",u),i.core.emit("RTCChannelEnded",u),i.core.qchatMedia.emit("RTCChannelEnded",u)},onRtcChannelError:function(u){i.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",u),u==="SOCKET_ERROR"&&i.disconnectChannel(),i.core.emit("RTCChannelError",u),i.core.qchatMedia.emit("RTCChannelError",u)},onRtcAudioVolumeIndication:function(u){i.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",u),i.core.emit("onRtcAudioVolumeIndication",u),i.core.qchatMedia.emit("onRtcAudioVolumeIndication",u)},onMemberAudioMuteChanged:function(u,h,g){i.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",u,h),i.core.emit("memberAudioMuteChanged",{memberAccId:u.uuid,mute:h,operateByAccId:g.uuid}),i.core.qchatMedia.emit("memberAudioMuteChanged",{memberAccId:u.uuid,mute:h,operateByAccId:g.uuid})},onMemberScreenShareStateChanged:function(u,h,g){i.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",u,h),i.core.emit("memberScreenShareStateChanged",{memberAccId:u.uuid,isSharing:h,operateByAccId:g.uuid}),i.core.qchatMedia.emit("memberScreenShareStateChanged",{memberAccId:u.uuid,isSharing:h,operateByAccId:g.uuid})},onMemberVideoMuteChanged:function(u,h,g){i.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",u,h),i.core.emit("memberVideoMuteChanged",{memberAccId:u.uuid,mute:h,operateByAccId:g.uuid}),i.core.qchatMedia.emit("memberVideoMuteChanged",{memberAccId:u.uuid,mute:h,operateByAccId:g.uuid})}})},l.enumCameraDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumCameraDevices().then(function(r){return r.data},function(r){throw e.logger.error("QChatMedia::enumCameraDevices error",r),new Ut("QChatMedia::enumCameraDevices error",r)})},l.enumPlayoutDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then(function(r){return r.data},function(r){throw e.logger.error("QChatMedia::enumPlayoutDevices error",r),new Ut("QChatMedia::enumPlayoutDevices error",r)})},l.enumRecordDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumRecordDevices().then(function(r){return r.data},function(r){throw e.logger.error("QChatMedia::enumRecordDevices error",r),new Ut("QChatMedia::enumRecordDevices error",r)})},l.removeRTCChannelListener=function(){var e,r;this._checkConnectState(),(e=this.roomContext)===null||e===void 0||e.removeRoomListener({}),(r=this.authService)===null||r===void 0||r.removeAuthListener({})},l.setSelectedCameraDevice=function(e){var r=this;return this._checkConnectState(),P({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedCameraDevice(e.deviceId).then(function(i){return i.data},function(i){throw r.logger.error("QChatMedia::setSelectedCameraDevice error",i),new Ut("QChatMedia::setSelectedCameraDevice error",i)})},l.setSelectedPlayoutDevice=function(e){var r=this;return this._checkConnectState(),P({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedPlayoutDevice(e.deviceId).then(function(i){return i.data},function(i){throw r.logger.error("QChatMedia::setSelectedPlayoutDevice error",i),new Ut("QChatMedia::setSelectedPlayoutDevice error",i)})},l.setSelectedRecordDevice=function(e){var r=this;return this._checkConnectState(),P({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedRecordDevice(e.deviceId).then(function(i){return i.data},function(i){throw r.logger.error("QChatMedia::setSelectedRecordDevice error",i),new Ut("QChatMedia::setSelectedRecordDevice error",i)})},l.getRTCMembers=function(){var e,r;return this._checkConnectState(),se(e=at(r=this.roomContext.remoteMembers).call(r,function(i){return i.isInRtcChannel})).call(e,function(i){return{accid:i.uuid,isAudioOn:!!i.isAudioOn,isVideoOn:!!i.isVideoOn,isSharingScreen:!!i.isSharingScreen,properties:i.properties}})},l.subscribeRemoteVideoSubStream=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1}},e),u.prev=2,(r=this.rtcController)===null||r===void 0||r.subscribeRemoteVideoSubStream(e.accid),u.next=10;break;case 6:throw u.prev=6,u.t0=u.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",u.t0),new Ut("QChatMedia::subscribeRemoteVideoSubStream error",u.t0);case 10:case"end":return u.stop()}},i,this,[[2,6]])}))},l.unsubscribeRemoteVideoSubStream=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:this._checkConnectState(),P({accid:{type:"string",allowEmpty:!1}},e),u.prev=2,(r=this.rtcController)===null||r===void 0||r.unsubscribeRemoteVideoSubStream(e.accid),u.next=10;break;case 6:throw u.prev=6,u.t0=u.catch(2),this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",u.t0),new Ut("QChatMedia::unsubscribeRemoteVideoSubStream error",u.t0);case 10:case"end":return u.stop()}},i,this,[[2,6]])}))},l.muteAllAudio=function(){var e;return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this._checkConnectState(),o.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(o.sent){o.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),o.abrupt("return");case 7:o.prev=7,(e=this.roomContext)===null||e===void 0||e.updateRoomProperty("audioOff",xe({value:"offNotAllowSelfOn_"+new Date().getTime()})),o.next=15;break;case 11:throw o.prev=11,o.t0=o.catch(7),this.logger.error("QChatMedia::muteAllAudio error",o.t0),new Ut("QChatMedia::muteAllAudio error",o.t0);case 15:case"end":return o.stop()}},r,this,[[7,11]])}))},l.muteAllVideo=function(){var e;return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this._checkConnectState(),o.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(o.sent){o.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),o.abrupt("return");case 7:o.prev=7,(e=this.roomContext)===null||e===void 0||e.updateRoomProperty("videoOff",xe({value:"offNotAllowSelfOn_"+new Date().getTime()})),o.next=15;break;case 11:throw o.prev=11,o.t0=o.catch(7),this.logger.error("QChatMedia::muteAllVideo error",o.t0),new Ut("QChatMedia::muteAllVideo error",o.t0);case 15:case"end":return o.stop()}},r,this,[[7,11]])}))},l.unMuteAllAudio=function(){var e;return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this._checkConnectState(),o.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(o.sent){o.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),o.abrupt("return");case 7:o.prev=7,(e=this.roomContext)===null||e===void 0||e.updateRoomProperty("audioOff",xe({value:"disable_"+new Date().getTime()})),o.next=15;break;case 11:throw o.prev=11,o.t0=o.catch(7),this.logger.error("QChatMedia::unMuteAllAudio error",o.t0),new Ut("QChatMedia::unMuteAllAudio error",o.t0);case 15:case"end":return o.stop()}},r,this,[[7,11]])}))},l.unMuteAllVideo=function(){var e;return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this._checkConnectState(),o.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(o.sent){o.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),o.abrupt("return");case 7:o.prev=7,(e=this.roomContext)===null||e===void 0||e.updateRoomProperty("videoOff",xe({value:"disable_"+new Date().getTime()})),o.next=15;break;case 11:throw o.prev=11,o.t0=o.catch(7),this.logger.error("QChatMedia::unMuteAllVideo error",o.t0),new Ut("QChatMedia::unMuteAllVideo error",o.t0);case 15:case"end":return o.stop()}},r,this,[[7,11]])}))},p}(Wl),Y3={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","24_127":"qchatGetMentionedMeMessages","25_6":"qchatMultiSyncServersMessageRead"},Cn={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,mentionRoleIds:41,accidsOfMentionedRoles:42,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},qchatPageQueryTag:{hasMore:1,nextTimetag:2,cursor:3},unreadInfo:Jg},iv=function(){return rn(Cn)},W3=function(){var p=iv();return{qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:Cn.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:p.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:p.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:p.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:Cn.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:p.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:p.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:Cn.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:p.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:Cn.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:Cn.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:p.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:p.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:p.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:Cn.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:p.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:p.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:Cn.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:Cn.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:p.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:p.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:p.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:p.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:Cn.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:Cn.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:p.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:p.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:p.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:Cn.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:Cn.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:p.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:p.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:Cn.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:Cn.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:Cn.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:p.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:p.qchatMultiSyncServersMessageReadTag}]},qchatGetMentionedMeMessages:{service:"qchatMsg",sid:24,cid:127,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2,timestamp:3,limit:4}}],response:[{type:"Property",name:"page",reflectMapper:p.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:p.qchatMsgTag}]}}};(function(a){a[a.Android=1]="Android",a[a.iOS=2]="iOS",a[a.PC=4]="PC",a[a.WindowsPhone=8]="WindowsPhone",a[a.Web=16]="Web",a[a.Server=32]="Server",a[a.Mac=64]="Mac",a[a.HarmonyOS=65]="HarmonyOS"})(Ta||(Ta={}));var zn,J3={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers","25_10":"qchatEnterAsVisitor","25_11":"qchatLeaveAsVisitor"},on={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,categoryNumber:14,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:Jg},AC=function(){return rn(on)},Q3=function(){var p=AC();return{qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:on.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:on.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:p.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:on.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:on.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:p.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:p.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:on.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:p.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:on.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:on.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:p.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:on.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:on.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:on.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:on.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:p.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:on.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:on.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:p.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:p.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:on.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:on.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:on.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:p.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:on.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:p.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:on.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:p.memberInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:p.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:p.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:p.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"Int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:p.unreadInfo},{type:"String",name:"failServerIds"}]},qchatEnterAsVisitor:{sid:25,cid:10,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]},qchatLeaveAsVisitor:{sid:25,cid:11,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]}}},z3={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},Dn={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},Ia=function(){return rn(Dn)},X3=function(){var p=Ia();return{qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:Dn.serverRole},{type:"Property",name:"antispamTag",reflectMapper:Dn.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:p.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:Dn.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:p.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:p.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:Dn.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:p.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:p.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:p.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:Dn.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:p.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:Dn.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:p.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:p.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:p.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:p.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:p.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:p.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:p.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:p.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:Dn.checkPermissionTag}],response:[{type:"Bool",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:Dn.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:p.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:Dn.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:p.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:Dn.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:p.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:Dn.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:p.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:Dn.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:p.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:Dn.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:p.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:Dn.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}}},RC=["image","audio","video","file"],sv={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:fr},fromClientType:{type:"enum",values:Ta},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function ov(a,p){var l=O({},a),t=O({type:p||fr.custom},Is(sv,l));return t.serverId&&t.channelId&&t.toAccids?t.toType=4:t.serverId&&t.toAccids?t.toType=3:t.serverId&&t.channelId?t.toType=2:t.serverId?t.toType=1:t.toAccids?t.toType=5:t.toType=0,t}function Z3(a){var p=Ss(a,["msgIdServer","type"]);return Is(sv,p)}var NC=((zn={})[fr.channelUpdateWhiteBlackIdentify]=function(a){var p=Eo();return a.notify=Qg(xt(a.notify,p.qchatUpdateWhiteBlackRoleTag)),a},zn[fr.channelUpdateWhiteBlackIdentifyUser]=function(a){var p=Eo();return a.notify=function(t){return Yt(M3,t)}(xt(a.notify,p.qchatUpdateWhiteBlackMembersTag)),a},zn[fr.updateQuickComment]=function(a){var p=iv();return a.notify=function(t){return Yt(n4,t)}(xt(a.notify,p.qchatQuickCommentRequestTag)),a},zn[fr.channelCategoryCreate]=function(a){var p=Eo();return a.categoryInfo=zl(xt(a.categoryInfo,p.QChatChannelCategoryInfo)),a},zn[fr.channelCategoryUpdate]=function(a){var p=Eo();return a.categoryInfo=zl(xt(a.categoryInfo,p.QChatChannelCategoryInfo)),a},zn[fr.channelCategoryUpdateWhiteBlackIdentify]=function(a){var p=Eo();return a.notify=Qg(xt(a.notify,p.qchatUpdateChannelCategoryWhiteBlackRoleTag)),a},zn[fr.channelCategoryUpdateWhiteBlackIdentifyUser]=function(a){var p=Eo();return a.notify=Qg(xt(a.notify,p.qchatUpdateChannelCategoryWhiteBlackMembersTag)),a},zn[fr.serverIdentifyAdd]=function(a){var p=Ia();return a.serverIdentifyInfo=vi(xt(a.serverIdentifyInfo,p.serverRole)),a},zn[fr.serverIdentifyRemove]=function(a){var p=Ia();return a.serverIdentifyInfo=vi(xt(a.serverIdentifyInfo,p.serverRole)),a},zn[fr.serverIdentifyUpdate]=function(a){var p=Ia();return a.serverIdentifyInfo=vi(xt(a.serverIdentifyInfo,p.serverRole)),a},zn[fr.channelIdentifyUpdate]=function(a){var p=Ia();return a.channelIdentifyInfo=vi(xt(a.channelIdentifyInfo,p.channelRole)),a},zn[fr.userIdentifyUpdate]=function(a){var p=Ia();return a.userIdentifyInfo=vi(xt(a.userIdentifyInfo,p.memberRole)),a},zn[fr.myMemberInfoUpdated]=function(a){var p,l=Pe(a,"userInfo.name"),t=Pe(a,"userInfo.icon");return a.updatedInfos=se(p=a.reuseServers).call(p,function(e){var r={serverId:e.serverId};return(1&e.bits)==1&&typeof l=="string"&&O(r,{nickChanged:!0,nick:l}),(2&e.bits)==2&&typeof t=="string"&&O(r,{avatarChanged:!0,avatar:t}),r}),delete a.userInfo,delete a.reuseServers,a},zn);function ru(a,p){var l=Yt(sv,a);if(!l.attach)return l;var t=AC(),e=Eo();if(l.attach.serverInfo&&(l.attach.serverInfo=ip(xt(l.attach.serverInfo,t.serverInfo))),l.attach.channelInfo&&(l.attach.channelInfo=Jl(xt(l.attach.channelInfo,e.channelInfo))),l.attach.serverMember&&(l.attach.serverMember=sp(xt(l.attach.serverMember,t.memberInfo))),NC[l.attach.type]&&(l.attach=NC[l.attach.type](l.attach)),l.attach.updateAuths)try{l.attach.updateAuths=eu(JSON.parse(l.attach.updateAuths))}catch(r){p.error("formatSystemNotification:JSON parse updateAuths error: ",r)}return l.attach.type&&(l.attach.rawType=l.attach.type,l.attach.type=fr[l.attach.type]),l}var kC={type:{type:"enum",values:cp},fromClientType:{type:"enum",values:Ta},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:Zl},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},mentionRoleIds:{type:"object"},accidsOfMentionedRoles:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function av(a){a.onSendBefore,a.onUploadStart,a.onUploadDone,a.onUploadProgress;var p=br(a,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),l=Is(kC,p);if(l.msgIdClient=a.resendFlag?a.msgIdClient:jr(),!l.msgIdClient)throw new Ym("msgIdClient is required for resend a message","msgIdClient","required");return a.replyMessage&&a.replyMessage.msgIdServer&&(l.replyMsgFromAccount=a.replyMessage.fromAccount,l.replyMsgTime=+a.replyMessage.time,l.replyMsgIdServer=a.replyMessage.msgIdServer,l.replyMsgIdClient=a.replyMessage.msgIdClient,a.replyMessage.threadRefer&&a.replyMessage.threadRefer.msgIdServer?(l.threadMsgFromAccount=a.replyMessage.threadRefer.fromAccount,l.threadMsgTime=+a.replyMessage.threadRefer.time,l.threadMsgIdServer=a.replyMessage.threadRefer.msgIdServer,l.threadMsgIdClient=a.replyMessage.threadRefer.msgIdClient):(l.threadMsgFromAccount=a.replyMessage.fromAccount,l.threadMsgTime=+a.replyMessage.time,l.threadMsgIdServer=a.replyMessage.msgIdServer,l.threadMsgIdClient=a.replyMessage.msgIdClient),delete l.replyMessage),l}function OC(a){return Yt({operatorClientType:{type:"enum",values:Ta},pushPayload:{type:"object"}},a)}function Un(a,p,l){var t,e;return p===void 0&&(p={}),k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return(i=Yt(kC,a)).deliveryStatus=p.deliveryStatus?Di[p.deliveryStatus]:Di[Di.success],p.time&&(i.time=p.time),o=iv(),i.updateContent&&(u=Yt({status:{type:"number"}},u=xt(u=JSON.parse(i.updateContent),o.qchatMsgTag)),i.updateContent=u),i.updateOperatorInfo&&(h=OC(xt(h=JSON.parse(i.updateOperatorInfo),o.qchatMsgUpdateTag)),i.updateOperatorInfo=h),((t=i==null?void 0:i.threadRefer)===null||t===void 0?void 0:t.fromAccount)===""&&delete i.threadRefer,((e=i==null?void 0:i.replyRefer)===null||e===void 0?void 0:e.fromAccount)===""&&delete i.replyRefer,i.attach&&p.attachUrl&&(i.attach.url=p.attachUrl),v.next=11,e4(i,l);case 11:return v.abrupt("return",v.sent);case 12:case"end":return v.stop()}},r)}))}function e4(a,p){return k(this,void 0,void 0,T.mark(function l(){var t;return T.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(_t(RC).call(RC,a.type)&&a.attach&&a.attach.url){r.next=2;break}return r.abrupt("return",a);case 2:if(p&&p.cloudStorage&&typeof p.cloudStorage.getPrivateUrl=="function"&&typeof p.cloudStorage.getOriginUrl=="function"){r.next=4;break}return r.abrupt("return",a);case 4:if(!(wt(t=a.attach.url).call(t,"_im_url=1")<0)){r.next=7;break}return a.attach.url=p.cloudStorage.getPrivateUrl(a.attach.url),r.abrupt("return",a);case 7:return r.prev=7,r.next=10,p.cloudStorage.getOriginUrl(a.attach.url);case 10:a.attach.url=r.sent,r.next=16;break;case 13:throw r.prev=13,r.t0=r.catch(7),new Ym('url "'+a.attach.url+'" parse error',"message.attach.url","parse error");case 16:return r.abrupt("return",a);case 17:case"end":return r.stop()}},l,null,[[7,13]])}))}function wC(a,p,l){return p===void 0&&(p={}),k(this,void 0,void 0,T.mark(function t(){var e;return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(qt(a)&&a.length>0){i.next=2;break}return i.abrupt("return",[]);case 2:return e=se(a).call(a,function(o){return Un(o,p,l)}),i.next=5,He.all(e);case 5:return i.abrupt("return",i.sent);case 6:case"end":return i.stop()}},t)}))}var t4={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}};function r4(a){var p=se(a).call(a,function(t){var e,r=Yt(t4,t);return r.details=se(e=r.details).call(e,function(i){var o=i.createTime?it(i.createTime):0;return o=isNaN(o)?0:o,{count:i.count,hasSelf:i.self,severalAccids:i.topN,type:i.type,createTime:o}}),r}),l={};return ae(p).call(p,function(t){return l[t.msgIdServer]=t}),l}var n4={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}},i4={includeSelf:{type:"number"},order:{type:"enum",values:So},sort:{type:"enum",values:ap},msgTypes:{type:"object"},subTypes:{type:"object"}},s4={hasMore:{type:"boolean"},nextTimetag:{type:"number"},cursor:{type:"string"}},o4={6:function(p){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInServerId(p.serverId),!0},16:function(p){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInChannel(p.serverId,p.channelId),!0},26:function(p){var l=Pe(p,"attach.addAccids");return l&&_t(l).call(l,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",p),!0},27:function(p){var l=Pe(p,"attach.deleteAccids");return l&&_t(l).call(l,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",p),!0},31:function(p){var l,t;return p.attach.event===1?!((t=(l=this.core.qchatChannel)===null||l===void 0?void 0:l.config)===null||t===void 0)&&t.autoSubscribe&&this.core.qchatChannel.subscribeChannel({type:1,opeType:1,channels:[{serverId:p.serverId,channelId:p.channelId}],isInternalTrigger:!0}):p.attach.event===2&&(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",p),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",p)),!0},32:function(p){var l,t;return p.attach.event===2?(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",p),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",p)):p.attach.event===1&&(this.core.qchatChannel.subscribeForVisitorService.deleteServer(p.serverId),!((t=(l=this.core.qchatChannel)===null||l===void 0?void 0:l.config)===null||t===void 0)&&t.autoSubscribe&&this.core.qchatServer.subscribeServer({type:4,opeType:1,servers:[{serverId:p.serverId}],isInternalTrigger:!0})),!0},34:function(p){return p.attach.event===2&&this.core.qchatChannel.subscribeForVisitorService.unSubscribeChannel(p.serverId,p.channelId),!0},101:function(p){var l=Ss(p,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",l),this.core.emit("recvTypingEvent",l),this.core.qchatMsg.emit("recvTypingEvent",l),!1}},a4=function(){function a(l){this.core=l,this.logger=l.logger}var p=a.prototype;return p.sendSystemNotification=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:ov(t)});case 2:return r=u.sent,i=ru(r.content.sysMsg,this.logger),this.logger.getDebugMode()?this.logger.debug("sendCustomSysMsg success",i):this.logger.log("sendCustomSysMsg success",i.serverId,i.channelId,i.msgIdServer),u.abrupt("return",i);case 6:case"end":return u.stop()}},e,this)}))},p.updateSystemNotification=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return r=t.systemNotification,i=br(t,["systemNotification"]),o=Ss(r,["msgIdServer","type","body","ext","status"]),u=ov(o),v.next=5,this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:u,qchatMsgUpdateTag:O(O({},i),{operatorAccount:this.core.account,operatorClientType:Ta.Web,pushPayload:xe(t.pushPayload),routeEnable:wd.boolean(t,"routeEnable")})});case 5:return h=v.sent,v.abrupt("return",ru(h.content.sysMsg,this.logger));case 7:case"end":return v.stop()}},e,this)}))},p.markSystemNotificationsRead=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:se(r=t.systemNotifications).call(r,function(u){return Z3(u)})});case 2:case"end":return o.stop()}},e,this)}))},p.onSysMsg=function(t){var e=t.content.sysMsg;if(e){var r=ru(e,this.core.logger),i=o4[fr[r.type]];if(i&&i.call(this,r)===!1)return;var o={feature:"default",systemNotifications:[r]};this.logger.log("qchat on systemNotification: ",o),this.core.emit("systemNotification",o),this.core.qchatMsg.emit("systemNotification",o)}else this.core.logger.warn("No sysMsg in onSysMsg packet")},p.onMultiSysMsg=function(t){var e=t.content.sysMsg;if(e){var r=ru(e,this.logger);this.core.emit("systemNotificationUpdate",r),this.core.qchatMsg.emit("systemNotificationUpdate",r)}},p.onSyncSysMsg=function(t){var e=this,r=t.content.systemNotifications;if(r&&r.length>0){var i=se(r).call(r,function(o){return ru(o,e.logger)});this.core.emit("systemNotification",{feature:"sync",systemNotifications:i}),this.core.qchatMsg.emit("systemNotification",{feature:"sync",systemNotifications:i})}else this.logger.warn("sync system notification not exist")},a}(),xC=["image","audio","video","file"],c4=function(){function a(l){var t=this;this.markMessageRead=nv(function(e){return k(t,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:e});case 2:i=h.sent,o=zg(i.content.unreadInfo),this.core.eventBus.emit("qchatChannel/updateUnreads",[o]);case 5:case"end":return h.stop()}},r,this)}))},200),this.core=l,this.logger=l.logger}var p=a.prototype;return p.sendMessage=function(t){var e,r,i,o;return k(this,void 0,void 0,T.mark(function u(){var h,g,v,_,I,C;return T.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(!(wt(xC).call(xC,t.type)>-1)){N.next=4;break}return N.next=3,this.doSendFile(t);case 3:t.attach=N.sent;case 4:return h=av(O({fromAccount:this.core.account},t)),N.next=7,Un(h,{time:new Date().getTime(),deliveryStatus:Di.sending},this.core);case 7:g=N.sent;try{t.onSendBefore&&t.onSendBefore(g)}catch(F){this.logger.error("sendMsg: options.onSendBefore error",F)}return N.prev=9,N.next=12,this.core.sendCmd("qchatSendMsg",{qchatMsg:h});case 12:v=N.sent,N.next=22;break;case 15:return N.prev=15,N.t0=N.catch(9),N.next=19,Un(h,{time:new Date().getTime(),deliveryStatus:Di.failed,attachUrl:(e=g.attach)===null||e===void 0?void 0:e.url},this.core);case 19:throw _=N.sent,N.t0.msg=_,N.t0;case 22:return I=v.content,N.next=25,Un(O({},I.qchatMsg),{deliveryStatus:Di.success,attachUrl:(r=g.attach)===null||r===void 0?void 0:r.url},this.core);case 25:if(!(C=N.sent).isAntispam){N.next=29;break}throw{code:10403,msg:C,message:((i=C==null?void 0:C.antiSpamInfo)===null||i===void 0?void 0:i.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:((o=C==null?void 0:C.antiSpamInfo)===null||o===void 0?void 0:o.yidunAntiSpamRes)||""};case 29:return N.abrupt("return",C);case 30:case"end":return N.stop()}},u,this,[[9,15]])}))},p.doSendFile=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(P({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),r=t.attach){o.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){o.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return o.prev=5,o.next=8,this.core.cloudStorage.uploadFile(t);case 8:r=o.sent,o.next=15;break;case 11:throw o.prev=11,o.t0=o.catch(5),this.logger.error("sendFile:: upload File error or abort.",o.t0),o.t0;case 15:return o.abrupt("return",r);case 16:case"end":return o.stop()}},e,this,[[5,11]])}))},p.resendMessage=function(t){var e,r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return(o=av(O(O({},t),{resendFlag:!0}))).deliveryStatus=Di.sending,I.prev=2,I.next=5,this.core.sendCmd("qchatSendMsg",{qchatMsg:o});case 5:u=I.sent,I.next=15;break;case 8:return I.prev=8,I.t0=I.catch(2),I.next=12,Un(o,{time:new Date().getTime(),deliveryStatus:Di.failed},this.core);case 12:throw h=I.sent,I.t0.msg=h,I.t0;case 15:return g=u.content,I.next=18,Un(O({},g.qchatMsg),{deliveryStatus:Di.success},this.core);case 18:if(!(v=I.sent).isAntispam){I.next=22;break}throw{code:10403,msg:v,message:((e=v==null?void 0:v.antiSpamInfo)===null||e===void 0?void 0:e.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:((r=v==null?void 0:v.antiSpamInfo)===null||r===void 0?void 0:r.yidunAntiSpamRes)||""};case 22:return I.abrupt("return",v);case 23:case"end":return I.stop()}},i,this,[[2,8]])}))},p.doUpdateMessage=function(t){var e,r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return o=t.message,u=br(t,["message"]),(h=av(o)).msgIdClient=void 0,h.time=o.time,I.next=6,this.core.sendCmd("qchatUpdateMessage",{qchatMsg:h,qchatMsgUpdateTag:O(O({},u),{operatorAccount:this.core.account,operatorClientType:Ta.Web,pushPayload:xe(t.pushPayload),routeEnable:wd.boolean(t,"routeEnable")})});case 6:return g=I.sent,I.next=9,Un(g.content.qchatMsg,{},this.core);case 9:if(v=I.sent,this.core.eventBus.emit("qchatChannel/changeUnread",v,!0),!g.content.qchatMsg.isAntispam){I.next=14;break}throw{code:10403,msg:h,message:((e=g.content.qchatMsg)===null||e===void 0?void 0:e.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:((r=g.content.qchatMsg)===null||r===void 0?void 0:r.yidunAntiSpamRes)||""};case 14:return I.abrupt("return",v);case 15:case"end":return I.stop()}},i,this)}))},p.getHistoryMessage=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u=this;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:O(O({},t),{reverse:Wi(t)?1:0})});case 2:return i=g.sent,o=i.content,g.next=6,He.all(se(r=o.qchatMsgs).call(r,function(v){return Un(v,{},u.core)}));case 6:return g.abrupt("return",g.sent);case 7:case"end":return g.stop()}},e,this)}))},p.getMentionedMeMessages=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,this.core.sendCmd("qchatGetMentionedMeMessages",{tag:t});case 2:return i=_.sent,o=i.content,I=o.page,u=Yt(s4,I),_.next=7,He.all(se(r=o.datas).call(r,function(C){return Un(C,{},g.core)}));case 7:return h=_.sent,_.abrupt("return",{pageInfo:u,messages:h});case 9:case"end":return _.stop()}var I},e,this)}))},p.areMentionedMeMessages=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:r={},i=0;case 2:if(!(i<t.length)){h.next=13;break}if((o=t[i]).fromAccount!==this.core.account){h.next=7;break}return r[o.msgIdClient]=!1,h.abrupt("continue",10);case 7:return h.next=9,this.core.qchatChannel.subscribeModuleService.getMentionedFlag(o,!0);case 9:r[o.msgIdClient]=h.sent;case 10:i++,h.next=2;break;case 13:return h.abrupt("return",r);case 14:case"end":return h.stop()}},e,this)}))},p.getLastMessageOfChannels=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:t});case 2:return r=h.sent,i=r.content.msgs,h.next=6,wC(i,{},this.core);case 6:return o=h.sent,h.abrupt("return",Cr(o).call(o,function(g,v){return g[v.channelId]=v,g},{}));case 8:case"end":return h.stop()}},e,this)}))},p.messageSearchByPage=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:O(O({},(_=t,Is(i4,_))),{includeSelf:t.includeSelf?1:""})});case 2:return r=v.sent,i=r.content,o=i.datas,u=i.listQueryTag,v.next=6,wC(o,{},this.core);case 6:return h=v.sent,v.abrupt("return",{listQueryTag:{hasMore:+u.hasMore==1,nextTimetag:u.nextTimetag?it(u.nextTimetag):0,cursor:u.cursor},datas:h});case 8:case"end":return v.stop()}var _},e,this)}))},p.onMsg=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(r=t.content.qchatMsg){u.next=4;break}return this.logger.warn("No qchatMsg in qchatMsg packet"),u.abrupt("return");case 4:return u.next=6,Un(r,{},this.core);case 6:i=u.sent,this.core.eventBus.emit("qchatChannel/changeUnread",i,!1),this.core.emit("message",i),this.core.qchatMsg.emit("message",i);case 10:case"end":return u.stop()}},e,this)}))},p.onRecvUnreadInfo=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(r=t.content.qchatMsg){u.next=3;break}return u.abrupt("return");case 3:return u.next=5,Un(r);case 5:i=u.sent,this.core.eventBus.emit("qchatChannel/changeUnread",i,!1);case 7:case"end":return u.stop()}},e,this)}))},p.onMultiSyncRead=function(t){var e=t.content.unreadInfo;if(e){var r=zg(e);this.core.eventBus.emit("qchatChannel/updateUnreads",[r])}},p.onMultiSyncServersRead=function(t){var e=t.content.qchatMultiSyncServersMessageReadTag;if(e){var r=TC(e),i=r.successServerIds,o=r.ackTimestamp;this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",i,o)}},p.onRecvMsgUpdate=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(r=t.content.qchatMsg,i=t.content.qchatMsgUpdateInfo,r){g.next=4;break}return g.abrupt("return");case 4:return g.next=6,Un(r,{},this.core);case 6:o=g.sent,u=OC(i),this.core.eventBus.emit("qchatChannel/changeUnread",o,!0),this.core.emit("messageUpdate",o,u),this.core.qchatMsg.emit("messageUpdate",o,u);case 11:case"end":return g.stop()}},e,this)}))},a}(),l4=function(){function a(l){var t=this;this._sendTypingEvent=nv(function(e){return k(t,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:ov(O(O({},e),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),fr.msgTyping)});case 2:case"end":return o.stop()}},r,this)}))},3e3),this.core=l,this.logger=l.logger,this.lastChannelIdInTyping=""}var p=a.prototype;return p.getMessageHistoryByIds=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:t.serverId,channelId:t.channelId},messageReferList:t.messageReferList});case 2:return i=u.sent,u.abrupt("return",He.all(se(r=i.content.qchatMsgs).call(r,function(h){return Un(h)})));case 4:case"end":return u.stop()}},e,this)}))},p.getReferMessages=function(t){var e,r;return k(this,void 0,void 0,T.mark(function i(){var o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!((e=t.message.replyRefer)===null||e===void 0)&&e.msgIdServer&&(!((r=t.message.threadRefer)===null||r===void 0)&&r.msgIdServer)){h.next=2;break}throw new Error("Message has no reply");case 2:return h.next=4,this.getMessageHistoryByIds({serverId:t.message.serverId,channelId:t.message.channelId,messageReferList:[t.message.replyRefer,t.message.threadRefer]});case 4:if(o=h.sent,t.referType!==Ps[Ps.all]){h.next=9;break}return h.abrupt("return",{replyMessage:o[0],threadMessage:o[1]});case 9:if(t.referType!==Ps[Ps.reply]){h.next=13;break}return h.abrupt("return",{replyMessage:o[0]});case 13:if(t.referType!==Ps[Ps.thread]){h.next=15;break}return h.abrupt("return",{threadMessage:o[1]});case 15:return h.abrupt("return",{replyMessage:o[0],threadMessage:o[1]});case 16:case"end":return h.stop()}},i,this)}))},p.getThreadMessages=function(t){var e;return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return o=!((e=t.message.threadRefer)===null||e===void 0)&&e.msgIdServer?O({serverId:t.message.serverId,channelId:t.message.channelId},t.message.threadRefer):t.message,_.next=3,this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:o,getThreadHistoryMsgTag:O(O({},t.messageQueryOption),{reverse:wd.boolean(t.messageQueryOption,"reverse")})});case 3:return u=_.sent,_.next=6,Un(u.content.thread);case 6:return h=_.sent,_.next=9,He.all(se(i=u.content.qchatMsgs).call(i,function(I){return Un(I)}));case 9:return g=_.sent,_.abrupt("return",{thread:h,threadInfo:{messageCount:+u.content.threadInfo.messageCount,lastMessageTimestamp:+u.content.threadInfo.lastMessageTimestamp},messages:g});case 11:case"end":return _.stop()}},r,this)}))},p.getThreadRootMessagesMeta=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return r=t.threadRootMessages,i=br(t,["threadRootMessages"]),g.next=3,this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:r,tag:i});case 3:if(o=g.sent,!((u=o.content.metas)&&u.length>0)){g.next=7;break}return g.abrupt("return",se(u).call(u,function(v){return O(O({},v),{total:it(v.total),timestamp:it(v.timestamp),msgTime:it(v.msgTime)})}));case 7:return g.abrupt("return",[]);case 8:case"end":return g.stop()}},e,this)}))},p.getQuickComments=function(t){return k(this,void 0,void 0,T.mark(function e(){var r,i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:t.serverId,channelId:t.channelId,msgIdServerList:xe(se(r=t.msgList).call(r,function(g){return g.msgIdServer}))}});case 2:return i=h.sent,o=i.content.quickCommentResponse,h.abrupt("return",r4(o));case 5:case"end":return h.stop()}},e,this)}))},p.updateQuickComment=function(t,e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return P({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t),i=t.commentMessage,o=i.serverId,u=i.channelId,h=i.fromAccount,g=i.msgIdServer,v=i.time,I.next=4,this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:o,channelId:u,fromAccount:h,msgIdServer:g,time:v,type:t.type,opeType:e,opeAccid:this.core.account}});case 4:case"end":return I.stop()}},r,this)}))},p.sendTypingEvent=function(t){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(t.channelId!==this.lastChannelIdInTyping){i.next=4;break}return this.logger.log("qchatMsg sendTypingEvent throttle"),this._sendTypingEvent(t),i.abrupt("return");case 4:this.lastChannelIdInTyping=t.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(t);case 7:case"end":return i.stop()}},e,this)}))},a}(),u4=function(a){function p(t){var e;return(e=a.call(this,"qchatMsg",t)||this).core=t,e.lastChannelIdInMark="",Kt({cmdMap:Y3,cmdConfig:W3()}),e.notificationModuleService=new a4(t),e.messageModuleService=new c4(t),e.extendModuleService=new l4(t),e}bt(p,a);var l=p.prototype;return l.sendMessage=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Qt(cp)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},mentionRoleIds:{type:"array",itemType:"string",required:!1,min:1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},e),o.next=3,this.messageModuleService.sendMessage(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.updateMessage=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(P({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},e),!(typeof e.message.status=="number"&&e.message.status<1e4)){o.next=3;break}throw new Ut("Status should be greater than or equal to 10000");case 3:return o.next=5,this.messageModuleService.doUpdateMessage(e);case 5:return o.abrupt("return",o.sent);case 6:case"end":return o.stop()}},r,this)}))},l.resendMessage=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},e),o.next=3,this.messageModuleService.resendMessage(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.deleteMessage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},e),(i=JSON.parse(xe(e))).message.status=2,u.next=5,this.messageModuleService.doUpdateMessage(i);case 5:return u.abrupt("return",u.sent);case 6:case"end":return u.stop()}},r,this)}))},l.revokeMessage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},e),(i=JSON.parse(xe(e))).message=Ss(i.message,["serverId","channelId","msgIdServer","time"]),i.message.status=1,u.next=6,this.messageModuleService.doUpdateMessage(i);case 6:return u.abrupt("return",u.sent);case 7:case"end":return u.stop()}},r,this)}))},l.markMessageRead=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:P({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},e),e.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=e.channelId,this.messageModuleService.markMessageRead(e);case 4:case"end":return o.stop()}},r,this)}))},l.replyMessage=function(e){P({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},e);var r=e.replyMessage;if(e.serverId!==r.serverId||e.channelId!==r.channelId)throw new Ut("Forbid replying to message from other server, channel");return this.sendMessage(e)},l.getMessageHistoryByIds=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),o.next=3,this.extendModuleService.getMessageHistoryByIds(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.getReferMessages=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:Qt(Ps),required:!1}},e),o.next=3,this.extendModuleService.getReferMessages(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.getThreadMessages=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},e),o.next=3,this.extendModuleService.getThreadMessages(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.getThreadRootMessagesMeta=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),o.next=3,this.extendModuleService.getThreadRootMessagesMeta(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.sendSystemNotification=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},e),o.next=3,this.notificationModuleService.sendSystemNotification(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.updateSystemNotification=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:Qt(fr)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},e),o.next=3,this.notificationModuleService.updateSystemNotification(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.markSystemNotificationsRead=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},e),o.next=3,this.notificationModuleService.markSystemNotificationsRead(e);case 3:case"end":return o.stop()}},r,this)}))},l.getHistoryMessage=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),o.next=3,this.messageModuleService.getHistoryMessage(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.getMentionedMeMessages=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),o.next=3,this.messageModuleService.getMentionedMeMessages(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.areMentionedMeMessages=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(P({messages:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1}},min:1}},e),Md(i=e.messages).call(i,function(h){return e.messages[0].serverId===h.serverId})){u.next=4;break}throw new Ut("Different serverId",e,10414);case 4:if(!this.core.qchatChannel.subscribeForVisitorService.isInAutoServers(e.messages[0].serverId)){u.next=7;break}throw new Ut("Not allowed for visitor",e,10403);case 7:return u.next=9,this.messageModuleService.areMentionedMeMessages(e.messages);case 9:return u.abrupt("return",u.sent);case 10:case"end":return u.stop()}},r,this)}))},l.addQuickComment=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.extendModuleService.updateQuickComment(e,1);case 2:case"end":return o.stop()}},r,this)}))},l.removeQuickComment=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.extendModuleService.updateQuickComment(e,2);case 2:case"end":return o.stop()}},r,this)}))},l.getQuickComments=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},e),o.next=3,this.extendModuleService.getQuickComments(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.sendTypingEvent=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),o.next=3,this.extendModuleService.sendTypingEvent(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.getLastMessageOfChannels=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},e),o.next=3,this.messageModuleService.getLastMessageOfChannels(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.qchatOnMsgHandler=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this.messageModuleService.onMsg(e);case 1:case"end":return o.stop()}},r,this)}))},l.qchatOnRecvUnreadInfoHandler=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this.messageModuleService.onRecvUnreadInfo(e);case 1:case"end":return o.stop()}},r,this)}))},l.qchatOnSysMsgHandler=function(e){this.notificationModuleService.onSysMsg(e)},l.qchatMultiSyncMessageReadHandler=function(e){this.messageModuleService.onMultiSyncRead(e)},l.qchatMultiSyncSystemNotificationUpdateHandler=function(e){this.notificationModuleService.onMultiSysMsg(e)},l.qchatSyncSystemNotificationHandler=function(e){this.notificationModuleService.onSyncSysMsg(e)},l.qchatRecvMessageUpdateHandler=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this.messageModuleService.onRecvMsgUpdate(e);case 1:case"end":return o.stop()}},r,this)}))},l.searchMsgByPage=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:Qt(So),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:Qt(ap),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),o.next=3,this.messageModuleService.messageSearchByPage(e);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}},r,this)}))},l.qchatMultiSyncServersMessageReadHandler=function(e){this.messageModuleService.onMultiSyncServersRead(e)},p}(Wl),d4=function(){function a(l){this.core=l}var p=a.prototype;return p.addChannelCategoryRole=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:t});case 3:return r=o.sent,o.abrupt("return",tv(r.content.channelCategoryRole));case 5:case"end":return o.stop()}},e,this)}))},p.removeChannelCategoryRole=function(t){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),i.next=3,this.core.sendCmd("qchatRemoveChannelCategoryRole",t);case 3:case"end":return i.stop()}},e,this)}))},p.updateChannelCategoryRole=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:Ao(t)});case 3:if((r=o.sent).raw.code!==406){o.next=6;break}throw new Ut("No update required",{},406);case 6:return o.abrupt("return",tv(r.content.channelCategoryRole));case 7:case"end":return o.stop()}},e,this)}))},p.getChannelCategoryRole=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:t});case 3:return r=o.sent,o.abrupt("return",(u=r.content.list,qt(u)&&u.length>0?se(u).call(u,function(h){return tv(h)}):[]));case 5:case"end":return o.stop()}var u},e,this)}))},p.addChannelCategoryMemberRole=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:t});case 3:return r=o.sent,o.abrupt("return",rv(r.content.channelCategoryMemberRole));case 5:case"end":return o.stop()}},e,this)}))},p.removeChannelCategoryMemberRole=function(t){return k(this,void 0,void 0,T.mark(function e(){return T.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),i.next=3,this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",t);case 3:case"end":return i.stop()}},e,this)}))},p.updateChannelCategoryMemberRole=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:Ao(t)});case 3:if((r=o.sent).raw.code!==406){o.next=6;break}throw new Ut("No update required",{},406);case 6:return o.abrupt("return",rv(r.content.channelCategoryMemberRole));case 7:case"end":return o.stop()}},e,this)}))},p.getChannelCategoryMemberRole=function(t){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:t});case 3:return r=o.sent,o.abrupt("return",(u=r.content.list,qt(u)&&u.length>0?se(u).call(u,function(h){return rv(h)}):[]));case 5:case"end":return o.stop()}var u},e,this)}))},a}(),p4=function(a){function p(t){var e;return(e=a.call(this,"qchatRole",t)||this).core=t,Kt({cmdMap:z3,cmdConfig:X3()}),e.category=new d4(t),e}bt(p,a);var l=p.prototype;return l.createServerRole=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},e),u.next=3,this.core.sendCmd("qchatCreateServerRole",{serverRole:O(O({},Ao(e)),{type:Xl.custom}),antispamTag:bo(e)});case 3:return i=u.sent,u.abrupt("return",vi(i.content.serverRole));case 5:case"end":return u.stop()}},r,this)}))},l.updateServerRole=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},e),u.next=3,this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:Ao(e),antispamTag:bo(e)});case 3:return i=u.sent,u.abrupt("return",vi(i.content.serverRole));case 5:case"end":return u.stop()}},r,this)}))},l.deleteServerRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),o.next=3,this.core.sendCmd("qchatDeleteServerRole",e);case 3:case"end":return o.stop()}},r,this)}))},l.getServerRoles=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},e),g.next=3,this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:Ao(e)});case 3:return o=g.sent,u=at(i=o.content.serverRoles).call(i,function(v){return it(v.isMember)===1}),u=se(u).call(u,function(v){return v.roleId}),g.abrupt("return",{roles:yi(o.content.serverRoles),isMemberRoles:u});case 7:case"end":return g.stop()}},r,this)}))},l.addChannelRole=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},e),u.next=3,this.core.sendCmd("qchatAddChannelRole",{channelRole:Ao(e)});case 3:return i=u.sent,u.abrupt("return",vi(i.content.channelRole));case 5:case"end":return u.stop()}},r,this)}))},l.getChannelRoles=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:e});case 3:return i=u.sent,u.abrupt("return",yi(i.content.channelRoles));case 5:case"end":return u.stop()}},r,this)}))},l.removeChannelRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),o.next=3,this.core.sendCmd("qchatRemoveChannelRole",e);case 3:case"end":return o.stop()}},r,this)}))},l.updateChannelRole=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},e),u.next=3,this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:Ao(e)});case 3:if((i=u.sent).raw.code!==406){u.next=6;break}throw new Ut("No update required",{},406);case 6:return u.abrupt("return",vi(i.content.channelRole));case 7:case"end":return u.stop()}},r,this)}))},l.addMemberRole=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),u.next=3,this.core.sendCmd("qchatAddMemberRole",{memberRole:e});case 3:return i=u.sent,u.abrupt("return",vi(i.content.memberRole));case 5:case"end":return u.stop()}},r,this)}))},l.getMemberRoles=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:e});case 3:return i=u.sent,u.abrupt("return",yi(i.content.memberRoles));case 5:case"end":return u.stop()}},r,this)}))},l.removeMemberRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),o.next=3,this.core.sendCmd("qchatRemoveMemberRole",{memberRole:e});case 3:case"end":return o.stop()}},r,this)}))},l.updateMemberRole=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},e),u.next=3,this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:Ao(e)});case 3:if((i=u.sent).raw.code!==406){u.next=6;break}throw new Ut("No update required",{},406);case 6:return u.abrupt("return",vi(i.content.memberRole));case 7:case"end":return u.stop()}},r,this)}))},l.addMembersToServerRole=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},e),g.next=3,this.core.sendCmd("qchatAddMembersToServerRole",O(O({},e),{accids:xe(e.accids)}));case 3:return i=g.sent,o=Pe(i,"content.accids.successAccids"),u=Pe(i,"content.accids.failedAccids"),g.abrupt("return",{successAccids:o?JSON.parse(o):[],failedAccids:u?JSON.parse(u):[]});case 7:case"end":return g.stop()}},r,this)}))},l.removeMembersFromServerRole=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},e),g.next=3,this.core.sendCmd("qchatRemoveMembersFromServerRole",O(O({},e),{accids:xe(e.accids)}));case 3:return i=g.sent,o=Pe(i,"content.accids.successAccids"),u=Pe(i,"content.accids.failedAccids"),g.abrupt("return",{successAccids:o?JSON.parse(o):[],failedAccids:u?JSON.parse(u):[]});case 7:case"end":return g.stop()}},r,this)}))},l.getMembersFromServerRole=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:e});case 3:return i=u.sent,u.abrupt("return",yi(i.content.members));case 5:case"end":return u.stop()}},r,this)}))},l.getServerRolesByAccid=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:e});case 3:return i=u.sent,u.abrupt("return",yi(i.content.serverRoles));case 5:case"end":return u.stop()}},r,this)}))},l.getExistingServerRolesByAccids=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),g.next=3,this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:e.serverId,accids:xe(e.accids)});case 3:return i=g.sent,g.prev=4,u=JSON.parse(i.content.serverRoles),ae(o=pt(u)).call(o,function(v){var _;ae(_=u[v]).call(_,function(I,C){u[v][C]=xt(I,Ia().serverRole)}),u[v]=yi(u[v])}),g.abrupt("return",u);case 10:throw g.prev=10,g.t0=g.catch(4),this.logger.error("can not parse serverRolesGroupByAccid from "+e.serverId+" and "+e.accids,i.content.serverRoles),g.t0;case 14:case"end":return g.stop()}},r,this,[[4,10]])}))},l.getExistingChannelRolesByServerRoleIds=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},e),u.next=3,this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:e.serverId,channelId:e.channelId,roleIds:xe(e.roleIds)});case 3:return i=u.sent,u.abrupt("return",yi(i.content.channelRoles));case 5:case"end":return u.stop()}},r,this)}))},l.getExistingAccidsOfMemberRoles=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),h.next=3,this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:e.serverId,channelId:e.channelId,accids:xe(e.accids)});case 3:return i=h.sent,o=i.content.memberRoles,h.abrupt("return",o&&o.length>0?se(o).call(o,function(g){return g.accid}):[]);case 6:case"end":return h.stop()}},r,this)}))},l.getExistingAccidsInServerRole=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),h.next=3,this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:e.serverId,roleId:e.roleId,accids:xe(e.accids)});case 3:return i=h.sent,o=i.content.members,h.abrupt("return",o&&o.length>0?se(o).call(o,function(g){return g.accid}):[]);case 6:case"end":return h.stop()}},r,this)}))},l.updateServerRolePriorities=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},e),h.next=3,this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:e.serverId,serverRoles:se(i=e.serverRoles).call(i,function(g){return{serverId:g.serverId,roleId:g.roleId,priority:g.priority}})});case 3:return o=h.sent,h.abrupt("return",yi(o.content.serverRoles));case 5:case"end":return h.stop()}},r,this)}))},l.checkPermission=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"string"}},e),u.next=3,this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:O(O({},e),{auth:bc[e.auth]||e.auth})});case 3:return i=u.sent,u.abrupt("return",i.content.checked);case 5:case"end":return u.stop()}},r,this)}))},l.addChannelCategoryRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.category.addChannelCategoryRole(e);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}},r,this)}))},l.removeChannelCategoryRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.category.removeChannelCategoryRole(e);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}},r,this)}))},l.updateChannelCategoryRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.category.updateChannelCategoryRole(e);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}},r,this)}))},l.getChannelCategoryRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.category.getChannelCategoryRole(e);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}},r,this)}))},l.addChannelCategoryMemberRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.category.addChannelCategoryMemberRole(e);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}},r,this)}))},l.removeChannelCategoryMemberRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.category.removeChannelCategoryMemberRole(e);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}},r,this)}))},l.updateChannelCategoryMemberRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.category.updateChannelCategoryMemberRole(e);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}},r,this)}))},l.getChannelCategoryMemberRole=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.category.getChannelCategoryMemberRole(e);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}},r,this)}))},l.checkPermissions=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"string"}},e),this.core.logger.log("qchatRole::checkPermission options is",e),v.next=4,this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:O(O({},e),{auths:xe(se(i=e.auths).call(i,function(_){return bc[_]||_}))})});case 4:return u=v.sent,this.core.logger.log("qchatRole::checkPermission result is",u.content),h={},ae(o=u.content.checkPermissionsResult).call(o,function(_){h[_.auth]=_.isAllow}),this.core.logger.log("qchatRole::checkPermission auths is",h),v.abrupt("return",eu(h));case 10:case"end":return v.stop()}},r,this)}))},p}(Wl);function h4(a,p){var l,t=gr!==void 0&&Yn(a)||a["@@iterator"];if(t)return et(l=(t=t.call(a)).next).call(l,t);if(qt(a)||(t=function(i,o){if(i){var u;if(typeof i=="string")return PC(i,o);var h=ht(u={}.toString.call(i)).call(u,8,-1);return h==="Object"&&i.constructor&&(h=i.constructor.name),h==="Map"||h==="Set"?vr(i):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?PC(i,o):void 0}}(a))||p){t&&(a=t);var e=0;return function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PC(a,p){(p==null||p>a.length)&&(p=a.length);for(var l=0,t=Array(p);l<p;l++)t[l]=a[l];return t}var f4=function(a){function p(t){var e;return(e=a.call(this,"qchatServer",t)||this).core=t,Kt({cmdMap:J3,cmdConfig:Q3()}),e}bt(p,a);var l=p.prototype;return l.createServer=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatCreateServer",{serverInfo:O(O({},e),{searchEnable:e.searchEnable===!1?0:1}),antispamTag:bo(e)});case 3:return i=u.sent,u.abrupt("return",ip(i.content.serverInfo));case 5:case"end":return u.stop()}},r,this)}))},l.deleteServer=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",min:1}},e),o.next=3,this.core.sendCmd("qchatDeleteServer",e);case 3:case"end":return o.stop()}},r,this)}))},l.updateServer=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatUpdateServer",{serverInfo:O(O({},e),{searchEnable:e.searchEnable===!1?0:1}),antispamTag:bo(e)});case 3:return i=u.sent,u.abrupt("return",ip(i.content.serverInfo));case 5:case"end":return u.stop()}},r,this)}))},l.getServers=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverIds:{type:"array",itemType:"string",min:1}},e),u.next=3,this.core.sendCmd("qchatGetServers",e);case 3:return i=u.sent,u.abrupt("return",Zg(i.content.serverList));case 5:case"end":return u.stop()}},r,this)}))},l.getServersByPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetServersByPage",{tag:e});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:Zg(u)});case 6:case"end":return v.stop()}},r,this)}))},l.inviteServerMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},e),h.next=3,this.core.sendCmd("qchatInviteServerMembers",e);case 3:return i=h.sent,o=i.content.record||{},h.abrupt("return",{failByOverAccids:i.content.failByOverAccids,failByBanAccids:i.content.failByBanAccids,recordInfo:ev(o)});case 6:case"end":return h.stop()}},r,this)}))},l.acceptServerInvite=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),o.next=3,this.core.sendCmd("qchatAcceptServerInvite",e);case 3:case"end":return o.stop()}},r,this)}))},l.rejectInviteServer=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),o.next=3,this.core.sendCmd("qchatRejectInviteServer",e);case 3:case"end":return o.stop()}},r,this)}))},l.applyServerJoin=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},e),u.next=3,this.core.sendCmd("qchatApplyServerJoin",e);case 3:return i=u.sent,u.abrupt("return",ev(i.content.data));case 5:case"end":return u.stop()}},r,this)}))},l.acceptServerApply=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),o.next=3,this.core.sendCmd("qchatAcceptServerApply",e);case 3:case"end":return o.stop()}},r,this)}))},l.rejectServerApply=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),o.next=3,this.core.sendCmd("qchatRejectServerApply",e);case 3:case"end":return o.stop()}},r,this)}))},l.kickServerMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},e),o.next=3,this.core.sendCmd("qchatKickServerMembers",e);case 3:case"end":return o.stop()}},r,this)}))},l.leaveServer=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",min:1}},e),o.next=3,this.core.sendCmd("qchatLeaveServer",e);case 3:case"end":return o.stop()}},r,this)}))},l.updateMyMemberInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},e),u.next=3,this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:e,antispamTag:bo(e)});case 3:return i=u.sent,u.abrupt("return",sp(i.content.memberInfo));case 5:case"end":return u.stop()}},r,this)}))},l.updateServerMemberInfo=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},e),u.next=3,this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:e,antispamTag:bo(e)});case 3:return i=u.sent,u.abrupt("return",sp(i.content.memberInfo));case 5:case"end":return u.stop()}},r,this)}))},l.getServerMembers=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(P({accids:{type:"array"}},e),i=[],e.accids.length)for(o=h4(e.accids);!(u=o()).done;)h=u.value,i.push(h.serverId+"|"+h.accid);return _.next=5,this.core.sendCmd("qchatGetServerMembers",{accids:i});case 5:return g=_.sent,_.abrupt("return",Co(g.content.accidList));case 7:case"end":return _.stop()}},r,this)}))},l.getServerMembersByPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetServerMembersByPage",{tag:e});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:Co(u)});case 6:case"end":return v.stop()}},r,this)}))},l.subscribeServer=function(e){var r,i,o,u;return k(this,void 0,void 0,T.mark(function h(){var g,v,_,I;return T.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(P({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},e),!(!((i=(r=this.core.qchatChannel)===null||r===void 0?void 0:r.config)===null||i===void 0)&&i.autoSubscribe)||e.isInternalTrigger){A.next=3;break}throw new Ut("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:if(e.type||(e.type=4),!e.servers.length){A.next=12;break}return v=O(O({},e),{channels:se(g=e.servers).call(g,function(N){return{serverId:N.serverId,channelId:""}})}),A.next=8,this.core.qchatChannel.subscribeModuleService.subscribe(v);case 8:return _=A.sent,I=_.failedChannels,!((u=(o=this.core.qchatChannel)===null||o===void 0?void 0:o.config)===null||u===void 0)&&u.autoSubscribe?this.core.qchatChannel.subscribeModuleService.cacheAutoSubscribe(v):this.core.qchatChannel.subscribeModuleService.cacheSubscribe(v),A.abrupt("return",{failedServers:I});case 12:case"end":return A.stop()}},h,this)}))},l.banServerMember=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),o.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:O(O({},e),{opeType:1})});case 3:case"end":return o.stop()}},r,this)}))},l.unbanServerMember=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),o.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:O(O({},e),{opeType:2})});case 3:case"end":return o.stop()}},r,this)}))},l.getBannedMembersByPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),v.next=3,this.core.sendCmd("qchatGetBannedMembersByPage",{tag:e});case 3:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag)},datas:R3(u)});case 6:case"end":return v.stop()}},r,this)}))},l.serverSearchByPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(P({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:Qt(So),required:!1},searchType:{type:"enum",values:Qt(rp)},sort:{type:"enum",values:Qt(tp),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),!(e.startTime&&e.endTime&&e.startTime>=e.endTime)){v.next=3;break}throw new _s("startTime more than endTime",e,"timeRule");case 3:return v.next=5,this.core.sendCmd("qchatServerSearchByPage",{tag:O(O({},e),{order:e.order&&So[e.order],searchType:rp[e.searchType],sort:Tr(e)&&tp[Tr(e)],serverType:xe(e.serverType)})});case 5:return i=v.sent,o=i.content,u=o.datas,h=o.listQueryTag,v.abrupt("return",{listQueryTag:{hasMore:+h.hasMore==1,nextTimetag:it(h.nextTimetag),cursor:h.cursor},datas:Zg(u)});case 8:case"end":return v.stop()}},r,this)}))},l.serverMemberSearchByPage=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},e),u.next=3,this.core.sendCmd("qchatServerMemberSearchByPage",{tag:e});case 3:return i=u.sent,u.abrupt("return",Co(i.content.members));case 5:case"end":return u.stop()}},r,this)}))},l.generateInviteCode=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},e),u.next=3,this.core.sendCmd("qchatGenerateInviteCode",{tag:e});case 3:return i=u.sent,u.abrupt("return",Yt({expireTime:{type:"number"}},i.content.data));case 5:case"end":return u.stop()}},r,this)}))},l.joinByInviteCode=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},e),o.next=3,this.core.sendCmd("qchatJoinByInviteCode",{tag:e});case 3:case"end":return o.stop()}},r,this)}))},l.getInviteApplyRecordOfServer=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),u.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:O(O({},e),{reverse:Wi(e)?1:0})});case 3:return i=u.sent,u.abrupt("return",MC(i.content.data));case 5:case"end":return u.stop()}},r,this)}))},l.getInviteApplyRecordOfSelf=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),u.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:O(O({},e),{reverse:Wi(e)?1:0})});case 3:return i=u.sent,u.abrupt("return",MC(i.content.data));case 5:case"end":return u.stop()}},r,this)}))},l.markRead=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverIds:{type:"array",itemType:"string",required:!0}},e),v.next=3,this.core.sendCmd("qchatClearServersUnread",e);case 3:return i=v.sent,o=TC(i.content.clearServersUnreadTag),u=o.successServerIds,h=o.ackTimestamp,this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",u,h),v.abrupt("return",o);case 9:case"end":return v.stop()}},r,this)}))},l.subscribeAllChannel=function(e){var r,i;return k(this,void 0,void 0,T.mark(function o(){var u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(P({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},e),!(!((i=(r=this.core.qchatChannel)===null||r===void 0?void 0:r.config)===null||i===void 0)&&i.autoSubscribe)){_.next=3;break}throw new Ut("subscribe channel failed, manual subscribe is not allowed in auto subscribe mode.",{},403);case 3:return _.next=5,this.core.sendCmd("qchatSubscribeChannelsByServers",e,{timeout:3e4});case 5:return(h=_.sent).content.unreadInfos=Ql(h.content.unreadInfos),h.content.failServerIds=Xg(h.content.failServerIds),g={type:e.type,opeType:1,channels:se(u=h.content.unreadInfos).call(u,function(I){return{serverId:I.serverId,channelId:I.channelId}})},this.core.eventBus.emit("qchatChannel/cacheSubscribe",g),this.core.eventBus.emit("qchatChannel/getRoleIdsByServerId",e.serverIds),this.core.eventBus.emit("qchatChannel/updateUnreads",h.content.unreadInfos),_.abrupt("return",h.content);case 13:case"end":return _.stop()}},o,this)}))},l.enterAsVisitor=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return P({serverIds:{type:"array",itemType:"string",min:1}},e),g.next=3,this.core.sendCmd("qchatEnterAsVisitor",{tag:{serverIds:xe(e.serverIds)}});case 3:return i=g.sent,o=Xg(i.content.failServerIds),u=Wm(e.serverIds,o),this.core.qchatChannel.subscribeForVisitorService.cacheServer(u),g.abrupt("return",{failedServers:o});case 8:case"end":return g.stop()}},r,this)}))},l.leaveAsVisitor=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h=this;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({serverIds:{type:"array",itemType:"string",min:1}},e),v.next=3,this.core.sendCmd("qchatLeaveAsVisitor",{tag:{serverIds:xe(e.serverIds)}});case 3:return i=v.sent,o=Xg(i.content.failServerIds),u=Wm(e.serverIds,o),ae(u).call(u,function(_){h.core.qchatChannel.subscribeForVisitorService.deleteServer(_)}),v.abrupt("return",{failedServers:o});case 8:case"end":return v.stop()}},r,this)}))},l.subscribeAsVisitor=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(P({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},serverIds:{type:"array",itemType:"string",min:1}},e),!e.serverIds.length){o.next=5;break}return o.next=4,this.core.qchatChannel.subscribeForVisitorService.subscribeServerAsVisitor(e);case 4:return o.abrupt("return",o.sent);case 5:return o.abrupt("return",{failedServers:[]});case 6:case"end":return o.stop()}},r,this)}))},p}(Wl),m4=function(a){function p(t,e){var r;return(r=a.call(this,"V2NIMNotificationService",t)||this).config={compatibleWithV1:!0},r.notificationUtil=new G0(r.core),r.core._registerDep(la,"V2NIMConversationIdUtil"),r.core.options.apiVersion!=="v2"?Ot(r):(Kt({cmdMap:GL,cmdConfig:jL}),r.setOptions(e),r)}bt(p,a);var l=p.prototype;return l.setOptions=function(e){var r;!((r=this.core.systemMessage)===null||r===void 0)&&r.name?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=O(this.config,e)},l.emit=function(e){for(var r,i,o=this.name+"::emit "+e.toString(),u=arguments.length,h=new Array(u>1?u-1:0),g=1;g<u;g++)h[g-1]=arguments[g];if(e==="onReceiveCustomNotifications"){var v=h[0];this.logger.log(""+o,se(v).call(v,function(A){return"sender:"+A.senderId+";receiver:"+A.receiverId+";ctype:"+A.conversationType+";time:"+A.timestamp}))}else if(e==="onReceiveBroadcastNotifications"){var _=h[0];this.logger.log(""+o,se(_).call(_,function(A){return"id:"+A.id+";sender:"+A.senderId+";time:"+A.time}))}else{var I,C;(I=this.logger).log.apply(I,dt(C=[""+o]).call(C,h))}return(r=a.prototype.emit).call.apply(r,dt(i=[this,e]).call(i,h))},l.sendCustomNotification=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.checkV2(),Nr(this.core.account,e),P(q0,{content:r,params:i},"",!0),u=this.core.V2NIMConversationIdUtil.parseConversationType(e),h=u===3?"v2SendCustomNotificationWithSuperTeam":"v2SendCustomNotification",g=this.notificationUtil.generateNotificationTag(e,r,i),_.next=8,this.core.sendCmd(h,{tag:g});case 8:case"end":return _.stop()}},o,this)}))},l.processSystemNotification=function(e){var r=[0,1,2,3,4,15,16,17,18],i=[5,6],o=e.type;if(_t(r).call(r,o))this.core.eventBus.emit("V2NIMTeamService/sysNotification",e);else{if(!_t(i).call(i,o)){var u=O(O({},e),{conversationType:{100:1,101:2,102:1,103:3}[o]});return delete u.type,u}this.core.eventBus.emit("V2NIMFriendService/sysNotification",e)}},l.markBroadcastMsgAck=function(e){this.config.compatibleWithV1||this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:17,ids:se(e).call(e,function(r){return r.id})})},l.syncBroadcastMsgHandler=function(e){var r=e.content.datas;this.markBroadcastMsgAck(r),this.emit("onReceiveBroadcastNotifications",r)},l.onBroadcastMsgHandler=function(e){var r=e.content.data;this.markBroadcastMsgAck([r]),this.emit("onReceiveBroadcastNotifications",[r])},l.onSysNotificationHandler=function(e){var r=zi(e,e.content.data,"idServer");this.markSysNotificationAck([r]);var i=this.processSystemNotification(r);i&&this.emit("onReceiveCustomNotifications",[i])},l.v2SyncOfflineSysNotificationsHandler=function(e){var r,i,o,u=this;this.markSysNotificationAck(e.content.datas);var h=at(r=se(i=Tr(o=e.content.datas).call(o,function(g,v){return g.timestamp-v.timestamp})).call(i,function(g){return u.processSystemNotification(g)})).call(r,function(g){return g});h&&this.emit("onReceiveCustomNotifications",h)},l.v2NotificationRevokeHandler=function(e){var r=zi(e,e.content.data,"idServer");this.markSysNotificationAck([r])},l.v2NotificationSyncRevokeHandler=function(e){var r=e.content.type;it(r)===1&&this.markSysNotificationAck(e.content.datas)},l.markSysNotificationAck=function(e){if(!this.config.compatibleWithV1){var r=[],i=[],o=[15,16,17,18,103];ae(e).call(e,function(u){u.idServer&&(_t(o).call(o,u.type)?i.push(u.idServer):r.push(u.idServer))}),r.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"7",cid:"3",ids:r}),i.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"21",cid:"19",ids:i})}},p}($r),g4={"27_1":"v2NIMSync","27_10":"v2QChatSync"},v4={v2NIMSync:{sid:27,cid:1,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,p2pTeamModifyMessage:30,superTeamModifyMessage:31,filterMsgs:100}}],response:[{type:"Long",name:"timetag"}]},v2QChatSync:{sid:27,cid:10,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Long",name:"timetag"}]}},y4=function(a){function p(t){var e;return(e=a.call(this,"V2NIMSyncService",t)||this).teamKey=["teams","superTeams","myTeamMembers","mySuperTeamMembers"],e.config={},e.timetags={},e.core.options.apiVersion!=="v2"?Ot(e):(e.initEventListeners(),Kt({cmdMap:g4,cmdConfig:v4}),e)}bt(p,a);var l=p.prototype;return l.reset=function(){this.timetags={}},l.setOptions=function(e){var r=this.core,i=!(!r.V2NIMConversationService.name&&!r.V2NIMLocalConversationService.name);return this.config=O({myInfo:!!r.V2NIMUserService.name,offlineMsgs:!!r.V2NIMMessageService.name,roamingMsgs:!!r.V2NIMMessageService.name,relations:!!r.V2NIMUserService.name,friends:!!r.V2NIMFriendService.name,friendUsers:!!r.V2NIMUserService.name,msgReceipts:!!r.V2NIMMessageService.name,broadcastMsgs:!!r.V2NIMNotificationService.name,recallMsg:!!r.V2NIMMessageService.name,sessionAck:i,superTeamSessionAck:i,stickTopSessions:i,superTeamRoamingMsgs:!!r.V2NIMTeamService.name,deleteSuperTeamMsg:!!r.V2NIMTeamService.name,deleteSelfMsgs:!!r.V2NIMMessageService.name,sessionHistoryMsgsDelete:!!r.V2NIMMessageService.name,avSignal:!!r.V2NIMSignallingService.name,teams:!!r.V2NIMTeamService.name,superTeams:!!r.V2NIMTeamService.name,myTeamMembers:!!r.V2NIMTeamService.name,mySuperTeamMembers:!!r.V2NIMTeamService.name,p2pTeamModifyMessage:!!r.V2NIMMessageService.name,superTeamModifyMessage:!!r.V2NIMMessageService.name},e),this.config},l.doBasicSync=function(){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return r=pt(this.config),i=at(r).call(r,function(I){var C;return!_t(C=g.teamKey).call(C,I)&&g.config[I]}),o=this.genSyncParams(i),this.logger.log("V2Sync:basic",o),_.next=6,this.core.clientSocket.sendCmd("v2NIMSync",{tag:o});case 6:return u=_.sent,h=u.content.timetag,this.setTimetags(h,i),_.next=11,this.delaySyncDone();case 11:return _.next=13,this.handleImmediate();case 13:this.core.logger.log("sync::basic sync complete in",h);case 14:case"end":return _.stop()}},e,this)}))},l.doTeamSync=function(){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u,h,g=this;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if((i=at(r=this.teamKey).call(r,function(I){return g.config[I]})).length!==0){_.next=3;break}return _.abrupt("return");case 3:return o=this.genSyncParams(i),this.core.eventBus.emit("V2NIMTeamService/onSyncStarted"),this.logger.log("V2Sync:team",o),u=null,_.prev=7,_.next=10,this.core.clientSocket.sendCmd("v2NIMSync",{tag:o});case 10:u=_.sent,_.next=17;break;case 13:throw _.prev=13,_.t0=_.catch(7),this.core.eventBus.emit("V2NIMTeamService/onSyncFailed",_.t0),_.t0;case 17:this.core.eventBus.emit("V2NIMTeamService/onSyncFinished"),h=u.content.timetag,this.setTimetags(h,this.teamKey),this.core.logger.log("sync::team sync complete in",h);case 21:case"end":return _.stop()}},e,this,[[7,13]])}))},l.doQchatSync=function(){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.clientSocket.sendCmd("v2QChatSync",{tag:{systemNotification:0}});case 2:r=o.sent,this.core.logger.log("sync::qchat sync complete in",r.content.timetag);case 4:case"end":return o.stop()}},e,this)}))},l.doSync=function(){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if((r=Pe(this.core,"V2NIMLoginService.authenticator.loginClientOfThisConnection.loginType"))!==void 0){o.next=4;break}return this.logger.warn("sync::doSync: no loginType, stop sync"),o.abrupt("return");case 4:if(this.logger.log("sync::doSync:type "+r),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:2,subType:"mainSync"}),r!==1){o.next=20;break}return o.prev=7,o.next=10,this.doBasicSync();case 10:return o.next=12,this.doTeamSync();case 12:o.next=18;break;case 14:return o.prev=14,o.t0=o.catch(7),this.doSyncComplete(o.t0),o.abrupt("return");case 18:o.next=49;break;case 20:if(r!==2){o.next=32;break}return o.prev=21,o.next=24,this.doQchatSync();case 24:o.next=30;break;case 26:return o.prev=26,o.t1=o.catch(21),this.doSyncComplete(o.t1),o.abrupt("return");case 30:o.next=49;break;case 32:if(r!==3){o.next=48;break}return o.prev=33,o.next=36,this.doBasicSync();case 36:return o.next=38,this.doTeamSync();case 38:return o.next=40,this.doQchatSync();case 40:o.next=46;break;case 42:return o.prev=42,o.t2=o.catch(33),this.doSyncComplete(o.t2),o.abrupt("return");case 46:o.next=49;break;case 48:return o.abrupt("return");case 49:this.doSyncComplete();case 50:case"end":return o.stop()}},e,this,[[7,14],[21,26],[33,42]])}))},l.doSyncComplete=function(e){e&&this.core.logger.log("sync::doSync complete but got error",e),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:e,subType:"mainSync"})},l.initEventListeners=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",function(){e.doSync()})},l.genSyncParams=function(e){var r=this;return Cr(e).call(e,function(i,o){var u=o;return i[u]=r.timetags[u]||0,i},{})},l.setTimetags=function(e,r){var i=this;ae(r).call(r,function(o){i.timetags[o]=e})},l.handleImmediate=function(){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),He.resolve()},l.delaySyncDone=function(){return Zm()==="ALI"?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new He(function(e){or(function(){e()},100)})):He.resolve()},p}($r),_4=function(){function a(){this.aiStreamMap=new Dr}var p=a.prototype;return p.reset=function(){this.aiStreamMap.clear()},p.getAiStream=function(t){return this.aiStreamMap.get(t)},p.getAiStreamIsComplete=function(t){var e=this.aiStreamMap.get(t);return!e||e.isComplete},p.getAiStreamQueryStatus=function(t){var e=this.aiStreamMap.get(t);return e?e.queryStatus:0},p.upsertAiStreamChunks=function(t,e,r){var i=this.aiStreamMap.get(t);return i&&!i.isComplete&&(i.chunks[e]=r),i||{isComplete:!1,queryStatus:0,chunks:[]}},p.setAiStream=function(t,e,r){r===void 0&&(r=!1);var i=this.aiStreamMap.get(t);return i?this.aiStreamMap.set(t,O(O({},i),e)):r&&this.aiStreamMap.set(t,O({isComplete:!1,queryStatus:0,chunks:[]},e)),this.aiStreamMap.get(t)||{isComplete:!1,queryStatus:0,chunks:[]}},p.completeAiStream=function(t){var e=this.aiStreamMap.get(t);e&&this.aiStreamMap.set(t,O(O({},e),{isComplete:!0,queryStatus:0,chunks:[],aiRAGs:void 0}))},a}(),No="V2NIMAIService",M4={"4_26":"v2AIChatNotify","29_35":"v2AIProxyModelCall","29_36":"v2AIGetUserList","4_29":"v2AIOnStreamMessageChunk","4_30":"v2AIChatStreamNotify","29_38":"v2AIStopModelStreamCall","29_39":"v2AIStreamQuery","29_40":"v2AIRegenMessage"},T4={accountId:1,messages:{id:2,converter:xi,retConverter:lo},requestId:3,content:{id:4,converter:xi,retConverter:lo},promptVariables:5,modelConfigParams:{id:6,converter:xi,retConverter:lo},antispamBusinessId:7,antispamEnabled:{id:8,converter:Zt},aiStream:{id:9,converter:Zt}},I4={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,modelType:{id:11,retType:"number"},modelConfig:{id:12,retConverter:function(p){if(p=lo(p)){var l=pt(p),t=Cr(l).call(l,function(e,r){var i=function(u){var h;return se(h=(u=u||"").split("_")).call(h,function(g,v){return v===0?g:g[0].toUpperCase()+ht(g).call(g,1)}).join("")}(r);return e[i]=p[r],e},{});if(typeof t.promptKeys=="string")try{t.promptKeys=JSON.parse(t.promptKeys)}catch{}return t}}},yunxinConfig:{id:13,retConverter:function(p){if(p=lo(p))return p}},valid:{id:14,retType:"boolean"},createTime:{id:15,retType:"number"},updateTime:{id:16,retType:"number"}};function LC(a){try{var p=JSON.parse(a);return typeof p.index=="number"?{msg:p.msg||"",type:p.type,lastChunk:{content:p.msg,chunkTime:it(p.timestamp),type:p.type,index:it(p.index)}}:p}catch{return}}function VC(a){try{var p=JSON.parse(a);return p&&p.length>0?se(p).call(p,function(l){return l.description=l.desc,delete l.desc,l}):[]}catch{return[]}}var DC={code:{id:1,retType:"number"},accountId:2,requestId:3,content:{id:4,retConverter:LC},aiRAGs:{id:5,retConverter:VC},timestamp:{id:6,retType:"number"},aiStreamStatus:{id:7,retType:"number"},aiStream:{id:8,retType:"boolean"}},S4={serverId:1,clientId:2,type:{id:3,retType:"number"},from:4,to:5,aiAccount:6,startIndex:{id:7,retType:"number"},endIndex:{id:8,retType:"number"},excludeIndex:{id:9,converter:xi}},E4={serverId:1,clientId:2,type:{id:3,retType:"number"},content:{id:4,retConverter:LC},aiRAGs:{id:6,retConverter:VC}},C4={v2AIChatNotify:{sid:4,cid:26,service:No,response:[{type:"Property",name:"data",reflectMapper:Te(DC)}]},v2AIProxyModelCall:{sid:29,cid:35,service:No,params:[{type:"Property",name:"tag",reflectMapper:T4}]},v2AIGetUserList:{sid:29,cid:36,service:No,params:[{type:"Property",name:"tag",reflectMapper:{pageToken:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(I4)},{type:"Property",name:"queryTag",reflectMapper:Te({hasMore:{id:16,retType:"boolean"},nextToken:2})}]},v2AIOnStreamMessageChunk:{sid:4,cid:29,service:No,response:[{type:"Property",name:"msg",reflectMapper:Te(Rt)}]},v2AIChatStreamNotify:{sid:4,cid:30,service:No,response:[{type:"Property",name:"data",reflectMapper:Te(DC)}]},v2AIStopModelStreamCall:{sid:29,cid:38,service:No,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,clientId:2,type:{id:3,retType:"number"},from:4,to:5,aiAccount:6,opeType:{id:7,retType:"number"},updateContent:{id:8},messageTime:{id:11,retType:"number"}}}]},v2AIStreamQuery:{sid:29,cid:39,service:No,params:[{type:"Property",name:"tag",reflectMapper:S4}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(E4)}]},v2AIRegenMessage:{sid:29,cid:40,service:No,params:[{type:"Property",name:"tag",reflectMapper:{fromAccount:1,to:2,aiAccount:3,serverId:4,clientId:5,time:{id:6,retType:"number"},type:{id:7,retType:"number"},opeType:{id:8,retType:"number"},replyMsgFromAccount:9,replyMsgToAccount:10,replyMsgTime:{id:11,retType:"number"},replyMsgIdServer:12,replyMsgIdClient:13}}]}},b4=function(){function a(l,t){this.core=l,this.service=t,this.logger=this.core.logger}var p=a.prototype;return p.setListener=function(){},p.beforeEmit=function(t){for(var e,r,i=this.service.name+"::emit "+t.toString(),o=arguments.length,u=new Array(o>1?o-1:0),h=1;h<o;h++)u[h-1]=arguments[h];if(t==="onProxyAIModelCall"){var g=u[0];this.logger.log(""+i,"requestId:"+g.requestId+";aiStreamStatus:"+g.aiStreamStatus)}else if(t==="onProxyAIModelStreamCall"){var v=u[0];this.logger.log(""+i,"requestId:"+v.requestId+";chunkIndex:"+((e=v.content)===null||e===void 0?void 0:e.lastChunk.index)+";chunkTime:"+((r=v.content)===null||r===void 0?void 0:r.lastChunk.chunkTime))}else{var _,I;(_=this.logger).log.apply(_,dt(I=[""+i]).call(I,u))}},a}(),A4=function(){function a(l,t){this.core=l,this.service=t,this.model=t.model,this.logger=this.core.logger}var p=a.prototype;return p.v2AIChatNotifyHandler=function(t){var e=t.content.data;e&&e.requestId&&(this.model.completeAiStream(e.requestId),e.aiStreamStatus=e.aiStreamStatus||0,e.aiStream=e.aiStream||!1,e.content&&(e.content.msg=e.content.msg||""),this.service.emit("onProxyAIModelCall",e))},p.v2AIChatStreamNotifyHandler=function(t){var e=t.content.data;if(e&&e.requestId&&e.content&&e.content.msg){var r=this.model.getAiStream(e.requestId);if(r||(r=this.model.setAiStream(e.requestId,{isComplete:!1,queryStatus:0,chunks:[]},!0)),!r.isComplete){var i=e.content.lastChunk;if(i.index===0&&e.aiRAGs&&(r=this.model.setAiStream(e.requestId,{aiRAGs:e.aiRAGs})),this.logger.log("V2AI::streamNotify requestId:"+e.requestId+";index:"+i.index+";cacheChunkLength:"+r.chunks.length+";chunkTime:"+i.chunkTime+"."),r.chunks.length===0&&i.index>0)this.logger.log("V2AI::streamNotify requestId:"+e.requestId+";chunks missing 0,currentIdx:"+i.index+",needQuery:"+(r.queryStatus===0)+"."),r.queryStatus===0&&(r=this.model.setAiStream(e.requestId,{queryStatus:1}),this.service._queryAiStream({clientId:e.requestId,type:4,from:this.core.account,aiAccount:e.accountId,startIndex:0,endIndex:i.index-1}));else if(i.index>0&&r.chunks.length>0&&r.chunks[i.index-1]===void 0){var o,u=Cr(o=r.chunks).call(o,function(h,g,v){return g!==void 0&&h.push(v),h},[]);this.logger.log("V2AI::streamNotify requestId:"+e.requestId+";out of order,currenIdx:"+i.index+",cacheIdx:["+u.join(",")+"],needReport:"+!r.hasReported+"."),r.hasReported||(r=this.model.setAiStream(e.requestId,{hasReported:!0}),this.reportOutOfOrder({requestId:e.requestId,cacheIds:u,targetIndex:i.index,target:"4-30"}))}(r=this.model.upsertAiStreamChunks(e.requestId,i.index,i.content)).chunks[0]||r.queryStatus!==1?(e.content.msg=r.chunks.join(""),r.aiRAGs&&(e.aiRAGs=r.aiRAGs),this.service.emit("onProxyAIModelStreamCall",e)):this.logger.log("V2AI::streamNotify requestId:"+e.requestId+";chunks ignore index:"+i.index+";queryStatus:"+r.queryStatus+".")}}},p.v2AIOnStreamMessageChunkHandler=function(t){var e=Xi(pn(this.core,t.content.msg),this.core);if(e.aiConfig&&e.aiConfig.accountId&&e.aiConfig.aiStreamLastChunk){var r=this.model.getAiStream(e.messageClientId);if(!r||!r.isComplete){r||(r=this.model.setAiStream(e.messageClientId,{isComplete:!1,queryStatus:0,chunks:[]},!0));var i=e.aiConfig.aiStreamLastChunk,o=e.messageClientId;if(i.index===0&&e.aiConfig.aiRAGs&&(r=this.model.setAiStream(o,{aiRAGs:e.aiConfig.aiRAGs})),this.logger.log("V2AI::aiStream requestId:"+o+";index:"+i.index+";cacheChunkLength:"+r.chunks.length+";chunkTime:"+i.chunkTime+"."),r.chunks.length===0&&i.index>0)this.logger.log("V2AI::msg:aiStream requestId:"+o+";chunks missing 0,currentIdx:"+i.index+",needQuery:"+(r.queryStatus===0)+"."),r.queryStatus===0&&(r=this.model.setAiStream(o,{queryStatus:1}),this.service._queryAiStream({serverId:e.messageServerId,clientId:o,type:e.conversationType,from:e.senderId,to:e.receiverId,aiAccount:e.aiConfig.accountId,startIndex:0,endIndex:i.index-1}));else if(i.index>0&&r.chunks.length>0&&r.chunks[i.index-1]===void 0){var u,h=Cr(u=r.chunks).call(u,function(g,v,_){return v!==void 0&&g.push(_),g},[]);this.logger.log("V2AI::msg:aiStream requestId:"+o+";out of order,currenIdx:"+i.index+";streamCache.chunks:"+xe(r.chunks)+",cacheIdx:["+h.join(",")+"],needReport:"+!r.hasReported+"."),r.hasReported||(r=this.model.setAiStream(o,{hasReported:!0}),this.reportOutOfOrder({requestId:o,cacheIds:h,targetIndex:i.index,target:"4-29"}))}(r=this.model.upsertAiStreamChunks(o,i.index,i.content)).chunks[0]||r.queryStatus!==1?(e.aiConfig.aiStreamStatus=-1,e.text=r.chunks.join(""),r.aiRAGs&&(e.aiConfig.aiRAGs=r.aiRAGs),r.msg&&(e=O({},r.msg,{text:e.text,modifyTime:i.chunkTime,modifyAccountId:r.msg.senderId,aiConfig:e.aiConfig})),this.core.eventBus.emit("V2NIMAIService/receiveMessagesModified",[e])):this.logger.log("V2AI::msg:callStream requestId:"+o+";chunks ignore index:"+i.index+";queryStatus:"+r.queryStatus+".")}}},p.reportOutOfOrder=function(t){this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.account,trace_id:Pe(this.core,"clientSocket.socket.sessionId"),action:2,exception_service:0}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:0,context:t.requestId,description:"["+t.cacheIds.join(",")+"],"+t.targetIndex,operation_type:2,target:t.target,net_connect:!0}),this.core.reporter.reportTraceEnd("exceptions",4)},a}(),R4=function(a){function p(t){var e;return(e=a.call(this,"V2NIMAIService",t)||this).model=new _4,e.event=new b4(e.core,Ot(e)),e.handler=new A4(e.core,Ot(e)),Kt({cmdMap:M4,cmdConfig:C4}),e}bt(p,a);var l=p.prototype;return l.setListener=function(){this.event.setListener()},l.reset=function(){this.model.reset()},l.emit=function(e){for(var r,i,o,u,h=arguments.length,g=new Array(h>1?h-1:0),v=1;v<h;v++)g[v-1]=arguments[v];return(r=this.event).beforeEmit.apply(r,dt(i=[e]).call(i,g)),(o=a.prototype.emit).call.apply(o,dt(u=[this,e]).call(u,g))},l.getAIUserList=function(){return k(this,void 0,void 0,T.mark(function e(){var r;return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.checkV2(),o.next=3,this.core.sendCmd("v2AIGetUserList",{tag:{}});case 3:return r=o.sent,o.abrupt("return",r.content.datas);case 5:case"end":return o.stop()}},e,this)}))},l.proxyAIModelCall=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(P(aL,e,"",!0),!this.model.getAiStream(e.requestId)){o.next=6;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,desc:"Same requestId",detail:{rawData:e.requestId}});case 6:this.model.setAiStream(e.requestId,{isComplete:!1,queryStatus:0,chunks:[]},!0);case 7:return o.next=9,this.core.sendCmd("v2AIProxyModelCall",{tag:e});case 9:case"end":return o.stop()}},r,this)}))},l.stopAIModelStreamCall=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return P(cL,e,"",!0),o.next=3,this.core.sendCmd("v2AIStopModelStreamCall",{tag:{clientId:e.requestId,aiAccount:e.accountId,type:4,from:this.core.account}});case 3:this.logger.log("V2AI::streamCallStop,requestId:"+e.requestId),this.model.completeAiStream(e.requestId);case 5:case"end":return o.stop()}},r,this)}))},l._queryAiStream=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u=this;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.model.setAiStream(e.clientId,{queryStatus:1}),g.prev=1,g.next=4,this.core.sendCmd("v2AIStreamQuery",{tag:e});case 4:if(i=g.sent,this.model.setAiStream(e.clientId,{queryStatus:2}),(o=i.content.datas)&&o.length>0){g.next=9;break}return g.abrupt("return");case 9:ae(o).call(o,function(v){var _=v.clientId,I=u.model.getAiStream(_);if(I&&(!I||!I.isComplete)&&v.content&&v.content.lastChunk){var C=v.content.lastChunk;u.model.upsertAiStreamChunks(_,C.index,C.content),C.index===0&&v.aiRAGs&&u.model.setAiStream(_,{aiRAGs:v.aiRAGs}),u.logger.log("V2AI::queryAiStream requestId:"+_+";index:"+C.index+";cacheChunkLength:"+I.chunks.length+";chunkTime:"+C.chunkTime+".")}}),g.next=16;break;case 12:g.prev=12,g.t0=g.catch(1),this.logger.warn("V2AI::queryAiStream requestId:"+e.clientId+";error:",g.t0),this.model.setAiStream(e.clientId,{queryStatus:2});case 16:case"end":return g.stop()}},r,this,[[1,12]])}))},p}($r),N4={"18_1":"v2SignallingCreateRoom","18_2":"v2SignallingDelayRoom","18_3":"v2SignallingCloseRoom","18_4":"v2SignallingJoinRoom","18_5":"v2SignallingLeaveRoom","18_6":"v2SignallingInvite","18_7":"v2SignallingCancelInvite","18_16":"v2SignallingCall","18_17":"v2SignallingCallSetup","18_8":"v2SignallingRejectInvite","18_9":"v2SignallingAcceptInvite","18_10":"v2SignallingSendControl","15_11":"v2SignallingOnlineEvent","15_12":"v2SignallingMultiClientEvent","15_13":"v2SignallingOfflineEvent","15_14":"v2SignallingSyncChannels","18_15":"v2SignallingGetRoomInfo"},ln="V2NIMSignallingService",k4={accountId:1,uid:{id:2,retType:"number"},joinTime:{id:3,retType:"number"},expireTime:{id:4,retType:"number"},deviceId:5},Ar={channelType:{id:1,retType:"number",retAccess:"channelInfo.channelType"},channelName:{id:2,retAccess:"channelInfo.channelName"},channelId:{id:3,retAccess:"channelInfo.channelId"},createTime:{id:4,retType:"number",retAccess:"channelInfo.createTime"},expireTime:{id:5,retType:"number",retAccess:"channelInfo.expireTime"},creatorAccountId:{id:6,retAccess:"channelInfo.creatorAccountId"},channelExtension:{id:7,retAccess:"channelInfo.channelExtension"},channelValid:{id:8,retDef:!0,retAccess:"channelInfo.channelValid",retConverter:function(p){return it(p)!==1}},fromAccid:10,toAccid:11,requestId:12,pushEnabled:{id:13,access:"pushConfig.pushEnabled",converter:Zt,retType:"boolean"},pushTitle:{id:14,access:"pushConfig.pushTitle"},pushContent:{id:15,access:"pushConfig.pushContent"},pushPayload:{id:16,access:"pushConfig.pushPayload"},unreadEnabled:{id:17,access:"signallingConfig.unreadEnabled",converter:Zt,retType:"boolean",def:1},members:{id:18,retAccess:"members",retConverter:function(p){try{var l=JSON.parse(p);return se(l).call(l,function(t){return xt(t,Te(k4))})}catch{return}}},attach:{id:19,retConverter:lo},serverExtension:{id:20,retDef:""},offlineEnabled:{id:21,converter:Zt,retType:"boolean",def:1},msgId:22,selfUid:{id:23,retType:"number",access:"signallingConfig.selfUid"},time:{id:24,retType:"number"},rtcChannelName:{id:25,access:"rtcConfig.rtcChannelName"},rtcTokenTtl:{id:26,retType:"number",access:"rtcConfig.rtcTokenTtl",retAccess:"rtcInfo.rtcTokenTtl"},rtcToken:{id:27,retAccess:"rtcInfo.rtcToken"},rtcParams:{id:28,access:"rtcConfig.rtcParams",retAccess:"rtcInfo.rtcParams"},callStatus:{id:30,retType:"number"}},O4={v2SignallingCall:{sid:18,cid:16,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}],response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingCallSetup:{sid:18,cid:17,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}],response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingCreateRoom:{sid:18,cid:1,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}],response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingDelayRoom:{sid:18,cid:2,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}],response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingCloseRoom:{sid:18,cid:3,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}],response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingJoinRoom:{sid:18,cid:4,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}],response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingLeaveRoom:{sid:18,cid:5,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}],response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingInvite:{sid:18,cid:6,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}],response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingCancelInvite:{sid:18,cid:7,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}],response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingRejectInvite:{sid:18,cid:8,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}]},v2SignallingAcceptInvite:{sid:18,cid:9,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}]},v2SignallingSendControl:{sid:18,cid:10,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}]},v2SignallingOnlineEvent:{sid:15,cid:11,service:ln,response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingMultiClientEvent:{sid:15,cid:12,service:ln,response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingOfflineEvent:{sid:15,cid:13,service:ln,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(Ar)}]},v2SignallingSyncChannels:{sid:15,cid:14,service:ln,response:[{type:"PropertyArray",name:"datas",reflectMapper:Te(Ar)}]},v2SignallingGetRoomInfo:{sid:18,cid:15,service:ln,params:[{type:"Property",name:"tag",reflectMapper:Ar}],response:[{type:"Property",name:"data",reflectMapper:Te(Ar)}]},v2SignallingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:ln,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},w4={calleeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},channelType:{type:"enum",values:[1,3,2]},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},x4={channelId:{type:"string",required:!0,allowEmpty:!1},callerAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},P4={channelType:{type:"enum",values:[1,3,2]},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0}},L4={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},V4={channelId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},D4={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},U4={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}}},F4={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},B4={channelId:{type:"string",allowEmpty:!1},receiverAccountId:{type:"string",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},UC={channelId:{type:"string",allowEmpty:!1},inviterAccountId:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},q4=UC;function cv(a){var p,l=a.attach,t={eventType:l.type,channelInfo:a.channelInfo,operatorAccountId:a.fromAccid,time:a.time,serverExtension:a.serverExtension,requestId:a.requestId,pushConfig:a.pushConfig,unreadEnabled:(p=a.signallingConfig)===null||p===void 0?void 0:p.unreadEnabled},e=a.fromAccid,r=a.toAccid;switch(t.eventType){case 1:break;case 2:t.member={accountId:l.member[1],uid:Number(l.member[2]),joinTime:Number(l.member[3]),expireTime:Number(l.member[4]),deviceId:l.member[5]};break;case 3:case 4:t.operatorAccountId=e,t.inviteeAccountId=r,t.inviterAccountId=e;break;case 5:case 6:t.operatorAccountId=e,t.inviterAccountId=r,t.inviteeAccountId=e}return JSON.parse(xe(t))}var Ls,G4=function(a){function p(t,e){var r;return e===void 0&&(e={}),(r=a.call(this,"V2NIMSignallingService",t)||this).config={compatibleWithV1:!0},r.channels={},r.timer=0,r.pollingInterval=12e4,r.core.options.apiVersion!=="v2"?Ot(r):(Kt({cmdMap:N4,cmdConfig:O4}),r.setOptions(e),r)}bt(p,a);var l=p.prototype;return l.reset=function(){this.timer=0,this.channels={}},l.setOptions=function(e){var r;!((r=this.core.signaling)===null||r===void 0)&&r.name?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=O(this.config,e)},l.emit=function(e){for(var r,i,o,u,h=this.name+"::emit "+e.toString(),g=arguments.length,v=new Array(g>1?g-1:0),_=1;_<g;_++)v[_-1]=arguments[_];return(r=this.logger).log.apply(r,dt(i=[""+h]).call(i,v)),(o=a.prototype.emit).call.apply(o,dt(u=[this,e]).call(u,v))},l.call=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g;return T.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(this.checkV2(),P(w4,e,"",!0),e.calleeAccountId!==this.core.account){_.next=4;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"You cannot call yourself"}});case 4:return o=e.pushConfig!==void 0&&e.pushConfig.pushEnabled!==void 0&&e.pushConfig.pushEnabled,_.next=7,this.core.sendCmd("v2SignallingCall",{tag:O(O({},e),{toAccid:e.calleeAccountId,offlineEnabled:((r=e.signallingConfig)===null||r===void 0?void 0:r.offlineEnabled)===void 0||e.signallingConfig.offlineEnabled,pushConfig:O(O({},e.pushConfig||{}),{pushEnabled:o})})});case 7:return u=_.sent,h=u.content.data,this.channels[h.channelInfo.channelId]=En(h.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(et(g=this.aotoDelay).call(g,this),this.pollingInterval,-1)),_.abrupt("return",{callStatus:h.callStatus,rtcInfo:h.rtcInfo,roomInfo:{channelInfo:h.channelInfo,members:h.members}});case 12:case"end":return _.stop()}},i,this)}))},l.callSetup=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.checkV2(),P(x4,e,"",!0),e.callerAccountId!==this.core.account){v.next=4;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"callSetup: cannot be yourself"}});case 4:return v.next=6,this.core.sendCmd("v2SignallingCallSetup",{tag:O(O({},e),{toAccid:e.callerAccountId,offlineEnabled:((r=e.signallingConfig)===null||r===void 0?void 0:r.offlineEnabled)===void 0||e.signallingConfig.offlineEnabled})});case 6:return o=v.sent,u=o.content.data,this.channels[u.channelInfo.channelId]=En(u.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(et(h=this.aotoDelay).call(h,this),this.pollingInterval,-1)),v.abrupt("return",{callStatus:u.callStatus,rtcInfo:u.rtcInfo,roomInfo:{channelInfo:u.channelInfo,members:u.members}});case 11:case"end":return v.stop()}},i,this)}))},l.createRoom=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){var u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),P(P4,{channelType:e,channelName:r,channelExtension:i},"",!0),g.next=4,this.core.sendCmd("v2SignallingCreateRoom",{tag:{channelType:e,channelName:r,channelExtension:i}});case 4:return u=g.sent,g.abrupt("return",u.content.data.channelInfo);case 6:case"end":return g.stop()}},o,this)}))},l.delayRoom=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkV2(),u.next=3,this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:e}});case 3:return i=u.sent,u.abrupt("return",{channelInfo:i.content.data.channelInfo,members:i.content.data.members});case 5:case"end":return u.stop()}},r,this)}))},l.closeRoom=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P(L4,{channelId:e,offlineEnabled:r,serverExtension:i},"",!0),h.next=4,this.core.sendCmd("v2SignallingCloseRoom",{tag:{channelId:e,offlineEnabled:r!==void 0&&r,serverExtension:i}});case 4:case"end":return h.stop()}},o,this)}))},l.joinRoom=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u,h,g,v,_;return T.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return this.checkV2(),P(V4,e,"",!0),C.next=4,this.core.sendCmd("v2SignallingJoinRoom",{tag:O(O({},e),{offlineEnabled:((r=e.signallingConfig)===null||r===void 0?void 0:r.offlineEnabled)===void 0||e.signallingConfig.offlineEnabled})});case 4:return o=C.sent,u=o.content.data,this.channels[u.channelInfo.channelId]=En(u.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(et(h=this.aotoDelay).call(h,this),this.pollingInterval,-1)),g=u.channelInfo,v=u.members,_=u.rtcInfo,C.abrupt("return",{roomInfo:{channelInfo:g,members:v},rtcInfo:_});case 10:case"end":return C.stop()}},i,this)}))},l.leaveRoom=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),P(D4,{channelId:e,offlineEnabled:r,serverExtension:i},"",!0),h.next=4,this.core.sendCmd("v2SignallingLeaveRoom",{tag:{channelId:e,offlineEnabled:r!==void 0&&r,serverExtension:i}});case 4:delete this.channels[e];case 5:case"end":return h.stop()}},o,this)}))},l.invite=function(e){var r;return k(this,void 0,void 0,T.mark(function i(){var o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.checkV2(),P(U4,e,"",!0),e.inviteeAccountId!==this.core.account){g.next=4;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"invite: cannot be yourself"}});case 4:return o=e.pushConfig!==void 0&&e.pushConfig.pushEnabled!==void 0&&e.pushConfig.pushEnabled,g.next=7,this.core.sendCmd("v2SignallingInvite",{tag:O(O({},e),{toAccid:e.inviteeAccountId,offlineEnabled:((r=e.signallingConfig)===null||r===void 0?void 0:r.offlineEnabled)===void 0||e.signallingConfig.offlineEnabled,pushConfig:O(O({},e.pushConfig||{}),{pushEnabled:o})})});case 7:return u=g.sent,g.abrupt("return",u.content.data);case 9:case"end":return g.stop()}},i,this)}))},l.cancelInvite=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkV2(),P(F4,e,"",!0),u.next=4,this.core.sendCmd("v2SignallingCancelInvite",{tag:O(O({},e),{toAccid:e.inviteeAccountId})});case 4:return i=u.sent,u.abrupt("return",i.content.data);case 6:case"end":return u.stop()}},r,this)}))},l.rejectInvite=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(P(UC,e,"",!0),e.inviterAccountId!==this.core.account){o.next=3;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"rejectInvite: cannot be yourself"}});case 3:return o.next=5,this.core.sendCmd("v2SignallingRejectInvite",{tag:O(O({},e),{toAccid:e.inviterAccountId})});case 5:case"end":return o.stop()}},r,this)}))},l.acceptInvite=function(e){return k(this,void 0,void 0,T.mark(function r(){return T.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(P(q4,e,"",!0),e.inviterAccountId!==this.core.account){o.next=3;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"acceptInvite: cannot be yourself"}});case 3:return o.next=5,this.core.sendCmd("v2SignallingAcceptInvite",{tag:O(O({},e),{toAccid:e.inviterAccountId})});case 5:case"end":return o.stop()}},r,this)}))},l.sendControl=function(e,r,i){return k(this,void 0,void 0,T.mark(function o(){return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P(B4,{channelId:e,receiverAccountId:r,serverExtension:i},"",!0),h.next=3,this.core.sendCmd("v2SignallingSendControl",{tag:{channelId:e,toAccid:r,serverExtension:i}});case 3:case"end":return h.stop()}},o,this)}))},l.getRoomInfoByChannelName=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h;return T.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return P({channelName:{type:"string",allowEmpty:!1}},{channelName:e},"",!0),v.next=3,this.core.sendCmd("v2SignallingGetRoomInfo",{tag:{channelName:e}});case 3:return i=v.sent,o=i.content.data,u=o.members,h=o.channelInfo,v.abrupt("return",{channelInfo:h,members:u||[]});case 6:case"end":return v.stop()}},r,this)}))},l.aotoDelay=function(){return k(this,void 0,void 0,T.mark(function e(){var r,i,o,u;return T.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if((r=pt(this.channels)).length!==0){g.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,g.abrupt("return");case 5:this.logger.log("v2Signlling:autoDelay",r),i=0;case 7:if(!(i<r.length)){g.next=23;break}return o=r[i],g.prev=9,g.next=12,this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:o}});case 12:u=g.sent,this.channels[o]=u.content.data.channelInfo,g.next=20;break;case 16:g.prev=16,g.t0=g.catch(9),this.logger.warn("signling:autoDelay "+o+" failed",g.t0),delete this.channels[o];case 20:i++,g.next=7;break;case 23:case"end":return g.stop()}},e,this,[[9,16]])}))},l.v2SignallingOnlineEventHandler=function(e){var r=zi(e,e.content.data,"msgId","0"),i=r.msgId;!this.config.compatibleWithV1&&i&&it(i)&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:[i]}),this.emit("onOnlineEvent",cv(r))},l.v2SignallingMultiClientEventHandler=function(e){this.emit("onMultiClientEvent",cv(e.content.data))},l.v2SignallingOfflineEventHandler=function(e){var r;if(e.content.datas&&e.content.datas.length>0){if(!this.config.compatibleWithV1){var i,o=se(i=e.content.datas).call(i,function(h){return h.msgId});o.length>0&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:o})}var u=se(r=e.content.datas).call(r,function(h){return cv(h)});this.emit("onOfflineEvent",u)}},l.v2SignallingSyncChannelsHandler=function(e){var r=this;if(this.timer=0,this.channels={},e.content.datas&&e.content.datas.length>0){var i,o=e.content.datas;ae(o).call(o,function(u){var h=u.channelInfo.channelId;r.channels[h]=En(u.channelInfo)}),!this.timer&&(this.timer=this.core.timerManager.addTimer(et(i=this.aotoDelay).call(i,this),this.pollingInterval,-1)),this.emit("onSyncRoomInfoList",o)}},p}($r),j4={"19_1":"v2PublishEvent","14_2":"v2OnUserStatusChange","19_3":"v2SubscribeUserStatus","19_4":"v2UnsubscribeUserStatus","19_5":"v2UnsubscribeAllUserStatus","19_6":"v2QuerySubscribeEvent","19_7":"v2QueryAllSubscribeEvent","14_9":"v2OnMultiUserStatusChange"},ko="V2NIMSubscriptionService",lp={eventType:{id:1,retType:"number"},statusType:{id:2,retType:"number"},uniqueId:3,extension:4,duration:{id:5,retType:"number"},onlineOnly:{id:6,retType:"boolean",converter:function(p){return p?1:2}},multiSync:{id:7,retType:"boolean",converter:Zt},publishTime:{id:10,retType:"number"},serverId:11,clientType:{id:12,retType:"number"},serverExtension:13,extensionReceived:14,accountId:103},Sa={eventType:{id:1,retType:"number"},duration:{id:2,retType:"number"},immediateSync:{id:3,retType:"number",converter:Zt},accountId:102,subscribeTime:{id:105,retType:"number"}},H4={v2PublishEvent:{sid:19,cid:1,service:ko,params:[{type:"Property",name:"tag",reflectMapper:lp}],response:[{type:"Property",name:"data",reflectMapper:Te(lp)}]},v2OnUserStatusChange:{sid:14,cid:2,service:ko,response:[{type:"Property",name:"data",reflectMapper:Te(lp)}]},v2SubscribeUserStatus:{sid:19,cid:3,service:ko,params:[{type:"Property",name:"tag",reflectMapper:Sa},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeUserStatus:{sid:19,cid:4,service:ko,params:[{type:"Property",name:"tag",reflectMapper:Sa},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeAllUserStatus:{sid:19,cid:5,service:ko,params:[{type:"Property",name:"tag",reflectMapper:Sa}]},v2QuerySubscribeEvent:{sid:19,cid:6,service:ko,params:[{type:"Property",name:"tag",reflectMapper:Sa},{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:Te(Sa)}]},v2QueryAllSubscribeEvent:{sid:19,cid:7,service:ko,params:[{type:"Property",name:"tag",reflectMapper:Sa}],response:[{type:"PropertyArray",name:"data",reflectMapper:Te(Sa)}]},v2OnMultiUserStatusChange:{sid:14,cid:9,service:ko,response:[{type:"PropertyArray",name:"data",reflectMapper:Te(lp)}]}},$4={accountIds:{type:"array",required:!0,itemType:"string",min:1,max:100},duration:{type:"number",required:!1,min:60,max:2592e3},immediateSync:{type:"boolean",required:!1}},K4={accountIds:{type:"array",required:!1,itemType:"string",max:100}},Y4={statusType:{type:"number",required:!0,min:1e4,max:2147483647},duration:{type:"number",required:!1,min:60,max:604800},extension:{type:"jsonstr",required:!1},onlineOnly:{type:"boolean",required:!1},multiSync:{type:"boolean",required:!1}},W4=function(a){function p(t){var e;return(e=a.call(this,"V2NIMSubscriptionService",t)||this).core.options.apiVersion!=="v2"?Ot(e):(Kt({cmdMap:j4,cmdConfig:H4}),e)}bt(p,a);var l=p.prototype;return l.emit=function(e){for(var r,i,o,u,h=this.name+"::emit "+e.toString(),g=arguments.length,v=new Array(g>1?g-1:0),_=1;_<g;_++)v[_-1]=arguments[_];return(r=this.logger).log.apply(r,dt(i=[""+h]).call(i,v)),(o=a.prototype.emit).call.apply(o,dt(u=[this,e]).call(u,v))},l.subscribeUserStatus=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkLogin(),this.checkV2(),P($4,e,"",!0),u.next=5,this.core.sendCmd("v2SubscribeUserStatus",{tag:{eventType:1,duration:e.duration||60,immediateSync:e.immediateSync!==void 0&&e.immediateSync},accountIds:e.accountIds});case 5:return i=u.sent,u.abrupt("return",i.content.failedList);case 7:case"end":return u.stop()}},r,this)}))},l.unsubscribeUserStatus=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o;return T.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.checkLogin(),this.checkV2(),P(K4,e,"",!0),i=[],!(e.accountIds.length>0)){h.next=11;break}return h.next=7,this.core.sendCmd("v2UnsubscribeUserStatus",{tag:{eventType:1},accountIds:e.accountIds});case 7:o=h.sent,i=o.content.failedList,h.next=15;break;case 11:return h.next=14,this.core.sendCmd("v2UnsubscribeAllUserStatus",{tag:{eventType:1}});case 14:i=[];case 15:return h.abrupt("return",i);case 16:case"end":return h.stop()}},r,this)}))},l.publishCustomUserStatus=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkLogin(),this.checkV2(),P(Y4,e,"",!0),u.next=5,this.core.sendCmd("v2PublishEvent",{tag:O(O({},e),{eventType:1,uniqueId:jr(),duration:e.duration||60,onlineOnly:e.onlineOnly===void 0||e.onlineOnly,multiSync:e.multiSync!==void 0&&e.multiSync})});case 5:return i=u.sent,u.abrupt("return",i.content.data);case 7:case"end":return u.stop()}},r,this)}))},l.queryUserStatusSubscriptions=function(e){return k(this,void 0,void 0,T.mark(function r(){var i,o,u,h,g,v;return T.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(this.checkLogin(),this.checkV2(),P({accountIds:{type:"array",required:!0,itemType:"string",max:3e3}},{accountIds:e},"",!0),i=[],!(e.length>0)){I.next=16;break}o=0;case 6:if(!(o<e.length)){I.next=14;break}return I.next=9,this.core.sendCmd("v2QuerySubscribeEvent",{tag:{eventType:1},accountIds:ht(e).call(e,o,o+100)});case 9:h=I.sent,i=dt(i).call(i,se(u=h.content.data).call(u,function(C){return{accountId:C.accountId,subscribeTime:C.subscribeTime,duration:C.duration}}));case 11:o+=100,I.next=6;break;case 14:I.next=20;break;case 16:return I.next=18,this.core.sendCmd("v2QueryAllSubscribeEvent",{tag:{eventType:1}});case 18:v=I.sent,i=dt(i).call(i,se(g=v.content.data).call(g,function(C){return{accountId:C.accountId,subscribeTime:C.subscribeTime,duration:C.duration}}));case 20:return I.abrupt("return",i);case 21:case"end":return I.stop()}},r,this)}))},l.v2OnUserStatusChangeHandler=function(e){var r=e.content.data,i=r.eventType,o=r.extensionReceived,u=br(r,["eventType","extensionReceived"]);i===1?this.emit("onUserStatusChanged",[O(O({},u),{extension:o})]):this.logger.log("v2OnUserStatusChangeHandler eventType = ",i,"msgEvent = ",r)},l.v2OnMultiUserStatusChangeHandler=function(e){var r,i=e.content.data,o=se(r=at(i).call(i,function(u){return u.eventType===1})).call(r,function(u){u.eventType;var h=u.extensionReceived,g=br(u,["eventType","extensionReceived"]);return O(O({},g),{extension:h})});o.length>0&&this.emit("onUserStatusChanged",o)},p}($r);(function(a){a[a.V2NIM_PROXY_REQUEST_METHOD_GET=1]="V2NIM_PROXY_REQUEST_METHOD_GET",a[a.V2NIM_PROXY_REQUEST_METHOD_POST=2]="V2NIM_PROXY_REQUEST_METHOD_POST",a[a.V2NIM_PROXY_REQUEST_METHOD_PUT=3]="V2NIM_PROXY_REQUEST_METHOD_PUT",a[a.V2NIM_PROXY_REQUEST_METHOD_DELETE=4]="V2NIM_PROXY_REQUEST_METHOD_DELETE"})(Ls||(Ls={}));var FC="V2NIMPassthroughService",J4={"22_1":"v2ProxyRequest","22_2":"v2ProxyOnRequest"},BC={zone:1,path:2,method:3,header:4,body:5},Q4={v2ProxyRequest:{sid:22,cid:1,service:FC,params:[{type:"Property",name:"tag",reflectMapper:BC}],response:[{type:"Property",name:"data",reflectMapper:Te(BC)}]},v2ProxyOnRequest:{sid:22,cid:2,service:FC,response:[{type:"Property",name:"data",reflectMapper:Te({fromAccountId:1,body:2,time:{id:3,retType:"number"}})}]}},z4={path:{type:"string",allowEmpty:!1},zone:{type:"string",required:!1},method:{type:"enum",values:[Ls.V2NIM_PROXY_REQUEST_METHOD_DELETE,Ls.V2NIM_PROXY_REQUEST_METHOD_GET,Ls.V2NIM_PROXY_REQUEST_METHOD_POST,Ls.V2NIM_PROXY_REQUEST_METHOD_PUT],required:!1},header:{type:"jsonstr",required:!1},body:{type:"string",required:!1}},X4=function(a){function p(t){var e;return e=a.call(this,"V2NIMPassthroughService",t)||this,Kt({cmdMap:J4,cmdConfig:Q4}),e}bt(p,a);var l=p.prototype;return l.emit=function(e){for(var r,i,o,u,h=this.name+"::emit "+e.toString(),g=arguments.length,v=new Array(g>1?g-1:0),_=1;_<g;_++)v[_-1]=arguments[_];return(r=this.logger).log.apply(r,dt(i=[""+h]).call(i,v)),(o=a.prototype.emit).call.apply(o,dt(u=[this,e]).call(u,v))},l.httpProxy=function(e){return k(this,void 0,void 0,T.mark(function r(){var i;return T.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(P(z4,e,"",!0),!(e.method===Ls.V2NIM_PROXY_REQUEST_METHOD_GET&&e.body||e.method===Ls.V2NIM_PROXY_REQUEST_METHOD_POST&&!e.body||e.method===Ls.V2NIM_PROXY_REQUEST_METHOD_PUT&&!e.body)){u.next=3;break}throw new Me({code:ce.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"method "+e.method+", incorrect body"}});case 3:return u.next=5,this.core.sendCmd("v2ProxyRequest",{tag:e});case 5:return i=u.sent,u.abrupt("return",i.content.data);case 7:case"end":return u.stop()}},r,this)}))},l.v2ProxyOnRequestHandler=function(e){var r=e.content.data;this.emit("onProxyNotify",r)},p}($r),Z4=m(function(a,p){a.exports=function(l){var t=function(H,V){return H+V&4294967295},e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(H,V,w,Y,re,ee){return V=t(t(V,H),t(Y,ee)),t(V<<re|V>>>32-re,w)}function i(H,V,w,Y,re,ee,pe){return r(V&w|~V&Y,H,V,re,ee,pe)}function o(H,V,w,Y,re,ee,pe){return r(V&Y|w&~Y,H,V,re,ee,pe)}function u(H,V,w,Y,re,ee,pe){return r(V^w^Y,H,V,re,ee,pe)}function h(H,V,w,Y,re,ee,pe){return r(w^(V|~Y),H,V,re,ee,pe)}function g(H,V){var w=H[0],Y=H[1],re=H[2],ee=H[3];w=i(w,Y,re,ee,V[0],7,-680876936),ee=i(ee,w,Y,re,V[1],12,-389564586),re=i(re,ee,w,Y,V[2],17,606105819),Y=i(Y,re,ee,w,V[3],22,-1044525330),w=i(w,Y,re,ee,V[4],7,-176418897),ee=i(ee,w,Y,re,V[5],12,1200080426),re=i(re,ee,w,Y,V[6],17,-1473231341),Y=i(Y,re,ee,w,V[7],22,-45705983),w=i(w,Y,re,ee,V[8],7,1770035416),ee=i(ee,w,Y,re,V[9],12,-1958414417),re=i(re,ee,w,Y,V[10],17,-42063),Y=i(Y,re,ee,w,V[11],22,-1990404162),w=i(w,Y,re,ee,V[12],7,1804603682),ee=i(ee,w,Y,re,V[13],12,-40341101),re=i(re,ee,w,Y,V[14],17,-1502002290),w=o(w,Y=i(Y,re,ee,w,V[15],22,1236535329),re,ee,V[1],5,-165796510),ee=o(ee,w,Y,re,V[6],9,-1069501632),re=o(re,ee,w,Y,V[11],14,643717713),Y=o(Y,re,ee,w,V[0],20,-373897302),w=o(w,Y,re,ee,V[5],5,-701558691),ee=o(ee,w,Y,re,V[10],9,38016083),re=o(re,ee,w,Y,V[15],14,-660478335),Y=o(Y,re,ee,w,V[4],20,-405537848),w=o(w,Y,re,ee,V[9],5,568446438),ee=o(ee,w,Y,re,V[14],9,-1019803690),re=o(re,ee,w,Y,V[3],14,-187363961),Y=o(Y,re,ee,w,V[8],20,1163531501),w=o(w,Y,re,ee,V[13],5,-1444681467),ee=o(ee,w,Y,re,V[2],9,-51403784),re=o(re,ee,w,Y,V[7],14,1735328473),w=u(w,Y=o(Y,re,ee,w,V[12],20,-1926607734),re,ee,V[5],4,-378558),ee=u(ee,w,Y,re,V[8],11,-2022574463),re=u(re,ee,w,Y,V[11],16,1839030562),Y=u(Y,re,ee,w,V[14],23,-35309556),w=u(w,Y,re,ee,V[1],4,-1530992060),ee=u(ee,w,Y,re,V[4],11,1272893353),re=u(re,ee,w,Y,V[7],16,-155497632),Y=u(Y,re,ee,w,V[10],23,-1094730640),w=u(w,Y,re,ee,V[13],4,681279174),ee=u(ee,w,Y,re,V[0],11,-358537222),re=u(re,ee,w,Y,V[3],16,-722521979),Y=u(Y,re,ee,w,V[6],23,76029189),w=u(w,Y,re,ee,V[9],4,-640364487),ee=u(ee,w,Y,re,V[12],11,-421815835),re=u(re,ee,w,Y,V[15],16,530742520),w=h(w,Y=u(Y,re,ee,w,V[2],23,-995338651),re,ee,V[0],6,-198630844),ee=h(ee,w,Y,re,V[7],10,1126891415),re=h(re,ee,w,Y,V[14],15,-1416354905),Y=h(Y,re,ee,w,V[5],21,-57434055),w=h(w,Y,re,ee,V[12],6,1700485571),ee=h(ee,w,Y,re,V[3],10,-1894986606),re=h(re,ee,w,Y,V[10],15,-1051523),Y=h(Y,re,ee,w,V[1],21,-2054922799),w=h(w,Y,re,ee,V[8],6,1873313359),ee=h(ee,w,Y,re,V[15],10,-30611744),re=h(re,ee,w,Y,V[6],15,-1560198380),Y=h(Y,re,ee,w,V[13],21,1309151649),w=h(w,Y,re,ee,V[4],6,-145523070),ee=h(ee,w,Y,re,V[11],10,-1120210379),re=h(re,ee,w,Y,V[2],15,718787259),Y=h(Y,re,ee,w,V[9],21,-343485551),H[0]=t(w,H[0]),H[1]=t(Y,H[1]),H[2]=t(re,H[2]),H[3]=t(ee,H[3])}function v(H){var V,w=[];for(V=0;V<64;V+=4)w[V>>2]=H.charCodeAt(V)+(H.charCodeAt(V+1)<<8)+(H.charCodeAt(V+2)<<16)+(H.charCodeAt(V+3)<<24);return w}function _(H){var V,w=[];for(V=0;V<64;V+=4)w[V>>2]=H[V]+(H[V+1]<<8)+(H[V+2]<<16)+(H[V+3]<<24);return w}function I(H){var V,w,Y,re,ee,pe,ye=H.length,Q=[1732584193,-271733879,-1732584194,271733878];for(V=64;V<=ye;V+=64)g(Q,v(H.substring(V-64,V)));for(w=(H=H.substring(V-64)).length,Y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],V=0;V<w;V+=1)Y[V>>2]|=H.charCodeAt(V)<<(V%4<<3);if(Y[V>>2]|=128<<(V%4<<3),V>55)for(g(Q,Y),V=0;V<16;V+=1)Y[V]=0;return re=(re=8*ye).toString(16).match(/(.*?)(.{0,8})$/),ee=parseInt(re[2],16),pe=parseInt(re[1],16)||0,Y[14]=ee,Y[15]=pe,g(Q,Y),Q}function C(H){var V,w,Y,re,ee,pe,ye=H.length,Q=[1732584193,-271733879,-1732584194,271733878];for(V=64;V<=ye;V+=64)g(Q,_(H.subarray(V-64,V)));for(w=(H=V-64<ye?H.subarray(V-64):new Uint8Array(0)).length,Y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],V=0;V<w;V+=1)Y[V>>2]|=H[V]<<(V%4<<3);if(Y[V>>2]|=128<<(V%4<<3),V>55)for(g(Q,Y),V=0;V<16;V+=1)Y[V]=0;return re=(re=8*ye).toString(16).match(/(.*?)(.{0,8})$/),ee=parseInt(re[2],16),pe=parseInt(re[1],16)||0,Y[14]=ee,Y[15]=pe,g(Q,Y),Q}function A(H){var V,w="";for(V=0;V<4;V+=1)w+=e[H>>8*V+4&15]+e[H>>8*V&15];return w}function N(H){var V;for(V=0;V<H.length;V+=1)H[V]=A(H[V]);return H.join("")}function F(H){return/[\u0080-\uFFFF]/.test(H)&&(H=unescape(encodeURIComponent(H))),H}function j(H,V){var w,Y=H.length,re=new ArrayBuffer(Y),ee=new Uint8Array(re);for(w=0;w<Y;w+=1)ee[w]=H.charCodeAt(w);return V?ee:re}function W(H){return String.fromCharCode.apply(null,new Uint8Array(H))}function U(H,V,w){var Y=new Uint8Array(H.byteLength+V.byteLength);return Y.set(new Uint8Array(H)),Y.set(new Uint8Array(V),H.byteLength),Y}function ie(H){var V,w=[],Y=H.length;for(V=0;V<Y-1;V+=2)w.push(parseInt(H.substr(V,2),16));return String.fromCharCode.apply(String,w)}function te(){this.reset()}return N(I("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(t=function(H,V){var w=(65535&H)+(65535&V);return(H>>16)+(V>>16)+(w>>16)<<16|65535&w}),typeof ArrayBuffer>"u"||ArrayBuffer.prototype.slice||function(){function H(V,w){return(V=0|V||0)<0?Math.max(V+w,0):Math.min(V,w)}ArrayBuffer.prototype.slice=function(V,w){var Y,re,ee,pe,ye=this.byteLength,Q=H(V,ye),ze=ye;return w!==l&&(ze=H(w,ye)),Q>ze?new ArrayBuffer(0):(Y=ze-Q,re=new ArrayBuffer(Y),ee=new Uint8Array(re),pe=new Uint8Array(this,Q,Y),ee.set(pe),re)}}(),te.prototype.append=function(H){return this.appendBinary(F(H)),this},te.prototype.appendBinary=function(H){this._buff+=H,this._length+=H.length;var V,w=this._buff.length;for(V=64;V<=w;V+=64)g(this._hash,v(this._buff.substring(V-64,V)));return this._buff=this._buff.substring(V-64),this},te.prototype.end=function(H){var V,w,Y=this._buff,re=Y.length,ee=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(V=0;V<re;V+=1)ee[V>>2]|=Y.charCodeAt(V)<<(V%4<<3);return this._finish(ee,re),w=N(this._hash),H&&(w=ie(w)),this.reset(),w},te.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},te.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},te.prototype.setState=function(H){return this._buff=H.buff,this._length=H.length,this._hash=H.hash,this},te.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},te.prototype._finish=function(H,V){var w,Y,re,ee=V;if(H[ee>>2]|=128<<(ee%4<<3),ee>55)for(g(this._hash,H),ee=0;ee<16;ee+=1)H[ee]=0;w=(w=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),Y=parseInt(w[2],16),re=parseInt(w[1],16)||0,H[14]=Y,H[15]=re,g(this._hash,H)},te.hash=function(H,V){return te.hashBinary(F(H),V)},te.hashBinary=function(H,V){var w=N(I(H));return V?ie(w):w},te.ArrayBuffer=function(){this.reset()},te.ArrayBuffer.prototype.append=function(H){var V,w=U(this._buff.buffer,H),Y=w.length;for(this._length+=H.byteLength,V=64;V<=Y;V+=64)g(this._hash,_(w.subarray(V-64,V)));return this._buff=V-64<Y?new Uint8Array(w.buffer.slice(V-64)):new Uint8Array(0),this},te.ArrayBuffer.prototype.end=function(H){var V,w,Y=this._buff,re=Y.length,ee=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(V=0;V<re;V+=1)ee[V>>2]|=Y[V]<<(V%4<<3);return this._finish(ee,re),w=N(this._hash),H&&(w=ie(w)),this.reset(),w},te.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},te.ArrayBuffer.prototype.getState=function(){var H=te.prototype.getState.call(this);return H.buff=W(H.buff),H},te.ArrayBuffer.prototype.setState=function(H){return H.buff=j(H.buff,!0),te.prototype.setState.call(this,H)},te.ArrayBuffer.prototype.destroy=te.prototype.destroy,te.ArrayBuffer.prototype._finish=te.prototype._finish,te.ArrayBuffer.hash=function(H,V){var w=N(C(new Uint8Array(H)));return V?ie(w):w},te}()}),eF=function(p){return p&&typeof p=="object"&&"default"in p?p.default:p}(Z4),tF=class{md5(p,l,t){this.aborted=!1,this.progress=0;let e=0;const r=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,i=2097152,o=Math.ceil(p.size/i),u=new eF.ArrayBuffer,h=new FileReader;function g(){const v=e*i,_=v+i>=p.size?p.size:v+i;h.readAsArrayBuffer(r.call(p,v,_))}g(),h.onloadend=v=>{u.append(v.target.result),e++,this.progress=e/o,t&&typeof t=="function"&&t(this.progress),this.aborted?l("aborted"):e<o?g():l(null,u.end())}}abort(){this.aborted=!0}},rF=function(){function a(l){this.name="DataStructureConverter",this.core=l}var p=a.prototype;return p.messageConvertToV1=function(t){var e,r=xt(tn(t,Rt),Mt(To)),i=_o(r,this.core.account),o=(e=this.core.session)===null||e===void 0?void 0:e.getSessionWithUncomplete({id:i});return ei(r,o?{account:this.core.account,sessionAck:o.ack,msgReceiptTime:o.msgReceiptTime}:{account:this.core.account})},p.messageConvertToV2=function(t){var e=xt(tn(Kd(t,t.from,t.fromDeviceId),To),Ig);return(e=pn(this.core,e)).sendingState=t.status==="sending"?3:t.status==="sendFailed"?2:1,e},a}(),nF=function(){function a(l){this.name="V2NIMMessageConverter",this.core=l}var p=a.prototype;return p.messageSerialization=function(t){if(!t)return null;var e=tn(t,Rt);return xe(e)},p.messageDeserialization=function(t){var e,r,i,o,u,h,g,v,_,I,C,A,N,F,j,W,U,ie,te,H,V,w,Y;if(!t)return null;try{var re,ee,pe,ye,Q=xt(JSON.parse(t),Ig);return Q.sendingState=0,Q.conversationType!==1||Q.senderId!==this.core.account&&Q.receiverId!==this.core.account?Q.conversationType===2?Q.conversationId=this.core.V2NIMConversationIdUtil.teamConversationId(Q.receiverId):Q.conversationType===3&&(Q.conversationId=this.core.V2NIMConversationIdUtil.superTeamConversationId(Q.receiverId)):Q.conversationId=this.core.V2NIMConversationIdUtil.p2pConversationId(Q.senderId===this.core.account?Q.receiverId:Q.senderId),Q.threadReply&&(Q.threadReply.conversationType=Q.conversationType,Q.threadReply=Nl(this.core,Q.threadReply)),Q.threadRoot&&(Q.threadRoot.conversationType=Q.conversationType,Q.threadRoot=Nl(this.core,Q.threadRoot)),_t(re=[1,3,2,0]).call(re,Q.conversationType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+Q.conversationType),Q.senderId&&typeof Q.senderId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+Q.senderId),Q.receiverId&&typeof Q.receiverId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+Q.receiverId),"createTime"in Q&&isNaN(Q.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+Q.createTime),_t(ee=[2,7,12,100,6,1,-1,4,5,11,0,10,3]).call(ee,Q.messageType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageType(enum): "+Q.messageType),"subType"in Q&&isNaN(Q.subType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid subType(number): "+Q.subType),Q.messageClientId&&typeof Q.messageClientId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+Q.messageClientId),Q.messageServerId&&typeof Q.messageServerId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+Q.messageServerId),Q.attachment&&typeof Q.attachment!="object"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid attachment(object): "+Q.attachment),Q.text&&typeof Q.text!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid text(string): "+Q.text),Q.serverExtension&&typeof Q.serverExtension!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid serverExtension(string): "+Q.serverExtension),Q.callbackExtension&&typeof Q.callbackExtension!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid callbackExtension(string): "+Q.callbackExtension),!((e=Q.pushConfig)===null||e===void 0)&&e.pushContent&&typeof Q.pushConfig.pushContent!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushContent(string): "+Q.pushConfig.pushContent),!((r=Q.pushConfig)===null||r===void 0)&&r.pushPayload&&typeof Q.pushConfig.pushPayload!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushPayload(string): "+Q.pushConfig.pushPayload),!((i=Q.pushConfig)===null||i===void 0)&&i.forcePushContent&&typeof Q.pushConfig.forcePushContent!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushContent(string): "+Q.pushConfig.forcePushContent),!((o=Q.pushConfig)===null||o===void 0)&&o.forcePushAccountIds&&!qt(Q.pushConfig.forcePushAccountIds)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushAccountIds(array): "+Q.pushConfig.forcePushAccountIds),!((u=Q.routeConfig)===null||u===void 0)&&u.routeEnvironment&&typeof Q.routeConfig.routeEnvironment!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid routeEnvironment(string): "+Q.routeConfig.routeEnvironment),!((h=Q.antispamConfig)===null||h===void 0)&&h.antispamBusinessId&&typeof Q.antispamConfig.antispamBusinessId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamBusinessId(string): "+Q.antispamConfig.antispamBusinessId),!((g=Q.antispamConfig)===null||g===void 0)&&g.antispamCustomMessage&&typeof Q.antispamConfig.antispamCustomMessage!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCustomMessage(string): "+Q.antispamConfig.antispamCustomMessage),!((v=Q.antispamConfig)===null||v===void 0)&&v.antispamCheating&&typeof Q.antispamConfig.antispamCheating!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCheating(string): "+Q.antispamConfig.antispamCheating),!((_=Q.antispamConfig)===null||_===void 0)&&_.antispamExtension&&typeof Q.antispamConfig.antispamExtension!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamExtension(string): "+Q.antispamConfig.antispamExtension),!((I=Q.robotConfig)===null||I===void 0)&&I.accountId&&typeof Q.robotConfig.accountId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid accountId(string): "+Q.robotConfig.accountId),!((C=Q.robotConfig)===null||C===void 0)&&C.topic&&typeof Q.robotConfig.topic!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid topic(string): "+Q.robotConfig.topic),!((A=Q.robotConfig)===null||A===void 0)&&A.function&&typeof Q.robotConfig.function!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid function(string): "+Q.robotConfig.function),!((N=Q.robotConfig)===null||N===void 0)&&N.customContent&&typeof Q.robotConfig.customContent!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid customContent(string): "+Q.robotConfig.customContent),!((F=Q.threadRoot)===null||F===void 0)&&F.senderId&&typeof Q.threadRoot.senderId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+Q.threadRoot.senderId),!((j=Q.threadRoot)===null||j===void 0)&&j.receiverId&&typeof Q.threadRoot.receiverId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+Q.threadRoot.receiverId),!((W=Q.threadRoot)===null||W===void 0)&&W.messageClientId&&typeof Q.threadRoot.messageClientId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+Q.threadRoot.messageClientId),!((U=Q.threadRoot)===null||U===void 0)&&U.messageServerId&&typeof Q.threadRoot.messageServerId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+Q.threadRoot.messageServerId),Q.threadRoot&&"createTime"in Q.threadRoot&&isNaN(Q.threadRoot.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+Q.threadRoot.createTime),Q.threadRoot&&!_t(pe=[1,3,2,0]).call(pe,Q.threadRoot.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+Q.threadRoot.conversationType),!((ie=Q.threadRoot)===null||ie===void 0)&&ie.conversationId&&typeof Q.threadRoot.conversationId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+Q.threadRoot.conversationId),!((te=Q.threadReply)===null||te===void 0)&&te.senderId&&typeof Q.threadReply.senderId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+Q.threadReply.senderId),!((H=Q.threadReply)===null||H===void 0)&&H.receiverId&&typeof Q.threadReply.receiverId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+Q.threadReply.receiverId),!((V=Q.threadReply)===null||V===void 0)&&V.messageClientId&&typeof Q.threadReply.messageClientId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+Q.threadReply.messageClientId),!((w=Q.threadReply)===null||w===void 0)&&w.messageServerId&&typeof Q.threadReply.messageServerId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+Q.threadReply.messageServerId),Q.threadReply&&"createTime"in Q.threadReply&&isNaN(Q.threadReply.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+Q.threadReply.createTime),Q.threadReply&&!_t(ye=[1,3,2,0]).call(ye,Q.threadReply.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+Q.threadReply.conversationType),!((Y=Q.threadReply)===null||Y===void 0)&&Y.conversationId&&typeof Q.threadReply.conversationId!="string"&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+Q.threadReply.conversationId),delete Q.__clientExt,delete Q.userUpdateTime,Q}catch{return this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid message string: "+t),null}},a}();(function(p){SS(We,p())})(function(){return{setLogger:tP,platform:"BROWSER",localStorage:window.localStorage,request:qx,WebSocket:window.WebSocket,uploadFile:rP,getFileUploadInformation:nP,getSystemInfo:iP,net:sP,logStorage:dP}}),Vt.registerService(CP,"V1NIMLoginService"),Vt.registerService(aU,"msg"),Vt.registerService(pU,"user"),Vt.registerService(yU,"session"),Vt.registerService(MU,"team"),Vt.registerService(SU,"systemMessage"),Vt.registerService(AU,"friend"),Vt.registerService(OU,"event"),Vt.registerService(LU,"msgExtend"),Vt.registerService(qU,"msgLog"),Vt.registerService(HU,"passThrough"),Vt.registerService(Z0,"cloudStorage"),Vt.registerService(i3,"superTeam"),Vt.registerService(uU,"sync"),Vt.registerService(a3,"plugin"),Vt.registerService(p3,"cloudSession"),Vt.registerService(m3,"signaling"),Vt.registerService(eL,"V2NIMLoginService"),Vt.registerService(EV,"V2NIMLocalConversationService"),Vt.registerService(TE,"V2NIMConversationService"),Vt.registerService(oE,"V2NIMMessageService"),Vt.registerService(m4,"V2NIMNotificationService"),Vt.registerService(eE,"V2NIMStorageService"),Vt.registerService(Y0,"V2NIMStorageUtil"),Vt.registerService(UV,"V2NIMConversationGroupService"),Vt.registerService(dD,"V2NIMTeamService"),Vt.registerService(wE,"V2NIMUserService"),Vt.registerService(CD,"V2NIMFriendService"),Vt.registerService(DD,"V2NIMSettingService"),Vt.registerService(y4,"V2NIMSyncService"),Vt.registerService(R4,"V2NIMAIService"),Vt.registerService(rF,"DataStructureConverter"),Vt.registerService(nF,"V2NIMMessageConverter"),Vt.registerService(qV,"V2NIMMessageLogUtil"),Vt.registerService(YV,"V2NIMMessageExtendUtil"),Vt.registerService(G4,"V2NIMSignallingService"),Vt.registerService(W4,"V2NIMSubscriptionService"),Vt.registerService(X4,"V2NIMPassthroughService"),Vt.registerService(iE,"YSFService"),Vt.registerService(F3,"qchatChannel"),Vt.registerService(K3,"qchatMedia"),Vt.registerService(u4,"qchatMsg"),Vt.registerService(p4,"qchatRole"),Vt.registerService(f4,"qchatServer"),Vt.registerPlugin(tF,"browser-md5-file"),Vt.registerPrivateService(function(p){var l=this;this.bindEvents=function(){l.core.eventBus.on("forwardSend/msg/sendMsg",l.onV1SendMsg),l.core.eventBus.on("forwardSend/msg/recallMsg",l.onV1RecallMsg),l.core.eventBus.on("forwardSend/msg/deleteSelfMsgs",l.onV1DeleteSelfMsgs),l.core.eventBus.on("forwardSend/msgLog/clearHistoryMsgsFromServer",l.onV1ClearHistoryMessage),l.core.eventBus.on("forwardSend/V2NIMMessageService/sendMsg",l.onV2SendMsg),l.core.eventBus.on("forwardSend/V2NIMMessageService/modifyMsg",l.onV2ModifyMsg),l.core.eventBus.on("forwardSend/V2NIMMessageService/revokeMessage",l.onV2RevokeMessage),l.core.eventBus.on("forwardSend/V2NIMMessageService/deleteSelfMsgs",l.onV2DeleteSelfMsgs),l.core.eventBus.on("forwardSend/V2NIMMessageLogService/clearHistoryMessage",l.onV2ClearHistoryMessage),l.core.eventBus.on("forwardSend/team/created",l.onV1TeamCreated),l.core.eventBus.on("forwardSend/team/updateMyMemberInfo",l.onV1TeamMemberUpdate),l.core.eventBus.on("forwardSend/superTeam/updateMyMemberInfo",l.onV1SuperTeamMemberUpdate),l.core.eventBus.on("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",l.onV2TeamMemberUpdate),l.core.eventBus.on("forwardSend/team/passTeamApply",function(t,e){return l.onV1TeamApply(t,1,1,e)}),l.core.eventBus.on("forwardSend/superTeam/passSuperTeamApply",function(t,e){l.onV1TeamApply(t,2,1,e)}),l.core.eventBus.on("forwardSend/team/rejectTeamApply",function(t,e){l.onV1TeamApply(t,1,2,e)}),l.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamApply",function(t,e){l.onV1TeamApply(t,2,2,e)}),l.core.eventBus.on("forwardSend/team/acceptTeamInvite",function(t,e){l.onV1TeamInvite(t,1,1,e)}),l.core.eventBus.on("forwardSend/superTeam/acceptSuperTeamInvite",function(t,e){l.onV1TeamInvite(t,2,1,e)}),l.core.eventBus.on("forwardSend/team/rejectTeamInvite",function(t,e){l.onV1TeamInvite(t,1,2,e)}),l.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamInvite",function(t,e){l.onV1TeamInvite(t,2,2,e)}),l.core.eventBus.on("forwardSend/user/updateBlackList",l.onV1UpdateBlackList),l.core.eventBus.on("forwardSend/user/updateUserInfo",l.onV1UpdateUserInfo),l.core.eventBus.on("forwardSend/user/setMute",l.onV1SetMute),l.core.eventBus.on("forwardSend/friend/addFriend",l.onV1AddFriend),l.core.eventBus.on("forwardSend/friend/deleteFriend",l.onV1DeleteFriend),l.core.eventBus.on("forwardSend/friend/updateFriend",l.onV1UpdateFriend),l.core.eventBus.on("forwardSend/friend/passFriendApply",l.onV1PassFriendApply),l.core.eventBus.on("forwardSend/friend/rejectFriendApply",l.onV1RejectFriendApply)},this.onV1TeamApply=function(t,e,r,i){if(i){if(!l.core.V2NIMTeamService.notification.checkIfExpired(i))return;r=3}l.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:t.teamId,teamType:e,operatorAccountId:t.from,actionType:0},r)},this.onV1TeamInvite=function(t,e,r,i){if(i){if(!l.core.V2NIMTeamService.notification.checkIfExpired(i.code))return;r=3}l.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:t.teamId,teamType:e,operatorAccountId:t.from,actionType:2},r)},this.onV1PassFriendApply=function(t,e){l.core.eventBus.emit("forwardReceive/V2NIMFriendService/acceptAddApplication",t,e)},this.onV1RejectFriendApply=function(t,e,r){l.core.eventBus.emit("forwardReceive/V2NIMFriendService/rejectAddApplication",{applicantAccountId:t,recipientAccountId:l.core.account,operatorAccountId:l.core.account,postscript:e||"",timestamp:l.core.timeOrigin.getNTPTime(),read:!0,status:3},r)},this.onV1SetMute=function(t,e){l.core.eventBus.emit("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",t,e?1:0)},this.onV1UpdateFriend=function(t){l.core.eventBus.emit("forwardReceive/V2NIMFriendService/setFriendInfo",t.account,O(O({},"alias"in t?{alias:t.alias}:{}),"ext"in t?{serverExtension:t.ext}:{}))},this.onV1AddFriend=function(t){l.core.eventBus.emit("forwardReceive/V2NIMFriendService/addFriend",t)},this.onV1DeleteFriend=function(t){l.core.eventBus.emit("forwardReceive/V2NIMFriendService/deleteFriend",t)},this.onV1UpdateUserInfo=function(t){var e=xt(tn(t,Ug.user),Te(vc));l.core.eventBus.emit("forwardReceive/V2NIMUserService/updateUserProfile",e)},this.onV1UpdateBlackList=function(t,e){l.core.eventBus.emit("forwardReceive/V2NIMUserService/updateBlockList",t,e)},this.onV1TeamCreated=function(t){var e=xt(tn(Dg(t),Pi.team),Te(zr));l.core.eventBus.emit("forwardReceive/V2NIMTeamService/created",e)},this.onV1TeamMemberUpdate=function(t){(t=O({},t)).type&&(t.type={normal:0,owner:1,manager:2}[t.type]);var e=xt(tn(t,Pi.teamMember),Te(Es));e.teamType=1,l.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",e)},this.onV1SuperTeamMemberUpdate=function(t){(t=O({},t)).type&&(t.type={normal:0,owner:1,manager:2}[t.type]);var e=xt(tn(t,Ec.superTeamMember),Te(fo));e.teamType=2,l.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",e)},this.onV2TeamMemberUpdate=function(t){var e=t.teamType,r=tn(t,Es);if(e===2){var i=xt(r,Te(Ec.superTeamMember));l.core.eventBus.emit("forwardReceive/superTeam/updateMyMemberInfo",i)}else{var o=xt(r,Te(Pi.teamMember));l.core.eventBus.emit("forwardReceive/team/updateMyMemberInfo",o)}},this.onV1SendMsg=function(t){var e=xt(tn(t,To),Ig);(e=pn(l.core,e)).sendingState=t.status==="sending"?3:t.status==="sent"?1:2,l.core.eventBus.emit("forwardReceive/V2NIMMessageService/sendMsg",e)},this.onV2SendMsg=function(t){var e=xt(tn(t,Rt),Mt(To));e.status=t.sendingState===3?"sending":t.sendingState===1?"sent":"sendFailed",l.core.eventBus.emit("forwardReceive/msg/sendMsg",e)},this.onV2ModifyMsg=function(t){var e=xt(tn(t,Rt),Mt(To));l.core.eventBus.emit("forwardReceive/msg/modifyMsg",e)},this.onV1RecallMsg=function(t){t.deleteMsgCreatetime=t.time;var e=xt(tn(t,ts.recallMsgTag),Te(da));l.core.eventBus.emit("forwardReceive/V2NIMMessageService/revokeMessages",[e])},this.onV2RevokeMessage=function(t){var e=xt(tn(t,da),sn.recallMsgTag);l.core.eventBus.emit("forwardReceive/msg/recallMsg",e)},this.onV1DeleteSelfMsgs=function(t){var e=se(t).call(t,function(r){return xt(tn(r,ts.deleteSelfMsgTag),Te(mo))});ae(e).call(e,function(r){r.messageRefer=Cs(l.core,r.messageRefer)}),l.core.eventBus.emit("forwardReceive/V2NIMMessageService/deleteMessages",e)},this.onV2DeleteSelfMsgs=function(t){var e=se(t).call(t,function(r){return xt(tn(r,mo),sn.deleteSelfMsgTag)});l.core.eventBus.emit("forwardReceive/msg/deleteSelfMsgs",e)},this.onV1ClearHistoryMessage=function(t){var e=xt(tn(t,jl.clearHistoryMsgsFromServerReqTag),Te(Ll));l.core.eventBus.emit("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",e)},this.onV2ClearHistoryMessage=function(t){var e=xt(tn(t,Ll),Ic.clearHistoryMsgsFromServerReqTag);l.core.eventBus.emit("forwardReceive/msgLog/clearHistoryMsgsFromServer",e)},this.core=p,this.bindEvents()},"eventForwardCenter"),c.V2NIMConst=hx,c.default=Vt,Object.defineProperty(c,"__esModule",{value:!0})})}(vu,vu.exports)),vu.exports}var d7=u7();const p7=FM(d7),h7=()=>{const s=localStorage.getItem("enableV2CloudConversation")==="on",n=p7.getInstance({appkey:"3e215d27b6a6a9e27dad7ef36dd5b65c",needReconnect:!0,debugLevel:"debug",apiVersion:"v2",enableV2CloudConversation:s},{V2NIMLoginServiceConfig:{lbsUrls:["https://lbs.netease.im/lbs/webconf.jsp"],linkUrl:"weblink.netease.im"}}),c=new c7(n,{addFriendNeedVerify:!1,p2pMsgReceiptVisible:!0,teamMsgReceiptVisible:!0,teamAgreeMode:Y6.V2NIMTeamAgreeMode.V2NIM_TEAM_AGREE_MODE_NO_AUTH,sendMsgBefore:async d=>({...d})},"H5");return{nim:n,store:c}},f7={name:"App",components:{TabBar:$6},data(){return{showUiKit:!1}},methods:{initIMUiKit(s){w6(localStorage.getItem("switchToEnglishFlag")=="en"?"en":"zh");const{nim:n,store:c}=h7(),d=yM();d&&(d.appContext.app.config.globalProperties.$NIM=n,d.appContext.app.config.globalProperties.$UIKitStore=c),n.V2NIMLoginService.login(s.account,s.token).then(()=>{this.$router.push("/conversation"),this.showUiKit=!0})},checkLoginStatus(){const s=localStorage.getItem("__yx_im_options__h5");if(!s){this.$router.push("/login"),this.showUiKit=!0;return}try{const{account:n,token:c}=JSON.parse(s);this.initIMUiKit({account:n,token:c})}catch(n){console.error("",n),localStorage.removeItem("imLoginInfo"),this.$router.push("/login")}}},mounted(){this.checkLoginStatus()}},m7={key:0,class:"app-container"};function g7(s,n,c,d,f,m){const y=Ny("router-view"),M=Ny("TabBar");return f.showUiKit?(xa(),Ap("div",m7,[cn(y),cn(M)])):Np("",!0)}const v7=xR(f7,[["render",g7]]),mN=Nq(v7);mN.use(D5);mN.mount("#app");export{D5 as A,wr as B,b7 as C,nB as D,jA as E,si as F,FM as G,sB as H,Ny as I,bp as J,C7 as K,M8 as L,v8 as M,sh as N,h7 as O,I7 as T,xR as _,ri as a,E7 as b,Ap as c,HB as d,xv as e,fM as f,Np as g,Ay as h,yM as i,Mi as j,Py as k,Ep as l,cn as m,iM as n,xa as o,yR as p,n1 as q,T7 as r,mM as s,Sp as t,qn as u,S7 as v,_7 as w,sM as x,Y6 as y,M7 as z};
